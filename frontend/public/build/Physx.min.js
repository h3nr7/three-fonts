!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).PHYSX={})}(this,(function(e){"use strict";var t=function(e){var t,s=Object.prototype,i=s.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function l(e,t,s){return Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,s){return e[t]=s}}function h(e,t,s,i){var r=t&&t.prototype instanceof d?t:d,n=Object.create(r.prototype),a=new w(i||[]);return n._invoke=function(e,t,s){var i=u;return function(r,n){if(i===y)throw new Error("Generator is already running");if(i===p){if("throw"===r)throw n;return T()}for(s.method=r,s.arg=n;;){var a=s.delegate;if(a){var o=F(a,s);if(o){if(o===_)continue;return o}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(i===u)throw i=p,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);i=y;var l=c(e,t,s);if("normal"===l.type){if(i=s.done?p:m,l.arg===_)continue;return{value:l.arg,done:s.done}}"throw"===l.type&&(i=p,s.method="throw",s.arg=l.arg)}}}(e,s,a),n}function c(e,t,s){try{return{type:"normal",arg:e.call(t,s)}}catch(e){return{type:"throw",arg:e}}}e.wrap=h;var u="suspendedStart",m="suspendedYield",y="executing",p="completed",_={};function d(){}function P(){}function g(){}var f={};f[n]=function(){return this};var x=Object.getPrototypeOf,v=x&&x(x(C([])));v&&v!==s&&i.call(v,n)&&(f=v);var A=g.prototype=d.prototype=Object.create(f);function E(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function X(e,t){function s(r,n,a,o){var l=c(e[r],e,n);if("throw"!==l.type){var h=l.arg,u=h.value;return u&&"object"==typeof u&&i.call(u,"__await")?t.resolve(u.__await).then((function(e){s("next",e,a,o)}),(function(e){s("throw",e,a,o)})):t.resolve(u).then((function(e){h.value=e,a(h)}),(function(e){return s("throw",e,a,o)}))}o(l.arg)}var r;this._invoke=function(e,i){function n(){return new t((function(t,r){s(e,i,t,r)}))}return r=r?r.then(n,n):n()}}function F(e,s){var i=e.iterator[s.method];if(i===t){if(s.delegate=null,"throw"===s.method){if(e.iterator.return&&(s.method="return",s.arg=t,F(e,s),"throw"===s.method))return _;s.method="throw",s.arg=new TypeError("The iterator does not provide a 'throw' method")}return _}var r=c(i,e.iterator,s.arg);if("throw"===r.type)return s.method="throw",s.arg=r.arg,s.delegate=null,_;var n=r.arg;return n?n.done?(s[e.resultName]=n.value,s.next=e.nextLoc,"return"!==s.method&&(s.method="next",s.arg=t),s.delegate=null,_):n:(s.method="throw",s.arg=new TypeError("iterator result is not an object"),s.delegate=null,_)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function C(e){if(e){var s=e[n];if(s)return s.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function s(){for(;++r<e.length;)if(i.call(e,r))return s.value=e[r],s.done=!1,s;return s.value=t,s.done=!0,s};return a.next=a}}return{next:T}}function T(){return{value:t,done:!0}}return P.prototype=A.constructor=g,g.constructor=P,P.displayName=l(g,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===P||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,l(e,o,"GeneratorFunction")),e.prototype=Object.create(A),e},e.awrap=function(e){return{__await:e}},E(X.prototype),X.prototype[a]=function(){return this},e.AsyncIterator=X,e.async=function(t,s,i,r,n){void 0===n&&(n=Promise);var a=new X(h(t,s,i,r),n);return e.isGeneratorFunction(s)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(A),l(A,o,"Generator"),A[n]=function(){return this},A.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var s in e)t.push(s);return t.reverse(),function s(){for(;t.length;){var i=t.pop();if(i in e)return s.value=i,s.done=!1,s}return s.done=!0,s}},e.values=C,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var s in this)"t"===s.charAt(0)&&i.call(this,s)&&!isNaN(+s.slice(1))&&(this[s]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var s=this;function r(i,r){return o.type="throw",o.arg=e,s.next=i,r&&(s.method="next",s.arg=t),!!r}for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var l=i.call(a,"catchLoc"),h=i.call(a,"finallyLoc");if(l&&h){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var r=this.tryEntries[s];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var n=r;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=e,a.arg=t,n?(this.method="next",this.next=n.finallyLoc,_):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),_},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.finallyLoc===e)return this.complete(s.completion,s.afterLoc),S(s),_}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.tryLoc===e){var i=s.completion;if("throw"===i.type){var r=i.arg;S(s)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,s,i){return this.delegate={iterator:C(e),resultName:s,nextLoc:i},"next"===this.method&&(this.arg=t),_}},e}("object"==typeof module?module.exports:{});try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}const s=new Map,i=new Map,r=new Map,n={Ar:null,ArPos:{},byName:null,world:null,scene:null,gravity:null,cooking:null,cookingParams:null,tolerances:null,defaultMaterial:null,bodyRef:null,garbage:[],delta:0,substep:1,tmpStep:0,restitution:0,setFilter:null,setFilterData:null,key:[],reflow:{ray:[],stat:{fps:0,delta:0},point:{}}},a={solverAxis:null,D6Axis:null,clear:()=>{s.clear(),i.clear(),r.clear()},byName:e=>s.has(e)?s.get(e):null,byPtr:e=>i.has(e)?i.get(e):null,byContact:e=>r.has(e)?r.get(e):null,clearContact:()=>{r.clear()},addContact:(e,t={})=>{r.has(e)||r.set(e,t)},removeContact:e=>{r.has(e)&&r.delete(e)},add:(e,t)=>{switch(e.type){case"body":case"solid":e.isBone||n.scene.addActor(e,t),i.set(e.ptr,e.name)}s.set(e.name,e)},remove:e=>{if("ray"!==e.type&&"contact"!==e.type)switch(e.type){case"joint":case"solver":case"vehicle":case"terrain":e.release();break;default:e.isBone||(e.isKinematic&&delete n.bodyRef.extra[e.name],n.scene.removeActor(e),e.release())}s.delete(e.name)},stats:()=>{},malloc:(e,t)=>{const s=e.length*e.BYTES_PER_ELEMENT;return void 0===t&&(t=PhysX._malloc(s)),new Uint8Array(PhysX.HEAPU8.buffer,t,s).set(new Uint8Array(e.buffer)),t},free:e=>{e&&PhysX.asm.emscripten_stack_get_free(e)},extends:()=>{a.HitFlag={ePOSITION:PhysX._emscripten_enum_PxHitFlagEnum_ePOSITION(),eNORMAL:PhysX._emscripten_enum_PxHitFlagEnum_eNORMAL(),eUV:PhysX._emscripten_enum_PxHitFlagEnum_eUV(),eASSUME_NO_INITIAL_OVERLAP:PhysX._emscripten_enum_PxHitFlagEnum_eASSUME_NO_INITIAL_OVERLAP(),eMESH_MULTIPLE:PhysX._emscripten_enum_PxHitFlagEnum_eMESH_MULTIPLE(),eMESH_ANY:PhysX._emscripten_enum_PxHitFlagEnum_eMESH_ANY(),eMESH_BOTH_SIDES:PhysX._emscripten_enum_PxHitFlagEnum_eMESH_BOTH_SIDES(),ePRECISE_SWEEP:PhysX._emscripten_enum_PxHitFlagEnum_ePRECISE_SWEEP(),eMTD:PhysX._emscripten_enum_PxHitFlagEnum_eMTD(),eFACE_INDEX:PhysX._emscripten_enum_PxHitFlagEnum_eFACE_INDEX(),eDEFAULT:PhysX._emscripten_enum_PxHitFlagEnum_eDEFAULT(),eMODIFIABLE_FLAGS:PhysX._emscripten_enum_PxHitFlagEnum_eMODIFIABLE_FLAGS()},a.QueryFlag={eSTATIC:PhysX._emscripten_enum_PxQueryFlagEnum_eSTATIC(),eDYNAMIC:PhysX._emscripten_enum_PxQueryFlagEnum_eDYNAMIC(),ePREFILTER:PhysX._emscripten_enum_PxQueryFlagEnum_ePREFILTER(),ePOSTFILTER:PhysX._emscripten_enum_PxQueryFlagEnum_ePOSTFILTER(),eANY_HIT:PhysX._emscripten_enum_PxQueryFlagEnum_eANY_HIT(),eNO_BLOCK:PhysX._emscripten_enum_PxQueryFlagEnum_eNO_BLOCK()},a.ForceMode={force:PhysX._emscripten_enum_PxForceModeEnum_eFORCE(),impulse:PhysX._emscripten_enum_PxForceModeEnum_eIMPULSE(),velocity:PhysX._emscripten_enum_PxForceModeEnum_eVELOCITY_CHANGE(),acceleration:PhysX._emscripten_enum_PxForceModeEnum_eACCELERATION()},a.solverAxis={x:PhysX._emscripten_enum_PxArticulationAxisEnum_eX(),y:PhysX._emscripten_enum_PxArticulationAxisEnum_eY(),z:PhysX._emscripten_enum_PxArticulationAxisEnum_eZ(),rx:PhysX._emscripten_enum_PxArticulationAxisEnum_eTWIST(),ry:PhysX._emscripten_enum_PxArticulationAxisEnum_eSWING1(),rz:PhysX._emscripten_enum_PxArticulationAxisEnum_eSWING2(),twist:PhysX._emscripten_enum_PxArticulationAxisEnum_eTWIST(),swing1:PhysX._emscripten_enum_PxArticulationAxisEnum_eSWING1(),swing2:PhysX._emscripten_enum_PxArticulationAxisEnum_eSWING2()},a.D6Axis={x:PhysX._emscripten_enum_PxD6AxisEnum_eX(),y:PhysX._emscripten_enum_PxD6AxisEnum_eY(),z:PhysX._emscripten_enum_PxD6AxisEnum_eZ(),rx:PhysX._emscripten_enum_PxD6AxisEnum_eTWIST(),ry:PhysX._emscripten_enum_PxD6AxisEnum_eSWING1(),rz:PhysX._emscripten_enum_PxD6AxisEnum_eSWING2(),twist:PhysX._emscripten_enum_PxD6AxisEnum_eTWIST(),swing1:PhysX._emscripten_enum_PxD6AxisEnum_eSWING1(),swing2:PhysX._emscripten_enum_PxD6AxisEnum_eSWING2()},a.CacheFlag={velocity:PhysX._emscripten_enum_PxArticulationCacheFlagEnum_eVELOCITY(),acceleration:PhysX._emscripten_enum_PxArticulationCacheFlagEnum_eACCELERATION(),position:PhysX._emscripten_enum_PxArticulationCacheFlagEnum_ePOSITION(),force:PhysX._emscripten_enum_PxArticulationCacheFlagEnum_eFORCE(),velocity:PhysX._emscripten_enum_PxArticulationCacheFlagEnum_eLINK_VELOCITY(),link_acceleration:PhysX._emscripten_enum_PxArticulationCacheFlagEnum_eLINK_ACCELERATION(),root_transform:PhysX._emscripten_enum_PxArticulationCacheFlagEnum_eROOT_TRANSFORM(),root_velocity:PhysX._emscripten_enum_PxArticulationCacheFlagEnum_eROOT_VELOCITIES(),sensor_force:PhysX._emscripten_enum_PxArticulationCacheFlagEnum_eSENSOR_FORCES(),joint_force:PhysX._emscripten_enum_PxArticulationCacheFlagEnum_eJOINT_SOLVER_FORCES(),all:PhysX._emscripten_enum_PxArticulationCacheFlagEnum_eALL()},PhysX.PxVec3.prototype.set=function(e,t,s){return this.x=e,this.y=t,this.z=s,this},PhysX.PxVec3.prototype.toArray=function(e,t){let s=void 0!==e;if(s||(e=[]),e[t=t||0]=this.x,e[t+1]=this.y,e[t+2]=this.z,!s)return e},PhysX.PxVec3.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this},PhysX.PxVec3.prototype.divideScalar=function(e){return this.multiplyScalar(1/e)},PhysX.PxVec3.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},PhysX.PxVec3.prototype.normalize=function(){return this.divideScalar(this.length()||1)},PhysX.PxVec3.prototype.directionVector=function(e){const t=b.x-this.x,s=b.y-this.y,i=b.z-this.z;return Math.sqrt(t*t+s*s+i*i)},PhysX.PxVec3.prototype.distanceTo=function(e){const t=this.x-e.x,s=this.y-e.y,i=this.z-e.z;return Math.sqrt(t*t+s*s+i*i)},PhysX.PxVec3.prototype.op_sub=function(e){return this.set(this.x-e.x,this.y-e.y,this.z-e.z),this},PhysX.PxVec3.prototype.fromArray=function(e,t){return t=t||0,this.set(e[t],e[t+1],e[t+2]),this},PhysX.PxVec3.prototype.copy=function(e){return this.set(e.x,e.y,e.z),this},PhysX.PxVec3.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},PhysX.PxVec3.prototype.applyQuaternion=function(e){const t=this.x,s=this.y,i=this.z,r=e.x,n=e.y,a=e.z,o=e.w,l=o*t+n*i-a*s,h=o*s+a*t-r*i,c=o*i+r*s-n*t,u=-r*t-n*s-a*i;return this.x=l*o+u*-r+h*-a-c*-n,this.y=h*o+u*-n+c*-r-l*-a,this.z=c*o+u*-a+l*-n-h*-r,this},PhysX.PxVec3.prototype.applyMatrix3=function(e){const t=this.x,s=this.y,i=this.z,r=e.getBasis();return this.x=r[0]*t+r[3]*s+r[6]*i,this.y=r[1]*t+r[4]*s+r[7]*i,this.z=r[2]*t+r[5]*s+r[8]*i,this},PhysX.PxVec3.prototype.lerp=function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},PhysX.PxVec3.prototype.free=function(){PhysX.destroy(this)},PhysX.PxQuat.prototype.identity=function(){return this.set(0,0,0,1)},PhysX.PxQuat.prototype.set=function(e,t,s,i){return this.x=e,this.y=t,this.z=s,this.w=i,this},PhysX.PxQuat.prototype.toArray=function(e,t){let s=void 0!==e;if(s||(e=[]),e[t=t||0]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,!s)return e},PhysX.PxQuat.prototype.multiplyQuaternions=function(e,t){const s=e.x,i=e.y,r=e.z,n=e.w,a=t.x,o=t.y,l=t.z,h=t.w;return this.x=s*h+n*a+i*l-r*o,this.y=i*h+n*o+r*a-s*l,this.z=r*h+n*l+s*o-i*a,this.w=n*h-s*a-i*o-r*l,this},PhysX.PxQuat.prototype.premultiply=function(e){return this.multiplyQuaternions(e,this)},PhysX.PxQuat.prototype.multiply=function(e){return this.multiplyQuaternions(this,e)},PhysX.PxQuat.prototype.fromArray=function(e,t){return t=t||0,this.set(e[t],e[t+1],e[t+2],e[t+3]),this},PhysX.PxQuat.prototype.fromAxisAngle=function(e,t){const s=.5*t,i=Math.sin(s);return this.x=e[0]*i,this.y=e[1]*i,this.z=e[2]*i,this.w=Math.cos(s),this},PhysX.PxQuat.prototype.fromAxis=function(e){let t=e.toArray();if(t[2]>.99999)this.set(0,0,0,1);else if(t[2]<-.99999)this.set(1,0,0,0);else{let e=[t[1],t[0],0],s=Math.acos(t[2]);this.fromAxisAngle(e,s)}return this},PhysX.PxQuat.prototype.setFromRotationMatrix=function(e){const t=e[0],s=e[4],i=e[8],r=e[1],n=e[5],a=e[9],o=e[2],l=e[6],h=e[10],c=t+n+h;if(c>0){const e=.5/Math.sqrt(c+1);this.w=.25/e,this.x=(l-a)*e,this.y=(i-o)*e,this.z=(r-s)*e}else if(t>n&&t>h){const e=2*Math.sqrt(1+t-n-h);this.w=(l-a)/e,this.x=.25*e,this.y=(s+r)/e,this.z=(i+o)/e}else if(n>h){const e=2*Math.sqrt(1+n-t-h);this.w=(i-o)/e,this.x=(s+r)/e,this.y=.25*e,this.z=(a+l)/e}else{const e=2*Math.sqrt(1+h-t-n);this.w=(r-s)/e,this.x=(i+o)/e,this.y=(a+l)/e,this.z=.25*e}return this},PhysX.PxQuat.prototype.free=function(){PhysX.destroy(this)},PhysX.PxTransform.prototype.set=function(e,t){return this.p=e,this.q=t,this},PhysX.PxTransform.prototype.identity=function(){return this.p.fromArray([0,0,0]),this.q.fromArray([0,0,0,1]),this},PhysX.PxTransform.prototype.fromArray=function(e,t,s,i){return this.p.fromArray(e||[0,0,0],s||0),this.q.fromArray(t||[0,0,0,1],i||0),this},PhysX.PxTransform.prototype.multiply=function(e){const t=this.getElements(),s=e.getElements(),i=[],r=t[0],n=t[4],a=t[8],o=t[12],l=t[1],h=t[5],c=t[9],u=t[13],m=t[2],y=t[6],p=t[10],_=t[14],d=t[3],P=t[7],g=t[11],f=t[15],x=s[0],v=s[4],A=s[8],E=s[12],X=s[1],F=s[5],b=s[9],S=s[13],w=s[2],C=s[6],T=s[10],L=s[14],I=s[3],M=s[7],R=s[11],D=s[15];return i[0]=r*x+n*X+a*w+o*I,i[4]=r*v+n*F+a*C+o*M,i[8]=r*A+n*b+a*T+o*R,i[12]=r*E+n*S+a*L+o*D,i[1]=l*x+h*X+c*w+u*I,i[5]=l*v+h*F+c*C+u*M,i[9]=l*A+h*b+c*T+u*R,i[13]=l*E+h*S+c*L+u*D,i[2]=m*x+y*X+p*w+_*I,i[6]=m*v+y*F+p*C+_*M,i[10]=m*A+y*b+p*T+_*R,i[14]=m*E+y*S+p*L+_*D,i[3]=d*x+P*X+g*w+f*I,i[7]=d*v+P*F+g*C+f*M,i[11]=d*A+P*b+g*T+f*R,i[15]=d*E+P*S+g*L+f*D,this.decompose(i)},PhysX.PxTransform.prototype.decompose=function(e){return this.p.set(e[12],e[13],e[14]),this.q.setFromRotationMatrix(e),this},PhysX.PxTransform.prototype.getElements=function(e,t,s){const i=[];e=e||this.p,s=s||{x:1,y:1,z:1};const r=(t=t||this.q).x,n=t.y,a=t.z,o=t.w,l=r+r,h=n+n,c=a+a,u=r*l,m=r*h,y=r*c,p=n*h,_=n*c,d=a*c,P=o*l,g=o*h,f=o*c,x=s.x,v=s.y,A=s.z;return i[0]=(1-(p+d))*x,i[1]=(m+f)*x,i[2]=(y-g)*x,i[3]=0,i[4]=(m-f)*v,i[5]=(1-(u+d))*v,i[6]=(_+P)*v,i[7]=0,i[8]=(y+g)*A,i[9]=(_-P)*A,i[10]=(1-(u+p))*A,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,i},PhysX.PxTransform.prototype.getBasis=function(){let e=this.getElements();return[e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]]},PhysX.PxTransform.prototype.toArray=function(e,t){t=t||0,this.p.toArray(e,t),this.q.toArray(e,t+3)},PhysX.PxTransform.prototype.copy=function(e){return this.p=e.p,this.q=e.q,this},PhysX.PxTransform.prototype.rotationFromAxis=function(e){return this.q.fromAxis(e),this},PhysX.PxTransform.prototype.free=function(){PhysX.destroy(this),this.p.free(),this.q.free()}}},o=2e3,l=500,h=50,c=100,u=50,m=50,y=20,p={bodyFull:14,body:8,joint:16,contact:8,ray:11,character:16,vehicle:72,solver:128},_=Math.PI,d=_/180,P=180/_,g=Number.MAX_SAFE_INTEGER,f=Number.EPSILON,x={todeg:P,torad:d,toFixed:(e,t=3)=>1*e.toFixed(t),clamp:(e,t,s)=>e=(e=e<t?t:e)>s?s:e,clampA:(e,t,s)=>Math.max(t,Math.min(s,e)),lerp:(e,t,s)=>(1-s)*e+s*t,damp:(e,t,s,i)=>x.lerp(e,t,1-Math.exp(-s*i)),nearAngle:(e,t,s=!1)=>t+Math.atan2(Math.sin(e-t),Math.cos(e-t))*(s?P:1),unwrapDeg:e=>e-360*Math.floor((e+180)/360),unwrapRad:e=>Math.atan2(Math.sin(e),Math.cos(e)),nearEquals:(e,t,s)=>Math.abs(e-t)<=s,autoSize:(e=[1,1,1],t="box")=>{1===e.length&&(e[1]=e[0]);let s=e[0],i=e[1];return"sphere"===t&&(e=[s,s,s]),"cylinder"!==t&&"wheel"!==t&&"capsule"!==t||(e=[s,i,s]),"cone"!==t&&"pyramid"!==t||(e=[s,i,s]),2===e.length&&(e[2]=e[0]),e},randomSign:()=>Math.random()<.5?-1:1,randSpread:e=>e*(.5-Math.random()),rand:(e=0,t=1)=>e+Math.random()*(t-e),randInt:(e,t)=>e+Math.floor(Math.random()*(t-e+1)),equalArray:(e,t)=>{let s=e.length;for(;s--;)if(e[s]!==t[s])return!1;return!0},composeMatrixArray:(e,t,s=[1,1,1])=>{const i=t[0],r=t[1],n=t[2],a=t[3],o=i+i,l=r+r,h=n+n,c=i*o,u=i*l,m=i*h,y=r*l,p=r*h,_=n*h,d=a*o,P=a*l,g=a*h,f=s[0],x=s[1],v=s[2];return[(1-(y+_))*f,(u+g)*f,(m-P)*f,0,(u-g)*x,(1-(c+_))*x,(p+d)*x,0,(m+P)*v,(p-d)*v,(1-(c+y))*v,0,e[0],e[1],e[2],1]},decomposeMatrixArray:e=>[e[12],e[13],e[14]],applyTransformArray:(e,t,s,i=[1,1,1])=>{const r=x.composeMatrixArray(t,s,i),n=e[0],a=e[1],o=e[2],l=1/(r[3]*n+r[7]*a+r[11]*o+r[15]);return[(r[0]*n+r[4]*a+r[8]*o+r[12])*l,(r[1]*n+r[5]*a+r[9]*o+r[13])*l,(r[2]*n+r[6]*a+r[10]*o+r[14])*l]},equalArray:(e,t)=>{let s=e.length;for(;s--;)if(e[s]!==t[s])return!1;return!0},lerpArray:(e,t,s)=>{if(0===s)return e;if(1===s)return t;let i=e.length,r=[];for(;i--;)r[i]=e[i],r[i]+=(t[i]-r[i])*s;return r},slerpQuatArray:(e,t,s)=>{if(0===s)return e;if(1===s)return t;let i=[...e];const r=e[0],n=e[1],a=e[2],o=e[3],l=t[0],h=t[1],c=t[2],u=t[3];let m=o*u+r*l+n*h+a*c;if(m<0?(i=[-l,-h,-c,-u],m=-m):i=[...t],m>=1)return e;const y=1-m*m;if(y<=f){const e=1-s;return i[3]=e*o+s*i[3],i[0]=e*r+s*i[0],i[1]=e*n+s*i[1],i[2]=e*a+s*i[2],x.quatNomalize(i)}const p=Math.sqrt(y),_=Math.atan2(p,m),d=Math.sin((1-s)*_)/p,P=Math.sin(s*_)/p;return i[3]=o*d+i[3]*P,i[0]=r*d+i[0]*P,i[1]=n*d+i[1]*P,i[2]=a*d+i[2]*P,i},toLocalQuatArray:(e=[0,0,0],t)=>{let s=x.quatFromEuler(e),i=x.quatInvert(t.quaternion.toArray());return x.quatMultiply(i,s)},quatFromEuler:(e=[0,0,0],t=!0)=>{const s=Math.cos,i=Math.sin,r=t?d:1,n=e[0]*r*.5,a=e[1]*r*.5,o=e[2]*r*.5,l=s(n),h=s(a),c=s(o),u=i(n),m=i(a),y=i(o);return[u*h*c+l*m*y,l*m*c-u*h*y,l*h*y+u*m*c,l*h*c-u*m*y]},quatFromAxis:(e=[0,0,0],t,s=!0)=>{const i=.5*t*(s?d:1),r=Math.sin(i);return[e[0]*r,e[1]*r,e[2]*r,Math.cos(i)]},quatNomalize:e=>{let t=x.lengthArray(e);return 0===t?[0,0,0,1]:(t=1/t,x.scaleArray(e,t,4))},quatInvert:e=>[-e[0],-e[1],-e[2],e[3]],quatMultiply:(e,t)=>{const s=e[0],i=e[1],r=e[2],n=e[3],a=t[0],o=t[1],l=t[2],h=t[3];return[s*h+n*a+i*l-r*o,i*h+n*o+r*a-s*l,r*h+n*l+s*o-i*a,n*h-s*a-i*o-r*l]},quatToAxis:e=>{let t=2*Math.acos(e[3]);const s=Math.sqrt(1-e[3]*e[3]);return s<1e-4?[1,0,0]:[e[0]/s,e[1]/s,e[2]/s,t]},eulerFromMatrix:e=>{const t=e[0],s=e[4],i=e[8];e[1];const r=e[5],n=e[9];e[2];const a=e[6],o=e[10];let l=[0,0,0];return l[1]=Math.asin(x.clamp(i,-1,1)),Math.abs(i)<.9999999?(l[0]=Math.atan2(-n,o),l[2]=Math.atan2(-s,t)):(l[0]=Math.atan2(a,r),l[2]=0),l},angleTo:(e,t)=>2*Math.acos(Math.abs(x.clamp(x.dotArray(e,t),-1,1))),lengthArray:e=>{let t=e.length,s=0;for(;t--;)s+=e[t]*e[t];return Math.sqrt(s)},dotArray:(e,t)=>{let s=e.length,i=0;for(;s--;)i+=e[s]*t[s];return i},addArray:(e,t,s)=>{s=s??e.length;let i=[];for(;s--;)i[s]=e[s]+t[s];return i},subArray:(e,t,s)=>{s=s??e.length;let i=[];for(;s--;)i[s]=e[s]-t[s];return i},mulArray:(e,t,s)=>{for(s=s??e.length;s--;)e[s]*=t;return e},divArray:(e,t,s)=>x.scaleArray(e,1/t,s),scaleArray:(e,t,s)=>{for(s=s??e.length;s--;)e[s]*=t;return e},fillArray(e,t,s,i){for(s=s||0,i=i??e.length;i--;)t[s+i]=e[i]},copyArray:(e,t)=>{},distanceArray:(e,t=[0,0,0])=>x.lengthArray(x.subArray(e,t)),getVolume:(e,t,s=null)=>{let i=1,r=t;switch(e){case"sphere":i=4*Math.PI*r[0]*r[0]*r[0]/3;break;case"cone":i=Math.PI*r[0]*(.5*r[1])*2;break;case"box":i=.5*r[0]*8*(.5*r[1])*(.5*r[2]);break;case"cylinder":i=Math.PI*r[0]*r[0]*(.5*r[1])*2;break;case"capsule":i=4*Math.PI*r[0]*r[0]*r[0]/3+Math.PI*r[0]*r[0]*(.5*r[1])*2;break;case"convex":case"mesh":i=x.getConvexVolume(s)}return i},getConvexVolume:e=>{let t,s=e.length/3,i=[0,0,0],r=[0,0,0];for(;s--;)t=3*s,e[t]<i[0]?i[0]=e[t]:e[t]>r[0]&&(r[0]=e[t]),e[t+1]<i[1]?i[1]=e[t+1]:e[t+1]>r[1]&&(r[1]=e[t+1]),e[t+2]<i[2]?i[2]=e[t+2]:e[t+2]>r[2]&&(r[2]=e[t+2]);let n=[r[0]-i[0],r[1]-i[1],r[2]-i[2]];return.5*n[0]*8*(.5*n[1])*(.5*n[2])},massFromDensity:(e,t)=>e*t,densityFromMass:(e,t)=>e/t,getIndex:e=>e.index&&e.index.array||null,getVertex:(e,t)=>{let s=e.attributes.position.array;if(t){s=e.clone().toNonIndexed().attributes.position.array}return s},reduce:e=>{},barycentric:(e,t)=>{},solve:(e,t)=>{}};class v{constructor(){this.id=0,this.list=[],this.type="item",this.Utils=null}reset(){let e=this.list.length;for(;e--;)this.dispose(this.list[e]);this.list=[],this.id=0}byName(e){return this.Utils.byName(e)}setName(e={}){let t=void 0!==e.name?e.name:this.type+this.id++;return e.id=this.remove(t,!0),e.name=t,t}addToWorld(e,t=-1){this.Utils.add(e),-1!==t?this.list[t]=e:this.list.push(e)}remove(e,t){let s=this.byName(e);return s?this.clear(s,t):-1}clear(e,t){let s=this.list.indexOf(e);return-1===s||t?this.list[s]=null:this.list.splice(s,1),this.dispose(e),s}dispose(e){null!==e&&this.Utils.remove(e)}vecZero(e,t,s){for(;s--;)e[t+s]=0}fillArray(e,t,s,i){for(s=s||0,i=i??e.length;i--;)t[s+i]=e[i]}arLength(e){let t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return t<.001&&(t=0),t}multiplyScalar(e,t,s){for(s=s??e.length;s--;)e[s]*=t}divideScalar(e,t,s){this.multiplyScalar(e,1/t,s)}add(e={}){}set(e={}){}step(e,t){}}class A extends v{constructor(){super(),this.Utils=a,this.type="ray",this.init()}init(){this.rayBuffer=new PhysX.PxRaycastBuffer10,this.rayFlags=new PhysX.PxHitFlags(a.HitFlag.eDEFAULT|a.HitFlag.eANY_HIT),this.rayFilter=new PhysX.PxQueryFilterData,this.v1=new PhysX.PxVec3(0,0,0),this.v2=new PhysX.PxVec3(0,0,0)}byPtr(e){return a.byPtr(e)}step(){const e=n.Ar,t=n.ArPos[this.type];n.reflow.ray=[];let s,i,r,a,o,l,h=this.list.length;for(;h--;){if(i=t+h*p.ray,s=this.list[h],o=s.getPoint(),this.v1.fromArray(o[0]),this.v2.fromArray(o[1]),e[i]=0,a=this.v1.distanceTo(this.v2),this.v2.op_sub(this.v1).normalize(),this.v1.toArray(e,i+2),n.setFilterData(this.rayFilter.get_data(),[2,1,[3,5]]),l=null,n.scene.raycast(this.v1,this.v2,a,this.rayBuffer,this.rayFlags,this.rayFilter)){if(l=this.rayBuffer.getAnyHit(),r=this.byPtr(l.actor.ptr),s.parent&&r===s.parent)continue;e[i]=1,e[i+1]=l.distance,l.position.toArray(e,i+5),l.normal.toArray(e,i+8),n.reflow.ray[h]=r}}}applyResult(){}add(e={}){this.setName(e);let t=new E(e);this.addToWorld(t,e.id)}set(e={},t=null){null===t&&(t=this.byName(e.name)),null!==t&&(e.begin&&(t.begin=e.begin),e.end&&(t.end=e.end))}}class E{constructor(e={}){this.type="ray",this.name=e.name,this.parent=e.parent||"",this.begin=e.begin||[0,0,0],this.end=e.end||[0,0,1],this.precision=e.precision||1,this.group=void 0!==e.group||16,this.mask=void 0!==e.mask||2}getPoint(){if(this.parent){const e=a.byName(this.parent);if(e){const t=e.getGlobalPose(),s=t.p.toArray(),i=t.q.toArray();return[x.applyTransformArray(this.begin,s,i),x.applyTransformArray(this.end,s,i)]}}return[this.begin,this.end]}}class X extends v{constructor(){super(),this.Utils=a,this.type="body",this.itype="body",this.num=p[this.type],this.full=!1,this.tv=null,this.v=new PhysX.PxVec3,this.v2=new PhysX.PxVec3,this.q=new PhysX.PxQuat,this.qr=new PhysX.PxQuat,this.t=new PhysX.PxTransform,this.extra={}}setFull(e){this.num=p[e?"bodyFull":"body"],this.full=e}step(){const e=n.Ar,t=n.ArPos[this.itype];let s,i,r,a,o,l=this.list.length;for(;l--;)s=this.list[l],i=t+l*this.num,s?(o=s.isBone?s.getArticulation().isSleeping():s.isSleeping(),e[i]=o?0:1,s.getGlobalPose().toArray(e,i+1),this.full&&(r=s.getLinearVelocity(),a=s.getAngularVelocity(),r.toArray(e,i+8),a.toArray(e,i+11),1===e[i]&&(e[i]=9.8*r.length()))):this.vecZero(e,i,this.num)}extraStep(e){for(let t in this.extra){let s=this.extra[t],i=x.lerpArray(s.p,s.pend,s.mixInc*(e+1)),r=s.q;s.mixQuat&&(r=x.slerpQuatArray(s.q,s.qend,s.mixInc*(e+1))),this.t.fromArray(i,r),s.b.setKinematicTarget(this.t)}e===n.substep-1&&(this.extra={})}preRotate(e=[0,0,0,1],t="Z"){let s;switch(t){case"Y":s=[0,.7071067811865475,0,.7071067811865476];break;case"Z":s=[0,0,.7071067811865475,.7071067811865476]}return this.q.fromArray(e).premultiply(this.qr.fromArray(s)).toArray()}shape(e={}){let t,s,i,r,o,l,h=null,c=null,u=null,m=e.type||"box",y=e.size||[1,1,1],p=!1,_=null;switch(m){case"plane":t=new PhysX.PxPlaneGeometry;break;case"box":t=new PhysX.PxBoxGeometry(.5*y[0],.5*y[1],.5*y[2]);break;case"particle":t=new PhysX.PxSphereGeometry(e.pSize||.05);break;case"sphere":t=new PhysX.PxSphereGeometry(y[0]);break;case"capsule":t=new PhysX.PxCapsuleGeometry(y[0],.5*y[1]);break;case"convex":s=new PhysX.PxConvexMeshDesc,i=e.v,h=a.malloc(i),s.points.stride=3*i.BYTES_PER_ELEMENT,s.points.count=i.length/3,s.points.data=h;let m=0;m|=PhysX._emscripten_enum_PxConvexFlagEnum_eCOMPUTE_CONVEX(),m|=PhysX._emscripten_enum_PxConvexFlagEnum_eQUANTIZE_INPUT(),u=new PhysX.PxConvexFlags(m),s.flags=u,r=PhysX.PxTopLevelFunctions.prototype.CreateConvexMesh(n.cookingParams,s),o=new PhysX.PxMeshScale,l=new PhysX.PxConvexMeshGeometryFlags,t=new PhysX.PxConvexMeshGeometry(r,o,l),n.garbage.push(r),PhysX.destroy(u),PhysX.destroy(o),PhysX.destroy(l),PhysX.destroy(s),a.free(h);break;case"mesh":s=new PhysX.PxTriangleMeshDesc,i=e.v,_=e.index||null,_&&(_.constructor===Uint16Array&&(p=!0),_.constructor===Uint32Array&&(p=!1)),h=a.malloc(i),s.points.stride=3*i.BYTES_PER_ELEMENT,s.points.count=i.length/3,s.points.data=h,null!==_&&(c=a.malloc(_),s.triangles.stride=3*_.BYTES_PER_ELEMENT,s.triangles.count=_.length/3,s.triangles.data=c),p&&(u=new PhysX.PxTriangleMeshFlags(PhysX._emscripten_enum_PxTriangleMeshFlagEnum_e16_BIT_INDICES()),s.flags=u),r=PhysX.PxTopLevelFunctions.prototype.CreateTriangleMesh(n.cookingParams,s),o=new PhysX.PxMeshScale,l=new PhysX.PxMeshGeometryFlags,t=new PhysX.PxTriangleMeshGeometry(r,o,l),n.garbage.push(r),u&&PhysX.destroy(u),PhysX.destroy(o),PhysX.destroy(l),PhysX.destroy(s),a.free(h),a.free(c)}return t}setShapeFlag(e="default"){let t;switch(e){case"default":case 1:t=PhysX._emscripten_enum_PxShapeFlagEnum_eSCENE_QUERY_SHAPE()|PhysX._emscripten_enum_PxShapeFlagEnum_eSIMULATION_SHAPE();break;case"noCollision":case 0:t=PhysX._emscripten_enum_PxShapeFlagEnum_eSCENE_QUERY_SHAPE();break;case"noQuery":case 2:t=PhysX._emscripten_enum_PxShapeFlagEnum_eSIMULATION_SHAPE();break;case"ghost":case 3:t=PhysX._emscripten_enum_PxShapeFlagEnum_eTRIGGER_SHAPE();break;case"ghostAndQuery":case 4:t=PhysX._emscripten_enum_PxShapeFlagEnum_eTRIGGER_SHAPE()|PhysX._emscripten_enum_PxShapeFlagEnum_eSCENE_QUERY_SHAPE();break;case"none":case 5:t=0}return new PhysX.PxShapeFlags(t)}add(e={}){let t=this.setName(e),s=["body"===this.type?1:2,-1,0,0];void 0!==e.filter&&(s=e.filter,delete e.filter),void 0!==e.group&&(s[0]=e.group),void 0!==e.mask&&(s[1]=e.mask),e.isTrigger&&(s[1]=-1,s[2]=[3,5],e.flags="ghostAndQuery"),e.enableCCD&&(s[2]=[1,11,12]),e.breakable&&(s[2]=[3,5,10]),void 0===e.friction&&(e.friction=.5),void 0===!e.staticFriction&&(e.staticFriction=e.friction),void 0===!e.restitution&&(e.restitution=n.restitution);let i,r,o,l=.5===e.friction&&.5===e.staticFriction&&e.restitution===n.restitution,h=l?n.defaultMaterial:n.world.createMaterial(e.staticFriction,e.friction,e.restitution),c=[];switch(e.type){case"null":s[1]=0,i=this.shape({type:"sphere",size:[.01]}),o=this.setShapeFlag(0),c.push(n.world.createShape(i,h,void 0===e.isExclusive||e.isExclusive,o)),PhysX.destroy(o),PhysX.destroy(i);break;case"compound":let t,r;c=[],o=this.setShapeFlag(e.flags);for(let s=0;s<e.shapes.length;s++)t=e.shapes[s],i=this.shape(t),r=n.world.createShape(i,h,e.isExclusive||!1,o),"plane"!==t.type&&"capsule"!==t.type||(t.quat=this.preRotate(t.quat)),r.setLocalPose(this.t.fromArray(t.pos,t.quat)),PhysX.destroy(i),c.push(r);PhysX.destroy(o);break;default:i=this.shape(e),o=this.setShapeFlag(e.flags),c.push(n.world.createShape(i,h,void 0===e.isExclusive||e.isExclusive,o));let a=e.localPos||[0,0,0],l=e.localQuat||[0,0,0,1];"plane"!==e.type&&"capsule"!==e.type||(l=this.preRotate(l)),c[0].setLocalPose(this.t.fromArray(a,l)),i?PhysX.destroy(i):console.log(e),PhysX.destroy(o)}if(l||h.release(),this.t.fromArray(e.pos,e.quat),e.solver){let s=a.byName(e.solver);null!==s&&(r=s.addBone(t,this.t,e.linked),r.isBone=!0)}else r="body"===this.type?n.world.createRigidDynamic(this.t):n.world.createRigidStatic(this.t);let u=c.length;for(;u--;)n.setFilter(c[u],s),r.attachShape(c[u]),c[u].release();let m=null;m=this.v.fromArray(e.massCenter||[0,0,0]);r.isBone&&(e.mass=e.density),e.mass&&e.density&&delete e.density,"body"===this.type&&(e.density&&PhysX.PxRigidBodyExt.prototype.updateMassAndInertia(r,e.density,m,false),e.mass&&PhysX.PxRigidBodyExt.prototype.setMassAndUpdateInertia(r,e.mass,m,false)),r&&(r.name=t,r.type=this.type,r.isKinematic=e.kinematic||!1,r.breakable=e.breakable||!1,r.filter=s,e.kinematic&&(r.oldp=e.pos||[0,0,0]),delete e.pos,delete e.quat,this.addToWorld(r,e.id),this.set(e,r,!0))}set(e={},t=null){if(null===t&&(t=this.byName(e.name)),null===t)return;void 0!==e.kinematic&&"body"===t.type&&(t.setRigidBodyFlag(PhysX._emscripten_enum_PxRigidBodyFlagEnum_eKINEMATIC(),e.kinematic),t.isKinematic=e.kinematic),void 0!==e.gravity&&t.setActorFlag(PhysX._emscripten_enum_PxActorFlagEnum_eDISABLE_GRAVITY(),!e.gravity),e.noGravity&&t.setActorFlag(PhysX._emscripten_enum_PxActorFlagEnum_eDISABLE_GRAVITY(),!0),void 0!==e.disable&&t.setActorFlag(PhysX._emscripten_enum_PxActorFlagEnum_eDISABLE_SIMULATION(),e.disable);let s=!e.activate||e.activate;if(t.isBone||(e.sleep&&(t.putToSleep(),s=!1),e.wake&&t.wakeUp(),void 0!==e.neverSleep&&(t.setWakeCounter(0),t.setSleepThreshold(e.neverSleep?0:.005),e.neverSleep&&t.wakeUp())),e.pos||e.quat){if(!e.pos){let s=t.getGlobalPose().p;e.pos=[s.x,s.y,s.z]}if(!e.quat){let s=t.getGlobalPose().q;e.quat=[s.x,s.y,s.z,s.w]}if(this.t.fromArray(e.pos,e.quat),t.isKinematic)if(n.substep>1){let s=t.getGlobalPose();this.extra[t.name]={b:t,p:s.p.toArray(),pend:e.pos,q:s.q.toArray(),qend:e.quat?e.quat:[0,0,0,1],mixInc:1/n.substep,mixQuat:e.quat}}else t.setKinematicTarget(this.t);else t.setGlobalPose(this.t,s)}e.impulse&&(e.impulseCenter?PhysX.PxRigidBodyExt.prototype.addForceAtPos(t,this.v.fromArray(e.impulse),this.v2.fromArray(e.impulseCenter),a.ForceMode.impulse,s):t.addForce(this.v.fromArray(e.impulse),a.ForceMode.impulse,s)),e.force&&t.addForce(this.v.fromArray(e.force),a.ForceMode[e.forceMode||"force"],s),e.torque&&t.addTorque(this.v.fromArray(e.torque),a.ForceMode[e.torqueMode||"force"],s),"body"===t.type&&(t.getGlobalPose(),void 0!==e.linearVelocity&&t.setLinearVelocity(this.v.fromArray(e.linearVelocity),s),void 0!==e.angularVelocity&&t.setAngularVelocity(this.v.fromArray(e.angularVelocity),s),void 0!==e.linearFactor&&(t.setRigidDynamicLockFlag(PhysX.eLOCK_LINEAR_X,!e.linearFactor[0]),t.setRigidDynamicLockFlag(PhysX.eLOCK_LINEAR_Y,!e.linearFactor[1]),t.setRigidDynamicLockFlag(PhysX.eLOCK_LINEAR_Z,!e.linearFactor[2])),void 0!==e.angularFactor&&(t.setRigidDynamicLockFlag(PhysX.eLOCK_ANGULAR_X,!e.angularFactor[0]),t.setRigidDynamicLockFlag(PhysX.eLOCK_ANGULAR_Y,!e.angularFactor[1]),t.setRigidDynamicLockFlag(PhysX.eLOCK_ANGULAR_Z,!e.angularFactor[2])),void 0!==e.damping&&(t.setLinearDamping(e.damping[0]),t.setAngularDamping(e.damping[1])),void 0!==e.maxDamping&&(t.setMaxLinearVelocity(e.maxDamping[0]),t.setMaxAngularVelocity(e.maxDamping[1])),void 0!==e.maxVelocity&&(t.setMaxLinearVelocity(e.maxVelocity[0]),t.setMaxAngularVelocity(e.maxVelocity[1])),e.reset&&t.setLinearVelocity&&(t.setLinearVelocity(this.v.set(0,0,0),s),t.setAngularVelocity(this.v.set(0,0,0),s))),e.iterations&&t.setSolverIterationCounts&&t.setSolverIterationCounts(e.iterations[0],e.iterations[1]),void 0!==e.minCCD&&t.setMinCCDAdvanceCoefficient(e.minCCD),"body"===t.type&&(void 0!==e.kinematicTarget&&t.setRigidBodyFlag(PhysX._emscripten_enum_PxRigidBodyFlagEnum_eUSE_KINEMATIC_TARGET_FOR_SCENE_QUERIES(),e.kinematicTarget),void 0!==e.enableCCD&&t.setRigidBodyFlag(PhysX._emscripten_enum_PxRigidBodyFlagEnum_eENABLE_CCD(),e.enableCCD),void 0!==e.bullet&&t.setRigidBodyFlag(PhysX._emscripten_enum_PxRigidBodyFlagEnum_eENABLE_CCD(),e.bullet),void 0!==e.enableCCD_FRICTION&&t.setRigidBodyFlag(PhysX._emscripten_enum_PxRigidBodyFlagEnum_eENABLE_CCD_FRICTION(),e.enableCCD_FRICTION),void 0!==e.speculativeCCD&&t.setRigidBodyFlag(PhysX._emscripten_enum_PxRigidBodyFlagEnum_eENABLE_SPECULATIVE_CCD(),e.speculativeCCD),void 0!==e.enablePose&&t.setRigidBodyFlag(PhysX._emscripten_enum_PxRigidBodyFlagEnum_eENABLE_POSE_INTEGRATION_PREVIEW(),e.enablePose),void 0!==e.ccdMaxContact&&t.setRigidBodyFlag(PhysX._emscripten_enum_PxRigidBodyFlagEnum_eENABLE_CCD_MAX_CONTACT_IMPULSE(),e.ccdMaxContact),void 0!==e.retainAcc&&t.setRigidBodyFlag(PhysX._emscripten_enum_PxRigidBodyFlagEnum_eRETAIN_ACCELERATIONS(),e.retainAcc)),e.massCenter&&t.setCMassLocalPose(this.t.fromArray(e.massCenter)),e.inertia&&t.setMassSpaceInertiaTensor(this.v.fromArray(e.inertia)),e.dmv&&(e.dmv[0]&&t.setLinearDamping(e.dmv[0]),e.dmv[1]&&t.setAngularDamping(e.dmv[1]),e.dmv[2]&&t.setMaxLinearVelocity(e.dmv[2]),e.dmv[3]&&t.setMaxAngularVelocity(e.dmv[3]))}setShapes(e={},t=null){let s,i=t.getNbShapes();for(;i--;)s=PhysX.SupportFunctions.prototype.PxActor_getShape(t,i),e.filter&&n.setFilter(s,e.filter)}}class F extends v{constructor(){super(),this.Utils=a,this.type="joint",this.t1=new PhysX.PxTransform,this.t2=new PhysX.PxTransform,this.v1=new PhysX.PxVec3,this.v2=new PhysX.PxVec3,this.p1=new PhysX.PxVec3,this.p2=new PhysX.PxVec3,this.q1=new PhysX.PxQuat,this.q2=new PhysX.PxQuat,this.q3=new PhysX.PxQuat}step(){if(16!==p.joint)return;const e=n.Ar,t=n.ArPos[this.type];let s,i,r=this.list.length;for(;r--;)s=this.list[r],i=t+r*p.joint,s.visible&&(s.b1?this.t1.copy(s.b1.getGlobalPose()).multiply(s.formA).toArray(e,i):this.t1.copy(s.formA).toArray(e,i),s.b2?this.t1.copy(s.b2.getGlobalPose()).multiply(s.formB).toArray(e,i+7):this.t1.copy(s.formB).toArray(e,i+7))}add(e={}){this.v;let t=this.setName(e),s=this.byName(e.b1),i=this.byName(e.b2);null!==s&&"vehicle"===s.type&&(s=s.vehicleActor),null!==i&&"vehicle"===i.type&&(i=i.vehicleActor);let r=this.v1.fromArray(e.pos1||[0,0,0]),a=this.v2.fromArray(e.pos2||[0,0,0]),o=this.q1.fromArray(e.quat1||[0,0,0,1]),l=this.q2.fromArray(e.quat2||[0,0,0,1]),h=this.p1.fromArray(e.axis1||[0,0,1]),c=this.p2.fromArray(e.axis2||[0,0,1]);e.quat1||o.fromAxis(h).normalize(),e.quat2||l.fromAxis(c).normalize();const u=new PhysX.PxTransform(r,o),m=new PhysX.PxTransform(a,l);let y,p=e.mode||"hinge";switch("d6"!==p&&"universal"!==p&&"dof"!==p&&"ragdoll"!==p||(p="generic"),"revolute"===p&&(p="hinge"),"cylindrical"===p&&(p="slider"),p){case"fixe":y=new PhysX.PxTopLevelFunctions.prototype.FixedJointCreate(n.world,s,u,i,m);break;case"hinge":y=new PhysX.PxTopLevelFunctions.prototype.RevoluteJointCreate(n.world,s,u,i,m);break;case"spherical":y=new PhysX.PxTopLevelFunctions.prototype.SphericalJointCreate(n.world,s,u,i,m);break;case"prismatic":y=new PhysX.PxTopLevelFunctions.prototype.PrismaticJointCreate(n.world,s,u,i,m);break;case"distance":y=new PhysX.PxTopLevelFunctions.prototype.DistanceJointCreate(n.world,s,u,i,m);break;case"slider":case"generic":if("slider"===p){let t=e.lm?e.lm:[0,0],s=e.lmr?e.lmr:[0,0];e.lm&&delete e.lm,e.lmr&&delete e.lmr,e.lm=[["x",...t],["rx",...s]]}y=new PhysX.PxTopLevelFunctions.prototype.D6JointCreate(n.world,s,u,i,m)}y.name=t,y.mode=p,y.type=this.type,y.b1=s,y.b2=i,y.formA=u,y.formB=m,y.visible=!1,this.set(e,y);let _=void 0!==e.collision&&e.collision;y.setConstraintFlag(PhysX._emscripten_enum_PxConstraintFlagEnum_eCOLLISION_ENABLED(),_),this.addToWorld(y,e.id)}spring(e,t=[0,0]){}motor(e,t=[0,0],s=!1){}limit(e,t=[0,0],s=!1){}set(e={},t=null){if(null===t&&(t=this.byName(e.name)),null===t)return;let s,i,r,n,o,l,h;void 0!==e.visible&&(t.visible=e.visible);let c=void 0===e.wake||e.wake;switch(void 0!==e.project1&&t.setConstraintFlag(PhysX._emscripten_enum_PxConstraintFlagEnum_ePROJECT_TO_ACTOR0(),e.project1),void 0!==e.project2&&t.setConstraintFlag(PhysX._emscripten_enum_PxConstraintFlagEnum_ePROJECT_TO_ACTOR1(),e.project2),void 0!==e.tolerance&&this.tolerance(t,e.tolerance),void 0!==e.improveSlerp&&t.setConstraintFlag(PhysX._emscripten_enum_PxConstraintFlagEnum_eIMPROVED_SLERP(),e.improveSlerp),void 0!==e.noPreProcess&&t.setConstraintFlag(PhysX._emscripten_enum_PxConstraintFlagEnum_eDISABLE_PREPROCESSING(),e.noPreProcess),void 0!==e.extendedLimit&&t.setConstraintFlag(PhysX._emscripten_enum_PxConstraintFlagEnum_eENABLE_EXTENDED_LIMITS(),e.extendedLimit),void 0!==e.limitAreForce&&t.setConstraintFlag(PhysX._emscripten_enum_PxConstraintFlagEnum_eDRIVE_LIMITS_ARE_FORCES(),e.limitAreForce),void 0!==e.useGPU&&t.setConstraintFlag(PhysX._emscripten_enum_PxConstraintFlagEnum_eGPU_COMPATIBLE(),e.useGPU),
//!!!need PxSimulationEventCallbackImpl::onConstraintBreak.
void 0!==e.break&&t.setBreakForce(e.break[0],e.break[1]),t.mode){case"spherical":e.limit&&(s=this.coneLimit(e.limit,e.spring),t.setLimitCone(s),t.setSphericalJointFlag(PhysX._emscripten_enum_PxSphericalJointFlagEnum_eLIMIT_ENABLED(),!0));break;case"prismatic":e.limit&&(s=this.linearLimit(e.limit,e.spring),t.setLimit(s),t.setPrismaticJointFlag(PhysX._emscripten_enum_PxPrismaticJointFlagEnum_eLIMIT_ENABLED(),!0));break;case"hinge":void 0!==e.limit&&(s=this.angularLimit(e.limit,e.spring),t.setLimit(s),t.setRevoluteJointFlag(PhysX._emscripten_enum_PxRevoluteJointFlagEnum_eLIMIT_ENABLED(),!0)),void 0!==e.driveFree&&t.setRevoluteJointFlag(PhysX._emscripten_enum_PxRevoluteJointFlagEnum_eDRIVE_FREESPIN(),e.driveFree),void 0!==e.driveForceLimit&&t.setDriveForceLimit(e.driveForceLimit),void 0!==e.gearRatio&&t.setDriveGearRatio(e.gearRatio),e.motor&&(e.motor instanceof Array?(t.setDriveVelocity(e.motor[0]*d,c),e.motor[1]&&t.setDriveForceLimit(e.motor[1])):t.setDriveVelocity(e.motor*d,c),t.setRevoluteJointFlag(PhysX._emscripten_enum_PxRevoluteJointFlagEnum_eDRIVE_ENABLED(),!0));break;case"distance":e.lm&&(t.setMinDistance(e.lm[0]),t.setMaxDistance(e.lm[1]),t.setDistanceJointFlag(PhysX._emscripten_enum_PxDistanceJointFlagEnum_eMAX_DISTANCE_ENABLED(),!0),t.setDistanceJointFlag(PhysX._emscripten_enum_PxDistanceJointFlagEnum_eMIN_DISTANCE_ENABLED(),!0)),e.spring&&(void 0!==e.spring[0]&&t.setStiffness(e.spring[0]||0),void 0!==e.spring[1]&&t.setDamping(e.spring[1]||0),void 0!==e.spring[2]&&t.setTolerance(e.spring[2]),t.setDistanceJointFlag(PhysX._emscripten_enum_PxDistanceJointFlagEnum_eSPRING_ENABLED(),!0));break;case"generic":case"slider":e.acc&&t.setConstraintFlag(PhysX._emscripten_enum_PxD6JointDriveFlagEnum_eACCELERATION(),!0);const u=e.autoDrive||!1;if(e.lm)for(u&&!e.drives&&(e.drives=[]),i=e.lm.length;i--;){switch(o=e.lm[i],l=o.slice(1),h=a.D6Axis[o[0]],t.setMotion(h,PhysX._emscripten_enum_PxD6MotionEnum_eLIMITED()),o[0]){case"rx":case"twist":s=this.angularLimit(l),t.setTwistLimit(s);break;case"ry":case"swing1":s=this.coneLimit(l),t.setSwingLimit(s);break;case"rz":case"swing2":s=this.coneLimit(l),t.setSwingLimit(s);break;default:s=this.linearLimit(l),t.setLinearLimit(h,s)}u&&e.drives.push([o[0],o[2]||0,o[3]||0])}if(e.motion&&(e.motions=e.motion),e.motions)for(i=e.motions.length;i--;)r=e.motions[i],"rx"===r[0]&&(r[0]="twist"),"ry"===r[0]&&(r[0]="swing1"),"rz"===r[0]&&(r[0]="swing2"),t.setMotion(a.D6Axis[r[0]],PhysX["_emscripten_enum_PxD6MotionEnum_e"+r[1].toUpperCase()]());if(e.drive&&(e.drives=e.drive),e.drives)for(i=e.drives.length;i--;)r=e.drives[i],"rx"!==r[0]&&"twist"!==r[0]||(r[0]="twist"),"ry"!==r[0]&&"swing1"!==r[0]||(r[0]="swing"),"rz"!==r[0]&&"swing2"!==r[0]||(r[0]="slerp"),n=new PhysX.PxD6JointDrive(r[1]||0,r[2]||0,r[3]||g,void 0!==r[4]?r[4]?1:0:1),t.setDrive(PhysX["_emscripten_enum_PxD6DriveEnum_e"+r[0].toUpperCase()](),n);e.drivePosition&&t.setDrivePosition(this.t1.fromArray(e.drivePosition.pos||[0,0,0],e.drivePosition.quat||[0,0,0,1]),c),e.driveVelocity&&t.setDriveVelocity(this.v1.fromArray(e.driveVelocity[0]),this.v2.fromArray(e.driveVelocity[1]),c),void 0!==e.distanceLimit&&(s=this.distanceLimit(e.distanceLimit),t.setDistanceLimit(s))}}tolerance(e,t){t&&(e.setProjectionLinearTolerance(t[0]),e.setProjectionAngularTolerance(t[1]*d)),e.setConstraintFlag(PhysX._emscripten_enum_PxConstraintFlagEnum_ePROJECTION(),!0)}distanceLimit(e,t){let s=new PhysX.PxJointLinearLimit(e[0]);return e.length>2&&this.spring(s,e),s}linearLimit(e,t){let s=new PhysX.PxJointLinearLimitPair(e[0],e[1]);return e.length>2&&this.spring(s,e),t&&(void 0!==t[0]&&s.set_stiffness(t[0]),void 0!==t[1]&&s.set_damping(t[1])),s}angularLimit(e,t){let s=new PhysX.PxSpring(e[2]||0,e[3]||0);return new PhysX.PxJointAngularLimitPair(e[0]*d,e[1]*d,s)}coneLimit(e,t){let s=new PhysX.PxJointLimitCone(Math.abs(e[0])*d,Math.abs(e[1])*d);return e.length>2&&this.spring(s,e),s}pyramidLimit(e,t){let s=new PhysX.PxJointLimitPyramid(-e[0]*d,e[0]*d,-e[1]*d,e[1]*d);return this.sring(s,e),s}spring(e,t){void 0!==t[2]&&e.set_stiffness(t[2]),void 0!==t[3]&&e.set_damping(t[3]),void 0!==t[4]&&e.set_restitution(t[4]),void 0!==t[5]&&e.set_bounceThreshold(t[5])}}class S extends v{constructor(){super(),this.type="solver",this.Utils=a}step(){const e=n.Ar,t=n.ArPos[this.type];let s,i=this.list.length;for(;i--;)s=t+i*p[this.type],this.list[i].step(e,s)}add(e={}){this.setName(e);let t=new w(e);this.addToWorld(t,e.id)}set(e={},t=null){console.log("set ??")}}class w{constructor(e){this.enable=!1,this.angulars=["twist","swing1","swing2","TWIST","SWING1","SWING2","rx","ry","rz"],this.name=e.name,this.type="solver",this.neverSleep=e.neverSleep||!1,this.needData=e.needData||!1,this.cache=null,this.jid=0,this.useReducer=!0,this.chain=this.useReducer?n.world.createArticulationReducedCoordinate():n.world.createArticulation(),this.positionIters=void 0!==e.iteration?e.iteration:4,this.velocityIters=void 0!==e.velocityIteration?e.velocityIteration:1,this.chain.setSolverIterationCounts(this.positionIters,this.velocityIters),void 0!==e.fix&&this.chain.setArticulationFlag(PhysX.eFIX_BASE,e.fix),void 0!==e.driveLimite&&this.chain.setArticulationFlag(PhysX.eDRIVE_LIMITS_ARE_FORCES,e.driveLimite),void 0!==e.noCollision&&this.chain.setArticulationFlag(PhysX.eDISABLE_SELF_COLLISION,e.noCollision),void 0!==e.jointForce&&this.chain.setArticulationFlag(PhysX.eCOMPUTE_JOINT_FORCES,e.jointForce),void 0!==e.maxAngular&&this.chain.setMaxCOMAngularVelocity(e.maxAngular),void 0!==e.maxLinear&&this.chain.setMaxCOMLinearVelocity(e.maxLinear),void 0!==e.stabilization&&this.chain.setStabilizationThreshold(e.stabilization),this.t=new PhysX.PxTransform([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bones={},this.joints=[]}step(e,t){if(!this.needData)return;let s,i,r,n=this.joints.length;for(;n--;)s=t+7*n,r=this.joints[n],i=r.inverse?-1:1,e[s+0]=r.getDriveTarget(a.solverAxis.x)*i,e[s+1]=r.getDriveTarget(a.solverAxis.y)*i,e[s+2]=r.getDriveTarget(a.solverAxis.z)*i,e[s+3]=r.getDriveTarget(a.solverAxis.rx)*P*i,e[s+4]=r.getDriveTarget(a.solverAxis.ry)*P*i,e[s+5]=r.getDriveTarget(a.solverAxis.rz)*P*i,e[s+6]=0}remove(){this.enable&&(n.scene.removeArticulation(this.chain,!0),this.enable=!1)}start(){this.remove(),n.scene.addArticulation(this.chain),this.enable=!0,this.chain.setSleepThreshold(this.neverSleep?0:.005),this.chain.wakeUp()}stop(){}updateKinematic(){let e=new PhysX.PxArticulationKinematicFlags(PhysX._emscripten_enum_PxArticulationKinematicFlagEnum_ePOSITION()|PhysX._emscripten_enum_PxArticulationKinematicFlagEnum_eVELOCITY());this.chain.updateKinematic(e)}commonInit(e){this.chain.commonInit(),this.updateKinematic()}makeCache(e){this.cache=this.chain.createCache();let t=new PhysX.PxArticulationCacheFlags(a.CacheFlag.all);this.chain.copyInternalStateToCache(this.cache,t)}applyCache(e){this.chain.applyCache(this.cache,a.CacheFlag.all,!0)}changeCache(e){this.chain.computeGeneralizedGravityForce(this.cache),this.chain.computeCoriolisAndCentrifugalForce(this.cache),this.chain.computeJointAcceleration(this.cache),this.chain.computeJointForce(this.cache),this.chain.computeGeneralizedMassMatrix(this.cache),this.chain.computeCoefficientMatrix(this.cache)}release(){this.cache&&this.cache.release(),this.remove(),this.chain.release(),this.bones={},this.joints=[]}addBone(e,t,s){var i=null!==s?this.bones[s]:null,r=this.chain.createLink(i||null,t);return this.bones[e]=r,r}addSensor(e){let t=this.chain.createSensor(e.link,e.relativePose);console.log(t)}addTendon(e){const t=e.isFix?this.chain.createFixedTendon():this.chain.createSpatialTendon();console.log(t)}update(e){}addJoint(e){this.jid=this.joints.length;let t=e.name||this.name+"_Joint_"+this.jid,i=this.bones[e.bone].getInboundJoint();switch(e.type=void 0!==e.type?e.type:"fix",e.type){case"fixed":case"fixe":e.type="fix";break;case"slider":e.type="prismatic";break;case"hinge":e.type="revolute";break;case"ball":e.type="spherical";break;case"null":case"d6":e.type="undefined"}i.setJointType(PhysX["_emscripten_enum_PxArticulationJointTypeEnum_e"+e.type.toUpperCase()]()),i.setParentPose(this.t.fromArray(e.pos1,e.quat1)),i.setChildPose(this.t.fromArray(e.pos2,e.quat2)),i.name=t,i.type="solverJoint",i.solver=this.name,i.inverse=e.inverse||!1,"fix"!==e.type&&this.joints.push(i),s.set(t,i),this.updateJoint(e,i)}updateJoint(e,t){let s,i,r,n,o=void 0===e.wakeup||e.wakeup;if(e.limits)for(s=e.limits.length;s--;){i=e.limits[s],n=-1!==this.angulars.indexOf(i[0])?d:1;let r=new PhysX.PxArticulationLimit(i[1]*n,i[2]*n);t.setLimitParams(a.solverAxis[i[0]],r),t.setMotion(a.solverAxis[i[0]],PhysX._emscripten_enum_PxArticulationMotionEnum_eLIMITED())}if(e.motions)for(s=e.motions.length;s--;)i=e.motions[s],t.setMotion(a.solverAxis[i[0]],PhysX["_emscripten_enum_PxArticulationMotionEnum_e"+i[1].toUpperCase()]());if(e.drives)for(s=e.drives.length;s--;){i=e.drives[s],r=void 0!==i[4]?"string"==typeof i[4]||i[4]instanceof String?PhysX["_emscripten_enum_PxArticulationDriveTypeEnum_e"+i[4].toUpperCase()]():i[4]?PhysX._emscripten_enum_PxArticulationDriveTypeEnum_eACCELERATION():PhysX._emscripten_enum_PxArticulationDriveTypeEnum_eFORCE():PhysX._emscripten_enum_PxArticulationDriveTypeEnum_eFORCE();let n=new PhysX.PxArticulationDrive(i[1]||0,i[2]||0,i[3],r);t.setDriveParams(a.solverAxis[i[0]],n)}if(e.position)for(e.drivesTarget=e.position,s=e.position.length;s--;)i=e.position[s],n=-1!==this.angulars.indexOf(i[0])?d:1,t.inverse&&(n*=-1),t.setJointPosition(a.solverAxis[i[0]],i[1]*n);if(e.drivesTarget)for(s=e.drivesTarget.length;s--;)i=e.drivesTarget[s],n=-1!==this.angulars.indexOf(i[0])?d:1,t.inverse&&(n*=-1),t.setDriveTarget(a.solverAxis[i[0]],i[1]*n,o);if(e.drivesTargetVelocity&&(e.drivesVelocity=e.drivesTargetVelocity),e.drivesVelocity)for(s=e.drivesVelocity.length;s--;)i=e.drivesVelocity[s],n=-1!==this.angulars.indexOf(i[0])?d:1,t.setDriveVelocity(a.solverAxis[i[0]],i[1]*n,o);void 0!==e.frictionCoefficient&&t.setFrictionCoefficient(e.frictionCoefficient),void 0!==e.maxJointVelocity&&t.setMaxJointVelocity(e.maxJointVelocity)}}class C extends v{constructor(){super(),this.Utils=a,this.type="contact"}step(){const e=n.Ar,t=n.ArPos[this.type];let s,i,r,o=this.list.length;for(;o--;)s=this.list[o],i=t+o*p.contact,r=a.byContact(s.cc)?1:0,r||(r=a.byContact(s.cr)?1:0),e[i]=r}add(e={}){this.setName(e);let t=this.byName(e.b1);if(null===t)return;n.setCollisionFilter(t,[1,3,4,5,10,11]);let s=new T(e);this.addToWorld(s,e.id)}}class T{constructor(e={}){this.type="contact",this.name=e.name,this.cc=e.b1+"_"+e.b2,this.cr=e.b2+"_"+e.b1}}const L=4294967295;class I extends v{constructor(){super(),this.type="vehicle",this.Utils=a}simulate(e){let t=this.list.length;for(;t--;)this.list[t].simulate(e)}step(){const e=n.Ar,t=n.ArPos[this.type];let s,i=this.list.length;for(;i--;)s=t+i*p.vehicle,this.list[i].step(e,s)}add(e){this.setName(e);let t=new M(e);this.addToWorld(t,e.id)}set(e={},t=null){null===t&&(t=this.byName(e.name)),null!==t&&t.set(e)}}class M{constructor(e){this.type="vehicle",this.name=e.name,this.enable=!1,this.size=e.size||[1.7,1,5],this.numWheel=e.numWheel||4,this.wheelsPosition=e.wheelsPosition,this.radius=e.radius,this.radiusBack=e.radiusBack,this.deep=e.deep,this.deepBack=e.deepBack,this.massCenter=e.massCenter||[0,.55,1.594],this.chassisPos=e.chassisPos||[0,.83,0],this.t=new PhysX.PxTransform,this.key=[0,0,0,0,0,0,0,0],this.startPosition=e.pos||[0,3,0],this.startQuaternion=e.quat||[0,0,0,1],this.curentGear=0,this.autoGear=PhysX._emscripten_enum_PxVehicleEngineDriveTransmissionCommandStateEnum_eAUTOMATIC_GEAR(),this.trackWidth=2*this.wheelsPosition[1][0],this.wheelBase=2*this.wheelsPosition[1][2],this.motor=0,this.breaking=0,this.steering=0,this.data={mass:e.mass||2e3,incSteering:e.incSteering||2,maxSteering:e.maxSteering||24,acceleration:e.acceleration||10,breaking:e.breaking||100,engine:e.engine||1e3,topSpeed:e.topSpeed||1/0,s_travel:e.s_travel||.25,s_stiffness:e.s_stiffness||32,s_damping:e.s_damping||8,longStiff:e.longStiff||25,latStiffX:e.latStiffX||1e-5,latStiffY:e.latStiffY||120,camberStiff:e.camberStiff||0,restLoad:e.restLoad||5.5,dampingRate:e.dampingRate||.25,wMass:e.wMass||25},this.init(e)}init(e){this.data,this.carType=e.cartype||(4===this.numWheel?"fourWheelDrive":"multiWheelDrive"),this.roadQueryType="sweep",this.suspensionJounceCalculation="sweep",this.vehicle=new PhysX.EngineDriveVehicle,this.vehicleSimulationContext=new PhysX.PxVehiclePhysXSimulationContext,this.chassisShape=e.chassisShape?n.bodyRef.shape(e.chassisShape):new PhysX.PxBoxGeometry(.5*this.size[0],.5*this.size[1],.5*this.size[2]),this.setBaseParams(),this.setPhysxIntegrationParams(),this.setEngineDriveParams(),this.vehicle.initialize(n.world,n.cookingParams,n.defaultMaterial,PhysX["_emscripten_enum_EngineDriveVehicleEnum_eDIFFTYPE_"+this.carType.toUpperCase()]()),this.vehicleActor=this.vehicle.get_physXState().get_physxActor().get_rigidBody(),e.damping&&(this.vehicleActor.setLinearDamping(e.damping[0]),this.vehicleActor.setAngularDamping(e.damping[1])),this.startPose=(new PhysX.PxTransform).fromArray(this.startPosition,this.startQuaternion),this.vehicleActor.setGlobalPose(this.startPose),this.vehicleActor.setName(this.name),this.vehicleActor.type="body";const t=this.vehicleActor;this.vehicleActor.wakeUp=()=>{let e=t.getGlobalPose();t.setGlobalPose(e,!0)},n.scene.addActor(this.vehicleActor),this.vehicle.get_engineDriveState().get_gearboxState().set_currentGear(this.vehicle.get_engineDriveParams().get_gearBoxParams().get_neutralGear()+1),this.vehicle.get_engineDriveState().get_gearboxState().set_targetGear(this.vehicle.get_engineDriveParams().get_gearBoxParams().get_neutralGear()+1),this.vehicle.get_transmissionCommandState().set_targetGear(0),this.vehicleSimulationContext.setToDefault(),this.vehicleSimulationContext.get_frame().set_lngAxis(PhysX._emscripten_enum_PxVehicleAxesEnum_ePosZ()),this.vehicleSimulationContext.get_frame().set_latAxis(PhysX._emscripten_enum_PxVehicleAxesEnum_ePosX()),this.vehicleSimulationContext.get_frame().set_vrtAxis(PhysX._emscripten_enum_PxVehicleAxesEnum_ePosY()),this.vehicleSimulationContext.get_scale().set_scale(1),this.vehicleSimulationContext.set_gravity(n.gravity),this.vehicleSimulationContext.set_physxScene(n.scene),this.vehicleSimulationContext.set_physxActorUpdateMode(PhysX._emscripten_enum_PxVehiclePhysXActorUpdateModeEnum_eAPPLY_ACCELERATION()),this.vehicleSimulationContext.set_physxUnitCylinderSweepMesh(PhysX.PxVehicleTopLevelFunctions.prototype.VehicleUnitCylinderSweepMeshCreate(this.vehicleSimulationContext.get_frame(),n.world,n.cookingParams))}validate(e,t){e||console.log("Bug on:",t)}setBaseParams(){const e=this.data;let t=0,s=0;const i=this.numWheel,r=Math.round(2===i?2:.5*i),n=2===i?1:2,a=this.vehicle.get_baseParams();let o=a.get_axleDescription();for(o.set_nbAxles(r),o.set_nbWheels(i),t=0;t<r;t++)o.set_nbWheelsPerAxle(t,n),o.set_axleToWheelIds(t,s),s+=n;for(t=0;t<i;t++)o.set_wheelIdsInAxleOrder(t,t);let l=a.get_frame();l.set_latAxis(PhysX._emscripten_enum_PxVehicleAxesEnum_ePosX()),l.set_lngAxis(PhysX._emscripten_enum_PxVehicleAxesEnum_ePosZ()),l.set_vrtAxis(PhysX._emscripten_enum_PxVehicleAxesEnum_ePosY()),a.get_scale().set_scale(1);let h=this.size[0],c=this.size[1],u=this.size[2],m=e.mass,y=11.6,p=new PhysX.PxVec3((c*c+u*u)*m/y,(h*h+u*u)*m/y,(h*h+c*c)*m/y),_=a.get_rigidBodyParams();_.set_mass(e.mass),_.set_moi(p);let d=a.get_brakeResponseParams(0);for(d.set_maxResponse(2e3),t=0;t<i;t++)d.set_wheelResponseMultipliers(t,1);let P=a.get_brakeResponseParams(1);for(P.set_maxResponse(2e3),t=0;t<i;t++)P.set_wheelResponseMultipliers(t,t>2?1:0);let g=a.get_steerResponseParams();for(g.set_maxResponse(e.maxSteering/45),t=0;t<i;t++)g.set_wheelResponseMultipliers(t,t<n?1:0);var f=a.get_ackermannParams(0);f.set_wheelIds(0,0),f.set_wheelIds(1,1),f.set_wheelBase(this.wheelBase),f.set_trackWidth(this.trackWidth),f.set_strength(i>2?1:0),(new PhysX.PxTransform).fromArray([0,0,0]);let x=new PhysX.PxVec3(0,-1,0);for(t=0;t<i;t++){let s=a.get_suspensionParams(t);this.t.fromArray(this.wheelsPosition[t]);let i=this.wheelsPosition[t];i[1]+=.5*e.s_travel,this.t.fromArray(i),s.set_suspensionAttachment(this.t),s.set_suspensionTravelDir(x),this.t.fromArray([0,0,0]),s.set_wheelAttachment(this.t),s.set_suspensionTravelDist(e.s_travel)}let v=a.get_suspensionStateCalculationParams();v.set_suspensionJounceCalculationType(PhysX["_emscripten_enum_PxVehicleSuspensionJounceCalculationTypeEnum_e"+this.suspensionJounceCalculation.toUpperCase()]()),v.set_limitSuspensionExpansionVelocity(!1);let A=new PhysX.PxVec3(0,0,-.11);for(t=0;t<i;t++){let e=a.get_suspensionComplianceParams(t);e.get_wheelToeAngle().addPair(0,0),e.get_wheelCamberAngle().addPair(0,0),e.get_suspForceAppPoint().addPair(0,A),e.get_tireForceAppPoint().addPair(0,A)}let E=Math.round(e.mass/i);for(t=0;t<i;t++){let s=a.get_suspensionForceParams(t);s.set_stiffness(1e3*e.s_stiffness),s.set_damping(1e3*e.s_damping),s.set_sprungMass(E)}for(t=0;t<i;t++){let s=a.get_tireForceParams(t);s.set_longStiff(1e3*e.longStiff),s.set_latStiffX(1e3*e.latStiffX),s.set_latStiffY(1e3*e.latStiffY),s.set_camberStiff(1e3*e.camberStiff),s.set_restLoad(1e3*e.restLoad),PhysX.PxVehicleTireForceParamsExt.prototype.setFrictionVsSlip(s,0,0,0),PhysX.PxVehicleTireForceParamsExt.prototype.setFrictionVsSlip(s,0,1,1),PhysX.PxVehicleTireForceParamsExt.prototype.setFrictionVsSlip(s,1,0,.1),PhysX.PxVehicleTireForceParamsExt.prototype.setFrictionVsSlip(s,1,1,1),PhysX.PxVehicleTireForceParamsExt.prototype.setFrictionVsSlip(s,2,0,1),PhysX.PxVehicleTireForceParamsExt.prototype.setFrictionVsSlip(s,2,1,1),PhysX.PxVehicleTireForceParamsExt.prototype.setLoadFilter(s,0,0,0),PhysX.PxVehicleTireForceParamsExt.prototype.setLoadFilter(s,0,1,.2308),PhysX.PxVehicleTireForceParamsExt.prototype.setLoadFilter(s,1,0,3),PhysX.PxVehicleTireForceParamsExt.prototype.setLoadFilter(s,1,1,3)}for(t=0;t<i;t++){let s=a.get_wheelParams(t),i=e.wMass,r=t<n?this.radius:this.radiusBack;s.set_mass(i),s.set_radius(r),s.set_halfWidth(.5*(t<n?this.deep:this.deepBack)),s.set_dampingRate(e.dampingRate),s.set_moi(.5*i*r*r)}this.validate(a.isValid(),"baseParams")}setPhysxIntegrationParams(){const e=this.vehicle.get_baseParams(),t=this.vehicle.get_physXParams(),s=e.get_axleDescription();var i=new PhysX.PxFilterData(0,L,0,0),r=new PhysX.PxQueryFlags(PhysX._emscripten_enum_PxQueryFlagEnum_eSTATIC()),a=new PhysX.PxQueryFilterData(i,r),o=new PhysX.PxFilterData(1,L,0,0),l=new PhysX.PxQueryFlags(PhysX._emscripten_enum_PxQueryFlagEnum_eDYNAMIC()),h=new PhysX.PxQueryFilterData(o,l);let c=(new PhysX.PxTransform).fromArray(this.massCenter),u=(new PhysX.PxTransform).fromArray(this.chassisPos),m=new PhysX.PxVehiclePhysXMaterialFriction,y=n.world.createMaterial(.5,.5,.5);m.set_material(y),m.set_friction(1),t.create(s,a,null,m,1,1,c,this.chassisShape,u,PhysX["_emscripten_enum_PxVehiclePhysXRoadGeometryQueryTypeEnum_e"+this.roadQueryType.toUpperCase()]()),t.set_physxActorShapeFlags(n.bodyRef.setShapeFlag()),t.set_physxActorSimulationFilterData(h),this.validate(t.isValid(),"physxParams")}setEngineDriveParams(){const e=this.numWheel,t=this.vehicle.get_engineDriveParams();this.vehicle.get_baseParams().get_axleDescription();const s=t.get_autoboxParams();s.set_upRatios(0,.65),s.set_upRatios(1,.15),s.set_upRatios(2,.65),s.set_upRatios(3,.65),s.set_upRatios(4,.65),s.set_upRatios(5,.65),s.set_upRatios(6,.65),s.set_downRatios(0,.5),s.set_downRatios(1,.5),s.set_downRatios(2,.5),s.set_downRatios(3,.5),s.set_downRatios(4,.5),s.set_downRatios(5,.5),s.set_downRatios(6,.5),s.set_latency(2),t.get_clutchCommandResponseParams().set_maxResponse(10);const i=t.get_engineParams();i.get_torqueCurve().addPair(0,1),i.get_torqueCurve().addPair(.33,1),i.get_torqueCurve().addPair(1,1),i.set_moi(1),i.set_peakTorque(500),i.set_idleOmega(0),i.set_maxOmega(600),i.set_dampingRateFullThrottle(.15),i.set_dampingRateZeroThrottleClutchEngaged(2),i.set_dampingRateZeroThrottleClutchDisengaged(.35);const r=t.get_gearBoxParams();r.set_neutralGear(1),r.set_ratios(0,-4),r.set_ratios(1,0),r.set_ratios(2,4),r.set_ratios(3,2),r.set_ratios(4,1.5),r.set_ratios(5,1.1),r.set_ratios(6,1),r.set_nbRatios(7),r.set_finalRatio(4),r.set_switchTime(.5);const n=t.get_fourWheelDifferentialParams(),a=t.get_multiWheelDifferentialParams(),o=t.get_tankDifferentialParams();for(let t=0;t<e;t++)n.set_torqueRatios(t,.25),n.set_aveWheelSpeedRatios(t,.25),a.set_torqueRatios(t,.25),a.set_aveWheelSpeedRatios(t,.25),o.set_torqueRatios(t,.25),o.set_aveWheelSpeedRatios(t,.25);n.set_frontWheelIds(0,0),n.set_frontWheelIds(1,1),n.set_rearWheelIds(0,2),n.set_rearWheelIds(1,3),n.set_centerBias(1.3),n.set_centerTarget(1.29),n.set_frontBias(1.3),n.set_frontTarget(1.29),n.set_rearBias(1.3),n.set_rearTarget(1.29),n.set_rate(10);const l=t.get_clutchParams();l.set_accuracyMode(PhysX._emscripten_enum_PxVehicleClutchAccuracyModeEnum_eESTIMATE()),l.set_estimateIterations(5),this.validate(t.isValid(),"engineDriveParams")}respawn(e){}set(e){if(e.key&&(this.key=e.key),e.pos||e.quat){let t=this.vehicleActor.getGlobalPose();e.pos&&t.p.fromArray(e.pos),e.quat&&t.q.fromArray(e.quat),this.vehicleActor.setGlobalPose(t)}e.wake&&this.vehicleActor.wakeUp()}release(){n.scene.removeActor(this.vehicleActor,!0),this.vehicleActor.release(),PhysX.destroy(this.vehicle)}simulate(e){let t=this.vehicleActor.getLinearVelocity(),s=this.vehicleActor.getGlobalPose().getBasis(),i=t.dot({x:s[6],y:s[7],z:s[8]})<5?3:1;this.vehicle.set_componentSequenceSubstepGroupHandle(i),this.vehicle.step(e,this.vehicleSimulationContext)}step(e,t){this.drive();const s=this.vehicle.get_baseState();let i,r;for(this.vehicle.get_physXParams(),this.vehicleActor.getGlobalPose().toArray(e,t+1),i=0;i<this.numWheel;i++){r=8*(i+1);let n=s.get_wheelLocalPoses(i);e[t+r]=s.get_steerCommandResponseStates(i),n.localPose.toArray(e,t+r+1),e[t+r+2]+=this.massCenter[1]}}drive(){if(!this.enable)return;const e=n.key,t=this.data;let s=this.vehicle.get_commandState();0===e[0]?Math.abs(this.steering)>.1?this.steering*=.9:this.steering=0:(this.steering-=t.incSteering*e[0],this.steering=x.clamp(this.steering,-t.maxSteering,t.maxSteering)),0===e[1]?this.breaking=1:(e[1]<0?this.vehicle.get_transmissionCommandState().set_targetGear(this.autoGear):this.vehicle.get_transmissionCommandState().set_targetGear(0),this.breaking=0),s.set_steer(this.steering/t.maxSteering),s.set_nbBrakes(2),s.set_brakes(0,this.breaking),s.set_brakes(1,e[4]),s.set_throttle(Math.abs(e[1]))}}class R extends v{constructor(){super(),this.type="terrain",this.Utils=a}add(e){this.setName(e);let t=new D(e);this.addToWorld(t,e.id)}set(e={},t=null){null===t&&(t=this.byName(e.name)),null!==t&&t.set(e)}}class D{constructor(e){this.type="terrain",this.name=e.name,this.needUpdate=!1,this.heightField=null,this.init(e)}init(e){const t=e.size;this.sample=e.sample;const s=[t[0]/(this.sample[0]-1),t[2]/(this.sample[1]-1)];this.setDataTest(e);let i=new PhysX.PxMeshGeometryFlags(0),r=new PhysX.PxHeightFieldGeometry(this.heightField,i,1e-4*t[1],s[0],s[1]),a=n.world.createMaterial(e.staticFriction||.5,e.friction||.5,e.restitution||0),o=n.bodyRef.setShapeFlag(e.flags),l=n.world.createShape(r,a,!0,o),h=e.filter?e.filter:[2,-1,0,0];n.setFilter(l,h),PhysX.destroy(i),PhysX.destroy(o),PhysX.destroy(r),a.release();let c=(new PhysX.PxTransform).fromArray([e.pos[0]-.5*t[0],e.pos[1],e.pos[2]-.5*t[2]]);this.body=n.world.createRigidStatic(c),this.body.attachShape(l),l.release(),c.free(),n.scene.addActor(this.body)}setData(e){let t,s;const i=e.heightData,r=e.sample?e.sample:this.sample,a=e.decal?e.decal:[0,0],o=e.reverse||!1,l=e.shrink||!1;t=new PhysX.PxHeightFieldSample,s=new PhysX.Vector_PxHeightFieldSample;let h=i.length;for(;h--;)t.height=1e4*i[h],o&&t.setTessFlag(),s.push_back(t);const c=new PhysX.PxHeightFieldDesc;c.format=PhysX._emscripten_enum_PxHeightFieldFormatEnum_eS16_TM(),c.nbColumns=r[0],c.nbRows=r[1],c.samples.stride=4,c.samples.data=s.data(),this.heightField?this.heightField.modifySamples(a[0],a[1],c,l):this.heightField=n.cooking.createHeightField(c,n.world.getPhysicsInsertionCallback()),PhysX.destroy(c),PhysX.destroy(s),PhysX.destroy(t)}setDataTest(e){let t,s,i=e.heightData;const r=e.sample?e.sample:this.sample,n=e.decal?e.decal:[0,0],o=e.shrink||!1;s=new Uint32Array(i.length);let l=i.length,h=0;for(;l--;)s[l]=1e4*i[h],h++;const c=new PhysX.PxHeightFieldDesc;c.format=PhysX._emscripten_enum_PxHeightFieldFormatEnum_eS16_TM(),c.nbColumns=r[0],c.nbRows=r[1],t=a.malloc(s),c.samples.stride=s.BYTES_PER_ELEMENT,c.samples.data=t,this.heightField?this.heightField.modifySamples(n[0],n[1],c,o):this.heightField=PhysX.PxTopLevelFunctions.prototype.CreateHeightField(c),PhysX.destroy(c),a.free(t)}release(){n.scene.removeActor(this.body,!0),this.heightField&&this.heightField.release()}set(e){e.heightData&&this.setDataTest(e)}}class N extends X{constructor(){super(),this.itype="character",this.num=p.character}add(e={}){e.type="capsule",super.add(e)}remove(e={}){}dispose(e){}}let V;self.onmessage=function(e){fe.message(e)};let k,O,B,G,q,z,U,H,J,W,Q,Y,j,K=!1,Z=!1,$=!1,ee=null,te="default";const se="undefined"==typeof performance?Date:performance,ie={tmp:0,n:0,dt:0,fps:0};let re,ne=1/60,ae=16.67,oe=1,le=!0,he=0,ce=0,ue=0,me=!0,ye=null,pe=null,_e=!0,de={},Pe="";const ge=4294967295;class fe{static test(){}static message(e){let t=e.data;t.Ar&&(n.Ar=t.Ar),t.flow&&(de=t.flow),t.m&&fe[t.m](t.o)}static post(e,t){O?self.postMessage(e,t):k({data:e})}static init(e={}){O=!0,$=e.isBuffer||!1,void 0!==e.fps&&(ne=1/e.fps),void 0!==e.substep&&(oe=e.substep),e.message&&(k=e.message,O=!1,$=!1),e.blob&&importScripts(e.blob),PhysX().then((e=>{self.PhysX=e,a.extends(),fe.initItems(),fe.post({m:"ready",o:{}})}))}static set(e={}){n.ArPos=e.ArPos||function(e,t=!1){let s={},i={body:o*(t?p.bodyFull:p.body),joint:l*p.joint,ray:c*p.ray,contact:h*p.contact,character:u*p.character};"PHYSX"!==e&&"AMMO"!==e||(i.vehicle=m*p.vehicle),"PHYSX"===e&&(i.solver=y*p.solver),"HAVOK"!==e&&"RAPIER"!==e||(p.joint=0);let r=0;for(let e in i)s[e]=r,r+=i[e];return s.total=r,s}("PHYSX",e.full),V.body.setFull(e.full),Z=e.outsideStep||!1,K=e.isTimeout||!1,ne=1/(e.fps||60),ae=x.toFixed(1e3*ne,2),oe=e.substep||1,le=void 0===e.fixe||e.fixe,n.substep=oe,void 0===e.filter||e.filter,te=void 0!==e.solver?e.solver:"default",J=void 0===e.pcm||e.pcm,W=void 0!==e.ccd&&e.ccd,Q=void 0!==e.gpu&&e.gpu,Y=void 0!==e.stabiliz&&e.stabiliz,j=void 0!==e.mutable&&e.mutable,n.gravity=(new PhysX.PxVec3).fromArray(e.gravity||[0,-9.81,0]),null===n.scene&&fe.start()}static setGravity(e){n.gravity.fromArray(e.gravity),n.scene&&n.scene.setGravity(n.gravity)}static start(){null===n.world&&(n.Ar=new Float32Array(n.ArPos.total),fe.initWorld(),fe.initScene()),me=!1,re=!1,ce=0,n.tmpStep=0,Z||(K?(pe&&clearTimeout(pe),pe=setTimeout(fe.step,0)):ye=setInterval(fe.step,ae))}static initWorld(){B=new PhysX.PxDefaultAllocator,G=new PhysX.PxDefaultErrorCallback;let e=PhysX.PxTopLevelFunctions.prototype.PHYSICS_VERSION;if(_e){let t=e.toString(16);t=t.substring(0,1)+"."+t.substring(1,3)+"."+t.substring(3,5),console.log("PHYSX "+t),_e=!1}q=PhysX.PxTopLevelFunctions.prototype.CreateFoundation(e,B,G),n.tolerances=new PhysX.PxTolerancesScale,n.world=PhysX.PxTopLevelFunctions.prototype.CreatePhysics(e,q,n.tolerances,!0,null),n.cookingParams=new PhysX.PxCookingParams(n.tolerances),n.defaultMaterial=n.world.createMaterial(.5,.5,n.restitution),PhysX.PxTopLevelFunctions.prototype.InitExtensions(n.world),PhysX.PxVehicleTopLevelFunctions.prototype.InitVehicleExtension(q),z=PhysX.PxTopLevelFunctions.prototype.DefaultCpuDispatcherCreate(0),U=new PhysX.PxFilterData(1,-1,0,0),n.setFilter=fe.setFilter,n.setFilterData=fe.setFilterData,n.setCollisionFilter=fe.setCollisionFilter}static initScene(){if(null!==n.scene)return;let e=new PhysX.PxSceneDesc(n.tolerances);e.set_cpuDispatcher(z),e.gravity=n.gravity;let t=0;J&&(t|=PhysX._emscripten_enum_PxSceneFlagEnum_eENABLE_PCM()),W&&(t|=PhysX._emscripten_enum_PxSceneFlagEnum_eENABLE_CCD()),Y&&(t|=PhysX._emscripten_enum_PxSceneFlagEnum_eENABLE_STABILIZATION()),Q&&(t|=PhysX._emscripten_enum_PxSceneFlagEnum_eENABLE_GPU_DYNAMICS()),j&&(t|=PhysX._emscripten_enum_PxSceneFlagEnum_eENABLE_ACTIVE_ACTORS(),t|=PhysX._emscripten_enum_PxSceneFlagEnum_eEXCLUDE_KINEMATICS_FROM_ACTIVE_ACTORS());let s=new PhysX.PxSceneFlags(t);e.flags=s,PhysX.destroy(s),e.set_solverType(PhysX["e"+("default"===te?"TGS":"PGS")]),e.set_filterShader(PhysX.PxTopLevelFunctions.prototype.DefaultFilterShader()),n.scene=n.world.createScene(e),PhysX.destroy(e),ee=new PhysX.Vector_PxContactPairPoint(64),H=new PhysX.PxSimulationEventCallbackImpl,H.onContact=fe.onContact,H.onTrigger=fe.onTrigger,H.onConstraintBreak=fe.onConstraintBreak,n.scene.setSimulationEventCallback(H)}static onWake(e,t){}static onConstraintBreak(e,t){}static onTrigger(e,t){let s,i,r;for(;t--;)s=PhysX.NativeArrayHelpers.prototype.getTriggerPairAt(e,t),i=fe.byPtr(s.triggerActor.ptr),r=fe.byPtr(s.otherActor.ptr),i&&r&&(s.status===PhysX.eNOTIFY_TOUCH_FOUND&&a.addContact(i+"_"+r),s.status===PhysX.eNOTIFY_TOUCH_LOST&&a.removeContact(i+"_"+r))}static onContact(e,t,s){let i,r,o,l,h,c=PhysX.NativeArrayHelpers.prototype.getContactPairHeaderAt(e,0),u=c.get_actors(0),m=c.get_actors(1),y=0;for(;s--;)if(i=PhysX.NativeArrayHelpers.prototype.getContactPairAt(t,s),r=fe.byPtr(u.ptr),o=fe.byPtr(m.ptr),r&&o)if(i.events.isSet(PhysX.eNOTIFY_TOUCH_FOUND)){if(a.addContact(r+"_"+o),y=i.extractContacts(ee.data(),64),y>0)for(;y--;){l=ee.at(y),h=x.toFixed(l.separation,3);let e={distance:h,pos:l.position.toArray(),normal:l.normal.toArray(),impulse:l.impulse.length(),v1:fe.getVelocity(r),v2:fe.getVelocity(o)};0===y&&a.addContact(r+"_"+o,e),n.reflow.point[r+"_"+o+"_"+s+"_"+y]={b1:r,b2:o,hit:h<0,...e}}}else i.events.isSet(PhysX.eNOTIFY_TOUCH_LOST)&&a.removeContact(r+"_"+o)}static getVelocity(e){let t=this.byName(name);if(t&&t.breakable){return[...t.getLinearVelocity().toArray(),...t.getAngularVelocity().toArray()]}return[0,0,0,0,0,0]}static controle(e){e!==Pe&&(this.enable(Pe,!1),Pe=e,this.enable(Pe,!0))}static enable(e,t){if(""===e)return;let s=fe.byName(e);null!==s?s.enable=t:Pe=""}static poststep(){if(!me&&(n.tmpStep=1,this.dispatch(),!Z&&K)){pe&&clearTimeout(pe);let e=ae-(se.now()-ce);e<0&&(e=0),pe=setTimeout(fe.step,e)}}static dispatch(){let e,t;for(n.key=de.key,""!==de.current&&this.controle(de.current),e=de.remove.length,t=0;e--;)this.remove(de.remove[t++]);for(e=de.add.length,t=0;e--;)this.add(de.add[t++]);for(e=de.tmp.length,t=0;e--;)this.change(de.tmp[t++])}static step(e){if(re&&fe.endReset(),me)return;n.tmpStep=2,he=e||se.now(),ue=he-ce,ce=he,n.delta=.001*ue;let t=oe,s=le?ne/oe:n.delta/oe;for(;t--;)oe>1&&V.body.extraStep(n.tmpStep-2),V.vehicle.simulate(s),n.scene.simulate(s),n.scene.fetchResults(!0),n.tmpStep++;fe.stepItems(),he-1e3>ie.tmp&&(ie.tmp=he,n.reflow.stat.fps=ie.n,ie.n=0),ie.n++,n.reflow.stat.delta=n.delta,$?fe.post({m:"step",reflow:n.reflow,Ar:n.Ar},[n.Ar.buffer]):fe.post({m:"step",reflow:n.reflow,Ar:n.Ar}),n.reflow.point={}}static clearReFlow(){n.reflow={ray:[],point:{},stat:{fps:0,delta:0}}}static byName(e){return a.byName(e)}static byPtr(e){return a.byPtr(e)}static reset(){re=!0}static endReset(){fe.stop(),fe.resetItems(),this.clearGarbage(),this.clearReFlow(),ee.clear(),this.clearScene(),this.clearWorld(),Pe="",a.clear(),fe.post({m:"resetCallback",o:{}})}static clearScene(){null!==n.scene&&(n.scene.release(),n.scene=null)}static clearWorld(){null!==n.world&&(PhysX.destroy(n.tolerances),PhysX.destroy(U),PhysX.destroy(n.gravity),PhysX.PxTopLevelFunctions.prototype.CloseExtensions(),PhysX.PxVehicleTopLevelFunctions.prototype.CloseVehicleExtension(),PhysX.destroy(n.cookingParams),n.defaultMaterial.release(),n.world.release(),q.release(),PhysX.destroy(G),PhysX.destroy(B),n.world=null,n.gravity=null)}static clearGarbage(){for(;n.garbage.length>0;)n.garbage.pop().release();n.garbage=[]}static stop(){me=!0,Z||(pe&&clearTimeout(pe),ye&&clearInterval(ye),ye=null,pe=null)}static pause(e){let t=e.value;t!==me&&(t?this.stop():this.start())}static setFilterData(e,t=[]){if(void 0!==t[1]&&t[1]<0&&(t[1]=ge),t[2]instanceof Array){let e,s;for(e=t[2].length,s=0;e--;)s|=1<<t[2][e]-1;t[2]=s}else t[2]<0&&(t[2]=ge);void 0!==t[3]&&(1===t[3]&&(t[3]=4294901760),-1===t[3]&&(t[3]=65535)),e.word0=void 0!==t[0]?t[0]:1,e.word1=void 0!==t[1]?t[1]:ge,e.word2=t[2]||0,e.word3=t[3]||0}static setFilter(e,t){fe.setFilterData(U,t),e&&(e.setSimulationFilterData(U),e.setQueryFilterData(U))}static setShapes(e,t={}){let s,i=e.getNbShapes();for(;i--;)s=PhysX.SupportFunctions.prototype.PxActor_getShape(e,i),t.filter&&fe.setFilter(s,t.filter),t.flag&&fe.setFilter(s,t.flag)}static setCollisionFilter(e,t){let s=e.filter;s[2]=t,fe.setShapes(e,{filter:s})}static initItems(){V={body:new X,solid:new xe,ray:new A,joint:new F,solver:new S,contact:new C,character:new N,vehicle:new I,terrain:new R},n.bodyRef=V.body,n.byName=fe.byName}static resetItems(){Object.values(V).forEach((e=>e.reset()))}static stepItems(){Object.values(V).forEach((e=>e.step()))}static add(e={}){let t=function(e){switch(e.type){case"plane":case"box":case"sphere":case"highSphere":case"cylinder":case"stair":case"particle":case"cone":case"capsule":case"mesh":case"convex":case"compound":case"null":return e.mass||e.density||e.kinematic?"body":"solid";case"generic":case"hinge":case"slider":case"spherical":case"fixe":case"dof":case"d6":case"ragdoll":case"universal":case"cylindrical":case"distance":case"revolute":case"prismatic":return"joint";default:return e.type}}(e);V[t].add(e)}static remove(e={}){let t=fe.byName(e.name);null!==t&&V[t.type].clear(t)}static change(e={}){let t=fe.byName(e.name);null!==t&&("solverJoint"===t.type?fe.byName(t.solver).updateJoint(e,t):V[t.type].set(e,t))}static addSensor(e){let t=fe.byName(e.solver);null!==t&&t.addSensor(e)}static addTendon(e){let t=fe.byName(e.solver);null!==t&&t.addTendon(e)}static addSolverJoint(e){let t=fe.byName(e.solver);null!==t&&t.addJoint(e)}static startArticulation(e){let t=fe.byName(e.name);null!==t&&t.start()}static stopArticulation(e){let t=fe.byName(e.name);null!==t&&t.stop()}static commonInitArticulation(e){let t=fe.byName(e.name);null!==t&&t.commonInit(e)}static makeCache(e){let t=fe.byName(e.name);null!==t&&t.makeCache(e)}static applyCache(e){let t=fe.byName(e.name);null!==t&&t.applyCache(e)}}class xe extends X{constructor(){super(),this.type="solid"}step(e,t){}}e.engine=fe,Object.defineProperty(e,"__esModule",{value:!0})}));
