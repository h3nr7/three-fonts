!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).HAVOK={})}(this,(function(t){"use strict";var i=function(t){var i,s=Object.prototype,a=s.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},n=o.iterator||"@@iterator",e=o.asyncIterator||"@@asyncIterator",r=o.toStringTag||"@@toStringTag";function _(t,i,s){return Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}),t[i]}try{_({},"")}catch(t){_=function(t,i,s){return t[i]=s}}function l(t,i,s,a){var o=i&&i.prototype instanceof f?i:f,n=Object.create(o.prototype),e=new V(a||[]);return n._invoke=function(t,i,s){var a=c;return function(o,n){if(a===b)throw new Error("Generator is already running");if(a===p){if("throw"===o)throw n;return w()}for(s.method=o,s.arg=n;;){var e=s.delegate;if(e){var r=Z(e,s);if(r){if(r===x)continue;return r}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(a===c)throw a=p,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);a=b;var _=h(t,i,s);if("normal"===_.type){if(a=s.done?p:m,_.arg===x)continue;return{value:_.arg,done:s.done}}"throw"===_.type&&(a=p,s.method="throw",s.arg=_.arg)}}}(t,s,e),n}function h(t,i,s){try{return{type:"normal",arg:t.call(i,s)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var c="suspendedStart",m="suspendedYield",b="executing",p="completed",x={};function f(){}function u(){}function y(){}var v={};v[n]=function(){return this};var d=Object.getPrototypeOf,g=d&&d(d(L([])));g&&g!==s&&a.call(g,n)&&(v=g);var X=y.prototype=f.prototype=Object.create(v);function Y(t){["next","throw","return"].forEach((function(i){_(t,i,(function(t){return this._invoke(i,t)}))}))}function z(t,i){function s(o,n,e,r){var _=h(t[o],t,n);if("throw"!==_.type){var l=_.arg,c=l.value;return c&&"object"==typeof c&&a.call(c,"__await")?i.resolve(c.__await).then((function(t){s("next",t,e,r)}),(function(t){s("throw",t,e,r)})):i.resolve(c).then((function(t){l.value=t,e(l)}),(function(t){return s("throw",t,e,r)}))}r(_.arg)}var o;this._invoke=function(t,a){function n(){return new i((function(i,o){s(t,a,i,o)}))}return o=o?o.then(n,n):n()}}function Z(t,s){var a=t.iterator[s.method];if(a===i){if(s.delegate=null,"throw"===s.method){if(t.iterator.return&&(s.method="return",s.arg=i,Z(t,s),"throw"===s.method))return x;s.method="throw",s.arg=new TypeError("The iterator does not provide a 'throw' method")}return x}var o=h(a,t.iterator,s.arg);if("throw"===o.type)return s.method="throw",s.arg=o.arg,s.delegate=null,x;var n=o.arg;return n?n.done?(s[t.resultName]=n.value,s.next=t.nextLoc,"return"!==s.method&&(s.method="next",s.arg=i),s.delegate=null,x):n:(s.method="throw",s.arg=new TypeError("iterator result is not an object"),s.delegate=null,x)}function M(t){var i={tryLoc:t[0]};1 in t&&(i.catchLoc=t[1]),2 in t&&(i.finallyLoc=t[2],i.afterLoc=t[3]),this.tryEntries.push(i)}function I(t){var i=t.completion||{};i.type="normal",delete i.arg,t.completion=i}function V(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(M,this),this.reset(!0)}function L(t){if(t){var s=t[n];if(s)return s.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,e=function s(){for(;++o<t.length;)if(a.call(t,o))return s.value=t[o],s.done=!1,s;return s.value=i,s.done=!0,s};return e.next=e}}return{next:w}}function w(){return{value:i,done:!0}}return u.prototype=X.constructor=y,y.constructor=u,u.displayName=_(y,r,"GeneratorFunction"),t.isGeneratorFunction=function(t){var i="function"==typeof t&&t.constructor;return!!i&&(i===u||"GeneratorFunction"===(i.displayName||i.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,_(t,r,"GeneratorFunction")),t.prototype=Object.create(X),t},t.awrap=function(t){return{__await:t}},Y(z.prototype),z.prototype[e]=function(){return this},t.AsyncIterator=z,t.async=function(i,s,a,o,n){void 0===n&&(n=Promise);var e=new z(l(i,s,a,o),n);return t.isGeneratorFunction(s)?e:e.next().then((function(t){return t.done?t.value:e.next()}))},Y(X),_(X,r,"Generator"),X[n]=function(){return this},X.toString=function(){return"[object Generator]"},t.keys=function(t){var i=[];for(var s in t)i.push(s);return i.reverse(),function s(){for(;i.length;){var a=i.pop();if(a in t)return s.value=a,s.done=!1,s}return s.done=!0,s}},t.values=L,V.prototype={constructor:V,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(I),!t)for(var s in this)"t"===s.charAt(0)&&a.call(this,s)&&!isNaN(+s.slice(1))&&(this[s]=i)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var s=this;function o(a,o){return r.type="throw",r.arg=t,s.next=a,o&&(s.method="next",s.arg=i),!!o}for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n],r=e.completion;if("root"===e.tryLoc)return o("end");if(e.tryLoc<=this.prev){var _=a.call(e,"catchLoc"),l=a.call(e,"finallyLoc");if(_&&l){if(this.prev<e.catchLoc)return o(e.catchLoc,!0);if(this.prev<e.finallyLoc)return o(e.finallyLoc)}else if(_){if(this.prev<e.catchLoc)return o(e.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<e.finallyLoc)return o(e.finallyLoc)}}}},abrupt:function(t,i){for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s];if(o.tryLoc<=this.prev&&a.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var n=o;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=i&&i<=n.finallyLoc&&(n=null);var e=n?n.completion:{};return e.type=t,e.arg=i,n?(this.method="next",this.next=n.finallyLoc,x):this.complete(e)},complete:function(t,i){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&i&&(this.next=i),x},finish:function(t){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.finallyLoc===t)return this.complete(s.completion,s.afterLoc),I(s),x}},catch:function(t){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.tryLoc===t){var a=s.completion;if("throw"===a.type){var o=a.arg;I(s)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,s,a){return this.delegate={iterator:L(t),resultName:s,nextLoc:a},"next"===this.method&&(this.arg=i),x}},t}("object"==typeof module?module.exports:{});try{regeneratorRuntime=i}catch(t){Function("r","regeneratorRuntime = r")(i)}var s=s||{};s.collision||(s.collision={}),s.collision.broadphase||(s.collision.broadphase={}),s.collision.broadphase.BroadPhase=class{constructor(t){this._type=t,this._numProxies=0,this._proxyList=null,this._proxyListLast=null,this._proxyPairList=null,this._incremental=!1,this._testCount=0,this._proxyPairPool=null,this._idCount=0,this._convexSweep=new s.collision.broadphase._BroadPhase.ConvexSweepGeometry,this._aabb=new s.collision.broadphase._BroadPhase.AabbGeometry,this.identity=new s.common.Transform,this.zero=new s.common.Vec3,this.rayCastHit=new s.collision.geometry.RayCastHit}createProxy(t,i){return null}destroyProxy(t){}moveProxy(t,i,s){}isOverlapping(t,i){return t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ}collectPairs(){}getProxyPairList(){return this._proxyPairList}isIncremental(){return this._incremental}getTestCount(){return this._testCount}rayCast(t,i,s){}convexCast(t,i,s,a){}aabbTest(t,i){}},s.collision.geometry||(s.collision.geometry={}),s.collision.geometry.Geometry=class{constructor(t){this._type=t,this._volume=0}_updateMass(){}_computeAabb(t,i){}_rayCastLocal(t,i,s,a,o,n,e){return!1}getType(){return this._type}getVolume(){return this._volume}rayCast(t,i,s,a){let o,n,e,r,_,l,h,c,m,b,p,x;if(o=t.x,n=t.y,e=t.z,r=i.x,_=i.y,l=i.z,o-=s._positionX,n-=s._positionY,e-=s._positionZ,r-=s._positionX,_-=s._positionY,l-=s._positionZ,h=s._rotation00*o+s._rotation10*n+s._rotation20*e,c=s._rotation01*o+s._rotation11*n+s._rotation21*e,m=s._rotation02*o+s._rotation12*n+s._rotation22*e,o=h,n=c,e=m,b=s._rotation00*r+s._rotation10*_+s._rotation20*l,p=s._rotation01*r+s._rotation11*_+s._rotation21*l,x=s._rotation02*r+s._rotation12*_+s._rotation22*l,r=b,_=p,l=x,this._rayCastLocal(o,n,e,r,_,l,a)){let t,i,o,n,e,r,_=a.position;t=_.x,i=_.y,o=_.z;let l,h,c,m,b,p,x=a.normal;n=x.x,e=x.y,r=x.z,l=s._rotation00*t+s._rotation01*i+s._rotation02*o,h=s._rotation10*t+s._rotation11*i+s._rotation12*o,c=s._rotation20*t+s._rotation21*i+s._rotation22*o,t=l,i=h,o=c,m=s._rotation00*n+s._rotation01*e+s._rotation02*r,b=s._rotation10*n+s._rotation11*e+s._rotation12*r,p=s._rotation20*n+s._rotation21*e+s._rotation22*r,n=m,e=b,r=p,t+=s._positionX,i+=s._positionY,o+=s._positionZ;let f=a.position;f.x=t,f.y=i,f.z=o;let u=a.normal;return u.x=n,u.y=e,u.z=r,!0}return!1}},s.collision.geometry.ConvexGeometry=class extends s.collision.geometry.Geometry{constructor(t){super(t),this._gjkMargin=s.common.Setting.defaultGJKMargin,this._useGjkRayCast=!1}getGjkMergin(){return this._gjkMargin}setGjkMergin(t){t<0&&(t=0),this._gjkMargin=t}computeLocalSupportingVertex(t,i){}rayCast(t,i,a,o){return this._useGjkRayCast?s.collision.narrowphase.detector.gjkepa.GjkEpa.instance.rayCast(this,a,t,i,o):super.rayCast(t,i,a,o)}},s.collision.broadphase._BroadPhase||(s.collision.broadphase._BroadPhase={}),s.collision.broadphase._BroadPhase.ConvexSweepGeometry=class extends s.collision.geometry.ConvexGeometry{constructor(){super(-1)}init(t,i,a){let o,n,e,r,_,l,h,c,m;this.c=t,o=a.x,n=a.y,e=a.z,h=i._rotation00*o+i._rotation10*n+i._rotation20*e,c=i._rotation01*o+i._rotation11*n+i._rotation21*e,m=i._rotation02*o+i._rotation12*n+i._rotation22*e,r=h,_=c,l=m,this.localTranslation=new s.common.Vec3;let b=this.localTranslation;b.x=r,b.y=_,b.z=l,this._gjkMargin=t._gjkMargin}computeLocalSupportingVertex(t,i){this.c.computeLocalSupportingVertex(t,i);let s=this.localTranslation;if(t.x*s.x+t.y*s.y+t.z*s.z>0){let t=this.localTranslation;i.x+=t.x,i.y+=t.y,i.z+=t.z}}},s.collision.broadphase._BroadPhase.AabbGeometry=class extends s.collision.geometry.ConvexGeometry{constructor(){super(-1),this.min=new s.common.Vec3,this.max=new s.common.Vec3}computeLocalSupportingVertex(t,i){i.x=t.x>0?this.max.x:this.min.x,i.y=t.y>0?this.max.y:this.min.y,i.z=t.z>0?this.max.z:this.min.z}},s.collision.broadphase.BroadPhaseProxyCallback=class{constructor(){}process(t){}},s.collision.broadphase.BroadPhaseType=class{},s.collision.broadphase.Proxy=class{constructor(t,i){this.userData=t,this._id=i,this._prev=null,this._next=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}getId(){return this._id}getFatAabb(){let t=new s.collision.geometry.Aabb;return t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ,t}getFatAabbTo(t){t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ}},s.collision.broadphase.ProxyPair=class{constructor(){this._p1=null,this._p2=null}getProxy1(){return this._p1}getProxy2(){return this._p2}getNext(){return this._next}},s.collision.broadphase.bruteforce||(s.collision.broadphase.bruteforce={}),s.collision.broadphase.bruteforce.BruteForceBroadPhase=class extends s.collision.broadphase.BroadPhase{constructor(){super(1),this._incremental=!1}createProxy(t,i){let a=new s.collision.broadphase.Proxy(t,this._idCount++);return this._numProxies++,null==this._proxyList?(this._proxyList=a,this._proxyListLast=a):(this._proxyListLast._next=a,a._prev=this._proxyListLast,this._proxyListLast=a),a._aabbMinX=i._minX,a._aabbMinY=i._minY,a._aabbMinZ=i._minZ,a._aabbMaxX=i._maxX,a._aabbMaxY=i._maxY,a._aabbMaxZ=i._maxZ,a}destroyProxy(t){this._numProxies--;let i=t._prev,s=t._next;null!=i&&(i._next=s),null!=s&&(s._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null,t.userData=null}moveProxy(t,i,s){t._aabbMinX=i._minX,t._aabbMinY=i._minY,t._aabbMinZ=i._minZ,t._aabbMaxX=i._maxX,t._aabbMaxY=i._maxY,t._aabbMaxZ=i._maxZ}collectPairs(){let t=this._proxyPairList;if(null!=t){for(;t._p1=null,t._p2=null,t=t._next,null!=t;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}this._testCount=0;let i=this._proxyList;for(;null!=i;){let t=i._next,a=i._next;for(;null!=a;){let t=a._next;if(this._testCount++,i._aabbMinX<a._aabbMaxX&&i._aabbMaxX>a._aabbMinX&&i._aabbMinY<a._aabbMaxY&&i._aabbMaxY>a._aabbMinY&&i._aabbMinZ<a._aabbMaxZ&&i._aabbMaxZ>a._aabbMinZ){let t=this._proxyPairPool;null!=t?(this._proxyPairPool=t._next,t._next=null):t=new s.collision.broadphase.ProxyPair;let o=t;null==this._proxyPairList||(o._next=this._proxyPairList),this._proxyPairList=o,o._p1=i,o._p2=a}a=t}i=t}}rayCast(t,i,s){let a,o,n,e,r,_;a=t.x,o=t.y,n=t.z,e=i.x,r=i.y,_=i.z;let l=this._proxyList;for(;null!=l;){let t,i=l._next,h=a,c=o,m=n,b=e,p=r,x=_,f=l._aabbMinX,u=l._aabbMinY,y=l._aabbMinZ,v=l._aabbMaxX,d=l._aabbMaxY,g=l._aabbMaxZ;if(f>(h>b?h:b)||v<(h<b?h:b)||u>(c>p?c:p)||d<(c<p?c:p)||y>(m>x?m:x)||g<(m<x?m:x))t=!1;else{let i,s,a=b-h,o=p-c,n=x-m,e=a<0?-a:a,r=o<0?-o:o,_=n<0?-n:n,l=.5*(v-f),X=.5*(d-u),Y=.5*(g-y),z=h-.5*(v+f),Z=c-.5*(d+u),M=m-.5*(g+y),I=Z*n-M*o;if((I<0?-I:I)-(X*_+Y*r)>0)s=!0;else{let t=M*a-z*n;s=(t<0?-t:t)-(Y*e+l*_)>0}if(s)i=!0;else{let t=z*o-Z*a;i=(t<0?-t:t)-(l*r+X*e)>0}t=!i}t&&s.process(l),l=i}}convexCast(t,i,a,o){let n=this._proxyList;for(;null!=n;){let e=n._next,r=this._aabb.min;r.x=n._aabbMinX,r.y=n._aabbMinY,r.z=n._aabbMinZ;let _=this._aabb.max;_.x=n._aabbMaxX,_.y=n._aabbMaxY,_.z=n._aabbMaxZ,this._convexSweep.init(t,i,a);let l=s.collision.narrowphase.detector.gjkepa.GjkEpa.instance;0==l.computeClosestPointsImpl(this._convexSweep,this._aabb,i,this.identity,null,!1)&&l.distance<=0&&o.process(n),n=e}}aabbTest(t,i){let s=this._proxyList;for(;null!=s;){let a=s._next;t._minX<s._aabbMaxX&&t._maxX>s._aabbMinX&&t._minY<s._aabbMaxY&&t._maxY>s._aabbMinY&&t._minZ<s._aabbMaxZ&&t._maxZ>s._aabbMinZ&&i.process(s),s=a}}},s.collision.broadphase.bvh||(s.collision.broadphase.bvh={}),s.collision.broadphase.bvh.BvhBroadPhase=class extends s.collision.broadphase.BroadPhase{constructor(){super(2),this._incremental=!0,this._tree=new s.collision.broadphase.bvh.BvhTree,this.movedProxies=new Array(1024),this.numMovedProxies=0}collide(t,i){this._testCount++;let a=0==t._height,o=0==i._height;if(t==i){if(a)return;return this.collide(t._children[0],i),void this.collide(t._children[1],i)}if(t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ){if(a&&o){let a=this._proxyPairPool;null!=a?(this._proxyPairPool=a._next,a._next=null):a=new s.collision.broadphase.ProxyPair;let o=a;return null==this._proxyPairList||(o._next=this._proxyPairList),this._proxyPairList=o,o._p1=t._proxy,void(o._p2=i._proxy)}o||t._height>i._height?(this.collide(t._children[0],i),this.collide(t._children[1],i)):(this.collide(i._children[0],t),this.collide(i._children[1],t))}}rayCastRecursive(t,i,s,a,o,n,e,r){let _,l=i,h=s,c=a,m=o,b=n,p=e,x=t._aabbMinX,f=t._aabbMinY,u=t._aabbMinZ,y=t._aabbMaxX,v=t._aabbMaxY,d=t._aabbMaxZ;if(x>(l>m?l:m)||y<(l<m?l:m)||f>(h>b?h:b)||v<(h<b?h:b)||u>(c>p?c:p)||d<(c<p?c:p))_=!1;else{let t,i,s=m-l,a=b-h,o=p-c,n=s<0?-s:s,e=a<0?-a:a,r=o<0?-o:o,g=.5*(y-x),X=.5*(v-f),Y=.5*(d-u),z=l-.5*(y+x),Z=h-.5*(v+f),M=c-.5*(d+u),I=Z*o-M*a;if((I<0?-I:I)-(X*r+Y*e)>0)i=!0;else{let t=M*s-z*o;i=(t<0?-t:t)-(Y*n+g*r)>0}if(i)t=!0;else{let i=z*a-Z*s;t=(i<0?-i:i)-(g*e+X*n)>0}_=!t}_&&(0!=t._height?(this.rayCastRecursive(t._children[0],i,s,a,o,n,e,r),this.rayCastRecursive(t._children[1],i,s,a,o,n,e,r)):r.process(t._proxy))}convexCastRecursive(t,i,a,o,n){let e=this._aabb.min;e.x=t._aabbMinX,e.y=t._aabbMinY,e.z=t._aabbMinZ;let r=this._aabb.max;r.x=t._aabbMaxX,r.y=t._aabbMaxY,r.z=t._aabbMaxZ,this._convexSweep.init(i,a,o);let _=s.collision.narrowphase.detector.gjkepa.GjkEpa.instance;0==_.computeClosestPointsImpl(this._convexSweep,this._aabb,a,this.identity,null,!1)&&_.distance<=0&&(0!=t._height?(this.convexCastRecursive(t._children[0],i,a,o,n),this.convexCastRecursive(t._children[1],i,a,o,n)):n.process(t._proxy))}aabbTestRecursive(t,i,s){t._aabbMinX<i._maxX&&t._aabbMaxX>i._minX&&t._aabbMinY<i._maxY&&t._aabbMaxY>i._minY&&t._aabbMinZ<i._maxZ&&t._aabbMaxZ>i._minZ&&(0!=t._height?(this.aabbTestRecursive(t._children[0],i,s),this.aabbTestRecursive(t._children[1],i,s)):s.process(t._proxy))}createProxy(t,i){let a=new s.collision.broadphase.bvh.BvhProxy(t,this._idCount++);this._numProxies++,null==this._proxyList?(this._proxyList=a,this._proxyListLast=a):(this._proxyListLast._next=a,a._prev=this._proxyListLast,this._proxyListLast=a),a._aabbMinX=i._minX,a._aabbMinY=i._minY,a._aabbMinZ=i._minZ,a._aabbMaxX=i._maxX,a._aabbMaxY=i._maxY,a._aabbMaxZ=i._maxZ;let o=s.common.Setting.bvhProxyPadding;a._aabbMinX-=o,a._aabbMinY-=o,a._aabbMinZ-=o,a._aabbMaxX+=o,a._aabbMaxY+=o,a._aabbMaxZ+=o;let n=this._tree,e=n._nodePool;null!=e?(n._nodePool=e._next,e._next=null):e=new s.collision.broadphase.bvh.BvhNode;let r=e;if(r._proxy=a,a._leaf=r,r._aabbMinX=a._aabbMinX,r._aabbMinY=a._aabbMinY,r._aabbMinZ=a._aabbMinZ,r._aabbMaxX=a._aabbMaxX,r._aabbMaxY=a._aabbMaxY,r._aabbMaxZ=a._aabbMaxZ,n._numLeaves++,null==n.leafList?(n.leafList=r,n.leafListLast=r):(n.leafListLast._nextLeaf=r,r._prevLeaf=n.leafListLast,n.leafListLast=r),null==n._root)n._root=r;else{let t=n._root;for(;t._height>0;){let i=n._strategy._decideInsertion(t,r);if(-1==i)break;t=t._children[i]}let i=t._parent,a=n._nodePool;null!=a?(n._nodePool=a._next,a._next=null):a=new s.collision.broadphase.bvh.BvhNode;let o=a;if(null==i)n._root=o;else{let s=t._childIndex;i._children[s]=o,o._parent=i,o._childIndex=s}let e=t._childIndex;o._children[e]=t,t._parent=o,t._childIndex=e;let _=1^t._childIndex;for(o._children[_]=r,r._parent=o,r._childIndex=_;null!=o;){if(n._strategy._balancingEnabled&&o._height>=2){let t=o._parent,i=o._children[0],s=o._children[1],a=i._height-s._height,e=o._childIndex;if(a>1){let s=i._children[0],a=i._children[1];if(s._height>a._height){i._children[1]=o,o._parent=i,o._childIndex=1,o._children[0]=a,a._parent=o,a._childIndex=0;let t=i._children[0],s=i._children[1];i._aabbMinX=t._aabbMinX<s._aabbMinX?t._aabbMinX:s._aabbMinX,i._aabbMinY=t._aabbMinY<s._aabbMinY?t._aabbMinY:s._aabbMinY,i._aabbMinZ=t._aabbMinZ<s._aabbMinZ?t._aabbMinZ:s._aabbMinZ,i._aabbMaxX=t._aabbMaxX>s._aabbMaxX?t._aabbMaxX:s._aabbMaxX,i._aabbMaxY=t._aabbMaxY>s._aabbMaxY?t._aabbMaxY:s._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>s._aabbMaxZ?t._aabbMaxZ:s._aabbMaxZ;let n=i._children[0]._height,e=i._children[1]._height;i._height=(n>e?n:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=o._children[0]._height,h=o._children[1]._height;o._height=(l>h?l:h)+1}else{i._children[0]=o,o._parent=i,o._childIndex=0,o._children[0]=s,s._parent=o,s._childIndex=0;let t=i._children[0],a=i._children[1];i._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,i._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,i._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,i._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,i._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let n=i._children[0]._height,e=i._children[1]._height;i._height=(n>e?n:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=o._children[0]._height,h=o._children[1]._height;o._height=(l>h?l:h)+1}null!=t?(t._children[e]=i,i._parent=t,i._childIndex=e):(n._root=i,i._parent=null),o=i}else if(a<-1){let i=s._children[0],a=s._children[1];if(i._height>a._height){s._children[1]=o,o._parent=s,o._childIndex=1,o._children[1]=a,a._parent=o,a._childIndex=1;let t=s._children[0],i=s._children[1];s._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,s._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,s._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,s._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,s._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let n=s._children[0]._height,e=s._children[1]._height;s._height=(n>e?n:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=o._children[0]._height,h=o._children[1]._height;o._height=(l>h?l:h)+1}else{s._children[0]=o,o._parent=s,o._childIndex=0,o._children[1]=i,i._parent=o,i._childIndex=1;let t=s._children[0],a=s._children[1];s._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,s._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,s._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,s._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,s._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let n=s._children[0]._height,e=s._children[1]._height;s._height=(n>e?n:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=o._children[0]._height,h=o._children[1]._height;o._height=(l>h?l:h)+1}null!=t?(t._children[e]=s,s._parent=t,s._childIndex=e):(n._root=s,s._parent=null),o=s}}let t=o._children[0]._height,i=o._children[1]._height;o._height=(t>i?t:i)+1;let s=o._children[0],a=o._children[1];o._aabbMinX=s._aabbMinX<a._aabbMinX?s._aabbMinX:a._aabbMinX,o._aabbMinY=s._aabbMinY<a._aabbMinY?s._aabbMinY:a._aabbMinY,o._aabbMinZ=s._aabbMinZ<a._aabbMinZ?s._aabbMinZ:a._aabbMinZ,o._aabbMaxX=s._aabbMaxX>a._aabbMaxX?s._aabbMaxX:a._aabbMaxX,o._aabbMaxY=s._aabbMaxY>a._aabbMaxY?s._aabbMaxY:a._aabbMaxY,o._aabbMaxZ=s._aabbMaxZ>a._aabbMaxZ?s._aabbMaxZ:a._aabbMaxZ,o=o._parent}}if(!a._moved){if(a._moved=!0,this.movedProxies.length==this.numMovedProxies){let t=new Array(this.numMovedProxies<<1),i=0,s=this.numMovedProxies;for(;i<s;){let s=i++;t[s]=this.movedProxies[s],this.movedProxies[s]=null}this.movedProxies=t}this.movedProxies[this.numMovedProxies++]=a}return a}destroyProxy(t){this._numProxies--;let i=t._prev,s=t._next;null!=i&&(i._next=s),null!=s&&(s._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null;let a=t,o=this._tree,n=a._leaf;o._numLeaves--;let e=n._prevLeaf,r=n._nextLeaf;if(null!=e&&(e._nextLeaf=r),null!=r&&(r._prevLeaf=e),n==o.leafList&&(o.leafList=o.leafList._nextLeaf),n==o.leafListLast&&(o.leafListLast=o.leafListLast._prevLeaf),n._nextLeaf=null,n._prevLeaf=null,o._root==n)o._root=null;else{let t=n._parent,i=t._children[1^n._childIndex],s=t._parent;if(null==s)i._parent=null,i._childIndex=0,o._root=i,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=o._nodePool,o._nodePool=t;else{i._parent=s;let a=t._childIndex;s._children[a]=i,i._parent=s,i._childIndex=a,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=o._nodePool,o._nodePool=t;let n=s;for(;null!=n;){if(o._strategy._balancingEnabled&&n._height>=2){let t=n._parent,i=n._children[0],s=n._children[1],a=i._height-s._height,e=n._childIndex;if(a>1){let s=i._children[0],a=i._children[1];if(s._height>a._height){i._children[1]=n,n._parent=i,n._childIndex=1,n._children[0]=a,a._parent=n,a._childIndex=0;let t=i._children[0],s=i._children[1];i._aabbMinX=t._aabbMinX<s._aabbMinX?t._aabbMinX:s._aabbMinX,i._aabbMinY=t._aabbMinY<s._aabbMinY?t._aabbMinY:s._aabbMinY,i._aabbMinZ=t._aabbMinZ<s._aabbMinZ?t._aabbMinZ:s._aabbMinZ,i._aabbMaxX=t._aabbMaxX>s._aabbMaxX?t._aabbMaxX:s._aabbMaxX,i._aabbMaxY=t._aabbMaxY>s._aabbMaxY?t._aabbMaxY:s._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>s._aabbMaxZ?t._aabbMaxZ:s._aabbMaxZ;let o=i._children[0]._height,e=i._children[1]._height;i._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}else{i._children[0]=n,n._parent=i,n._childIndex=0,n._children[0]=s,s._parent=n,s._childIndex=0;let t=i._children[0],a=i._children[1];i._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,i._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,i._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,i._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,i._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let o=i._children[0]._height,e=i._children[1]._height;i._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}null!=t?(t._children[e]=i,i._parent=t,i._childIndex=e):(o._root=i,i._parent=null),n=i}else if(a<-1){let i=s._children[0],a=s._children[1];if(i._height>a._height){s._children[1]=n,n._parent=s,n._childIndex=1,n._children[1]=a,a._parent=n,a._childIndex=1;let t=s._children[0],i=s._children[1];s._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,s._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,s._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,s._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,s._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let o=s._children[0]._height,e=s._children[1]._height;s._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}else{s._children[0]=n,n._parent=s,n._childIndex=0,n._children[1]=i,i._parent=n,i._childIndex=1;let t=s._children[0],a=s._children[1];s._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,s._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,s._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,s._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,s._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let o=s._children[0]._height,e=s._children[1]._height;s._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}null!=t?(t._children[e]=s,s._parent=t,s._childIndex=e):(o._root=s,s._parent=null),n=s}}let t=n._children[0]._height,i=n._children[1]._height;n._height=(t>i?t:i)+1;let s=n._children[0],a=n._children[1];n._aabbMinX=s._aabbMinX<a._aabbMinX?s._aabbMinX:a._aabbMinX,n._aabbMinY=s._aabbMinY<a._aabbMinY?s._aabbMinY:a._aabbMinY,n._aabbMinZ=s._aabbMinZ<a._aabbMinZ?s._aabbMinZ:a._aabbMinZ,n._aabbMaxX=s._aabbMaxX>a._aabbMaxX?s._aabbMaxX:a._aabbMaxX,n._aabbMaxY=s._aabbMaxY>a._aabbMaxY?s._aabbMaxY:a._aabbMaxY,n._aabbMaxZ=s._aabbMaxZ>a._aabbMaxZ?s._aabbMaxZ:a._aabbMaxZ,n=n._parent}}}a._leaf=null,n._next=null,n._childIndex=0,n._children[0]=null,n._children[1]=null,n._childIndex=0,n._parent=null,n._height=0,n._proxy=null,n._next=o._nodePool,o._nodePool=n,a.userData=null,a._next=null,a._prev=null,a._moved&&(a._moved=!1)}moveProxy(t,i,a){let o=t;if(o._aabbMinX<=i._minX&&o._aabbMaxX>=i._maxX&&o._aabbMinY<=i._minY&&o._aabbMaxY>=i._maxY&&o._aabbMinZ<=i._minZ&&o._aabbMaxZ>=i._maxZ)return;o._aabbMinX=i._minX,o._aabbMinY=i._minY,o._aabbMinZ=i._minZ,o._aabbMaxX=i._maxX,o._aabbMaxY=i._maxY,o._aabbMaxZ=i._maxZ;let n=s.common.Setting.bvhProxyPadding;if(o._aabbMinX-=n,o._aabbMinY-=n,o._aabbMinZ-=n,o._aabbMaxX+=n,o._aabbMaxY+=n,o._aabbMaxZ+=n,null!=a){let t,i,s,n,e,r,_,l,h,c,m,b;n=0,e=0,r=0,t=a.x,i=a.y,s=a.z,_=n<t?n:t,l=e<i?e:i,h=r<s?r:s,c=n>t?n:t,m=e>i?e:i,b=r>s?r:s,o._aabbMinX+=_,o._aabbMinY+=l,o._aabbMinZ+=h,o._aabbMaxX+=c,o._aabbMaxY+=m,o._aabbMaxZ+=b}if(!o._moved){if(o._moved=!0,this.movedProxies.length==this.numMovedProxies){let t=new Array(this.numMovedProxies<<1),i=0,s=this.numMovedProxies;for(;i<s;){let s=i++;t[s]=this.movedProxies[s],this.movedProxies[s]=null}this.movedProxies=t}this.movedProxies[this.numMovedProxies++]=o}}collectPairs(){let t=this._proxyPairList;if(null!=t){for(;t._p1=null,t._p2=null,t=t._next,null!=t;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}if(this._testCount=0,this._numProxies<2)return;let i=this.numMovedProxies/this._numProxies<s.common.Setting.bvhIncrementalCollisionThreshold,a=0,o=this.numMovedProxies;for(;a<o;){let t=a++,o=this.movedProxies[t];if(o._moved){let t=this._tree,a=o._leaf;t._numLeaves--;let n=a._prevLeaf,e=a._nextLeaf;if(null!=n&&(n._nextLeaf=e),null!=e&&(e._prevLeaf=n),a==t.leafList&&(t.leafList=t.leafList._nextLeaf),a==t.leafListLast&&(t.leafListLast=t.leafListLast._prevLeaf),a._nextLeaf=null,a._prevLeaf=null,t._root==a)t._root=null;else{let i=a._parent,s=i._children[1^a._childIndex],o=i._parent;if(null==o)s._parent=null,s._childIndex=0,t._root=s,i._next=null,i._childIndex=0,i._children[0]=null,i._children[1]=null,i._childIndex=0,i._parent=null,i._height=0,i._proxy=null,i._next=t._nodePool,t._nodePool=i;else{s._parent=o;let a=i._childIndex;o._children[a]=s,s._parent=o,s._childIndex=a,i._next=null,i._childIndex=0,i._children[0]=null,i._children[1]=null,i._childIndex=0,i._parent=null,i._height=0,i._proxy=null,i._next=t._nodePool,t._nodePool=i;let n=o;for(;null!=n;){if(t._strategy._balancingEnabled&&n._height>=2){let i=n._parent,s=n._children[0],a=n._children[1],o=s._height-a._height,e=n._childIndex;if(o>1){let a=s._children[0],o=s._children[1];if(a._height>o._height){s._children[1]=n,n._parent=s,n._childIndex=1,n._children[0]=o,o._parent=n,o._childIndex=0;let t=s._children[0],i=s._children[1];s._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,s._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,s._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,s._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,s._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let a=s._children[0]._height,e=s._children[1]._height;s._height=(a>e?a:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}else{s._children[0]=n,n._parent=s,n._childIndex=0,n._children[0]=a,a._parent=n,a._childIndex=0;let t=s._children[0],i=s._children[1];s._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,s._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,s._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,s._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,s._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let o=s._children[0]._height,e=s._children[1]._height;s._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}null!=i?(i._children[e]=s,s._parent=i,s._childIndex=e):(t._root=s,s._parent=null),n=s}else if(o<-1){let s=a._children[0],o=a._children[1];if(s._height>o._height){a._children[1]=n,n._parent=a,n._childIndex=1,n._children[1]=o,o._parent=n,o._childIndex=1;let t=a._children[0],i=a._children[1];a._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,a._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,a._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,a._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,a._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,a._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let s=a._children[0]._height,e=a._children[1]._height;a._height=(s>e?s:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}else{a._children[0]=n,n._parent=a,n._childIndex=0,n._children[1]=s,s._parent=n,s._childIndex=1;let t=a._children[0],i=a._children[1];a._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,a._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,a._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,a._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,a._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,a._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let o=a._children[0]._height,e=a._children[1]._height;a._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}null!=i?(i._children[e]=a,a._parent=i,a._childIndex=e):(t._root=a,a._parent=null),n=a}}let i=n._children[0]._height,s=n._children[1]._height;n._height=(i>s?i:s)+1;let a=n._children[0],o=n._children[1];n._aabbMinX=a._aabbMinX<o._aabbMinX?a._aabbMinX:o._aabbMinX,n._aabbMinY=a._aabbMinY<o._aabbMinY?a._aabbMinY:o._aabbMinY,n._aabbMinZ=a._aabbMinZ<o._aabbMinZ?a._aabbMinZ:o._aabbMinZ,n._aabbMaxX=a._aabbMaxX>o._aabbMaxX?a._aabbMaxX:o._aabbMaxX,n._aabbMaxY=a._aabbMaxY>o._aabbMaxY?a._aabbMaxY:o._aabbMaxY,n._aabbMaxZ=a._aabbMaxZ>o._aabbMaxZ?a._aabbMaxZ:o._aabbMaxZ,n=n._parent}}}o._leaf=null,a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=t._nodePool,t._nodePool=a;let r=this._tree,_=r._nodePool;null!=_?(r._nodePool=_._next,_._next=null):_=new s.collision.broadphase.bvh.BvhNode;let l=_;if(l._proxy=o,o._leaf=l,l._aabbMinX=o._aabbMinX,l._aabbMinY=o._aabbMinY,l._aabbMinZ=o._aabbMinZ,l._aabbMaxX=o._aabbMaxX,l._aabbMaxY=o._aabbMaxY,l._aabbMaxZ=o._aabbMaxZ,r._numLeaves++,null==r.leafList?(r.leafList=l,r.leafListLast=l):(r.leafListLast._nextLeaf=l,l._prevLeaf=r.leafListLast,r.leafListLast=l),null==r._root)r._root=l;else{let t=r._root;for(;t._height>0;){let i=r._strategy._decideInsertion(t,l);if(-1==i)break;t=t._children[i]}let i=t._parent,a=r._nodePool;null!=a?(r._nodePool=a._next,a._next=null):a=new s.collision.broadphase.bvh.BvhNode;let o=a;if(null==i)r._root=o;else{let s=t._childIndex;i._children[s]=o,o._parent=i,o._childIndex=s}let n=t._childIndex;o._children[n]=t,t._parent=o,t._childIndex=n;let e=1^t._childIndex;for(o._children[e]=l,l._parent=o,l._childIndex=e;null!=o;){if(r._strategy._balancingEnabled&&o._height>=2){let t=o._parent,i=o._children[0],s=o._children[1],a=i._height-s._height,n=o._childIndex;if(a>1){let s=i._children[0],a=i._children[1];if(s._height>a._height){i._children[1]=o,o._parent=i,o._childIndex=1,o._children[0]=a,a._parent=o,a._childIndex=0;let t=i._children[0],s=i._children[1];i._aabbMinX=t._aabbMinX<s._aabbMinX?t._aabbMinX:s._aabbMinX,i._aabbMinY=t._aabbMinY<s._aabbMinY?t._aabbMinY:s._aabbMinY,i._aabbMinZ=t._aabbMinZ<s._aabbMinZ?t._aabbMinZ:s._aabbMinZ,i._aabbMaxX=t._aabbMaxX>s._aabbMaxX?t._aabbMaxX:s._aabbMaxX,i._aabbMaxY=t._aabbMaxY>s._aabbMaxY?t._aabbMaxY:s._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>s._aabbMaxZ?t._aabbMaxZ:s._aabbMaxZ;let n=i._children[0]._height,e=i._children[1]._height;i._height=(n>e?n:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=o._children[0]._height,h=o._children[1]._height;o._height=(l>h?l:h)+1}else{i._children[0]=o,o._parent=i,o._childIndex=0,o._children[0]=s,s._parent=o,s._childIndex=0;let t=i._children[0],a=i._children[1];i._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,i._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,i._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,i._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,i._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let n=i._children[0]._height,e=i._children[1]._height;i._height=(n>e?n:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=o._children[0]._height,h=o._children[1]._height;o._height=(l>h?l:h)+1}null!=t?(t._children[n]=i,i._parent=t,i._childIndex=n):(r._root=i,i._parent=null),o=i}else if(a<-1){let i=s._children[0],a=s._children[1];if(i._height>a._height){s._children[1]=o,o._parent=s,o._childIndex=1,o._children[1]=a,a._parent=o,a._childIndex=1;let t=s._children[0],i=s._children[1];s._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,s._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,s._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,s._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,s._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let n=s._children[0]._height,e=s._children[1]._height;s._height=(n>e?n:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=o._children[0]._height,h=o._children[1]._height;o._height=(l>h?l:h)+1}else{s._children[0]=o,o._parent=s,o._childIndex=0,o._children[1]=i,i._parent=o,i._childIndex=1;let t=s._children[0],a=s._children[1];s._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,s._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,s._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,s._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,s._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let n=s._children[0]._height,e=s._children[1]._height;s._height=(n>e?n:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=o._children[0]._height,h=o._children[1]._height;o._height=(l>h?l:h)+1}null!=t?(t._children[n]=s,s._parent=t,s._childIndex=n):(r._root=s,s._parent=null),o=s}}let t=o._children[0]._height,i=o._children[1]._height;o._height=(t>i?t:i)+1;let s=o._children[0],a=o._children[1];o._aabbMinX=s._aabbMinX<a._aabbMinX?s._aabbMinX:a._aabbMinX,o._aabbMinY=s._aabbMinY<a._aabbMinY?s._aabbMinY:a._aabbMinY,o._aabbMinZ=s._aabbMinZ<a._aabbMinZ?s._aabbMinZ:a._aabbMinZ,o._aabbMaxX=s._aabbMaxX>a._aabbMaxX?s._aabbMaxX:a._aabbMaxX,o._aabbMaxY=s._aabbMaxY>a._aabbMaxY?s._aabbMaxY:a._aabbMaxY,o._aabbMaxZ=s._aabbMaxZ>a._aabbMaxZ?s._aabbMaxZ:a._aabbMaxZ,o=o._parent}}i&&this.collide(this._tree._root,o._leaf),o._moved=!1}this.movedProxies[t]=null}i||this.collide(this._tree._root,this._tree._root),this.numMovedProxies=0}rayCast(t,i,s){if(null==this._tree._root)return;let a,o,n,e,r,_;a=t.x,o=t.y,n=t.z,e=i.x,r=i.y,_=i.z,this.rayCastRecursive(this._tree._root,a,o,n,e,r,_,s)}convexCast(t,i,s,a){null!=this._tree._root&&this.convexCastRecursive(this._tree._root,t,i,s,a)}aabbTest(t,i){null!=this._tree._root&&this.aabbTestRecursive(this._tree._root,t,i)}getTreeBalance(){return this._tree._getBalance()}},s.collision.broadphase.bvh.BvhInsertionStrategy=class{},s.collision.broadphase.bvh.BvhNode=class{constructor(){this._next=null,this._prevLeaf=null,this._nextLeaf=null,this._children=new Array(2),this._childIndex=0,this._parent=null,this._height=0,this._proxy=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}},s.collision.broadphase.bvh.BvhProxy=class extends s.collision.broadphase.Proxy{constructor(t,i){super(t,i),this._leaf=null,this._moved=!1}},s.collision.broadphase.bvh.BvhStrategy=class{constructor(){this._insertionStrategy=0,this._balancingEnabled=!1}_decideInsertion(t,i){switch(this._insertionStrategy){case 0:let s,a,o;s=i._aabbMinX+i._aabbMaxX,a=i._aabbMinY+i._aabbMaxY,o=i._aabbMinZ+i._aabbMaxZ;let n,e,r,_,l,h,c=t._children[0],m=t._children[1];return n=c._aabbMinX+c._aabbMaxX,e=c._aabbMinY+c._aabbMaxY,r=c._aabbMinZ+c._aabbMaxZ,_=m._aabbMinX+m._aabbMaxX,l=m._aabbMinY+m._aabbMaxY,h=m._aabbMinZ+m._aabbMaxZ,n-=s,e-=a,r-=o,_-=s,l-=a,h-=o,n*n+e*e+r*r<_*_+l*l+h*h?0:1;case 1:let b,p,x,f,u,y,v=t._children[0],d=t._children[1],g=t._aabbMaxY-t._aabbMinY,X=t._aabbMaxZ-t._aabbMinZ;b=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,p=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,x=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,f=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,u=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,y=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let Y,z,Z=u-p,M=y-x,I=2*((f-b)*(Z+M)+Z*M),V=2*I,L=2*(I-2*((t._aabbMaxX-t._aabbMinX)*(g+X)+g*X));if(b=v._aabbMinX<i._aabbMinX?v._aabbMinX:i._aabbMinX,p=v._aabbMinY<i._aabbMinY?v._aabbMinY:i._aabbMinY,x=v._aabbMinZ<i._aabbMinZ?v._aabbMinZ:i._aabbMinZ,f=v._aabbMaxX>i._aabbMaxX?v._aabbMaxX:i._aabbMaxX,u=v._aabbMaxY>i._aabbMaxY?v._aabbMaxY:i._aabbMaxY,y=v._aabbMaxZ>i._aabbMaxZ?v._aabbMaxZ:i._aabbMaxZ,0==v._height){let t=u-p,i=y-x;Y=L+2*((f-b)*(t+i)+t*i)}else{let t=u-p,i=y-x,s=v._aabbMaxY-v._aabbMinY,a=v._aabbMaxZ-v._aabbMinZ;Y=L+(2*((f-b)*(t+i)+t*i)-2*((v._aabbMaxX-v._aabbMinX)*(s+a)+s*a))}if(b=d._aabbMinX<i._aabbMinX?d._aabbMinX:i._aabbMinX,p=d._aabbMinY<i._aabbMinY?d._aabbMinY:i._aabbMinY,x=d._aabbMinZ<i._aabbMinZ?d._aabbMinZ:i._aabbMinZ,f=d._aabbMaxX>i._aabbMaxX?d._aabbMaxX:i._aabbMaxX,u=d._aabbMaxY>i._aabbMaxY?d._aabbMaxY:i._aabbMaxY,y=d._aabbMaxZ>i._aabbMaxZ?d._aabbMaxZ:i._aabbMaxZ,0==d._height){let t=u-p,i=y-x;z=L+2*((f-b)*(t+i)+t*i)}else{let t=u-p,i=y-x,s=d._aabbMaxY-d._aabbMinY,a=d._aabbMaxZ-d._aabbMinZ;z=L+(2*((f-b)*(t+i)+t*i)-2*((d._aabbMaxX-d._aabbMinX)*(s+a)+s*a))}return V<Y?V<z?-1:1:Y<z?0:1;default:return console.log("src/oimo/collision/broadphase/bvh/BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy),-1}}_splitLeaves(t,i,s){let a,o,n,e=1/(s-i);a=0,o=0,n=0;let r,_,l,h=i;for(;h<s;){let i=t[h++];i._tmpX=i._aabbMaxX+i._aabbMinX,i._tmpY=i._aabbMaxY+i._aabbMinY,i._tmpZ=i._aabbMaxZ+i._aabbMinZ,a+=i._tmpX,o+=i._tmpY,n+=i._tmpZ}a*=e,o*=e,n*=e,r=0,_=0,l=0;let c=i;for(;c<s;){let i,s,e,h=t[c++];i=h._tmpX-a,s=h._tmpY-o,e=h._tmpZ-n,i*=i,s*=s,e*=e,r+=i,_+=s,l+=e}let m=_,b=l,p=i,x=s-1;if(r>m)if(r>b){let i=a;for(;;){for(;!(t[p]._tmpX<=i);)++p;for(;!(t[x]._tmpX>=i);)--x;if(p>=x)break;let s=t[p];t[p]=t[x],t[x]=s,++p,--x}}else{let i=n;for(;;){for(;!(t[p]._tmpZ<=i);)++p;for(;!(t[x]._tmpZ>=i);)--x;if(p>=x)break;let s=t[p];t[p]=t[x],t[x]=s,++p,--x}}else if(m>b){let i=o;for(;;){for(;!(t[p]._tmpY<=i);)++p;for(;!(t[x]._tmpY>=i);)--x;if(p>=x)break;let s=t[p];t[p]=t[x],t[x]=s,++p,--x}}else{let i=n;for(;;){for(;!(t[p]._tmpZ<=i);)++p;for(;!(t[x]._tmpZ>=i);)--x;if(p>=x)break;let s=t[p];t[p]=t[x],t[x]=s,++p,--x}}return p}},s.collision.broadphase.bvh.BvhTree=class{constructor(){this._root=null,this._numLeaves=0,this._strategy=new s.collision.broadphase.bvh.BvhStrategy,this._nodePool=null,this.leafList=null,this.leafListLast=null,this.tmp=new Array(1024)}_print(t,i){if(null==i&&(i=""),null!=t)if(0==t._height)console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:39:",i+t._proxy._id);else{let s,a,o,n;this._print(t._children[0],i+"  "),a=t._aabbMaxX-t._aabbMinX,o=t._aabbMaxY-t._aabbMinY,n=t._aabbMaxZ-t._aabbMinZ;if(a*(o+n)+o*n>0){let i,a,o;i=t._aabbMaxX-t._aabbMinX,a=t._aabbMaxY-t._aabbMinY,o=t._aabbMaxZ-t._aabbMinZ;s=(1e3*(i*(a+o)+a*o)+.5|0)/1e3}else{let i,a,o;i=t._aabbMaxX-t._aabbMinX,a=t._aabbMaxY-t._aabbMinY,o=t._aabbMaxZ-t._aabbMinZ;s=(1e3*(i*(a+o)+a*o)-.5|0)/1e3}console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:42:",i+"#"+t._height+", "+s),this._print(t._children[1],i+"  ")}}_getBalance(){return this.getBalanceRecursive(this._root)}deleteRecursive(t){if(0==t._height){let i=t._prevLeaf,s=t._nextLeaf;return null!=i&&(i._nextLeaf=s),null!=s&&(s._prevLeaf=i),t==this.leafList&&(this.leafList=this.leafList._nextLeaf),t==this.leafListLast&&(this.leafListLast=this.leafListLast._prevLeaf),t._nextLeaf=null,t._prevLeaf=null,t._proxy._leaf=null,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,void(this._nodePool=t)}this.deleteRecursive(t._children[0]),this.deleteRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}decomposeRecursive(t){if(0==t._height)return t._childIndex=0,void(t._parent=null);this.decomposeRecursive(t._children[0]),this.decomposeRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}buildTopDownRecursive(t,i,a){if(a-i==1){let s=t[i],a=s._proxy;return s._aabbMinX=a._aabbMinX,s._aabbMinY=a._aabbMinY,s._aabbMinZ=a._aabbMinZ,s._aabbMaxX=a._aabbMaxX,s._aabbMaxY=a._aabbMaxY,s._aabbMaxZ=a._aabbMaxZ,s}let o=this._strategy._splitLeaves(t,i,a),n=this.buildTopDownRecursive(t,i,o),e=this.buildTopDownRecursive(t,o,a),r=this._nodePool;null!=r?(this._nodePool=r._next,r._next=null):r=new s.collision.broadphase.bvh.BvhNode;let _=r;_._children[0]=n,n._parent=_,n._childIndex=0,_._children[1]=e,e._parent=_,e._childIndex=1;let l=_._children[0],h=_._children[1];_._aabbMinX=l._aabbMinX<h._aabbMinX?l._aabbMinX:h._aabbMinX,_._aabbMinY=l._aabbMinY<h._aabbMinY?l._aabbMinY:h._aabbMinY,_._aabbMinZ=l._aabbMinZ<h._aabbMinZ?l._aabbMinZ:h._aabbMinZ,_._aabbMaxX=l._aabbMaxX>h._aabbMaxX?l._aabbMaxX:h._aabbMaxX,_._aabbMaxY=l._aabbMaxY>h._aabbMaxY?l._aabbMaxY:h._aabbMaxY,_._aabbMaxZ=l._aabbMaxZ>h._aabbMaxZ?l._aabbMaxZ:h._aabbMaxZ;let c=_._children[0]._height,m=_._children[1]._height;return _._height=(c>m?c:m)+1,_}getBalanceRecursive(t){if(null==t||0==t._height)return 0;let i=t._children[0]._height-t._children[1]._height;return i<0&&(i=-i),i+this.getBalanceRecursive(t._children[0])+this.getBalanceRecursive(t._children[1])}},s.collision.geometry.Aabb=class{constructor(){this._minX=0,this._minY=0,this._minZ=0,this._maxX=0,this._maxY=0,this._maxZ=0}init(t,i){return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this._maxX=i.x,this._maxY=i.y,this._maxZ=i.z,this}getMin(){let t=new s.common.Vec3;return t.x=this._minX,t.y=this._minY,t.z=this._minZ,t}getMinTo(t){t.x=this._minX,t.y=this._minY,t.z=this._minZ}setMin(t){return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this}getMax(){let t=new s.common.Vec3;return t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ,t}getMaxTo(t){t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ}setMax(t){return this._maxX=t.x,this._maxY=t.y,this._maxZ=t.z,this}getCenter(){let t,i,a,o=new s.common.Vec3;return t=this._minX+this._maxX,i=this._minY+this._maxY,a=this._minZ+this._maxZ,t*=.5,i*=.5,a*=.5,o.x=t,o.y=i,o.z=a,o}getCenterTo(t){let i,s,a;i=this._minX+this._maxX,s=this._minY+this._maxY,a=this._minZ+this._maxZ,i*=.5,s*=.5,a*=.5,t.x=i,t.y=s,t.z=a}getExtents(){let t,i,a,o=new s.common.Vec3;return t=this._maxX-this._minX,i=this._maxY-this._minY,a=this._maxZ-this._minZ,t*=.5,i*=.5,a*=.5,o.x=t,o.y=i,o.z=a,o}getExtentsTo(t){let i,s,a;i=this._maxX-this._minX,s=this._maxY-this._minY,a=this._maxZ-this._minZ,i*=.5,s*=.5,a*=.5,t.x=i,t.y=s,t.z=a}combine(t){return this._minX=this._minX<t._minX?this._minX:t._minX,this._minY=this._minY<t._minY?this._minY:t._minY,this._minZ=this._minZ<t._minZ?this._minZ:t._minZ,this._maxX=this._maxX>t._maxX?this._maxX:t._maxX,this._maxY=this._maxY>t._maxY?this._maxY:t._maxY,this._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,this}combined(t){let i=new s.collision.geometry.Aabb;return i._minX=this._minX<t._minX?this._minX:t._minX,i._minY=this._minY<t._minY?this._minY:t._minY,i._minZ=this._minZ<t._minZ?this._minZ:t._minZ,i._maxX=this._maxX>t._maxX?this._maxX:t._maxX,i._maxY=this._maxY>t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,i}overlap(t){return this._minX<t._maxX&&this._maxX>t._minX&&this._minY<t._maxY&&this._maxY>t._minY&&this._minZ<t._maxZ&&this._maxZ>t._minZ}getIntersection(t){let i=new s.collision.geometry.Aabb;return i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ,i}getIntersectionTo(t,i){i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ}copyFrom(t){return this._minX=t._minX,this._minY=t._minY,this._minZ=t._minZ,this._maxX=t._maxX,this._maxY=t._maxY,this._maxZ=t._maxZ,this}clone(){let t=new s.collision.geometry.Aabb;return t._minX=this._minX,t._minY=this._minY,t._minZ=this._minZ,t._maxX=this._maxX,t._maxY=this._maxY,t._maxZ=this._maxZ,t}},s.collision.geometry.BoxGeometry=class extends s.collision.geometry.ConvexGeometry{constructor(t){super(1),this._halfExtentsX=t.x,this._halfExtentsY=t.y,this._halfExtentsZ=t.z,this._halfAxisXX=t.x,this._halfAxisXY=0,this._halfAxisXZ=0,this._halfAxisYX=0,this._halfAxisYY=t.y,this._halfAxisYZ=0,this._halfAxisZX=0,this._halfAxisZY=0,this._halfAxisZZ=t.z,this._updateMass();let i=t.x<t.y?t.z<t.x?t.z:t.x:t.z<t.y?t.z:t.y;this._gjkMargin>.2*i&&(this._gjkMargin=.2*i)}getHalfExtents(){let t=new s.common.Vec3;return t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ,t}getHalfExtentsTo(t){t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ}_updateMass(){let t,i,s;this._volume=this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ*8,t=this._halfExtentsX*this._halfExtentsX,i=this._halfExtentsY*this._halfExtentsY,s=this._halfExtentsZ*this._halfExtentsZ,this._inertiaCoeff00=.3333333333333333*(i+s),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(s+t),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(t+i)}_computeAabb(t,i){let s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X;c=i._rotation00*this._halfAxisXX+i._rotation01*this._halfAxisXY+i._rotation02*this._halfAxisXZ,m=i._rotation10*this._halfAxisXX+i._rotation11*this._halfAxisXY+i._rotation12*this._halfAxisXZ,b=i._rotation20*this._halfAxisXX+i._rotation21*this._halfAxisXY+i._rotation22*this._halfAxisXZ,s=c,a=m,o=b,p=i._rotation00*this._halfAxisYX+i._rotation01*this._halfAxisYY+i._rotation02*this._halfAxisYZ,x=i._rotation10*this._halfAxisYX+i._rotation11*this._halfAxisYY+i._rotation12*this._halfAxisYZ,f=i._rotation20*this._halfAxisYX+i._rotation21*this._halfAxisYY+i._rotation22*this._halfAxisYZ,n=p,e=x,r=f,u=i._rotation00*this._halfAxisZX+i._rotation01*this._halfAxisZY+i._rotation02*this._halfAxisZZ,y=i._rotation10*this._halfAxisZX+i._rotation11*this._halfAxisZY+i._rotation12*this._halfAxisZZ,v=i._rotation20*this._halfAxisZX+i._rotation21*this._halfAxisZY+i._rotation22*this._halfAxisZZ,_=u,l=y,h=v,s<0&&(s=-s),a<0&&(a=-a),o<0&&(o=-o),n<0&&(n=-n),e<0&&(e=-e),r<0&&(r=-r),_<0&&(_=-_),l<0&&(l=-l),h<0&&(h=-h),d=s+n,g=a+e,X=o+r,d+=_,g+=l,X+=h,t._minX=i._positionX-d,t._minY=i._positionY-g,t._minZ=i._positionZ-X,t._maxX=i._positionX+d,t._maxY=i._positionY+g,t._maxZ=i._positionZ+X}computeLocalSupportingVertex(t,i){let s,a,o,n,e,r;s=this._gjkMargin,a=this._gjkMargin,o=this._gjkMargin,s<this._halfExtentsX||(s=this._halfExtentsX),a<this._halfExtentsY||(a=this._halfExtentsY),o<this._halfExtentsZ||(o=this._halfExtentsZ),n=this._halfExtentsX-s,e=this._halfExtentsY-a,r=this._halfExtentsZ-o,i.x=t.x>0?n:-n,i.y=t.y>0?e:-e,i.z=t.z>0?r:-r}_rayCastLocal(t,i,s,a,o,n,e){let r=this._halfExtentsX,_=this._halfExtentsY,l=this._halfExtentsZ,h=a-t,c=o-i,m=n-s,b=0,p=0,x=0,f=1,u=1,y=1;if(h>-1e-6&&h<1e-6){if(t<=-r||t>=r)return!1}else{let i=1/h,s=(-r-t)*i,a=(r-t)*i;if(s>a){let t=s;s=a,a=t}s>0&&(b=s),a<1&&(f=a)}if(c>-1e-6&&c<1e-6){if(i<=-_||i>=_)return!1}else{let t=1/c,s=(-_-i)*t,a=(_-i)*t;if(s>a){let t=s;s=a,a=t}s>0&&(p=s),a<1&&(u=a)}if(m>-1e-6&&m<1e-6){if(s<=-l||s>=l)return!1}else{let t=1/m,i=(-l-s)*t,a=(l-s)*t;if(i>a){let t=i;i=a,a=t}i>0&&(x=i),a<1&&(y=a)}if(b>=1||p>=1||x>=1||f<=0||u<=0||y<=0)return!1;let v=b,d=f,g=0;if(p>v&&(v=p,g=1),x>v&&(v=x,g=2),u<d&&(d=u),y<d&&(d=y),v>d)return!1;if(0==v)return!1;switch(g){case 0:e.normal.init(h>0?-1:1,0,0);break;case 1:e.normal.init(0,c>0?-1:1,0);break;case 2:e.normal.init(0,0,m>0?-1:1)}return e.position.init(t+v*h,i+v*c,s+v*m),e.fraction=v,!0}},s.collision.geometry.CapsuleGeometry=class extends s.collision.geometry.ConvexGeometry{constructor(t,i){super(4),this._radius=t,this._halfHeight=i,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,i=this._halfHeight*this._halfHeight,s=6.28318530717958*t*this._halfHeight,a=3.14159265358979*t*this._radius*4/3;this._volume=s+a;let o=0==this._volume?0:1/this._volume,n=o*(s*(.25*t+i/3)+a*(.4*t+this._halfHeight*this._radius*.75+i));this._inertiaCoeff00=n,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=o*(s*t*.5+a*t*.4),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=n}_computeAabb(t,i){let s,a,o,n,e,r;s=this._radius,a=this._radius,o=this._radius,n=i._rotation01,e=i._rotation11,r=i._rotation21,n<0&&(n=-n),e<0&&(e=-e),r<0&&(r=-r),n*=this._halfHeight,e*=this._halfHeight,r*=this._halfHeight,s+=n,a+=e,o+=r,t._minX=i._positionX-s,t._minY=i._positionY-a,t._minZ=i._positionZ-o,t._maxX=i._positionX+s,t._maxY=i._positionY+a,t._maxZ=i._positionZ+o}computeLocalSupportingVertex(t,i){t.y>0?i.init(0,this._halfHeight,0):i.init(0,-this._halfHeight,0)}_rayCastLocal(t,i,s,a,o,n,e){let r,_=this._halfHeight,l=a-t,h=n-s,c=0,m=l*l+h*h,b=t*l+s*h,p=t*t+s*s-this._radius*this._radius,x=b*b-m*p;if(x<0)return!1;if(m>0){let t=Math.sqrt(x);if(c=(-b-t)/m,r=(-b+t)/m,c>=1||r<=0)return!1}else{if(p>=0)return!1;c=0}let f,u,y,v,d,g,X,Y,z,Z,M=i+(o-i)*c;if(M>-_&&M<_){if(c>0){f=c;let i=e.normal.init(t+l*f,0,s+h*f),a=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z);return a>0&&(a=1/a),i.x*=a,i.y*=a,i.z*=a,e.position.init(t+f*l,M,s+f*h),e.fraction=f,!0}return!1}if(u=0,y=M<0?-_:_,v=0,d=t-0,g=i-y,X=s-0,Y=a-t,z=o-i,Z=n-s,m=Y*Y+z*z+Z*Z,b=d*Y+g*z+X*Z,p=d*d+g*g+X*X-this._radius*this._radius,x=b*b-m*p,x<0)return!1;let I,V,L,w,k,A,B=(-b-Math.sqrt(x))/m;if(B<0||B>1)return!1;I=d+Y*B,V=g+z*B,L=X+Z*B;let P=I*I+V*V+L*L;P>0&&(P=1/Math.sqrt(P)),w=I*P,k=V*P,A=L*P,I+=0,V+=y,L+=0;let S=e.position;S.x=I,S.y=V,S.z=L;let T=e.normal;return T.x=w,T.y=k,T.z=A,e.fraction=B,!0}},s.collision.geometry.ConeGeometry=class extends s.collision.geometry.ConvexGeometry{constructor(t,i){super(3),this._radius=t,this._halfHeight=i,this.sinTheta=t/Math.sqrt(t*t+4*i*i),this.cosTheta=2*i/Math.sqrt(t*t+4*i*i),this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2/3,this._inertiaCoeff00=.05*(3*t+2*i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.05*(3*t+2*i)}_computeAabb(t,i){let s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z;s=i._rotation01,a=i._rotation11,o=i._rotation21,n=s*s,e=a*a,r=o*o,c=Math.sqrt(1-n),m=Math.sqrt(1-e),b=Math.sqrt(1-r),c*=this._radius,m*=this._radius,b*=this._radius,_=s*this._halfHeight,l=a*this._halfHeight,h=o*this._halfHeight,p=-_,x=-l,f=-h,p-=c,x-=m,f-=b,u=-_,y=-l,v=-h,u+=c,y+=m,v+=b,d=p>u?p:u,g=x>y?x:y,X=f>v?f:v,d>_||(d=_),g>l||(g=l),X>h||(X=h),Y=p<u?p:u,z=x<y?x:y,Z=f<v?f:v,Y<_||(Y=_),z<l||(z=l),Z<h||(Z=h),t._minX=i._positionX+Y,t._minY=i._positionY+z,t._minZ=i._positionZ+Z,t._maxX=i._positionX+d,t._maxY=i._positionY+g,t._maxZ=i._positionZ+X}computeLocalSupportingVertex(t,i){let s=t.x,a=t.y,o=t.z;if(a>0&&a*a>this.sinTheta*this.sinTheta*(s*s+a*a+o*o))return i.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0),void(i.y<0&&(i.y=0));let n=t.x,e=t.z,r=n*n+e*e,_=2*this._halfHeight,l=(_-this._gjkMargin)/_*this._radius-this._gjkMargin/this.cosTheta;l<0&&(l=0);let h=r>0?l/Math.sqrt(r):0,c=this._halfHeight-this._gjkMargin;c<0&&(c=0),i.x=n*h,i.y=-c,i.z=e*h}_rayCastLocal(t,i,s,a,o,n,e){let r,_=this._halfHeight,l=a-t,h=o-i,c=n-s,m=0,b=1;if(h>-1e-6&&h<1e-6){if(i<=-_||i>=_)return!1}else{let t=1/h,s=(-_-i)*t,a=(_-i)*t;if(s>a){let t=s;s=a,a=t}s>0&&(m=s),a<1&&(b=a)}if(m>=1||b<=0)return!1;let p=0,x=0;r=i-_;let f,u=this.cosTheta*this.cosTheta,y=u*(l*l+h*h+c*c)-h*h,v=u*(t*l+r*h+s*c)-r*h,d=u*(t*t+r*r+s*s)-r*r,g=v*v-y*d;if(0!=y){if(g<0)return!1;let t=Math.sqrt(g);if(y<0){if(h>0){if(p=0,x=(-v+t)/y,x<=0)return!1}else if(p=(-v-t)/y,x=1,p>=1)return!1}else if(p=(-v-t)/y,x=(-v+t)/y,p>=1||x<=0)return!1}else{let t=-d/(2*v);if(v>0){if(p=0,x=t,t<=0)return!1}else if(p=t,x=1,t>=1)return!1}if(r+=_,x<=m||b<=p)return!1;if(p<m){if(f=m,0==f)return!1;e.normal.init(0,h>0?-1:1,0)}else{if(f=p,0==f)return!1;let i=e.normal.init(t+l*f,0,s+c*f),a=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z);a>0&&(a=1/a),i.x*=a,i.y*=a,i.z*=a;let o=this.cosTheta;i.x*=o,i.y*=o,i.z*=o,e.normal.y+=this.sinTheta}return e.position.init(t+f*l,r+f*h,s+f*c),e.fraction=f,!0}},s.collision.geometry.ConvexHullGeometry=class extends s.collision.geometry.ConvexGeometry{constructor(t){super(5),this._numVertices=t.length,this._vertices=new Array(this._numVertices),this._tmpVertices=new Array(this._numVertices);let i=0,a=this._numVertices;for(;i<a;){let a=i++;this._vertices[a]=t[a],this._tmpVertices[a]=new s.common.Vec3}this._useGjkRayCast=!0,this._updateMass()}getVertices(){return this._vertices}_updateMass(){this._volume=1,this._inertiaCoeff00=1,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=1,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=1;let t=this._vertices[0].x,i=this._vertices[0].y,s=this._vertices[0].z,a=this._vertices[0].x,o=this._vertices[0].y,n=this._vertices[0].z,e=1,r=this._numVertices;for(;e<r;){let r=e++,_=this._vertices[r].x,l=this._vertices[r].y,h=this._vertices[r].z;_<t?t=_:_>a&&(a=_),l<i?i=l:l>o&&(o=l),h<s?s=h:h>n&&(n=h)}let _=a-t,l=o-i,h=n-s;this._volume=_*l*h;let c=.25*((t+a)*(t+a)+(i+o)*(i+o)+(s+n)*(s+n));_=_*_*.25,l=l*l*.25,h=h*h*.25,this._inertiaCoeff00=.3333333333333333*(l+h)+c,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(h+_)+c,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(_+l)+c}_computeAabb(t,i){let s,a,o,n,e,r,_,l,h,c,m,b;_=this._gjkMargin,l=this._gjkMargin,h=this._gjkMargin;let p,x,f,u,y,v,d=this._vertices[0];c=d.x,m=d.y,b=d.z,u=i._rotation00*c+i._rotation01*m+i._rotation02*b,y=i._rotation10*c+i._rotation11*m+i._rotation12*b,v=i._rotation20*c+i._rotation21*m+i._rotation22*b,p=u,x=y,f=v,p+=i._positionX,x+=i._positionY,f+=i._positionZ,s=p,a=x,o=f,n=p,e=x,r=f;let g=1,X=this._numVertices;for(;g<X;){let t,_,l,h=this._vertices[g++];c=h.x,m=h.y,b=h.z,t=i._rotation00*c+i._rotation01*m+i._rotation02*b,_=i._rotation10*c+i._rotation11*m+i._rotation12*b,l=i._rotation20*c+i._rotation21*m+i._rotation22*b,p=t,x=_,f=l,p+=i._positionX,x+=i._positionY,f+=i._positionZ,s<p||(s=p),a<x||(a=x),o<f||(o=f),n>p||(n=p),e>x||(e=x),r>f||(r=f)}t._minX=s-_,t._minY=a-l,t._minZ=o-h,t._maxX=n+_,t._maxY=e+l,t._maxZ=r+h}computeLocalSupportingVertex(t,i){let s=this._vertices[0],a=s.x*t.x+s.y*t.y+s.z*t.z,o=0,n=1,e=this._numVertices;for(;n<e;){let i=n++,s=this._vertices[i],e=s.x*t.x+s.y*t.y+s.z*t.z;e>a&&(a=e,o=i)}let r=this._vertices[o];i.x=r.x,i.y=r.y,i.z=r.z}},s.collision.geometry.CylinderGeometry=class extends s.collision.geometry.ConvexGeometry{constructor(t,i){super(2),this._radius=t,this._halfHeight=i,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2,this._inertiaCoeff00=.08333333333333333*(3*t+i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.5*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*t+i)}_computeAabb(t,i){let s,a,o,n,e,r,_,l,h,c,m,b,p,x,f;s=i._rotation01,a=i._rotation11,o=i._rotation21,s<0&&(s=-s),a<0&&(a=-a),o<0&&(o=-o),n=s*s,e=a*a,r=o*o,c=Math.sqrt(1-n),m=Math.sqrt(1-e),b=Math.sqrt(1-r),c*=this._radius,m*=this._radius,b*=this._radius,_=s*this._halfHeight,l=a*this._halfHeight,h=o*this._halfHeight,p=c+_,x=m+l,f=b+h,t._minX=i._positionX-p,t._minY=i._positionY-x,t._minZ=i._positionZ-f,t._maxX=i._positionX+p,t._maxY=i._positionY+x,t._maxZ=i._positionZ+f}computeLocalSupportingVertex(t,i){let s=t.x,a=t.z,o=s*s+a*a,n=this._radius-this._gjkMargin;n<0&&(n=0);let e=o>0?n/Math.sqrt(o):0,r=this._halfHeight-this._gjkMargin;r<0&&(r=0),i.x=s*e,i.y=t.y>0?r:-r,i.z=a*e}_rayCastLocal(t,i,s,a,o,n,e){let r=this._halfHeight,_=a-t,l=o-i,h=n-s,c=0,m=1;if(l>-1e-6&&l<1e-6){if(i<=-r||i>=r)return!1}else{let t=1/l,s=(-r-i)*t,a=(r-i)*t;if(s>a){let t=s;s=a,a=t}s>0&&(c=s),a<1&&(m=a)}if(c>=1||m<=0)return!1;let b,p,x=0,f=_*_+h*h,u=t*_+s*h,y=t*t+s*s-this._radius*this._radius,v=u*u-f*y;if(v<0)return!1;if(f>0){let t=Math.sqrt(v);if(x=(-u-t)/f,b=(-u+t)/f,x>=1||b<=0)return!1}else{if(y>=0)return!1;x=0,b=1}if(b<=c||m<=x)return!1;if(x<c){if(p=c,0==p)return!1;e.normal.init(0,l>0?-1:1,0)}else{if(p=x,0==p)return!1;let i=e.normal.init(t+_*p,0,s+h*p),a=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z);a>0&&(a=1/a),i.x*=a,i.y*=a,i.z*=a}return e.position.init(t+p*_,i+p*l,s+p*h),e.fraction=p,!0}},s.collision.geometry.GeometryType=class{},s.collision.geometry.RayCastHit=class{constructor(){this.position=new s.common.Vec3,this.normal=new s.common.Vec3,this.fraction=0}},s.collision.geometry.SphereGeometry=class extends s.collision.geometry.ConvexGeometry{constructor(t){super(0),this._radius=t,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}_updateMass(){this._volume=4.188790204786386*this._radius*this._radius*this._radius,this._inertiaCoeff00=.4*this._radius*this._radius,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.4*this._radius*this._radius,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.4*this._radius*this._radius}_computeAabb(t,i){let s,a,o;s=this._radius,a=this._radius,o=this._radius,t._minX=i._positionX-s,t._minY=i._positionY-a,t._minZ=i._positionZ-o,t._maxX=i._positionX+s,t._maxY=i._positionY+a,t._maxZ=i._positionZ+o}computeLocalSupportingVertex(t,i){i.zero()}_rayCastLocal(t,i,s,a,o,n,e){let r,_,l;r=a-t,_=o-i,l=n-s;let h=r*r+_*_+l*l,c=t*r+i*_+s*l,m=c*c-h*(t*t+i*i+s*s-this._radius*this._radius);if(m<0)return!1;let b,p,x,f,u,y,v=(-c-Math.sqrt(m))/h;if(v<0||v>1)return!1;b=t+r*v,p=i+_*v,x=s+l*v;let d=b*b+p*p+x*x;d>0&&(d=1/Math.sqrt(d)),f=b*d,u=p*d,y=x*d;let g=e.position;g.x=b,g.y=p,g.z=x;let X=e.normal;return X.x=f,X.y=u,X.z=y,e.fraction=v,!0}},s.collision.narrowphase||(s.collision.narrowphase={}),s.collision.narrowphase.CollisionMatrix=class{constructor(){this.detectors=new Array(8),this.detectors[0]=new Array(8),this.detectors[1]=new Array(8),this.detectors[2]=new Array(8),this.detectors[3]=new Array(8),this.detectors[4]=new Array(8),this.detectors[5]=new Array(8);let t=new s.collision.narrowphase.detector.GjkEpaDetector;this.detectors[0][0]=new s.collision.narrowphase.detector.SphereSphereDetector,this.detectors[0][1]=new s.collision.narrowphase.detector.SphereBoxDetector(!1),this.detectors[0][2]=t,this.detectors[0][3]=t,this.detectors[0][4]=new s.collision.narrowphase.detector.SphereCapsuleDetector(!1),this.detectors[0][5]=t,this.detectors[1][0]=new s.collision.narrowphase.detector.SphereBoxDetector(!0),this.detectors[1][1]=new s.collision.narrowphase.detector.BoxBoxDetector,this.detectors[1][2]=t,this.detectors[1][3]=t,this.detectors[1][4]=t,this.detectors[1][5]=t,this.detectors[2][0]=t,this.detectors[2][1]=t,this.detectors[2][2]=t,this.detectors[2][3]=t,this.detectors[2][4]=t,this.detectors[2][5]=t,this.detectors[3][0]=t,this.detectors[3][1]=t,this.detectors[3][2]=t,this.detectors[3][3]=t,this.detectors[3][4]=t,this.detectors[3][5]=t,this.detectors[4][0]=new s.collision.narrowphase.detector.SphereCapsuleDetector(!0),this.detectors[4][1]=t,this.detectors[4][2]=t,this.detectors[4][3]=t,this.detectors[4][4]=new s.collision.narrowphase.detector.CapsuleCapsuleDetector,this.detectors[4][5]=t,this.detectors[5][0]=t,this.detectors[5][1]=t,this.detectors[5][2]=t,this.detectors[5][3]=t,this.detectors[5][4]=t,this.detectors[5][5]=t}getDetector(t,i){return this.detectors[t][i]}},s.collision.narrowphase.DetectorResult=class{constructor(){this.numPoints=0,this.normal=new s.common.Vec3,this.points=new Array(s.common.Setting.maxManifoldPoints),this.incremental=!1;let t=0,i=s.common.Setting.maxManifoldPoints;for(;t<i;)this.points[t++]=new s.collision.narrowphase.DetectorResultPoint}getMaxDepth(){let t=0,i=0,s=this.numPoints;for(;i<s;){let s=i++;this.points[s].depth>t&&(t=this.points[s].depth)}return t}clear(){this.numPoints=0;let t=0,i=this.points;for(;t<i.length;){let s=i[t];++t,s.position1.zero(),s.position2.zero(),s.depth=0,s.id=0}this.normal.zero()}},s.collision.narrowphase.DetectorResultPoint=class{constructor(){this.position1=new s.common.Vec3,this.position2=new s.common.Vec3,this.depth=0,this.id=0}},s.collision.narrowphase.detector||(s.collision.narrowphase.detector={}),s.collision.narrowphase.detector.Detector=class{constructor(t){this.swapped=t}setNormal(t,i,s,a){let o=t.normal;if(o.x=i,o.y=s,o.z=a,this.swapped){let i=t.normal;i.x=-i.x,i.y=-i.y,i.z=-i.z}}addPoint(t,i,s,a,o,n,e,r,_){let l=t.points[t.numPoints++];if(l.depth=r,l.id=_,this.swapped){let t=l.position1;t.x=o,t.y=n,t.z=e;let r=l.position2;r.x=i,r.y=s,r.z=a}else{let t=l.position1;t.x=i,t.y=s,t.z=a;let r=l.position2;r.x=o,r.y=n,r.z=e}}detectImpl(t,i,s,a,o,n){}detect(t,i,s,a,o,n){t.numPoints=0;let e=0,r=t.points;for(;e<r.length;){let t=r[e];++e,t.position1.zero(),t.position2.zero(),t.depth=0,t.id=0}t.normal.zero(),this.swapped?this.detectImpl(t,s,i,o,a,n):this.detectImpl(t,i,s,a,o,n)}},s.collision.narrowphase.detector.BoxBoxDetector=class extends s.collision.narrowphase.detector.Detector{constructor(){super(!1),this.clipper=new s.collision.narrowphase.detector._BoxBoxDetector.FaceClipper}detectImpl(t,i,a,o,n,e){let r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P=i,S=a;t.incremental=!1,r=o._positionX,_=o._positionY,l=o._positionZ,h=n._positionX,c=n._positionY,m=n._positionZ,b=h-r,p=c-_,x=m-l,f=o._rotation00,u=o._rotation10,y=o._rotation20,v=o._rotation01,d=o._rotation11,g=o._rotation21,X=o._rotation02,Y=o._rotation12,z=o._rotation22,Z=n._rotation00,M=n._rotation10,I=n._rotation20,V=n._rotation01,L=n._rotation11,w=n._rotation21,k=n._rotation02,A=n._rotation12,B=n._rotation22;let T,C,j,R,E,q,N,D,F,H,G,W,O,J,U,Q,K,$,tt=P._halfExtentsX,it=P._halfExtentsY,st=P._halfExtentsZ,at=S._halfExtentsX,ot=S._halfExtentsY,nt=S._halfExtentsZ;T=f*tt,C=u*tt,j=y*tt,R=v*it,E=d*it,q=g*it,N=X*st,D=Y*st,F=z*st,H=Z*at,G=M*at,W=I*at,O=V*ot,J=L*ot,U=w*ot,Q=k*nt,K=A*nt,$=B*nt;let et,rt,_t,lt=Infinity,ht=-1,ct=0;et=0,rt=0,_t=0;let mt=tt,bt=f*H+u*G+y*W,pt=f*O+u*J+y*U,xt=f*Q+u*K+y*$;bt<0&&(bt=-bt),pt<0&&(pt=-pt),xt<0&&(xt=-xt);let ft=bt+pt+xt,ut=f*b+u*p+y*x,yt=mt+ft,vt=ut<0,dt=vt?-ut:ut;if(!(dt<yt))return;{let t=yt-dt;t<Infinity&&(lt=t,ht=0,et=f,rt=u,_t=y,ct=vt?-1:1)}mt=it;let gt=v*H+d*G+g*W,Xt=v*O+d*J+g*U,Yt=v*Q+d*K+g*$;gt<0&&(gt=-gt),Xt<0&&(Xt=-Xt),Yt<0&&(Yt=-Yt),ft=gt+Xt+Yt,ut=v*b+d*p+g*x;let zt=mt+ft,Zt=ut<0,Mt=Zt?-ut:ut;if(!(Mt<zt))return;{let t=zt-Mt;t<lt&&(lt=t,ht=1,et=v,rt=d,_t=g,ct=Zt?-1:1)}mt=st;let It=X*H+Y*G+z*W,Vt=X*O+Y*J+z*U,Lt=X*Q+Y*K+z*$;It<0&&(It=-It),Vt<0&&(Vt=-Vt),Lt<0&&(Lt=-Lt),ft=It+Vt+Lt,ut=X*b+Y*p+z*x;let wt=mt+ft,kt=ut<0,At=kt?-ut:ut;if(!(At<wt))return;{let t=wt-At;t<lt&&(lt=t,ht=2,et=X,rt=Y,_t=z,ct=kt?-1:1)}lt>s.common.Setting.linearSlop?lt-=s.common.Setting.linearSlop:lt=0;let Bt=Z*T+M*C+I*j,Pt=Z*R+M*E+I*q,St=Z*N+M*D+I*F;Bt<0&&(Bt=-Bt),Pt<0&&(Pt=-Pt),St<0&&(St=-St),mt=Bt+Pt+St,ft=at,ut=Z*b+M*p+I*x;let Tt=mt+ft,Ct=ut<0,jt=Ct?-ut:ut;if(!(jt<Tt))return;{let t=Tt-jt;t<lt&&(lt=t,ht=3,et=Z,rt=M,_t=I,ct=Ct?-1:1)}let Rt=V*T+L*C+w*j,Et=V*R+L*E+w*q,qt=V*N+L*D+w*F;Rt<0&&(Rt=-Rt),Et<0&&(Et=-Et),qt<0&&(qt=-qt),mt=Rt+Et+qt,ft=ot,ut=V*b+L*p+w*x;let Nt=mt+ft,Dt=ut<0,Ft=Dt?-ut:ut;if(!(Ft<Nt))return;{let t=Nt-Ft;t<lt&&(lt=t,ht=4,et=V,rt=L,_t=w,ct=Dt?-1:1)}let Ht=k*T+A*C+B*j,Gt=k*R+A*E+B*q,Wt=k*N+A*D+B*F;Ht<0&&(Ht=-Ht),Gt<0&&(Gt=-Gt),Wt<0&&(Wt=-Wt),mt=Ht+Gt+Wt,ft=nt,ut=k*b+A*p+B*x;let Ot,Jt,Ut,Qt,Kt,$t,ti,ii,si,ai,oi,ni,ei,ri,_i,li,hi,ci,mi,bi,pi,xi=mt+ft,fi=ut<0,ui=fi?-ut:ut;if(!(ui<xi))return;{let t=xi-ui;t<lt&&(lt=t,ht=5,et=k,rt=A,_t=B,ct=fi?-1:1)}if(lt>s.common.Setting.linearSlop?lt-=s.common.Setting.linearSlop:lt=0,Ot=u*I-y*M,Jt=y*Z-f*I,Ut=f*M-u*Z,0!=Ot||0!=Jt||0!=Ut){let t=Ot*Ot+Jt*Jt+Ut*Ut;t>0&&(t=1/Math.sqrt(t)),Ot*=t,Jt*=t,Ut*=t;let i=Ot*R+Jt*E+Ut*q,s=Ot*N+Jt*D+Ut*F;i<0&&(i=-i),s<0&&(s=-s),mt=i+s;let a=Ot*O+Jt*J+Ut*U,o=Ot*Q+Jt*K+Ut*$;a<0&&(a=-a),o<0&&(o=-o),ft=a+o,ut=Ot*b+Jt*p+Ut*x;let n=mt+ft,e=ut<0,r=e?-ut:ut;if(!(r<n))return;{let t=n-r;t<lt&&(lt=t,ht=6,et=Ot,rt=Jt,_t=Ut,ct=e?-1:1)}}if(Ot=u*w-y*L,Jt=y*V-f*w,Ut=f*L-u*V,0!=Ot||0!=Jt||0!=Ut){let t=Ot*Ot+Jt*Jt+Ut*Ut;t>0&&(t=1/Math.sqrt(t)),Ot*=t,Jt*=t,Ut*=t;let i=Ot*R+Jt*E+Ut*q,s=Ot*N+Jt*D+Ut*F;i<0&&(i=-i),s<0&&(s=-s),mt=i+s;let a=Ot*H+Jt*G+Ut*W,o=Ot*Q+Jt*K+Ut*$;a<0&&(a=-a),o<0&&(o=-o),ft=a+o,ut=Ot*b+Jt*p+Ut*x;let n=mt+ft,e=ut<0,r=e?-ut:ut;if(!(r<n))return;{let t=n-r;t<lt&&(lt=t,ht=7,et=Ot,rt=Jt,_t=Ut,ct=e?-1:1)}}if(Ot=u*B-y*A,Jt=y*k-f*B,Ut=f*A-u*k,0!=Ot||0!=Jt||0!=Ut){let t=Ot*Ot+Jt*Jt+Ut*Ut;t>0&&(t=1/Math.sqrt(t)),Ot*=t,Jt*=t,Ut*=t;let i=Ot*R+Jt*E+Ut*q,s=Ot*N+Jt*D+Ut*F;i<0&&(i=-i),s<0&&(s=-s),mt=i+s;let a=Ot*H+Jt*G+Ut*W,o=Ot*O+Jt*J+Ut*U;a<0&&(a=-a),o<0&&(o=-o),ft=a+o,ut=Ot*b+Jt*p+Ut*x;let n=mt+ft,e=ut<0,r=e?-ut:ut;if(!(r<n))return;{let t=n-r;t<lt&&(lt=t,ht=8,et=Ot,rt=Jt,_t=Ut,ct=e?-1:1)}}if(Ot=d*I-g*M,Jt=g*Z-v*I,Ut=v*M-d*Z,0!=Ot||0!=Jt||0!=Ut){let t=Ot*Ot+Jt*Jt+Ut*Ut;t>0&&(t=1/Math.sqrt(t)),Ot*=t,Jt*=t,Ut*=t;let i=Ot*T+Jt*C+Ut*j,s=Ot*N+Jt*D+Ut*F;i<0&&(i=-i),s<0&&(s=-s),mt=i+s;let a=Ot*O+Jt*J+Ut*U,o=Ot*Q+Jt*K+Ut*$;a<0&&(a=-a),o<0&&(o=-o),ft=a+o,ut=Ot*b+Jt*p+Ut*x;let n=mt+ft,e=ut<0,r=e?-ut:ut;if(!(r<n))return;{let t=n-r;t<lt&&(lt=t,ht=9,et=Ot,rt=Jt,_t=Ut,ct=e?-1:1)}}if(Ot=d*w-g*L,Jt=g*V-v*w,Ut=v*L-d*V,0!=Ot||0!=Jt||0!=Ut){let t=Ot*Ot+Jt*Jt+Ut*Ut;t>0&&(t=1/Math.sqrt(t)),Ot*=t,Jt*=t,Ut*=t;let i=Ot*T+Jt*C+Ut*j,s=Ot*N+Jt*D+Ut*F;i<0&&(i=-i),s<0&&(s=-s),mt=i+s;let a=Ot*H+Jt*G+Ut*W,o=Ot*Q+Jt*K+Ut*$;a<0&&(a=-a),o<0&&(o=-o),ft=a+o,ut=Ot*b+Jt*p+Ut*x;let n=mt+ft,e=ut<0,r=e?-ut:ut;if(!(r<n))return;{let t=n-r;t<lt&&(lt=t,ht=10,et=Ot,rt=Jt,_t=Ut,ct=e?-1:1)}}if(Ot=d*B-g*A,Jt=g*k-v*B,Ut=v*A-d*k,0!=Ot||0!=Jt||0!=Ut){let t=Ot*Ot+Jt*Jt+Ut*Ut;t>0&&(t=1/Math.sqrt(t)),Ot*=t,Jt*=t,Ut*=t;let i=Ot*T+Jt*C+Ut*j,s=Ot*N+Jt*D+Ut*F;i<0&&(i=-i),s<0&&(s=-s),mt=i+s;let a=Ot*H+Jt*G+Ut*W,o=Ot*O+Jt*J+Ut*U;a<0&&(a=-a),o<0&&(o=-o),ft=a+o,ut=Ot*b+Jt*p+Ut*x;let n=mt+ft,e=ut<0,r=e?-ut:ut;if(!(r<n))return;{let t=n-r;t<lt&&(lt=t,ht=11,et=Ot,rt=Jt,_t=Ut,ct=e?-1:1)}}if(Ot=Y*I-z*M,Jt=z*Z-X*I,Ut=X*M-Y*Z,0!=Ot||0!=Jt||0!=Ut){let t=Ot*Ot+Jt*Jt+Ut*Ut;t>0&&(t=1/Math.sqrt(t)),Ot*=t,Jt*=t,Ut*=t;let i=Ot*T+Jt*C+Ut*j,s=Ot*R+Jt*E+Ut*q;i<0&&(i=-i),s<0&&(s=-s),mt=i+s;let a=Ot*O+Jt*J+Ut*U,o=Ot*Q+Jt*K+Ut*$;a<0&&(a=-a),o<0&&(o=-o),ft=a+o,ut=Ot*b+Jt*p+Ut*x;let n=mt+ft,e=ut<0,r=e?-ut:ut;if(!(r<n))return;{let t=n-r;t<lt&&(lt=t,ht=12,et=Ot,rt=Jt,_t=Ut,ct=e?-1:1)}}if(Ot=Y*w-z*L,Jt=z*V-X*w,Ut=X*L-Y*V,0!=Ot||0!=Jt||0!=Ut){let t=Ot*Ot+Jt*Jt+Ut*Ut;t>0&&(t=1/Math.sqrt(t)),Ot*=t,Jt*=t,Ut*=t;let i=Ot*T+Jt*C+Ut*j,s=Ot*R+Jt*E+Ut*q;i<0&&(i=-i),s<0&&(s=-s),mt=i+s;let a=Ot*H+Jt*G+Ut*W,o=Ot*Q+Jt*K+Ut*$;a<0&&(a=-a),o<0&&(o=-o),ft=a+o,ut=Ot*b+Jt*p+Ut*x;let n=mt+ft,e=ut<0,r=e?-ut:ut;if(!(r<n))return;{let t=n-r;t<lt&&(lt=t,ht=13,et=Ot,rt=Jt,_t=Ut,ct=e?-1:1)}}if(Ot=Y*B-z*A,Jt=z*k-X*B,Ut=X*A-Y*k,0!=Ot||0!=Jt||0!=Ut){let t=Ot*Ot+Jt*Jt+Ut*Ut;t>0&&(t=1/Math.sqrt(t)),Ot*=t,Jt*=t,Ut*=t;let i=Ot*T+Jt*C+Ut*j,s=Ot*R+Jt*E+Ut*q;i<0&&(i=-i),s<0&&(s=-s),mt=i+s;let a=Ot*H+Jt*G+Ut*W,o=Ot*O+Jt*J+Ut*U;a<0&&(a=-a),o<0&&(o=-o),ft=a+o,ut=Ot*b+Jt*p+Ut*x;let n=mt+ft,e=ut<0,r=e?-ut:ut;if(!(r<n))return;{let t=n-r;t<lt&&(lt=t,ht=14,et=Ot,rt=Jt,_t=Ut,ct=e?-1:1)}}if(ht>=6){et*=ct,rt*=ct,_t*=ct;let i,s,a,o,n,e,b,p,x,P,S,tt,it,st,at,ot=(ht-6)/3|0,nt=ht-6-3*ot;switch(ot){case 0:b=f,p=u,x=y;let t=N*et+D*rt+F*_t>0;R*et+E*rt+q*_t>0?t?(i=R+N,s=E+D,a=q+F):(i=R-N,s=E-D,a=q-F):t?(i=N-R,s=D-E,a=F-q):(i=R+N,s=E+D,a=q+F,i=-i,s=-s,a=-a);break;case 1:b=v,p=d,x=g;let o=N*et+D*rt+F*_t>0;T*et+C*rt+j*_t>0?o?(i=T+N,s=C+D,a=j+F):(i=T-N,s=C-D,a=j-F):o?(i=N-T,s=D-C,a=F-j):(i=T+N,s=C+D,a=j+F,i=-i,s=-s,a=-a);break;default:b=X,p=Y,x=z;let n=R*et+E*rt+q*_t>0;T*et+C*rt+j*_t>0?n?(i=T+R,s=C+E,a=j+q):(i=T-R,s=C-E,a=j-q):n?(i=R-T,s=E-C,a=q-j):(i=T+R,s=C+E,a=j+q,i=-i,s=-s,a=-a)}switch(i=r+i,s=_+s,a=l+a,nt){case 0:P=Z,S=M,tt=I;let t=Q*et+K*rt+$*_t>0;O*et+J*rt+U*_t>0?t?(o=O+Q,n=J+K,e=U+$):(o=O-Q,n=J-K,e=U-$):t?(o=Q-O,n=K-J,e=$-U):(o=O+Q,n=J+K,e=U+$,o=-o,n=-n,e=-e);break;case 1:P=V,S=L,tt=w;let i=Q*et+K*rt+$*_t>0;H*et+G*rt+W*_t>0?i?(o=H+Q,n=G+K,e=W+$):(o=H-Q,n=G-K,e=W-$):i?(o=Q-H,n=K-G,e=$-W):(o=H+Q,n=G+K,e=W+$,o=-o,n=-n,e=-e);break;default:P=k,S=A,tt=B;let s=O*et+J*rt+U*_t>0;H*et+G*rt+W*_t>0?s?(o=H+O,n=G+J,e=W+U):(o=H-O,n=G-J,e=W-U):s?(o=O-H,n=J-G,e=U-W):(o=H+O,n=G+J,e=W+U,o=-o,n=-n,e=-e)}o=h-o,n=c-n,e=m-e,it=i-o,st=s-n,at=a-e;let mt,bt,pt,xt,ft,ut,yt,vt,dt,gt=b*P+p*S+x*tt,Xt=b*it+p*st+x*at,Yt=P*it+S*st+tt*at,zt=1/(1-gt*gt),Zt=(gt*Yt-Xt)*zt,Mt=(Yt-gt*Xt)*zt;return mt=i+b*Zt,bt=s+p*Zt,pt=a+x*Zt,xt=o+P*Mt,ft=n+S*Mt,ut=e+tt*Mt,yt=-et,vt=-rt,dt=-_t,this.setNormal(t,yt,vt,dt),void this.addPoint(t,mt,bt,pt,xt,ft,ut,lt,4)}switch(ht>=3?(ct=-ct,b=-b,p=-p,x=-x,tt=at,it=ot,st=nt,r=h,_=c,l=m,Qt=f,Kt=u,$t=y,f=Z,u=M,y=I,Z=Qt,M=Kt,I=$t,Qt=v,Kt=d,$t=g,v=V,d=L,g=w,V=Qt,L=Kt,w=$t,Qt=X,Kt=Y,$t=z,X=k,Y=A,z=B,k=Qt,A=Kt,B=$t,Qt=T,Kt=C,$t=j,T=H,C=G,j=W,H=Qt,G=Kt,W=$t,Qt=R,Kt=E,$t=q,R=O,E=J,q=U,O=Qt,J=Kt,U=$t,Qt=N,Kt=D,$t=F,N=Q,D=K,F=$,Q=Qt,K=Kt,$=$t,ht-=3,ti=!0):ti=!1,ht){case 0:ii=T,si=C,ai=j,oi=f,ni=u,ei=y,ri=v,_i=d,li=g,hi=X,ci=Y,mi=z,bi=it,pi=st;break;case 1:ii=R,si=E,ai=q,oi=v,ni=d,ei=g,ri=X,_i=Y,li=z,hi=f,ci=u,mi=y,bi=st,pi=tt;break;default:ii=N,si=D,ai=F,oi=X,ni=Y,ei=z,ri=f,_i=u,li=y,hi=v,ci=d,mi=g,bi=tt,pi=it}if(ct<0){ii=-ii,si=-si,ai=-ai,oi=-oi,ni=-ni,ei=-ei,Qt=ri,Kt=_i,$t=li,ri=hi,_i=ci,li=mi,hi=Qt,ci=Kt,mi=$t;let t=bi;bi=pi,pi=t}ii+=r,si+=_,ai+=l;let yi,vi,di,gi,Xi,Yi,zi,Zi,Mi,Ii,Vi,Li,wi=1,ki=0,Ai=oi*Z+ni*M+ei*I;switch(Ai<wi&&(wi=Ai,ki=0),-Ai<wi&&(wi=-Ai,ki=1),Ai=oi*V+ni*L+ei*w,Ai<wi&&(wi=Ai,ki=2),-Ai<wi&&(wi=-Ai,ki=3),Ai=oi*k+ni*A+ei*B,Ai<wi&&(wi=Ai,ki=4),-Ai<wi&&(ki=5),ki){case 0:yi=H+O,vi=G+J,di=W+U,yi+=Q,vi+=K,di+=$,gi=H-O,Xi=G-J,Yi=W-U,gi+=Q,Xi+=K,Yi+=$,zi=H-O,Zi=G-J,Mi=W-U,zi-=Q,Zi-=K,Mi-=$,Ii=H+O,Vi=G+J,Li=W+U,Ii-=Q,Vi-=K,Li-=$;break;case 1:yi=O-H,vi=J-G,di=U-W,yi+=Q,vi+=K,di+=$,gi=O-H,Xi=J-G,Yi=U-W,gi-=Q,Xi-=K,Yi-=$,zi=H+O,Zi=G+J,Mi=W+U,zi=-zi,Zi=-Zi,Mi=-Mi,zi-=Q,Zi-=K,Mi-=$,Ii=H+O,Vi=G+J,Li=W+U,Ii=-Ii,Vi=-Vi,Li=-Li,Ii+=Q,Vi+=K,Li+=$;break;case 2:yi=H+O,vi=G+J,di=W+U,yi+=Q,vi+=K,di+=$,gi=H+O,Xi=G+J,Yi=W+U,gi-=Q,Xi-=K,Yi-=$,zi=O-H,Zi=J-G,Mi=U-W,zi-=Q,Zi-=K,Mi-=$,Ii=O-H,Vi=J-G,Li=U-W,Ii+=Q,Vi+=K,Li+=$;break;case 3:yi=H-O,vi=G-J,di=W-U,yi+=Q,vi+=K,di+=$,gi=H+O,Xi=G+J,Yi=W+U,gi=-gi,Xi=-Xi,Yi=-Yi,gi+=Q,Xi+=K,Yi+=$,zi=H+O,Zi=G+J,Mi=W+U,zi=-zi,Zi=-Zi,Mi=-Mi,zi-=Q,Zi-=K,Mi-=$,Ii=H-O,Vi=G-J,Li=W-U,Ii-=Q,Vi-=K,Li-=$;break;case 4:yi=H+O,vi=G+J,di=W+U,yi+=Q,vi+=K,di+=$,gi=O-H,Xi=J-G,Yi=U-W,gi+=Q,Xi+=K,Yi+=$,zi=H+O,Zi=G+J,Mi=W+U,zi=-zi,Zi=-Zi,Mi=-Mi,zi+=Q,Zi+=K,Mi+=$,Ii=H-O,Vi=G-J,Li=W-U,Ii+=Q,Vi+=K,Li+=$;break;default:yi=H+O,vi=G+J,di=W+U,yi-=Q,vi-=K,di-=$,gi=H-O,Xi=G-J,Yi=W-U,gi-=Q,Xi-=K,Yi-=$,zi=H+O,Zi=G+J,Mi=W+U,zi=-zi,Zi=-Zi,Mi=-Mi,zi-=Q,Zi-=K,Mi-=$,Ii=O-H,Vi=J-G,Li=U-W,Ii-=Q,Vi-=K,Li-=$}yi+=b,vi+=p,di+=x,gi+=b,Xi+=p,Yi+=x,zi+=b,Zi+=p,Mi+=x,Ii+=b,Vi+=p,Li+=x;let Bi=this.clipper;Bi.w=bi,Bi.h=pi,Bi.numVertices=0,Bi.numTmpVertices=0;let Pi=this.clipper,Si=Pi.vertices[Pi.numVertices++];Si.x=yi*ri+vi*_i+di*li,Si.y=yi*hi+vi*ci+di*mi,Si.wx=yi,Si.wy=vi,Si.wz=di;let Ti=this.clipper,Ci=Ti.vertices[Ti.numVertices++];Ci.x=gi*ri+Xi*_i+Yi*li,Ci.y=gi*hi+Xi*ci+Yi*mi,Ci.wx=gi,Ci.wy=Xi,Ci.wz=Yi;let ji=this.clipper,Ri=ji.vertices[ji.numVertices++];Ri.x=zi*ri+Zi*_i+Mi*li,Ri.y=zi*hi+Zi*ci+Mi*mi,Ri.wx=zi,Ri.wy=Zi,Ri.wz=Mi;let Ei,qi,Ni,Di=this.clipper,Fi=Di.vertices[Di.numVertices++];Fi.x=Ii*ri+Vi*_i+Li*li,Fi.y=Ii*hi+Vi*ci+Li*mi,Fi.wx=Ii,Fi.wy=Vi,Fi.wz=Li,this.clipper.clip(),this.clipper.reduce(),ti?(Ei=oi,qi=ni,Ni=ei):(Ei=-oi,qi=-ni,Ni=-ei),this.setNormal(t,Ei,qi,Ni);let Hi=0,Gi=this.clipper.numVertices;for(;Hi<Gi;){let i,a,o,n,e,h,c=Hi++,m=this.clipper.vertices[c];i=m.wx,a=m.wy,o=m.wz,i+=r,a+=_,o+=l,n=ii-i,e=si-a,h=ai-o;let b,p,x,f=n*oi+e*ni+h*ei;b=i+oi*f,p=a+ni*f,x=o+ei*f,f>-s.common.Setting.contactPersistenceThreshold&&(ti?this.addPoint(t,i,a,o,b,p,x,f,c):this.addPoint(t,b,p,x,i,a,o,f,c))}}},s.collision.narrowphase.detector._BoxBoxDetector||(s.collision.narrowphase.detector._BoxBoxDetector={}),s.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex=class{constructor(){this.x=0,this.y=0,this.wx=0,this.wy=0,this.wz=0}},s.collision.narrowphase.detector._BoxBoxDetector.FaceClipper=class{constructor(){this.w=0,this.h=0,this.numVertices=0,this.numTmpVertices=0,this.vertices=new Array(8),this.tmpVertices=new Array(8),this.vertices[0]=new s.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[0]=new s.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[1]=new s.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[1]=new s.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[2]=new s.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[2]=new s.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[3]=new s.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[3]=new s.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[4]=new s.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[4]=new s.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[5]=new s.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[5]=new s.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[6]=new s.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[6]=new s.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[7]=new s.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[7]=new s.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex}clip(){let t=0,i=this.numVertices;for(;t<i;){let i=t++,s=this.vertices[i],a=this.vertices[(i+1)%this.numVertices],o=this.w+s.x,n=this.w+a.x;if(o>0&&n>0){let t=this.tmpVertices[this.numTmpVertices++];t.x=s.x,t.y=s.y,t.wx=s.wx,t.wy=s.wy,t.wz=s.wz}else if(o>0&&n<=0){let t=this.tmpVertices[this.numTmpVertices++];t.x=s.x,t.y=s.y,t.wx=s.wx,t.wy=s.wy,t.wz=s.wz;let i=o/(o-n),e=this.tmpVertices[this.numTmpVertices++];e.x=s.x+(a.x-s.x)*i,e.y=s.y+(a.y-s.y)*i,e.wx=s.wx+(a.wx-s.wx)*i,e.wy=s.wy+(a.wy-s.wy)*i,e.wz=s.wz+(a.wz-s.wz)*i}else if(o<=0&&n>0){let t=o/(o-n),i=this.tmpVertices[this.numTmpVertices++];i.x=s.x+(a.x-s.x)*t,i.y=s.y+(a.y-s.y)*t,i.wx=s.wx+(a.wx-s.wx)*t,i.wy=s.wy+(a.wy-s.wy)*t,i.wz=s.wz+(a.wz-s.wz)*t}}let s=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=s,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let a=0,o=this.numVertices;for(;a<o;){let t=a++,i=this.vertices[t],s=this.vertices[(t+1)%this.numVertices],o=this.w-i.x,n=this.w-s.x;if(o>0&&n>0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz}else if(o>0&&n<=0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz;let a=o/(o-n),e=this.tmpVertices[this.numTmpVertices++];e.x=i.x+(s.x-i.x)*a,e.y=i.y+(s.y-i.y)*a,e.wx=i.wx+(s.wx-i.wx)*a,e.wy=i.wy+(s.wy-i.wy)*a,e.wz=i.wz+(s.wz-i.wz)*a}else if(o<=0&&n>0){let t=o/(o-n),a=this.tmpVertices[this.numTmpVertices++];a.x=i.x+(s.x-i.x)*t,a.y=i.y+(s.y-i.y)*t,a.wx=i.wx+(s.wx-i.wx)*t,a.wy=i.wy+(s.wy-i.wy)*t,a.wz=i.wz+(s.wz-i.wz)*t}}let n=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=n,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let e=0,r=this.numVertices;for(;e<r;){let t=e++,i=this.vertices[t],s=this.vertices[(t+1)%this.numVertices],a=this.h+i.y,o=this.h+s.y;if(a>0&&o>0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz}else if(a>0&&o<=0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz;let n=a/(a-o),e=this.tmpVertices[this.numTmpVertices++];e.x=i.x+(s.x-i.x)*n,e.y=i.y+(s.y-i.y)*n,e.wx=i.wx+(s.wx-i.wx)*n,e.wy=i.wy+(s.wy-i.wy)*n,e.wz=i.wz+(s.wz-i.wz)*n}else if(a<=0&&o>0){let t=a/(a-o),n=this.tmpVertices[this.numTmpVertices++];n.x=i.x+(s.x-i.x)*t,n.y=i.y+(s.y-i.y)*t,n.wx=i.wx+(s.wx-i.wx)*t,n.wy=i.wy+(s.wy-i.wy)*t,n.wz=i.wz+(s.wz-i.wz)*t}}let _=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=_,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let l=0,h=this.numVertices;for(;l<h;){let t=l++,i=this.vertices[t],s=this.vertices[(t+1)%this.numVertices],a=this.h-i.y,o=this.h-s.y;if(a>0&&o>0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz}else if(a>0&&o<=0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz;let n=a/(a-o),e=this.tmpVertices[this.numTmpVertices++];e.x=i.x+(s.x-i.x)*n,e.y=i.y+(s.y-i.y)*n,e.wx=i.wx+(s.wx-i.wx)*n,e.wy=i.wy+(s.wy-i.wy)*n,e.wz=i.wz+(s.wz-i.wz)*n}else if(a<=0&&o>0){let t=a/(a-o),n=this.tmpVertices[this.numTmpVertices++];n.x=i.x+(s.x-i.x)*t,n.y=i.y+(s.y-i.y)*t,n.wx=i.wx+(s.wx-i.wx)*t,n.wy=i.wy+(s.wy-i.wy)*t,n.wz=i.wz+(s.wz-i.wz)*t}}let c=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=c,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}reduce(){if(this.numVertices<4)return;let t=-Infinity,i=Infinity,s=-Infinity,a=Infinity,o=null,n=null,e=null,r=null,_=0,l=this.numVertices;for(;_<l;){let l=_++,h=this.vertices[l],c=1*h.x+1*h.y,m=-1*h.x+1*h.y;0==l?(t=c,o=h,i=c,n=h,s=m,e=h,a=m,r=h):(c>t&&(t=c,o=h),c<i&&(i=c,n=h),m>s&&(s=m,e=h),m<a&&(a=m,r=h))}let h=this.tmpVertices[this.numTmpVertices++];h.x=o.x,h.y=o.y,h.wx=o.wx,h.wy=o.wy,h.wz=o.wz;let c=this.tmpVertices[this.numTmpVertices++];c.x=e.x,c.y=e.y,c.wx=e.wx,c.wy=e.wy,c.wz=e.wz;let m=this.tmpVertices[this.numTmpVertices++];m.x=n.x,m.y=n.y,m.wx=n.wx,m.wy=n.wy,m.wz=n.wz;let b=this.tmpVertices[this.numTmpVertices++];b.x=r.x,b.y=r.y,b.wx=r.wx,b.wy=r.wy,b.wz=r.wz;let p=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=p,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}},s.collision.narrowphase.detector.BoxBoxDetectorMacro=class{},s.collision.narrowphase.detector.CachedDetectorData=class{constructor(){}_clear(){null!=this._gjkCache&&this._gjkCache.clear()}},s.collision.narrowphase.detector.CapsuleCapsuleDetector=class extends s.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,s,a,o,n){let e,r,_,l,h,c,m=i,b=s;t.incremental=!1,e=a._rotation01,r=a._rotation11,_=a._rotation21,l=o._rotation01,h=o._rotation11,c=o._rotation21;let p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S=m._halfHeight,T=b._halfHeight,C=m._radius,j=b._radius;p=a._positionX+e*-S,x=a._positionY+r*-S,f=a._positionZ+_*-S,u=a._positionX+e*S,y=a._positionY+r*S,v=a._positionZ+_*S,d=o._positionX+l*-T,g=o._positionY+h*-T,X=o._positionZ+c*-T,Y=o._positionX+l*T,z=o._positionY+h*T,Z=o._positionZ+c*T,M=p-d,I=x-g,V=f-X,L=u-p,w=y-x,k=v-f,A=Y-d,B=z-g,P=Z-X;let R,E,q,N,D,F,H,G,W,O,J,U=-(M*L+I*w+V*k),Q=M*A+I*B+V*P,K=S*S*4,$=L*A+w*B+k*P,tt=T*T*4;if(0==K&&0==tt)R=0,E=0;else if(0==K)R=0,E=Q<0?0:Q>tt?1:Q/tt;else if(0==tt)E=0,R=U<0?0:U>K?1:U/K;else{let t=K*tt-$*$;0==t?R=0:(R=$*Q+tt*U,R<0?R=0:R>t?R=1:R/=t),E=R*$+Q,E<0?(E=0,R=U<0?0:U>K?1:U/K):E>tt?(E=1,R=$+U,R<0?R=0:R>K?R=1:R/=K):E/=tt}q=p+L*R,N=x+w*R,D=f+k*R,F=d+A*E,H=g+B*E,G=X+P*E,W=q-F,O=N-H,J=D-G;let it=W*W+O*O+J*J;if(it>=(C+j)*(C+j))return;let st,at,ot,nt,et,rt,_t,lt,ht,ct=Math.sqrt(it);ct>0?(st=W*(1/ct),at=O*(1/ct),ot=J*(1/ct)):(st=1,at=0,ot=0),this.setNormal(t,st,at,ot),nt=q+st*-C,et=N+at*-C,rt=D+ot*-C,_t=F+st*j,lt=H+at*j,ht=G+ot*j,this.addPoint(t,nt,et,rt,_t,lt,ht,C+j-ct,0)}},s.collision.narrowphase.detector.GjkEpaDetector=class extends s.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,a,o,n,e){let r,_,l,h,c,m,b=s.collision.narrowphase.detector.gjkepa.GjkEpa.instance,p=i,x=a,f=b.computeClosestPointsImpl(p,x,o,n,s.common.Setting.enableGJKCaching?e:null,!0);if(t.incremental=!0,f!=s.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED)return void console.log("src/oimo/collision/narrowphase/detector/GjkEpaDetector.hx:28:","GJK/EPA failed: status="+f);if(b.distance>p._gjkMargin+x._gjkMargin)return;let u=b.closestPoint1;r=u.x,_=u.y,l=u.z;let y,v,d,g=b.closestPoint2;if(h=g.x,c=g.y,m=g.z,y=r-h,v=_-c,d=l-m,y*y+v*v+d*d==0)return;b.distance<0&&(y=-y,v=-v,d=-d);let X=y*y+v*v+d*d;X>0&&(X=1/Math.sqrt(X)),y*=X,v*=X,d*=X,this.setNormal(t,y,v,d),r+=y*-p._gjkMargin,_+=v*-p._gjkMargin,l+=d*-p._gjkMargin,h+=y*x._gjkMargin,c+=v*x._gjkMargin,m+=d*x._gjkMargin,this.addPoint(t,r,_,l,h,c,m,p._gjkMargin+x._gjkMargin-b.distance,0)}},s.collision.narrowphase.detector.SphereBoxDetector=class extends s.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,i,s,a,o,n){let e,r,_,l,h,c,m=s;t.incremental=!1,e=m._halfExtentsX,r=m._halfExtentsY,_=m._halfExtentsZ,l=-e,h=-r,c=-_;let b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V=i._radius;if(b=a._positionX-o._positionX,p=a._positionY-o._positionY,x=a._positionZ-o._positionZ,v=o._rotation00*b+o._rotation10*p+o._rotation20*x,d=o._rotation01*b+o._rotation11*p+o._rotation21*x,g=o._rotation02*b+o._rotation12*p+o._rotation22*x,f=v,u=d,y=g,l<f&&e>f&&h<u&&r>u&&c<y&&_>y){let i,s,n,l,h,c;i=f<0?-f:f,s=u<0?-u:u,n=y<0?-y:y,i=e-i,s=r-s,n=_-n;let m,b,p,x,v,d,g,X,Y,z,Z,M,I,L,w,k,A,B,P,S,T,C,j,R,E,q,N,D,F=i,H=s,G=n;return F<H?F<G?(f>0?(l=1,h=0,c=0):(l=-1,h=0,c=0),b=0,p=1,x=1,m=F):(y>0?(l=0,h=0,c=1):(l=0,h=0,c=-1),b=1,p=1,x=0,m=G):H<G?(u>0?(l=0,h=1,c=0):(l=0,h=-1,c=0),b=1,p=0,x=1,m=H):(y>0?(l=0,h=0,c=1):(l=0,h=0,c=-1),b=1,p=1,x=0,m=G),v=b*f,d=p*u,g=x*y,X=l*e,Y=h*r,z=c*_,X+=v,Y+=d,z+=g,A=o._rotation00*X+o._rotation01*Y+o._rotation02*z,B=o._rotation10*X+o._rotation11*Y+o._rotation12*z,P=o._rotation20*X+o._rotation21*Y+o._rotation22*z,Z=A,M=B,I=P,S=o._rotation00*l+o._rotation01*h+o._rotation02*c,T=o._rotation10*l+o._rotation11*h+o._rotation12*c,C=o._rotation20*l+o._rotation21*h+o._rotation22*c,L=S,w=T,k=C,this.setNormal(t,L,w,k),j=a._positionX+L*-V,R=a._positionY+w*-V,E=a._positionZ+k*-V,q=o._positionX+Z,N=o._positionY+M,D=o._positionZ+I,void this.addPoint(t,j,R,E,q,N,D,m,0)}e-=1e-9,r-=1e-9,_-=1e-9,l+=1e-9,h+=1e-9,c+=1e-9,X=f<e?f:e,Y=u<r?u:r,z=y<_?y:_,X>l||(X=l),Y>h||(Y=h),z>c||(z=c),Z=f-X,M=u-Y,I=y-z;let L,w,k,A,B,P,S,T,C,j,R,E,q,N,D,F=Z*Z+M*M+I*I;if(F>=V*V)return;F=Math.sqrt(F),S=o._rotation00*X+o._rotation01*Y+o._rotation02*z,T=o._rotation10*X+o._rotation11*Y+o._rotation12*z,C=o._rotation20*X+o._rotation21*Y+o._rotation22*z,L=S,w=T,k=C,j=o._rotation00*Z+o._rotation01*M+o._rotation02*I,R=o._rotation10*Z+o._rotation11*M+o._rotation12*I,E=o._rotation20*Z+o._rotation21*M+o._rotation22*I,A=j,B=R,P=E;let H,G,W,O,J,U,Q=A*A+B*B+P*P;Q>0&&(Q=1/Math.sqrt(Q)),q=A*Q,N=B*Q,D=P*Q,this.setNormal(t,q,N,D),H=a._positionX+q*-V,G=a._positionY+N*-V,W=a._positionZ+D*-V,O=o._positionX+L,J=o._positionY+w,U=o._positionZ+k,this.addPoint(t,H,G,W,O,J,U,V-F,0)}},s.collision.narrowphase.detector.SphereCapsuleDetector=class extends s.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,i,s,a,o,n){let e=s;t.incremental=!1;let r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z=e._halfHeight,M=i._radius,I=e._radius;r=o._rotation01,_=o._rotation11,l=o._rotation21,h=a._positionX,c=a._positionY,m=a._positionZ,b=o._positionX+r*-Z,p=o._positionY+_*-Z,x=o._positionZ+l*-Z,f=o._positionX+r*Z,u=o._positionY+_*Z,y=o._positionZ+l*Z,v=h-b,d=c-p,g=m-x,X=f-b,Y=u-p,z=y-x;let V,L,w,k,A,B,P=Z*Z*4,S=v*X+d*Y+g*z;S<0?S=0:S>P?S=1:S/=P,V=b+X*S,L=p+Y*S,w=x+z*S,k=h-V,A=c-L,B=m-w;let T=k*k+A*A+B*B;if(T>=(M+I)*(M+I))return;let C,j,R,E,q,N,D,F,H,G=Math.sqrt(T);G>0?(C=k*(1/G),j=A*(1/G),R=B*(1/G)):(C=1,j=0,R=0),this.setNormal(t,C,j,R),E=h+C*-M,q=c+j*-M,N=m+R*-M,D=V+C*I,F=L+j*I,H=w+R*I,this.addPoint(t,E,q,N,D,F,H,M+I-G,0)}},s.collision.narrowphase.detector.SphereSphereDetector=class extends s.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,s,a,o,n){let e,r,_;t.incremental=!1,e=a._positionX-o._positionX,r=a._positionY-o._positionY,_=a._positionZ-o._positionZ;let l=i._radius,h=s._radius,c=e*e+r*r+_*_;if(c>=(l+h)*(l+h))return;let m,b,p,x,f,u,y,v,d,g=Math.sqrt(c);g>0?(m=e*(1/g),b=r*(1/g),p=_*(1/g)):(m=1,b=0,p=0),this.setNormal(t,m,b,p),x=a._positionX+m*-l,f=a._positionY+b*-l,u=a._positionZ+p*-l,y=o._positionX+m*h,v=o._positionY+b*h,d=o._positionZ+p*h,this.addPoint(t,x,f,u,y,v,d,l+h-g,0)}},s.collision.narrowphase.detector.gjkepa||(s.collision.narrowphase.detector.gjkepa={}),s.collision.narrowphase.detector.gjkepa.EpaPolyhedron=class{constructor(){this._vertices=new Array(s.common.Setting.maxEPAVertices),this._center=new s.common.Vec3,this._numVertices=0,this._triangleList=null,this._triangleListLast=null,this._numTriangles=0,this._trianglePool=null,this._vertexPool=null}dumpHoleEdge(t){}validate(){let t=this._triangleList;for(;null!=t;){if(t._vertices[0]._tmpEdgeLoopOuterTriangle=null,t._vertices[0]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[0])return this._status=2,!1;if(null==t._adjacentTriangles[0])return this._status=3,!1;if(t._vertices[1]._tmpEdgeLoopOuterTriangle=null,t._vertices[1]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[1])return this._status=2,!1;if(null==t._adjacentTriangles[1])return this._status=3,!1;if(t._vertices[2]._tmpEdgeLoopOuterTriangle=null,t._vertices[2]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[2])return this._status=2,!1;if(null==t._adjacentTriangles[2])return this._status=3,!1;t=t._next}return!0}findEdgeLoop(t,i,s){if(i._tmpDfsId==t)return;i._tmpDfsId=t;let a=i.tmp;a.x=s.x,a.y=s.y,a.z=s.z;let o=i._vertices[0].v;a.x-=o.x,a.y-=o.y,a.z-=o.z;let n=i.tmp,e=i._normal;if(i._tmpDfsVisible=n.x*e.x+n.y*e.y+n.z*e.z>0,!i._tmpDfsVisible)return void(this._status=6);let r=0;for(;r<3;){let a=r++,o=i._adjacentTriangles[a];if(null==o)continue;let n=o.tmp;n.x=s.x,n.y=s.y,n.z=s.z;let e=o._vertices[0].v;n.x-=e.x,n.y-=e.y,n.z-=e.z;let _=o.tmp,l=o._normal;if(o._tmpDfsVisible=_.x*l.x+_.y*l.y+_.z*l.z>0,o._tmpDfsVisible)this.findEdgeLoop(t,o,s);else{let t=i._vertices[a];t._tmpEdgeLoopNext=i._vertices[i._nextIndex[a]],t._tmpEdgeLoopOuterTriangle=o}}let _=i._adjacentTriangles[0];if(null!=_){let t=i._adjacentPairIndex[0];_._adjacentTriangles[t]=null,_._adjacentPairIndex[t]=-1,i._adjacentTriangles[0]=null,i._adjacentPairIndex[0]=-1}let l=i._adjacentTriangles[1];if(null!=l){let t=i._adjacentPairIndex[1];l._adjacentTriangles[t]=null,l._adjacentPairIndex[t]=-1,i._adjacentTriangles[1]=null,i._adjacentPairIndex[1]=-1}let h=i._adjacentTriangles[2];if(null!=h){let t=i._adjacentPairIndex[2];h._adjacentTriangles[t]=null,h._adjacentPairIndex[t]=-1,i._adjacentTriangles[2]=null,i._adjacentPairIndex[2]=-1}this._numTriangles--;let c=i._prev,m=i._next;null!=c&&(c._next=m),null!=m&&(m._prev=c),i==this._triangleList&&(this._triangleList=this._triangleList._next),i==this._triangleListLast&&(this._triangleListLast=this._triangleListLast._prev),i._next=null,i._prev=null,i.removeReferences(),i._next=this._trianglePool,this._trianglePool=i}_init(t,i,a,o){this._status=0,this._numVertices=4,this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=a,this._vertices[3]=o;let n=this._center,e=t.v;n.x=e.x,n.y=e.y,n.z=e.z;let r=i.v;n.x+=r.x,n.y+=r.y,n.z+=r.z;let _=a.v;n.x+=_.x,n.y+=_.y,n.z+=_.z;let l=o.v;n.x+=l.x,n.y+=l.y,n.z+=l.z,n.x*=.25,n.y*=.25,n.z*=.25;let h=this._trianglePool;null!=h?(this._trianglePool=h._next,h._next=null):h=new s.collision.narrowphase.detector.gjkepa.EpaTriangle;let c=h,m=this._trianglePool;null!=m?(this._trianglePool=m._next,m._next=null):m=new s.collision.narrowphase.detector.gjkepa.EpaTriangle;let b=m,p=this._trianglePool;null!=p?(this._trianglePool=p._next,p._next=null):p=new s.collision.narrowphase.detector.gjkepa.EpaTriangle;let x=p,f=this._trianglePool;null!=f?(this._trianglePool=f._next,f._next=null):f=new s.collision.narrowphase.detector.gjkepa.EpaTriangle;let u=f;return c.init(t,i,a,this._center,!0)||(this._status=1),b.init(t,i,o,this._center,!0)||(this._status=1),x.init(t,a,o,this._center,!0)||(this._status=1),u.init(i,a,o,this._center,!0)||(this._status=1),c.setAdjacentTriangle(b)||(this._status=1),c.setAdjacentTriangle(x)||(this._status=1),c.setAdjacentTriangle(u)||(this._status=1),b.setAdjacentTriangle(x)||(this._status=1),b.setAdjacentTriangle(u)||(this._status=1),x.setAdjacentTriangle(u)||(this._status=1),this._numTriangles++,null==this._triangleList?(this._triangleList=c,this._triangleListLast=c):(this._triangleListLast._next=c,c._prev=this._triangleListLast,this._triangleListLast=c),this._numTriangles++,null==this._triangleList?(this._triangleList=b,this._triangleListLast=b):(this._triangleListLast._next=b,b._prev=this._triangleListLast,this._triangleListLast=b),this._numTriangles++,null==this._triangleList?(this._triangleList=x,this._triangleListLast=x):(this._triangleListLast._next=x,x._prev=this._triangleListLast,this._triangleListLast=x),this._numTriangles++,null==this._triangleList?(this._triangleList=u,this._triangleListLast=u):(this._triangleListLast._next=u,u._prev=this._triangleListLast,this._triangleListLast=u),0==this._status}_addVertex(t,i){this._vertices[this._numVertices++]=t;let a=i._vertices[0];if(this.findEdgeLoop(this._numVertices,i,t.v),0!=this._status)return!1;let o=a,n=null,e=null;for(;;){if(null==o._tmpEdgeLoopNext)return this._dumpAsObjModel(),this._status=4,!1;if(null==o._tmpEdgeLoopOuterTriangle)return this._status=5,!1;let i=this._trianglePool;null!=i?(this._trianglePool=i._next,i._next=null):i=new s.collision.narrowphase.detector.gjkepa.EpaTriangle;let r=i;if(null==e&&(e=r),r.init(o,o._tmpEdgeLoopNext,t,this._center,!1)||(this._status=1),0!=this._status)return!1;if(this._numTriangles++,null==this._triangleList?(this._triangleList=r,this._triangleListLast=r):(this._triangleListLast._next=r,r._prev=this._triangleListLast,this._triangleListLast=r),r.setAdjacentTriangle(o._tmpEdgeLoopOuterTriangle)||(this._status=1),null!=n&&(r.setAdjacentTriangle(n)||(this._status=1)),n=r,o=o._tmpEdgeLoopNext,o==a)break}return n.setAdjacentTriangle(e)||(this._status=1),0==this._status&&this.validate()}_dumpAsObjModel(){}},s.collision.narrowphase.detector.gjkepa.EpaPolyhedronState=class{},s.collision.narrowphase.detector.gjkepa.EpaTriangle=class{constructor(){this.id=++s.collision.narrowphase.detector.gjkepa.EpaTriangle.count,this._next=null,this._prev=null,this._normal=new s.common.Vec3,this._distanceSq=0,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._vertices=new Array(3),this._adjacentTriangles=new Array(3),this._adjacentPairIndex=new Array(3),this.tmp=new s.common.Vec3,this._nextIndex=new Array(3),this._nextIndex[0]=1,this._nextIndex[1]=2,this._nextIndex[2]=0}init(t,i,s,a,o){let n,e,r,_,l,h,c,m,b,p,x,f;null==o&&(o=!1);let u=t.v;n=u.x,e=u.y,r=u.z;let y=i.v;_=y.x,l=y.y,h=y.z;let v,d,g,X,Y,z,Z,M,I,V,L,w,k=s.v;c=k.x,m=k.y,b=k.z,p=a.x,x=a.y,f=a.z,v=_-n,d=l-e,g=h-r,X=c-n,Y=m-e,z=b-r,Z=n-p,M=e-x,I=r-f,V=d*z-g*Y,L=g*X-v*z,w=v*Y-d*X;let A=!1;if(Z*V+M*L+I*w<0)if(o){let t=i;i=s,s=t,V*=-1,L*=-1,w*=-1}else A=!0;this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=s;let B=this._normal;B.x=V,B.y=L,B.z=w;let P,S,T,C,j,R,E,q,N,D,F,H,G,W,O,J,U,Q,K,$,tt,it,st,at,ot,nt,et,rt,_t,lt,ht=t.v,ct=i.v,mt=s.v,bt=this.tmp;P=ht.x,S=ht.y,T=ht.z,C=ct.x,j=ct.y,R=ct.z,E=mt.x,q=mt.y,N=mt.z,D=C-P,F=j-S,H=R-T,G=E-C,W=q-j,O=N-R,J=P-E,U=S-q,Q=T-N,K=F*O-H*W,$=H*G-D*O,tt=D*W-F*G,it=F*tt-H*$,st=H*K-D*tt,at=D*$-F*K,ot=W*tt-O*$,nt=O*K-G*tt,et=G*$-W*K,rt=U*tt-Q*$,_t=Q*K-J*tt,lt=J*$-U*K;let pt,xt,ft,ut=-1;if(pt=0,xt=0,ft=0,P*it+S*st+T*at<0){let t,i,s,a,o,n,e,r,_;t=ht.x,i=ht.y,s=ht.z,a=ct.x,o=ct.y,n=ct.z,e=a-t,r=o-i,_=n-s;let l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)bt.x=t,bt.y=i,bt.z=s;else if(l>1)bt.x=a,bt.y=o,bt.z=n;else{let a,o,n;a=t+e*l,o=i+r*l,n=s+_*l,bt.x=a,bt.y=o,bt.z=n}ut=bt.x*bt.x+bt.y*bt.y+bt.z*bt.z,pt=bt.x,xt=bt.y,ft=bt.z}if(C*ot+j*nt+R*et<0){let t,i,s,a,o,n,e,r,_;t=ct.x,i=ct.y,s=ct.z,a=mt.x,o=mt.y,n=mt.z,e=a-t,r=o-i,_=n-s;let l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)bt.x=t,bt.y=i,bt.z=s;else if(l>1)bt.x=a,bt.y=o,bt.z=n;else{let a,o,n;a=t+e*l,o=i+r*l,n=s+_*l,bt.x=a,bt.y=o,bt.z=n}let h=bt.x*bt.x+bt.y*bt.y+bt.z*bt.z;(ut<0||h<ut)&&(ut=h,pt=bt.x,xt=bt.y,ft=bt.z)}if(E*rt+q*_t+N*lt<0){let t,i,s,a,o,n,e,r,_;t=ht.x,i=ht.y,s=ht.z,a=mt.x,o=mt.y,n=mt.z,e=a-t,r=o-i,_=n-s;let l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)bt.x=t,bt.y=i,bt.z=s;else if(l>1)bt.x=a,bt.y=o,bt.z=n;else{let a,o,n;a=t+e*l,o=i+r*l,n=s+_*l,bt.x=a,bt.y=o,bt.z=n}let h=bt.x*bt.x+bt.y*bt.y+bt.z*bt.z;(ut<0||h<ut)&&(ut=h,pt=bt.x,xt=bt.y,ft=bt.z)}if(ut>0)bt.x=pt,bt.y=xt,bt.z=ft;else{let t=K*K+$*$+tt*tt;t>0&&(t=1/Math.sqrt(t)),K*=t,$*=t,tt*=t;let i=K*K+$*$+tt*tt;i=(P*K+S*$+T*tt)/i,pt=K*i,xt=$*i,ft=tt*i,bt.x=pt,bt.y=xt,bt.z=ft}let yt=this.tmp;return this._distanceSq=yt.x*yt.x+yt.y*yt.y+yt.z*yt.z,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=-1,this._adjacentPairIndex[1]=-1,this._adjacentPairIndex[2]=-1,!A}setAdjacentTriangle(t){let i=0;return this._vertices[0]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[0]]==t._vertices[0]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=0,i=1),this._vertices[0]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[0]]==t._vertices[1]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=0,++i),this._vertices[0]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[0]]==t._vertices[2]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=0,++i),this._vertices[1]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[1]]==t._vertices[0]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=1,++i),this._vertices[1]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[1]]==t._vertices[1]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=1,++i),this._vertices[1]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[1]]==t._vertices[2]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=1,++i),this._vertices[2]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[2]]==t._vertices[0]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=2,++i),this._vertices[2]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[2]]==t._vertices[1]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=2,++i),this._vertices[2]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[2]]==t._vertices[2]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=2,++i),1==i}removeAdjacentTriangles(){let t=this._adjacentTriangles[0];if(null!=t){let i=this._adjacentPairIndex[0];t._adjacentTriangles[i]=null,t._adjacentPairIndex[i]=-1,this._adjacentTriangles[0]=null,this._adjacentPairIndex[0]=-1}let i=this._adjacentTriangles[1];if(null!=i){let t=this._adjacentPairIndex[1];i._adjacentTriangles[t]=null,i._adjacentPairIndex[t]=-1,this._adjacentTriangles[1]=null,this._adjacentPairIndex[1]=-1}let s=this._adjacentTriangles[2];if(null!=s){let t=this._adjacentPairIndex[2];s._adjacentTriangles[t]=null,s._adjacentPairIndex[t]=-1,this._adjacentTriangles[2]=null,this._adjacentPairIndex[2]=-1}}removeReferences(){this._next=null,this._prev=null,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._distanceSq=0,this._vertices[0]=null,this._vertices[1]=null,this._vertices[2]=null,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=0,this._adjacentPairIndex[1]=0,this._adjacentPairIndex[2]=0}dump(){}},s.collision.narrowphase.detector.gjkepa.EpaVertex=class{constructor(){this.randId=1e5*Math.random()|0,this.v=new s.common.Vec3,this.w1=new s.common.Vec3,this.w2=new s.common.Vec3}init(t,i,s){let a=this.v;a.x=t.x,a.y=t.y,a.z=t.z;let o=this.w1;o.x=i.x,o.y=i.y,o.z=i.z;let n=this.w2;return n.x=s.x,n.y=s.y,n.z=s.z,this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null,this}removeReferences(){this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null}},s.collision.narrowphase.detector.gjkepa.GjkCache=class{constructor(){this.prevClosestDir=new s.common.Vec3}clear(){this.prevClosestDir.zero()}},s.common||(s.common={}),s.common.Vec3=class{constructor(t,i,a){null==a&&(a=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.z=a,s.common.Vec3.numCreations++}init(t,i,s){return this.x=t,this.y=i,this.z=s,this}zero(){return this.x=0,this.y=0,this.z=0,this}add(t){return new s.common.Vec3(this.x+t.x,this.y+t.y,this.z+t.z)}add3(t,i,a){return new s.common.Vec3(this.x+t,this.y+i,this.z+a)}addScaled(t,i){return new s.common.Vec3(this.x+t.x*i,this.y+t.y*i,this.z+t.z*i)}sub(t){return new s.common.Vec3(this.x-t.x,this.y-t.y,this.z-t.z)}sub3(t,i,a){return new s.common.Vec3(this.x-t,this.y-i,this.z-a)}scale(t){return new s.common.Vec3(this.x*t,this.y*t,this.z*t)}scale3(t,i,a){return new s.common.Vec3(this.x*t,this.y*i,this.z*a)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new s.common.Vec3(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}addEq(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}add3Eq(t,i,s){return this.x+=t,this.y+=i,this.z+=s,this}addScaledEq(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}subEq(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}sub3Eq(t,i,s){return this.x-=t,this.y-=i,this.z-=s,this}scaleEq(t){return this.x*=t,this.y*=t,this.z*=t,this}scale3Eq(t,i,s){return this.x*=t,this.y*=i,this.z*=s,this}crossEq(t){let i=this.z*t.x-this.x*t.z,s=this.x*t.y-this.y*t.x;return this.x=this.y*t.z-this.z*t.y,this.y=i,this.z=s,this}mulMat3(t){return new s.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02,this.x*t.e10+this.y*t.e11+this.z*t.e12,this.x*t.e20+this.y*t.e21+this.z*t.e22)}mulMat4(t){return new s.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23)}mulTransform(t){let i,a,o,n,e,r;i=this.x,a=this.y,o=this.z,n=t._rotation00*i+t._rotation01*a+t._rotation02*o,e=t._rotation10*i+t._rotation11*a+t._rotation12*o,r=t._rotation20*i+t._rotation21*a+t._rotation22*o,i=n,a=e,o=r,i+=t._positionX,a+=t._positionY,o+=t._positionZ;let _=new s.common.Vec3;return _.x=i,_.y=a,_.z=o,_}mulMat3Eq(t){let i=this.x*t.e10+this.y*t.e11+this.z*t.e12,s=this.x*t.e20+this.y*t.e21+this.z*t.e22;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02,this.y=i,this.z=s,this}mulMat4Eq(t){let i=this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,s=this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.y=i,this.z=s,this}mulTransformEq(t){let i,s,a,o,n,e;return i=this.x,s=this.y,a=this.z,o=t._rotation00*i+t._rotation01*s+t._rotation02*a,n=t._rotation10*i+t._rotation11*s+t._rotation12*a,e=t._rotation20*i+t._rotation21*s+t._rotation22*a,i=o,s=n,a=e,i+=t._positionX,s+=t._positionY,a+=t._positionZ,this.x=i,this.y=s,this.z=a,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalized(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),new s.common.Vec3(this.x*t,this.y*t,this.z*t)}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this}negate(){return new s.common.Vec3(-this.x,-this.y,-this.z)}negateEq(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return new s.common.Vec3(this.x,this.y,this.z)}toString(){return"Vec3["+(this.x>0?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+", "+(this.y>0?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+", "+(this.z>0?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+"]"}},s.common.Transform=class{constructor(){this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1}identity(){return this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1,this}getPosition(){let t=new s.common.Vec3;return t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ,t}getPositionTo(t){t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ}setPosition(t){return this._positionX=t.x,this._positionY=t.y,this._positionZ=t.z,this}translate(t){let i,s,a;i=t.x,s=t.y,a=t.z,this._positionX+=i,this._positionY+=s,this._positionZ+=a}getRotation(){let t=new s.common.Mat3;return t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22,t}getRotationTo(t){t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22}setRotation(t){return this._rotation00=t.e00,this._rotation01=t.e01,this._rotation02=t.e02,this._rotation10=t.e10,this._rotation11=t.e11,this._rotation12=t.e12,this._rotation20=t.e20,this._rotation21=t.e21,this._rotation22=t.e22,this}setRotationXyz(t){let i,s,a;i=t.x,s=t.y,a=t.z;let o=Math.sin(i),n=Math.sin(s),e=Math.sin(a),r=Math.cos(i),_=Math.cos(s),l=Math.cos(a);this._rotation00=_*l,this._rotation01=-_*e,this._rotation02=n,this._rotation10=r*e+l*o*n,this._rotation11=r*l-o*n*e,this._rotation12=-_*o,this._rotation20=o*e-r*l*n,this._rotation21=l*o+r*n*e,this._rotation22=r*_}rotate(t){let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y;i=t.e00,s=t.e01,a=t.e02,o=t.e10,n=t.e11,e=t.e12,r=t.e20,_=t.e21,l=t.e22,h=i*this._rotation00+s*this._rotation10+a*this._rotation20,c=i*this._rotation01+s*this._rotation11+a*this._rotation21,m=i*this._rotation02+s*this._rotation12+a*this._rotation22,b=o*this._rotation00+n*this._rotation10+e*this._rotation20,p=o*this._rotation01+n*this._rotation11+e*this._rotation21,x=o*this._rotation02+n*this._rotation12+e*this._rotation22,f=r*this._rotation00+_*this._rotation10+l*this._rotation20,u=r*this._rotation01+_*this._rotation11+l*this._rotation21,y=r*this._rotation02+_*this._rotation12+l*this._rotation22,this._rotation00=h,this._rotation01=c,this._rotation02=m,this._rotation10=b,this._rotation11=p,this._rotation12=x,this._rotation20=f,this._rotation21=u,this._rotation22=y}rotateXyz(t){let i,s,a,o,n,e,r,_,l,h,c,m;i=t.x,s=t.y,a=t.z;let b,p,x,f,u,y,v,d,g,X=Math.sin(i),Y=Math.sin(s),z=Math.sin(a),Z=Math.cos(i),M=Math.cos(s),I=Math.cos(a);o=M*I,n=-M*z,e=Y,r=Z*z+I*X*Y,_=Z*I-X*Y*z,l=-M*X,h=X*z-Z*I*Y,c=I*X+Z*Y*z,m=Z*M,b=o*this._rotation00+n*this._rotation10+e*this._rotation20,p=o*this._rotation01+n*this._rotation11+e*this._rotation21,x=o*this._rotation02+n*this._rotation12+e*this._rotation22,f=r*this._rotation00+_*this._rotation10+l*this._rotation20,u=r*this._rotation01+_*this._rotation11+l*this._rotation21,y=r*this._rotation02+_*this._rotation12+l*this._rotation22,v=h*this._rotation00+c*this._rotation10+m*this._rotation20,d=h*this._rotation01+c*this._rotation11+m*this._rotation21,g=h*this._rotation02+c*this._rotation12+m*this._rotation22,this._rotation00=b,this._rotation01=p,this._rotation02=x,this._rotation10=f,this._rotation11=u,this._rotation12=y,this._rotation20=v,this._rotation21=d,this._rotation22=g}getOrientation(){let t,i,a,o,n,e=new s.common.Quat,r=this._rotation00,_=this._rotation11,l=this._rotation22,h=r+_+l;return h>0?(n=Math.sqrt(h+1),o=.5*n,n=.5/n,t=(this._rotation21-this._rotation12)*n,i=(this._rotation02-this._rotation20)*n,a=(this._rotation10-this._rotation01)*n):r>_?r>l?(n=Math.sqrt(r-_-l+1),t=.5*n,n=.5/n,i=(this._rotation01+this._rotation10)*n,a=(this._rotation02+this._rotation20)*n,o=(this._rotation21-this._rotation12)*n):(n=Math.sqrt(l-r-_+1),a=.5*n,n=.5/n,t=(this._rotation02+this._rotation20)*n,i=(this._rotation12+this._rotation21)*n,o=(this._rotation10-this._rotation01)*n):_>l?(n=Math.sqrt(_-l-r+1),i=.5*n,n=.5/n,t=(this._rotation01+this._rotation10)*n,a=(this._rotation12+this._rotation21)*n,o=(this._rotation02-this._rotation20)*n):(n=Math.sqrt(l-r-_+1),a=.5*n,n=.5/n,t=(this._rotation02+this._rotation20)*n,i=(this._rotation12+this._rotation21)*n,o=(this._rotation10-this._rotation01)*n),e.x=t,e.y=i,e.z=a,e.w=o,e}getOrientationTo(t){let i,s,a,o,n,e=this._rotation00,r=this._rotation11,_=this._rotation22,l=e+r+_;l>0?(n=Math.sqrt(l+1),o=.5*n,n=.5/n,i=(this._rotation21-this._rotation12)*n,s=(this._rotation02-this._rotation20)*n,a=(this._rotation10-this._rotation01)*n):e>r?e>_?(n=Math.sqrt(e-r-_+1),i=.5*n,n=.5/n,s=(this._rotation01+this._rotation10)*n,a=(this._rotation02+this._rotation20)*n,o=(this._rotation21-this._rotation12)*n):(n=Math.sqrt(_-e-r+1),a=.5*n,n=.5/n,i=(this._rotation02+this._rotation20)*n,s=(this._rotation12+this._rotation21)*n,o=(this._rotation10-this._rotation01)*n):r>_?(n=Math.sqrt(r-_-e+1),s=.5*n,n=.5/n,i=(this._rotation01+this._rotation10)*n,a=(this._rotation12+this._rotation21)*n,o=(this._rotation02-this._rotation20)*n):(n=Math.sqrt(_-e-r+1),a=.5*n,n=.5/n,i=(this._rotation02+this._rotation20)*n,s=(this._rotation12+this._rotation21)*n,o=(this._rotation10-this._rotation01)*n),t.x=i,t.y=s,t.z=a,t.w=o}setOrientation(t){let i,s,a,o;i=t.x,s=t.y,a=t.z,o=t.w;let n=2*i,e=2*s,r=2*a,_=i*n,l=s*e,h=a*r,c=i*e,m=s*r,b=i*r,p=o*n,x=o*e,f=o*r;return this._rotation00=1-l-h,this._rotation01=c-f,this._rotation02=b+x,this._rotation10=c+f,this._rotation11=1-_-h,this._rotation12=m-p,this._rotation20=b-x,this._rotation21=m+p,this._rotation22=1-_-l,this}clone(){let t=new s.common.Transform;return t._positionX=this._positionX,t._positionY=this._positionY,t._positionZ=this._positionZ,t._rotation00=this._rotation00,t._rotation01=this._rotation01,t._rotation02=this._rotation02,t._rotation10=this._rotation10,t._rotation11=this._rotation11,t._rotation12=this._rotation12,t._rotation20=this._rotation20,t._rotation21=this._rotation21,t._rotation22=this._rotation22,t}copyFrom(t){return this._positionX=t._positionX,this._positionY=t._positionY,this._positionZ=t._positionZ,this._rotation00=t._rotation00,this._rotation01=t._rotation01,this._rotation02=t._rotation02,this._rotation10=t._rotation10,this._rotation11=t._rotation11,this._rotation12=t._rotation12,this._rotation20=t._rotation20,this._rotation21=t._rotation21,this._rotation22=t._rotation22,this}},s.common.Setting=class{},s.collision.narrowphase.detector.gjkepa.GjkEpa=class{constructor(){this.s=new Array(4),this.w1=new Array(4),this.w2=new Array(4),this.baseDirs=new Array(3),this.baseDirs[0]=new s.common.Vec3(1,0,0),this.baseDirs[1]=new s.common.Vec3(0,1,0),this.baseDirs[2]=new s.common.Vec3(0,0,1),this.tl1=new s.common.Vec3,this.tl2=new s.common.Vec3,this.rayX=new s.common.Vec3,this.rayR=new s.common.Vec3,this.tempTransform=new s.common.Transform,this.s[0]=new s.common.Vec3,this.w1[0]=new s.common.Vec3,this.w2[0]=new s.common.Vec3,this.s[1]=new s.common.Vec3,this.w1[1]=new s.common.Vec3,this.w2[1]=new s.common.Vec3,this.s[2]=new s.common.Vec3,this.w1[2]=new s.common.Vec3,this.w2[2]=new s.common.Vec3,this.s[3]=new s.common.Vec3,this.w1[3]=new s.common.Vec3,this.w2[3]=new s.common.Vec3,this.dir=new s.common.Vec3,this.closest=new s.common.Vec3,this.closestPoint1=new s.common.Vec3,this.closestPoint2=new s.common.Vec3,this.polyhedron=new s.collision.narrowphase.detector.gjkepa.EpaPolyhedron}computeClosestPointsImpl(t,i,a,o,n,e){this.c1=t,this.c2=i,this.tf1=a,this.tf2=o;let r=this.s,_=this.w1,l=this.w2,h=this.closest,c=this.dir;if(null!=n?(null==n._gjkCache&&(n._gjkCache=new s.collision.narrowphase.detector.gjkepa.GjkCache),this.loadCache(n._gjkCache)):c.zero(),c.x*c.x+c.y*c.y+c.z*c.z==0){let t,i,s;t=o._positionX-a._positionX,i=o._positionY-a._positionY,s=o._positionZ-a._positionZ,c.x=t,c.y=i,c.z=s,c.x*c.x+c.y*c.y+c.z*c.z<1e-6&&c.init(1,0,0)}this.simplexSize=0,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let m=this.s[this.simplexSize],b=this.w1[this.simplexSize];m.x=b.x,m.y=b.y,m.z=b.z;let p=this.w2[this.simplexSize];m.x-=p.x,m.y-=p.y,m.z-=p.z,this.simplexSize=1;let x=0;for(;x<40;){let s=0;switch(this.simplexSize){case 1:let t=r[0];h.x=t.x,h.y=t.y,h.z=t.z,s=1;break;case 2:let i,a,o,n,e,_,l=r[0];i=l.x,a=l.y,o=l.z;let c,m,b,p=r[1];n=p.x,e=p.y,_=p.z,c=n-i,m=e-a,b=_-o;let x=c*i+m*a+b*o;if(x=-x/(c*c+m*m+b*b),x<0)h.x=i,h.y=a,h.z=o,s=1;else if(x>1)h.x=n,h.y=e,h.z=_,s=2;else{let t,n,e;t=i+c*x,n=a+m*x,e=o+b*x,h.x=t,h.y=n,h.z=e,s=3}break;case 3:let f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T,C,j,R,E,q,N,D,F,H,G=r[0],W=r[1],O=r[2];f=G.x,u=G.y,y=G.z,v=W.x,d=W.y,g=W.z,X=O.x,Y=O.y,z=O.z,Z=v-f,M=d-u,I=g-y,V=X-v,L=Y-d,w=z-g,k=f-X,A=u-Y,B=y-z,P=M*w-I*L,S=I*V-Z*w,T=Z*L-M*V,C=M*T-I*S,j=I*P-Z*T,R=Z*S-M*P,E=L*T-w*S,q=w*P-V*T,N=V*S-L*P,D=A*T-B*S,F=B*P-k*T,H=k*S-A*P;let J,U,Q,K=-1,$=0;if(J=0,U=0,Q=0,f*C+u*j+y*R<0){let t,i,s,a,o,n,e,r,_;t=G.x,i=G.y,s=G.z,a=W.x,o=W.y,n=W.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}$=l,K=h.x*h.x+h.y*h.y+h.z*h.z,J=h.x,U=h.y,Q=h.z}if(v*E+d*q+g*N<0){let t,i,s,a,o,n,e,r,_;t=W.x,i=W.y,s=W.z,a=O.x,o=O.y,n=O.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(K<0||m<K)&&($=l<<1,K=m,J=h.x,U=h.y,Q=h.z)}if(X*D+Y*F+z*H<0){let t,i,s,a,o,n,e,r,_;t=G.x,i=G.y,s=G.z,a=O.x,o=O.y,n=O.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(K<0||m<K)&&($=1&l|(2&l)<<1,K=m,J=h.x,U=h.y,Q=h.z)}if(K>0)h.x=J,h.y=U,h.z=Q,s=$;else{let t=P*P+S*S+T*T;t>0&&(t=1/Math.sqrt(t)),P*=t,S*=t,T*=t;let i=P*P+S*S+T*T;i=(f*P+u*S+y*T)/i,J=P*i,U=S*i,Q=T*i,h.x=J,h.y=U,h.z=Q,s=7}break;case 4:let tt,it,st,at,ot,nt,et,rt,_t,lt,ht,ct,mt,bt,pt,xt,ft,ut,yt,vt,dt,gt,Xt,Yt,zt,Zt,Mt,It,Vt,Lt,wt,kt,At,Bt,Pt,St,Tt,Ct,jt,Rt=r[0],Et=r[1],qt=r[2],Nt=r[3];tt=Rt.x,it=Rt.y,st=Rt.z,at=Et.x,ot=Et.y,nt=Et.z,et=qt.x,rt=qt.y,_t=qt.z,lt=Nt.x,ht=Nt.y,ct=Nt.z,mt=at-tt,bt=ot-it,pt=nt-st,xt=et-tt,ft=rt-it,ut=_t-st,yt=lt-tt,vt=ht-it,dt=ct-st,gt=et-at,Xt=rt-ot,Yt=_t-nt,zt=lt-at,Zt=ht-ot,Mt=ct-nt,It=bt*ut-pt*ft,Vt=pt*xt-mt*ut,Lt=mt*ft-bt*xt,wt=ft*dt-ut*vt,kt=ut*yt-xt*dt,At=xt*vt-ft*yt,Bt=vt*pt-dt*bt,Pt=dt*mt-yt*pt,St=yt*bt-vt*mt,Tt=Zt*Yt-Mt*Xt,Ct=Mt*gt-zt*Yt,jt=zt*Xt-Zt*gt;let Dt,Ft,Ht,Gt=mt*Tt+bt*Ct+pt*jt>0?1:-1,Wt=-1,Ot=0;if(Dt=0,Ft=0,Ht=0,(tt*It+it*Vt+st*Lt)*Gt<0){let t,i,s,a,o,n,e,r,_,l,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w;t=Rt.x,i=Rt.y,s=Rt.z,a=Et.x,o=Et.y,n=Et.z,e=qt.x,r=qt.y,_=qt.z,l=a-t,c=o-i,m=n-s,b=e-a,p=r-o,x=_-n,f=t-e,u=i-r,y=s-_,v=c*x-m*p,d=m*b-l*x,g=l*p-c*b,X=c*g-m*d,Y=m*v-l*g,z=l*d-c*v,Z=p*g-x*d,M=x*v-b*g,I=b*d-p*v,V=u*g-y*d,L=y*v-f*g,w=f*d-u*v;let k,A,B,P,S=-1,T=0;if(k=0,A=0,B=0,t*X+i*Y+s*z<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=Et.x,o=Et.y,n=Et.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}T=l,S=h.x*h.x+h.y*h.y+h.z*h.z,k=h.x,A=h.y,B=h.z}if(a*Z+o*M+n*I<0){let t,i,s,a,o,n,e,r,_;t=Et.x,i=Et.y,s=Et.z,a=qt.x,o=qt.y,n=qt.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(S<0||m<S)&&(T=l<<1,S=m,k=h.x,A=h.y,B=h.z)}if(e*V+r*L+_*w<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=qt.x,o=qt.y,n=qt.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=h.x,A=h.y,B=h.z)}if(S>0)h.x=k,h.y=A,h.z=B,P=T;else{let a=v*v+d*d+g*g;a>0&&(a=1/Math.sqrt(a)),v*=a,d*=a,g*=a;let o=v*v+d*d+g*g;o=(t*v+i*d+s*g)/o,k=v*o,A=d*o,B=g*o,h.x=k,h.y=A,h.z=B,P=7}Ot=P,Wt=h.x*h.x+h.y*h.y+h.z*h.z,Dt=h.x,Ft=h.y,Ht=h.z}if((tt*wt+it*kt+st*At)*Gt<0){let t,i,s,a,o,n,e,r,_,l,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w;t=Rt.x,i=Rt.y,s=Rt.z,a=qt.x,o=qt.y,n=qt.z,e=Nt.x,r=Nt.y,_=Nt.z,l=a-t,c=o-i,m=n-s,b=e-a,p=r-o,x=_-n,f=t-e,u=i-r,y=s-_,v=c*x-m*p,d=m*b-l*x,g=l*p-c*b,X=c*g-m*d,Y=m*v-l*g,z=l*d-c*v,Z=p*g-x*d,M=x*v-b*g,I=b*d-p*v,V=u*g-y*d,L=y*v-f*g,w=f*d-u*v;let k,A,B,P,S=-1,T=0;if(k=0,A=0,B=0,t*X+i*Y+s*z<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=qt.x,o=qt.y,n=qt.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}T=l,S=h.x*h.x+h.y*h.y+h.z*h.z,k=h.x,A=h.y,B=h.z}if(a*Z+o*M+n*I<0){let t,i,s,a,o,n,e,r,_;t=qt.x,i=qt.y,s=qt.z,a=Nt.x,o=Nt.y,n=Nt.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(S<0||m<S)&&(T=l<<1,S=m,k=h.x,A=h.y,B=h.z)}if(e*V+r*L+_*w<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=Nt.x,o=Nt.y,n=Nt.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=h.x,A=h.y,B=h.z)}if(S>0)h.x=k,h.y=A,h.z=B,P=T;else{let a=v*v+d*d+g*g;a>0&&(a=1/Math.sqrt(a)),v*=a,d*=a,g*=a;let o=v*v+d*d+g*g;o=(t*v+i*d+s*g)/o,k=v*o,A=d*o,B=g*o,h.x=k,h.y=A,h.z=B,P=7}let C=h.x*h.x+h.y*h.y+h.z*h.z;(Wt<0||C<Wt)&&(Ot=1&P|(6&P)<<1,Wt=C,Dt=h.x,Ft=h.y,Ht=h.z)}if((tt*Bt+it*Pt+st*St)*Gt<0){let t,i,s,a,o,n,e,r,_,l,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w;t=Rt.x,i=Rt.y,s=Rt.z,a=Et.x,o=Et.y,n=Et.z,e=Nt.x,r=Nt.y,_=Nt.z,l=a-t,c=o-i,m=n-s,b=e-a,p=r-o,x=_-n,f=t-e,u=i-r,y=s-_,v=c*x-m*p,d=m*b-l*x,g=l*p-c*b,X=c*g-m*d,Y=m*v-l*g,z=l*d-c*v,Z=p*g-x*d,M=x*v-b*g,I=b*d-p*v,V=u*g-y*d,L=y*v-f*g,w=f*d-u*v;let k,A,B,P,S=-1,T=0;if(k=0,A=0,B=0,t*X+i*Y+s*z<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=Et.x,o=Et.y,n=Et.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}T=l,S=h.x*h.x+h.y*h.y+h.z*h.z,k=h.x,A=h.y,B=h.z}if(a*Z+o*M+n*I<0){let t,i,s,a,o,n,e,r,_;t=Et.x,i=Et.y,s=Et.z,a=Nt.x,o=Nt.y,n=Nt.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(S<0||m<S)&&(T=l<<1,S=m,k=h.x,A=h.y,B=h.z)}if(e*V+r*L+_*w<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=Nt.x,o=Nt.y,n=Nt.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=h.x,A=h.y,B=h.z)}if(S>0)h.x=k,h.y=A,h.z=B,P=T;else{let a=v*v+d*d+g*g;a>0&&(a=1/Math.sqrt(a)),v*=a,d*=a,g*=a;let o=v*v+d*d+g*g;o=(t*v+i*d+s*g)/o,k=v*o,A=d*o,B=g*o,h.x=k,h.y=A,h.z=B,P=7}let C=h.x*h.x+h.y*h.y+h.z*h.z;(Wt<0||C<Wt)&&(Ot=3&P|(4&P)<<1,Wt=C,Dt=h.x,Ft=h.y,Ht=h.z)}if((at*Tt+ot*Ct+nt*jt)*Gt<0){let t,i,s,a,o,n,e,r,_,l,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w;t=Et.x,i=Et.y,s=Et.z,a=qt.x,o=qt.y,n=qt.z,e=Nt.x,r=Nt.y,_=Nt.z,l=a-t,c=o-i,m=n-s,b=e-a,p=r-o,x=_-n,f=t-e,u=i-r,y=s-_,v=c*x-m*p,d=m*b-l*x,g=l*p-c*b,X=c*g-m*d,Y=m*v-l*g,z=l*d-c*v,Z=p*g-x*d,M=x*v-b*g,I=b*d-p*v,V=u*g-y*d,L=y*v-f*g,w=f*d-u*v;let k,A,B,P,S=-1,T=0;if(k=0,A=0,B=0,t*X+i*Y+s*z<0){let t,i,s,a,o,n,e,r,_;t=Et.x,i=Et.y,s=Et.z,a=qt.x,o=qt.y,n=qt.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}T=l,S=h.x*h.x+h.y*h.y+h.z*h.z,k=h.x,A=h.y,B=h.z}if(a*Z+o*M+n*I<0){let t,i,s,a,o,n,e,r,_;t=qt.x,i=qt.y,s=qt.z,a=Nt.x,o=Nt.y,n=Nt.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(S<0||m<S)&&(T=l<<1,S=m,k=h.x,A=h.y,B=h.z)}if(e*V+r*L+_*w<0){let t,i,s,a,o,n,e,r,_;t=Et.x,i=Et.y,s=Et.z,a=Nt.x,o=Nt.y,n=Nt.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=h.x,A=h.y,B=h.z)}if(S>0)h.x=k,h.y=A,h.z=B,P=T;else{let a=v*v+d*d+g*g;a>0&&(a=1/Math.sqrt(a)),v*=a,d*=a,g*=a;let o=v*v+d*d+g*g;o=(t*v+i*d+s*g)/o,k=v*o,A=d*o,B=g*o,h.x=k,h.y=A,h.z=B,P=7}let C=h.x*h.x+h.y*h.y+h.z*h.z;(Wt<0||C<Wt)&&(Ot=P<<1,Wt=C,Dt=h.x,Ft=h.y,Ht=h.z)}Wt>0?(h.x=Dt,h.y=Ft,h.z=Ht,s=Ot):(h.zero(),s=15)}if(h.x*h.x+h.y*h.y+h.z*h.z<1e-8){if(!e)return this.distance=0,0;switch(this.simplexSize){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron()}if(4==this.simplexSize){let s=this.computeDepth(t,i,a,o,r,_,l);return 0!=s?(this.distance=0,s):(this.distance=-this.depth,0)}return this.distance=0,1}this.shrinkSimplex(s),c.x=h.x,c.y=h.y,c.z=h.z,c.x=-c.x,c.y=-c.y,c.z=-c.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let m=this.s[this.simplexSize],b=this.w1[this.simplexSize];m.x=b.x,m.y=b.y,m.z=b.z;let p=this.w2[this.simplexSize];if(m.x-=p.x,m.y-=p.y,m.z-=p.z,c.x*c.x+c.y*c.y+c.z*c.z<1e-8)throw new Error("!?");let f=r[this.simplexSize];if(f.x*c.x+f.y*c.y+f.z*c.z-(h.x*c.x+h.y*c.y+h.z*c.z)<1e-8)return this.interpolateClosestPoints(),this.distance=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z),null!=n&&null!=n._gjkCache&&this.saveCache(n._gjkCache),0;this.simplexSize++,++x}return 2}convexCastImpl(t,i,s,a,o,n,e){this.c1=t,this.c2=i,this.tf1=s,this.tf2=a;let r,_,l,h=this.s,c=this.closest,m=this.dir;if(r=a._positionX-s._positionX,_=a._positionY-s._positionY,l=a._positionZ-s._positionZ,m.x=r,m.y=_,m.z=l,m.x*m.x+m.y*m.y+m.z*m.z<1e-6&&m.init(1,0,0),this.simplexSize=0,null!=this.c1)this.computeWitnessPoint1(!0);else{let t=this.w1[this.simplexSize];t.x=this.tf1._positionX,t.y=this.tf1._positionY,t.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);let b=this.s[this.simplexSize],p=this.w1[this.simplexSize];b.x=p.x,b.y=p.y,b.z=p.z;let x=this.w2[this.simplexSize];b.x-=x.x,b.y-=x.y,b.z-=x.z,this.simplexSize=1;let f=0,u=0,y=this.rayX,v=this.rayR;for(y.zero(),v.x=n.x,v.y=n.y,v.z=n.z,v.x-=o.x,v.y-=o.y,v.z-=o.z;f<40;){let t=0;switch(this.simplexSize){case 1:let i=h[0];c.x=i.x,c.y=i.y,c.z=i.z,t=1;break;case 2:let s,a,o,n,e,r,_=h[0];s=_.x,a=_.y,o=_.z;let l,m,b,p=h[1];n=p.x,e=p.y,r=p.z,l=n-s,m=e-a,b=r-o;let x=l*s+m*a+b*o;if(x=-x/(l*l+m*m+b*b),x<0)c.x=s,c.y=a,c.z=o,t=1;else if(x>1)c.x=n,c.y=e,c.z=r,t=2;else{let i,n,e;i=s+l*x,n=a+m*x,e=o+b*x,c.x=i,c.y=n,c.z=e,t=3}break;case 3:let f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T,C,j,R,E,q,N,D,F,H,G=h[0],W=h[1],O=h[2];f=G.x,u=G.y,y=G.z,v=W.x,d=W.y,g=W.z,X=O.x,Y=O.y,z=O.z,Z=v-f,M=d-u,I=g-y,V=X-v,L=Y-d,w=z-g,k=f-X,A=u-Y,B=y-z,P=M*w-I*L,S=I*V-Z*w,T=Z*L-M*V,C=M*T-I*S,j=I*P-Z*T,R=Z*S-M*P,E=L*T-w*S,q=w*P-V*T,N=V*S-L*P,D=A*T-B*S,F=B*P-k*T,H=k*S-A*P;let J,U,Q,K=-1,$=0;if(J=0,U=0,Q=0,f*C+u*j+y*R<0){let t,i,s,a,o,n,e,r,_;t=G.x,i=G.y,s=G.z,a=W.x,o=W.y,n=W.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}$=l,K=c.x*c.x+c.y*c.y+c.z*c.z,J=c.x,U=c.y,Q=c.z}if(v*E+d*q+g*N<0){let t,i,s,a,o,n,e,r,_;t=W.x,i=W.y,s=W.z,a=O.x,o=O.y,n=O.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(K<0||m<K)&&($=l<<1,K=m,J=c.x,U=c.y,Q=c.z)}if(X*D+Y*F+z*H<0){let t,i,s,a,o,n,e,r,_;t=G.x,i=G.y,s=G.z,a=O.x,o=O.y,n=O.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(K<0||m<K)&&($=1&l|(2&l)<<1,K=m,J=c.x,U=c.y,Q=c.z)}if(K>0)c.x=J,c.y=U,c.z=Q,t=$;else{let i=P*P+S*S+T*T;i>0&&(i=1/Math.sqrt(i)),P*=i,S*=i,T*=i;let s=P*P+S*S+T*T;s=(f*P+u*S+y*T)/s,J=P*s,U=S*s,Q=T*s,c.x=J,c.y=U,c.z=Q,t=7}break;case 4:let tt,it,st,at,ot,nt,et,rt,_t,lt,ht,ct,mt,bt,pt,xt,ft,ut,yt,vt,dt,gt,Xt,Yt,zt,Zt,Mt,It,Vt,Lt,wt,kt,At,Bt,Pt,St,Tt,Ct,jt,Rt=h[0],Et=h[1],qt=h[2],Nt=h[3];tt=Rt.x,it=Rt.y,st=Rt.z,at=Et.x,ot=Et.y,nt=Et.z,et=qt.x,rt=qt.y,_t=qt.z,lt=Nt.x,ht=Nt.y,ct=Nt.z,mt=at-tt,bt=ot-it,pt=nt-st,xt=et-tt,ft=rt-it,ut=_t-st,yt=lt-tt,vt=ht-it,dt=ct-st,gt=et-at,Xt=rt-ot,Yt=_t-nt,zt=lt-at,Zt=ht-ot,Mt=ct-nt,It=bt*ut-pt*ft,Vt=pt*xt-mt*ut,Lt=mt*ft-bt*xt,wt=ft*dt-ut*vt,kt=ut*yt-xt*dt,At=xt*vt-ft*yt,Bt=vt*pt-dt*bt,Pt=dt*mt-yt*pt,St=yt*bt-vt*mt,Tt=Zt*Yt-Mt*Xt,Ct=Mt*gt-zt*Yt,jt=zt*Xt-Zt*gt;let Dt,Ft,Ht,Gt=mt*Tt+bt*Ct+pt*jt>0?1:-1,Wt=-1,Ot=0;if(Dt=0,Ft=0,Ht=0,(tt*It+it*Vt+st*Lt)*Gt<0){let t,i,s,a,o,n,e,r,_,l,h,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w;t=Rt.x,i=Rt.y,s=Rt.z,a=Et.x,o=Et.y,n=Et.z,e=qt.x,r=qt.y,_=qt.z,l=a-t,h=o-i,m=n-s,b=e-a,p=r-o,x=_-n,f=t-e,u=i-r,y=s-_,v=h*x-m*p,d=m*b-l*x,g=l*p-h*b,X=h*g-m*d,Y=m*v-l*g,z=l*d-h*v,Z=p*g-x*d,M=x*v-b*g,I=b*d-p*v,V=u*g-y*d,L=y*v-f*g,w=f*d-u*v;let k,A,B,P,S=-1,T=0;if(k=0,A=0,B=0,t*X+i*Y+s*z<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=Et.x,o=Et.y,n=Et.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}T=l,S=c.x*c.x+c.y*c.y+c.z*c.z,k=c.x,A=c.y,B=c.z}if(a*Z+o*M+n*I<0){let t,i,s,a,o,n,e,r,_;t=Et.x,i=Et.y,s=Et.z,a=qt.x,o=qt.y,n=qt.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=l<<1,S=m,k=c.x,A=c.y,B=c.z)}if(e*V+r*L+_*w<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=qt.x,o=qt.y,n=qt.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=c.x,A=c.y,B=c.z)}if(S>0)c.x=k,c.y=A,c.z=B,P=T;else{let a=v*v+d*d+g*g;a>0&&(a=1/Math.sqrt(a)),v*=a,d*=a,g*=a;let o=v*v+d*d+g*g;o=(t*v+i*d+s*g)/o,k=v*o,A=d*o,B=g*o,c.x=k,c.y=A,c.z=B,P=7}Ot=P,Wt=c.x*c.x+c.y*c.y+c.z*c.z,Dt=c.x,Ft=c.y,Ht=c.z}if((tt*wt+it*kt+st*At)*Gt<0){let t,i,s,a,o,n,e,r,_,l,h,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w;t=Rt.x,i=Rt.y,s=Rt.z,a=qt.x,o=qt.y,n=qt.z,e=Nt.x,r=Nt.y,_=Nt.z,l=a-t,h=o-i,m=n-s,b=e-a,p=r-o,x=_-n,f=t-e,u=i-r,y=s-_,v=h*x-m*p,d=m*b-l*x,g=l*p-h*b,X=h*g-m*d,Y=m*v-l*g,z=l*d-h*v,Z=p*g-x*d,M=x*v-b*g,I=b*d-p*v,V=u*g-y*d,L=y*v-f*g,w=f*d-u*v;let k,A,B,P,S=-1,T=0;if(k=0,A=0,B=0,t*X+i*Y+s*z<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=qt.x,o=qt.y,n=qt.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}T=l,S=c.x*c.x+c.y*c.y+c.z*c.z,k=c.x,A=c.y,B=c.z}if(a*Z+o*M+n*I<0){let t,i,s,a,o,n,e,r,_;t=qt.x,i=qt.y,s=qt.z,a=Nt.x,o=Nt.y,n=Nt.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=l<<1,S=m,k=c.x,A=c.y,B=c.z)}if(e*V+r*L+_*w<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=Nt.x,o=Nt.y,n=Nt.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=c.x,A=c.y,B=c.z)}if(S>0)c.x=k,c.y=A,c.z=B,P=T;else{let a=v*v+d*d+g*g;a>0&&(a=1/Math.sqrt(a)),v*=a,d*=a,g*=a;let o=v*v+d*d+g*g;o=(t*v+i*d+s*g)/o,k=v*o,A=d*o,B=g*o,c.x=k,c.y=A,c.z=B,P=7}let C=c.x*c.x+c.y*c.y+c.z*c.z;(Wt<0||C<Wt)&&(Ot=1&P|(6&P)<<1,Wt=C,Dt=c.x,Ft=c.y,Ht=c.z)}if((tt*Bt+it*Pt+st*St)*Gt<0){let t,i,s,a,o,n,e,r,_,l,h,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w;t=Rt.x,i=Rt.y,s=Rt.z,a=Et.x,o=Et.y,n=Et.z,e=Nt.x,r=Nt.y,_=Nt.z,l=a-t,h=o-i,m=n-s,b=e-a,p=r-o,x=_-n,f=t-e,u=i-r,y=s-_,v=h*x-m*p,d=m*b-l*x,g=l*p-h*b,X=h*g-m*d,Y=m*v-l*g,z=l*d-h*v,Z=p*g-x*d,M=x*v-b*g,I=b*d-p*v,V=u*g-y*d,L=y*v-f*g,w=f*d-u*v;let k,A,B,P,S=-1,T=0;if(k=0,A=0,B=0,t*X+i*Y+s*z<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=Et.x,o=Et.y,n=Et.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}T=l,S=c.x*c.x+c.y*c.y+c.z*c.z,k=c.x,A=c.y,B=c.z}if(a*Z+o*M+n*I<0){let t,i,s,a,o,n,e,r,_;t=Et.x,i=Et.y,s=Et.z,a=Nt.x,o=Nt.y,n=Nt.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=l<<1,S=m,k=c.x,A=c.y,B=c.z)}if(e*V+r*L+_*w<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=Nt.x,o=Nt.y,n=Nt.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=c.x,A=c.y,B=c.z)}if(S>0)c.x=k,c.y=A,c.z=B,P=T;else{let a=v*v+d*d+g*g;a>0&&(a=1/Math.sqrt(a)),v*=a,d*=a,g*=a;let o=v*v+d*d+g*g;o=(t*v+i*d+s*g)/o,k=v*o,A=d*o,B=g*o,c.x=k,c.y=A,c.z=B,P=7}let C=c.x*c.x+c.y*c.y+c.z*c.z;(Wt<0||C<Wt)&&(Ot=3&P|(4&P)<<1,Wt=C,Dt=c.x,Ft=c.y,Ht=c.z)}if((at*Tt+ot*Ct+nt*jt)*Gt<0){let t,i,s,a,o,n,e,r,_,l,h,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w;t=Et.x,i=Et.y,s=Et.z,a=qt.x,o=qt.y,n=qt.z,e=Nt.x,r=Nt.y,_=Nt.z,l=a-t,h=o-i,m=n-s,b=e-a,p=r-o,x=_-n,f=t-e,u=i-r,y=s-_,v=h*x-m*p,d=m*b-l*x,g=l*p-h*b,X=h*g-m*d,Y=m*v-l*g,z=l*d-h*v,Z=p*g-x*d,M=x*v-b*g,I=b*d-p*v,V=u*g-y*d,L=y*v-f*g,w=f*d-u*v;let k,A,B,P,S=-1,T=0;if(k=0,A=0,B=0,t*X+i*Y+s*z<0){let t,i,s,a,o,n,e,r,_;t=Et.x,i=Et.y,s=Et.z,a=qt.x,o=qt.y,n=qt.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}T=l,S=c.x*c.x+c.y*c.y+c.z*c.z,k=c.x,A=c.y,B=c.z}if(a*Z+o*M+n*I<0){let t,i,s,a,o,n,e,r,_;t=qt.x,i=qt.y,s=qt.z,a=Nt.x,o=Nt.y,n=Nt.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=l<<1,S=m,k=c.x,A=c.y,B=c.z)}if(e*V+r*L+_*w<0){let t,i,s,a,o,n,e,r,_;t=Et.x,i=Et.y,s=Et.z,a=Nt.x,o=Nt.y,n=Nt.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=c.x,A=c.y,B=c.z)}if(S>0)c.x=k,c.y=A,c.z=B,P=T;else{let a=v*v+d*d+g*g;a>0&&(a=1/Math.sqrt(a)),v*=a,d*=a,g*=a;let o=v*v+d*d+g*g;o=(t*v+i*d+s*g)/o,k=v*o,A=d*o,B=g*o,c.x=k,c.y=A,c.z=B,P=7}let C=c.x*c.x+c.y*c.y+c.z*c.z;(Wt<0||C<Wt)&&(Ot=P<<1,Wt=C,Dt=c.x,Ft=c.y,Ht=c.z)}Wt>0?(c.x=Dt,c.y=Ft,c.z=Ht,t=Ot):(c.zero(),t=15)}if(this.shrinkSimplex(t),c.x*c.x+c.y*c.y+c.z*c.z<1e-8){if(0==u||4==this.simplexSize)return e.fraction=u,!1;this.interpolateClosestPoints(),e.fraction=u;let t=e.normal;t.x=m.x,t.y=m.y,t.z=m.z;let i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);i>0&&(i=1/i),t.x*=i,t.y*=i,t.z*=i;let s=e.position,a=this.closestPoint1;return s.x=a.x,s.y=a.y,s.z=a.z,s.x+=o.x*u,s.y+=o.y*u,s.z+=o.z*u,!0}if(m.x=c.x,m.y=c.y,m.z=c.z,m.x=-m.x,m.y=-m.y,m.z=-m.z,null!=this.c1)this.computeWitnessPoint1(!0);else{let t=this.w1[this.simplexSize];t.x=this.tf1._positionX,t.y=this.tf1._positionY,t.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);let i=this.s[this.simplexSize],s=this.w1[this.simplexSize];i.x=s.x,i.y=s.y,i.z=s.z;let a=this.w2[this.simplexSize];i.x-=a.x,i.y-=a.y,i.z-=a.z;let n=h[this.simplexSize];if(n.x-=y.x,n.y-=y.y,n.z-=y.z,m.x*m.x+m.y*m.y+m.z*m.z<1e-8)throw new Error("!?");let r=h[this.simplexSize],_=r.x*m.x+r.y*m.y+r.z*m.z;if(_<0){if(v.x*m.x+v.y*m.y+v.z*m.z>=0)return!1;let t=_/(v.x*m.x+v.y*m.y+v.z*m.z);if(u+=t,u>=1)return!1;y.x+=v.x*t,y.y+=v.y*t,y.z+=v.z*t;let i=0,s=this.simplexSize+1;for(;i<s;){let s=h[i++],a=-t;s.x+=v.x*a,s.y+=v.y*a,s.z+=v.z*a}}let l=!1,b=0,p=this.simplexSize;for(;b<p;){let t=b++,i=h[t].x-h[this.simplexSize].x,s=h[t].y-h[this.simplexSize].y,a=h[t].z-h[this.simplexSize].z;if(i*i+s*s+a*a<1e-8){l=!0;break}}l||this.simplexSize++,++f}return!1}interpolateClosestPoints(){switch(this.simplexSize){case 1:let t=this.closestPoint1,i=this.w1[0];t.x=i.x,t.y=i.y,t.z=i.z;let s=this.closestPoint2,a=this.w2[0];s.x=a.x,s.y=a.y,s.z=a.z;break;case 2:let o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z=this.closest;o=Z.x,n=Z.y,e=Z.z;let M=this.s[0];r=M.x,_=M.y,l=M.z;let I=this.w1[0];h=I.x,c=I.y,m=I.z;let V=this.w2[0];b=V.x,p=V.y,x=V.z;let L=this.s[1];f=L.x,u=L.y,y=L.z;let w=this.w1[1];v=w.x,d=w.y,g=w.z;let k,A,B,P=this.w2[1];X=P.x,Y=P.y,z=P.z,k=f-r,A=u-_,B=y-l;let S,T,C,j=k*k+A*A+B*B;0!=j&&(j=1/j),S=o-r,T=n-_,C=e-l;let R,E,q,N,D,F,H,G,W,O=(S*k+T*A+C*B)*j;R=v-h,E=d-c,q=g-m,N=h+R*O,D=c+E*O,F=m+q*O,R=X-b,E=Y-p,q=z-x,H=b+R*O,G=p+E*O,W=x+q*O;let J=this.closestPoint1;J.x=N,J.y=D,J.z=F;let U=this.closestPoint2;U.x=H,U.y=G,U.z=W;break;case 3:let Q,K,$,tt,it,st,at,ot,nt,et,rt,_t,lt,ht,ct,mt,bt,pt,xt,ft,ut,yt,vt,dt,gt,Xt,Yt,zt,Zt,Mt,It=this.closest;Q=It.x,K=It.y,$=It.z;let Vt=this.s[0];tt=Vt.x,it=Vt.y,st=Vt.z;let Lt=this.w1[0];at=Lt.x,ot=Lt.y,nt=Lt.z;let wt=this.w2[0];et=wt.x,rt=wt.y,_t=wt.z;let kt=this.s[1];lt=kt.x,ht=kt.y,ct=kt.z;let At=this.w1[1];mt=At.x,bt=At.y,pt=At.z;let Bt=this.w2[1];xt=Bt.x,ft=Bt.y,ut=Bt.z;let Pt=this.s[2];yt=Pt.x,vt=Pt.y,dt=Pt.z;let St=this.w1[2];gt=St.x,Xt=St.y,Yt=St.z;let Tt,Ct,jt,Rt,Et,qt,Nt,Dt,Ft,Ht=this.w2[2];zt=Ht.x,Zt=Ht.y,Mt=Ht.z,Tt=lt-tt,Ct=ht-it,jt=ct-st,Rt=yt-tt,Et=vt-it,qt=dt-st,Nt=Q-tt,Dt=K-it,Ft=$-st;let Gt=Tt*Tt+Ct*Ct+jt*jt,Wt=Tt*Rt+Ct*Et+jt*qt,Ot=Rt*Rt+Et*Et+qt*qt,Jt=Tt*Nt+Ct*Dt+jt*Ft,Ut=Rt*Nt+Et*Dt+qt*Ft,Qt=Gt*Ot-Wt*Wt;0!=Qt&&(Qt=1/Qt);let Kt,$t,ti,ii,si,ai,oi,ni,ei,ri=(Jt*Ot-Ut*Wt)*Qt,_i=(-Jt*Wt+Ut*Gt)*Qt;Kt=mt-at,$t=bt-ot,ti=pt-nt,ii=at+Kt*ri,si=ot+$t*ri,ai=nt+ti*ri,Kt=gt-at,$t=Xt-ot,ti=Yt-nt,ii+=Kt*_i,si+=$t*_i,ai+=ti*_i,Kt=xt-et,$t=ft-rt,ti=ut-_t,oi=et+Kt*ri,ni=rt+$t*ri,ei=_t+ti*ri,Kt=zt-et,$t=Zt-rt,ti=Mt-_t,oi+=Kt*_i,ni+=$t*_i,ei+=ti*_i;let li=this.closestPoint1;li.x=ii,li.y=si,li.z=ai;let hi=this.closestPoint2;hi.x=oi,hi.y=ni,hi.z=ei;break;default:throw new Error("!?")}}loadCache(t){let i=this.dir,s=t.prevClosestDir;i.x=s.x,i.y=s.y,i.z=s.z}saveCache(t){let i=t.prevClosestDir,s=this.closest;i.x=s.x,i.y=s.y,i.z=s.z,i.x=-i.x,i.y=-i.y,i.z=-i.z}shrinkSimplex(t){switch(this.simplexSize=t,this.simplexSize=(5&this.simplexSize)+(this.simplexSize>>1&5),this.simplexSize=(3&this.simplexSize)+(this.simplexSize>>2&3),t){case 2:let t=this.s[0],i=this.s[1];t.x=i.x,t.y=i.y,t.z=i.z;let s=this.w1[0],a=this.w1[1];s.x=a.x,s.y=a.y,s.z=a.z;let o=this.w2[0],n=this.w2[1];o.x=n.x,o.y=n.y,o.z=n.z;break;case 4:let e=this.s[0],r=this.s[2];e.x=r.x,e.y=r.y,e.z=r.z;let _=this.w1[0],l=this.w1[2];_.x=l.x,_.y=l.y,_.z=l.z;let h=this.w2[0],c=this.w2[2];h.x=c.x,h.y=c.y,h.z=c.z;break;case 5:let m=this.s[1],b=this.s[2];m.x=b.x,m.y=b.y,m.z=b.z;let p=this.w1[1],x=this.w1[2];p.x=x.x,p.y=x.y,p.z=x.z;let f=this.w2[1],u=this.w2[2];f.x=u.x,f.y=u.y,f.z=u.z;break;case 6:let y=this.s[0],v=this.s[2];y.x=v.x,y.y=v.y,y.z=v.z;let d=this.w1[0],g=this.w1[2];d.x=g.x,d.y=g.y,d.z=g.z;let X=this.w2[0],Y=this.w2[2];X.x=Y.x,X.y=Y.y,X.z=Y.z;break;case 8:let z=this.s[0],Z=this.s[3];z.x=Z.x,z.y=Z.y,z.z=Z.z;let M=this.w1[0],I=this.w1[3];M.x=I.x,M.y=I.y,M.z=I.z;let V=this.w2[0],L=this.w2[3];V.x=L.x,V.y=L.y,V.z=L.z;break;case 9:let w=this.s[1],k=this.s[3];w.x=k.x,w.y=k.y,w.z=k.z;let A=this.w1[1],B=this.w1[3];A.x=B.x,A.y=B.y,A.z=B.z;let P=this.w2[1],S=this.w2[3];P.x=S.x,P.y=S.y,P.z=S.z;break;case 10:let T=this.s[0],C=this.s[3];T.x=C.x,T.y=C.y,T.z=C.z;let j=this.w1[0],R=this.w1[3];j.x=R.x,j.y=R.y,j.z=R.z;let E=this.w2[0],q=this.w2[3];E.x=q.x,E.y=q.y,E.z=q.z;break;case 11:let N=this.s[2],D=this.s[3];N.x=D.x,N.y=D.y,N.z=D.z;let F=this.w1[2],H=this.w1[3];F.x=H.x,F.y=H.y,F.z=H.z;let G=this.w2[2],W=this.w2[3];G.x=W.x,G.y=W.y,G.z=W.z;break;case 12:let O=this.s[0],J=this.s[2];O.x=J.x,O.y=J.y,O.z=J.z;let U=this.w1[0],Q=this.w1[2];U.x=Q.x,U.y=Q.y,U.z=Q.z;let K=this.w2[0],$=this.w2[2];K.x=$.x,K.y=$.y,K.z=$.z;let tt=this.s[1],it=this.s[3];tt.x=it.x,tt.y=it.y,tt.z=it.z;let st=this.w1[1],at=this.w1[3];st.x=at.x,st.y=at.y,st.z=at.z;let ot=this.w2[1],nt=this.w2[3];ot.x=nt.x,ot.y=nt.y,ot.z=nt.z;break;case 13:let et=this.s[1],rt=this.s[3];et.x=rt.x,et.y=rt.y,et.z=rt.z;let _t=this.w1[1],lt=this.w1[3];_t.x=lt.x,_t.y=lt.y,_t.z=lt.z;let ht=this.w2[1],ct=this.w2[3];ht.x=ct.x,ht.y=ct.y,ht.z=ct.z;break;case 14:let mt=this.s[0],bt=this.s[3];mt.x=bt.x,mt.y=bt.y,mt.z=bt.z;let pt=this.w1[0],xt=this.w1[3];pt.x=xt.x,pt.y=xt.y,pt.z=xt.z;let ft=this.w2[0],ut=this.w2[3];ft.x=ut.x,ft.y=ut.y,ft.z=ut.z}}computeWitnessPoint1(t){let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f=this.dir;o=f.x,n=f.y,e=f.z,h=this.tf1._rotation00*o+this.tf1._rotation10*n+this.tf1._rotation20*e,c=this.tf1._rotation01*o+this.tf1._rotation11*n+this.tf1._rotation21*e,m=this.tf1._rotation02*o+this.tf1._rotation12*n+this.tf1._rotation22*e,r=h,_=c,l=m;let u=this.dir;if(u.x=r,u.y=_,u.z=l,this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]),t){let t=this.dir,i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);i>0&&(i=1/i),t.x*=i,t.y*=i,t.z*=i;let s=this.w1[this.simplexSize],a=this.dir,o=this.c1._gjkMargin;s.x+=a.x*o,s.y+=a.y*o,s.z+=a.z*o}let y,v,d,g=this.w1[this.simplexSize];i=g.x,s=g.y,a=g.z,y=this.tf1._rotation00*i+this.tf1._rotation01*s+this.tf1._rotation02*a,v=this.tf1._rotation10*i+this.tf1._rotation11*s+this.tf1._rotation12*a,d=this.tf1._rotation20*i+this.tf1._rotation21*s+this.tf1._rotation22*a,b=y,p=v,x=d,b+=this.tf1._positionX,p+=this.tf1._positionY,x+=this.tf1._positionZ;let X=this.w1[this.simplexSize];X.x=b,X.y=p,X.z=x;let Y=this.dir;Y.x=o,Y.y=n,Y.z=e}computeWitnessPoint2(t){let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f=this.dir;o=f.x,n=f.y,e=f.z,h=this.tf2._rotation00*o+this.tf2._rotation10*n+this.tf2._rotation20*e,c=this.tf2._rotation01*o+this.tf2._rotation11*n+this.tf2._rotation21*e,m=this.tf2._rotation02*o+this.tf2._rotation12*n+this.tf2._rotation22*e,r=h,_=c,l=m,r=-r,_=-_,l=-l;let u=this.dir;if(u.x=r,u.y=_,u.z=l,this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]),t){let t=this.dir,i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);i>0&&(i=1/i),t.x*=i,t.y*=i,t.z*=i;let s=this.w2[this.simplexSize],a=this.dir,o=this.c2._gjkMargin;s.x+=a.x*o,s.y+=a.y*o,s.z+=a.z*o}let y,v,d,g=this.w2[this.simplexSize];i=g.x,s=g.y,a=g.z,y=this.tf2._rotation00*i+this.tf2._rotation01*s+this.tf2._rotation02*a,v=this.tf2._rotation10*i+this.tf2._rotation11*s+this.tf2._rotation12*a,d=this.tf2._rotation20*i+this.tf2._rotation21*s+this.tf2._rotation22*a,b=y,p=v,x=d,b+=this.tf2._positionX,p+=this.tf2._positionY,x+=this.tf2._positionZ;let X=this.w2[this.simplexSize];X.x=b,X.y=p,X.z=x;let Y=this.dir;Y.x=o,Y.y=n,Y.z=e}pointToTetrahedron(){let t=0;for(;t<3;){let i=this.dir,s=this.baseDirs[t++];i.x=s.x,i.y=s.y,i.z=s.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let a=this.s[this.simplexSize],o=this.w1[this.simplexSize];a.x=o.x,a.y=o.y,a.z=o.z;let n=this.w2[this.simplexSize];if(a.x-=n.x,a.y-=n.y,a.z-=n.z,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;let e=this.dir;e.x=-e.x,e.y=-e.y,e.z=-e.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let r=this.s[this.simplexSize],_=this.w1[this.simplexSize];r.x=_.x,r.y=_.y,r.z=_.z;let l=this.w2[this.simplexSize];if(r.x-=l.x,r.y-=l.y,r.z-=l.z,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}}lineToTetrahedron(){let t,i,s,a,o,n,e,r,_,l,h,c,m=this.dir;t=m.x,i=m.y,s=m.z;let b=this.s[0];a=b.x,o=b.y,n=b.z;let p=this.s[1];e=p.x,r=p.y,_=p.z,l=a-e,h=o-r,c=n-_;let x=0;for(;x<3;){let t,i,s,a,o,n,e=this.baseDirs[x++];t=e.x,i=e.y,s=e.z,a=h*s-c*i,o=c*t-l*s,n=l*i-h*t;let r=this.dir;r.x=a,r.y=o,r.z=n,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let _=this.s[this.simplexSize],m=this.w1[this.simplexSize];_.x=m.x,_.y=m.y,_.z=m.z;let b=this.w2[this.simplexSize];if(_.x-=b.x,_.y-=b.y,_.z-=b.z,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;let p=this.dir;p.x=-p.x,p.y=-p.y,p.z=-p.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let f=this.s[this.simplexSize],u=this.w1[this.simplexSize];f.x=u.x,f.y=u.y,f.z=u.z;let y=this.w2[this.simplexSize];if(f.x-=y.x,f.y-=y.y,f.z-=y.z,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}let f=this.dir;f.x=t,f.y=i,f.z=s}triangleToTetrahedron(){let t,i,s,a=this.dir;for(t=a.x,i=a.y,s=a.z;;){let t,i,s,a,o,n,e,r,_,l,h,c,m,b,p,x=this.s[0];t=x.x,i=x.y,s=x.z;let f=this.s[1];a=f.x,o=f.y,n=f.z;let u,y,v,d=this.s[2];e=d.x,r=d.y,_=d.z,l=a-t,h=o-i,c=n-s,m=e-t,b=r-i,p=_-s,u=h*p-c*b,y=c*m-l*p,v=l*b-h*m;let g=this.dir;g.x=u,g.y=y,g.z=v,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let X=this.s[this.simplexSize],Y=this.w1[this.simplexSize];X.x=Y.x,X.y=Y.y,X.z=Y.z;let z=this.w2[this.simplexSize];if(X.x-=z.x,X.y-=z.y,X.z-=z.z,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;let Z=this.dir;Z.x=-Z.x,Z.y=-Z.y,Z.z=-Z.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let M=this.s[this.simplexSize],I=this.w1[this.simplexSize];M.x=I.x,M.y=I.y,M.z=I.z;let V=this.w2[this.simplexSize];if(M.x-=V.x,M.y-=V.y,M.z-=V.z,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;break}let o=this.dir;o.x=t,o.y=i,o.z=s}isValidTetrahedron(){let t=this.s[2].x-this.s[0].x,i=this.s[2].y-this.s[0].y,s=this.s[2].z-this.s[0].z,a=this.s[3].x-this.s[0].x,o=this.s[3].y-this.s[0].y,n=this.s[3].z-this.s[0].z,e=(this.s[1].x-this.s[0].x)*(i*n-s*o)-(this.s[1].y-this.s[0].y)*(t*n-s*a)+(this.s[1].z-this.s[0].z)*(t*o-i*a);return e>1e-12||e<-1e-12}computeDepth(t,i,a,o,n,e,r){let _=this.polyhedron;for(;_._numTriangles>0;){let t=_._triangleList;_._numTriangles--;let i=t._prev,s=t._next;null!=i&&(i._next=s),null!=s&&(s._prev=i),t==_._triangleList&&(_._triangleList=_._triangleList._next),t==_._triangleListLast&&(_._triangleListLast=_._triangleListLast._prev),t._next=null,t._prev=null,t.removeReferences(),t._next=_._trianglePool,_._trianglePool=t}for(;_._numVertices>0;){let t=_._vertices[--_._numVertices];t.removeReferences(),t._next=_._vertexPool,_._vertexPool=t}let l=this.polyhedron,h=this.polyhedron,c=h._vertexPool;null!=c?(h._vertexPool=c._next,c._next=null):c=new s.collision.narrowphase.detector.gjkepa.EpaVertex;let m=c.init(n[0],e[0],r[0]),b=this.polyhedron,p=b._vertexPool;null!=p?(b._vertexPool=p._next,p._next=null):p=new s.collision.narrowphase.detector.gjkepa.EpaVertex;let x=p.init(n[1],e[1],r[1]),f=this.polyhedron,u=f._vertexPool;null!=u?(f._vertexPool=u._next,u._next=null):u=new s.collision.narrowphase.detector.gjkepa.EpaVertex;let y=u.init(n[2],e[2],r[2]),v=this.polyhedron,d=v._vertexPool;if(null!=d?(v._vertexPool=d._next,d._next=null):d=new s.collision.narrowphase.detector.gjkepa.EpaVertex,!l._init(m,x,y,d.init(n[3],e[3],r[3])))return s.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT;this.simplexSize=0;let g=this.s[0],X=this.w1[0],Y=this.w2[0],z=0;for(;z<40;){let t=this.polyhedron._triangleList,i=Infinity,a=null;for(;null!=t;)t._distanceSq<i&&(i=t._distanceSq,a=t),t=t._next;let o=a,n=this.dir,e=o._normal;n.x=e.x,n.y=e.y,n.z=e.z;let r=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z);r>0&&(r=1/r),n.x*=r,n.y*=r,n.z*=r,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let _=this.s[this.simplexSize],l=this.w1[this.simplexSize];_.x=l.x,_.y=l.y,_.z=l.z;let h=this.w2[this.simplexSize];_.x-=h.x,_.y-=h.y,_.z-=h.z;let c=o._vertices[0],m=o._vertices[1],b=o._vertices[2],p=c.v,x=this.dir,f=this.dir;if(g.x*f.x+g.y*f.y+g.z*f.z-(p.x*x.x+p.y*x.y+p.z*x.z)<1e-6||39==z){let t=this.closest,i=this.dir;t.x=i.x,t.y=i.y,t.z=i.z;let a,o,n,e=this.dir,r=c.v,_=this.dir,l=(e.x*r.x+e.y*r.y+e.z*r.z)/(_.x*_.x+_.y*_.y+_.z*_.z);t.x*=l,t.y*=l,t.z*=l;let h,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T,C,j,R,E=this.closest;a=E.x,o=E.y,n=E.z;let q=c.v;h=q.x,p=q.y,x=q.z;let N=c.w1;f=N.x,u=N.y,y=N.z;let D=c.w2;v=D.x,d=D.y,g=D.z;let F=m.v;X=F.x,Y=F.y,z=F.z;let H=m.w1;Z=H.x,M=H.y,I=H.z;let G=m.w2;V=G.x,L=G.y,w=G.z;let W=b.v;k=W.x,A=W.y,B=W.z;let O=b.w1;P=O.x,S=O.y,T=O.z;let J,U,Q,K,$,tt,it,st,at,ot=b.w2;C=ot.x,j=ot.y,R=ot.z,J=X-h,U=Y-p,Q=z-x,K=k-h,$=A-p,tt=B-x,it=a-h,st=o-p,at=n-x;let nt=J*J+U*U+Q*Q,et=J*K+U*$+Q*tt,rt=K*K+$*$+tt*tt,_t=J*it+U*st+Q*at,lt=K*it+$*st+tt*at,ht=nt*rt-et*et;0!=ht&&(ht=1/ht);let ct,mt,bt,pt,xt,ft,ut,yt,vt,dt=(_t*rt-lt*et)*ht,gt=(-_t*et+lt*nt)*ht;ct=Z-f,mt=M-u,bt=I-y,pt=f+ct*dt,xt=u+mt*dt,ft=y+bt*dt,ct=P-f,mt=S-u,bt=T-y,pt+=ct*gt,xt+=mt*gt,ft+=bt*gt,ct=V-v,mt=L-d,bt=w-g,ut=v+ct*dt,yt=d+mt*dt,vt=g+bt*dt,ct=C-v,mt=j-d,bt=R-g,ut+=ct*gt,yt+=mt*gt,vt+=bt*gt;let Xt=this.closestPoint1;Xt.x=pt,Xt.y=xt,Xt.z=ft;let Yt=this.closestPoint2;Yt.x=ut,Yt.y=yt,Yt.z=vt;let zt=this.closest;return this.depth=Math.sqrt(zt.x*zt.x+zt.y*zt.y+zt.z*zt.z),s.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED}let u=this.polyhedron,y=u._vertexPool;null!=y?(u._vertexPool=y._next,y._next=null):y=new s.collision.narrowphase.detector.gjkepa.EpaVertex;let v=y.init(g,X,Y);if(!this.polyhedron._addVertex(v,o))return s.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX;++z}return s.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE}computeClosestPoints(t,i,s,a,o){return this.computeClosestPointsImpl(t,i,s,a,o,!0)}computeDistance(t,i,s,a,o){return this.computeClosestPointsImpl(t,i,s,a,o,!1)}convexCast(t,i,s,a,o,n,e){return this.convexCastImpl(t,i,s,a,o,n,e)}rayCast(t,i,s,a,o){let n=this.tempTransform;n._positionX=s.x,n._positionY=s.y,n._positionZ=s.z;let e=this.tl1,r=this.tl2;return e.x=a.x,e.y=a.y,e.z=a.z,e.x-=s.x,e.y-=s.y,e.z-=s.z,r.zero(),this.convexCastImpl(null,t,n,i,e,r,o)}static getInstance(){return s.collision.narrowphase.detector.gjkepa.GjkEpa.instance}},s.collision.narrowphase.detector.gjkepa.GjkEpaLog=class{},s.collision.narrowphase.detector.gjkepa.GjkEpaResultState=class{},s.collision.narrowphase.detector.gjkepa.SimplexUtil=class{static projectOrigin2(t,i,s){let a,o,n,e,r,_,l,h,c;a=t.x,o=t.y,n=t.z,e=i.x,r=i.y,_=i.z,l=e-a,h=r-o,c=_-n;let m,b,p,x=l*a+h*o+c*n;return x=-x/(l*l+h*h+c*c),x<0?(s.x=a,s.y=o,s.z=n,1):x>1?(s.x=e,s.y=r,s.z=_,2):(m=a+l*x,b=o+h*x,p=n+c*x,s.x=m,s.y=b,s.z=p,3)}static projectOrigin3(t,i,s,a){let o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B;o=t.x,n=t.y,e=t.z,r=i.x,_=i.y,l=i.z,h=s.x,c=s.y,m=s.z,b=r-o,p=_-n,x=l-e,f=h-r,u=c-_,y=m-l,v=o-h,d=n-c,g=e-m,X=p*y-x*u,Y=x*f-b*y,z=b*u-p*f,Z=p*z-x*Y,M=x*X-b*z,I=b*Y-p*X,V=u*z-y*Y,L=y*X-f*z,w=f*Y-u*X,k=d*z-g*Y,A=g*X-v*z,B=v*Y-d*X;let P,S,T,C=-1,j=0;if(P=0,S=0,T=0,o*Z+n*M+e*I<0){let s,o,n,e,r,_,l,h,c;s=t.x,o=t.y,n=t.z,e=i.x,r=i.y,_=i.z,l=e-s,h=r-o,c=_-n;let m,b=l*s+h*o+c*n;if(b=-b/(l*l+h*h+c*c),b<0)a.x=s,a.y=o,a.z=n,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let t,i,e;t=s+l*b,i=o+h*b,e=n+c*b,a.x=t,a.y=i,a.z=e,m=3}j=m,C=a.x*a.x+a.y*a.y+a.z*a.z,P=a.x,S=a.y,T=a.z}if(r*V+_*L+l*w<0){let t,o,n,e,r,_,l,h,c;t=i.x,o=i.y,n=i.z,e=s.x,r=s.y,_=s.z,l=e-t,h=r-o,c=_-n;let m,b=l*t+h*o+c*n;if(b=-b/(l*l+h*h+c*c),b<0)a.x=t,a.y=o,a.z=n,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let i,s,e;i=t+l*b,s=o+h*b,e=n+c*b,a.x=i,a.y=s,a.z=e,m=3}let p=a.x*a.x+a.y*a.y+a.z*a.z;(C<0||p<C)&&(j=m<<1,C=p,P=a.x,S=a.y,T=a.z)}if(h*k+c*A+m*B<0){let i,o,n,e,r,_,l,h,c;i=t.x,o=t.y,n=t.z,e=s.x,r=s.y,_=s.z,l=e-i,h=r-o,c=_-n;let m,b=l*i+h*o+c*n;if(b=-b/(l*l+h*h+c*c),b<0)a.x=i,a.y=o,a.z=n,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let t,s,e;t=i+l*b,s=o+h*b,e=n+c*b,a.x=t,a.y=s,a.z=e,m=3}let p=a.x*a.x+a.y*a.y+a.z*a.z;(C<0||p<C)&&(j=1&m|(2&m)<<1,C=p,P=a.x,S=a.y,T=a.z)}if(C>0)return a.x=P,a.y=S,a.z=T,j;let R=X*X+Y*Y+z*z;R>0&&(R=1/Math.sqrt(R)),X*=R,Y*=R,z*=R;let E=X*X+Y*Y+z*z;return E=(o*X+n*Y+e*z)/E,P=X*E,S=Y*E,T=z*E,a.x=P,a.y=S,a.z=T,7}static projectOrigin4(t,i,s,a,o){let n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T,C,j,R,E,q,N,D;n=t.x,e=t.y,r=t.z,_=i.x,l=i.y,h=i.z,c=s.x,m=s.y,b=s.z,p=a.x,x=a.y,f=a.z,u=_-n,y=l-e,v=h-r,d=c-n,g=m-e,X=b-r,Y=p-n,z=x-e,Z=f-r,M=c-_,I=m-l,V=b-h,L=p-_,w=x-l,k=f-h,A=y*X-v*g,B=v*d-u*X,P=u*g-y*d,S=g*Z-X*z,T=X*Y-d*Z,C=d*z-g*Y,j=z*v-Z*y,R=Z*u-Y*v,E=Y*y-z*u,q=w*V-k*I,N=k*M-L*V,D=L*I-w*M;let F,H,G,W=u*q+y*N+v*D>0?1:-1,O=-1,J=0;if(F=0,H=0,G=0,(n*A+e*B+r*P)*W<0){let a,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B;a=t.x,n=t.y,e=t.z,r=i.x,_=i.y,l=i.z,h=s.x,c=s.y,m=s.z,b=r-a,p=_-n,x=l-e,f=h-r,u=c-_,y=m-l,v=a-h,d=n-c,g=e-m,X=p*y-x*u,Y=x*f-b*y,z=b*u-p*f,Z=p*z-x*Y,M=x*X-b*z,I=b*Y-p*X,V=u*z-y*Y,L=y*X-f*z,w=f*Y-u*X,k=d*z-g*Y,A=g*X-v*z,B=v*Y-d*X;let P,S,T,C,j=-1,R=0;if(P=0,S=0,T=0,a*Z+n*M+e*I<0){let s,a,n,e,r,_,l,h,c;s=t.x,a=t.y,n=t.z,e=i.x,r=i.y,_=i.z,l=e-s,h=r-a,c=_-n;let m,b=l*s+h*a+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=s,o.y=a,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let t,i,e;t=s+l*b,i=a+h*b,e=n+c*b,o.x=t,o.y=i,o.z=e,m=3}R=m,j=o.x*o.x+o.y*o.y+o.z*o.z,P=o.x,S=o.y,T=o.z}if(r*V+_*L+l*w<0){let t,a,n,e,r,_,l,h,c;t=i.x,a=i.y,n=i.z,e=s.x,r=s.y,_=s.z,l=e-t,h=r-a,c=_-n;let m,b=l*t+h*a+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=t,o.y=a,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let i,s,e;i=t+l*b,s=a+h*b,e=n+c*b,o.x=i,o.y=s,o.z=e,m=3}let p=o.x*o.x+o.y*o.y+o.z*o.z;(j<0||p<j)&&(R=m<<1,j=p,P=o.x,S=o.y,T=o.z)}if(h*k+c*A+m*B<0){let i,a,n,e,r,_,l,h,c;i=t.x,a=t.y,n=t.z,e=s.x,r=s.y,_=s.z,l=e-i,h=r-a,c=_-n;let m,b=l*i+h*a+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=i,o.y=a,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let t,s,e;t=i+l*b,s=a+h*b,e=n+c*b,o.x=t,o.y=s,o.z=e,m=3}let p=o.x*o.x+o.y*o.y+o.z*o.z;(j<0||p<j)&&(R=1&m|(2&m)<<1,j=p,P=o.x,S=o.y,T=o.z)}if(j>0)o.x=P,o.y=S,o.z=T,C=R;else{let t=X*X+Y*Y+z*z;t>0&&(t=1/Math.sqrt(t)),X*=t,Y*=t,z*=t;let i=X*X+Y*Y+z*z;i=(a*X+n*Y+e*z)/i,P=X*i,S=Y*i,T=z*i,o.x=P,o.y=S,o.z=T,C=7}J=C,O=o.x*o.x+o.y*o.y+o.z*o.z,F=o.x,H=o.y,G=o.z}if((n*S+e*T+r*C)*W<0){let i,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B;i=t.x,n=t.y,e=t.z,r=s.x,_=s.y,l=s.z,h=a.x,c=a.y,m=a.z,b=r-i,p=_-n,x=l-e,f=h-r,u=c-_,y=m-l,v=i-h,d=n-c,g=e-m,X=p*y-x*u,Y=x*f-b*y,z=b*u-p*f,Z=p*z-x*Y,M=x*X-b*z,I=b*Y-p*X,V=u*z-y*Y,L=y*X-f*z,w=f*Y-u*X,k=d*z-g*Y,A=g*X-v*z,B=v*Y-d*X;let P,S,T,C,j=-1,R=0;if(P=0,S=0,T=0,i*Z+n*M+e*I<0){let i,a,n,e,r,_,l,h,c;i=t.x,a=t.y,n=t.z,e=s.x,r=s.y,_=s.z,l=e-i,h=r-a,c=_-n;let m,b=l*i+h*a+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=i,o.y=a,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let t,s,e;t=i+l*b,s=a+h*b,e=n+c*b,o.x=t,o.y=s,o.z=e,m=3}R=m,j=o.x*o.x+o.y*o.y+o.z*o.z,P=o.x,S=o.y,T=o.z}if(r*V+_*L+l*w<0){let t,i,n,e,r,_,l,h,c;t=s.x,i=s.y,n=s.z,e=a.x,r=a.y,_=a.z,l=e-t,h=r-i,c=_-n;let m,b=l*t+h*i+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=t,o.y=i,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let s,a,e;s=t+l*b,a=i+h*b,e=n+c*b,o.x=s,o.y=a,o.z=e,m=3}let p=o.x*o.x+o.y*o.y+o.z*o.z;(j<0||p<j)&&(R=m<<1,j=p,P=o.x,S=o.y,T=o.z)}if(h*k+c*A+m*B<0){let i,s,n,e,r,_,l,h,c;i=t.x,s=t.y,n=t.z,e=a.x,r=a.y,_=a.z,l=e-i,h=r-s,c=_-n;let m,b=l*i+h*s+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=i,o.y=s,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let t,a,e;t=i+l*b,a=s+h*b,e=n+c*b,o.x=t,o.y=a,o.z=e,m=3}let p=o.x*o.x+o.y*o.y+o.z*o.z;(j<0||p<j)&&(R=1&m|(2&m)<<1,j=p,P=o.x,S=o.y,T=o.z)}if(j>0)o.x=P,o.y=S,o.z=T,C=R;else{let t=X*X+Y*Y+z*z;t>0&&(t=1/Math.sqrt(t)),X*=t,Y*=t,z*=t;let s=X*X+Y*Y+z*z;s=(i*X+n*Y+e*z)/s,P=X*s,S=Y*s,T=z*s,o.x=P,o.y=S,o.z=T,C=7}let E=o.x*o.x+o.y*o.y+o.z*o.z;(O<0||E<O)&&(J=1&C|(6&C)<<1,O=E,F=o.x,H=o.y,G=o.z)}if((n*j+e*R+r*E)*W<0){let s,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B;s=t.x,n=t.y,e=t.z,r=i.x,_=i.y,l=i.z,h=a.x,c=a.y,m=a.z,b=r-s,p=_-n,x=l-e,f=h-r,u=c-_,y=m-l,v=s-h,d=n-c,g=e-m,X=p*y-x*u,Y=x*f-b*y,z=b*u-p*f,Z=p*z-x*Y,M=x*X-b*z,I=b*Y-p*X,V=u*z-y*Y,L=y*X-f*z,w=f*Y-u*X,k=d*z-g*Y,A=g*X-v*z,B=v*Y-d*X;let P,S,T,C,j=-1,R=0;if(P=0,S=0,T=0,s*Z+n*M+e*I<0){let s,a,n,e,r,_,l,h,c;s=t.x,a=t.y,n=t.z,e=i.x,r=i.y,_=i.z,l=e-s,h=r-a,c=_-n;let m,b=l*s+h*a+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=s,o.y=a,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let t,i,e;t=s+l*b,i=a+h*b,e=n+c*b,o.x=t,o.y=i,o.z=e,m=3}R=m,j=o.x*o.x+o.y*o.y+o.z*o.z,P=o.x,S=o.y,T=o.z}if(r*V+_*L+l*w<0){let t,s,n,e,r,_,l,h,c;t=i.x,s=i.y,n=i.z,e=a.x,r=a.y,_=a.z,l=e-t,h=r-s,c=_-n;let m,b=l*t+h*s+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=t,o.y=s,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let i,a,e;i=t+l*b,a=s+h*b,e=n+c*b,o.x=i,o.y=a,o.z=e,m=3}let p=o.x*o.x+o.y*o.y+o.z*o.z;(j<0||p<j)&&(R=m<<1,j=p,P=o.x,S=o.y,T=o.z)}if(h*k+c*A+m*B<0){let i,s,n,e,r,_,l,h,c;i=t.x,s=t.y,n=t.z,e=a.x,r=a.y,_=a.z,l=e-i,h=r-s,c=_-n;let m,b=l*i+h*s+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=i,o.y=s,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let t,a,e;t=i+l*b,a=s+h*b,e=n+c*b,o.x=t,o.y=a,o.z=e,m=3}let p=o.x*o.x+o.y*o.y+o.z*o.z;(j<0||p<j)&&(R=1&m|(2&m)<<1,j=p,P=o.x,S=o.y,T=o.z)}if(j>0)o.x=P,o.y=S,o.z=T,C=R;else{let t=X*X+Y*Y+z*z;t>0&&(t=1/Math.sqrt(t)),X*=t,Y*=t,z*=t;let i=X*X+Y*Y+z*z;i=(s*X+n*Y+e*z)/i,P=X*i,S=Y*i,T=z*i,o.x=P,o.y=S,o.z=T,C=7}let E=o.x*o.x+o.y*o.y+o.z*o.z;(O<0||E<O)&&(J=3&C|(4&C)<<1,O=E,F=o.x,H=o.y,G=o.z)}if((_*q+l*N+h*D)*W<0){let t,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B;t=i.x,n=i.y,e=i.z,r=s.x,_=s.y,l=s.z,h=a.x,c=a.y,m=a.z,b=r-t,p=_-n,x=l-e,f=h-r,u=c-_,y=m-l,v=t-h,d=n-c,g=e-m,X=p*y-x*u,Y=x*f-b*y,z=b*u-p*f,Z=p*z-x*Y,M=x*X-b*z,I=b*Y-p*X,V=u*z-y*Y,L=y*X-f*z,w=f*Y-u*X,k=d*z-g*Y,A=g*X-v*z,B=v*Y-d*X;let P,S,T,C,j=-1,R=0;if(P=0,S=0,T=0,t*Z+n*M+e*I<0){let t,a,n,e,r,_,l,h,c;t=i.x,a=i.y,n=i.z,e=s.x,r=s.y,_=s.z,l=e-t,h=r-a,c=_-n;let m,b=l*t+h*a+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=t,o.y=a,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let i,s,e;i=t+l*b,s=a+h*b,e=n+c*b,o.x=i,o.y=s,o.z=e,m=3}R=m,j=o.x*o.x+o.y*o.y+o.z*o.z,P=o.x,S=o.y,T=o.z}if(r*V+_*L+l*w<0){let t,i,n,e,r,_,l,h,c;t=s.x,i=s.y,n=s.z,e=a.x,r=a.y,_=a.z,l=e-t,h=r-i,c=_-n;let m,b=l*t+h*i+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=t,o.y=i,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let s,a,e;s=t+l*b,a=i+h*b,e=n+c*b,o.x=s,o.y=a,o.z=e,m=3}let p=o.x*o.x+o.y*o.y+o.z*o.z;(j<0||p<j)&&(R=m<<1,j=p,P=o.x,S=o.y,T=o.z)}if(h*k+c*A+m*B<0){let t,s,n,e,r,_,l,h,c;t=i.x,s=i.y,n=i.z,e=a.x,r=a.y,_=a.z,l=e-t,h=r-s,c=_-n;let m,b=l*t+h*s+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=t,o.y=s,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let i,a,e;i=t+l*b,a=s+h*b,e=n+c*b,o.x=i,o.y=a,o.z=e,m=3}let p=o.x*o.x+o.y*o.y+o.z*o.z;(j<0||p<j)&&(R=1&m|(2&m)<<1,j=p,P=o.x,S=o.y,T=o.z)}if(j>0)o.x=P,o.y=S,o.z=T,C=R;else{let i=X*X+Y*Y+z*z;i>0&&(i=1/Math.sqrt(i)),X*=i,Y*=i,z*=i;let s=X*X+Y*Y+z*z;s=(t*X+n*Y+e*z)/s,P=X*s,S=Y*s,T=z*s,o.x=P,o.y=S,o.z=T,C=7}let E=o.x*o.x+o.y*o.y+o.z*o.z;(O<0||E<O)&&(J=C<<1,O=E,F=o.x,H=o.y,G=o.z)}return O>0?(o.x=F,o.y=H,o.z=G,J):(o.zero(),15)}},s.common.Mat3=class{constructor(t,i,a,o,n,e,r,_,l){null==l&&(l=1),null==_&&(_=0),null==r&&(r=0),null==e&&(e=0),null==n&&(n=1),null==o&&(o=0),null==a&&(a=0),null==i&&(i=0),null==t&&(t=1),this.e00=t,this.e01=i,this.e02=a,this.e10=o,this.e11=n,this.e12=e,this.e20=r,this.e21=_,this.e22=l,s.common.Mat3.numCreations++}init(t,i,s,a,o,n,e,r,_){return this.e00=t,this.e01=i,this.e02=s,this.e10=a,this.e11=o,this.e12=n,this.e20=e,this.e21=r,this.e22=_,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e10=0,this.e11=1,this.e12=0,this.e20=0,this.e21=0,this.e22=1,this}add(t){return new s.common.Mat3(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22)}sub(t){return new s.common.Mat3(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22)}scale(t){return new s.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*t,this.e11*t,this.e12*t,this.e20*t,this.e21*t,this.e22*t)}mul(t){return new s.common.Mat3(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22)}addEq(t){return this.e00+=t.e00,this.e01+=t.e01,this.e02+=t.e02,this.e10+=t.e10,this.e11+=t.e11,this.e12+=t.e12,this.e20+=t.e20,this.e21+=t.e21,this.e22+=t.e22,this}subEq(t){return this.e00-=t.e00,this.e01-=t.e01,this.e02-=t.e02,this.e10-=t.e10,this.e11-=t.e11,this.e12-=t.e12,this.e20-=t.e20,this.e21-=t.e21,this.e22-=t.e22,this}scaleEq(t){return this.e00*=t,this.e01*=t,this.e02*=t,this.e10*=t,this.e11*=t,this.e12*=t,this.e20*=t,this.e21*=t,this.e22*=t,this}mulEq(t){let i=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,s=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,a=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,o=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,n=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,e=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,r=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,_=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e01=i,this.e02=s,this.e10=a,this.e11=o,this.e12=n,this.e20=e,this.e21=r,this.e22=_,this}prependScale(t,i,a){return new s.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*i,this.e11*i,this.e12*i,this.e20*a,this.e21*a,this.e22*a)}appendScale(t,i,a){return new s.common.Mat3(this.e00*t,this.e01*i,this.e02*a,this.e10*t,this.e11*i,this.e12*a,this.e20*t,this.e21*i,this.e22*a)}prependRotation(t,i,a,o){let n=Math.sin(t),e=Math.cos(t),r=1-e,_=i*i*r+e,l=i*a*r-o*n,h=i*o*r+a*n,c=a*i*r+o*n,m=a*a*r+e,b=a*o*r-i*n,p=o*i*r-a*n,x=o*a*r+i*n,f=o*o*r+e;return new s.common.Mat3(_*this.e00+l*this.e10+h*this.e20,_*this.e01+l*this.e11+h*this.e21,_*this.e02+l*this.e12+h*this.e22,c*this.e00+m*this.e10+b*this.e20,c*this.e01+m*this.e11+b*this.e21,c*this.e02+m*this.e12+b*this.e22,p*this.e00+x*this.e10+f*this.e20,p*this.e01+x*this.e11+f*this.e21,p*this.e02+x*this.e12+f*this.e22)}appendRotation(t,i,a,o){let n=Math.sin(t),e=Math.cos(t),r=1-e,_=i*i*r+e,l=i*a*r-o*n,h=i*o*r+a*n,c=a*i*r+o*n,m=a*a*r+e,b=a*o*r-i*n,p=o*i*r-a*n,x=o*a*r+i*n,f=o*o*r+e;return new s.common.Mat3(this.e00*_+this.e01*c+this.e02*p,this.e00*l+this.e01*m+this.e02*x,this.e00*h+this.e01*b+this.e02*f,this.e10*_+this.e11*c+this.e12*p,this.e10*l+this.e11*m+this.e12*x,this.e10*h+this.e11*b+this.e12*f,this.e20*_+this.e21*c+this.e22*p,this.e20*l+this.e21*m+this.e22*x,this.e20*h+this.e21*b+this.e22*f)}prependScaleEq(t,i,s){return this.e00*=t,this.e01*=t,this.e02*=t,this.e10*=i,this.e11*=i,this.e12*=i,this.e20*=s,this.e21*=s,this.e22*=s,this}appendScaleEq(t,i,s){return this.e00*=t,this.e01*=i,this.e02*=s,this.e10*=t,this.e11*=i,this.e12*=s,this.e20*=t,this.e21*=i,this.e22*=s,this}prependRotationEq(t,i,s,a){let o=Math.sin(t),n=Math.cos(t),e=1-n,r=i*i*e+n,_=i*s*e-a*o,l=i*a*e+s*o,h=s*i*e+a*o,c=s*s*e+n,m=s*a*e-i*o,b=a*i*e-s*o,p=a*s*e+i*o,x=a*a*e+n,f=h*this.e00+c*this.e10+m*this.e20,u=h*this.e01+c*this.e11+m*this.e21,y=h*this.e02+c*this.e12+m*this.e22,v=b*this.e00+p*this.e10+x*this.e20,d=b*this.e01+p*this.e11+x*this.e21,g=b*this.e02+p*this.e12+x*this.e22;return this.e00=r*this.e00+_*this.e10+l*this.e20,this.e01=r*this.e01+_*this.e11+l*this.e21,this.e02=r*this.e02+_*this.e12+l*this.e22,this.e10=f,this.e11=u,this.e12=y,this.e20=v,this.e21=d,this.e22=g,this}appendRotationEq(t,i,s,a){let o=Math.sin(t),n=Math.cos(t),e=1-n,r=i*i*e+n,_=i*s*e-a*o,l=i*a*e+s*o,h=s*i*e+a*o,c=s*s*e+n,m=s*a*e-i*o,b=a*i*e-s*o,p=a*s*e+i*o,x=a*a*e+n,f=this.e00*_+this.e01*c+this.e02*p,u=this.e00*l+this.e01*m+this.e02*x,y=this.e10*_+this.e11*c+this.e12*p,v=this.e10*l+this.e11*m+this.e12*x,d=this.e20*_+this.e21*c+this.e22*p,g=this.e20*l+this.e21*m+this.e22*x;return this.e00=this.e00*r+this.e01*h+this.e02*b,this.e01=f,this.e02=u,this.e10=this.e10*r+this.e11*h+this.e12*b,this.e11=y,this.e12=v,this.e20=this.e20*r+this.e21*h+this.e22*b,this.e21=d,this.e22=g,this}transpose(){return new s.common.Mat3(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)}transposeEq(){let t=this.e01,i=this.e02,s=this.e12;return this.e01=this.e10,this.e02=this.e20,this.e10=t,this.e12=this.e21,this.e20=i,this.e21=s,this}determinant(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)}trace(){return this.e00+this.e11+this.e22}inverse(){let t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,a=this.e10*this.e21-this.e11*this.e20,o=this.e00*t-this.e01*i+this.e02*a;return 0!=o&&(o=1/o),new s.common.Mat3(t*o,-(this.e01*this.e22-this.e02*this.e21)*o,(this.e01*this.e12-this.e02*this.e11)*o,-i*o,(this.e00*this.e22-this.e02*this.e20)*o,-(this.e00*this.e12-this.e02*this.e10)*o,a*o,-(this.e00*this.e21-this.e01*this.e20)*o,(this.e00*this.e11-this.e01*this.e10)*o)}inverseEq(){let t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,s=this.e10*this.e21-this.e11*this.e20,a=this.e00*t-this.e01*i+this.e02*s;0!=a&&(a=1/a);let o=(this.e01*this.e12-this.e02*this.e11)*a,n=(this.e00*this.e22-this.e02*this.e20)*a,e=-(this.e00*this.e12-this.e02*this.e10)*a,r=-(this.e00*this.e21-this.e01*this.e20)*a,_=(this.e00*this.e11-this.e01*this.e10)*a;return this.e00=t*a,this.e01=-(this.e01*this.e22-this.e02*this.e21)*a,this.e02=o,this.e10=-i*a,this.e11=n,this.e12=e,this.e20=s*a,this.e21=r,this.e22=_,this}toArray(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this}clone(){return new s.common.Mat3(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)}fromQuat(t){let i=t.x,s=t.y,a=t.z,o=t.w,n=2*i,e=2*s,r=2*a,_=i*n,l=s*e,h=a*r,c=i*e,m=s*r,b=i*r,p=o*n,x=o*e,f=o*r;return this.e00=1-l-h,this.e01=c-f,this.e02=b+x,this.e10=c+f,this.e11=1-_-h,this.e12=m-p,this.e20=b-x,this.e21=m+p,this.e22=1-_-l,this}toQuat(){let t,i=new s.common.Quat,a=this.e00,o=this.e11,n=this.e22,e=a+o+n;return e>0?(t=Math.sqrt(e+1),i.w=.5*t,t=.5/t,i.x=(this.e21-this.e12)*t,i.y=(this.e02-this.e20)*t,i.z=(this.e10-this.e01)*t):a>o?a>n?(t=Math.sqrt(a-o-n+1),i.x=.5*t,t=.5/t,i.y=(this.e01+this.e10)*t,i.z=(this.e02+this.e20)*t,i.w=(this.e21-this.e12)*t):(t=Math.sqrt(n-a-o+1),i.z=.5*t,t=.5/t,i.x=(this.e02+this.e20)*t,i.y=(this.e12+this.e21)*t,i.w=(this.e10-this.e01)*t):o>n?(t=Math.sqrt(o-n-a+1),i.y=.5*t,t=.5/t,i.x=(this.e01+this.e10)*t,i.z=(this.e12+this.e21)*t,i.w=(this.e02-this.e20)*t):(t=Math.sqrt(n-a-o+1),i.z=.5*t,t=.5/t,i.x=(this.e02+this.e20)*t,i.y=(this.e12+this.e21)*t,i.w=(this.e10-this.e01)*t),i}fromEulerXyz(t){let i=Math.sin(t.x),s=Math.sin(t.y),a=Math.sin(t.z),o=Math.cos(t.x),n=Math.cos(t.y),e=Math.cos(t.z);return this.e00=n*e,this.e01=-n*a,this.e02=s,this.e10=o*a+e*i*s,this.e11=o*e-i*s*a,this.e12=-n*i,this.e20=i*a-o*e*s,this.e21=e*i+o*s*a,this.e22=o*n,this}toEulerXyz(){let t=this.e02;if(t<=-1){let t=Math.atan2(this.e21,this.e11);return new s.common.Vec3(.5*t,-1.570796326794895,.5*-t)}if(t>=1){let t=Math.atan2(this.e21,this.e11);return new s.common.Vec3(.5*t,1.570796326794895,.5*t)}return new s.common.Vec3(Math.atan2(-this.e12,this.e22),Math.asin(t),Math.atan2(-this.e01,this.e00))}getRow(t){return 0==t?new s.common.Vec3(this.e00,this.e01,this.e02):1==t?new s.common.Vec3(this.e10,this.e11,this.e12):2==t?new s.common.Vec3(this.e20,this.e21,this.e22):null}getCol(t){return 0==t?new s.common.Vec3(this.e00,this.e10,this.e20):1==t?new s.common.Vec3(this.e01,this.e11,this.e21):2==t?new s.common.Vec3(this.e02,this.e12,this.e22):null}getRowTo(t,i){0==t?i.init(this.e00,this.e01,this.e02):1==t?i.init(this.e10,this.e11,this.e12):2==t?i.init(this.e20,this.e21,this.e22):i.zero()}getColTo(t,i){0==t?i.init(this.e00,this.e10,this.e20):1==t?i.init(this.e01,this.e11,this.e21):2==t?i.init(this.e02,this.e12,this.e22):i.zero()}fromRows(t,i,s){return this.e00=t.x,this.e01=t.y,this.e02=t.z,this.e10=i.x,this.e11=i.y,this.e12=i.z,this.e20=s.x,this.e21=s.y,this.e22=s.z,this}fromCols(t,i,s){return this.e00=t.x,this.e01=i.x,this.e02=s.x,this.e10=t.y,this.e11=i.y,this.e12=s.y,this.e20=t.z,this.e21=i.z,this.e22=s.z,this}toString(){return"Mat3["+(this.e00>0?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(this.e01>0?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(this.e02>0?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+",\n     "+(this.e10>0?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(this.e11>0?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(this.e12>0?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+",\n     "+(this.e20>0?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(this.e21>0?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(this.e22>0?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+"]"}},s.common.Mat4=class{constructor(t,i,a,o,n,e,r,_,l,h,c,m,b,p,x,f){null==f&&(f=1),null==x&&(x=0),null==p&&(p=0),null==b&&(b=0),null==m&&(m=0),null==c&&(c=1),null==h&&(h=0),null==l&&(l=0),null==_&&(_=0),null==r&&(r=0),null==e&&(e=1),null==n&&(n=0),null==o&&(o=0),null==a&&(a=0),null==i&&(i=0),null==t&&(t=1),this.e00=t,this.e01=i,this.e02=a,this.e03=o,this.e10=n,this.e11=e,this.e12=r,this.e13=_,this.e20=l,this.e21=h,this.e22=c,this.e23=m,this.e30=b,this.e31=p,this.e32=x,this.e33=f,s.common.Mat4.numCreations++}init(t,i,s,a,o,n,e,r,_,l,h,c,m,b,p,x){return this.e00=t,this.e01=i,this.e02=s,this.e03=a,this.e10=o,this.e11=n,this.e12=e,this.e13=r,this.e20=_,this.e21=l,this.e22=h,this.e23=c,this.e30=m,this.e31=b,this.e32=p,this.e33=x,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=1,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=1,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}add(t){return new s.common.Mat4(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e03+t.e03,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e13+t.e13,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22,this.e23+t.e23,this.e30+t.e30,this.e31+t.e31,this.e32+t.e32,this.e33+t.e33)}sub(t){return new s.common.Mat4(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e03-t.e03,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e13-t.e13,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22,this.e23-t.e23,this.e30-t.e30,this.e31-t.e31,this.e32-t.e32,this.e33-t.e33)}scale(t){return new s.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*t,this.e21*t,this.e22*t,this.e23*t,this.e30*t,this.e31*t,this.e32*t,this.e33*t)}mul(t){return new s.common.Mat4(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33)}addEq(t){return this.e00+=t.e00,this.e01+=t.e01,this.e02+=t.e02,this.e03+=t.e03,this.e10+=t.e10,this.e11+=t.e11,this.e12+=t.e12,this.e13+=t.e13,this.e20+=t.e20,this.e21+=t.e21,this.e22+=t.e22,this.e23+=t.e23,this.e30+=t.e30,this.e31+=t.e31,this.e32+=t.e32,this.e33+=t.e33,this}subEq(t){return this.e00-=t.e00,this.e01-=t.e01,this.e02-=t.e02,this.e03-=t.e03,this.e10-=t.e10,this.e11-=t.e11,this.e12-=t.e12,this.e13-=t.e13,this.e20-=t.e20,this.e21-=t.e21,this.e22-=t.e22,this.e23-=t.e23,this.e30-=t.e30,this.e31-=t.e31,this.e32-=t.e32,this.e33-=t.e33,this}scaleEq(t){return this.e00*=t,this.e01*=t,this.e02*=t,this.e03*=t,this.e10*=t,this.e11*=t,this.e12*=t,this.e13*=t,this.e20*=t,this.e21*=t,this.e22*=t,this.e23*=t,this.e30*=t,this.e31*=t,this.e32*=t,this.e33*=t,this}mulEq(t){let i=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,s=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,a=this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,o=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,n=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,e=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,r=this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,_=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,l=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,h=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,c=this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,m=this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,b=this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,p=this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,x=this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e01=i,this.e02=s,this.e03=a,this.e10=o,this.e11=n,this.e12=e,this.e13=r,this.e20=_,this.e21=l,this.e22=h,this.e23=c,this.e30=m,this.e31=b,this.e32=p,this.e33=x,this}prependScale(t,i,a){return new s.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*i,this.e11*i,this.e12*i,this.e13*i,this.e20*a,this.e21*a,this.e22*a,this.e23*a,this.e30,this.e31,this.e32,this.e33)}appendScale(t,i,a){return new s.common.Mat4(this.e00*t,this.e01*i,this.e02*a,this.e03,this.e10*t,this.e11*i,this.e12*a,this.e13,this.e20*t,this.e21*i,this.e22*a,this.e23,this.e30*t,this.e31*i,this.e32*a,this.e33)}prependRotation(t,i,a,o){let n=Math.sin(t),e=Math.cos(t),r=1-e,_=i*i*r+e,l=i*a*r-o*n,h=i*o*r+a*n,c=a*i*r+o*n,m=a*a*r+e,b=a*o*r-i*n,p=o*i*r-a*n,x=o*a*r+i*n,f=o*o*r+e;return new s.common.Mat4(_*this.e00+l*this.e10+h*this.e20,_*this.e01+l*this.e11+h*this.e21,_*this.e02+l*this.e12+h*this.e22,_*this.e03+l*this.e13+h*this.e23,c*this.e00+m*this.e10+b*this.e20,c*this.e01+m*this.e11+b*this.e21,c*this.e02+m*this.e12+b*this.e22,c*this.e03+m*this.e13+b*this.e23,p*this.e00+x*this.e10+f*this.e20,p*this.e01+x*this.e11+f*this.e21,p*this.e02+x*this.e12+f*this.e22,p*this.e03+x*this.e13+f*this.e23,this.e30,this.e31,this.e32,this.e33)}appendRotation(t,i,a,o){let n=Math.sin(t),e=Math.cos(t),r=1-e,_=i*i*r+e,l=i*a*r-o*n,h=i*o*r+a*n,c=a*i*r+o*n,m=a*a*r+e,b=a*o*r-i*n,p=o*i*r-a*n,x=o*a*r+i*n,f=o*o*r+e;return new s.common.Mat4(this.e00*_+this.e01*c+this.e02*p,this.e00*l+this.e01*m+this.e02*x,this.e00*h+this.e01*b+this.e02*f,this.e03,this.e10*_+this.e11*c+this.e12*p,this.e10*l+this.e11*m+this.e12*x,this.e10*h+this.e11*b+this.e12*f,this.e13,this.e20*_+this.e21*c+this.e22*p,this.e20*l+this.e21*m+this.e22*x,this.e20*h+this.e21*b+this.e22*f,this.e23,this.e30*_+this.e31*c+this.e32*p,this.e30*l+this.e31*m+this.e32*x,this.e30*h+this.e31*b+this.e32*f,this.e33)}prependTranslation(t,i,a){return new s.common.Mat4(this.e00+t*this.e30,this.e01+t*this.e31,this.e02+t*this.e32,this.e03+t*this.e33,this.e10+i*this.e30,this.e11+i*this.e31,this.e12+i*this.e32,this.e13+i*this.e33,this.e20+a*this.e30,this.e21+a*this.e31,this.e22+a*this.e32,this.e23+a*this.e33,this.e30,this.e31,this.e32,this.e33)}appendTranslation(t,i,a){return new s.common.Mat4(this.e00,this.e01,this.e02,this.e00*t+this.e01*i+this.e02*a+this.e03,this.e10,this.e11,this.e12,this.e10*t+this.e11*i+this.e12*a+this.e13,this.e20,this.e21,this.e22,this.e20*t+this.e21*i+this.e22*a+this.e23,this.e30,this.e31,this.e32,this.e30*t+this.e31*i+this.e32*a+this.e33)}prependScaleEq(t,i,s){return this.e00*=t,this.e01*=t,this.e02*=t,this.e03*=t,this.e10*=i,this.e11*=i,this.e12*=i,this.e13*=i,this.e20*=s,this.e21*=s,this.e22*=s,this.e23*=s,this}appendScaleEq(t,i,s){return this.e00*=t,this.e01*=i,this.e02*=s,this.e10*=t,this.e11*=i,this.e12*=s,this.e20*=t,this.e21*=i,this.e22*=s,this.e30*=t,this.e31*=i,this.e32*=s,this}prependRotationEq(t,i,s,a){let o=Math.sin(t),n=Math.cos(t),e=1-n,r=i*i*e+n,_=i*s*e-a*o,l=i*a*e+s*o,h=s*i*e+a*o,c=s*s*e+n,m=s*a*e-i*o,b=a*i*e-s*o,p=a*s*e+i*o,x=a*a*e+n,f=h*this.e00+c*this.e10+m*this.e20,u=h*this.e01+c*this.e11+m*this.e21,y=h*this.e02+c*this.e12+m*this.e22,v=h*this.e03+c*this.e13+m*this.e23,d=b*this.e00+p*this.e10+x*this.e20,g=b*this.e01+p*this.e11+x*this.e21,X=b*this.e02+p*this.e12+x*this.e22,Y=b*this.e03+p*this.e13+x*this.e23;return this.e00=r*this.e00+_*this.e10+l*this.e20,this.e01=r*this.e01+_*this.e11+l*this.e21,this.e02=r*this.e02+_*this.e12+l*this.e22,this.e03=r*this.e03+_*this.e13+l*this.e23,this.e10=f,this.e11=u,this.e12=y,this.e13=v,this.e20=d,this.e21=g,this.e22=X,this.e23=Y,this}appendRotationEq(t,i,s,a){let o=Math.sin(t),n=Math.cos(t),e=1-n,r=i*i*e+n,_=i*s*e-a*o,l=i*a*e+s*o,h=s*i*e+a*o,c=s*s*e+n,m=s*a*e-i*o,b=a*i*e-s*o,p=a*s*e+i*o,x=a*a*e+n,f=this.e00*_+this.e01*c+this.e02*p,u=this.e00*l+this.e01*m+this.e02*x,y=this.e10*_+this.e11*c+this.e12*p,v=this.e10*l+this.e11*m+this.e12*x,d=this.e20*_+this.e21*c+this.e22*p,g=this.e20*l+this.e21*m+this.e22*x,X=this.e30*_+this.e31*c+this.e32*p,Y=this.e30*l+this.e31*m+this.e32*x;return this.e00=this.e00*r+this.e01*h+this.e02*b,this.e01=f,this.e02=u,this.e10=this.e10*r+this.e11*h+this.e12*b,this.e11=y,this.e12=v,this.e20=this.e20*r+this.e21*h+this.e22*b,this.e21=d,this.e22=g,this.e30=this.e30*r+this.e31*h+this.e32*b,this.e31=X,this.e32=Y,this}prependTranslationEq(t,i,s){return this.e00+=t*this.e30,this.e01+=t*this.e31,this.e02+=t*this.e32,this.e03+=t*this.e33,this.e10+=i*this.e30,this.e11+=i*this.e31,this.e12+=i*this.e32,this.e13+=i*this.e33,this.e20+=s*this.e30,this.e21+=s*this.e31,this.e22+=s*this.e32,this.e23+=s*this.e33,this}appendTranslationEq(t,i,s){let a=this.e00*t+this.e01*i+this.e02*s+this.e03,o=this.e10*t+this.e11*i+this.e12*s+this.e13,n=this.e20*t+this.e21*i+this.e22*s+this.e23,e=this.e30*t+this.e31*i+this.e32*s+this.e33;return this.e03=a,this.e13=o,this.e23=n,this.e33=e,this}transpose(){return new s.common.Mat4(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)}transposeEq(){let t=this.e01,i=this.e02,s=this.e12,a=this.e03,o=this.e13,n=this.e23;return this.e01=this.e10,this.e02=this.e20,this.e03=this.e30,this.e10=t,this.e12=this.e21,this.e13=this.e31,this.e20=i,this.e21=s,this.e23=this.e32,this.e30=a,this.e31=o,this.e32=n,this}determinant(){let t=this.e20*this.e31-this.e21*this.e30,i=this.e20*this.e32-this.e22*this.e30,s=this.e20*this.e33-this.e23*this.e30,a=this.e21*this.e32-this.e22*this.e31,o=this.e21*this.e33-this.e23*this.e31,n=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*n-this.e12*o+this.e13*a)-this.e01*(this.e10*n-this.e12*s+this.e13*i)+this.e02*(this.e10*o-this.e11*s+this.e13*t)-this.e03*(this.e10*a-this.e11*i+this.e12*t)}trace(){return this.e00+this.e11+this.e22+this.e33}inverse(){let t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,a=this.e00*this.e13-this.e03*this.e10,o=this.e01*this.e12-this.e02*this.e11,n=this.e01*this.e13-this.e03*this.e11,e=this.e02*this.e13-this.e03*this.e12,r=this.e20*this.e31-this.e21*this.e30,_=this.e20*this.e32-this.e22*this.e30,l=this.e20*this.e33-this.e23*this.e30,h=this.e21*this.e32-this.e22*this.e31,c=this.e21*this.e33-this.e23*this.e31,m=this.e22*this.e33-this.e23*this.e32,b=this.e11*m-this.e12*c+this.e13*h,p=this.e10*m-this.e12*l+this.e13*_,x=this.e10*c-this.e11*l+this.e13*r,f=this.e10*h-this.e11*_+this.e12*r,u=this.e00*b-this.e01*p+this.e02*x-this.e03*f;return 0!=u&&(u=1/u),new s.common.Mat4(b*u,-(this.e01*m-this.e02*c+this.e03*h)*u,(this.e31*e-this.e32*n+this.e33*o)*u,-(this.e21*e-this.e22*n+this.e23*o)*u,-p*u,(this.e00*m-this.e02*l+this.e03*_)*u,-(this.e30*e-this.e32*a+this.e33*i)*u,(this.e20*e-this.e22*a+this.e23*i)*u,x*u,-(this.e00*c-this.e01*l+this.e03*r)*u,(this.e30*n-this.e31*a+this.e33*t)*u,-(this.e20*n-this.e21*a+this.e23*t)*u,-f*u,(this.e00*h-this.e01*_+this.e02*r)*u,-(this.e30*o-this.e31*i+this.e32*t)*u,(this.e20*o-this.e21*i+this.e22*t)*u)}inverseEq(){let t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,s=this.e00*this.e13-this.e03*this.e10,a=this.e01*this.e12-this.e02*this.e11,o=this.e01*this.e13-this.e03*this.e11,n=this.e02*this.e13-this.e03*this.e12,e=this.e20*this.e31-this.e21*this.e30,r=this.e20*this.e32-this.e22*this.e30,_=this.e20*this.e33-this.e23*this.e30,l=this.e21*this.e32-this.e22*this.e31,h=this.e21*this.e33-this.e23*this.e31,c=this.e22*this.e33-this.e23*this.e32,m=this.e11*c-this.e12*h+this.e13*l,b=this.e10*c-this.e12*_+this.e13*r,p=this.e10*h-this.e11*_+this.e13*e,x=this.e10*l-this.e11*r+this.e12*e,f=this.e00*m-this.e01*b+this.e02*p-this.e03*x;0!=f&&(f=1/f);let u=(this.e00*c-this.e02*_+this.e03*r)*f,y=-(this.e00*h-this.e01*_+this.e03*e)*f,v=-(this.e20*o-this.e21*s+this.e23*t)*f,d=(this.e00*l-this.e01*r+this.e02*e)*f,g=-(this.e30*a-this.e31*i+this.e32*t)*f,X=(this.e20*a-this.e21*i+this.e22*t)*f;return this.e00=m*f,this.e01=-(this.e01*c-this.e02*h+this.e03*l)*f,this.e02=(this.e31*n-this.e32*o+this.e33*a)*f,this.e03=-(this.e21*n-this.e22*o+this.e23*a)*f,this.e10=-b*f,this.e11=u,this.e12=-(this.e30*n-this.e32*s+this.e33*i)*f,this.e13=(this.e20*n-this.e22*s+this.e23*i)*f,this.e20=p*f,this.e21=y,this.e22=(this.e30*o-this.e31*s+this.e33*t)*f,this.e23=v,this.e30=-x*f,this.e31=d,this.e32=g,this.e33=X,this}lookAt(t,i,s,a,o,n,e,r,_){let l=t-a,h=i-o,c=s-n,m=1/Math.sqrt(l*l+h*h+c*c);l*=m,h*=m,c*=m;let b=r*c-_*h,p=_*l-e*c,x=e*h-r*l;m=1/Math.sqrt(b*b+p*p+x*x),b*=m,p*=m,x*=m;let f=h*x-c*p,u=c*b-l*x,y=l*p-h*b;return this.e00=b,this.e01=p,this.e02=x,this.e03=-(b*t+p*i+x*s),this.e10=f,this.e11=u,this.e12=y,this.e13=-(f*t+u*i+y*s),this.e20=l,this.e21=h,this.e22=c,this.e23=-(l*t+h*i+c*s),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}perspective(t,i,s,a){let o=1/Math.tan(.5*t),n=a/(s-a);return this.e00=o/i,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=o,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=n,this.e23=s*n,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this}ortho(t,i,s,a){let o=1/(s-a);return this.e00=2/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/i,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=o,this.e23=s*o,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}toArray(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=t.e03,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=t.e13,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=t.e23,this.e30=t.e30,this.e31=t.e31,this.e32=t.e32,this.e33=t.e33,this}fromMat3(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=0,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=0,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}fromTransform(t){return this.e00=t._rotation00,this.e01=t._rotation01,this.e02=t._rotation02,this.e10=t._rotation10,this.e11=t._rotation11,this.e12=t._rotation12,this.e20=t._rotation20,this.e21=t._rotation21,this.e22=t._rotation22,this.e03=t._positionX,this.e13=t._positionY,this.e23=t._positionZ,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}clone(){return new s.common.Mat4(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)}toString(){return"Mat4["+(this.e00>0?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(this.e01>0?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(this.e02>0?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+", "+(this.e03>0?(1e7*this.e03+.5|0)/1e7:(1e7*this.e03-.5|0)/1e7)+",\n    "+(this.e10>0?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(this.e11>0?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(this.e12>0?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+", "+(this.e13>0?(1e7*this.e13+.5|0)/1e7:(1e7*this.e13-.5|0)/1e7)+",\n    "+(this.e20>0?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(this.e21>0?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(this.e22>0?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+", "+(this.e23>0?(1e7*this.e23+.5|0)/1e7:(1e7*this.e23-.5|0)/1e7)+",\n    "+(this.e30>0?(1e7*this.e30+.5|0)/1e7:(1e7*this.e30-.5|0)/1e7)+", "+(this.e31>0?(1e7*this.e31+.5|0)/1e7:(1e7*this.e31-.5|0)/1e7)+", "+(this.e32>0?(1e7*this.e32+.5|0)/1e7:(1e7*this.e32-.5|0)/1e7)+", "+(this.e33>0?(1e7*this.e33+.5|0)/1e7:(1e7*this.e33-.5|0)/1e7)+"]"}},s.common.MathUtil=class{static abs(t){return t>0?t:-t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static tan(t){return Math.tan(t)}static asin(t){return Math.asin(t)}static acos(t){return Math.acos(t)}static atan(t){return Math.atan(t)}static safeAsin(t){return t<=-1?-1.570796326794895:t>=1?1.570796326794895:Math.asin(t)}static safeAcos(t){return t<=-1?3.14159265358979:t>=1?0:Math.acos(t)}static atan2(t,i){return Math.atan2(t,i)}static sqrt(t){return Math.sqrt(t)}static clamp(t,i,s){return t<i?i:t>s?s:t}static rand(){return Math.random()}static randIn(t,i){return t+Math.random()*(i-t)}static randVec3In(t,i){return new s.common.Vec3(t+Math.random()*(i-t),t+Math.random()*(i-t),t+Math.random()*(i-t))}static randVec3(){return new s.common.Vec3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1)}},s.common.Pool=class{constructor(){this.stackVec3=new Array(256),this.sizeVec3=0,this.stackMat3=new Array(256),this.sizeMat3=0,this.stackMat4=new Array(256),this.sizeMat4=0,this.stackQuat=new Array(256),this.sizeQuat=0}vec3(){return 0==this.sizeVec3?new s.common.Vec3:this.stackVec3[--this.sizeVec3]}mat3(){return 0==this.sizeMat3?new s.common.Mat3:this.stackMat3[--this.sizeMat3]}mat4(){return 0==this.sizeMat4?new s.common.Mat4:this.stackMat4[--this.sizeMat4]}quat(){return 0==this.sizeQuat?new s.common.Quat:this.stackQuat[--this.sizeQuat]}dispose(t,i,s,a){if(null!=t){if(t.zero(),this.sizeVec3==this.stackVec3.length){let t=new Array(this.sizeVec3<<1),i=0,s=this.sizeVec3;for(;i<s;){let s=i++;t[s]=this.stackVec3[s],this.stackVec3[s]=null}this.stackVec3=t}this.stackVec3[this.sizeVec3++]=t}if(null!=i){if(i.e00=1,i.e01=0,i.e02=0,i.e10=0,i.e11=1,i.e12=0,i.e20=0,i.e21=0,i.e22=1,this.sizeMat3==this.stackMat3.length){let t=new Array(this.sizeMat3<<1),i=0,s=this.sizeMat3;for(;i<s;){let s=i++;t[s]=this.stackMat3[s],this.stackMat3[s]=null}this.stackMat3=t}this.stackMat3[this.sizeMat3++]=i}if(null!=s){if(s.e00=1,s.e01=0,s.e02=0,s.e03=0,s.e10=0,s.e11=1,s.e12=0,s.e13=0,s.e20=0,s.e21=0,s.e22=1,s.e23=0,s.e30=0,s.e31=0,s.e32=0,s.e33=1,this.sizeMat4==this.stackMat4.length){let t=new Array(this.sizeMat4<<1),i=0,s=this.sizeMat4;for(;i<s;){let s=i++;t[s]=this.stackMat4[s],this.stackMat4[s]=null}this.stackMat4=t}this.stackMat4[this.sizeMat4++]=s}if(null!=a){if(a.x=0,a.y=0,a.z=0,a.w=1,this.sizeQuat==this.stackQuat.length){let t=new Array(this.sizeQuat<<1),i=0,s=this.sizeQuat;for(;i<s;){let s=i++;t[s]=this.stackQuat[s],this.stackQuat[s]=null}this.stackQuat=t}this.stackQuat[this.sizeQuat++]=a}}disposeVec3(t){if(t.zero(),this.sizeVec3==this.stackVec3.length){let t=new Array(this.sizeVec3<<1),i=0,s=this.sizeVec3;for(;i<s;){let s=i++;t[s]=this.stackVec3[s],this.stackVec3[s]=null}this.stackVec3=t}this.stackVec3[this.sizeVec3++]=t}disposeMat3(t){if(t.e00=1,t.e01=0,t.e02=0,t.e10=0,t.e11=1,t.e12=0,t.e20=0,t.e21=0,t.e22=1,this.sizeMat3==this.stackMat3.length){let t=new Array(this.sizeMat3<<1),i=0,s=this.sizeMat3;for(;i<s;){let s=i++;t[s]=this.stackMat3[s],this.stackMat3[s]=null}this.stackMat3=t}this.stackMat3[this.sizeMat3++]=t}disposeMat4(t){if(t.e00=1,t.e01=0,t.e02=0,t.e03=0,t.e10=0,t.e11=1,t.e12=0,t.e13=0,t.e20=0,t.e21=0,t.e22=1,t.e23=0,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this.sizeMat4==this.stackMat4.length){let t=new Array(this.sizeMat4<<1),i=0,s=this.sizeMat4;for(;i<s;){let s=i++;t[s]=this.stackMat4[s],this.stackMat4[s]=null}this.stackMat4=t}this.stackMat4[this.sizeMat4++]=t}disposeQuat(t){if(t.x=0,t.y=0,t.z=0,t.w=1,this.sizeQuat==this.stackQuat.length){let t=new Array(this.sizeQuat<<1),i=0,s=this.sizeQuat;for(;i<s;){let s=i++;t[s]=this.stackQuat[s],this.stackQuat[s]=null}this.stackQuat=t}this.stackQuat[this.sizeQuat++]=t}},s.common.Quat=class{constructor(t,i,a,o){null==o&&(o=1),null==a&&(a=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.z=a,this.w=o,s.common.Quat.numCreations++}identity(){return this.x=0,this.y=0,this.z=0,this.w=1,this}init(t,i,s,a){return this.x=t,this.y=i,this.z=s,this.w=a,this}add(t){return new s.common.Quat(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}sub(t){return new s.common.Quat(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}scale(t){return new s.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)}addEq(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}subEq(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}scaleEq(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}normalized(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),new s.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}setArc(t,i){let s=t.x,a=t.y,o=t.z,n=i.x,e=i.y,r=i.z,_=s*n+a*e+o*r;return this.w=Math.sqrt(.5*(1+_)),0==this.w?(n=s*s,e=a*a,r=o*o,n<e?n<r?(_=1/Math.sqrt(e+r),this.x=0,this.y=o*_,this.z=-a*_):(_=1/Math.sqrt(n+e),this.z=0,this.x=a*_,this.y=-s*_):e<r?(_=1/Math.sqrt(r+n),this.y=0,this.z=s*_,this.x=-o*_):(_=1/Math.sqrt(n+e),this.z=0,this.x=a*_,this.y=-s*_),this):(_=.5/this.w,this.x=(a*r-o*e)*_,this.y=(o*n-s*r)*_,this.z=(s*e-a*n)*_,this)}slerp(t,i){let a,o,n,e,r=this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;if(r<0?(r=-r,a=-t.x,o=-t.y,n=-t.z,e=-t.w):(a=t.x,o=t.y,n=t.z,e=t.w),r>.999999){let t=new s.common.Quat(this.x+(a-this.x)*i,this.y+(o-this.y)*i,this.z+(n-this.z)*i,this.w+(e-this.w)*i),r=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w);return r>0&&(r=1/r),t.x*=r,t.y*=r,t.z*=r,t.w*=r,t}let _=i*Math.acos(r);a-=this.x*r,o-=this.y*r,n-=this.z*r,e-=this.w*r;let l=1/Math.sqrt(a*a+o*o+n*n+e*e);a*=l,o*=l,n*=l,e*=l;let h=Math.sin(_),c=Math.cos(_);return new s.common.Quat(this.x*c+a*h,this.y*c+o*h,this.z*c+n*h,this.w*c+e*h)}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}clone(){return new s.common.Quat(this.x,this.y,this.z,this.w)}fromMat3(t){let i,s=t.e00,a=t.e11,o=t.e22,n=s+a+o;return n>0?(i=Math.sqrt(n+1),this.w=.5*i,i=.5/i,this.x=(t.e21-t.e12)*i,this.y=(t.e02-t.e20)*i,this.z=(t.e10-t.e01)*i):s>a?s>o?(i=Math.sqrt(s-a-o+1),this.x=.5*i,i=.5/i,this.y=(t.e01+t.e10)*i,this.z=(t.e02+t.e20)*i,this.w=(t.e21-t.e12)*i):(i=Math.sqrt(o-s-a+1),this.z=.5*i,i=.5/i,this.x=(t.e02+t.e20)*i,this.y=(t.e12+t.e21)*i,this.w=(t.e10-t.e01)*i):a>o?(i=Math.sqrt(a-o-s+1),this.y=.5*i,i=.5/i,this.x=(t.e01+t.e10)*i,this.z=(t.e12+t.e21)*i,this.w=(t.e02-t.e20)*i):(i=Math.sqrt(o-s-a+1),this.z=.5*i,i=.5/i,this.x=(t.e02+t.e20)*i,this.y=(t.e12+t.e21)*i,this.w=(t.e10-t.e01)*i),this}toMat3(){let t=new s.common.Mat3,i=this.x,a=this.y,o=this.z,n=this.w,e=2*i,r=2*a,_=2*o,l=i*e,h=a*r,c=o*_,m=i*r,b=a*_,p=i*_,x=n*e,f=n*r,u=n*_;return t.e00=1-h-c,t.e01=m-u,t.e02=p+f,t.e10=m+u,t.e11=1-l-c,t.e12=b-x,t.e20=p-f,t.e21=b+x,t.e22=1-l-h,t}toString(){return"Quat["+(this.x>0?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+" i,\n    "+(this.y>0?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+" j,\n    "+(this.z>0?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+" k,\n    "+(this.w>0?(1e7*this.w+.5|0)/1e7:(1e7*this.w-.5|0)/1e7)+"]"}},s.dynamics||(s.dynamics={}),s.dynamics.Contact=class{constructor(){this._next=null,this._prev=null,this._link1=new s.dynamics.ContactLink,this._link2=new s.dynamics.ContactLink,this._s1=null,this._s2=null,this._b1=null,this._b2=null,this._detector=null,this._cachedDetectorData=new s.collision.narrowphase.detector.CachedDetectorData,this._detectorResult=new s.collision.narrowphase.DetectorResult,this._latest=!1,this._shouldBeSkipped=!1,this._manifold=new s.dynamics.constraint.contact.Manifold,this._updater=new s.dynamics.constraint.contact.ManifoldUpdater(this._manifold),this._contactConstraint=new s.dynamics.constraint.contact.ContactConstraint(this._manifold),this._touching=!1}_updateManifold(){if(null==this._detector)return;let t=this._touching,i=this._detectorResult;if(this._detector.detect(i,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData),this._touching=i.numPoints>0,this._touching?(this._manifold._buildBasis(i.normal),i.getMaxDepth()>s.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?this._contactConstraint._positionCorrectionAlgorithm=s.common.Setting.alternativeContactPositionCorrectionAlgorithm:this._contactConstraint._positionCorrectionAlgorithm=s.common.Setting.defaultContactPositionCorrectionAlgorithm,i.incremental?this._updater.incrementalUpdate(i,this._b1._transform,this._b2._transform):this._updater.totalUpdate(i,this._b1._transform,this._b2._transform)):this._manifold._clear(),this._touching&&!t){let t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.beginContact(this),null!=i&&i.beginContact(this)}if(!this._touching&&t){let t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.endContact(this),null!=i&&i.endContact(this)}if(this._touching){let t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.preSolve(this),null!=i&&i.preSolve(this)}}_postSolve(){let t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.postSolve(this),null!=i&&i.postSolve(this)}getShape1(){return this._s1}getShape2(){return this._s2}isTouching(){return this._touching}getManifold(){return this._manifold}getContactConstraint(){return this._contactConstraint}getPrev(){return this._prev}getNext(){return this._next}},s.dynamics.ContactLink=class{constructor(){this._prev=null,this._next=null,this._contact=null,this._other=null}getContact(){return this._contact}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}},s.dynamics.ContactManager=class{constructor(t){this._broadPhase=t,this._collisionMatrix=new s.collision.narrowphase.CollisionMatrix,this._numContacts=0}createContacts(){let t=this._broadPhase._proxyPairList;for(;null!=t;){let i=t._next;for(;;){let i,a;if(t._p1._id<t._p2._id?(i=t._p1.userData,a=t._p2.userData):(i=t._p2.userData,a=t._p1.userData),!this.shouldCollide(i,a))break;let o,n=i._rigidBody,e=a._rigidBody;o=n._numContactLinks<e._numContactLinks?n._contactLinkList:e._contactLinkList;let r=i._id,_=a._id,l=!1;for(;null!=o;){let t=o._contact;if(t._s1._id==r&&t._s2._id==_){t._latest=!0,l=!0;break}o=o._next}if(!l){let t=this._contactPool;null!=t?(this._contactPool=t._next,t._next=null):t=new s.dynamics.Contact;let o=t;null==this._contactList?(this._contactList=o,this._contactListLast=o):(this._contactListLast._next=o,o._prev=this._contactListLast,this._contactListLast=o),o._latest=!0;let n=this._collisionMatrix.detectors[i._geom._type][a._geom._type];o._s1=i,o._s2=a,o._b1=i._rigidBody,o._b2=a._rigidBody,o._touching=!1,null==o._b1._contactLinkList?(o._b1._contactLinkList=o._link1,o._b1._contactLinkListLast=o._link1):(o._b1._contactLinkListLast._next=o._link1,o._link1._prev=o._b1._contactLinkListLast,o._b1._contactLinkListLast=o._link1),null==o._b2._contactLinkList?(o._b2._contactLinkList=o._link2,o._b2._contactLinkListLast=o._link2):(o._b2._contactLinkListLast._next=o._link2,o._link2._prev=o._b2._contactLinkListLast,o._b2._contactLinkListLast=o._link2),o._b1._numContactLinks++,o._b2._numContactLinks++,o._link1._other=o._b2,o._link2._other=o._b1,o._link1._contact=o,o._link2._contact=o,o._detector=n;let e=o._contactConstraint;e._s1=i,e._s2=a,e._b1=e._s1._rigidBody,e._b2=e._s2._rigidBody,e._tf1=e._b1._transform,e._tf2=e._b2._transform,this._numContacts++}break}t=i}}destroyOutdatedContacts(){let t=this._broadPhase._incremental,i=this._contactList;for(;null!=i;){let s=i._next;for(;;){if(i._latest){i._latest=!1,i._shouldBeSkipped=!1;break}if(!t){let t=i._prev,s=i._next;if(null!=t&&(t._next=s),null!=s&&(s._prev=t),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){let t=i._s1._contactCallback,s=i._s2._contactCallback;t==s&&(s=null),null!=t&&t.endContact(i),null!=s&&s.endContact(i)}let a=i._link1._prev,o=i._link1._next;null!=a&&(a._next=o),null!=o&&(o._prev=a),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;let n=i._link2._prev,e=i._link2._next;null!=n&&(n._next=e),null!=e&&(e._prev=n),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;let r=i._contactConstraint;r._s1=null,r._s2=null,r._b1=null,r._b2=null,r._tf1=null,r._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}let s=i._s1,a=i._s2,o=s._rigidBody,n=a._rigidBody;if((o._sleeping||1==o._type)&&(n._sleeping||1==n._type)){i._shouldBeSkipped=!0;break}let e=s._aabb,r=a._aabb,_=s._proxy,l=a._proxy;if(!(_._aabbMinX<l._aabbMaxX&&_._aabbMaxX>l._aabbMinX&&_._aabbMinY<l._aabbMaxY&&_._aabbMaxY>l._aabbMinY&&_._aabbMinZ<l._aabbMaxZ&&_._aabbMaxZ>l._aabbMinZ&&this.shouldCollide(s,a))){let t=i._prev,s=i._next;if(null!=t&&(t._next=s),null!=s&&(s._prev=t),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){let t=i._s1._contactCallback,s=i._s2._contactCallback;t==s&&(s=null),null!=t&&t.endContact(i),null!=s&&s.endContact(i)}let a=i._link1._prev,o=i._link1._next;null!=a&&(a._next=o),null!=o&&(o._prev=a),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;let n=i._link2._prev,e=i._link2._next;null!=n&&(n._next=e),null!=e&&(e._prev=n),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;let r=i._contactConstraint;r._s1=null,r._s2=null,r._b1=null,r._b2=null,r._tf1=null,r._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}i._shouldBeSkipped=!(e._minX<r._maxX&&e._maxX>r._minX&&e._minY<r._maxY&&e._maxY>r._minY&&e._minZ<r._maxZ&&e._maxZ>r._minZ);break}i=s}}shouldCollide(t,i){let s,a,o=t._rigidBody,n=i._rigidBody;if(o==n)return!1;if(0!=o._type&&0!=n._type)return!1;if(0==(t._collisionGroup&i._collisionMask)||0==(i._collisionGroup&t._collisionMask))return!1;for(o._numJointLinks<n._numJointLinks?(s=o._jointLinkList,a=n):(s=n._jointLinkList,a=o);null!=s;){if(s._other==a&&!s._joint._allowCollision)return!1;s=s._next}return!0}_updateContacts(){this._broadPhase.collectPairs(),this.createContacts(),this.destroyOutdatedContacts()}_postSolve(){let t=this._contactList;for(;null!=t;){let i=t._next;t._touching&&t._postSolve(),t=i}}getNumContacts(){return this._numContacts}getContactList(){return this._contactList}},s.dynamics.Island=class{constructor(){this.rigidBodies=new Array(s.common.Setting.islandInitialRigidBodyArraySize),this.solvers=new Array(s.common.Setting.islandInitialConstraintArraySize),this.solversSi=new Array(s.common.Setting.islandInitialConstraintArraySize),this.solversNgs=new Array(s.common.Setting.islandInitialConstraintArraySize),this.numRigidBodies=0,this.numSolvers=0,this.numSolversSi=0,this.numSolversNgs=0}_clear(){for(;this.numRigidBodies>0;)this.rigidBodies[--this.numRigidBodies]=null;for(;this.numSolvers>0;)this.solvers[--this.numSolvers]=null;for(;this.numSolversSi>0;)this.solversSi[--this.numSolversSi]=null;for(;this.numSolversNgs>0;)this.solversNgs[--this.numSolversNgs]=null}_addRigidBody(t){if(this.numRigidBodies==this.rigidBodies.length){let t=new Array(this.numRigidBodies<<1),i=0,s=this.numRigidBodies;for(;i<s;){let s=i++;t[s]=this.rigidBodies[s],this.rigidBodies[s]=null}this.rigidBodies=t}t._addedToIsland=!0,this.rigidBodies[this.numRigidBodies++]=t}_addConstraintSolver(t,i){if(this.numSolvers==this.solvers.length){let t=new Array(this.numSolvers<<1),i=0,s=this.numSolvers;for(;i<s;){let s=i++;t[s]=this.solvers[s],this.solvers[s]=null}this.solvers=t}if(t._addedToIsland=!0,this.solvers[this.numSolvers++]=t,i==s.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){let t=new Array(this.numSolversSi<<1),i=0,s=this.numSolversSi;for(;i<s;){let s=i++;t[s]=this.solversSi[s],this.solversSi[s]=null}this.solversSi=t}this.solversSi[this.numSolversSi++]=t}if(i==s.dynamics.constraint.PositionCorrectionAlgorithm.NGS){if(this.numSolversNgs==this.solversNgs.length){let t=new Array(this.numSolversNgs<<1),i=0,s=this.numSolversNgs;for(;i<s;){let s=i++;t[s]=this.solversNgs[s],this.solversNgs[s]=null}this.solversNgs=t}this.solversNgs[this.numSolversNgs++]=t}}_stepSingleRigidBody(t,i){let a=t.dt,o=i._ptransform,n=i._transform;if(o._positionX=n._positionX,o._positionY=n._positionY,o._positionZ=n._positionZ,o._rotation00=n._rotation00,o._rotation01=n._rotation01,o._rotation02=n._rotation02,o._rotation10=n._rotation10,o._rotation11=n._rotation11,o._rotation12=n._rotation12,o._rotation20=n._rotation20,o._rotation21=n._rotation21,o._rotation22=n._rotation22,i._linearContactImpulseX=0,i._linearContactImpulseY=0,i._linearContactImpulseZ=0,i._angularContactImpulseX=0,i._angularContactImpulseY=0,i._angularContactImpulseZ=0,i._autoSleep&&i._velX*i._velX+i._velY*i._velY+i._velZ*i._velZ<s.common.Setting.sleepingVelocityThreshold*s.common.Setting.sleepingVelocityThreshold&&i._angVelX*i._angVelX+i._angVelY*i._angVelY+i._angVelZ*i._angVelZ<s.common.Setting.sleepingAngularVelocityThreshold*s.common.Setting.sleepingAngularVelocityThreshold?(i._sleepTime+=a,i._sleepTime>s.common.Setting.sleepingTimeThreshold&&(i._sleeping=!0,i._sleepTime=0)):i._sleepTime=0,!i._sleeping){if(0==i._type){let t,s,o,n,e,r,_,l,h,c=a*i._linearDamping,m=c*c,b=1/(1+c+m*(.5+.16666666666666666*c+.041666666666666664*m)),p=a*i._angularDamping,x=p*p,f=1/(1+p+x*(.5+.16666666666666666*p+.041666666666666664*x));t=this.gravityX*i._gravityScale,s=this.gravityY*i._gravityScale,o=this.gravityZ*i._gravityScale,t+=i._forceX*i._invMass,s+=i._forceY*i._invMass,o+=i._forceZ*i._invMass,_=i._invInertia00*i._torqueX+i._invInertia01*i._torqueY+i._invInertia02*i._torqueZ,l=i._invInertia10*i._torqueX+i._invInertia11*i._torqueY+i._invInertia12*i._torqueZ,h=i._invInertia20*i._torqueX+i._invInertia21*i._torqueY+i._invInertia22*i._torqueZ,n=_,e=l,r=h,i._velX+=t*a,i._velY+=s*a,i._velZ+=o*a,i._velX*=b,i._velY*=b,i._velZ*=b,i._angVelX+=n*a,i._angVelY+=e*a,i._angVelZ+=r*a,i._angVelX*=f,i._angVelY*=f,i._angVelZ*=f}i._integrate(a);let t=i._shapeList;for(;null!=t;){let s,a,o,n,e,r,_,l,h,c,m,b,p=t._next,x=i._ptransform,f=i._transform,u=t._ptransform,y=t._localTransform;s=x._rotation00*y._rotation00+x._rotation01*y._rotation10+x._rotation02*y._rotation20,a=x._rotation00*y._rotation01+x._rotation01*y._rotation11+x._rotation02*y._rotation21,o=x._rotation00*y._rotation02+x._rotation01*y._rotation12+x._rotation02*y._rotation22,n=x._rotation10*y._rotation00+x._rotation11*y._rotation10+x._rotation12*y._rotation20,e=x._rotation10*y._rotation01+x._rotation11*y._rotation11+x._rotation12*y._rotation21,r=x._rotation10*y._rotation02+x._rotation11*y._rotation12+x._rotation12*y._rotation22,_=x._rotation20*y._rotation00+x._rotation21*y._rotation10+x._rotation22*y._rotation20,l=x._rotation20*y._rotation01+x._rotation21*y._rotation11+x._rotation22*y._rotation21,h=x._rotation20*y._rotation02+x._rotation21*y._rotation12+x._rotation22*y._rotation22,u._rotation00=s,u._rotation01=a,u._rotation02=o,u._rotation10=n,u._rotation11=e,u._rotation12=r,u._rotation20=_,u._rotation21=l,u._rotation22=h,c=x._rotation00*y._positionX+x._rotation01*y._positionY+x._rotation02*y._positionZ,m=x._rotation10*y._positionX+x._rotation11*y._positionY+x._rotation12*y._positionZ,b=x._rotation20*y._positionX+x._rotation21*y._positionY+x._rotation22*y._positionZ,u._positionX=c,u._positionY=m,u._positionZ=b,u._positionX+=x._positionX,u._positionY+=x._positionY,u._positionZ+=x._positionZ;let v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T,C=t._transform,j=t._localTransform;if(v=f._rotation00*j._rotation00+f._rotation01*j._rotation10+f._rotation02*j._rotation20,d=f._rotation00*j._rotation01+f._rotation01*j._rotation11+f._rotation02*j._rotation21,g=f._rotation00*j._rotation02+f._rotation01*j._rotation12+f._rotation02*j._rotation22,X=f._rotation10*j._rotation00+f._rotation11*j._rotation10+f._rotation12*j._rotation20,Y=f._rotation10*j._rotation01+f._rotation11*j._rotation11+f._rotation12*j._rotation21,z=f._rotation10*j._rotation02+f._rotation11*j._rotation12+f._rotation12*j._rotation22,Z=f._rotation20*j._rotation00+f._rotation21*j._rotation10+f._rotation22*j._rotation20,M=f._rotation20*j._rotation01+f._rotation21*j._rotation11+f._rotation22*j._rotation21,I=f._rotation20*j._rotation02+f._rotation21*j._rotation12+f._rotation22*j._rotation22,C._rotation00=v,C._rotation01=d,C._rotation02=g,C._rotation10=X,C._rotation11=Y,C._rotation12=z,C._rotation20=Z,C._rotation21=M,C._rotation22=I,V=f._rotation00*j._positionX+f._rotation01*j._positionY+f._rotation02*j._positionZ,L=f._rotation10*j._positionX+f._rotation11*j._positionY+f._rotation12*j._positionZ,w=f._rotation20*j._positionX+f._rotation21*j._positionY+f._rotation22*j._positionZ,C._positionX=V,C._positionY=L,C._positionZ=w,C._positionX+=f._positionX,C._positionY+=f._positionY,C._positionZ+=f._positionZ,t._geom._computeAabb(t._aabb,t._ptransform),k=t._aabb._minX,A=t._aabb._minY,B=t._aabb._minZ,P=t._aabb._maxX,S=t._aabb._maxY,T=t._aabb._maxZ,t._geom._computeAabb(t._aabb,t._transform),t._aabb._minX=k<t._aabb._minX?k:t._aabb._minX,t._aabb._minY=A<t._aabb._minY?A:t._aabb._minY,t._aabb._minZ=B<t._aabb._minZ?B:t._aabb._minZ,t._aabb._maxX=P>t._aabb._maxX?P:t._aabb._maxX,t._aabb._maxY=S>t._aabb._maxY?S:t._aabb._maxY,t._aabb._maxZ=T>t._aabb._maxZ?T:t._aabb._maxZ,null!=t._proxy){let i,s,a;i=t._transform._positionX-t._ptransform._positionX,s=t._transform._positionY-t._ptransform._positionY,a=t._transform._positionZ-t._ptransform._positionZ;let o=t.displacement;o.x=i,o.y=s,o.z=a,t._rigidBody._world._broadPhase.moveProxy(t._proxy,t._aabb,t.displacement)}t=p}}}_step(t,i,a){let o=t.dt,n=!0,e=0,r=this.numRigidBodies;for(;e<r;){let t=this.rigidBodies[e++],i=t._ptransform,a=t._transform;if(i._positionX=a._positionX,i._positionY=a._positionY,i._positionZ=a._positionZ,i._rotation00=a._rotation00,i._rotation01=a._rotation01,i._rotation02=a._rotation02,i._rotation10=a._rotation10,i._rotation11=a._rotation11,i._rotation12=a._rotation12,i._rotation20=a._rotation20,i._rotation21=a._rotation21,i._rotation22=a._rotation22,t._linearContactImpulseX=0,t._linearContactImpulseY=0,t._linearContactImpulseZ=0,t._angularContactImpulseX=0,t._angularContactImpulseY=0,t._angularContactImpulseZ=0,t._sleeping=!1,t._autoSleep&&t._velX*t._velX+t._velY*t._velY+t._velZ*t._velZ<s.common.Setting.sleepingVelocityThreshold*s.common.Setting.sleepingVelocityThreshold&&t._angVelX*t._angVelX+t._angVelY*t._angVelY+t._angVelZ*t._angVelZ<s.common.Setting.sleepingAngularVelocityThreshold*s.common.Setting.sleepingAngularVelocityThreshold?t._sleepTime+=o:t._sleepTime=0,t._sleepTime<s.common.Setting.sleepingTimeThreshold&&(n=!1),0==t._type){let i,s,a,n,e,r,_,l,h,c=o*t._linearDamping,m=c*c,b=1/(1+c+m*(.5+.16666666666666666*c+.041666666666666664*m)),p=o*t._angularDamping,x=p*p,f=1/(1+p+x*(.5+.16666666666666666*p+.041666666666666664*x));i=this.gravityX*t._gravityScale,s=this.gravityY*t._gravityScale,a=this.gravityZ*t._gravityScale,i+=t._forceX*t._invMass,s+=t._forceY*t._invMass,a+=t._forceZ*t._invMass,_=t._invInertia00*t._torqueX+t._invInertia01*t._torqueY+t._invInertia02*t._torqueZ,l=t._invInertia10*t._torqueX+t._invInertia11*t._torqueY+t._invInertia12*t._torqueZ,h=t._invInertia20*t._torqueX+t._invInertia21*t._torqueY+t._invInertia22*t._torqueZ,n=_,e=l,r=h,t._velX+=i*o,t._velY+=s*o,t._velZ+=a*o,t._velX*=b,t._velY*=b,t._velZ*=b,t._angVelX+=n*o,t._angVelY+=e*o,t._angVelZ+=r*o,t._angVelX*=f,t._angVelY*=f,t._angVelZ*=f}}if(n){let t=0,i=this.numRigidBodies;for(;t<i;){let i=this.rigidBodies[t++];i._sleeping=!0,i._sleepTime=0}return}let _=0,l=this.numSolvers;for(;_<l;)this.solvers[_++].preSolveVelocity(t);let h=0,c=this.numSolvers;for(;h<c;)this.solvers[h++].warmStart(t);let m=0;for(;m<i;){++m;let t=0,i=this.numSolvers;for(;t<i;)this.solvers[t++].solveVelocity()}let b=0,p=this.numSolvers;for(;b<p;)this.solvers[b++].postSolveVelocity(t);let x=0,f=this.numRigidBodies;for(;x<f;)this.rigidBodies[x++]._integrate(o);let u=0,y=this.numSolversSi;for(;u<y;)this.solversSi[u++].preSolvePosition(t);let v=0;for(;v<a;){++v;let t=0,i=this.numSolversSi;for(;t<i;)this.solversSi[t++].solvePositionSplitImpulse()}let d=0,g=this.numRigidBodies;for(;d<g;)this.rigidBodies[d++]._integratePseudoVelocity();let X=0,Y=this.numSolversNgs;for(;X<Y;)this.solversNgs[X++].preSolvePosition(t);let z=0;for(;z<a;){++z;let i=0,s=this.numSolversNgs;for(;i<s;)this.solversNgs[i++].solvePositionNgs(t)}let Z=0,M=this.numSolvers;for(;Z<M;)this.solvers[Z++].postSolve();let I=0,V=this.numRigidBodies;for(;I<V;){let t=this.rigidBodies[I++],i=t._shapeList;for(;null!=i;){let s,a,o,n,e,r,_,l,h,c,m,b,p=i._next,x=t._ptransform,f=t._transform,u=i._ptransform,y=i._localTransform;s=x._rotation00*y._rotation00+x._rotation01*y._rotation10+x._rotation02*y._rotation20,a=x._rotation00*y._rotation01+x._rotation01*y._rotation11+x._rotation02*y._rotation21,o=x._rotation00*y._rotation02+x._rotation01*y._rotation12+x._rotation02*y._rotation22,n=x._rotation10*y._rotation00+x._rotation11*y._rotation10+x._rotation12*y._rotation20,e=x._rotation10*y._rotation01+x._rotation11*y._rotation11+x._rotation12*y._rotation21,r=x._rotation10*y._rotation02+x._rotation11*y._rotation12+x._rotation12*y._rotation22,_=x._rotation20*y._rotation00+x._rotation21*y._rotation10+x._rotation22*y._rotation20,l=x._rotation20*y._rotation01+x._rotation21*y._rotation11+x._rotation22*y._rotation21,h=x._rotation20*y._rotation02+x._rotation21*y._rotation12+x._rotation22*y._rotation22,u._rotation00=s,u._rotation01=a,u._rotation02=o,u._rotation10=n,u._rotation11=e,u._rotation12=r,u._rotation20=_,u._rotation21=l,u._rotation22=h,c=x._rotation00*y._positionX+x._rotation01*y._positionY+x._rotation02*y._positionZ,m=x._rotation10*y._positionX+x._rotation11*y._positionY+x._rotation12*y._positionZ,b=x._rotation20*y._positionX+x._rotation21*y._positionY+x._rotation22*y._positionZ,u._positionX=c,u._positionY=m,u._positionZ=b,u._positionX+=x._positionX,u._positionY+=x._positionY,u._positionZ+=x._positionZ;let v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T,C=i._transform,j=i._localTransform;if(v=f._rotation00*j._rotation00+f._rotation01*j._rotation10+f._rotation02*j._rotation20,d=f._rotation00*j._rotation01+f._rotation01*j._rotation11+f._rotation02*j._rotation21,g=f._rotation00*j._rotation02+f._rotation01*j._rotation12+f._rotation02*j._rotation22,X=f._rotation10*j._rotation00+f._rotation11*j._rotation10+f._rotation12*j._rotation20,Y=f._rotation10*j._rotation01+f._rotation11*j._rotation11+f._rotation12*j._rotation21,z=f._rotation10*j._rotation02+f._rotation11*j._rotation12+f._rotation12*j._rotation22,Z=f._rotation20*j._rotation00+f._rotation21*j._rotation10+f._rotation22*j._rotation20,M=f._rotation20*j._rotation01+f._rotation21*j._rotation11+f._rotation22*j._rotation21,I=f._rotation20*j._rotation02+f._rotation21*j._rotation12+f._rotation22*j._rotation22,C._rotation00=v,C._rotation01=d,C._rotation02=g,C._rotation10=X,C._rotation11=Y,C._rotation12=z,C._rotation20=Z,C._rotation21=M,C._rotation22=I,V=f._rotation00*j._positionX+f._rotation01*j._positionY+f._rotation02*j._positionZ,L=f._rotation10*j._positionX+f._rotation11*j._positionY+f._rotation12*j._positionZ,w=f._rotation20*j._positionX+f._rotation21*j._positionY+f._rotation22*j._positionZ,C._positionX=V,C._positionY=L,C._positionZ=w,C._positionX+=f._positionX,C._positionY+=f._positionY,C._positionZ+=f._positionZ,i._geom._computeAabb(i._aabb,i._ptransform),k=i._aabb._minX,A=i._aabb._minY,B=i._aabb._minZ,P=i._aabb._maxX,S=i._aabb._maxY,T=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=k<i._aabb._minX?k:i._aabb._minX,i._aabb._minY=A<i._aabb._minY?A:i._aabb._minY,i._aabb._minZ=B<i._aabb._minZ?B:i._aabb._minZ,i._aabb._maxX=P>i._aabb._maxX?P:i._aabb._maxX,i._aabb._maxY=S>i._aabb._maxY?S:i._aabb._maxY,i._aabb._maxZ=T>i._aabb._maxZ?T:i._aabb._maxZ,null!=i._proxy){let t,s,a;t=i._transform._positionX-i._ptransform._positionX,s=i._transform._positionY-i._ptransform._positionY,a=i._transform._positionZ-i._ptransform._positionZ;let o=i.displacement;o.x=t,o.y=s,o.z=a,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=p}}}},s.dynamics.TimeStep=class{constructor(){this.dt=0,this.invDt=0,this.dtRatio=1}},s.dynamics.World=class{constructor(t,i){switch(null==t&&(t=2),t){case 1:this._broadPhase=new s.collision.broadphase.bruteforce.BruteForceBroadPhase;break;case 2:this._broadPhase=new s.collision.broadphase.bvh.BvhBroadPhase}this._contactManager=new s.dynamics.ContactManager(this._broadPhase),null==i&&(i=new s.common.Vec3(0,-9.80665,0)),this._gravity=new s.common.Vec3(i.x,i.y,i.z),this._rigidBodyList=null,this._rigidBodyListLast=null,this._jointList=null,this._jointListLast=null,this._numRigidBodies=0,this._numShapes=0,this._numJoints=0,this._numIslands=0,this._numVelocityIterations=10,this._numPositionIterations=5,this._rayCastWrapper=new s.dynamics._World.RayCastWrapper,this._convexCastWrapper=new s.dynamics._World.ConvexCastWrapper,this._aabbTestWrapper=new s.dynamics._World.AabbTestWrapper,this._island=new s.dynamics.Island,this._solversInIslands=new Array(s.common.Setting.islandInitialConstraintArraySize),this._rigidBodyStack=new Array(s.common.Setting.islandInitialRigidBodyArraySize),this._timeStep=new s.dynamics.TimeStep,this._pool=new s.common.Pool,this._shapeIdCount=0}_updateContacts(){let t=Date.now()/1e3;this._contactManager._updateContacts(),s.dynamics.common.Performance.broadPhaseCollisionTime=1e3*(Date.now()/1e3-t);let i=Date.now()/1e3,a=this._contactManager._contactList;for(;null!=a;){let t=a._next;a._shouldBeSkipped||a._updateManifold(),a=t}s.dynamics.common.Performance.narrowPhaseCollisionTime=1e3*(Date.now()/1e3-i)}_solveIslands(){let t=Date.now()/1e3;if(s.common.Setting.disableSleeping){let t=this._rigidBodyList;for(;null!=t;)t._sleeping=!1,t._sleepTime=0,t=t._next}if(this._rigidBodyStack.length<this._numRigidBodies){let t=this._rigidBodyStack.length<<1;for(;t<this._numRigidBodies;)t<<=1;this._rigidBodyStack=new Array(t)}this._numIslands=0;let i=this._island,a=this._gravity;i.gravityX=a.x,i.gravityY=a.y,i.gravityZ=a.z;let o=this._rigidBodyList;for(this._numSolversInIslands=0;null!=o;){let t=o._next;for(;!o._addedToIsland&&!o._sleeping&&1!=o._type;){if(0==o._numContactLinks&&0==o._numJointLinks){this._island._stepSingleRigidBody(this._timeStep,o),this._numIslands++;break}this.buildIsland(o),this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations),this._island._clear(),this._numIslands++;break}o=t}for(this._contactManager._postSolve(),o=this._rigidBodyList;null!=o;)o._addedToIsland=!1,o=o._next;for(o=this._rigidBodyList;null!=o;)o._forceX=0,o._forceY=0,o._forceZ=0,o._torqueX=0,o._torqueY=0,o._torqueZ=0,o=o._next;for(;this._numSolversInIslands>0;)this._solversInIslands[--this._numSolversInIslands]._addedToIsland=!1,this._solversInIslands[this._numSolversInIslands]=null;s.dynamics.common.Performance.dynamicsTime=1e3*(Date.now()/1e3-t)}buildIsland(t){let i=1;for(this._island._addRigidBody(t),this._rigidBodyStack[0]=t;i>0;){let t=this._rigidBodyStack[--i];if(this._rigidBodyStack[i]=null,1==t._type)continue;let s=t._contactLinkList;for(;null!=s;){let t=s._next,a=s._contact._contactConstraint,o=s._contact._contactConstraint._solver;if(a.isTouching()&&!o._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){let t=new Array(this._numSolversInIslands<<1),i=0,s=this._numSolversInIslands;for(;i<s;){let s=i++;t[s]=this._solversInIslands[s],this._solversInIslands[s]=null}this._solversInIslands=t}this._solversInIslands[this._numSolversInIslands++]=o,this._island._addConstraintSolver(o,a._positionCorrectionAlgorithm);let t=s._other;t._addedToIsland||(this._island._addRigidBody(t),this._rigidBodyStack[i++]=t)}s=t}let a=t._jointLinkList;for(;null!=a;){let t=a._next,s=a._joint,o=s._solver;if(!o._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){let t=new Array(this._numSolversInIslands<<1),i=0,s=this._numSolversInIslands;for(;i<s;){let s=i++;t[s]=this._solversInIslands[s],this._solversInIslands[s]=null}this._solversInIslands=t}this._solversInIslands[this._numSolversInIslands++]=o,this._island._addConstraintSolver(o,s._positionCorrectionAlgorithm);let t=a._other;t._addedToIsland||(this._island._addRigidBody(t),this._rigidBodyStack[i++]=t)}a=t}}}_drawBvh(t,i){t.drawBvh&&this._drawBvhNode(t,i._root,0,t.style.bvhNodeColor)}_drawBvhNode(t,i,a,o){if(null!=i){if(a>=t.drawBvhMinLevel&&a<=t.drawBvhMaxLevel){let a=this._pool,n=0==a.sizeVec3?new s.common.Vec3:a.stackVec3[--a.sizeVec3],e=this._pool,r=0==e.sizeVec3?new s.common.Vec3:e.stackVec3[--e.sizeVec3],_=n;_.x=i._aabbMinX,_.y=i._aabbMinY,_.z=i._aabbMinZ;let l=r;l.x=i._aabbMaxX,l.y=i._aabbMaxY,l.z=i._aabbMaxZ,t.aabb(n,r,o);let h=this._pool;if(null!=n){if(n.zero(),h.sizeVec3==h.stackVec3.length){let t=new Array(h.sizeVec3<<1),i=0,s=h.sizeVec3;for(;i<s;){let s=i++;t[s]=h.stackVec3[s],h.stackVec3[s]=null}h.stackVec3=t}h.stackVec3[h.sizeVec3++]=n}let c=this._pool;if(null!=r){if(r.zero(),c.sizeVec3==c.stackVec3.length){let t=new Array(c.sizeVec3<<1),i=0,s=c.sizeVec3;for(;i<s;){let s=i++;t[s]=c.stackVec3[s],c.stackVec3[s]=null}c.stackVec3=t}c.stackVec3[c.sizeVec3++]=r}}this._drawBvhNode(t,i._children[0],a+1,o),this._drawBvhNode(t,i._children[1],a+1,o)}}_drawRigidBodies(t){let i=t.style,a=this._rigidBodyList;for(;null!=a;){let o=a._next;if(t.drawBases){let i=t.style;t.basis(a._transform,i.basisLength,i.basisColorX,i.basisColorY,i.basisColorZ)}let n=null,e=0==a._type;e||(n=2==a._type?i.kinematicShapeColor:i.staticShapeColor);let r=a._shapeList;for(;null!=r;){let o=r._next;if(e&&(n=0==(1&r._id)?a._sleeping?i.sleepingShapeColor1:a._sleepTime>s.common.Setting.sleepingTimeThreshold?i.sleepyShapeColor1:i.shapeColor1:a._sleeping?i.sleepingShapeColor2:a._sleepTime>s.common.Setting.sleepingTimeThreshold?i.sleepyShapeColor2:i.shapeColor2),t.drawShapes){let i=r._geom,a=r._transform;switch(i._type){case 0:t.sphere(a,i._radius,n);break;case 1:let o=i,e=this._pool,r=0==e.sizeVec3?new s.common.Vec3:e.stackVec3[--e.sizeVec3],_=r;_.x=o._halfExtentsX,_.y=o._halfExtentsY,_.z=o._halfExtentsZ,t.box(a,r,n);let l=this._pool;if(null!=r){if(r.zero(),l.sizeVec3==l.stackVec3.length){let t=new Array(l.sizeVec3<<1),i=0,s=l.sizeVec3;for(;i<s;){let s=i++;t[s]=l.stackVec3[s],l.stackVec3[s]=null}l.stackVec3=t}l.stackVec3[l.sizeVec3++]=r}break;case 2:let h=i;t.cylinder(a,h._radius,h._halfHeight,n);break;case 3:let c=i;t.cone(a,c._radius,c._halfHeight,n);break;case 4:let m=i;t.capsule(a,m._radius,m._halfHeight,n);break;case 5:let b=i,p=b._numVertices,x=this._pool,f=0==x.sizeVec3?new s.common.Vec3:x.stackVec3[--x.sizeVec3],u=this._pool,y=0==u.sizeVec3?new s.common.Vec3:u.stackVec3[--u.sizeVec3],v=this._pool,d=0==v.sizeVec3?new s.common.Vec3:v.stackVec3[--v.sizeVec3],g=this._pool,X=0==g.sizeVec3?new s.common.Vec3:g.stackVec3[--g.sizeVec3],Y=this._pool,z=0==Y.sizeVec3?new s.common.Vec3:Y.stackVec3[--Y.sizeVec3],Z=this._pool,M=0==Z.sizeVec3?new s.common.Vec3:Z.stackVec3[--Z.sizeVec3],I=this._pool,V=0==I.sizeMat3?new s.common.Mat3:I.stackMat3[--I.sizeMat3],L=this._pool,w=0==L.sizeVec3?new s.common.Vec3:L.stackVec3[--L.sizeVec3],k=V;k.e00=a._rotation00,k.e01=a._rotation01,k.e02=a._rotation02,k.e10=a._rotation10,k.e11=a._rotation11,k.e12=a._rotation12,k.e20=a._rotation20,k.e21=a._rotation21,k.e22=a._rotation22;let A=w;A.x=a._positionX,A.y=a._positionY,A.z=a._positionZ;let B=0;for(;B<p;){let t=B++,i=b._tmpVertices[t],s=b._vertices[t];i.x=s.x,i.y=s.y,i.z=s.z;let a=i.x*V.e10+i.y*V.e11+i.z*V.e12,o=i.x*V.e20+i.y*V.e21+i.z*V.e22;i.x=i.x*V.e00+i.y*V.e01+i.z*V.e02,i.y=a,i.z=o,i.x+=w.x,i.y+=w.y,i.z+=w.z}if(p>30){let i=0;for(;i<p;){let s=i++,a=b._tmpVertices[s];f.x=a.x,f.y=a.y,f.z=a.z;let o=b._tmpVertices[(s+1)%p];y.x=o.x,y.y=o.y,y.z=o.z,t.line(f,y,n)}}else if(this._debugDraw.wireframe||p>10){let i=0;for(;i<p;){let s=i++,a=b._tmpVertices[s];f.x=a.x,f.y=a.y,f.z=a.z;let o=0;for(;o<s;){let i=b._tmpVertices[o++];y.x=i.x,y.y=i.y,y.z=i.z,t.line(f,y,n)}}}else{let i=0;for(;i<p;){let s=i++,a=b._tmpVertices[s];f.x=a.x,f.y=a.y,f.z=a.z;let o=0;for(;o<s;){let i=o++,s=b._tmpVertices[i];y.x=s.x,y.y=s.y,y.z=s.z;let a=0;for(;a<i;){let i=b._tmpVertices[a++];d.x=i.x,d.y=i.y,d.z=i.z,X.x=y.x,X.y=y.y,X.z=y.z;let s=X;s.x-=f.x,s.y-=f.y,s.z-=f.z,z.x=d.x,z.y=d.y,z.z=d.z;let o=z;o.x-=f.x,o.y-=f.y,o.z-=f.z,M.x=X.x,M.y=X.y,M.z=X.z;let e=M,r=e.z*z.x-e.x*z.z,_=e.x*z.y-e.y*z.x;e.x=e.y*z.z-e.z*z.y,e.y=r,e.z=_;let l=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);l>0&&(l=1/l),e.x*=l,e.y*=l,e.z*=l,t.triangle(f,y,d,M,M,M,n),M.x=-M.x,M.y=-M.y,M.z=-M.z,t.triangle(f,d,y,M,M,M,n)}}}}let P=this._pool;if(null!=f){if(f.zero(),P.sizeVec3==P.stackVec3.length){let t=new Array(P.sizeVec3<<1),i=0,s=P.sizeVec3;for(;i<s;){let s=i++;t[s]=P.stackVec3[s],P.stackVec3[s]=null}P.stackVec3=t}P.stackVec3[P.sizeVec3++]=f}let S=this._pool;if(null!=y){if(y.zero(),S.sizeVec3==S.stackVec3.length){let t=new Array(S.sizeVec3<<1),i=0,s=S.sizeVec3;for(;i<s;){let s=i++;t[s]=S.stackVec3[s],S.stackVec3[s]=null}S.stackVec3=t}S.stackVec3[S.sizeVec3++]=y}let T=this._pool;if(null!=d){if(d.zero(),T.sizeVec3==T.stackVec3.length){let t=new Array(T.sizeVec3<<1),i=0,s=T.sizeVec3;for(;i<s;){let s=i++;t[s]=T.stackVec3[s],T.stackVec3[s]=null}T.stackVec3=t}T.stackVec3[T.sizeVec3++]=d}let C=this._pool;if(null!=X){if(X.zero(),C.sizeVec3==C.stackVec3.length){let t=new Array(C.sizeVec3<<1),i=0,s=C.sizeVec3;for(;i<s;){let s=i++;t[s]=C.stackVec3[s],C.stackVec3[s]=null}C.stackVec3=t}C.stackVec3[C.sizeVec3++]=X}let j=this._pool;if(null!=z){if(z.zero(),j.sizeVec3==j.stackVec3.length){let t=new Array(j.sizeVec3<<1),i=0,s=j.sizeVec3;for(;i<s;){let s=i++;t[s]=j.stackVec3[s],j.stackVec3[s]=null}j.stackVec3=t}j.stackVec3[j.sizeVec3++]=z}let R=this._pool;if(null!=M){if(M.zero(),R.sizeVec3==R.stackVec3.length){let t=new Array(R.sizeVec3<<1),i=0,s=R.sizeVec3;for(;i<s;){let s=i++;t[s]=R.stackVec3[s],R.stackVec3[s]=null}R.stackVec3=t}R.stackVec3[R.sizeVec3++]=M}let E=this._pool;if(null!=V){if(V.e00=1,V.e01=0,V.e02=0,V.e10=0,V.e11=1,V.e12=0,V.e20=0,V.e21=0,V.e22=1,E.sizeMat3==E.stackMat3.length){let t=new Array(E.sizeMat3<<1),i=0,s=E.sizeMat3;for(;i<s;){let s=i++;t[s]=E.stackMat3[s],E.stackMat3[s]=null}E.stackMat3=t}E.stackMat3[E.sizeMat3++]=V}let q=this._pool;if(null!=w){if(w.zero(),q.sizeVec3==q.stackVec3.length){let t=new Array(q.sizeVec3<<1),i=0,s=q.sizeVec3;for(;i<s;){let s=i++;t[s]=q.stackVec3[s],q.stackVec3[s]=null}q.stackVec3=t}q.stackVec3[q.sizeVec3++]=w}}}if(t.drawAabbs){let a=r._aabb,o=i.aabbColor,n=this._pool,e=0==n.sizeVec3?new s.common.Vec3:n.stackVec3[--n.sizeVec3],_=this._pool,l=0==_.sizeVec3?new s.common.Vec3:_.stackVec3[--_.sizeVec3],h=e;h.x=a._minX,h.y=a._minY,h.z=a._minZ;let c=l;c.x=a._maxX,c.y=a._maxY,c.z=a._maxZ,t.aabb(e,l,o);let m=this._pool;if(null!=e){if(e.zero(),m.sizeVec3==m.stackVec3.length){let t=new Array(m.sizeVec3<<1),i=0,s=m.sizeVec3;for(;i<s;){let s=i++;t[s]=m.stackVec3[s],m.stackVec3[s]=null}m.stackVec3=t}m.stackVec3[m.sizeVec3++]=e}let b=this._pool;if(null!=l){if(l.zero(),b.sizeVec3==b.stackVec3.length){let t=new Array(b.sizeVec3<<1),i=0,s=b.sizeVec3;for(;i<s;){let s=i++;t[s]=b.stackVec3[s],b.stackVec3[s]=null}b.stackVec3=t}b.stackVec3[b.sizeVec3++]=l}}r=o}a=o}}_drawConstraints(t){let i=t.style;if(t.drawPairs||t.drawContacts){let a=this._contactManager._contactList;for(;null!=a;){let o=a._next;if(t.drawPairs){let o=i.pairColor,n=this._pool,e=0==n.sizeVec3?new s.common.Vec3:n.stackVec3[--n.sizeVec3],r=this._pool,_=0==r.sizeVec3?new s.common.Vec3:r.stackVec3[--r.sizeVec3],l=e;l.x=a._s1._transform._positionX,l.y=a._s1._transform._positionY,l.z=a._s1._transform._positionZ;let h=_;h.x=a._s2._transform._positionX,h.y=a._s2._transform._positionY,h.z=a._s2._transform._positionZ,t.line(e,_,o);let c=this._pool;if(null!=e){if(e.zero(),c.sizeVec3==c.stackVec3.length){let t=new Array(c.sizeVec3<<1),i=0,s=c.sizeVec3;for(;i<s;){let s=i++;t[s]=c.stackVec3[s],c.stackVec3[s]=null}c.stackVec3=t}c.stackVec3[c.sizeVec3++]=e}let m=this._pool;if(null!=_){if(_.zero(),m.sizeVec3==m.stackVec3.length){let t=new Array(m.sizeVec3<<1),i=0,s=m.sizeVec3;for(;i<s;){let s=i++;t[s]=m.stackVec3[s],m.stackVec3[s]=null}m.stackVec3=t}m.stackVec3[m.sizeVec3++]=_}}if(t.drawContacts){let i=a._contactConstraint,o=a._contactConstraint._manifold._points,n=0,e=a._contactConstraint._manifold._numPoints;for(;n<e;){let a=o[n++],e=t.style,r=this._pool,_=0==r.sizeVec3?new s.common.Vec3:r.stackVec3[--r.sizeVec3],l=this._pool,h=0==l.sizeVec3?new s.common.Vec3:l.stackVec3[--l.sizeVec3],c=this._pool,m=0==c.sizeVec3?new s.common.Vec3:c.stackVec3[--c.sizeVec3],b=this._pool,p=0==b.sizeVec3?new s.common.Vec3:b.stackVec3[--b.sizeVec3],x=this._pool,f=0==x.sizeVec3?new s.common.Vec3:x.stackVec3[--x.sizeVec3],u=_;u.x=a._pos1X,u.y=a._pos1Y,u.z=a._pos1Z;let y=h;y.x=a._pos2X,y.y=a._pos2Y,y.z=a._pos2Z;let v=m;v.x=i._manifold._normalX,v.y=i._manifold._normalY,v.z=i._manifold._normalZ;let d=p;d.x=i._manifold._tangentX,d.y=i._manifold._tangentY,d.z=i._manifold._tangentZ;let g=f;if(g.x=i._manifold._binormalX,g.y=i._manifold._binormalY,g.z=i._manifold._binormalZ,a._disabled)t.point(_,e.disabledContactColor),t.point(h,e.disabledContactColor),t.line(_,h,e.disabledContactColor);else if(a._warmStarted){let i;switch(3&a._id){case 0:i=e.contactColor;break;case 1:i=e.contactColor2;break;case 2:i=e.contactColor3;break;default:i=e.contactColor4}t.point(_,i),t.point(h,i),t.line(_,h,e.contactColor)}else t.point(_,e.newContactColor),t.point(h,e.newContactColor),t.line(_,h,e.newContactColor);h.x=_.x,h.y=_.y,h.z=_.z;let X=h,Y=e.contactNormalLength;if(X.x+=m.x*Y,X.y+=m.y*Y,X.z+=m.z*Y,t.line(_,h,e.contactNormalColor),t.drawContactBases){h.x=_.x,h.y=_.y,h.z=_.z;let i=h,s=e.contactTangentLength;i.x+=p.x*s,i.y+=p.y*s,i.z+=p.z*s,t.line(_,h,e.contactTangentColor),h.x=_.x,h.y=_.y,h.z=_.z;let a=h,o=e.contactBinormalLength;a.x+=f.x*o,a.y+=f.y*o,a.z+=f.z*o,t.line(_,h,e.contactBinormalColor)}let z=this._pool;if(null!=_){if(_.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,s=z.sizeVec3;for(;i<s;){let s=i++;t[s]=z.stackVec3[s],z.stackVec3[s]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=_}let Z=this._pool;if(null!=h){if(h.zero(),Z.sizeVec3==Z.stackVec3.length){let t=new Array(Z.sizeVec3<<1),i=0,s=Z.sizeVec3;for(;i<s;){let s=i++;t[s]=Z.stackVec3[s],Z.stackVec3[s]=null}Z.stackVec3=t}Z.stackVec3[Z.sizeVec3++]=h}let M=this._pool;if(null!=m){if(m.zero(),M.sizeVec3==M.stackVec3.length){let t=new Array(M.sizeVec3<<1),i=0,s=M.sizeVec3;for(;i<s;){let s=i++;t[s]=M.stackVec3[s],M.stackVec3[s]=null}M.stackVec3=t}M.stackVec3[M.sizeVec3++]=m}let I=this._pool;if(null!=p){if(p.zero(),I.sizeVec3==I.stackVec3.length){let t=new Array(I.sizeVec3<<1),i=0,s=I.sizeVec3;for(;i<s;){let s=i++;t[s]=I.stackVec3[s],I.stackVec3[s]=null}I.stackVec3=t}I.stackVec3[I.sizeVec3++]=p}let V=this._pool;if(null!=f){if(f.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,s=V.sizeVec3;for(;i<s;){let s=i++;t[s]=V.stackVec3[s],V.stackVec3[s]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=f}}}a=o}}if(t.drawJoints){let i=this._jointList;for(;null!=i;){let a=i._next,o=this._pool,n=0==o.sizeVec3?new s.common.Vec3:o.stackVec3[--o.sizeVec3],e=this._pool,r=0==e.sizeVec3?new s.common.Vec3:e.stackVec3[--e.sizeVec3],_=n;_.x=i._b1._transform._positionX,_.y=i._b1._transform._positionY,_.z=i._b1._transform._positionZ;let l=r;l.x=i._b2._transform._positionX,l.y=i._b2._transform._positionY,l.z=i._b2._transform._positionZ;let h=this._pool,c=0==h.sizeVec3?new s.common.Vec3:h.stackVec3[--h.sizeVec3],m=this._pool,b=0==m.sizeVec3?new s.common.Vec3:m.stackVec3[--m.sizeVec3],p=this._pool,x=0==p.sizeVec3?new s.common.Vec3:p.stackVec3[--p.sizeVec3],f=this._pool,u=0==f.sizeVec3?new s.common.Vec3:f.stackVec3[--f.sizeVec3],y=this._pool,v=0==y.sizeVec3?new s.common.Vec3:y.stackVec3[--y.sizeVec3],d=this._pool,g=0==d.sizeVec3?new s.common.Vec3:d.stackVec3[--d.sizeVec3],X=this._pool,Y=0==X.sizeVec3?new s.common.Vec3:X.stackVec3[--X.sizeVec3],z=this._pool,Z=0==z.sizeVec3?new s.common.Vec3:z.stackVec3[--z.sizeVec3],M=c;M.x=i._anchor1X,M.y=i._anchor1Y,M.z=i._anchor1Z;let I=b;I.x=i._anchor2X,I.y=i._anchor2Y,I.z=i._anchor2Z;let V=x;V.x=i._basisX1X,V.y=i._basisX1Y,V.z=i._basisX1Z;let L=u;L.x=i._basisY1X,L.y=i._basisY1Y,L.z=i._basisY1Z;let w=v;w.x=i._basisZ1X,w.y=i._basisZ1Y,w.z=i._basisZ1Z;let k=g;k.x=i._basisX2X,k.y=i._basisX2Y,k.z=i._basisX2Z;let A=Y;A.x=i._basisY2X,A.y=i._basisY2Y,A.z=i._basisY2Z;let B=Z;if(B.x=i._basisZ2X,B.y=i._basisZ2Y,B.z=i._basisZ2Z,t.line(n,c,t.style.jointLineColor),t.line(r,b,t.style.jointLineColor),t.drawJointLimits)switch(i._type){case 0:break;case 1:let a=i._lm;this._drawRotationalLimit(t,c,u,v,Y,t.style.jointRotationalConstraintRadius,a.lowerLimit,a.upperLimit,t.style.jointLineColor);break;case 2:let o=i,n=t.style.jointLineColor,e=o._rotLm,r=o._translLm;this._drawRotationalLimit(t,b,u,v,Y,t.style.jointRotationalConstraintRadius,e.lowerLimit,e.upperLimit,n),this._drawTranslationalLimit(t,c,x,r.lowerLimit,r.upperLimit,n);break;case 3:let _=i._lm;this._drawTranslationalLimit(t,c,x,_.lowerLimit,_.upperLimit,t.style.jointLineColor);break;case 4:let l=i,h=t.style.jointRotationalConstraintRadius,m=t.style.jointLineColor,p=l._lm1,f=l._lm2;this._drawRotationalLimit(t,c,u,v,u,h,l._angleX-p.upperLimit,l._angleX-p.lowerLimit,m),this._drawRotationalLimit(t,b,g,Y,g,h,f.lowerLimit-l._angleZ,f.upperLimit-l._angleZ,m);break;case 5:let y=i,d=t.style.jointRotationalConstraintRadius,X=t.style.jointLineColor,z=y._twistLm;this._drawRotationalLimit(t,b,Y,Z,Y,d,z.lowerLimit-y._twistAngle,z.upperLimit-y._twistAngle,X),this._drawEllipseOnSphere(t,c,x,u,v,y._maxSwingAngle1,y._maxSwingAngle2,d,X);let M=this._pool,I=0==M.sizeVec3?new s.common.Vec3:M.stackVec3[--M.sizeVec3];I.x=b.x,I.y=b.y,I.z=b.z;let V=I;V.x+=g.x*d,V.y+=g.y*d,V.z+=g.z*d,t.line(b,V,X);let L=this._pool;if(null!=V){if(V.zero(),L.sizeVec3==L.stackVec3.length){let t=new Array(L.sizeVec3<<1),i=0,s=L.sizeVec3;for(;i<s;){let s=i++;t[s]=L.stackVec3[s],L.stackVec3[s]=null}L.stackVec3=t}L.stackVec3[L.sizeVec3++]=V}break;case 6:let w=i,k=t.style.jointRotationalConstraintRadius,A=t.style.jointLineColor,B=w._rotLms[0],P=w._rotLms[1],S=w._rotLms[2];this._drawTranslationalLimit3D(t,c,x,u,v,w._translLms[0],w._translLms[1],w._translLms[2],A);let T=this._pool,C=0==T.sizeVec3?new s.common.Vec3:T.stackVec3[--T.sizeVec3],j=C;j.x=w._axisYX,j.y=w._axisYY,j.z=w._axisYZ;let R=this._pool,E=0==R.sizeVec3?new s.common.Vec3:R.stackVec3[--R.sizeVec3];E.x=x.x,E.y=x.y,E.z=x.z;let q=E,N=this._pool,D=0==N.sizeVec3?new s.common.Vec3:N.stackVec3[--N.sizeVec3];D.x=x.x,D.y=x.y,D.z=x.z;let F=D,H=F.z*C.x-F.x*C.z,G=F.x*C.y-F.y*C.x;F.x=F.y*C.z-F.z*C.y,F.y=H,F.z=G,this._drawRotationalLimit(t,b,u,v,u,k,w._angleX-B.upperLimit,w._angleX-B.lowerLimit,A),this._drawRotationalLimit(t,b,q,F,q,k,P.lowerLimit-w._angleY,P.upperLimit-w._angleY,A),this._drawRotationalLimit(t,b,g,Y,g,k,S.lowerLimit-w._angleZ,S.upperLimit-w._angleZ,A)}t.line(c,b,t.style.jointErrorColor);let P=this._pool;if(null!=n){if(n.zero(),P.sizeVec3==P.stackVec3.length){let t=new Array(P.sizeVec3<<1),i=0,s=P.sizeVec3;for(;i<s;){let s=i++;t[s]=P.stackVec3[s],P.stackVec3[s]=null}P.stackVec3=t}P.stackVec3[P.sizeVec3++]=n}let S=this._pool;if(null!=r){if(r.zero(),S.sizeVec3==S.stackVec3.length){let t=new Array(S.sizeVec3<<1),i=0,s=S.sizeVec3;for(;i<s;){let s=i++;t[s]=S.stackVec3[s],S.stackVec3[s]=null}S.stackVec3=t}S.stackVec3[S.sizeVec3++]=r}let T=this._pool;if(null!=c){if(c.zero(),T.sizeVec3==T.stackVec3.length){let t=new Array(T.sizeVec3<<1),i=0,s=T.sizeVec3;for(;i<s;){let s=i++;t[s]=T.stackVec3[s],T.stackVec3[s]=null}T.stackVec3=t}T.stackVec3[T.sizeVec3++]=c}let C=this._pool;if(null!=b){if(b.zero(),C.sizeVec3==C.stackVec3.length){let t=new Array(C.sizeVec3<<1),i=0,s=C.sizeVec3;for(;i<s;){let s=i++;t[s]=C.stackVec3[s],C.stackVec3[s]=null}C.stackVec3=t}C.stackVec3[C.sizeVec3++]=b}let j=this._pool;if(null!=x){if(x.zero(),j.sizeVec3==j.stackVec3.length){let t=new Array(j.sizeVec3<<1),i=0,s=j.sizeVec3;for(;i<s;){let s=i++;t[s]=j.stackVec3[s],j.stackVec3[s]=null}j.stackVec3=t}j.stackVec3[j.sizeVec3++]=x}let R=this._pool;if(null!=u){if(u.zero(),R.sizeVec3==R.stackVec3.length){let t=new Array(R.sizeVec3<<1),i=0,s=R.sizeVec3;for(;i<s;){let s=i++;t[s]=R.stackVec3[s],R.stackVec3[s]=null}R.stackVec3=t}R.stackVec3[R.sizeVec3++]=u}let E=this._pool;if(null!=v){if(v.zero(),E.sizeVec3==E.stackVec3.length){let t=new Array(E.sizeVec3<<1),i=0,s=E.sizeVec3;for(;i<s;){let s=i++;t[s]=E.stackVec3[s],E.stackVec3[s]=null}E.stackVec3=t}E.stackVec3[E.sizeVec3++]=v}let q=this._pool;if(null!=g){if(g.zero(),q.sizeVec3==q.stackVec3.length){let t=new Array(q.sizeVec3<<1),i=0,s=q.sizeVec3;for(;i<s;){let s=i++;t[s]=q.stackVec3[s],q.stackVec3[s]=null}q.stackVec3=t}q.stackVec3[q.sizeVec3++]=g}let N=this._pool;if(null!=Y){if(Y.zero(),N.sizeVec3==N.stackVec3.length){let t=new Array(N.sizeVec3<<1),i=0,s=N.sizeVec3;for(;i<s;){let s=i++;t[s]=N.stackVec3[s],N.stackVec3[s]=null}N.stackVec3=t}N.stackVec3[N.sizeVec3++]=Y}let D=this._pool;if(null!=Z){if(Z.zero(),D.sizeVec3==D.stackVec3.length){let t=new Array(D.sizeVec3<<1),i=0,s=D.sizeVec3;for(;i<s;){let s=i++;t[s]=D.stackVec3[s],D.stackVec3[s]=null}D.stackVec3=t}D.stackVec3[D.sizeVec3++]=Z}i=a}}}_drawRotationalLimit(t,i,a,o,n,e,r,_,l){if(r!=_){let h=this._pool,c=0==h.sizeVec3?new s.common.Vec3:h.stackVec3[--h.sizeVec3];c.x=i.x,c.y=i.y,c.z=i.z;let m=c;m.x+=n.x*e,m.y+=n.y*e,m.z+=n.z*e,t.line(i,m,l);let b=this._pool;if(null!=m){if(m.zero(),b.sizeVec3==b.stackVec3.length){let t=new Array(b.sizeVec3<<1),i=0,s=b.sizeVec3;for(;i<s;){let s=i++;t[s]=b.stackVec3[s],b.stackVec3[s]=null}b.stackVec3=t}b.stackVec3[b.sizeVec3++]=m}r>_?t.ellipse(i,a,o,e,e,l):t.arc(i,a,o,e,e,r,_,!0,l)}}_drawTranslationalLimit(t,i,a,o,n,e){if(o<n){let r=this._pool,_=0==r.sizeVec3?new s.common.Vec3:r.stackVec3[--r.sizeVec3];_.x=i.x,_.y=i.y,_.z=i.z;let l=_;l.x+=a.x*o,l.y+=a.y*o,l.z+=a.z*o;let h=this._pool,c=0==h.sizeVec3?new s.common.Vec3:h.stackVec3[--h.sizeVec3];c.x=i.x,c.y=i.y,c.z=i.z;let m=c;m.x+=a.x*n,m.y+=a.y*n,m.z+=a.z*n,t.line(l,m,e);let b=this._pool;if(null!=l){if(l.zero(),b.sizeVec3==b.stackVec3.length){let t=new Array(b.sizeVec3<<1),i=0,s=b.sizeVec3;for(;i<s;){let s=i++;t[s]=b.stackVec3[s],b.stackVec3[s]=null}b.stackVec3=t}b.stackVec3[b.sizeVec3++]=l}let p=this._pool;if(null!=m){if(m.zero(),p.sizeVec3==p.stackVec3.length){let t=new Array(p.sizeVec3<<1),i=0,s=p.sizeVec3;for(;i<s;){let s=i++;t[s]=p.stackVec3[s],p.stackVec3[s]=null}p.stackVec3=t}p.stackVec3[p.sizeVec3++]=m}}}_drawTranslationalLimit3D(t,i,a,o,n,e,r,_,l){let h=e.lowerLimit,c=e.upperLimit,m=r.lowerLimit,b=r.upperLimit,p=_.lowerLimit,x=_.upperLimit,f=this._pool;0==f.sizeVec3?new s.common.Vec3:--f.sizeVec3;let u=this._pool;0==u.sizeVec3?new s.common.Vec3:--u.sizeVec3;let y=this._pool,v=0==y.sizeVec3?new s.common.Vec3:y.stackVec3[--y.sizeVec3];v.x=i.x,v.y=i.y,v.z=i.z;let d=v;d.x+=a.x*h,d.y+=a.y*h,d.z+=a.z*h,d.x+=o.x*m,d.y+=o.y*m,d.z+=o.z*m,d.x+=n.x*p,d.y+=n.y*p,d.z+=n.z*p;let g=this._pool,X=0==g.sizeVec3?new s.common.Vec3:g.stackVec3[--g.sizeVec3];X.x=i.x,X.y=i.y,X.z=i.z;let Y=X;Y.x+=a.x*h,Y.y+=a.y*h,Y.z+=a.z*h,Y.x+=o.x*m,Y.y+=o.y*m,Y.z+=o.z*m,Y.x+=n.x*x,Y.y+=n.y*x,Y.z+=n.z*x;let z=this._pool,Z=0==z.sizeVec3?new s.common.Vec3:z.stackVec3[--z.sizeVec3];Z.x=i.x,Z.y=i.y,Z.z=i.z;let M=Z;M.x+=a.x*h,M.y+=a.y*h,M.z+=a.z*h,M.x+=o.x*b,M.y+=o.y*b,M.z+=o.z*b,M.x+=n.x*p,M.y+=n.y*p,M.z+=n.z*p;let I=this._pool,V=0==I.sizeVec3?new s.common.Vec3:I.stackVec3[--I.sizeVec3];V.x=i.x,V.y=i.y,V.z=i.z;let L=V;L.x+=a.x*h,L.y+=a.y*h,L.z+=a.z*h,L.x+=o.x*b,L.y+=o.y*b,L.z+=o.z*b,L.x+=n.x*x,L.y+=n.y*x,L.z+=n.z*x;let w=this._pool,k=0==w.sizeVec3?new s.common.Vec3:w.stackVec3[--w.sizeVec3];k.x=i.x,k.y=i.y,k.z=i.z;let A=k;A.x+=a.x*c,A.y+=a.y*c,A.z+=a.z*c,A.x+=o.x*m,A.y+=o.y*m,A.z+=o.z*m,A.x+=n.x*p,A.y+=n.y*p,A.z+=n.z*p;let B=this._pool,P=0==B.sizeVec3?new s.common.Vec3:B.stackVec3[--B.sizeVec3];P.x=i.x,P.y=i.y,P.z=i.z;let S=P;S.x+=a.x*c,S.y+=a.y*c,S.z+=a.z*c,S.x+=o.x*m,S.y+=o.y*m,S.z+=o.z*m,S.x+=n.x*x,S.y+=n.y*x,S.z+=n.z*x;let T=this._pool,C=0==T.sizeVec3?new s.common.Vec3:T.stackVec3[--T.sizeVec3];C.x=i.x,C.y=i.y,C.z=i.z;let j=C;j.x+=a.x*c,j.y+=a.y*c,j.z+=a.z*c,j.x+=o.x*b,j.y+=o.y*b,j.z+=o.z*b,j.x+=n.x*p,j.y+=n.y*p,j.z+=n.z*p;let R=this._pool,E=0==R.sizeVec3?new s.common.Vec3:R.stackVec3[--R.sizeVec3];E.x=i.x,E.y=i.y,E.z=i.z;let q=E;q.x+=a.x*c,q.y+=a.y*c,q.z+=a.z*c,q.x+=o.x*b,q.y+=o.y*b,q.z+=o.z*b,q.x+=n.x*x,q.y+=n.y*x,q.z+=n.z*x,t.line(d,A,l),t.line(M,j,l),t.line(Y,S,l),t.line(L,q,l),t.line(d,M,l),t.line(A,j,l),t.line(Y,L,l),t.line(S,q,l),t.line(d,Y,l),t.line(A,S,l),t.line(M,L,l),t.line(j,q,l);let N=this._pool;if(null!=d){if(d.zero(),N.sizeVec3==N.stackVec3.length){let t=new Array(N.sizeVec3<<1),i=0,s=N.sizeVec3;for(;i<s;){let s=i++;t[s]=N.stackVec3[s],N.stackVec3[s]=null}N.stackVec3=t}N.stackVec3[N.sizeVec3++]=d}let D=this._pool;if(null!=Y){if(Y.zero(),D.sizeVec3==D.stackVec3.length){let t=new Array(D.sizeVec3<<1),i=0,s=D.sizeVec3;for(;i<s;){let s=i++;t[s]=D.stackVec3[s],D.stackVec3[s]=null}D.stackVec3=t}D.stackVec3[D.sizeVec3++]=Y}let F=this._pool;if(null!=M){if(M.zero(),F.sizeVec3==F.stackVec3.length){let t=new Array(F.sizeVec3<<1),i=0,s=F.sizeVec3;for(;i<s;){let s=i++;t[s]=F.stackVec3[s],F.stackVec3[s]=null}F.stackVec3=t}F.stackVec3[F.sizeVec3++]=M}let H=this._pool;if(null!=L){if(L.zero(),H.sizeVec3==H.stackVec3.length){let t=new Array(H.sizeVec3<<1),i=0,s=H.sizeVec3;for(;i<s;){let s=i++;t[s]=H.stackVec3[s],H.stackVec3[s]=null}H.stackVec3=t}H.stackVec3[H.sizeVec3++]=L}let G=this._pool;if(null!=A){if(A.zero(),G.sizeVec3==G.stackVec3.length){let t=new Array(G.sizeVec3<<1),i=0,s=G.sizeVec3;for(;i<s;){let s=i++;t[s]=G.stackVec3[s],G.stackVec3[s]=null}G.stackVec3=t}G.stackVec3[G.sizeVec3++]=A}let W=this._pool;if(null!=S){if(S.zero(),W.sizeVec3==W.stackVec3.length){let t=new Array(W.sizeVec3<<1),i=0,s=W.sizeVec3;for(;i<s;){let s=i++;t[s]=W.stackVec3[s],W.stackVec3[s]=null}W.stackVec3=t}W.stackVec3[W.sizeVec3++]=S}let O=this._pool;if(null!=j){if(j.zero(),O.sizeVec3==O.stackVec3.length){let t=new Array(O.sizeVec3<<1),i=0,s=O.sizeVec3;for(;i<s;){let s=i++;t[s]=O.stackVec3[s],O.stackVec3[s]=null}O.stackVec3=t}O.stackVec3[O.sizeVec3++]=j}let J=this._pool;if(null!=q){if(q.zero(),J.sizeVec3==J.stackVec3.length){let t=new Array(J.sizeVec3<<1),i=0,s=J.sizeVec3;for(;i<s;){let s=i++;t[s]=J.stackVec3[s],J.stackVec3[s]=null}J.stackVec3=t}J.stackVec3[J.sizeVec3++]=q}}_drawEllipseOnSphere(t,i,a,o,n,e,r,_,l){let h=0,c=this._pool,m=0==c.sizeVec3?new s.common.Vec3:c.stackVec3[--c.sizeVec3],b=this._pool,p=0==b.sizeQuat?new s.common.Quat:b.stackQuat[--b.sizeQuat],x=this._pool,f=0==x.sizeMat3?new s.common.Mat3:x.stackMat3[--x.sizeMat3],u=this._pool,y=0==u.sizeVec3?new s.common.Vec3:u.stackVec3[--u.sizeVec3],v=0;for(;v<17;){let c=v++,b=Math.cos(h)*e,x=Math.sin(h)*r,u=Math.sqrt(b*b+x*x),d=Math.sin(.5*u),g=Math.cos(.5*u),X=m.zero();X.x+=o.x*b,X.y+=o.y*b,X.z+=o.z*b,X.x+=n.x*x,X.y+=n.y*x,X.z+=n.z*x;let Y=1/u*d;m.x*=Y,m.y*=Y,m.z*=Y,p.x=m.x,p.y=m.y,p.z=m.z,p.w=g;let z=p.x,Z=p.y,M=p.z,I=p.w,V=2*z,L=2*Z,w=2*M,k=z*V,A=Z*L,B=M*w,P=z*L,S=Z*w,T=z*w,C=I*V,j=I*L,R=I*w;f.e00=1-A-B,f.e01=P-R,f.e02=T+j,f.e10=P+R,f.e11=1-k-B,f.e12=S-C,f.e20=T-j,f.e21=S+C,f.e22=1-k-A;let E=this._pool,q=0==E.sizeVec3?new s.common.Vec3:E.stackVec3[--E.sizeVec3];q.x+=a.x*_,q.y+=a.y*_,q.z+=a.z*_;let N=q,D=N.x*f.e10+N.y*f.e11+N.z*f.e12,F=N.x*f.e20+N.y*f.e21+N.z*f.e22;N.x=N.x*f.e00+N.y*f.e01+N.z*f.e02,N.y=D,N.z=F,N.x+=i.x,N.y+=i.y,N.z+=i.z,c>=1&&t.line(y,N,l);let H=this._pool;if(null!=y){if(y.zero(),H.sizeVec3==H.stackVec3.length){let t=new Array(H.sizeVec3<<1),i=0,s=H.sizeVec3;for(;i<s;){let s=i++;t[s]=H.stackVec3[s],H.stackVec3[s]=null}H.stackVec3=t}H.stackVec3[H.sizeVec3++]=y}y=N,h+=.39269908169872375}let d=this._pool;if(null!=m){if(m.zero(),d.sizeVec3==d.stackVec3.length){let t=new Array(d.sizeVec3<<1),i=0,s=d.sizeVec3;for(;i<s;){let s=i++;t[s]=d.stackVec3[s],d.stackVec3[s]=null}d.stackVec3=t}d.stackVec3[d.sizeVec3++]=m}let g=this._pool;if(null!=p){if(p.x=0,p.y=0,p.z=0,p.w=1,g.sizeQuat==g.stackQuat.length){let t=new Array(g.sizeQuat<<1),i=0,s=g.sizeQuat;for(;i<s;){let s=i++;t[s]=g.stackQuat[s],g.stackQuat[s]=null}g.stackQuat=t}g.stackQuat[g.sizeQuat++]=p}let X=this._pool;if(null!=f){if(f.e00=1,f.e01=0,f.e02=0,f.e10=0,f.e11=1,f.e12=0,f.e20=0,f.e21=0,f.e22=1,X.sizeMat3==X.stackMat3.length){let t=new Array(X.sizeMat3<<1),i=0,s=X.sizeMat3;for(;i<s;){let s=i++;t[s]=X.stackMat3[s],X.stackMat3[s]=null}X.stackMat3=t}X.stackMat3[X.sizeMat3++]=f}let Y=this._pool;if(null!=y){if(y.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,s=Y.sizeVec3;for(;i<s;){let s=i++;t[s]=Y.stackVec3[s],Y.stackVec3[s]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=y}}step(t){this._timeStep.dt>0&&(this._timeStep.dtRatio=t/this._timeStep.dt),this._timeStep.dt=t,this._timeStep.invDt=1/t;let i=Date.now()/1e3;this._updateContacts(),this._solveIslands(),s.dynamics.common.Performance.totalTime=1e3*(Date.now()/1e3-i)}addRigidBody(t){if(null!=t._world)throw new Error("A rigid body cannot belong to multiple worlds.");null==this._rigidBodyList?(this._rigidBodyList=t,this._rigidBodyListLast=t):(this._rigidBodyListLast._next=t,t._prev=this._rigidBodyListLast,this._rigidBodyListLast=t),t._world=this;let i=t._shapeList;for(;null!=i;){let t=i._next;i._proxy=this._broadPhase.createProxy(i,i._aabb),i._id=this._shapeIdCount++,this._numShapes++,i=t}this._numRigidBodies++}removeRigidBody(t){if(t._world!=this)throw new Error("The rigid body doesn't belong to the world.");let i=t._prev,s=t._next;null!=i&&(i._next=s),null!=s&&(s._prev=i),t==this._rigidBodyList&&(this._rigidBodyList=this._rigidBodyList._next),t==this._rigidBodyListLast&&(this._rigidBodyListLast=this._rigidBodyListLast._prev),t._next=null,t._prev=null,t._world=null;let a=t._shapeList;for(;null!=a;){let t=a._next;this._broadPhase.destroyProxy(a._proxy),a._proxy=null,a._id=-1;let i=a._rigidBody._contactLinkList;for(;null!=i;){let t=i._next,s=i._contact;if(s._s1==a||s._s2==a){let t=i._other;t._sleeping=!1,t._sleepTime=0;let a=this._contactManager,o=s._prev,n=s._next;if(null!=o&&(o._next=n),null!=n&&(n._prev=o),s==a._contactList&&(a._contactList=a._contactList._next),s==a._contactListLast&&(a._contactListLast=a._contactListLast._prev),s._next=null,s._prev=null,s._touching){let t=s._s1._contactCallback,i=s._s2._contactCallback;t==i&&(i=null),null!=t&&t.endContact(s),null!=i&&i.endContact(s)}let e=s._link1._prev,r=s._link1._next;null!=e&&(e._next=r),null!=r&&(r._prev=e),s._link1==s._b1._contactLinkList&&(s._b1._contactLinkList=s._b1._contactLinkList._next),s._link1==s._b1._contactLinkListLast&&(s._b1._contactLinkListLast=s._b1._contactLinkListLast._prev),s._link1._next=null,s._link1._prev=null;let _=s._link2._prev,l=s._link2._next;null!=_&&(_._next=l),null!=l&&(l._prev=_),s._link2==s._b2._contactLinkList&&(s._b2._contactLinkList=s._b2._contactLinkList._next),s._link2==s._b2._contactLinkListLast&&(s._b2._contactLinkListLast=s._b2._contactLinkListLast._prev),s._link2._next=null,s._link2._prev=null,s._b1._numContactLinks--,s._b2._numContactLinks--,s._link1._other=null,s._link2._other=null,s._link1._contact=null,s._link2._contact=null,s._s1=null,s._s2=null,s._b1=null,s._b2=null,s._touching=!1,s._cachedDetectorData._clear(),s._manifold._clear(),s._detector=null;let h=s._contactConstraint;h._s1=null,h._s2=null,h._b1=null,h._b2=null,h._tf1=null,h._tf2=null,s._next=a._contactPool,a._contactPool=s,a._numContacts--}i=t}this._numShapes--,a=t}this._numRigidBodies--}addJoint(t){if(null!=t._world)throw new Error("A joint cannot belong to multiple worlds.");null==this._jointList?(this._jointList=t,this._jointListLast=t):(this._jointListLast._next=t,t._prev=this._jointListLast,this._jointListLast=t),t._world=this,t._link1._other=t._b2,t._link2._other=t._b1,null==t._b1._jointLinkList?(t._b1._jointLinkList=t._link1,t._b1._jointLinkListLast=t._link1):(t._b1._jointLinkListLast._next=t._link1,t._link1._prev=t._b1._jointLinkListLast,t._b1._jointLinkListLast=t._link1),null==t._b2._jointLinkList?(t._b2._jointLinkList=t._link2,t._b2._jointLinkListLast=t._link2):(t._b2._jointLinkListLast._next=t._link2,t._link2._prev=t._b2._jointLinkListLast,t._b2._jointLinkListLast=t._link2),t._b1._numJointLinks++,t._b2._numJointLinks++;let i=t._b1;i._sleeping=!1,i._sleepTime=0;let s=t._b2;s._sleeping=!1,s._sleepTime=0,t._syncAnchors(),this._numJoints++}removeJoint(t){if(t._world!=this)throw new Error("The joint doesn't belong to the world.");let i=t._prev,s=t._next;null!=i&&(i._next=s),null!=s&&(s._prev=i),t==this._jointList&&(this._jointList=this._jointList._next),t==this._jointListLast&&(this._jointListLast=this._jointListLast._prev),t._next=null,t._prev=null,t._world=null;let a=t._link1._prev,o=t._link1._next;null!=a&&(a._next=o),null!=o&&(o._prev=a),t._link1==t._b1._jointLinkList&&(t._b1._jointLinkList=t._b1._jointLinkList._next),t._link1==t._b1._jointLinkListLast&&(t._b1._jointLinkListLast=t._b1._jointLinkListLast._prev),t._link1._next=null,t._link1._prev=null;let n=t._link2._prev,e=t._link2._next;null!=n&&(n._next=e),null!=e&&(e._prev=n),t._link2==t._b2._jointLinkList&&(t._b2._jointLinkList=t._b2._jointLinkList._next),t._link2==t._b2._jointLinkListLast&&(t._b2._jointLinkListLast=t._b2._jointLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._link1._other=null,t._link2._other=null,t._b1._numJointLinks--,t._b2._numJointLinks--;let r=t._b1;r._sleeping=!1,r._sleepTime=0;let _=t._b2;_._sleeping=!1,_._sleepTime=0,this._numJoints--}setDebugDraw(t){this._debugDraw=t}getDebugDraw(){return this._debugDraw}debugDraw(){null!=this._debugDraw&&(2==this._broadPhase._type&&this._drawBvh(this._debugDraw,this._broadPhase._tree),this._drawRigidBodies(this._debugDraw),this._drawConstraints(this._debugDraw))}rayCast(t,i,s){let a=this._rayCastWrapper.begin;a.x=t.x,a.y=t.y,a.z=t.z;let o=this._rayCastWrapper.end;o.x=i.x,o.y=i.y,o.z=i.z,this._rayCastWrapper.callback=s,this._broadPhase.rayCast(t,i,this._rayCastWrapper)}convexCast(t,i,s,a){this._convexCastWrapper.convex=t;let o=this._convexCastWrapper.begin;o._positionX=i._positionX,o._positionY=i._positionY,o._positionZ=i._positionZ,o._rotation00=i._rotation00,o._rotation01=i._rotation01,o._rotation02=i._rotation02,o._rotation10=i._rotation10,o._rotation11=i._rotation11,o._rotation12=i._rotation12,o._rotation20=i._rotation20,o._rotation21=i._rotation21,o._rotation22=i._rotation22;let n=this._convexCastWrapper.translation;n.x=s.x,n.y=s.y,n.z=s.z,this._convexCastWrapper.callback=a,this._broadPhase.convexCast(t,i,s,this._convexCastWrapper)}aabbTest(t,i){this._aabbTestWrapper._aabb.copyFrom(t),this._aabbTestWrapper._callback=i,this._broadPhase.aabbTest(t,this._aabbTestWrapper)}getRigidBodyList(){return this._rigidBodyList}getJointList(){return this._jointList}getBroadPhase(){return this._broadPhase}getContactManager(){return this._contactManager}getNumRigidBodies(){return this._numRigidBodies}getNumJoints(){return this._numJoints}getNumShapes(){return this._numShapes}getNumIslands(){return this._numIslands}getNumVelocityIterations(){return this._numVelocityIterations}setNumVelocityIterations(t){this._numVelocityIterations=t}getNumPositionIterations(){return this._numPositionIterations}setNumPositionIterations(t){this._numPositionIterations=t}getGravity(){return this._gravity}setGravity(t){let i=this._gravity;i.x=t.x,i.y=t.y,i.z=t.z}},s.dynamics._World||(s.dynamics._World={}),s.dynamics._World.RayCastWrapper=class extends s.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new s.collision.geometry.RayCastHit,this.begin=new s.common.Vec3,this.end=new s.common.Vec3,this.callback=null}process(t){let i=t.userData;i._geom.rayCast(this.begin,this.end,i._transform,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}},s.dynamics._World.ConvexCastWrapper=class extends s.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new s.collision.geometry.RayCastHit,this.begin=new s.common.Transform,this.translation=new s.common.Vec3,this.zero=new s.common.Vec3,this.callback=null,this.convex=null}process(t){let i=t.userData,a=i._geom._type;a<0||a>5||s.collision.narrowphase.detector.gjkepa.GjkEpa.instance.convexCast(this.convex,i._geom,this.begin,i._transform,this.translation,this.zero,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}},s.dynamics._World.AabbTestWrapper=class extends s.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this._aabb=new s.collision.geometry.Aabb,this._callback=null}process(t){let i=t.userData,s=i._aabb;s._minX<this._aabb._maxX&&s._maxX>this._aabb._minX&&s._minY<this._aabb._maxY&&s._maxY>this._aabb._minY&&s._minZ<this._aabb._maxZ&&s._maxZ>this._aabb._minZ&&this._callback.process(i)}},s.dynamics.callback||(s.dynamics.callback={}),s.dynamics.callback.AabbTestCallback=class{constructor(){}process(t){}},s.dynamics.callback.ContactCallback=class{constructor(){}beginContact(t){}preSolve(t){}postSolve(t){}endContact(t){}},s.dynamics.callback.RayCastCallback=class{constructor(){}process(t,i){}},s.dynamics.callback.RayCastClosest=class extends s.dynamics.callback.RayCastCallback{constructor(){super(),this.position=new s.common.Vec3,this.normal=new s.common.Vec3,this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}clear(){this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}process(t,i){if(i.fraction<this.fraction){this.shape=t,this.hit=!0,this.fraction=i.fraction;let s=this.position,a=i.position;s.x=a.x,s.y=a.y,s.z=a.z;let o=this.normal,n=i.normal;o.x=n.x,o.y=n.y,o.z=n.z}}},s.dynamics.common||(s.dynamics.common={}),s.dynamics.common.DebugDraw=class{constructor(){this.p=new s.common.Pool,this.wireframe=!1,this.drawShapes=!0,this.drawBvh=!1,this.drawBvhMinLevel=0,this.drawBvhMaxLevel=65536,this.drawAabbs=!1,this.drawBases=!1,this.drawPairs=!1,this.drawContacts=!1,this.drawJoints=!0,this.drawJointLimits=!1,this.sphereCoords=new Array(5),this.tmpSphereVerts=new Array(5),this.tmpSphereNorms=new Array(5);let t=0;for(;t<5;){let i=t++,a=0==i||4==i?1:8;this.sphereCoords[i]=new Array(a),this.tmpSphereVerts[i]=new Array(a),this.tmpSphereNorms[i]=new Array(a);let o=0;for(;o<8;){let t=o++,a=.7853981633974475*i,n=.7853981633974475*t;this.sphereCoords[i][t]=new s.common.Vec3(Math.sin(a)*Math.cos(n),Math.cos(a),-Math.sin(a)*Math.sin(n)),this.tmpSphereVerts[i][t]=new s.common.Vec3,this.tmpSphereNorms[i][t]=new s.common.Vec3}}this.circleCoords=new Array(8),this.circleCoordsShift=new Array(8),this.tmpCircleVerts1=new Array(8),this.tmpCircleVerts2=new Array(8),this.tmpCircleNorms=new Array(8);let i=0;for(;i<8;){let t=i++;this.circleCoords[t]=new s.common.Vec3(Math.cos(.7853981633974475*t),0,-Math.sin(.7853981633974475*t)),this.circleCoordsShift[t]=new s.common.Vec3(Math.cos(.7853981633974475*(t+.5)),0,-Math.sin(.7853981633974475*(t+.5))),this.tmpCircleVerts1[t]=new s.common.Vec3,this.tmpCircleVerts2[t]=new s.common.Vec3,this.tmpCircleNorms[t]=new s.common.Vec3}this.style=new s.dynamics.common.DebugDrawStyle}aabb(t,i,a){let o=this.p,n=(0==o.sizeVec3?new s.common.Vec3:o.stackVec3[--o.sizeVec3]).init(t.x,t.y,t.z),e=this.p,r=(0==e.sizeVec3?new s.common.Vec3:e.stackVec3[--e.sizeVec3]).init(t.x,t.y,i.z),_=this.p,l=(0==_.sizeVec3?new s.common.Vec3:_.stackVec3[--_.sizeVec3]).init(t.x,i.y,t.z),h=this.p,c=(0==h.sizeVec3?new s.common.Vec3:h.stackVec3[--h.sizeVec3]).init(t.x,i.y,i.z),m=this.p,b=(0==m.sizeVec3?new s.common.Vec3:m.stackVec3[--m.sizeVec3]).init(i.x,t.y,t.z),p=this.p,x=(0==p.sizeVec3?new s.common.Vec3:p.stackVec3[--p.sizeVec3]).init(i.x,t.y,i.z),f=this.p,u=(0==f.sizeVec3?new s.common.Vec3:f.stackVec3[--f.sizeVec3]).init(i.x,i.y,t.z),y=this.p,v=(0==y.sizeVec3?new s.common.Vec3:y.stackVec3[--y.sizeVec3]).init(i.x,i.y,i.z);this.line(n,r,a),this.line(l,c,a),this.line(b,x,a),this.line(u,v,a),this.line(n,l,a),this.line(r,c,a),this.line(b,u,a),this.line(x,v,a),this.line(n,b,a),this.line(r,x,a),this.line(l,u,a),this.line(c,v,a);let d=this.p;if(null!=n){if(n.zero(),d.sizeVec3==d.stackVec3.length){let t=new Array(d.sizeVec3<<1),i=0,s=d.sizeVec3;for(;i<s;){let s=i++;t[s]=d.stackVec3[s],d.stackVec3[s]=null}d.stackVec3=t}d.stackVec3[d.sizeVec3++]=n}let g=this.p;if(null!=r){if(r.zero(),g.sizeVec3==g.stackVec3.length){let t=new Array(g.sizeVec3<<1),i=0,s=g.sizeVec3;for(;i<s;){let s=i++;t[s]=g.stackVec3[s],g.stackVec3[s]=null}g.stackVec3=t}g.stackVec3[g.sizeVec3++]=r}let X=this.p;if(null!=l){if(l.zero(),X.sizeVec3==X.stackVec3.length){let t=new Array(X.sizeVec3<<1),i=0,s=X.sizeVec3;for(;i<s;){let s=i++;t[s]=X.stackVec3[s],X.stackVec3[s]=null}X.stackVec3=t}X.stackVec3[X.sizeVec3++]=l}let Y=this.p;if(null!=c){if(c.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,s=Y.sizeVec3;for(;i<s;){let s=i++;t[s]=Y.stackVec3[s],Y.stackVec3[s]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=c}let z=this.p;if(null!=b){if(b.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,s=z.sizeVec3;for(;i<s;){let s=i++;t[s]=z.stackVec3[s],z.stackVec3[s]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=b}let Z=this.p;if(null!=x){if(x.zero(),Z.sizeVec3==Z.stackVec3.length){let t=new Array(Z.sizeVec3<<1),i=0,s=Z.sizeVec3;for(;i<s;){let s=i++;t[s]=Z.stackVec3[s],Z.stackVec3[s]=null}Z.stackVec3=t}Z.stackVec3[Z.sizeVec3++]=x}let M=this.p;if(null!=u){if(u.zero(),M.sizeVec3==M.stackVec3.length){let t=new Array(M.sizeVec3<<1),i=0,s=M.sizeVec3;for(;i<s;){let s=i++;t[s]=M.stackVec3[s],M.stackVec3[s]=null}M.stackVec3=t}M.stackVec3[M.sizeVec3++]=u}let I=this.p;if(null!=v){if(v.zero(),I.sizeVec3==I.stackVec3.length){let t=new Array(I.sizeVec3<<1),i=0,s=I.sizeVec3;for(;i<s;){let s=i++;t[s]=I.stackVec3[s],I.stackVec3[s]=null}I.stackVec3=t}I.stackVec3[I.sizeVec3++]=v}}basis(t,i,a,o,n){let e=this.p,r=0==e.sizeVec3?new s.common.Vec3:e.stackVec3[--e.sizeVec3],_=this.p,l=0==_.sizeMat3?new s.common.Mat3:_.stackMat3[--_.sizeMat3],h=this.p,c=0==h.sizeVec3?new s.common.Vec3:h.stackVec3[--h.sizeVec3],m=this.p,b=0==m.sizeVec3?new s.common.Vec3:m.stackVec3[--m.sizeVec3],p=this.p,x=0==p.sizeVec3?new s.common.Vec3:p.stackVec3[--p.sizeVec3],f=r;f.x=t._positionX,f.y=t._positionY,f.z=t._positionZ;let u=l;u.e00=t._rotation00,u.e01=t._rotation01,u.e02=t._rotation02,u.e10=t._rotation10,u.e11=t._rotation11,u.e12=t._rotation12,u.e20=t._rotation20,u.e21=t._rotation21,u.e22=t._rotation22,c.init(l.e00,l.e10,l.e20),b.init(l.e01,l.e11,l.e21),x.init(l.e02,l.e12,l.e22),c.x*=i,c.y*=i,c.z*=i;let y=c;y.x+=r.x,y.y+=r.y,y.z+=r.z,b.x*=i,b.y*=i,b.z*=i;let v=b;v.x+=r.x,v.y+=r.y,v.z+=r.z,x.x*=i,x.y*=i,x.z*=i;let d=x;d.x+=r.x,d.y+=r.y,d.z+=r.z,this.line(r,c,a),this.line(r,b,o),this.line(r,x,n);let g=this.p;if(null!=r){if(r.zero(),g.sizeVec3==g.stackVec3.length){let t=new Array(g.sizeVec3<<1),i=0,s=g.sizeVec3;for(;i<s;){let s=i++;t[s]=g.stackVec3[s],g.stackVec3[s]=null}g.stackVec3=t}g.stackVec3[g.sizeVec3++]=r}let X=this.p;if(null!=l){if(l.e00=1,l.e01=0,l.e02=0,l.e10=0,l.e11=1,l.e12=0,l.e20=0,l.e21=0,l.e22=1,X.sizeMat3==X.stackMat3.length){let t=new Array(X.sizeMat3<<1),i=0,s=X.sizeMat3;for(;i<s;){let s=i++;t[s]=X.stackMat3[s],X.stackMat3[s]=null}X.stackMat3=t}X.stackMat3[X.sizeMat3++]=l}let Y=this.p;if(null!=c){if(c.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,s=Y.sizeVec3;for(;i<s;){let s=i++;t[s]=Y.stackVec3[s],Y.stackVec3[s]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=c}let z=this.p;if(null!=b){if(b.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,s=z.sizeVec3;for(;i<s;){let s=i++;t[s]=z.stackVec3[s],z.stackVec3[s]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=b}let Z=this.p;if(null!=x){if(x.zero(),Z.sizeVec3==Z.stackVec3.length){let t=new Array(Z.sizeVec3<<1),i=0,s=Z.sizeVec3;for(;i<s;){let s=i++;t[s]=Z.stackVec3[s],Z.stackVec3[s]=null}Z.stackVec3=t}Z.stackVec3[Z.sizeVec3++]=x}}ellipse(t,i,s,a,o,n){this.arc(t,i,s,a,o,0,6.28318530717958,!1,n)}arc(t,i,a,o,n,e,r,_,l){let h=this.p,c=0==h.sizeVec3?new s.common.Vec3:h.stackVec3[--h.sizeVec3];c.x=i.x,c.y=i.y,c.z=i.z;let m=c;m.x*=o,m.y*=o,m.z*=o;let b=this.p,p=0==b.sizeVec3?new s.common.Vec3:b.stackVec3[--b.sizeVec3];p.x=a.x,p.y=a.y,p.z=a.z;let x=p;x.x*=n,x.y*=n,x.z*=n;let f=r-e;f<0&&(f=-f);let u=f/.5235987755982984+.5|0;0==u&&(u=1);let y=e,v=(r-e)/u,d=this.p,g=0==d.sizeVec3?new s.common.Vec3:d.stackVec3[--d.sizeVec3];g.x=t.x,g.y=t.y,g.z=t.z;let X=g,Y=Math.cos(e);X.x+=m.x*Y,X.y+=m.y*Y,X.z+=m.z*Y;let z=Math.sin(e);X.x+=x.x*z,X.y+=x.y*z,X.z+=x.z*z;let Z=X;_&&this.line(t,X,l);let M=0,I=u;for(;M<I;){++M,y+=v;let i=this.p,a=0==i.sizeVec3?new s.common.Vec3:i.stackVec3[--i.sizeVec3];a.x=t.x,a.y=t.y,a.z=t.z;let o=a,n=Math.cos(y);o.x+=m.x*n,o.y+=m.y*n,o.z+=m.z*n;let e=Math.sin(y);o.x+=x.x*e,o.y+=x.y*e,o.z+=x.z*e,this.line(Z,o,l);let r=this.p;if(null!=Z){if(Z.zero(),r.sizeVec3==r.stackVec3.length){let t=new Array(r.sizeVec3<<1),i=0,s=r.sizeVec3;for(;i<s;){let s=i++;t[s]=r.stackVec3[s],r.stackVec3[s]=null}r.stackVec3=t}r.stackVec3[r.sizeVec3++]=Z}Z=o}_&&this.line(t,Z,l);let V=this.p;if(null!=Z){if(Z.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,s=V.sizeVec3;for(;i<s;){let s=i++;t[s]=V.stackVec3[s],V.stackVec3[s]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=Z}let L=this.p;if(null!=m){if(m.zero(),L.sizeVec3==L.stackVec3.length){let t=new Array(L.sizeVec3<<1),i=0,s=L.sizeVec3;for(;i<s;){let s=i++;t[s]=L.stackVec3[s],L.stackVec3[s]=null}L.stackVec3=t}L.stackVec3[L.sizeVec3++]=m}let w=this.p;if(null!=x){if(x.zero(),w.sizeVec3==w.stackVec3.length){let t=new Array(w.sizeVec3<<1),i=0,s=w.sizeVec3;for(;i<s;){let s=i++;t[s]=w.stackVec3[s],w.stackVec3[s]=null}w.stackVec3=t}w.stackVec3[w.sizeVec3++]=x}}cone(t,i,a,o){let n=this.p,e=0==n.sizeVec3?new s.common.Vec3:n.stackVec3[--n.sizeVec3],r=this.p,_=0==r.sizeVec3?new s.common.Vec3:r.stackVec3[--r.sizeVec3],l=this.p,h=0==l.sizeVec3?new s.common.Vec3:l.stackVec3[--l.sizeVec3],c=this.p,m=0==c.sizeVec3?new s.common.Vec3:c.stackVec3[--c.sizeVec3],b=this.p,p=0==b.sizeMat3?new s.common.Mat3:b.stackMat3[--b.sizeMat3],x=m;x.x=t._positionX,x.y=t._positionY,x.z=t._positionZ;let f=p;f.e00=t._rotation00,f.e01=t._rotation01,f.e02=t._rotation02,f.e10=t._rotation10,f.e11=t._rotation11,f.e12=t._rotation12,f.e20=t._rotation20,f.e21=t._rotation21,f.e22=t._rotation22,e.init(p.e00,p.e10,p.e20),_.init(p.e01,p.e11,p.e21),h.init(p.e02,p.e12,p.e22);let u=this.p,y=0==u.sizeVec3?new s.common.Vec3:u.stackVec3[--u.sizeVec3];y.x=m.x,y.y=m.y,y.z=m.z;let v=y;v.x+=_.x*a,v.y+=_.y*a,v.z+=_.z*a;let d=this.p,g=0==d.sizeVec3?new s.common.Vec3:d.stackVec3[--d.sizeVec3];g.x=m.x,g.y=m.y,g.z=m.z;let X=g,Y=-a;if(X.x+=_.x*Y,X.y+=_.y*Y,X.z+=_.z*Y,this.wireframe){let t=this.p,a=0==t.sizeVec3?new s.common.Vec3:t.stackVec3[--t.sizeVec3];a.x=X.x,a.y=X.y,a.z=X.z;let n=a,r=-i;n.x+=e.x*r,n.y+=e.y*r,n.z+=e.z*r,n.x+=0*h.x,n.y+=0*h.y,n.z+=0*h.z;let _=this.p,l=0==_.sizeVec3?new s.common.Vec3:_.stackVec3[--_.sizeVec3];l.x=X.x,l.y=X.y,l.z=X.z;let c=l;c.x+=e.x*i,c.y+=e.y*i,c.z+=e.z*i,c.x+=0*h.x,c.y+=0*h.y,c.z+=0*h.z;let m=this.p,b=0==m.sizeVec3?new s.common.Vec3:m.stackVec3[--m.sizeVec3];b.x=X.x,b.y=X.y,b.z=X.z;let p=b;p.x+=0*e.x,p.y+=0*e.y,p.z+=0*e.z;let x=-i;p.x+=h.x*x,p.y+=h.y*x,p.z+=h.z*x;let f=this.p,u=0==f.sizeVec3?new s.common.Vec3:f.stackVec3[--f.sizeVec3];u.x=X.x,u.y=X.y,u.z=X.z;let y=u;y.x+=0*e.x,y.y+=0*e.y,y.z+=0*e.z,y.x+=h.x*i,y.y+=h.y*i,y.z+=h.z*i,this.ellipse(X,e,h,i,i,o),this.line(v,n,o),this.line(v,c,o),this.line(v,p,o),this.line(v,y,o);let d=this.p;if(null!=n){if(n.zero(),d.sizeVec3==d.stackVec3.length){let t=new Array(d.sizeVec3<<1),i=0,s=d.sizeVec3;for(;i<s;){let s=i++;t[s]=d.stackVec3[s],d.stackVec3[s]=null}d.stackVec3=t}d.stackVec3[d.sizeVec3++]=n}let g=this.p;if(null!=c){if(c.zero(),g.sizeVec3==g.stackVec3.length){let t=new Array(g.sizeVec3<<1),i=0,s=g.sizeVec3;for(;i<s;){let s=i++;t[s]=g.stackVec3[s],g.stackVec3[s]=null}g.stackVec3=t}g.stackVec3[g.sizeVec3++]=c}let Y=this.p;if(null!=p){if(p.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,s=Y.sizeVec3;for(;i<s;){let s=i++;t[s]=Y.stackVec3[s],Y.stackVec3[s]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=p}let z=this.p;if(null!=y){if(y.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,s=z.sizeVec3;for(;i<s;){let s=i++;t[s]=z.stackVec3[s],z.stackVec3[s]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=y}}else{let t=1/Math.sqrt(i*i+4*a*a),n=2*a*t,e=i*t,r=0;for(;r<8;){let t=r++,s=this.tmpCircleNorms[t],o=this.circleCoords[t];s.x=o.x,s.y=o.y,s.z=o.z,s.x*=n,s.y*=n,s.z*=n,s.y+=e;let l=this.tmpCircleNorms[t],h=l.x*p.e10+l.y*p.e11+l.z*p.e12,c=l.x*p.e20+l.y*p.e21+l.z*p.e22;l.x=l.x*p.e00+l.y*p.e01+l.z*p.e02,l.y=h,l.z=c;let b=this.tmpCircleVerts1[t],x=this.circleCoordsShift[t];b.x=x.x,b.y=x.y,b.z=x.z,b.x*=n,b.y*=n,b.z*=n,b.y+=e;let f=this.tmpCircleVerts1[t],u=f.x*p.e10+f.y*p.e11+f.z*p.e12,y=f.x*p.e20+f.y*p.e21+f.z*p.e22;f.x=f.x*p.e00+f.y*p.e01+f.z*p.e02,f.y=u,f.z=y;let v=this.tmpCircleVerts2[t],d=this.circleCoords[t];v.x=d.x,v.y=d.y,v.z=d.z;let g=v.x*p.e10+v.y*p.e11+v.z*p.e12,X=v.x*p.e20+v.y*p.e21+v.z*p.e22;v.x=v.x*p.e00+v.y*p.e01+v.z*p.e02,v.y=g,v.z=X,v.x*=i,v.y*=i,v.z*=i,v.x+=m.x,v.y+=m.y,v.z+=m.z;let Y=this.tmpCircleVerts2[t],z=-a;Y.x+=_.x*z,Y.y+=_.y*z,Y.z+=_.z*z}let l=0;for(;l<8;){let t=l++,i=this.tmpCircleVerts2[t],a=this.tmpCircleVerts2[(t+1)%8],n=this.tmpCircleVerts1[t];this.triangle(v,i,a,n,this.tmpCircleNorms[t],this.tmpCircleNorms[(t+1)%8],o),i=this.tmpCircleVerts2[(t+1)%8],a=this.tmpCircleVerts2[t];let e=this.p,r=0==e.sizeVec3?new s.common.Vec3:e.stackVec3[--e.sizeVec3];r.x=_.x,r.y=_.y,r.z=_.z;let h=r;h.x=-h.x,h.y=-h.y,h.z=-h.z,this.triangle(X,i,a,h,h,h,o);let c=this.p;if(null!=h){if(h.zero(),c.sizeVec3==c.stackVec3.length){let t=new Array(c.sizeVec3<<1),i=0,s=c.sizeVec3;for(;i<s;){let s=i++;t[s]=c.stackVec3[s],c.stackVec3[s]=null}c.stackVec3=t}c.stackVec3[c.sizeVec3++]=h}}}let z=this.p;if(null!=v){if(v.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,s=z.sizeVec3;for(;i<s;){let s=i++;t[s]=z.stackVec3[s],z.stackVec3[s]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=v}let Z=this.p;if(null!=X){if(X.zero(),Z.sizeVec3==Z.stackVec3.length){let t=new Array(Z.sizeVec3<<1),i=0,s=Z.sizeVec3;for(;i<s;){let s=i++;t[s]=Z.stackVec3[s],Z.stackVec3[s]=null}Z.stackVec3=t}Z.stackVec3[Z.sizeVec3++]=X}let M=this.p;if(null!=m){if(m.zero(),M.sizeVec3==M.stackVec3.length){let t=new Array(M.sizeVec3<<1),i=0,s=M.sizeVec3;for(;i<s;){let s=i++;t[s]=M.stackVec3[s],M.stackVec3[s]=null}M.stackVec3=t}M.stackVec3[M.sizeVec3++]=m}let I=this.p;if(null!=p){if(p.e00=1,p.e01=0,p.e02=0,p.e10=0,p.e11=1,p.e12=0,p.e20=0,p.e21=0,p.e22=1,I.sizeMat3==I.stackMat3.length){let t=new Array(I.sizeMat3<<1),i=0,s=I.sizeMat3;for(;i<s;){let s=i++;t[s]=I.stackMat3[s],I.stackMat3[s]=null}I.stackMat3=t}I.stackMat3[I.sizeMat3++]=p}let V=this.p;if(null!=e){if(e.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,s=V.sizeVec3;for(;i<s;){let s=i++;t[s]=V.stackVec3[s],V.stackVec3[s]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=e}let L=this.p;if(null!=_){if(_.zero(),L.sizeVec3==L.stackVec3.length){let t=new Array(L.sizeVec3<<1),i=0,s=L.sizeVec3;for(;i<s;){let s=i++;t[s]=L.stackVec3[s],L.stackVec3[s]=null}L.stackVec3=t}L.stackVec3[L.sizeVec3++]=_}let w=this.p;if(null!=h){if(h.zero(),w.sizeVec3==w.stackVec3.length){let t=new Array(w.sizeVec3<<1),i=0,s=w.sizeVec3;for(;i<s;){let s=i++;t[s]=w.stackVec3[s],w.stackVec3[s]=null}w.stackVec3=t}w.stackVec3[w.sizeVec3++]=h}}cylinder(t,i,a,o){let n=this.p,e=0==n.sizeVec3?new s.common.Vec3:n.stackVec3[--n.sizeVec3],r=this.p,_=0==r.sizeVec3?new s.common.Vec3:r.stackVec3[--r.sizeVec3],l=this.p,h=0==l.sizeVec3?new s.common.Vec3:l.stackVec3[--l.sizeVec3],c=this.p,m=0==c.sizeVec3?new s.common.Vec3:c.stackVec3[--c.sizeVec3],b=this.p,p=0==b.sizeMat3?new s.common.Mat3:b.stackMat3[--b.sizeMat3],x=m;x.x=t._positionX,x.y=t._positionY,x.z=t._positionZ;let f=p;f.e00=t._rotation00,f.e01=t._rotation01,f.e02=t._rotation02,f.e10=t._rotation10,f.e11=t._rotation11,f.e12=t._rotation12,f.e20=t._rotation20,f.e21=t._rotation21,f.e22=t._rotation22,e.init(p.e00,p.e10,p.e20),_.init(p.e01,p.e11,p.e21),h.init(p.e02,p.e12,p.e22);let u=this.p,y=0==u.sizeVec3?new s.common.Vec3:u.stackVec3[--u.sizeVec3];y.x=m.x,y.y=m.y,y.z=m.z;let v=y;v.x+=_.x*a,v.y+=_.y*a,v.z+=_.z*a;let d=this.p,g=0==d.sizeVec3?new s.common.Vec3:d.stackVec3[--d.sizeVec3];g.x=m.x,g.y=m.y,g.z=m.z;let X=g,Y=-a;if(X.x+=_.x*Y,X.y+=_.y*Y,X.z+=_.z*Y,this.wireframe){let t=this.p,a=0==t.sizeVec3?new s.common.Vec3:t.stackVec3[--t.sizeVec3];a.x=v.x,a.y=v.y,a.z=v.z;let n=a,r=-i;n.x+=e.x*r,n.y+=e.y*r,n.z+=e.z*r,n.x+=0*h.x,n.y+=0*h.y,n.z+=0*h.z;let _=this.p,l=0==_.sizeVec3?new s.common.Vec3:_.stackVec3[--_.sizeVec3];l.x=v.x,l.y=v.y,l.z=v.z;let c=l;c.x+=e.x*i,c.y+=e.y*i,c.z+=e.z*i,c.x+=0*h.x,c.y+=0*h.y,c.z+=0*h.z;let m=this.p,b=0==m.sizeVec3?new s.common.Vec3:m.stackVec3[--m.sizeVec3];b.x=v.x,b.y=v.y,b.z=v.z;let p=b;p.x+=0*e.x,p.y+=0*e.y,p.z+=0*e.z;let x=-i;p.x+=h.x*x,p.y+=h.y*x,p.z+=h.z*x;let f=this.p,u=0==f.sizeVec3?new s.common.Vec3:f.stackVec3[--f.sizeVec3];u.x=v.x,u.y=v.y,u.z=v.z;let y=u;y.x+=0*e.x,y.y+=0*e.y,y.z+=0*e.z,y.x+=h.x*i,y.y+=h.y*i,y.z+=h.z*i;let d=this.p,g=0==d.sizeVec3?new s.common.Vec3:d.stackVec3[--d.sizeVec3];g.x=X.x,g.y=X.y,g.z=X.z;let Y=g,z=-i;Y.x+=e.x*z,Y.y+=e.y*z,Y.z+=e.z*z,Y.x+=0*h.x,Y.y+=0*h.y,Y.z+=0*h.z;let Z=this.p,M=0==Z.sizeVec3?new s.common.Vec3:Z.stackVec3[--Z.sizeVec3];M.x=X.x,M.y=X.y,M.z=X.z;let I=M;I.x+=e.x*i,I.y+=e.y*i,I.z+=e.z*i,I.x+=0*h.x,I.y+=0*h.y,I.z+=0*h.z;let V=this.p,L=0==V.sizeVec3?new s.common.Vec3:V.stackVec3[--V.sizeVec3];L.x=X.x,L.y=X.y,L.z=X.z;let w=L;w.x+=0*e.x,w.y+=0*e.y,w.z+=0*e.z;let k=-i;w.x+=h.x*k,w.y+=h.y*k,w.z+=h.z*k;let A=this.p,B=0==A.sizeVec3?new s.common.Vec3:A.stackVec3[--A.sizeVec3];B.x=X.x,B.y=X.y,B.z=X.z;let P=B;P.x+=0*e.x,P.y+=0*e.y,P.z+=0*e.z,P.x+=h.x*i,P.y+=h.y*i,P.z+=h.z*i,this.ellipse(v,e,h,i,i,o),this.ellipse(X,e,h,i,i,o),this.line(n,Y,o),this.line(c,I,o),this.line(p,w,o),this.line(y,P,o);let S=this.p;if(null!=n){if(n.zero(),S.sizeVec3==S.stackVec3.length){let t=new Array(S.sizeVec3<<1),i=0,s=S.sizeVec3;for(;i<s;){let s=i++;t[s]=S.stackVec3[s],S.stackVec3[s]=null}S.stackVec3=t}S.stackVec3[S.sizeVec3++]=n}let T=this.p;if(null!=c){if(c.zero(),T.sizeVec3==T.stackVec3.length){let t=new Array(T.sizeVec3<<1),i=0,s=T.sizeVec3;for(;i<s;){let s=i++;t[s]=T.stackVec3[s],T.stackVec3[s]=null}T.stackVec3=t}T.stackVec3[T.sizeVec3++]=c}let C=this.p;if(null!=p){if(p.zero(),C.sizeVec3==C.stackVec3.length){let t=new Array(C.sizeVec3<<1),i=0,s=C.sizeVec3;for(;i<s;){let s=i++;t[s]=C.stackVec3[s],C.stackVec3[s]=null}C.stackVec3=t}C.stackVec3[C.sizeVec3++]=p}let j=this.p;if(null!=y){if(y.zero(),j.sizeVec3==j.stackVec3.length){let t=new Array(j.sizeVec3<<1),i=0,s=j.sizeVec3;for(;i<s;){let s=i++;t[s]=j.stackVec3[s],j.stackVec3[s]=null}j.stackVec3=t}j.stackVec3[j.sizeVec3++]=y}let R=this.p;if(null!=Y){if(Y.zero(),R.sizeVec3==R.stackVec3.length){let t=new Array(R.sizeVec3<<1),i=0,s=R.sizeVec3;for(;i<s;){let s=i++;t[s]=R.stackVec3[s],R.stackVec3[s]=null}R.stackVec3=t}R.stackVec3[R.sizeVec3++]=Y}let E=this.p;if(null!=I){if(I.zero(),E.sizeVec3==E.stackVec3.length){let t=new Array(E.sizeVec3<<1),i=0,s=E.sizeVec3;for(;i<s;){let s=i++;t[s]=E.stackVec3[s],E.stackVec3[s]=null}E.stackVec3=t}E.stackVec3[E.sizeVec3++]=I}let q=this.p;if(null!=w){if(w.zero(),q.sizeVec3==q.stackVec3.length){let t=new Array(q.sizeVec3<<1),i=0,s=q.sizeVec3;for(;i<s;){let s=i++;t[s]=q.stackVec3[s],q.stackVec3[s]=null}q.stackVec3=t}q.stackVec3[q.sizeVec3++]=w}let N=this.p;if(null!=P){if(P.zero(),N.sizeVec3==N.stackVec3.length){let t=new Array(N.sizeVec3<<1),i=0,s=N.sizeVec3;for(;i<s;){let s=i++;t[s]=N.stackVec3[s],N.stackVec3[s]=null}N.stackVec3=t}N.stackVec3[N.sizeVec3++]=P}}else{let t=0;for(;t<8;){let s=t++,o=this.tmpCircleNorms[s],n=this.circleCoords[s];o.x=n.x,o.y=n.y,o.z=n.z;let e=o.x*p.e10+o.y*p.e11+o.z*p.e12,r=o.x*p.e20+o.y*p.e21+o.z*p.e22;o.x=o.x*p.e00+o.y*p.e01+o.z*p.e02,o.y=e,o.z=r;let l=this.tmpCircleVerts1[s],h=this.tmpCircleNorms[s];l.x=h.x,l.y=h.y,l.z=h.z,l.x*=i,l.y*=i,l.z*=i,l.x+=m.x,l.y+=m.y,l.z+=m.z;let c=this.tmpCircleVerts2[s],b=this.tmpCircleVerts1[s];c.x=b.x,c.y=b.y,c.z=b.z;let x=this.tmpCircleVerts1[s];x.x+=_.x*a,x.y+=_.y*a,x.z+=_.z*a;let f=this.tmpCircleVerts2[s],u=-a;f.x+=_.x*u,f.y+=_.y*u,f.z+=_.z*u}let n=0;for(;n<8;){let t,i=n++,a=this.tmpCircleVerts1[i],e=this.tmpCircleVerts1[(i+1)%8],r=_;this.triangle(v,a,e,r,r,r,o),a=this.tmpCircleVerts2[(i+1)%8],e=this.tmpCircleVerts2[i];let l=this.p,h=0==l.sizeVec3?new s.common.Vec3:l.stackVec3[--l.sizeVec3];h.x=_.x,h.y=_.y,h.z=_.z;let c=h;c.x=-c.x,c.y=-c.y,c.z=-c.z,this.triangle(X,a,e,c,c,c,o);let m=this.p;if(null!=c){if(c.zero(),m.sizeVec3==m.stackVec3.length){let t=new Array(m.sizeVec3<<1),i=0,s=m.sizeVec3;for(;i<s;){let s=i++;t[s]=m.stackVec3[s],m.stackVec3[s]=null}m.stackVec3=t}m.stackVec3[m.sizeVec3++]=c}t=this.tmpCircleVerts1[i],a=this.tmpCircleVerts2[i],e=this.tmpCircleVerts2[(i+1)%8],r=this.tmpCircleNorms[i];let b=this.tmpCircleNorms[(i+1)%8];this.rect(t,a,e,this.tmpCircleVerts1[(i+1)%8],r,r,b,b,o)}}let z=this.p;if(null!=v){if(v.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,s=z.sizeVec3;for(;i<s;){let s=i++;t[s]=z.stackVec3[s],z.stackVec3[s]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=v}let Z=this.p;if(null!=X){if(X.zero(),Z.sizeVec3==Z.stackVec3.length){let t=new Array(Z.sizeVec3<<1),i=0,s=Z.sizeVec3;for(;i<s;){let s=i++;t[s]=Z.stackVec3[s],Z.stackVec3[s]=null}Z.stackVec3=t}Z.stackVec3[Z.sizeVec3++]=X}let M=this.p;if(null!=m){if(m.zero(),M.sizeVec3==M.stackVec3.length){let t=new Array(M.sizeVec3<<1),i=0,s=M.sizeVec3;for(;i<s;){let s=i++;t[s]=M.stackVec3[s],M.stackVec3[s]=null}M.stackVec3=t}M.stackVec3[M.sizeVec3++]=m}let I=this.p;if(null!=p){if(p.e00=1,p.e01=0,p.e02=0,p.e10=0,p.e11=1,p.e12=0,p.e20=0,p.e21=0,p.e22=1,I.sizeMat3==I.stackMat3.length){let t=new Array(I.sizeMat3<<1),i=0,s=I.sizeMat3;for(;i<s;){let s=i++;t[s]=I.stackMat3[s],I.stackMat3[s]=null}I.stackMat3=t}I.stackMat3[I.sizeMat3++]=p}let V=this.p;if(null!=e){if(e.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,s=V.sizeVec3;for(;i<s;){let s=i++;t[s]=V.stackVec3[s],V.stackVec3[s]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=e}let L=this.p;if(null!=_){if(_.zero(),L.sizeVec3==L.stackVec3.length){let t=new Array(L.sizeVec3<<1),i=0,s=L.sizeVec3;for(;i<s;){let s=i++;t[s]=L.stackVec3[s],L.stackVec3[s]=null}L.stackVec3=t}L.stackVec3[L.sizeVec3++]=_}let w=this.p;if(null!=h){if(h.zero(),w.sizeVec3==w.stackVec3.length){let t=new Array(w.sizeVec3<<1),i=0,s=w.sizeVec3;for(;i<s;){let s=i++;t[s]=w.stackVec3[s],w.stackVec3[s]=null}w.stackVec3=t}w.stackVec3[w.sizeVec3++]=h}}capsule(t,i,a,o){let n=this.p,e=0==n.sizeVec3?new s.common.Vec3:n.stackVec3[--n.sizeVec3],r=this.p,_=0==r.sizeVec3?new s.common.Vec3:r.stackVec3[--r.sizeVec3],l=this.p,h=0==l.sizeVec3?new s.common.Vec3:l.stackVec3[--l.sizeVec3],c=this.p,m=0==c.sizeVec3?new s.common.Vec3:c.stackVec3[--c.sizeVec3],b=this.p,p=0==b.sizeMat3?new s.common.Mat3:b.stackMat3[--b.sizeMat3],x=m;x.x=t._positionX,x.y=t._positionY,x.z=t._positionZ;let f=p;f.e00=t._rotation00,f.e01=t._rotation01,f.e02=t._rotation02,f.e10=t._rotation10,f.e11=t._rotation11,f.e12=t._rotation12,f.e20=t._rotation20,f.e21=t._rotation21,f.e22=t._rotation22,e.init(p.e00,p.e10,p.e20),_.init(p.e01,p.e11,p.e21),h.init(p.e02,p.e12,p.e22);let u=this.tmpSphereVerts,y=this.tmpSphereNorms,v=0;for(;v<5;){let t=v++,i=this.tmpSphereVerts[t].length,s=0;for(;s<i;){let i=s++,a=y[t][i],o=this.sphereCoords[t][i];a.x=o.x,a.y=o.y,a.z=o.z;let n=a.x*p.e10+a.y*p.e11+a.z*p.e12,e=a.x*p.e20+a.y*p.e21+a.z*p.e22;a.x=a.x*p.e00+a.y*p.e01+a.z*p.e02,a.y=n,a.z=e}}let d=0;for(;d<4;){let t=d++;if(0==t){let t=0;for(;t<3;){let s=t++,o=this.tmpSphereVerts[s].length,n=0;for(;n<o;){let t=n++,o=u[s][t],e=y[s][t];o.x=e.x,o.y=e.y,o.z=e.z,o.x*=i,o.y*=i,o.z*=i,o.x+=m.x,o.y+=m.y,o.z+=m.z,o.x+=_.x*a,o.y+=_.y*a,o.z+=_.z*a}}}if(2==t){let t=2;for(;t<5;){let s=t++,o=this.tmpSphereVerts[s].length,n=0;for(;n<o;){let t=n++,o=u[s][t],e=y[s][t];o.x=e.x,o.y=e.y,o.z=e.z,o.x*=i,o.y*=i,o.z*=i,o.x+=m.x,o.y+=m.y,o.z+=m.z;let r=-a;o.x+=_.x*r,o.y+=_.y*r,o.z+=_.z*r}}}let s=0;for(;s<8;){let i,a,n,e,r,_,l,h,c=s++;0==t?this.wireframe?(i=u[0][0],a=u[1][c],this.line(i,a,o)):(i=u[0][0],a=u[1][c],n=u[1][(c+1)%8],r=y[0][0],_=y[1][c],l=y[1][(c+1)%8],this.triangle(i,a,n,r,_,l,o)):3==t?this.wireframe?(i=u[4][0],a=u[t][(c+1)%8],n=u[t][c],this.line(i,a,o),this.line(a,n,o)):(i=u[4][0],a=u[t][(c+1)%8],n=u[t][c],r=y[4][0],_=y[t][(c+1)%8],l=y[t][c],this.triangle(i,a,n,r,_,l,o)):this.wireframe?(i=u[t][c],a=u[t][(c+1)%8],n=u[t+1][c],this.line(i,a,o),this.line(i,n,o)):(i=u[t][c],a=u[t][(c+1)%8],n=u[t+1][c],e=u[t+1][(c+1)%8],r=y[t][c],_=y[t][(c+1)%8],l=y[t+1][c],h=y[t+1][(c+1)%8],this.rect(i,n,e,a,r,l,h,_,o))}}let g=this.p,X=0==g.sizeVec3?new s.common.Vec3:g.stackVec3[--g.sizeVec3];X.x=m.x,X.y=m.y,X.z=m.z;let Y=X;Y.x+=_.x*a,Y.y+=_.y*a,Y.z+=_.z*a;let z=this.p,Z=0==z.sizeVec3?new s.common.Vec3:z.stackVec3[--z.sizeVec3];Z.x=m.x,Z.y=m.y,Z.z=m.z;let M=Z,I=-a;if(M.x+=_.x*I,M.y+=_.y*I,M.z+=_.z*I,this.wireframe){let t=this.p,a=0==t.sizeVec3?new s.common.Vec3:t.stackVec3[--t.sizeVec3];a.x=Y.x,a.y=Y.y,a.z=Y.z;let n=a,r=-i;n.x+=e.x*r,n.y+=e.y*r,n.z+=e.z*r,n.x+=0*h.x,n.y+=0*h.y,n.z+=0*h.z;let _=this.p,l=0==_.sizeVec3?new s.common.Vec3:_.stackVec3[--_.sizeVec3];l.x=Y.x,l.y=Y.y,l.z=Y.z;let c=l;c.x+=e.x*i,c.y+=e.y*i,c.z+=e.z*i,c.x+=0*h.x,c.y+=0*h.y,c.z+=0*h.z;let m=this.p,b=0==m.sizeVec3?new s.common.Vec3:m.stackVec3[--m.sizeVec3];b.x=Y.x,b.y=Y.y,b.z=Y.z;let p=b;p.x+=0*e.x,p.y+=0*e.y,p.z+=0*e.z;let x=-i;p.x+=h.x*x,p.y+=h.y*x,p.z+=h.z*x;let f=this.p,u=0==f.sizeVec3?new s.common.Vec3:f.stackVec3[--f.sizeVec3];u.x=Y.x,u.y=Y.y,u.z=Y.z;let y=u;y.x+=0*e.x,y.y+=0*e.y,y.z+=0*e.z,y.x+=h.x*i,y.y+=h.y*i,y.z+=h.z*i;let v=this.p,d=0==v.sizeVec3?new s.common.Vec3:v.stackVec3[--v.sizeVec3];d.x=M.x,d.y=M.y,d.z=M.z;let g=d,X=-i;g.x+=e.x*X,g.y+=e.y*X,g.z+=e.z*X,g.x+=0*h.x,g.y+=0*h.y,g.z+=0*h.z;let z=this.p,Z=0==z.sizeVec3?new s.common.Vec3:z.stackVec3[--z.sizeVec3];Z.x=M.x,Z.y=M.y,Z.z=M.z;let I=Z;I.x+=e.x*i,I.y+=e.y*i,I.z+=e.z*i,I.x+=0*h.x,I.y+=0*h.y,I.z+=0*h.z;let V=this.p,L=0==V.sizeVec3?new s.common.Vec3:V.stackVec3[--V.sizeVec3];L.x=M.x,L.y=M.y,L.z=M.z;let w=L;w.x+=0*e.x,w.y+=0*e.y,w.z+=0*e.z;let k=-i;w.x+=h.x*k,w.y+=h.y*k,w.z+=h.z*k;let A=this.p,B=0==A.sizeVec3?new s.common.Vec3:A.stackVec3[--A.sizeVec3];B.x=M.x,B.y=M.y,B.z=M.z;let P=B;P.x+=0*e.x,P.y+=0*e.y,P.z+=0*e.z,P.x+=h.x*i,P.y+=h.y*i,P.z+=h.z*i,this.ellipse(Y,e,h,i,i,o),this.ellipse(M,e,h,i,i,o),this.line(n,g,o),this.line(c,I,o),this.line(p,w,o),this.line(y,P,o);let S=this.p;if(null!=n){if(n.zero(),S.sizeVec3==S.stackVec3.length){let t=new Array(S.sizeVec3<<1),i=0,s=S.sizeVec3;for(;i<s;){let s=i++;t[s]=S.stackVec3[s],S.stackVec3[s]=null}S.stackVec3=t}S.stackVec3[S.sizeVec3++]=n}let T=this.p;if(null!=c){if(c.zero(),T.sizeVec3==T.stackVec3.length){let t=new Array(T.sizeVec3<<1),i=0,s=T.sizeVec3;for(;i<s;){let s=i++;t[s]=T.stackVec3[s],T.stackVec3[s]=null}T.stackVec3=t}T.stackVec3[T.sizeVec3++]=c}let C=this.p;if(null!=p){if(p.zero(),C.sizeVec3==C.stackVec3.length){let t=new Array(C.sizeVec3<<1),i=0,s=C.sizeVec3;for(;i<s;){let s=i++;t[s]=C.stackVec3[s],C.stackVec3[s]=null}C.stackVec3=t}C.stackVec3[C.sizeVec3++]=p}let j=this.p;if(null!=y){if(y.zero(),j.sizeVec3==j.stackVec3.length){let t=new Array(j.sizeVec3<<1),i=0,s=j.sizeVec3;for(;i<s;){let s=i++;t[s]=j.stackVec3[s],j.stackVec3[s]=null}j.stackVec3=t}j.stackVec3[j.sizeVec3++]=y}let R=this.p;if(null!=g){if(g.zero(),R.sizeVec3==R.stackVec3.length){let t=new Array(R.sizeVec3<<1),i=0,s=R.sizeVec3;for(;i<s;){let s=i++;t[s]=R.stackVec3[s],R.stackVec3[s]=null}R.stackVec3=t}R.stackVec3[R.sizeVec3++]=g}let E=this.p;if(null!=I){if(I.zero(),E.sizeVec3==E.stackVec3.length){let t=new Array(E.sizeVec3<<1),i=0,s=E.sizeVec3;for(;i<s;){let s=i++;t[s]=E.stackVec3[s],E.stackVec3[s]=null}E.stackVec3=t}E.stackVec3[E.sizeVec3++]=I}let q=this.p;if(null!=w){if(w.zero(),q.sizeVec3==q.stackVec3.length){let t=new Array(q.sizeVec3<<1),i=0,s=q.sizeVec3;for(;i<s;){let s=i++;t[s]=q.stackVec3[s],q.stackVec3[s]=null}q.stackVec3=t}q.stackVec3[q.sizeVec3++]=w}let N=this.p;if(null!=P){if(P.zero(),N.sizeVec3==N.stackVec3.length){let t=new Array(N.sizeVec3<<1),i=0,s=N.sizeVec3;for(;i<s;){let s=i++;t[s]=N.stackVec3[s],N.stackVec3[s]=null}N.stackVec3=t}N.stackVec3[N.sizeVec3++]=P}}else{let t=0;for(;t<8;){let s=t++,o=this.tmpCircleNorms[s],n=this.circleCoords[s];o.x=n.x,o.y=n.y,o.z=n.z;let e=o.x*p.e10+o.y*p.e11+o.z*p.e12,r=o.x*p.e20+o.y*p.e21+o.z*p.e22;o.x=o.x*p.e00+o.y*p.e01+o.z*p.e02,o.y=e,o.z=r;let l=this.tmpCircleVerts1[s],h=this.tmpCircleNorms[s];l.x=h.x,l.y=h.y,l.z=h.z,l.x*=i,l.y*=i,l.z*=i,l.x+=m.x,l.y+=m.y,l.z+=m.z;let c=this.tmpCircleVerts2[s],b=this.tmpCircleVerts1[s];c.x=b.x,c.y=b.y,c.z=b.z;let x=this.tmpCircleVerts1[s];x.x+=_.x*a,x.y+=_.y*a,x.z+=_.z*a;let f=this.tmpCircleVerts2[s],u=-a;f.x+=_.x*u,f.y+=_.y*u,f.z+=_.z*u}let s=0;for(;s<8;){let t=s++,i=this.tmpCircleNorms[t],a=this.tmpCircleNorms[(t+1)%8];this.rect(this.tmpCircleVerts1[t],this.tmpCircleVerts2[t],this.tmpCircleVerts2[(t+1)%8],this.tmpCircleVerts1[(t+1)%8],i,i,a,a,o)}}let V=this.p;if(null!=Y){if(Y.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,s=V.sizeVec3;for(;i<s;){let s=i++;t[s]=V.stackVec3[s],V.stackVec3[s]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=Y}let L=this.p;if(null!=M){if(M.zero(),L.sizeVec3==L.stackVec3.length){let t=new Array(L.sizeVec3<<1),i=0,s=L.sizeVec3;for(;i<s;){let s=i++;t[s]=L.stackVec3[s],L.stackVec3[s]=null}L.stackVec3=t}L.stackVec3[L.sizeVec3++]=M}let w=this.p;if(null!=m){if(m.zero(),w.sizeVec3==w.stackVec3.length){let t=new Array(w.sizeVec3<<1),i=0,s=w.sizeVec3;for(;i<s;){let s=i++;t[s]=w.stackVec3[s],w.stackVec3[s]=null}w.stackVec3=t}w.stackVec3[w.sizeVec3++]=m}let k=this.p;if(null!=p){if(p.e00=1,p.e01=0,p.e02=0,p.e10=0,p.e11=1,p.e12=0,p.e20=0,p.e21=0,p.e22=1,k.sizeMat3==k.stackMat3.length){let t=new Array(k.sizeMat3<<1),i=0,s=k.sizeMat3;for(;i<s;){let s=i++;t[s]=k.stackMat3[s],k.stackMat3[s]=null}k.stackMat3=t}k.stackMat3[k.sizeMat3++]=p}let A=this.p;if(null!=e){if(e.zero(),A.sizeVec3==A.stackVec3.length){let t=new Array(A.sizeVec3<<1),i=0,s=A.sizeVec3;for(;i<s;){let s=i++;t[s]=A.stackVec3[s],A.stackVec3[s]=null}A.stackVec3=t}A.stackVec3[A.sizeVec3++]=e}let B=this.p;if(null!=_){if(_.zero(),B.sizeVec3==B.stackVec3.length){let t=new Array(B.sizeVec3<<1),i=0,s=B.sizeVec3;for(;i<s;){let s=i++;t[s]=B.stackVec3[s],B.stackVec3[s]=null}B.stackVec3=t}B.stackVec3[B.sizeVec3++]=_}let P=this.p;if(null!=h){if(h.zero(),P.sizeVec3==P.stackVec3.length){let t=new Array(P.sizeVec3<<1),i=0,s=P.sizeVec3;for(;i<s;){let s=i++;t[s]=P.stackVec3[s],P.stackVec3[s]=null}P.stackVec3=t}P.stackVec3[P.sizeVec3++]=h}}sphere(t,i,a){let o=this.p,n=0==o.sizeVec3?new s.common.Vec3:o.stackVec3[--o.sizeVec3],e=this.p,r=0==e.sizeMat3?new s.common.Mat3:e.stackMat3[--e.sizeMat3],_=n;_.x=t._positionX,_.y=t._positionY,_.z=t._positionZ;let l=r;l.e00=t._rotation00,l.e01=t._rotation01,l.e02=t._rotation02,l.e10=t._rotation10,l.e11=t._rotation11,l.e12=t._rotation12,l.e20=t._rotation20,l.e21=t._rotation21,l.e22=t._rotation22;let h=this.tmpSphereVerts,c=this.tmpSphereNorms,m=0;for(;m<5;){let t=m++,s=this.tmpSphereVerts[t].length,a=0;for(;a<s;){let s=a++,o=c[t][s],e=this.sphereCoords[t][s];o.x=e.x,o.y=e.y,o.z=e.z;let _=o.x*r.e10+o.y*r.e11+o.z*r.e12,l=o.x*r.e20+o.y*r.e21+o.z*r.e22;o.x=o.x*r.e00+o.y*r.e01+o.z*r.e02,o.y=_,o.z=l;let m=h[t][s],b=c[t][s];m.x=b.x,m.y=b.y,m.z=b.z,m.x*=i,m.y*=i,m.z*=i,m.x+=n.x,m.y+=n.y,m.z+=n.z}}let b=0;for(;b<4;){let t=b++,i=0;for(;i<8;){let s,o,n,e,r,_,l,m,b=i++;0==t?this.wireframe?(s=h[0][0],o=h[1][b],this.line(s,o,a)):(s=h[0][0],o=h[1][b],n=h[1][(b+1)%8],r=c[0][0],_=c[1][b],l=c[1][(b+1)%8],this.triangle(s,o,n,r,_,l,a)):3==t?this.wireframe?(s=h[4][0],o=h[t][(b+1)%8],n=h[t][b],this.line(s,o,a),this.line(o,n,a)):(s=h[4][0],o=h[t][(b+1)%8],n=h[t][b],r=c[4][0],_=c[t][(b+1)%8],l=c[t][b],this.triangle(s,o,n,r,_,l,a)):this.wireframe?(s=h[t][b],o=h[t][(b+1)%8],n=h[t+1][b],this.line(s,o,a),this.line(s,n,a)):(s=h[t][b],o=h[t][(b+1)%8],n=h[t+1][b],e=h[t+1][(b+1)%8],r=c[t][b],_=c[t][(b+1)%8],l=c[t+1][b],m=c[t+1][(b+1)%8],this.rect(s,n,e,o,r,l,m,_,a))}}let p=this.p;if(null!=n){if(n.zero(),p.sizeVec3==p.stackVec3.length){let t=new Array(p.sizeVec3<<1),i=0,s=p.sizeVec3;for(;i<s;){let s=i++;t[s]=p.stackVec3[s],p.stackVec3[s]=null}p.stackVec3=t}p.stackVec3[p.sizeVec3++]=n}let x=this.p;if(null!=r){if(r.e00=1,r.e01=0,r.e02=0,r.e10=0,r.e11=1,r.e12=0,r.e20=0,r.e21=0,r.e22=1,x.sizeMat3==x.stackMat3.length){let t=new Array(x.sizeMat3<<1),i=0,s=x.sizeMat3;for(;i<s;){let s=i++;t[s]=x.stackMat3[s],x.stackMat3[s]=null}x.stackMat3=t}x.stackMat3[x.sizeMat3++]=r}}box(t,i,a){let o=this.p,n=0==o.sizeVec3?new s.common.Vec3:o.stackVec3[--o.sizeVec3],e=this.p,r=0==e.sizeVec3?new s.common.Vec3:e.stackVec3[--e.sizeVec3],_=this.p,l=0==_.sizeVec3?new s.common.Vec3:_.stackVec3[--_.sizeVec3],h=this.p,c=0==h.sizeVec3?new s.common.Vec3:h.stackVec3[--h.sizeVec3],m=this.p,b=0==m.sizeMat3?new s.common.Mat3:m.stackMat3[--m.sizeMat3],p=c;p.x=t._positionX,p.y=t._positionY,p.z=t._positionZ;let x=b;x.e00=t._rotation00,x.e01=t._rotation01,x.e02=t._rotation02,x.e10=t._rotation10,x.e11=t._rotation11,x.e12=t._rotation12,x.e20=t._rotation20,x.e21=t._rotation21,x.e22=t._rotation22,n.init(b.e00,b.e10,b.e20),r.init(b.e01,b.e11,b.e21),l.init(b.e02,b.e12,b.e22);let f=i.x,u=i.y,y=i.z,v=this.p,d=0==v.sizeVec3?new s.common.Vec3:v.stackVec3[--v.sizeVec3];d.x=c.x,d.y=c.y,d.z=c.z;let g=d,X=-f;g.x+=n.x*X,g.y+=n.y*X,g.z+=n.z*X;let Y=-u;g.x+=r.x*Y,g.y+=r.y*Y,g.z+=r.z*Y;let z=-y;g.x+=l.x*z,g.y+=l.y*z,g.z+=l.z*z;let Z=this.p,M=0==Z.sizeVec3?new s.common.Vec3:Z.stackVec3[--Z.sizeVec3];M.x=c.x,M.y=c.y,M.z=c.z;let I=M,V=-f;I.x+=n.x*V,I.y+=n.y*V,I.z+=n.z*V;let L=-u;I.x+=r.x*L,I.y+=r.y*L,I.z+=r.z*L,I.x+=l.x*y,I.y+=l.y*y,I.z+=l.z*y;let w=this.p,k=0==w.sizeVec3?new s.common.Vec3:w.stackVec3[--w.sizeVec3];k.x=c.x,k.y=c.y,k.z=c.z;let A=k,B=-f;A.x+=n.x*B,A.y+=n.y*B,A.z+=n.z*B,A.x+=r.x*u,A.y+=r.y*u,A.z+=r.z*u;let P=-y;A.x+=l.x*P,A.y+=l.y*P,A.z+=l.z*P;let S=this.p,T=0==S.sizeVec3?new s.common.Vec3:S.stackVec3[--S.sizeVec3];T.x=c.x,T.y=c.y,T.z=c.z;let C=T,j=-f;C.x+=n.x*j,C.y+=n.y*j,C.z+=n.z*j,C.x+=r.x*u,C.y+=r.y*u,C.z+=r.z*u,C.x+=l.x*y,C.y+=l.y*y,C.z+=l.z*y;let R=this.p,E=0==R.sizeVec3?new s.common.Vec3:R.stackVec3[--R.sizeVec3];E.x=c.x,E.y=c.y,E.z=c.z;let q=E;q.x+=n.x*f,q.y+=n.y*f,q.z+=n.z*f;let N=-u;q.x+=r.x*N,q.y+=r.y*N,q.z+=r.z*N;let D=-y;q.x+=l.x*D,q.y+=l.y*D,q.z+=l.z*D;let F=this.p,H=0==F.sizeVec3?new s.common.Vec3:F.stackVec3[--F.sizeVec3];H.x=c.x,H.y=c.y,H.z=c.z;let G=H;G.x+=n.x*f,G.y+=n.y*f,G.z+=n.z*f;let W=-u;G.x+=r.x*W,G.y+=r.y*W,G.z+=r.z*W,G.x+=l.x*y,G.y+=l.y*y,G.z+=l.z*y;let O=this.p,J=0==O.sizeVec3?new s.common.Vec3:O.stackVec3[--O.sizeVec3];J.x=c.x,J.y=c.y,J.z=c.z;let U=J;U.x+=n.x*f,U.y+=n.y*f,U.z+=n.z*f,U.x+=r.x*u,U.y+=r.y*u,U.z+=r.z*u;let Q=-y;U.x+=l.x*Q,U.y+=l.y*Q,U.z+=l.z*Q;let K=this.p,$=0==K.sizeVec3?new s.common.Vec3:K.stackVec3[--K.sizeVec3];$.x=c.x,$.y=c.y,$.z=c.z;let tt=$;if(tt.x+=n.x*f,tt.y+=n.y*f,tt.z+=n.z*f,tt.x+=r.x*u,tt.y+=r.y*u,tt.z+=r.z*u,tt.x+=l.x*y,tt.y+=l.y*y,tt.z+=l.z*y,this.wireframe)this.line(g,I,a),this.line(A,C,a),this.line(q,G,a),this.line(U,tt,a),this.line(g,A,a),this.line(I,C,a),this.line(q,U,a),this.line(G,tt,a),this.line(g,q,a),this.line(I,G,a),this.line(A,U,a),this.line(C,tt,a);else{let t=this.p,i=0==t.sizeVec3?new s.common.Vec3:t.stackVec3[--t.sizeVec3];i.x=n.x,i.y=n.y,i.z=n.z;let o=i;o.x=-o.x,o.y=-o.y,o.z=-o.z;let e=this.p,_=0==e.sizeVec3?new s.common.Vec3:e.stackVec3[--e.sizeVec3];_.x=r.x,_.y=r.y,_.z=r.z;let h=_;h.x=-h.x,h.y=-h.y,h.z=-h.z;let c=this.p,m=0==c.sizeVec3?new s.common.Vec3:c.stackVec3[--c.sizeVec3];m.x=l.x,m.y=l.y,m.z=l.z;let b=m;b.x=-b.x,b.y=-b.y,b.z=-b.z,this.rect(g,I,C,A,o,o,o,o,a),this.rect(q,U,tt,G,n,n,n,n,a),this.rect(g,q,G,I,h,h,h,h,a),this.rect(A,C,tt,U,r,r,r,r,a),this.rect(g,A,U,q,b,b,b,b,a),this.rect(I,G,tt,C,l,l,l,l,a);let p=this.p;if(null!=o){if(o.zero(),p.sizeVec3==p.stackVec3.length){let t=new Array(p.sizeVec3<<1),i=0,s=p.sizeVec3;for(;i<s;){let s=i++;t[s]=p.stackVec3[s],p.stackVec3[s]=null}p.stackVec3=t}p.stackVec3[p.sizeVec3++]=o}let x=this.p;if(null!=h){if(h.zero(),x.sizeVec3==x.stackVec3.length){let t=new Array(x.sizeVec3<<1),i=0,s=x.sizeVec3;for(;i<s;){let s=i++;t[s]=x.stackVec3[s],x.stackVec3[s]=null}x.stackVec3=t}x.stackVec3[x.sizeVec3++]=h}let f=this.p;if(null!=b){if(b.zero(),f.sizeVec3==f.stackVec3.length){let t=new Array(f.sizeVec3<<1),i=0,s=f.sizeVec3;for(;i<s;){let s=i++;t[s]=f.stackVec3[s],f.stackVec3[s]=null}f.stackVec3=t}f.stackVec3[f.sizeVec3++]=b}}let it=this.p;if(null!=g){if(g.zero(),it.sizeVec3==it.stackVec3.length){let t=new Array(it.sizeVec3<<1),i=0,s=it.sizeVec3;for(;i<s;){let s=i++;t[s]=it.stackVec3[s],it.stackVec3[s]=null}it.stackVec3=t}it.stackVec3[it.sizeVec3++]=g}let st=this.p;if(null!=I){if(I.zero(),st.sizeVec3==st.stackVec3.length){let t=new Array(st.sizeVec3<<1),i=0,s=st.sizeVec3;for(;i<s;){let s=i++;t[s]=st.stackVec3[s],st.stackVec3[s]=null}st.stackVec3=t}st.stackVec3[st.sizeVec3++]=I}let at=this.p;if(null!=A){if(A.zero(),at.sizeVec3==at.stackVec3.length){let t=new Array(at.sizeVec3<<1),i=0,s=at.sizeVec3;for(;i<s;){let s=i++;t[s]=at.stackVec3[s],at.stackVec3[s]=null}at.stackVec3=t}at.stackVec3[at.sizeVec3++]=A}let ot=this.p;if(null!=C){if(C.zero(),ot.sizeVec3==ot.stackVec3.length){let t=new Array(ot.sizeVec3<<1),i=0,s=ot.sizeVec3;for(;i<s;){let s=i++;t[s]=ot.stackVec3[s],ot.stackVec3[s]=null}ot.stackVec3=t}ot.stackVec3[ot.sizeVec3++]=C}let nt=this.p;if(null!=q){if(q.zero(),nt.sizeVec3==nt.stackVec3.length){let t=new Array(nt.sizeVec3<<1),i=0,s=nt.sizeVec3;for(;i<s;){let s=i++;t[s]=nt.stackVec3[s],nt.stackVec3[s]=null}nt.stackVec3=t}nt.stackVec3[nt.sizeVec3++]=q}let et=this.p;if(null!=G){if(G.zero(),et.sizeVec3==et.stackVec3.length){let t=new Array(et.sizeVec3<<1),i=0,s=et.sizeVec3;for(;i<s;){let s=i++;t[s]=et.stackVec3[s],et.stackVec3[s]=null}et.stackVec3=t}et.stackVec3[et.sizeVec3++]=G}let rt=this.p;if(null!=U){if(U.zero(),rt.sizeVec3==rt.stackVec3.length){let t=new Array(rt.sizeVec3<<1),i=0,s=rt.sizeVec3;for(;i<s;){let s=i++;t[s]=rt.stackVec3[s],rt.stackVec3[s]=null}rt.stackVec3=t}rt.stackVec3[rt.sizeVec3++]=U}let _t=this.p;if(null!=tt){if(tt.zero(),_t.sizeVec3==_t.stackVec3.length){let t=new Array(_t.sizeVec3<<1),i=0,s=_t.sizeVec3;for(;i<s;){let s=i++;t[s]=_t.stackVec3[s],_t.stackVec3[s]=null}_t.stackVec3=t}_t.stackVec3[_t.sizeVec3++]=tt}let lt=this.p;if(null!=c){if(c.zero(),lt.sizeVec3==lt.stackVec3.length){let t=new Array(lt.sizeVec3<<1),i=0,s=lt.sizeVec3;for(;i<s;){let s=i++;t[s]=lt.stackVec3[s],lt.stackVec3[s]=null}lt.stackVec3=t}lt.stackVec3[lt.sizeVec3++]=c}let ht=this.p;if(null!=b){if(b.e00=1,b.e01=0,b.e02=0,b.e10=0,b.e11=1,b.e12=0,b.e20=0,b.e21=0,b.e22=1,ht.sizeMat3==ht.stackMat3.length){let t=new Array(ht.sizeMat3<<1),i=0,s=ht.sizeMat3;for(;i<s;){let s=i++;t[s]=ht.stackMat3[s],ht.stackMat3[s]=null}ht.stackMat3=t}ht.stackMat3[ht.sizeMat3++]=b}let ct=this.p;if(null!=n){if(n.zero(),ct.sizeVec3==ct.stackVec3.length){let t=new Array(ct.sizeVec3<<1),i=0,s=ct.sizeVec3;for(;i<s;){let s=i++;t[s]=ct.stackVec3[s],ct.stackVec3[s]=null}ct.stackVec3=t}ct.stackVec3[ct.sizeVec3++]=n}let mt=this.p;if(null!=r){if(r.zero(),mt.sizeVec3==mt.stackVec3.length){let t=new Array(mt.sizeVec3<<1),i=0,s=mt.sizeVec3;for(;i<s;){let s=i++;t[s]=mt.stackVec3[s],mt.stackVec3[s]=null}mt.stackVec3=t}mt.stackVec3[mt.sizeVec3++]=r}let bt=this.p;if(null!=l){if(l.zero(),bt.sizeVec3==bt.stackVec3.length){let t=new Array(bt.sizeVec3<<1),i=0,s=bt.sizeVec3;for(;i<s;){let s=i++;t[s]=bt.stackVec3[s],bt.stackVec3[s]=null}bt.stackVec3=t}bt.stackVec3[bt.sizeVec3++]=l}}rect(t,i,s,a,o,n,e,r,_){this.triangle(t,i,s,o,n,e,_),this.triangle(t,s,a,o,e,r,_)}point(t,i){}triangle(t,i,s,a,o,n,e){}line(t,i,s){}},s.dynamics.common.DebugDrawStyle=class{constructor(){this.basisColorZ=new s.common.Vec3(0,0,1),this.basisColorY=new s.common.Vec3(0,1,0),this.basisColorX=new s.common.Vec3(1,0,0),this.basisLength=.5,this.jointRotationalConstraintRadius=.3,this.jointErrorColor=new s.common.Vec3(1,.1,.1),this.jointLineColor=new s.common.Vec3(.8,.8,.8),this.contactBinormalLength=.5,this.contactTangentLength=.5,this.contactNormalLength=.5,this.contactBinormalColor=new s.common.Vec3(.2,.2,1),this.contactTangentColor=new s.common.Vec3(.1,.8,.1),this.contactNormalColor=new s.common.Vec3(1,.1,.1),this.disabledContactColor=new s.common.Vec3(.5,.1,.1),this.newContactColor=new s.common.Vec3(1,1,.1),this.contactColor4=new s.common.Vec3(.8,.1,1),this.contactColor3=new s.common.Vec3(.1,.8,.6),this.contactColor2=new s.common.Vec3(1,.6,.1),this.contactColor=new s.common.Vec3(1,.1,.1),this.pairColor=new s.common.Vec3(1,1,.1),this.bvhNodeColor=new s.common.Vec3(.4,.4,.4),this.aabbColor=new s.common.Vec3(1,.1,.1),this.kinematicShapeColor=new s.common.Vec3(1,.5,.1),this.staticShapeColor=new s.common.Vec3(.7,.7,.7),this.sleepingShapeColor2=new s.common.Vec3(.2,.8,.5),this.sleepingShapeColor1=new s.common.Vec3(.3,.3,.8),this.sleepyShapeColor2=new s.common.Vec3(.6,.8,.3),this.sleepyShapeColor1=new s.common.Vec3(.5,.25,.6),this.shapeColor2=new s.common.Vec3(1,.8,.1),this.shapeColor1=new s.common.Vec3(.7,.2,.4)}},s.dynamics.common.Performance=class{},s.dynamics.constraint||(s.dynamics.constraint={}),s.dynamics.constraint.ConstraintSolver=class{constructor(){this._b1=null,this._b2=null,this._addedToIsland=!1}preSolveVelocity(t){}warmStart(t){}solveVelocity(){}postSolveVelocity(t){}preSolvePosition(t){}solvePositionSplitImpulse(){}solvePositionNgs(t){}postSolve(){}},s.dynamics.constraint.PositionCorrectionAlgorithm=class{},s.dynamics.constraint.contact||(s.dynamics.constraint.contact={}),s.dynamics.constraint.contact.ContactConstraint=class{constructor(t){this._solver=new s.dynamics.constraint.solver.pgs.PgsContactConstraintSolver(this),this._manifold=t}_getVelocitySolverInfo(t,i){let a,o,n,e,r,_,l,h,c;i.b1=this._b1,i.b2=this._b2,a=this._manifold._normalX,o=this._manifold._normalY,n=this._manifold._normalZ,e=this._manifold._tangentX,r=this._manifold._tangentY,_=this._manifold._tangentZ,l=this._manifold._binormalX,h=this._manifold._binormalY,c=this._manifold._binormalZ;let m=Math.sqrt(this._s1._friction*this._s2._friction),b=Math.sqrt(this._s1._restitution*this._s2._restitution),p=this._manifold._numPoints;i.numRows=0;let x=0;for(;x<p;){let p=this._manifold._points[x++];if(p._depth<0){p._disabled=!0;let t=p._impulse;t.impulseN=0,t.impulseT=0,t.impulseB=0,t.impulseP=0,t.impulseLX=0,t.impulseLY=0,t.impulseLZ=0;continue}p._disabled=!1;let f=i.rows[i.numRows++];f.friction=m,f.cfm=0;let u=f.jacobianN;u.lin1X=a,u.lin1Y=o,u.lin1Z=n,u.lin2X=a,u.lin2Y=o,u.lin2Z=n,u.ang1X=p._relPos1Y*n-p._relPos1Z*o,u.ang1Y=p._relPos1Z*a-p._relPos1X*n,u.ang1Z=p._relPos1X*o-p._relPos1Y*a,u.ang2X=p._relPos2Y*n-p._relPos2Z*o,u.ang2Y=p._relPos2Z*a-p._relPos2X*n,u.ang2Z=p._relPos2X*o-p._relPos2Y*a,u=f.jacobianT,u.lin1X=e,u.lin1Y=r,u.lin1Z=_,u.lin2X=e,u.lin2Y=r,u.lin2Z=_,u.ang1X=p._relPos1Y*_-p._relPos1Z*r,u.ang1Y=p._relPos1Z*e-p._relPos1X*_,u.ang1Z=p._relPos1X*r-p._relPos1Y*e,u.ang2X=p._relPos2Y*_-p._relPos2Z*r,u.ang2Y=p._relPos2Z*e-p._relPos2X*_,u.ang2Z=p._relPos2X*r-p._relPos2Y*e,u=f.jacobianB,u.lin1X=l,u.lin1Y=h,u.lin1Z=c,u.lin2X=l,u.lin2Y=h,u.lin2Z=c,u.ang1X=p._relPos1Y*c-p._relPos1Z*h,u.ang1Y=p._relPos1Z*l-p._relPos1X*c,u.ang1Z=p._relPos1X*h-p._relPos1Y*l,u.ang2X=p._relPos2Y*c-p._relPos2Z*h,u.ang2Y=p._relPos2Z*l-p._relPos2X*c,u.ang2Z=p._relPos2X*h-p._relPos2Y*l,u=f.jacobianN;let y=u.lin1X*this._b1._velX+u.lin1Y*this._b1._velY+u.lin1Z*this._b1._velZ+(u.ang1X*this._b1._angVelX+u.ang1Y*this._b1._angVelY+u.ang1Z*this._b1._angVelZ)-(u.lin2X*this._b2._velX+u.lin2Y*this._b2._velY+u.lin2Z*this._b2._velZ+(u.ang2X*this._b2._angVelX+u.ang2Y*this._b2._angVelY+u.ang2Z*this._b2._angVelZ));if(y<-s.common.Setting.contactEnableBounceThreshold&&!p._warmStarted?f.rhs=-y*b:f.rhs=0,this._positionCorrectionAlgorithm==s.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE&&p._depth>s.common.Setting.linearSlop){let i=(p._depth-s.common.Setting.linearSlop)*s.common.Setting.velocityBaumgarte*t.invDt;f.rhs<i&&(f.rhs=i)}if(!p._warmStarted){let t=p._impulse;t.impulseN=0,t.impulseT=0,t.impulseB=0,t.impulseP=0,t.impulseLX=0,t.impulseLY=0,t.impulseLZ=0}f.impulse=p._impulse}}_getPositionSolverInfo(t){let i,a,o;t.b1=this._b1,t.b2=this._b2,i=this._manifold._normalX,a=this._manifold._normalY,o=this._manifold._normalZ;let n=this._manifold._numPoints;t.numRows=0;let e=0;for(;e<n;){let n=this._manifold._points[e++];if(n._disabled)continue;let r=t.rows[t.numRows++],_=r.jacobianN;_.lin1X=i,_.lin1Y=a,_.lin1Z=o,_.lin2X=i,_.lin2Y=a,_.lin2Z=o,_.ang1X=n._relPos1Y*o-n._relPos1Z*a,_.ang1Y=n._relPos1Z*i-n._relPos1X*o,_.ang1Z=n._relPos1X*a-n._relPos1Y*i,_.ang2X=n._relPos2Y*o-n._relPos2Z*a,_.ang2Y=n._relPos2Z*i-n._relPos2X*o,_.ang2Z=n._relPos2X*a-n._relPos2Y*i,r.rhs=n._depth-s.common.Setting.linearSlop,r.rhs<0&&(r.rhs=0),r.impulse=n._impulse}}_syncManifold(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)}getShape1(){return this._s1}getShape2(){return this._s2}getManifold(){return this._manifold}isTouching(){let t=0,i=this._manifold._numPoints;for(;t<i;)if(this._manifold._points[t++]._depth>=0)return!0;return!1}},s.dynamics.constraint.contact.ContactImpulse=class{constructor(){this.impulseN=0,this.impulseT=0,this.impulseB=0,this.impulseP=0,this.impulseLX=0,this.impulseLY=0,this.impulseLZ=0}copyFrom(t){this.impulseN=t.impulseN,this.impulseT=t.impulseT,this.impulseB=t.impulseB,this.impulseLX=t.impulseLX,this.impulseLY=t.impulseLY,this.impulseLZ=t.impulseLZ}},s.dynamics.constraint.contact.Manifold=class{constructor(){this._normalX=0,this._normalY=0,this._normalZ=0,this._tangentX=0,this._tangentY=0,this._tangentZ=0,this._binormalX=0,this._binormalY=0,this._binormalZ=0,this._numPoints=0,this._points=new Array(s.common.Setting.maxManifoldPoints);let t=0,i=s.common.Setting.maxManifoldPoints;for(;t<i;)this._points[t++]=new s.dynamics.constraint.contact.ManifoldPoint}_clear(){let t=0,i=this._numPoints;for(;t<i;){let i=this._points[t++];i._localPos1X=0,i._localPos1Y=0,i._localPos1Z=0,i._localPos2X=0,i._localPos2Y=0,i._localPos2Z=0,i._relPos1X=0,i._relPos1Y=0,i._relPos1Z=0,i._relPos2X=0,i._relPos2Y=0,i._relPos2Z=0,i._pos1X=0,i._pos1Y=0,i._pos1Z=0,i._pos2X=0,i._pos2Y=0,i._pos2Z=0,i._depth=0;let s=i._impulse;s.impulseN=0,s.impulseT=0,s.impulseB=0,s.impulseP=0,s.impulseLX=0,s.impulseLY=0,s.impulseLZ=0,i._warmStarted=!1,i._disabled=!1,i._id=-1}this._numPoints=0}_buildBasis(t){this._normalX=t.x,this._normalY=t.y,this._normalZ=t.z;let i,s,a,o,n,e,r=t.x,_=t.y,l=t.z,h=r*r,c=_*_,m=l*l;if(h<c)if(h<m){let t=1/Math.sqrt(c+m);i=0,s=-l*t,a=_*t,o=_*a-l*s,n=-r*a,e=r*s}else{let t=1/Math.sqrt(h+c);i=-_*t,s=r*t,a=0,o=-l*s,n=l*i,e=r*s-_*i}else if(c<m){let t=1/Math.sqrt(h+m);i=l*t,s=0,a=-r*t,o=_*a,n=l*i-r*a,e=-_*i}else{let t=1/Math.sqrt(h+c);i=-_*t,s=r*t,a=0,o=-l*s,n=l*i,e=r*s-_*i}this._tangentX=i,this._tangentY=s,this._tangentZ=a,this._binormalX=o,this._binormalY=n,this._binormalZ=e}_updateDepthsAndPositions(t,i){let s=0,a=this._numPoints;for(;s<a;){let a,o,n,e,r,_,l,h,c,m=this._points[s++];a=t._rotation00*m._localPos1X+t._rotation01*m._localPos1Y+t._rotation02*m._localPos1Z,o=t._rotation10*m._localPos1X+t._rotation11*m._localPos1Y+t._rotation12*m._localPos1Z,n=t._rotation20*m._localPos1X+t._rotation21*m._localPos1Y+t._rotation22*m._localPos1Z,m._relPos1X=a,m._relPos1Y=o,m._relPos1Z=n,e=i._rotation00*m._localPos2X+i._rotation01*m._localPos2Y+i._rotation02*m._localPos2Z,r=i._rotation10*m._localPos2X+i._rotation11*m._localPos2Y+i._rotation12*m._localPos2Z,_=i._rotation20*m._localPos2X+i._rotation21*m._localPos2Y+i._rotation22*m._localPos2Z,m._relPos2X=e,m._relPos2Y=r,m._relPos2Z=_,m._pos1X=m._relPos1X+t._positionX,m._pos1Y=m._relPos1Y+t._positionY,m._pos1Z=m._relPos1Z+t._positionZ,m._pos2X=m._relPos2X+i._positionX,m._pos2Y=m._relPos2Y+i._positionY,m._pos2Z=m._relPos2Z+i._positionZ,l=m._pos1X-m._pos2X,h=m._pos1Y-m._pos2Y,c=m._pos1Z-m._pos2Z,m._depth=-(l*this._normalX+h*this._normalY+c*this._normalZ)}}getNormal(){let t=new s.common.Vec3;return t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ,t}getNormalTo(t){t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ}getTangent(){let t=new s.common.Vec3;return t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ,t}getTangentTo(t){t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ}getBinormal(){let t=new s.common.Vec3;return t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ,t}getBinormalTo(t){t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ}getPoints(){return this._points}getNumPoints(){return this._numPoints}},s.dynamics.constraint.contact.ManifoldPoint=class{constructor(){this._localPos1X=0,this._localPos1Y=0,this._localPos1Z=0,this._localPos2X=0,this._localPos2Y=0,this._localPos2Z=0,this._relPos1X=0,this._relPos1Y=0,this._relPos1Z=0,this._relPos2X=0,this._relPos2Y=0,this._relPos2Z=0,this._pos1X=0,this._pos1Y=0,this._pos1Z=0,this._pos2X=0,this._pos2Y=0,this._pos2Z=0,this._depth=0,this._impulse=new s.dynamics.constraint.contact.ContactImpulse,this._warmStarted=!1,this._disabled=!1,this._id=-1}getPosition1(){let t=new s.common.Vec3;return t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z,t}getPosition1To(t){t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z}getPosition2(){let t=new s.common.Vec3;return t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z,t}getPosition2To(t){t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z}getDepth(){return this._depth}isWarmStarted(){return this._warmStarted}getNormalImpulse(){return this._impulse.impulseN}getTangentImpulse(){return this._impulse.impulseT}getBinormalImpulse(){return this._impulse.impulseB}isEnabled(){return!this._disabled}},s.dynamics.constraint.contact.ManifoldUpdater=class{constructor(t){this._manifold=t,this.numOldPoints=0,this.oldPoints=new Array(s.common.Setting.maxManifoldPoints);let i=0,a=s.common.Setting.maxManifoldPoints;for(;i<a;)this.oldPoints[i++]=new s.dynamics.constraint.contact.ManifoldPoint}removeOutdatedPoints(){let t=this._manifold._numPoints;for(;--t>=0;){let i,a,o,n=this._manifold._points[t];i=n._pos1X-n._pos2X,a=n._pos1Y-n._pos2Y,o=n._pos1Z-n._pos2Z;let e=this._manifold._normalX*i+this._manifold._normalY*a+this._manifold._normalZ*o;e>s.common.Setting.contactPersistenceThreshold?this.removeManifoldPoint(t):(i+=this._manifold._normalX*-e,a+=this._manifold._normalY*-e,o+=this._manifold._normalZ*-e,i*i+a*a+o*o>s.common.Setting.contactPersistenceThreshold*s.common.Setting.contactPersistenceThreshold&&this.removeManifoldPoint(t))}}removeManifoldPoint(t){let i=--this._manifold._numPoints;if(t!=i){let s=this._manifold._points[t];this._manifold._points[t]=this._manifold._points[i],this._manifold._points[i]=s}let s=this._manifold._points[i];s._localPos1X=0,s._localPos1Y=0,s._localPos1Z=0,s._localPos2X=0,s._localPos2Y=0,s._localPos2Z=0,s._relPos1X=0,s._relPos1Y=0,s._relPos1Z=0,s._relPos2X=0,s._relPos2Y=0,s._relPos2Z=0,s._pos1X=0,s._pos1Y=0,s._pos1Z=0,s._pos2X=0,s._pos2Y=0,s._pos2Z=0,s._depth=0;let a=s._impulse;a.impulseN=0,a.impulseT=0,a.impulseB=0,a.impulseP=0,a.impulseLX=0,a.impulseLY=0,a.impulseLZ=0,s._warmStarted=!1,s._disabled=!1,s._id=-1}addManifoldPoint(t,i,a){let o=this._manifold._numPoints;if(o==s.common.Setting.maxManifoldPoints){let s=this.computeTargetIndex(t,i,a),o=this._manifold._points[s],n=t.position1;o._pos1X=n.x,o._pos1Y=n.y,o._pos1Z=n.z;let e,r,_,l,h,c,m=t.position2;o._pos2X=m.x,o._pos2Y=m.y,o._pos2Z=m.z,o._relPos1X=o._pos1X-i._positionX,o._relPos1Y=o._pos1Y-i._positionY,o._relPos1Z=o._pos1Z-i._positionZ,o._relPos2X=o._pos2X-a._positionX,o._relPos2Y=o._pos2Y-a._positionY,o._relPos2Z=o._pos2Z-a._positionZ,e=i._rotation00*o._relPos1X+i._rotation10*o._relPos1Y+i._rotation20*o._relPos1Z,r=i._rotation01*o._relPos1X+i._rotation11*o._relPos1Y+i._rotation21*o._relPos1Z,_=i._rotation02*o._relPos1X+i._rotation12*o._relPos1Y+i._rotation22*o._relPos1Z,o._localPos1X=e,o._localPos1Y=r,o._localPos1Z=_,l=a._rotation00*o._relPos2X+a._rotation10*o._relPos2Y+a._rotation20*o._relPos2Z,h=a._rotation01*o._relPos2X+a._rotation11*o._relPos2Y+a._rotation21*o._relPos2Z,c=a._rotation02*o._relPos2X+a._rotation12*o._relPos2Y+a._rotation22*o._relPos2Z,o._localPos2X=l,o._localPos2Y=h,o._localPos2Z=c,o._depth=t.depth;let b=o._impulse;return b.impulseN=0,b.impulseT=0,b.impulseB=0,b.impulseP=0,b.impulseLX=0,b.impulseLY=0,b.impulseLZ=0,o._id=t.id,o._warmStarted=!1,void(o._disabled=!1)}let n=this._manifold._points[o],e=t.position1;n._pos1X=e.x,n._pos1Y=e.y,n._pos1Z=e.z;let r,_,l,h,c,m,b=t.position2;n._pos2X=b.x,n._pos2Y=b.y,n._pos2Z=b.z,n._relPos1X=n._pos1X-i._positionX,n._relPos1Y=n._pos1Y-i._positionY,n._relPos1Z=n._pos1Z-i._positionZ,n._relPos2X=n._pos2X-a._positionX,n._relPos2Y=n._pos2Y-a._positionY,n._relPos2Z=n._pos2Z-a._positionZ,r=i._rotation00*n._relPos1X+i._rotation10*n._relPos1Y+i._rotation20*n._relPos1Z,_=i._rotation01*n._relPos1X+i._rotation11*n._relPos1Y+i._rotation21*n._relPos1Z,l=i._rotation02*n._relPos1X+i._rotation12*n._relPos1Y+i._rotation22*n._relPos1Z,n._localPos1X=r,n._localPos1Y=_,n._localPos1Z=l,h=a._rotation00*n._relPos2X+a._rotation10*n._relPos2Y+a._rotation20*n._relPos2Z,c=a._rotation01*n._relPos2X+a._rotation11*n._relPos2Y+a._rotation21*n._relPos2Z,m=a._rotation02*n._relPos2X+a._rotation12*n._relPos2Y+a._rotation22*n._relPos2Z,n._localPos2X=h,n._localPos2Y=c,n._localPos2Z=m,n._depth=t.depth;let p=n._impulse;p.impulseN=0,p.impulseT=0,p.impulseB=0,p.impulseP=0,p.impulseLX=0,p.impulseLY=0,p.impulseLZ=0,n._id=t.id,n._warmStarted=!1,n._disabled=!1,this._manifold._numPoints++}computeTargetIndex(t,i,s){let a,o,n,e=this._manifold._points[0],r=this._manifold._points[1],_=this._manifold._points[2],l=this._manifold._points[3],h=e._depth,c=0;r._depth>h&&(h=r._depth,c=1),_._depth>h&&(h=_._depth,c=2),l._depth>h&&(c=3);let m=t.position1;a=m.x,o=m.y,n=m.z,a-=i._positionX,o-=i._positionY,n-=i._positionZ;let b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T,C,j,R,E=r._relPos1X,q=r._relPos1Y,N=r._relPos1Z,D=_._relPos1X,F=_._relPos1Y,H=_._relPos1Z,G=l._relPos1X,W=l._relPos1Y,O=l._relPos1Z;b=D-E,p=F-q,x=H-N,f=a-G,u=o-W,y=n-O,v=G-E,d=W-q,g=O-N,X=a-D,Y=o-F,z=n-H,Z=a-E,M=o-q,I=n-N,V=G-D,L=W-F,w=O-H,k=p*y-x*u,A=x*f-b*y,B=b*u-p*f,P=d*z-g*Y,S=g*X-v*z,T=v*Y-d*X,C=M*w-I*L,j=I*V-Z*w,R=Z*L-M*V;let J,U,Q,K,$,tt,it,st,at,ot,nt,et,rt,_t,lt,ht,ct,mt,bt,pt,xt,ft,ut,yt,vt,dt,gt,Xt=k*k+A*A+B*B,Yt=P*P+S*S+T*T,zt=C*C+j*j+R*R,Zt=e._relPos1X,Mt=e._relPos1Y,It=e._relPos1Z,Vt=_._relPos1X,Lt=_._relPos1Y,wt=_._relPos1Z,kt=l._relPos1X,At=l._relPos1Y,Bt=l._relPos1Z;J=Vt-Zt,U=Lt-Mt,Q=wt-It,K=a-kt,$=o-At,tt=n-Bt,it=kt-Zt,st=At-Mt,at=Bt-It,ot=a-Vt,nt=o-Lt,et=n-wt,rt=a-Zt,_t=o-Mt,lt=n-It,ht=kt-Vt,ct=At-Lt,mt=Bt-wt,bt=U*tt-Q*$,pt=Q*K-J*tt,xt=J*$-U*K,ft=st*et-at*nt,ut=at*ot-it*et,yt=it*nt-st*ot,vt=_t*mt-lt*ct,dt=lt*ht-rt*mt,gt=rt*ct-_t*ht;let Pt,St,Tt,Ct,jt,Rt,Et,qt,Nt,Dt,Ft,Ht,Gt,Wt,Ot,Jt,Ut,Qt,Kt,$t,ti,ii,si,ai,oi,ni,ei,ri=bt*bt+pt*pt+xt*xt,_i=ft*ft+ut*ut+yt*yt,li=vt*vt+dt*dt+gt*gt,hi=ri>_i?ri>li?ri:li:_i>li?_i:li,ci=e._relPos1X,mi=e._relPos1Y,bi=e._relPos1Z,pi=r._relPos1X,xi=r._relPos1Y,fi=r._relPos1Z,ui=l._relPos1X,yi=l._relPos1Y,vi=l._relPos1Z;Pt=pi-ci,St=xi-mi,Tt=fi-bi,Ct=a-ui,jt=o-yi,Rt=n-vi,Et=ui-ci,qt=yi-mi,Nt=vi-bi,Dt=a-pi,Ft=o-xi,Ht=n-fi,Gt=a-ci,Wt=o-mi,Ot=n-bi,Jt=ui-pi,Ut=yi-xi,Qt=vi-fi,Kt=St*Rt-Tt*jt,$t=Tt*Ct-Pt*Rt,ti=Pt*jt-St*Ct,ii=qt*Ht-Nt*Ft,si=Nt*Dt-Et*Ht,ai=Et*Ft-qt*Dt,oi=Wt*Qt-Ot*Ut,ni=Ot*Jt-Gt*Qt,ei=Gt*Ut-Wt*Jt;let di,gi,Xi,Yi,zi,Zi,Mi,Ii,Vi,Li,wi,ki,Ai,Bi,Pi,Si,Ti,Ci,ji,Ri,Ei,qi,Ni,Di,Fi,Hi,Gi,Wi=Kt*Kt+$t*$t+ti*ti,Oi=ii*ii+si*si+ai*ai,Ji=oi*oi+ni*ni+ei*ei,Ui=Wi>Oi?Wi>Ji?Wi:Ji:Oi>Ji?Oi:Ji,Qi=e._relPos1X,Ki=e._relPos1Y,$i=e._relPos1Z,ts=r._relPos1X,is=r._relPos1Y,ss=r._relPos1Z,as=_._relPos1X,os=_._relPos1Y,ns=_._relPos1Z;di=ts-Qi,gi=is-Ki,Xi=ss-$i,Yi=a-as,zi=o-os,Zi=n-ns,Mi=as-Qi,Ii=os-Ki,Vi=ns-$i,Li=a-ts,wi=o-is,ki=n-ss,Ai=a-Qi,Bi=o-Ki,Pi=n-$i,Si=as-ts,Ti=os-is,Ci=ns-ss,ji=gi*Zi-Xi*zi,Ri=Xi*Yi-di*Zi,Ei=di*zi-gi*Yi,qi=Ii*ki-Vi*wi,Ni=Vi*Li-Mi*ki,Di=Mi*wi-Ii*Li,Fi=Bi*Ci-Pi*Ti,Hi=Pi*Si-Ai*Ci,Gi=Ai*Ti-Bi*Si;let es=ji*ji+Ri*Ri+Ei*Ei,rs=qi*qi+Ni*Ni+Di*Di,_s=Fi*Fi+Hi*Hi+Gi*Gi,ls=Xt>Yt?Xt>zt?Xt:zt:Yt>zt?Yt:zt,hs=0;return(hi>ls&&1!=c||0==c)&&(ls=hi,hs=1),Ui>ls&&2!=c&&(ls=Ui,hs=2),(es>rs?es>_s?es:_s:rs>_s?rs:_s)>ls&&3!=c&&(hs=3),hs}computeRelativePositions(t,i){let s=this._manifold._numPoints,a=0;for(;a<s;){let s,o,n,e,r,_,l=this._manifold._points[a++];s=t._rotation00*l._localPos1X+t._rotation01*l._localPos1Y+t._rotation02*l._localPos1Z,o=t._rotation10*l._localPos1X+t._rotation11*l._localPos1Y+t._rotation12*l._localPos1Z,n=t._rotation20*l._localPos1X+t._rotation21*l._localPos1Y+t._rotation22*l._localPos1Z,l._relPos1X=s,l._relPos1Y=o,l._relPos1Z=n,e=i._rotation00*l._localPos2X+i._rotation01*l._localPos2Y+i._rotation02*l._localPos2Z,r=i._rotation10*l._localPos2X+i._rotation11*l._localPos2Y+i._rotation12*l._localPos2Z,_=i._rotation20*l._localPos2X+i._rotation21*l._localPos2Y+i._rotation22*l._localPos2Z,l._relPos2X=e,l._relPos2Y=r,l._relPos2Z=_,l._warmStarted=!0}}findNearestContactPointIndex(t,i,a){let o=s.common.Setting.contactPersistenceThreshold*s.common.Setting.contactPersistenceThreshold,n=-1,e=0,r=this._manifold._numPoints;for(;e<r;){let s,r,_,l,h,c,m=e++,b=this._manifold._points[m],p=t.position1;s=p.x,r=p.y,_=p.z;let x,f,u,y,v,d,g=t.position2;l=g.x,h=g.y,c=g.z,s-=i._positionX,r-=i._positionY,_-=i._positionZ,l-=a._positionX,h-=a._positionY,c-=a._positionZ,x=b._relPos1X-s,f=b._relPos1Y-r,u=b._relPos1Z-_,y=b._relPos2X-l,v=b._relPos2Y-h,d=b._relPos2Z-c;let X=x*x+f*f+u*u,Y=y*y+v*v+d*d,z=X<Y?X:Y;z<o&&(o=z,n=m)}return n}totalUpdate(t,i,s){this.numOldPoints=this._manifold._numPoints;let a=0,o=this.numOldPoints;for(;a<o;){let t=a++,i=this.oldPoints[t],s=this._manifold._points[t];i._localPos1X=s._localPos1X,i._localPos1Y=s._localPos1Y,i._localPos1Z=s._localPos1Z,i._localPos2X=s._localPos2X,i._localPos2Y=s._localPos2Y,i._localPos2Z=s._localPos2Z,i._relPos1X=s._relPos1X,i._relPos1Y=s._relPos1Y,i._relPos1Z=s._relPos1Z,i._relPos2X=s._relPos2X,i._relPos2Y=s._relPos2Y,i._relPos2Z=s._relPos2Z,i._pos1X=s._pos1X,i._pos1Y=s._pos1Y,i._pos1Z=s._pos1Z,i._pos2X=s._pos2X,i._pos2Y=s._pos2Y,i._pos2Z=s._pos2Z,i._depth=s._depth,i._impulse.copyFrom(s._impulse),i._id=s._id,i._warmStarted=s._warmStarted,i._disabled=!1}let n=t.numPoints;this._manifold._numPoints=n;let e=0;for(;e<n;){let a=e++,o=this._manifold._points[a],n=t.points[a],r=n.position1;o._pos1X=r.x,o._pos1Y=r.y,o._pos1Z=r.z;let _,l,h,c,m,b,p=n.position2;o._pos2X=p.x,o._pos2Y=p.y,o._pos2Z=p.z,o._relPos1X=o._pos1X-i._positionX,o._relPos1Y=o._pos1Y-i._positionY,o._relPos1Z=o._pos1Z-i._positionZ,o._relPos2X=o._pos2X-s._positionX,o._relPos2Y=o._pos2Y-s._positionY,o._relPos2Z=o._pos2Z-s._positionZ,_=i._rotation00*o._relPos1X+i._rotation10*o._relPos1Y+i._rotation20*o._relPos1Z,l=i._rotation01*o._relPos1X+i._rotation11*o._relPos1Y+i._rotation21*o._relPos1Z,h=i._rotation02*o._relPos1X+i._rotation12*o._relPos1Y+i._rotation22*o._relPos1Z,o._localPos1X=_,o._localPos1Y=l,o._localPos1Z=h,c=s._rotation00*o._relPos2X+s._rotation10*o._relPos2Y+s._rotation20*o._relPos2Z,m=s._rotation01*o._relPos2X+s._rotation11*o._relPos2Y+s._rotation21*o._relPos2Z,b=s._rotation02*o._relPos2X+s._rotation12*o._relPos2Y+s._rotation22*o._relPos2Z,o._localPos2X=c,o._localPos2Y=m,o._localPos2Z=b,o._depth=n.depth;let x=o._impulse;x.impulseN=0,x.impulseT=0,x.impulseB=0,x.impulseP=0,x.impulseLX=0,x.impulseLY=0,x.impulseLZ=0,o._id=n.id,o._warmStarted=!1,o._disabled=!1;let f=0,u=this.numOldPoints;for(;f<u;){let t=this.oldPoints[f++];if(o._id==t._id){o._impulse.copyFrom(t._impulse),o._warmStarted=!0;break}}}}incrementalUpdate(t,i,s){this._manifold._updateDepthsAndPositions(i,s);let a=0,o=this._manifold._numPoints;for(;a<o;)this._manifold._points[a++]._warmStarted=!0;let n=t.points[0],e=this.findNearestContactPointIndex(n,i,s);if(-1==e)this.addManifoldPoint(n,i,s);else{let t=this._manifold._points[e],a=n.position1;t._pos1X=a.x,t._pos1Y=a.y,t._pos1Z=a.z;let o,r,_,l,h,c,m=n.position2;t._pos2X=m.x,t._pos2Y=m.y,t._pos2Z=m.z,t._relPos1X=t._pos1X-i._positionX,t._relPos1Y=t._pos1Y-i._positionY,t._relPos1Z=t._pos1Z-i._positionZ,t._relPos2X=t._pos2X-s._positionX,t._relPos2Y=t._pos2Y-s._positionY,t._relPos2Z=t._pos2Z-s._positionZ,o=i._rotation00*t._relPos1X+i._rotation10*t._relPos1Y+i._rotation20*t._relPos1Z,r=i._rotation01*t._relPos1X+i._rotation11*t._relPos1Y+i._rotation21*t._relPos1Z,_=i._rotation02*t._relPos1X+i._rotation12*t._relPos1Y+i._rotation22*t._relPos1Z,t._localPos1X=o,t._localPos1Y=r,t._localPos1Z=_,l=s._rotation00*t._relPos2X+s._rotation10*t._relPos2Y+s._rotation20*t._relPos2Z,h=s._rotation01*t._relPos2X+s._rotation11*t._relPos2Y+s._rotation21*t._relPos2Z,c=s._rotation02*t._relPos2X+s._rotation12*t._relPos2Y+s._rotation22*t._relPos2Z,t._localPos2X=l,t._localPos2Y=h,t._localPos2Z=c,t._depth=n.depth}this.removeOutdatedPoints()}},s.dynamics.constraint.info||(s.dynamics.constraint.info={}),s.dynamics.constraint.info.JacobianRow=class{constructor(){this.lin1X=0,this.lin1Y=0,this.lin1Z=0,this.lin2X=0,this.lin2Y=0,this.lin2Z=0,this.ang1X=0,this.ang1Y=0,this.ang1Z=0,this.ang2X=0,this.ang2Y=0,this.ang2Z=0,this.flag=0}updateSparsity(){this.flag=0,0==this.lin1X&&0==this.lin1Y&&0==this.lin1Z&&0==this.lin2X&&0==this.lin2Y&&0==this.lin2Z||(this.flag|=1),0==this.ang1X&&0==this.ang1Y&&0==this.ang1Z&&0==this.ang2X&&0==this.ang2Y&&0==this.ang2Z||(this.flag|=2)}},s.dynamics.constraint.info.contact||(s.dynamics.constraint.info.contact={}),s.dynamics.constraint.info.contact.ContactSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0,this.rows=new Array(s.common.Setting.maxManifoldPoints);let t=0,i=this.rows.length;for(;t<i;)this.rows[t++]=new s.dynamics.constraint.info.contact.ContactSolverInfoRow}},s.dynamics.constraint.info.contact.ContactSolverInfoRow=class{constructor(){this.jacobianN=new s.dynamics.constraint.info.JacobianRow,this.jacobianT=new s.dynamics.constraint.info.JacobianRow,this.jacobianB=new s.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.friction=0,this.impulse=null}},s.dynamics.constraint.info.joint||(s.dynamics.constraint.info.joint={}),s.dynamics.constraint.info.joint.JointSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0,this.rows=new Array(s.common.Setting.maxJacobianRows);let t=0,i=this.rows.length;for(;t<i;)this.rows[t++]=new s.dynamics.constraint.info.joint.JointSolverInfoRow}},s.dynamics.constraint.info.joint.JointSolverInfoRow=class{constructor(){this.jacobian=new s.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.minImpulse=0,this.maxImpulse=0,this.motorSpeed=0,this.motorMaxImpulse=0,this.impulse=null}},s.dynamics.constraint.joint||(s.dynamics.constraint.joint={}),s.dynamics.constraint.joint.BasisTracker=class{constructor(t){this.joint=t,this.xX=0,this.xY=0,this.xZ=0,this.yX=0,this.yY=0,this.yZ=0,this.zX=0,this.zY=0,this.zZ=0}},s.dynamics.constraint.joint.Joint=class{constructor(t,i){switch(this._link1=new s.dynamics.constraint.joint.JointLink(this),this._link2=new s.dynamics.constraint.joint.JointLink(this),this._positionCorrectionAlgorithm=s.common.Setting.defaultJointPositionCorrectionAlgorithm,this._type=i,this._world=null,this._b1=t.rigidBody1,this._b2=t.rigidBody2,this._allowCollision=t.allowCollision,this._breakForce=t.breakForce,this._breakTorque=t.breakTorque,t.solverType){case 0:this._solver=new s.dynamics.constraint.solver.pgs.PgsJointConstraintSolver(this);break;case 1:this._solver=new s.dynamics.constraint.solver.direct.DirectJointConstraintSolver(this)}let a=t.localAnchor1;this._localAnchor1X=a.x,this._localAnchor1Y=a.y,this._localAnchor1Z=a.z;let o=t.localAnchor2;this._localAnchor2X=o.x,this._localAnchor2Y=o.y,this._localAnchor2Z=o.z,this._relativeAnchor1X=0,this._relativeAnchor1Y=0,this._relativeAnchor1Z=0,this._relativeAnchor2X=0,this._relativeAnchor2Y=0,this._relativeAnchor2Z=0,this._anchor1X=0,this._anchor1Y=0,this._anchor1Z=0,this._anchor2X=0,this._anchor2Y=0,this._anchor2Z=0,this._localBasisX1X=0,this._localBasisX1Y=0,this._localBasisX1Z=0,this._localBasisY1X=0,this._localBasisY1Y=0,this._localBasisY1Z=0,this._localBasisZ1X=0,this._localBasisZ1Y=0,this._localBasisZ1Z=0,this._localBasisX2X=0,this._localBasisX2Y=0,this._localBasisX2Z=0,this._localBasisY2X=0,this._localBasisY2Y=0,this._localBasisY2Z=0,this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=0,this._impulses=new Array(s.common.Setting.maxJacobianRows);let n=0,e=s.common.Setting.maxJacobianRows;for(;n<e;)this._impulses[n++]=new s.dynamics.constraint.joint.JointImpulse}buildLocalBasesFromX(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{let t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}let t,i,s,a,o,n,e,r,_,l,h,c,m,b=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(b<-.999999999){let o,n,e,r,_=this._localBasisX1X,l=this._localBasisX1Y,h=this._localBasisX1Z,c=_*_,m=l*l,b=h*h;c<m?c<b?(r=1/Math.sqrt(m+b),o=0,n=h*r,e=-l*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),o=-h*r,n=0,e=_*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0),t=o,i=n,s=e,a=0}else{let o,n,e;o=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,n=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,e=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;let r=Math.sqrt(.5*(1+b));b=.5/r,o*=b,n*=b,e*=b,t=o,i=n,s=e,a=r}let p=2*t,x=2*i,f=2*s,u=t*p,y=i*x,v=s*f,d=t*x,g=i*f,X=t*f,Y=a*p,z=a*x,Z=a*f;o=1-y-v,n=d-Z,e=X+z,r=d+Z,_=1-u-v,l=g-Y,h=X-z,c=g+Y,m=1-u-y;let M,I,V,L,w,k,A,B,P,S,T=this._localBasisX1X,C=this._localBasisX1Y,j=this._localBasisX1Z,R=T*T,E=C*C,q=j*j;R<E?R<q?(M=1/Math.sqrt(E+q),this._localBasisY1X=0,this._localBasisY1Y=j*M,this._localBasisY1Z=-C*M):(M=1/Math.sqrt(R+E),this._localBasisY1X=C*M,this._localBasisY1Y=-T*M,this._localBasisY1Z=0):E<q?(M=1/Math.sqrt(q+R),this._localBasisY1X=-j*M,this._localBasisY1Y=0,this._localBasisY1Z=T*M):(M=1/Math.sqrt(R+E),this._localBasisY1X=C*M,this._localBasisY1Y=-T*M,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,I=o*this._localBasisX1X+n*this._localBasisX1Y+e*this._localBasisX1Z,V=r*this._localBasisX1X+_*this._localBasisX1Y+l*this._localBasisX1Z,L=h*this._localBasisX1X+c*this._localBasisX1Y+m*this._localBasisX1Z,this._localBasisX2X=I,this._localBasisX2Y=V,this._localBasisX2Z=L,w=o*this._localBasisY1X+n*this._localBasisY1Y+e*this._localBasisY1Z,k=r*this._localBasisY1X+_*this._localBasisY1Y+l*this._localBasisY1Z,A=h*this._localBasisY1X+c*this._localBasisY1Y+m*this._localBasisY1Z,this._localBasisY2X=w,this._localBasisY2Y=k,this._localBasisY2Z=A,B=o*this._localBasisZ1X+n*this._localBasisZ1Y+e*this._localBasisZ1Z,P=r*this._localBasisZ1X+_*this._localBasisZ1Y+l*this._localBasisZ1Z,S=h*this._localBasisZ1X+c*this._localBasisZ1Y+m*this._localBasisZ1Z,this._localBasisZ2X=B,this._localBasisZ2Y=P,this._localBasisZ2Z=S}buildLocalBasesFromXY(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{let t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){let t,i=this._localBasisX1X,s=this._localBasisX1Y,a=this._localBasisX1Z,o=i*i,n=s*s,e=a*a;o<n?o<e?(t=1/Math.sqrt(n+e),this._localBasisY1X=0,this._localBasisY1Y=a*t,this._localBasisY1Z=-s*t):(t=1/Math.sqrt(o+n),this._localBasisY1X=s*t,this._localBasisY1Y=-i*t,this._localBasisY1Z=0):n<e?(t=1/Math.sqrt(e+o),this._localBasisY1X=-a*t,this._localBasisY1Y=0,this._localBasisY1Z=i*t):(t=1/Math.sqrt(o+n),this._localBasisY1X=s*t,this._localBasisY1Y=-i*t,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{let t=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ1X*=t,this._localBasisZ1Y*=t,this._localBasisZ1Z*=t,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0){let t,i=this._localBasisX2X,s=this._localBasisX2Y,a=this._localBasisX2Z,o=i*i,n=s*s,e=a*a;o<n?o<e?(t=1/Math.sqrt(n+e),this._localBasisY2X=0,this._localBasisY2Y=a*t,this._localBasisY2Z=-s*t):(t=1/Math.sqrt(o+n),this._localBasisY2X=s*t,this._localBasisY2Y=-i*t,this._localBasisY2Z=0):n<e?(t=1/Math.sqrt(e+o),this._localBasisY2X=-a*t,this._localBasisY2Y=0,this._localBasisY2Z=i*t):(t=1/Math.sqrt(o+n),this._localBasisY2X=s*t,this._localBasisY2Y=-i*t,this._localBasisY2Z=0),this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X}else{let t=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ2X*=t,this._localBasisZ2Y*=t,this._localBasisZ2Z*=t,this._localBasisY2X=this._localBasisZ2Y*this._localBasisX2Z-this._localBasisZ2Z*this._localBasisX2Y,this._localBasisY2Y=this._localBasisZ2Z*this._localBasisX2X-this._localBasisZ2X*this._localBasisX2Z,this._localBasisY2Z=this._localBasisZ2X*this._localBasisX2Y-this._localBasisZ2Y*this._localBasisX2X}}buildLocalBasesFromX1Z2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0)this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=1;else{let t=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ2X*=t,this._localBasisZ2Y*=t,this._localBasisZ2Z*=t}let t,i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T,C,j,R=this._b1._transform,E=this._b2._transform;if(x=R._rotation00*this._localBasisX1X+R._rotation01*this._localBasisX1Y+R._rotation02*this._localBasisX1Z,f=R._rotation10*this._localBasisX1X+R._rotation11*this._localBasisX1Y+R._rotation12*this._localBasisX1Z,u=R._rotation20*this._localBasisX1X+R._rotation21*this._localBasisX1Y+R._rotation22*this._localBasisX1Z,t=x,i=f,s=u,y=E._rotation00*this._localBasisZ2X+E._rotation01*this._localBasisZ2Y+E._rotation02*this._localBasisZ2Z,v=E._rotation10*this._localBasisZ2X+E._rotation11*this._localBasisZ2Y+E._rotation12*this._localBasisZ2Z,d=E._rotation20*this._localBasisZ2X+E._rotation21*this._localBasisZ2Y+E._rotation22*this._localBasisZ2Z,m=y,b=v,p=d,e=b*s-p*i,r=p*t-m*s,_=m*i-b*t,e*e+r*r+_*_==0){let a,o=t,n=i,l=s,h=o*o,c=n*n,m=l*l;h<c?h<m?(a=1/Math.sqrt(c+m),e=0,r=l*a,_=-n*a):(a=1/Math.sqrt(h+c),e=n*a,r=-o*a,_=0):c<m?(a=1/Math.sqrt(m+h),e=-l*a,r=0,_=o*a):(a=1/Math.sqrt(h+c),e=n*a,r=-o*a,_=0)}a=i*_-s*r,o=s*e-t*_,n=t*r-i*e,l=r*p-_*b,h=_*m-e*p,c=e*b-r*m,g=R._rotation00*t+R._rotation10*i+R._rotation20*s,X=R._rotation01*t+R._rotation11*i+R._rotation21*s,Y=R._rotation02*t+R._rotation12*i+R._rotation22*s,this._localBasisX1X=g,this._localBasisX1Y=X,this._localBasisX1Z=Y,z=R._rotation00*e+R._rotation10*r+R._rotation20*_,Z=R._rotation01*e+R._rotation11*r+R._rotation21*_,M=R._rotation02*e+R._rotation12*r+R._rotation22*_,this._localBasisY1X=z,this._localBasisY1Y=Z,this._localBasisY1Z=M,I=R._rotation00*a+R._rotation10*o+R._rotation20*n,V=R._rotation01*a+R._rotation11*o+R._rotation21*n,L=R._rotation02*a+R._rotation12*o+R._rotation22*n,this._localBasisZ1X=I,this._localBasisZ1Y=V,this._localBasisZ1Z=L,w=E._rotation00*l+E._rotation10*h+E._rotation20*c,k=E._rotation01*l+E._rotation11*h+E._rotation21*c,A=E._rotation02*l+E._rotation12*h+E._rotation22*c,this._localBasisX2X=w,this._localBasisX2Y=k,this._localBasisX2Z=A,B=E._rotation00*e+E._rotation10*r+E._rotation20*_,P=E._rotation01*e+E._rotation11*r+E._rotation21*_,S=E._rotation02*e+E._rotation12*r+E._rotation22*_,this._localBasisY2X=B,this._localBasisY2Y=P,this._localBasisY2Z=S,T=E._rotation00*m+E._rotation10*b+E._rotation20*p,C=E._rotation01*m+E._rotation11*b+E._rotation21*p,j=E._rotation02*m+E._rotation12*b+E._rotation22*p,this._localBasisZ2X=T,this._localBasisZ2Y=C,this._localBasisZ2Z=j}buildLocalBasesFromXY1X2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){let t,i=this._localBasisX1X,s=this._localBasisX1Y,a=this._localBasisX1Z,o=i*i,n=s*s,e=a*a;o<n?o<e?(t=1/Math.sqrt(n+e),this._localBasisY1X=0,this._localBasisY1Y=a*t,this._localBasisY1Z=-s*t):(t=1/Math.sqrt(o+n),this._localBasisY1X=s*t,this._localBasisY1Y=-i*t,this._localBasisY1Z=0):n<e?(t=1/Math.sqrt(e+o),this._localBasisY1X=-a*t,this._localBasisY1Y=0,this._localBasisY1Z=i*t):(t=1/Math.sqrt(o+n),this._localBasisY1X=s*t,this._localBasisY1Y=-i*t,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{let t=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ1X*=t,this._localBasisZ1Y*=t,this._localBasisZ1Z*=t,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}let t,i,s,a,o,n,e,r,_,l,h,c,m,b=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(b<-.999999999){let o,n,e,r,_=this._localBasisX1X,l=this._localBasisX1Y,h=this._localBasisX1Z,c=_*_,m=l*l,b=h*h;c<m?c<b?(r=1/Math.sqrt(m+b),o=0,n=h*r,e=-l*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),o=-h*r,n=0,e=_*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0),t=o,i=n,s=e,a=0}else{let o,n,e;o=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,n=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,e=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;let r=Math.sqrt(.5*(1+b));b=.5/r,o*=b,n*=b,e*=b,t=o,i=n,s=e,a=r}let p,x,f,u,y,v,d,g,X,Y=2*t,z=2*i,Z=2*s,M=t*Y,I=i*z,V=s*Z,L=t*z,w=i*Z,k=t*Z,A=a*Y,B=a*z,P=a*Z;o=1-I-V,n=L-P,e=k+B,r=L+P,_=1-M-V,l=w-A,h=k-B,c=w+A,m=1-M-I,p=o*this._localBasisX1X+n*this._localBasisX1Y+e*this._localBasisX1Z,x=r*this._localBasisX1X+_*this._localBasisX1Y+l*this._localBasisX1Z,f=h*this._localBasisX1X+c*this._localBasisX1Y+m*this._localBasisX1Z,this._localBasisX2X=p,this._localBasisX2Y=x,this._localBasisX2Z=f,u=o*this._localBasisY1X+n*this._localBasisY1Y+e*this._localBasisY1Z,y=r*this._localBasisY1X+_*this._localBasisY1Y+l*this._localBasisY1Z,v=h*this._localBasisY1X+c*this._localBasisY1Y+m*this._localBasisY1Z,this._localBasisY2X=u,this._localBasisY2Y=y,this._localBasisY2Z=v,d=o*this._localBasisZ1X+n*this._localBasisZ1Y+e*this._localBasisZ1Z,g=r*this._localBasisZ1X+_*this._localBasisZ1Y+l*this._localBasisZ1Z,X=h*this._localBasisZ1X+c*this._localBasisZ1Y+m*this._localBasisZ1Z,this._localBasisZ2X=d,this._localBasisZ2Y=g,this._localBasisZ2Z=X}setSolverInfoRowLinear(t,i,a,o,n,e,r){let _,l,h=s.common.Setting.linearSlop;if(r)_=0,l=1;else{if(n.frequency>0){h=0;let t=6.28318530717958*n.frequency,i=n.dampingRatio;i<s.common.Setting.minSpringDamperDampingRatio&&(i=s.common.Setting.minSpringDamperDampingRatio);let a=e.dt,o=2*i*t,r=t*t;n.useSymplecticEuler?(_=1/(a*o),l=r/o):(_=1/(a*(a*r+o)),l=r/(a*r+o))}else _=0,l=this.getErp(e,!1);a.motorForce>0?(t.motorSpeed=a.motorSpeed,t.motorMaxImpulse=a.motorForce*e.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}let c,m,b,p=a.lowerLimit,x=a.upperLimit;p>x?(c=0,m=0,b=0):p==x?(c=-Infinity,m=Infinity,b=i-p):i<p?(c=-Infinity,m=0,b=i-p+h,b>0&&(b=0)):i>x?(c=0,m=Infinity,b=i-x-h,b<0&&(b=0)):(c=0,m=0,b=0),t.minImpulse=c,t.maxImpulse=m,t.cfm=_*(0==o?0:1/o),t.rhs=b*l}setSolverInfoRowAngular(t,i,a,o,n,e,r){let _,l,h=s.common.Setting.angularSlop;if(r)_=0,l=1;else{if(n.frequency>0){h=0;let t=6.28318530717958*n.frequency,i=n.dampingRatio;i<s.common.Setting.minSpringDamperDampingRatio&&(i=s.common.Setting.minSpringDamperDampingRatio);let a=e.dt,o=2*i*t,r=t*t;n.useSymplecticEuler?(_=1/(a*o),l=r/o):(_=1/(a*(a*r+o)),l=r/(a*r+o))}else _=0,l=this.getErp(e,!1);a.motorTorque>0?(t.motorSpeed=a.motorSpeed,t.motorMaxImpulse=a.motorTorque*e.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}let c,m,b,p=a.lowerLimit,x=a.upperLimit,f=.5*(p+x);i=(((i-=f)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,i+=f,p>x?(c=0,m=0,b=0):p==x?(c=-Infinity,m=Infinity,b=i-p):i<p?(c=-Infinity,m=0,b=i-p+h,b>0&&(b=0)):i>x?(c=0,m=Infinity,b=i-x-h,b<0&&(b=0)):(c=0,m=0,b=0),t.minImpulse=c,t.maxImpulse=m,t.cfm=_*(0==o?0:1/o),t.rhs=b*l}getErp(t,i){return i?1:this._positionCorrectionAlgorithm==s.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*s.common.Setting.velocityBaumgarte:0}computeEffectiveInertiaMoment(t,i,s){let a,o,n,e,r,_,l,h,c,m,b,p;l=this._b1._invInertia00*t+this._b1._invInertia01*i+this._b1._invInertia02*s,h=this._b1._invInertia10*t+this._b1._invInertia11*i+this._b1._invInertia12*s,c=this._b1._invInertia20*t+this._b1._invInertia21*i+this._b1._invInertia22*s,a=l,o=h,n=c,m=this._b2._invInertia00*t+this._b2._invInertia01*i+this._b2._invInertia02*s,b=this._b2._invInertia10*t+this._b2._invInertia11*i+this._b2._invInertia12*s,p=this._b2._invInertia20*t+this._b2._invInertia21*i+this._b2._invInertia22*s,e=m,r=b,_=p;let x=a*t+o*i+n*s,f=e*t+r*i+_*s;if(x>0){let a=t*this._relativeAnchor1X+i*this._relativeAnchor1Y+s*this._relativeAnchor1Z,o=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z-a*a;o>0&&(x=this._b1._invMass>0?1/(1/x+this._b1._mass*o):0)}if(f>0){let a=t*this._relativeAnchor2X+i*this._relativeAnchor2Y+s*this._relativeAnchor2Z,o=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z-a*a;o>0&&(f=this._b2._invMass>0?1/(1/f+this._b2._mass*o):0)}return x+f==0?0:1/(x+f)}computeEffectiveInertiaMoment2(t,i,s,a,o,n){let e,r,_,l,h,c,m,b,p,x,f,u;m=this._b1._invInertia00*t+this._b1._invInertia01*i+this._b1._invInertia02*s,b=this._b1._invInertia10*t+this._b1._invInertia11*i+this._b1._invInertia12*s,p=this._b1._invInertia20*t+this._b1._invInertia21*i+this._b1._invInertia22*s,e=m,r=b,_=p,x=this._b2._invInertia00*a+this._b2._invInertia01*o+this._b2._invInertia02*n,f=this._b2._invInertia10*a+this._b2._invInertia11*o+this._b2._invInertia12*n,u=this._b2._invInertia20*a+this._b2._invInertia21*o+this._b2._invInertia22*n,l=x,h=f,c=u;let y=e*t+r*i+_*s,v=l*a+h*o+c*n;if(y>0){let a=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,o=t*this._relativeAnchor1X+i*this._relativeAnchor1Y+s*this._relativeAnchor1Z,n=a*a-o*o;n>0&&(y=this._b1._invMass>0?1/(1/y+this._b1._mass*n):0)}if(v>0){let t=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,i=a*this._relativeAnchor2X+o*this._relativeAnchor2Y+n*this._relativeAnchor2Z,s=t*t-i*i;s>0&&(v=this._b2._invMass>0?1/(1/v+this._b2._mass*s):0)}return y+v==0?0:1/(y+v)}_syncAnchors(){let t,i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z=this._b1._transform,Z=this._b2._transform;t=z._rotation00*this._localAnchor1X+z._rotation01*this._localAnchor1Y+z._rotation02*this._localAnchor1Z,i=z._rotation10*this._localAnchor1X+z._rotation11*this._localAnchor1Y+z._rotation12*this._localAnchor1Z,s=z._rotation20*this._localAnchor1X+z._rotation21*this._localAnchor1Y+z._rotation22*this._localAnchor1Z,this._relativeAnchor1X=t,this._relativeAnchor1Y=i,this._relativeAnchor1Z=s,a=Z._rotation00*this._localAnchor2X+Z._rotation01*this._localAnchor2Y+Z._rotation02*this._localAnchor2Z,o=Z._rotation10*this._localAnchor2X+Z._rotation11*this._localAnchor2Y+Z._rotation12*this._localAnchor2Z,n=Z._rotation20*this._localAnchor2X+Z._rotation21*this._localAnchor2Y+Z._rotation22*this._localAnchor2Z,this._relativeAnchor2X=a,this._relativeAnchor2Y=o,this._relativeAnchor2Z=n,this._anchor1X=this._relativeAnchor1X+z._positionX,this._anchor1Y=this._relativeAnchor1Y+z._positionY,this._anchor1Z=this._relativeAnchor1Z+z._positionZ,this._anchor2X=this._relativeAnchor2X+Z._positionX,this._anchor2Y=this._relativeAnchor2Y+Z._positionY,this._anchor2Z=this._relativeAnchor2Z+Z._positionZ,e=z._rotation00*this._localBasisX1X+z._rotation01*this._localBasisX1Y+z._rotation02*this._localBasisX1Z,r=z._rotation10*this._localBasisX1X+z._rotation11*this._localBasisX1Y+z._rotation12*this._localBasisX1Z,_=z._rotation20*this._localBasisX1X+z._rotation21*this._localBasisX1Y+z._rotation22*this._localBasisX1Z,this._basisX1X=e,this._basisX1Y=r,this._basisX1Z=_,l=z._rotation00*this._localBasisY1X+z._rotation01*this._localBasisY1Y+z._rotation02*this._localBasisY1Z,h=z._rotation10*this._localBasisY1X+z._rotation11*this._localBasisY1Y+z._rotation12*this._localBasisY1Z,c=z._rotation20*this._localBasisY1X+z._rotation21*this._localBasisY1Y+z._rotation22*this._localBasisY1Z,this._basisY1X=l,this._basisY1Y=h,this._basisY1Z=c,m=z._rotation00*this._localBasisZ1X+z._rotation01*this._localBasisZ1Y+z._rotation02*this._localBasisZ1Z,b=z._rotation10*this._localBasisZ1X+z._rotation11*this._localBasisZ1Y+z._rotation12*this._localBasisZ1Z,p=z._rotation20*this._localBasisZ1X+z._rotation21*this._localBasisZ1Y+z._rotation22*this._localBasisZ1Z,this._basisZ1X=m,this._basisZ1Y=b,this._basisZ1Z=p,x=Z._rotation00*this._localBasisX2X+Z._rotation01*this._localBasisX2Y+Z._rotation02*this._localBasisX2Z,f=Z._rotation10*this._localBasisX2X+Z._rotation11*this._localBasisX2Y+Z._rotation12*this._localBasisX2Z,u=Z._rotation20*this._localBasisX2X+Z._rotation21*this._localBasisX2Y+Z._rotation22*this._localBasisX2Z,this._basisX2X=x,this._basisX2Y=f,this._basisX2Z=u,y=Z._rotation00*this._localBasisY2X+Z._rotation01*this._localBasisY2Y+Z._rotation02*this._localBasisY2Z,v=Z._rotation10*this._localBasisY2X+Z._rotation11*this._localBasisY2Y+Z._rotation12*this._localBasisY2Z,d=Z._rotation20*this._localBasisY2X+Z._rotation21*this._localBasisY2Y+Z._rotation22*this._localBasisY2Z,this._basisY2X=y,this._basisY2Y=v,this._basisY2Z=d,g=Z._rotation00*this._localBasisZ2X+Z._rotation01*this._localBasisZ2Y+Z._rotation02*this._localBasisZ2Z,X=Z._rotation10*this._localBasisZ2X+Z._rotation11*this._localBasisZ2Y+Z._rotation12*this._localBasisZ2Z,Y=Z._rotation20*this._localBasisZ2X+Z._rotation21*this._localBasisZ2Y+Z._rotation22*this._localBasisZ2Z,this._basisZ2X=g,this._basisZ2Y=X,this._basisZ2Z=Y}_getVelocitySolverInfo(t,i){i.b1=this._b1,i.b2=this._b2,i.numRows=0}_getPositionSolverInfo(t){t.b1=this._b1,t.b2=this._b2,t.numRows=0}_checkDestruction(){let t=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;(this._breakForce>0&&this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ>this._breakForce*this._breakForce||this._breakTorque>0&&t>this._breakTorque*this._breakTorque)&&this._world.removeJoint(this)}getRigidBody1(){return this._b1}getRigidBody2(){return this._b2}getType(){return this._type}getAnchor1(){let t=new s.common.Vec3;return t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z,t}getAnchor2(){let t=new s.common.Vec3;return t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z,t}getAnchor1To(t){t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z}getAnchor2To(t){t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z}getLocalAnchor1(){let t=new s.common.Vec3;return t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z,t}getLocalAnchor2(){let t=new s.common.Vec3;return t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z,t}getLocalAnchor1To(t){t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z}getLocalAnchor2To(t){t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z}getBasis1(){let t,i,a,o,n,e,r,_,l,h=new s.common.Mat3;return t=this._basisX1X,i=this._basisY1X,a=this._basisZ1X,o=this._basisX1Y,n=this._basisY1Y,e=this._basisZ1Y,r=this._basisX1Z,_=this._basisY1Z,l=this._basisZ1Z,h.e00=t,h.e01=i,h.e02=a,h.e10=o,h.e11=n,h.e12=e,h.e20=r,h.e21=_,h.e22=l,h}getBasis2(){let t,i,a,o,n,e,r,_,l,h=new s.common.Mat3;return t=this._basisX2X,i=this._basisY2X,a=this._basisZ2X,o=this._basisX2Y,n=this._basisY2Y,e=this._basisZ2Y,r=this._basisX2Z,_=this._basisY2Z,l=this._basisZ2Z,h.e00=t,h.e01=i,h.e02=a,h.e10=o,h.e11=n,h.e12=e,h.e20=r,h.e21=_,h.e22=l,h}getBasis1To(t){let i,s,a,o,n,e,r,_,l;i=this._basisX1X,s=this._basisY1X,a=this._basisZ1X,o=this._basisX1Y,n=this._basisY1Y,e=this._basisZ1Y,r=this._basisX1Z,_=this._basisY1Z,l=this._basisZ1Z,t.e00=i,t.e01=s,t.e02=a,t.e10=o,t.e11=n,t.e12=e,t.e20=r,t.e21=_,t.e22=l}getBasis2To(t){let i,s,a,o,n,e,r,_,l;i=this._basisX2X,s=this._basisY2X,a=this._basisZ2X,o=this._basisX2Y,n=this._basisY2Y,e=this._basisZ2Y,r=this._basisX2Z,_=this._basisY2Z,l=this._basisZ2Z,t.e00=i,t.e01=s,t.e02=a,t.e10=o,t.e11=n,t.e12=e,t.e20=r,t.e21=_,t.e22=l}getAllowCollision(){return this._allowCollision}setAllowCollision(t){this._allowCollision=t}getBreakForce(){return this._breakForce}setBreakForce(t){this._breakForce=t}getBreakTorque(){return this._breakTorque}setBreakTorque(t){this._breakTorque=t}getPositionCorrectionAlgorithm(){return this._positionCorrectionAlgorithm}setPositionCorrectionAlgorithm(t){switch(t){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+t)}this._positionCorrectionAlgorithm=t}getAppliedForce(){let t=new s.common.Vec3;return t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ,t}getAppliedForceTo(t){t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ}getAppliedTorque(){let t=new s.common.Vec3;return t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ,t}getAppliedTorqueTo(t){t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ}getPrev(){return this._prev}getNext(){return this._next}},s.dynamics.constraint.joint.CylindricalJoint=class extends s.dynamics.constraint.joint.Joint{constructor(t){super(t,2);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let a=t.localAxis2;this._localBasisX2X=a.x,this._localBasisX2Y=a.y,this._localBasisX2Z=a.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this._basis=new s.dynamics.constraint.joint.BasisTracker(this),this._translSd=t.translationalSpringDamper.clone(),this._translLm=t.translationalLimitMotor.clone(),this._rotSd=t.rotationalSpringDamper.clone(),this._rotLm=t.rotationalLimitMotor.clone()}getInfo(t,i,s){let a,o=this.getErp(i,s),n=this.linearErrorY*o,e=this.linearErrorZ*o,r=this.angularErrorY*o,_=this.angularErrorZ*o,l=1/(this._b1._invMass+this._b2._invMass),h=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ);if(this._translSd.frequency<=0||!s){let o=this._impulses[0],n=t.rows[t.numRows++],e=n.jacobian;e.lin1X=0,e.lin1Y=0,e.lin1Z=0,e.lin2X=0,e.lin2Y=0,e.lin2Z=0,e.ang1X=0,e.ang1Y=0,e.ang1Z=0,e.ang2X=0,e.ang2Y=0,e.ang2Z=0,n.rhs=0,n.cfm=0,n.minImpulse=0,n.maxImpulse=0,n.motorSpeed=0,n.motorMaxImpulse=0,n.impulse=null,n.impulse=o,this.setSolverInfoRowLinear(n,this.translation,this._translLm,l,this._translSd,i,s),a=n.jacobian,a.lin1X=this._basis.xX,a.lin1Y=this._basis.xY,a.lin1Z=this._basis.xZ,a.lin2X=this._basis.xX,a.lin2Y=this._basis.xY,a.lin2Z=this._basis.xZ,a.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,a.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,a.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,a.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,a.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,a.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}let c=this._impulses[1],m=t.rows[t.numRows++],b=m.jacobian;b.lin1X=0,b.lin1Y=0,b.lin1Z=0,b.lin2X=0,b.lin2Y=0,b.lin2Z=0,b.ang1X=0,b.ang1Y=0,b.ang1Z=0,b.ang2X=0,b.ang2Y=0,b.ang2Z=0,m.rhs=0,m.cfm=0,m.minImpulse=0,m.maxImpulse=0,m.motorSpeed=0,m.motorMaxImpulse=0,m.impulse=null,m.impulse=c,m.rhs=n,m.cfm=0,m.minImpulse=-Infinity,m.maxImpulse=Infinity,a=m.jacobian,a.lin1X=this._basis.yX,a.lin1Y=this._basis.yY,a.lin1Z=this._basis.yZ,a.lin2X=this._basis.yX,a.lin2Y=this._basis.yY,a.lin2Z=this._basis.yZ,a.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,a.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,a.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,a.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,a.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,a.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;let p=this._impulses[2],x=t.rows[t.numRows++],f=x.jacobian;if(f.lin1X=0,f.lin1Y=0,f.lin1Z=0,f.lin2X=0,f.lin2Y=0,f.lin2Z=0,f.ang1X=0,f.ang1Y=0,f.ang1Z=0,f.ang2X=0,f.ang2Y=0,f.ang2Z=0,x.rhs=0,x.cfm=0,x.minImpulse=0,x.maxImpulse=0,x.motorSpeed=0,x.motorMaxImpulse=0,x.impulse=null,x.impulse=p,x.rhs=e,x.cfm=0,x.minImpulse=-Infinity,x.maxImpulse=Infinity,a=x.jacobian,a.lin1X=this._basis.zX,a.lin1Y=this._basis.zY,a.lin1Z=this._basis.zZ,a.lin2X=this._basis.zX,a.lin2Y=this._basis.zY,a.lin2Z=this._basis.zZ,a.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,a.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,a.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,a.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,a.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,a.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX,this._rotSd.frequency<=0||!s){let o=this._impulses[3],n=t.rows[t.numRows++],e=n.jacobian;e.lin1X=0,e.lin1Y=0,e.lin1Z=0,e.lin2X=0,e.lin2Y=0,e.lin2Z=0,e.ang1X=0,e.ang1Y=0,e.ang1Z=0,e.ang2X=0,e.ang2Y=0,e.ang2Z=0,n.rhs=0,n.cfm=0,n.minImpulse=0,n.maxImpulse=0,n.motorSpeed=0,n.motorMaxImpulse=0,n.impulse=null,n.impulse=o,this.setSolverInfoRowAngular(n,this.angle,this._rotLm,h,this._rotSd,i,s),a=n.jacobian,a.ang1X=this._basis.xX,a.ang1Y=this._basis.xY,a.ang1Z=this._basis.xZ,a.ang2X=this._basis.xX,a.ang2Y=this._basis.xY,a.ang2Z=this._basis.xZ}let u=this._impulses[4],y=t.rows[t.numRows++],v=y.jacobian;v.lin1X=0,v.lin1Y=0,v.lin1Z=0,v.lin2X=0,v.lin2Y=0,v.lin2Z=0,v.ang1X=0,v.ang1Y=0,v.ang1Z=0,v.ang2X=0,v.ang2Y=0,v.ang2Z=0,y.rhs=0,y.cfm=0,y.minImpulse=0,y.maxImpulse=0,y.motorSpeed=0,y.motorMaxImpulse=0,y.impulse=null,y.impulse=u,y.rhs=r,y.cfm=0,y.minImpulse=-Infinity,y.maxImpulse=Infinity,a=y.jacobian,a.ang1X=this._basis.yX,a.ang1Y=this._basis.yY,a.ang1Z=this._basis.yZ,a.ang2X=this._basis.yX,a.ang2Y=this._basis.yY,a.ang2Z=this._basis.yZ;let d=this._impulses[5],g=t.rows[t.numRows++],X=g.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,g.rhs=0,g.cfm=0,g.minImpulse=0,g.maxImpulse=0,g.motorSpeed=0,g.motorMaxImpulse=0,g.impulse=null,g.impulse=d,g.rhs=_,g.cfm=0,g.minImpulse=-Infinity,g.maxImpulse=Infinity,a=g.jacobian,a.ang1X=this._basis.zX,a.ang1Y=this._basis.zY,a.ang1Z=this._basis.zZ,a.ang2X=this._basis.zX,a.ang2Y=this._basis.zY,a.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();let t,i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T,C,j,R,E,q,N,D,F=this._basis,H=F.joint._b1._invMass,G=F.joint._b2._invMass,W=F.joint._basisX1X*F.joint._basisX2X+F.joint._basisX1Y*F.joint._basisX2Y+F.joint._basisX1Z*F.joint._basisX2Z;if(W<-.999999999){let o,n,e,r,_=F.joint._basisX1X,l=F.joint._basisX1Y,h=F.joint._basisX1Z,c=_*_,m=l*l,b=h*h;c<m?c<b?(r=1/Math.sqrt(m+b),o=0,n=h*r,e=-l*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),o=-h*r,n=0,e=_*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0),t=o,i=n,s=e,a=0}else{let o,n,e;o=F.joint._basisX1Y*F.joint._basisX2Z-F.joint._basisX1Z*F.joint._basisX2Y,n=F.joint._basisX1Z*F.joint._basisX2X-F.joint._basisX1X*F.joint._basisX2Z,e=F.joint._basisX1X*F.joint._basisX2Y-F.joint._basisX1Y*F.joint._basisX2X;let r=Math.sqrt(.5*(1+W));W=.5/r,o*=W,n*=W,e*=W,t=o,i=n,s=e,a=r}o=0,n=0,e=0,r=1,T=0,C=0,j=0,R=1,E=t,q=i,N=s,D=a;let O=T*E+C*q+j*N+R*D;if(O<0&&(O=-O,E=-E,q=-q,N=-N,D=-D),O>.999999){let t,i,s,a;t=E-T,i=q-C,s=N-j,a=D-R,E=T+t*(H/(H+G)),q=C+i*(H/(H+G)),N=j+s*(H/(H+G)),D=R+a*(H/(H+G));let o=E*E+q*q+N*N+D*D;o>1e-32&&(o=1/Math.sqrt(o)),_=E*o,l=q*o,h=N*o,c=D*o}else{let t=H/(H+G)*Math.acos(O);E+=T*-O,q+=C*-O,N+=j*-O,D+=R*-O;let i=E*E+q*q+N*N+D*D;i>1e-32&&(i=1/Math.sqrt(i)),E*=i,q*=i,N*=i,D*=i;let s=Math.sin(t),a=Math.cos(t);T*=a,C*=a,j*=a,R*=a,_=T+E*s,l=C+q*s,h=j+N*s,c=R+D*s}let J,U,Q,K=2*_,$=2*l,tt=2*h,it=_*K,st=l*$,at=h*tt,ot=_*$,nt=l*tt,et=_*tt,rt=c*K,_t=c*$,lt=c*tt;m=1-st-at,b=ot-lt,p=et+_t,x=ot+lt,f=1-it-at,u=nt-rt,y=et-_t,v=nt+rt,d=1-it-st,J=m*F.joint._basisX1X+b*F.joint._basisX1Y+p*F.joint._basisX1Z,U=x*F.joint._basisX1X+f*F.joint._basisX1Y+u*F.joint._basisX1Z,Q=y*F.joint._basisX1X+v*F.joint._basisX1Y+d*F.joint._basisX1Z,g=J,X=U,Y=Q,w=F.xX,k=F.xY,A=F.xZ,B=F.yX,P=F.yY,S=F.yZ;let ht=w*g+k*X+A*Y;if(ht<-.999999999){let t,i,s,a,o=w,n=k,e=A,r=o*o,m=n*n,b=e*e;r<m?r<b?(a=1/Math.sqrt(m+b),t=0,i=e*a,s=-n*a):(a=1/Math.sqrt(r+m),t=n*a,i=-o*a,s=0):m<b?(a=1/Math.sqrt(b+r),t=-e*a,i=0,s=o*a):(a=1/Math.sqrt(r+m),t=n*a,i=-o*a,s=0),_=t,l=i,h=s,c=0}else{let t,i,s;t=k*Y-A*X,i=A*g-w*Y,s=w*X-k*g;let a=Math.sqrt(.5*(1+ht));ht=.5/a,t*=ht,i*=ht,s*=ht,_=t,l=i,h=s,c=a}let ct,mt,bt,pt,xt,ft,ut=2*_,yt=2*l,vt=2*h,dt=_*ut,gt=l*yt,Xt=h*vt,Yt=_*yt,zt=l*vt,Zt=_*vt,Mt=c*ut,It=c*yt,Vt=c*vt;if(m=1-gt-Xt,b=Yt-Vt,p=Zt+It,x=Yt+Vt,f=1-dt-Xt,u=zt-Mt,y=Zt-It,v=zt+Mt,d=1-dt-gt,ct=m*B+b*P+p*S,mt=x*B+f*P+u*S,bt=y*B+v*P+d*S,z=ct,Z=mt,M=bt,I=X*M-Y*Z,V=Y*z-g*M,L=g*Z-X*z,I*I+V*V+L*L>1e-6){let t=I*I+V*V+L*L;t>0&&(t=1/Math.sqrt(t)),I*=t,V*=t,L*=t}else{let t,i=g,s=X,a=Y,o=i*i,n=s*s,e=a*a;o<n?o<e?(t=1/Math.sqrt(n+e),I=0,V=a*t,L=-s*t):(t=1/Math.sqrt(o+n),I=s*t,V=-i*t,L=0):n<e?(t=1/Math.sqrt(e+o),I=-a*t,V=0,L=i*t):(t=1/Math.sqrt(o+n),I=s*t,V=-i*t,L=0)}z=V*Y-L*X,Z=L*g-I*Y,M=I*X-V*g,F.xX=g,F.xY=X,F.xZ=Y,F.yX=z,F.yY=Z,F.yZ=M,F.zX=I,F.zY=V,F.zZ=L,pt=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,xt=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,ft=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;let Lt,wt,kt,At,Bt,Pt,St=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,Tt=St<=-1?3.14159265358979:St>=1?0:Math.acos(St),Ct=pt*pt+xt*xt+ft*ft;Ct>0&&(Ct=1/Math.sqrt(Ct)),pt*=Ct,xt*=Ct,ft*=Ct,pt*=Tt,xt*=Tt,ft*=Tt,this.angularErrorY=pt*this._basis.yX+xt*this._basis.yY+ft*this._basis.yZ,this.angularErrorZ=pt*this._basis.zX+xt*this._basis.zY+ft*this._basis.zZ,Lt=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,wt=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,kt=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,St=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=St<=-1?3.14159265358979:St>=1?0:Math.acos(St),Lt*this._basis.xX+wt*this._basis.xY+kt*this._basis.xZ<0&&(this.angle=-this.angle),At=this._anchor2X-this._anchor1X,Bt=this._anchor2Y-this._anchor1Y,Pt=this._anchor2Z-this._anchor1Z,this.translation=At*this._basis.xX+Bt*this._basis.xY+Pt*this._basis.xZ,this.linearErrorY=At*this._basis.yX+Bt*this._basis.yY+Pt*this._basis.yZ,this.linearErrorZ=At*this._basis.zX+Bt*this._basis.zY+Pt*this._basis.zZ}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new s.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new s.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new s.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new s.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTranslationalSpringDamper(){return this._translSd}getRotationalSpringDamper(){return this._rotSd}getTranslationalLimitMotor(){return this._translLm}getRotationalLimitMotor(){return this._rotLm}getAngle(){return this.angle}getTranslation(){return this.translation}},s.dynamics.constraint.joint.JointConfig=class{constructor(){this.rigidBody1=null,this.rigidBody2=null,this.localAnchor1=new s.common.Vec3,this.localAnchor2=new s.common.Vec3,this.allowCollision=!1,this.solverType=s.common.Setting.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=s.common.Setting.defaultJointPositionCorrectionAlgorithm,this.breakForce=0,this.breakTorque=0}_init(t,i,s){this.rigidBody1=t,this.rigidBody2=i;let a,o,n,e,r,_,l=this.rigidBody1,h=this.localAnchor1;a=s.x,o=s.y,n=s.z,a-=l._transform._positionX,o-=l._transform._positionY,n-=l._transform._positionZ,e=l._transform._rotation00*a+l._transform._rotation10*o+l._transform._rotation20*n,r=l._transform._rotation01*a+l._transform._rotation11*o+l._transform._rotation21*n,_=l._transform._rotation02*a+l._transform._rotation12*o+l._transform._rotation22*n,a=e,o=r,n=_,h.x=a,h.y=o,h.z=n;let c,m,b,p,x,f,u=this.rigidBody2,y=this.localAnchor2;c=s.x,m=s.y,b=s.z,c-=u._transform._positionX,m-=u._transform._positionY,b-=u._transform._positionZ,p=u._transform._rotation00*c+u._transform._rotation10*m+u._transform._rotation20*b,x=u._transform._rotation01*c+u._transform._rotation11*m+u._transform._rotation21*b,f=u._transform._rotation02*c+u._transform._rotation12*m+u._transform._rotation22*b,c=p,m=x,b=f,y.x=c,y.y=m,y.z=b}},s.dynamics.constraint.joint.CylindricalJointConfig=class extends s.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new s.common.Vec3(1,0,0),this.localAxis2=new s.common.Vec3(1,0,0),this.translationalLimitMotor=new s.dynamics.constraint.joint.TranslationalLimitMotor,this.translationalSpringDamper=new s.dynamics.constraint.joint.SpringDamper,this.rotationalLimitMotor=new s.dynamics.constraint.joint.RotationalLimitMotor,this.rotationalSpringDamper=new s.dynamics.constraint.joint.SpringDamper}init(t,i,s,a){this._init(t,i,s);let o,n,e,r,_,l,h=this.localAxis1;o=a.x,n=a.y,e=a.z,r=t._transform._rotation00*o+t._transform._rotation10*n+t._transform._rotation20*e,_=t._transform._rotation01*o+t._transform._rotation11*n+t._transform._rotation21*e,l=t._transform._rotation02*o+t._transform._rotation12*n+t._transform._rotation22*e,o=r,n=_,e=l,h.x=o,h.y=n,h.z=e;let c,m,b,p,x,f,u=this.localAxis2;return c=a.x,m=a.y,b=a.z,p=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*b,x=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*b,f=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*b,c=p,m=x,b=f,u.x=c,u.y=m,u.z=b,this}},s.dynamics.constraint.joint.GenericJoint=class extends s.dynamics.constraint.joint.Joint{constructor(t){let i;super(t,s.dynamics.constraint.joint.JointType.GENERIC);let a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g=t.localBasis1;if(g.e00*(g.e11*g.e22-g.e12*g.e21)-g.e01*(g.e10*g.e22-g.e12*g.e20)+g.e02*(g.e10*g.e21-g.e11*g.e20)<0)i=!0;else{let s=t.localBasis2;i=s.e00*(s.e11*s.e22-s.e12*s.e21)-s.e01*(s.e10*s.e22-s.e12*s.e20)+s.e02*(s.e10*s.e21-s.e11*s.e20)<0}i&&console.log("src/oimo/dynamics/constraint/joint/GenericJoint.hx:50:","[warning] joint basis must be right handed");let X=t.localBasis1;a=X.e00,o=X.e01,n=X.e02,e=X.e10,r=X.e11,_=X.e12,l=X.e20,h=X.e21,c=X.e22;let Y=t.localBasis2;m=Y.e00,b=Y.e01,p=Y.e02,x=Y.e10,f=Y.e11,u=Y.e12,y=Y.e20,v=Y.e21,d=Y.e22,this._localBasisX1X=a,this._localBasisX1Y=e,this._localBasisX1Z=l,this._localBasisY1X=o,this._localBasisY1Y=r,this._localBasisY1Z=h,this._localBasisZ1X=n,this._localBasisZ1Y=_,this._localBasisZ1Z=c,this._localBasisX2X=m,this._localBasisX2Y=x,this._localBasisX2Z=y,this._localBasisY2X=b,this._localBasisY2Y=f,this._localBasisY2Z=v,this._localBasisZ2X=p,this._localBasisZ2Y=u,this._localBasisZ2Z=d,this._angleX=0,this._angleY=0,this._angleZ=0,this.translationX=0,this.translationY=0,this.translationZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._translLms=new Array(3),this._translSds=new Array(3),this._rotLms=new Array(3),this._rotSds=new Array(3),this._translLms[0]=t.translationalLimitMotors[0].clone(),this._translLms[1]=t.translationalLimitMotors[1].clone(),this._translLms[2]=t.translationalLimitMotors[2].clone(),this._translSds[0]=t.translationalSpringDampers[0].clone(),this._translSds[1]=t.translationalSpringDampers[1].clone(),this._translSds[2]=t.translationalSpringDampers[2].clone(),this._rotLms[0]=t.rotationalLimitMotors[0].clone(),this._rotLms[1]=t.rotationalLimitMotors[1].clone(),this._rotLms[2]=t.rotationalLimitMotors[2].clone(),this._rotSds[0]=t.rotationalSpringDampers[0].clone(),this._rotSds[1]=t.rotationalSpringDampers[1].clone(),this._rotSds[2]=t.rotationalSpringDampers[2].clone()}getInfo(t,i,s){let a,o=1/(this._b1._invMass+this._b2._invMass),n=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),e=this.computeEffectiveInertiaMoment(this._axisYX,this._axisYY,this._axisYZ),r=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ);if(this._translSds[0].frequency<=0||!s){let n=this._impulses[0],e=t.rows[t.numRows++],r=e.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,e.rhs=0,e.cfm=0,e.minImpulse=0,e.maxImpulse=0,e.motorSpeed=0,e.motorMaxImpulse=0,e.impulse=null,e.impulse=n,this.setSolverInfoRowLinear(e,this.translationX,this._translLms[0],o,this._translSds[0],i,s),a=e.jacobian,a.lin1X=this._basisX1X,a.lin1Y=this._basisX1Y,a.lin1Z=this._basisX1Z,a.lin2X=this._basisX1X,a.lin2Y=this._basisX1Y,a.lin2Z=this._basisX1Z,a.ang1X=this._relativeAnchor1Y*this._basisX1Z-this._relativeAnchor1Z*this._basisX1Y,a.ang1Y=this._relativeAnchor1Z*this._basisX1X-this._relativeAnchor1X*this._basisX1Z,a.ang1Z=this._relativeAnchor1X*this._basisX1Y-this._relativeAnchor1Y*this._basisX1X,a.ang2X=this._relativeAnchor2Y*this._basisX1Z-this._relativeAnchor2Z*this._basisX1Y,a.ang2Y=this._relativeAnchor2Z*this._basisX1X-this._relativeAnchor2X*this._basisX1Z,a.ang2Z=this._relativeAnchor2X*this._basisX1Y-this._relativeAnchor2Y*this._basisX1X}if(this._translSds[1].frequency<=0||!s){let n=this._impulses[1],e=t.rows[t.numRows++],r=e.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,e.rhs=0,e.cfm=0,e.minImpulse=0,e.maxImpulse=0,e.motorSpeed=0,e.motorMaxImpulse=0,e.impulse=null,e.impulse=n,this.setSolverInfoRowLinear(e,this.translationY,this._translLms[1],o,this._translSds[1],i,s),a=e.jacobian,a.lin1X=this._basisY1X,a.lin1Y=this._basisY1Y,a.lin1Z=this._basisY1Z,a.lin2X=this._basisY1X,a.lin2Y=this._basisY1Y,a.lin2Z=this._basisY1Z,a.ang1X=this._relativeAnchor1Y*this._basisY1Z-this._relativeAnchor1Z*this._basisY1Y,a.ang1Y=this._relativeAnchor1Z*this._basisY1X-this._relativeAnchor1X*this._basisY1Z,a.ang1Z=this._relativeAnchor1X*this._basisY1Y-this._relativeAnchor1Y*this._basisY1X,a.ang2X=this._relativeAnchor2Y*this._basisY1Z-this._relativeAnchor2Z*this._basisY1Y,a.ang2Y=this._relativeAnchor2Z*this._basisY1X-this._relativeAnchor2X*this._basisY1Z,a.ang2Z=this._relativeAnchor2X*this._basisY1Y-this._relativeAnchor2Y*this._basisY1X}if(this._translSds[2].frequency<=0||!s){let n=this._impulses[2],e=t.rows[t.numRows++],r=e.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,e.rhs=0,e.cfm=0,e.minImpulse=0,e.maxImpulse=0,e.motorSpeed=0,e.motorMaxImpulse=0,e.impulse=null,e.impulse=n,this.setSolverInfoRowLinear(e,this.translationZ,this._translLms[2],o,this._translSds[2],i,s),a=e.jacobian,a.lin1X=this._basisZ1X,a.lin1Y=this._basisZ1Y,a.lin1Z=this._basisZ1Z,a.lin2X=this._basisZ1X,a.lin2Y=this._basisZ1Y,a.lin2Z=this._basisZ1Z,a.ang1X=this._relativeAnchor1Y*this._basisZ1Z-this._relativeAnchor1Z*this._basisZ1Y,a.ang1Y=this._relativeAnchor1Z*this._basisZ1X-this._relativeAnchor1X*this._basisZ1Z,a.ang1Z=this._relativeAnchor1X*this._basisZ1Y-this._relativeAnchor1Y*this._basisZ1X,a.ang2X=this._relativeAnchor2Y*this._basisZ1Z-this._relativeAnchor2Z*this._basisZ1Y,a.ang2Y=this._relativeAnchor2Z*this._basisZ1X-this._relativeAnchor2X*this._basisZ1Z,a.ang2Z=this._relativeAnchor2X*this._basisZ1Y-this._relativeAnchor2Y*this._basisZ1X}if(!this.xSingular&&(this._rotSds[0].frequency<=0||!s)){let o=this._impulses[3],e=t.rows[t.numRows++],r=e.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,e.rhs=0,e.cfm=0,e.minImpulse=0,e.maxImpulse=0,e.motorSpeed=0,e.motorMaxImpulse=0,e.impulse=null,e.impulse=o,this.setSolverInfoRowAngular(e,this._angleX,this._rotLms[0],n,this._rotSds[0],i,s),a=e.jacobian,a.ang1X=this._axisXX,a.ang1Y=this._axisXY,a.ang1Z=this._axisXZ,a.ang2X=this._axisXX,a.ang2Y=this._axisXY,a.ang2Z=this._axisXZ}if(!this.ySingular&&(this._rotSds[1].frequency<=0||!s)){let o=this._impulses[4],n=t.rows[t.numRows++],r=n.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,n.rhs=0,n.cfm=0,n.minImpulse=0,n.maxImpulse=0,n.motorSpeed=0,n.motorMaxImpulse=0,n.impulse=null,n.impulse=o,this.setSolverInfoRowAngular(n,this._angleY,this._rotLms[1],e,this._rotSds[1],i,s),a=n.jacobian,a.ang1X=this._axisYX,a.ang1Y=this._axisYY,a.ang1Z=this._axisYZ,a.ang2X=this._axisYX,a.ang2Y=this._axisYY,a.ang2Z=this._axisYZ}if(!this.zSingular&&(this._rotSds[2].frequency<=0||!s)){let o=this._impulses[5],n=t.rows[t.numRows++],e=n.jacobian;e.lin1X=0,e.lin1Y=0,e.lin1Z=0,e.lin2X=0,e.lin2Y=0,e.lin2Z=0,e.ang1X=0,e.ang1Y=0,e.ang1Z=0,e.ang2X=0,e.ang2Y=0,e.ang2Z=0,n.rhs=0,n.cfm=0,n.minImpulse=0,n.maxImpulse=0,n.motorSpeed=0,n.motorMaxImpulse=0,n.impulse=null,n.impulse=o,this.setSolverInfoRowAngular(n,this._angleZ,this._rotLms[2],r,this._rotSds[2],i,s),a=n.jacobian,a.ang1X=this._axisZX,a.ang1Y=this._axisZY,a.ang1Z=this._axisZZ,a.ang2X=this._axisZX,a.ang2Y=this._axisZY,a.ang2Z=this._axisZZ}}_syncAnchors(){let t,i,s,a,o,n,e,r,_;super._syncAnchors(),t=this._basisX1X,i=this._basisX1Y,s=this._basisX1Z,e=this._basisZ2X,r=this._basisZ2Y,_=this._basisZ2Z,a=r*s-_*i,o=_*t-e*s,n=e*i-r*t,this._axisXX=o*_-n*r,this._axisXY=n*e-a*_,this._axisXZ=a*r-o*e,this._axisYX=a,this._axisYY=o,this._axisYZ=n,this._axisZX=i*n-s*o,this._axisZY=s*a-t*n,this._axisZZ=t*o-i*a;let l=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;l>0&&(l=1/Math.sqrt(l)),this._axisXX*=l,this._axisXY*=l,this._axisXZ*=l;let h=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;h>0&&(h=1/Math.sqrt(h)),this._axisYX*=h,this._axisYY*=h,this._axisYZ*=h;let c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T,C,j,R,E,q,N,D,F,H,G=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;G>0&&(G=1/Math.sqrt(G)),this._axisZX*=G,this._axisZY*=G,this._axisZZ*=G,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0,c=this._basisX1X,m=this._basisY1X,b=this._basisZ1X,p=this._basisX1Y,x=this._basisY1Y,f=this._basisZ1Y,u=this._basisX1Z,y=this._basisY1Z,v=this._basisZ1Z,d=this._basisX2X,g=this._basisY2X,X=this._basisZ2X,Y=this._basisX2Y,z=this._basisY2Y,Z=this._basisZ2Y,M=this._basisX2Z,I=this._basisY2Z,V=this._basisZ2Z,T=c*d+p*Y+u*M,C=c*g+p*z+u*I,j=c*X+p*Z+u*V,R=m*g+x*z+y*I,E=m*X+x*Z+y*V,q=b*g+f*z+v*I,N=b*X+f*Z+v*V,L=T,w=C,k=j,A=R,B=E,P=q,S=N;let W,O,J,U=k;if(U<=-1){let t=Math.atan2(P,A);D=.5*t,F=-1.570796326794895,H=.5*-t}else if(U>=1){let t=Math.atan2(P,A);D=.5*t,F=1.570796326794895,H=.5*t}else D=Math.atan2(-B,S),F=Math.asin(U),H=Math.atan2(-w,L);this._angleX=D,this._angleY=F,this._angleZ=H,W=this._anchor2X-this._anchor1X,O=this._anchor2Y-this._anchor1Y,J=this._anchor2Z-this._anchor1Z,this.translationX=W*this._basisX1X+O*this._basisX1Y+J*this._basisX1Z,this.translationY=W*this._basisY1X+O*this._basisY1Y+J*this._basisY1Z,this.translationZ=W*this._basisZ1X+O*this._basisZ1Y+J*this._basisZ1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxisX(){let t=new s.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxisY(){let t=new s.common.Vec3;return t.x=this._axisYX,t.y=this._axisYY,t.z=this._axisYZ,t}getAxisZ(){let t=new s.common.Vec3;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,t}getTranslationalSpringDampers(){return this._translSds.slice(0)}getRotationalSpringDampers(){return this._rotSds.slice(0)}getTranslationalLimitMotors(){return this._translLms.slice(0)}getRotationalLimitMotors(){return this._rotLms.slice(0)}getAngles(){return new s.common.Vec3(this._angleX,this._angleY,this._angleZ)}getTranslations(){return new s.common.Vec3(this.translationX,this.translationY,this.translationZ)}},s.dynamics.constraint.joint.GenericJointConfig=class extends s.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localBasis1=new s.common.Mat3,this.localBasis2=new s.common.Mat3;let t=[];t.push((new s.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),t.push((new s.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),t.push((new s.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),this.translationalLimitMotors=t;let i=[];i.push((new s.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),i.push((new s.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),i.push((new s.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),this.rotationalLimitMotors=i,this.translationalSpringDampers=[new s.dynamics.constraint.joint.SpringDamper,new s.dynamics.constraint.joint.SpringDamper,new s.dynamics.constraint.joint.SpringDamper],this.rotationalSpringDampers=[new s.dynamics.constraint.joint.SpringDamper,new s.dynamics.constraint.joint.SpringDamper,new s.dynamics.constraint.joint.SpringDamper]}init(t,i,s,a,o){this._init(t,i,s);let n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T,C,j,R,E,q,N,D,F,H,G,W,O,J,U,Q,K,$,tt,it,st,at,ot,nt=t._transform,et=i._transform;n=a.e00,e=a.e01,r=a.e02,_=a.e10,l=a.e11,h=a.e12,c=a.e20,m=a.e21,b=a.e22,p=o.e00,x=o.e01,f=o.e02,u=o.e10,y=o.e11,v=o.e12,d=o.e20,g=o.e21,X=o.e22,q=nt._rotation00*n+nt._rotation10*_+nt._rotation20*c,N=nt._rotation00*e+nt._rotation10*l+nt._rotation20*m,D=nt._rotation00*r+nt._rotation10*h+nt._rotation20*b,F=nt._rotation01*n+nt._rotation11*_+nt._rotation21*c,H=nt._rotation01*e+nt._rotation11*l+nt._rotation21*m,G=nt._rotation01*r+nt._rotation11*h+nt._rotation21*b,W=nt._rotation02*n+nt._rotation12*_+nt._rotation22*c,O=nt._rotation02*e+nt._rotation12*l+nt._rotation22*m,J=nt._rotation02*r+nt._rotation12*h+nt._rotation22*b,Y=q,z=N,Z=D,M=F,I=H,V=G,L=W,w=O,k=J,U=et._rotation00*p+et._rotation10*u+et._rotation20*d,Q=et._rotation00*x+et._rotation10*y+et._rotation20*g,K=et._rotation00*f+et._rotation10*v+et._rotation20*X,$=et._rotation01*p+et._rotation11*u+et._rotation21*d,tt=et._rotation01*x+et._rotation11*y+et._rotation21*g,it=et._rotation01*f+et._rotation11*v+et._rotation21*X,st=et._rotation02*p+et._rotation12*u+et._rotation22*d,at=et._rotation02*x+et._rotation12*y+et._rotation22*g,ot=et._rotation02*f+et._rotation12*v+et._rotation22*X,A=U,B=Q,P=K,S=$,T=tt,C=it,j=st,R=at,E=ot;let rt=this.localBasis1;rt.e00=Y,rt.e01=z,rt.e02=Z,rt.e10=M,rt.e11=I,rt.e12=V,rt.e20=L,rt.e21=w,rt.e22=k;let _t=this.localBasis2;return _t.e00=A,_t.e01=B,_t.e02=P,_t.e10=S,_t.e11=T,_t.e12=C,_t.e20=j,_t.e21=R,_t.e22=E,this}},s.dynamics.constraint.joint.JointImpulse=class{constructor(){this.impulse=0,this.impulseM=0,this.impulseP=0}},s.dynamics.constraint.joint.JointLink=class{constructor(t){this._joint=t}getContact(){return this._joint}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}},s.dynamics.constraint.joint.JointMacro=class{},s.dynamics.constraint.joint.JointType=class{},s.dynamics.constraint.joint.PrismaticJoint=class extends s.dynamics.constraint.joint.Joint{constructor(t){super(t,s.dynamics.constraint.joint.JointType.PRISMATIC);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let a=t.localAxis2;this._localBasisX2X=a.x,this._localBasisX2Y=a.y,this._localBasisX2Z=a.z,this.buildLocalBasesFromX(),this._basis=new s.dynamics.constraint.joint.BasisTracker(this),this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this.angularErrorX=0,this.angularErrorY=0,this.angularErrorZ=0,this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()}getInfo(t,i,s){let a,o=this.getErp(i,s),n=this.linearErrorY*o,e=this.linearErrorZ*o,r=this.angularErrorX*o,_=this.angularErrorY*o,l=this.angularErrorZ*o;if(this._sd.frequency<=0||!s){let o=this._impulses[0],n=t.rows[t.numRows++],e=n.jacobian;e.lin1X=0,e.lin1Y=0,e.lin1Z=0,e.lin2X=0,e.lin2Y=0,e.lin2Z=0,e.ang1X=0,e.ang1Y=0,e.ang1Z=0,e.ang2X=0,e.ang2Y=0,e.ang2Z=0,n.rhs=0,n.cfm=0,n.minImpulse=0,n.maxImpulse=0,n.motorSpeed=0,n.motorMaxImpulse=0,n.impulse=null,n.impulse=o,this.setSolverInfoRowLinear(n,this.translation,this._lm,1/(this._b1._invMass+this._b2._invMass),this._sd,i,s),a=n.jacobian,a.lin1X=this._basis.xX,a.lin1Y=this._basis.xY,a.lin1Z=this._basis.xZ,a.lin2X=this._basis.xX,a.lin2Y=this._basis.xY,a.lin2Z=this._basis.xZ,a.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,a.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,a.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,a.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,a.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,a.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}let h=this._impulses[1],c=t.rows[t.numRows++],m=c.jacobian;m.lin1X=0,m.lin1Y=0,m.lin1Z=0,m.lin2X=0,m.lin2Y=0,m.lin2Z=0,m.ang1X=0,m.ang1Y=0,m.ang1Z=0,m.ang2X=0,m.ang2Y=0,m.ang2Z=0,c.rhs=0,c.cfm=0,c.minImpulse=0,c.maxImpulse=0,c.motorSpeed=0,c.motorMaxImpulse=0,c.impulse=null,c.impulse=h,c.rhs=n,c.cfm=0,c.minImpulse=-Infinity,c.maxImpulse=Infinity,a=c.jacobian,a.lin1X=this._basis.yX,a.lin1Y=this._basis.yY,a.lin1Z=this._basis.yZ,a.lin2X=this._basis.yX,a.lin2Y=this._basis.yY,a.lin2Z=this._basis.yZ,a.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,a.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,a.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,a.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,a.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,a.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;let b=this._impulses[2],p=t.rows[t.numRows++],x=p.jacobian;x.lin1X=0,x.lin1Y=0,x.lin1Z=0,x.lin2X=0,x.lin2Y=0,x.lin2Z=0,x.ang1X=0,x.ang1Y=0,x.ang1Z=0,x.ang2X=0,x.ang2Y=0,x.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=b,p.rhs=e,p.cfm=0,p.minImpulse=-Infinity,p.maxImpulse=Infinity,a=p.jacobian,a.lin1X=this._basis.zX,a.lin1Y=this._basis.zY,a.lin1Z=this._basis.zZ,a.lin2X=this._basis.zX,a.lin2Y=this._basis.zY,a.lin2Z=this._basis.zZ,a.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,a.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,a.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,a.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,a.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,a.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX;let f=this._impulses[3],u=t.rows[t.numRows++],y=u.jacobian;y.lin1X=0,y.lin1Y=0,y.lin1Z=0,y.lin2X=0,y.lin2Y=0,y.lin2Z=0,y.ang1X=0,y.ang1Y=0,y.ang1Z=0,y.ang2X=0,y.ang2Y=0,y.ang2Z=0,u.rhs=0,u.cfm=0,u.minImpulse=0,u.maxImpulse=0,u.motorSpeed=0,u.motorMaxImpulse=0,u.impulse=null,u.impulse=f,u.rhs=r,u.cfm=0,u.minImpulse=-Infinity,u.maxImpulse=Infinity,a=u.jacobian,a.ang1X=1,a.ang1Y=0,a.ang1Z=0,a.ang2X=1,a.ang2Y=0,a.ang2Z=0;let v=this._impulses[4],d=t.rows[t.numRows++],g=d.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,d.rhs=0,d.cfm=0,d.minImpulse=0,d.maxImpulse=0,d.motorSpeed=0,d.motorMaxImpulse=0,d.impulse=null,d.impulse=v,d.rhs=_,d.cfm=0,d.minImpulse=-Infinity,d.maxImpulse=Infinity,a=d.jacobian,a.ang1X=0,a.ang1Y=1,a.ang1Z=0,a.ang2X=0,a.ang2Y=1,a.ang2Z=0;let X=this._impulses[5],Y=t.rows[t.numRows++],z=Y.jacobian;z.lin1X=0,z.lin1Y=0,z.lin1Z=0,z.lin2X=0,z.lin2Y=0,z.lin2Z=0,z.ang1X=0,z.ang1Y=0,z.ang1Z=0,z.ang2X=0,z.ang2Y=0,z.ang2Z=0,Y.rhs=0,Y.cfm=0,Y.minImpulse=0,Y.maxImpulse=0,Y.motorSpeed=0,Y.motorMaxImpulse=0,Y.impulse=null,Y.impulse=X,Y.rhs=l,Y.cfm=0,Y.minImpulse=-Infinity,Y.maxImpulse=Infinity,a=Y.jacobian,a.ang1X=0,a.ang1Y=0,a.ang1Z=1,a.ang2X=0,a.ang2Y=0,a.ang2Z=1}_syncAnchors(){super._syncAnchors();let t,i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T,C,j,R,E,q,N,D,F=this._basis,H=F.joint._b1._invMass,G=F.joint._b2._invMass,W=F.joint._basisX1X*F.joint._basisX2X+F.joint._basisX1Y*F.joint._basisX2Y+F.joint._basisX1Z*F.joint._basisX2Z;if(W<-.999999999){let o,n,e,r,_=F.joint._basisX1X,l=F.joint._basisX1Y,h=F.joint._basisX1Z,c=_*_,m=l*l,b=h*h;c<m?c<b?(r=1/Math.sqrt(m+b),o=0,n=h*r,e=-l*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),o=-h*r,n=0,e=_*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0),t=o,i=n,s=e,a=0}else{let o,n,e;o=F.joint._basisX1Y*F.joint._basisX2Z-F.joint._basisX1Z*F.joint._basisX2Y,n=F.joint._basisX1Z*F.joint._basisX2X-F.joint._basisX1X*F.joint._basisX2Z,e=F.joint._basisX1X*F.joint._basisX2Y-F.joint._basisX1Y*F.joint._basisX2X;let r=Math.sqrt(.5*(1+W));W=.5/r,o*=W,n*=W,e*=W,t=o,i=n,s=e,a=r}o=0,n=0,e=0,r=1,T=0,C=0,j=0,R=1,E=t,q=i,N=s,D=a;let O=T*E+C*q+j*N+R*D;if(O<0&&(O=-O,E=-E,q=-q,N=-N,D=-D),O>.999999){let t,i,s,a;t=E-T,i=q-C,s=N-j,a=D-R,E=T+t*(H/(H+G)),q=C+i*(H/(H+G)),N=j+s*(H/(H+G)),D=R+a*(H/(H+G));let o=E*E+q*q+N*N+D*D;o>1e-32&&(o=1/Math.sqrt(o)),_=E*o,l=q*o,h=N*o,c=D*o}else{let t=H/(H+G)*Math.acos(O);E+=T*-O,q+=C*-O,N+=j*-O,D+=R*-O;let i=E*E+q*q+N*N+D*D;i>1e-32&&(i=1/Math.sqrt(i)),E*=i,q*=i,N*=i,D*=i;let s=Math.sin(t),a=Math.cos(t);T*=a,C*=a,j*=a,R*=a,_=T+E*s,l=C+q*s,h=j+N*s,c=R+D*s}let J,U,Q,K=2*_,$=2*l,tt=2*h,it=_*K,st=l*$,at=h*tt,ot=_*$,nt=l*tt,et=_*tt,rt=c*K,_t=c*$,lt=c*tt;m=1-st-at,b=ot-lt,p=et+_t,x=ot+lt,f=1-it-at,u=nt-rt,y=et-_t,v=nt+rt,d=1-it-st,J=m*F.joint._basisX1X+b*F.joint._basisX1Y+p*F.joint._basisX1Z,U=x*F.joint._basisX1X+f*F.joint._basisX1Y+u*F.joint._basisX1Z,Q=y*F.joint._basisX1X+v*F.joint._basisX1Y+d*F.joint._basisX1Z,g=J,X=U,Y=Q,w=F.xX,k=F.xY,A=F.xZ,B=F.yX,P=F.yY,S=F.yZ;let ht=w*g+k*X+A*Y;if(ht<-.999999999){let t,i,s,a,o=w,n=k,e=A,r=o*o,m=n*n,b=e*e;r<m?r<b?(a=1/Math.sqrt(m+b),t=0,i=e*a,s=-n*a):(a=1/Math.sqrt(r+m),t=n*a,i=-o*a,s=0):m<b?(a=1/Math.sqrt(b+r),t=-e*a,i=0,s=o*a):(a=1/Math.sqrt(r+m),t=n*a,i=-o*a,s=0),_=t,l=i,h=s,c=0}else{let t,i,s;t=k*Y-A*X,i=A*g-w*Y,s=w*X-k*g;let a=Math.sqrt(.5*(1+ht));ht=.5/a,t*=ht,i*=ht,s*=ht,_=t,l=i,h=s,c=a}let ct,mt,bt,pt,xt,ft,ut,yt,vt,dt,gt,Xt,Yt,zt,Zt,Mt,It,Vt,Lt,wt,kt,At,Bt,Pt,St,Tt,Ct,jt,Rt,Et,qt,Nt,Dt,Ft,Ht,Gt,Wt,Ot,Jt,Ut,Qt,Kt,$t,ti=2*_,ii=2*l,si=2*h,ai=_*ti,oi=l*ii,ni=h*si,ei=_*ii,ri=l*si,_i=_*si,li=c*ti,hi=c*ii,ci=c*si;if(m=1-oi-ni,b=ei-ci,p=_i+hi,x=ei+ci,f=1-ai-ni,u=ri-li,y=_i-hi,v=ri+li,d=1-ai-oi,ct=m*B+b*P+p*S,mt=x*B+f*P+u*S,bt=y*B+v*P+d*S,z=ct,Z=mt,M=bt,I=X*M-Y*Z,V=Y*z-g*M,L=g*Z-X*z,I*I+V*V+L*L>1e-6){let t=I*I+V*V+L*L;t>0&&(t=1/Math.sqrt(t)),I*=t,V*=t,L*=t}else{let t,i=g,s=X,a=Y,o=i*i,n=s*s,e=a*a;o<n?o<e?(t=1/Math.sqrt(n+e),I=0,V=a*t,L=-s*t):(t=1/Math.sqrt(o+n),I=s*t,V=-i*t,L=0):n<e?(t=1/Math.sqrt(e+o),I=-a*t,V=0,L=i*t):(t=1/Math.sqrt(o+n),I=s*t,V=-i*t,L=0)}z=V*Y-L*X,Z=L*g-I*Y,M=I*X-V*g,F.xX=g,F.xY=X,F.xZ=Y,F.yX=z,F.yY=Z,F.yZ=M,F.zX=I,F.zY=V,F.zZ=L,pt=this._basisX1X,xt=this._basisY1X,ft=this._basisZ1X,ut=this._basisX1Y,yt=this._basisY1Y,vt=this._basisZ1Y,dt=this._basisX1Z,gt=this._basisY1Z,Xt=this._basisZ1Z,Yt=this._basisX2X,zt=this._basisY2X,Zt=this._basisZ2X,Mt=this._basisX2Y,It=this._basisY2Y,Vt=this._basisZ2Y,Lt=this._basisX2Z,wt=this._basisY2Z,kt=this._basisZ2Z,qt=Yt*pt+zt*xt+Zt*ft,Nt=Yt*ut+zt*yt+Zt*vt,Dt=Yt*dt+zt*gt+Zt*Xt,Ft=Mt*pt+It*xt+Vt*ft,Ht=Mt*ut+It*yt+Vt*vt,Gt=Mt*dt+It*gt+Vt*Xt,Wt=Lt*pt+wt*xt+kt*ft,Ot=Lt*ut+wt*yt+kt*vt,Jt=Lt*dt+wt*gt+kt*Xt,At=qt,Bt=Nt,Pt=Dt,St=Ft,Tt=Ht,Ct=Gt,jt=Wt,Rt=Ot,Et=Jt;let mi,bi=At,pi=Tt,xi=Et,fi=bi+pi+xi;fi>0?(mi=Math.sqrt(fi+1),$t=.5*mi,mi=.5/mi,Ut=(Rt-Ct)*mi,Qt=(Pt-jt)*mi,Kt=(St-Bt)*mi):bi>pi?bi>xi?(mi=Math.sqrt(bi-pi-xi+1),Ut=.5*mi,mi=.5/mi,Qt=(Bt+St)*mi,Kt=(Pt+jt)*mi,$t=(Rt-Ct)*mi):(mi=Math.sqrt(xi-bi-pi+1),Kt=.5*mi,mi=.5/mi,Ut=(Pt+jt)*mi,Qt=(Ct+Rt)*mi,$t=(St-Bt)*mi):pi>xi?(mi=Math.sqrt(pi-xi-bi+1),Qt=.5*mi,mi=.5/mi,Ut=(Bt+St)*mi,Kt=(Ct+Rt)*mi,$t=(Pt-jt)*mi):(mi=Math.sqrt(xi-bi-pi+1),Kt=.5*mi,mi=.5/mi,Ut=(Pt+jt)*mi,Qt=(Ct+Rt)*mi,$t=(St-Bt)*mi);let ui=$t,yi=2*(ui<=-1?3.14159265358979:ui>=1?0:Math.acos(ui));this.angularErrorX=Ut,this.angularErrorY=Qt,this.angularErrorZ=Kt;let vi,di,gi,Xi=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ;Xi>0&&(Xi=1/Math.sqrt(Xi)),this.angularErrorX*=Xi,this.angularErrorY*=Xi,this.angularErrorZ*=Xi,this.angularErrorX*=yi,this.angularErrorY*=yi,this.angularErrorZ*=yi,vi=this._anchor2X-this._anchor1X,di=this._anchor2Y-this._anchor1Y,gi=this._anchor2Z-this._anchor1Z,this.translation=vi*this._basis.xX+di*this._basis.xY+gi*this._basis.xZ,this.linearErrorY=vi*this._basis.yX+di*this._basis.yY+gi*this._basis.yZ,this.linearErrorZ=vi*this._basis.zX+di*this._basis.zY+gi*this._basis.zZ}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new s.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new s.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new s.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new s.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getTranslation(){return this.translation}},s.dynamics.constraint.joint.PrismaticJointConfig=class extends s.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new s.common.Vec3(1,0,0),this.localAxis2=new s.common.Vec3(1,0,0),this.limitMotor=new s.dynamics.constraint.joint.TranslationalLimitMotor,this.springDamper=new s.dynamics.constraint.joint.SpringDamper}init(t,i,s,a){this._init(t,i,s);let o,n,e,r,_,l,h=this.localAxis1;o=a.x,n=a.y,e=a.z,r=t._transform._rotation00*o+t._transform._rotation10*n+t._transform._rotation20*e,_=t._transform._rotation01*o+t._transform._rotation11*n+t._transform._rotation21*e,l=t._transform._rotation02*o+t._transform._rotation12*n+t._transform._rotation22*e,o=r,n=_,e=l,h.x=o,h.y=n,h.z=e;let c,m,b,p,x,f,u=this.localAxis2;return c=a.x,m=a.y,b=a.z,p=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*b,x=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*b,f=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*b,c=p,m=x,b=f,u.x=c,u.y=m,u.z=b,this}},s.dynamics.constraint.joint.RagdollJoint=class extends s.dynamics.constraint.joint.Joint{constructor(t){super(t,s.dynamics.constraint.joint.JointType.RAGDOLL);let i=t.localTwistAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let a=t.localSwingAxis1;this._localBasisY1X=a.x,this._localBasisY1Y=a.y,this._localBasisY1Z=a.z;let o=t.localTwistAxis2;this._localBasisX2X=o.x,this._localBasisX2Y=o.y,this._localBasisX2Z=o.z,this.buildLocalBasesFromXY1X2(),this._twistSd=t.twistSpringDamper.clone(),this._twistLm=t.twistLimitMotor.clone(),this._swingSd=t.swingSpringDamper.clone(),this._maxSwingAngle1=t.maxSwingAngle1,this._maxSwingAngle2=t.maxSwingAngle2,this._maxSwingAngle1<s.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle1=s.common.Setting.minRagdollMaxSwingAngle),this._maxSwingAngle2<s.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle2=s.common.Setting.minRagdollMaxSwingAngle),this.dummySwingLm=new s.dynamics.constraint.joint.RotationalLimitMotor,this.dummySwingLm.lowerLimit=-1,this.dummySwingLm.upperLimit=0,this._swingAngle=0,this._twistAngle=0,this.swingError=0,this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.twistAxisX=0,this.twistAxisY=0,this.twistAxisZ=0}getInfo(t,i,s){let a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z=this.getErp(i,s);a=this.linearErrorX*z,o=this.linearErrorY*z,n=this.linearErrorZ*z,e=0,r=-this._relativeAnchor1Z,_=this._relativeAnchor1Y,l=this._relativeAnchor1Z,h=0,c=-this._relativeAnchor1X,m=-this._relativeAnchor1Y,b=this._relativeAnchor1X,p=0,x=0,f=-this._relativeAnchor2Z,u=this._relativeAnchor2Y,y=this._relativeAnchor2Z,v=0,d=-this._relativeAnchor2X,g=-this._relativeAnchor2Y,X=this._relativeAnchor2X,Y=0,e=-e,r=-r,_=-_,l=-l,h=-h,c=-c,m=-m,b=-b,p=-p,x=-x,f=-f,u=-u,y=-y,v=-v,d=-d,g=-g,X=-X,Y=-Y;let Z=this.computeEffectiveInertiaMoment(this.swingAxisX,this.swingAxisY,this.swingAxisZ),M=this.computeEffectiveInertiaMoment(this._basisX2X,this._basisX2Y,this._basisX2Z),I=this._impulses[0],V=t.rows[t.numRows++],L=V.jacobian;L.lin1X=0,L.lin1Y=0,L.lin1Z=0,L.lin2X=0,L.lin2Y=0,L.lin2Z=0,L.ang1X=0,L.ang1Y=0,L.ang1Z=0,L.ang2X=0,L.ang2Y=0,L.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=I,V.rhs=a,V.cfm=0,V.minImpulse=-Infinity,V.maxImpulse=Infinity;let w=V.jacobian;w.lin1X=1,w.lin1Y=0,w.lin1Z=0,w.lin2X=1,w.lin2Y=0,w.lin2Z=0,w.ang1X=e,w.ang1Y=r,w.ang1Z=_,w.ang2X=x,w.ang2Y=f,w.ang2Z=u;let k=this._impulses[1],A=t.rows[t.numRows++],B=A.jacobian;B.lin1X=0,B.lin1Y=0,B.lin1Z=0,B.lin2X=0,B.lin2Y=0,B.lin2Z=0,B.ang1X=0,B.ang1Y=0,B.ang1Z=0,B.ang2X=0,B.ang2Y=0,B.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=k,A.rhs=o,A.cfm=0,A.minImpulse=-Infinity,A.maxImpulse=Infinity,w=A.jacobian,w.lin1X=0,w.lin1Y=1,w.lin1Z=0,w.lin2X=0,w.lin2Y=1,w.lin2Z=0,w.ang1X=l,w.ang1Y=h,w.ang1Z=c,w.ang2X=y,w.ang2Y=v,w.ang2Z=d;let P=this._impulses[2],S=t.rows[t.numRows++],T=S.jacobian;if(T.lin1X=0,T.lin1Y=0,T.lin1Z=0,T.lin2X=0,T.lin2Y=0,T.lin2Z=0,T.ang1X=0,T.ang1Y=0,T.ang1Z=0,T.ang2X=0,T.ang2Y=0,T.ang2Z=0,S.rhs=0,S.cfm=0,S.minImpulse=0,S.maxImpulse=0,S.motorSpeed=0,S.motorMaxImpulse=0,S.impulse=null,S.impulse=P,S.rhs=n,S.cfm=0,S.minImpulse=-Infinity,S.maxImpulse=Infinity,w=S.jacobian,w.lin1X=0,w.lin1Y=0,w.lin1Z=1,w.lin2X=0,w.lin2Y=0,w.lin2Z=1,w.ang1X=m,w.ang1Y=b,w.ang1Z=p,w.ang2X=g,w.ang2Y=X,w.ang2Z=Y,this.swingError>0&&(this._swingSd.frequency<=0||!s)){let a=this._impulses[3],o=t.rows[t.numRows++],n=o.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,o.rhs=0,o.cfm=0,o.minImpulse=0,o.maxImpulse=0,o.motorSpeed=0,o.motorMaxImpulse=0,o.impulse=null,o.impulse=a,this.setSolverInfoRowAngular(o,this.swingError,this.dummySwingLm,Z,this._swingSd,i,s),w=o.jacobian,w.ang1X=this.swingAxisX,w.ang1Y=this.swingAxisY,w.ang1Z=this.swingAxisZ,w.ang2X=this.swingAxisX,w.ang2Y=this.swingAxisY,w.ang2Z=this.swingAxisZ}if(this._twistSd.frequency<=0||!s){let a=this._impulses[4],o=t.rows[t.numRows++],n=o.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,o.rhs=0,o.cfm=0,o.minImpulse=0,o.maxImpulse=0,o.motorSpeed=0,o.motorMaxImpulse=0,o.impulse=null,o.impulse=a,this.setSolverInfoRowAngular(o,this._twistAngle,this._twistLm,M,this._twistSd,i,s),w=o.jacobian,w.ang1X=this.twistAxisX,w.ang1Y=this.twistAxisY,w.ang1Z=this.twistAxisZ,w.ang2X=this.twistAxisX,w.ang2Y=this.twistAxisY,w.ang2Z=this.twistAxisZ}}_syncAnchors(){let t,i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w;super._syncAnchors(),t=this._basisX1X,i=this._basisX1Y,s=this._basisX1Z,a=this._basisX2X,o=this._basisX2Y,n=this._basisX2Z,e=this._basisX1X,r=this._basisY1X,_=this._basisZ1X,l=this._basisX1Y,h=this._basisY1Y,c=this._basisZ1Y,m=this._basisX1Z,b=this._basisY1Z,p=this._basisZ1Z;let k=t*a+i*o+s*n;if(k<-.999999999){let a,o,n,e,r=t,_=i,l=s,h=r*r,c=_*_,m=l*l;h<c?h<m?(e=1/Math.sqrt(c+m),a=0,o=l*e,n=-_*e):(e=1/Math.sqrt(h+c),a=_*e,o=-r*e,n=0):c<m?(e=1/Math.sqrt(m+h),a=-l*e,o=0,n=r*e):(e=1/Math.sqrt(h+c),a=_*e,o=-r*e,n=0),x=a,f=o,u=n,y=0}else{let e,r,_;e=i*n-s*o,r=s*a-t*n,_=t*o-i*a;let l=Math.sqrt(.5*(1+k));k=.5/l,e*=k,r*=k,_*=k,x=e,f=r,u=_,y=l}let A,B,P,S,T,C,j=2*x,R=2*f,E=2*u,q=x*j,N=f*R,D=u*E,F=x*R,H=f*E,G=x*E,W=y*j,O=y*R,J=y*E;v=1-N-D,d=F-J,g=G+O,X=F+J,Y=1-q-D,z=H-W,Z=G-O,M=H+W,I=1-q-N,this._swingAngle=2*(y<=-1?3.14159265358979:y>=1?0:Math.acos(y)),V=x,L=f,w=u,S=v*this._basisY2X+X*this._basisY2Y+Z*this._basisY2Z,T=d*this._basisY2X+Y*this._basisY2Y+M*this._basisY2Z,C=g*this._basisY2X+z*this._basisY2Y+I*this._basisY2Z,A=S,B=T,P=C,this._twistAngle=Math.atan2(this._basisZ1X*A+this._basisZ1Y*B+this._basisZ1Z*P,this._basisY1X*A+this._basisY1Y*B+this._basisY1Z*P),this.twistAxisX=this._basisX1X+this._basisX2X,this.twistAxisY=this._basisX1Y+this._basisX2Y,this.twistAxisZ=this._basisX1Z+this._basisX2Z;let U=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;U>0&&(U=1/Math.sqrt(U)),this.twistAxisX*=U,this.twistAxisY*=U,this.twistAxisZ*=U;let Q,K,$=Math.sqrt(V*V+L*L+w*w);$>0&&($=1/$),V*=$*this._swingAngle,L*=$*this._swingAngle,w*=$*this._swingAngle,Q=r*V+h*L+b*w,K=_*V+c*L+p*w,L=Q,w=K;let tt=L,it=w,st=this._maxSwingAngle1,at=this._maxSwingAngle2,ot=1/(st*st),nt=1/(at*at),et=tt*tt*ot+it*it*nt;if(0==et)this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.swingError=0;else{let t=Math.sqrt(1/et),i=tt*t,s=it*t,a=i*ot,o=s*nt;$=1/Math.sqrt(a*a+o*o),a*=$,o*=$;let n=(tt-i)*a+(it-s)*o;if(n>0){let t,i,s,x,f,u;this.swingError=n,this.swingAxisX=0,this.swingAxisY=a,this.swingAxisZ=o,t=e*this.swingAxisX+r*this.swingAxisY+_*this.swingAxisZ,i=l*this.swingAxisX+h*this.swingAxisY+c*this.swingAxisZ,s=m*this.swingAxisX+b*this.swingAxisY+p*this.swingAxisZ,this.swingAxisX=t,this.swingAxisY=i,this.swingAxisZ=s,x=v*this.swingAxisX+d*this.swingAxisY+g*this.swingAxisZ,f=X*this.swingAxisX+Y*this.swingAxisY+z*this.swingAxisZ,u=Z*this.swingAxisX+M*this.swingAxisY+I*this.swingAxisZ,this.swingAxisX=x,this.swingAxisY=f,this.swingAxisZ=u}else this.swingError=0}this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new s.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new s.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new s.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new s.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTwistSpringDamper(){return this._twistSd}getTwistLimitMotor(){return this._twistLm}getSwingSpringDamper(){return this._swingSd}getSwingAxis(){let t=new s.common.Vec3;return t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ,t}getSwingAxisTo(t){t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ}getSwingAngle(){return this._swingAngle}getTwistAngle(){return this._twistAngle}},s.dynamics.constraint.joint.RagdollJointConfig=class extends s.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localTwistAxis1=new s.common.Vec3(1,0,0),this.localTwistAxis2=new s.common.Vec3(1,0,0),this.localSwingAxis1=new s.common.Vec3(0,1,0),this.twistSpringDamper=new s.dynamics.constraint.joint.SpringDamper,this.swingSpringDamper=new s.dynamics.constraint.joint.SpringDamper,this.twistLimitMotor=new s.dynamics.constraint.joint.RotationalLimitMotor,this.maxSwingAngle1=3.14159265358979,this.maxSwingAngle2=3.14159265358979}init(t,i,s,a,o){this._init(t,i,s);let n,e,r,_,l,h,c=this.localTwistAxis1;n=a.x,e=a.y,r=a.z,_=t._transform._rotation00*n+t._transform._rotation10*e+t._transform._rotation20*r,l=t._transform._rotation01*n+t._transform._rotation11*e+t._transform._rotation21*r,h=t._transform._rotation02*n+t._transform._rotation12*e+t._transform._rotation22*r,n=_,e=l,r=h,c.x=n,c.y=e,c.z=r;let m,b,p,x,f,u,y=this.localTwistAxis2;m=a.x,b=a.y,p=a.z,x=i._transform._rotation00*m+i._transform._rotation10*b+i._transform._rotation20*p,f=i._transform._rotation01*m+i._transform._rotation11*b+i._transform._rotation21*p,u=i._transform._rotation02*m+i._transform._rotation12*b+i._transform._rotation22*p,m=x,b=f,p=u,y.x=m,y.y=b,y.z=p;let v,d,g,X,Y,z,Z=this.localSwingAxis1;return v=o.x,d=o.y,g=o.z,X=t._transform._rotation00*v+t._transform._rotation10*d+t._transform._rotation20*g,Y=t._transform._rotation01*v+t._transform._rotation11*d+t._transform._rotation21*g,z=t._transform._rotation02*v+t._transform._rotation12*d+t._transform._rotation22*g,v=X,d=Y,g=z,Z.x=v,Z.y=d,Z.z=g,this}},s.dynamics.constraint.joint.RevoluteJoint=class extends s.dynamics.constraint.joint.Joint{constructor(t){super(t,1);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let a=t.localAxis2;this._localBasisX2X=a.x,this._localBasisX2Y=a.y,this._localBasisX2Z=a.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this._basis=new s.dynamics.constraint.joint.BasisTracker(this),this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()}getInfo(t,i,s){let a,o,n,e=this.getErp(i,s);a=this.linearErrorX*e,o=this.linearErrorY*e,n=this.linearErrorZ*e;let r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z=this.angularErrorY*e,M=this.angularErrorZ*e;r=0,_=-this._relativeAnchor1Z,l=this._relativeAnchor1Y,h=this._relativeAnchor1Z,c=0,m=-this._relativeAnchor1X,b=-this._relativeAnchor1Y,p=this._relativeAnchor1X,x=0,f=0,u=-this._relativeAnchor2Z,y=this._relativeAnchor2Y,v=this._relativeAnchor2Z,d=0,g=-this._relativeAnchor2X,X=-this._relativeAnchor2Y,Y=this._relativeAnchor2X,z=0,r=-r,_=-_,l=-l,h=-h,c=-c,m=-m,b=-b,p=-p,x=-x,f=-f,u=-u,y=-y,v=-v,d=-d,g=-g,X=-X,Y=-Y,z=-z;let I=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ),V=this._impulses[0],L=t.rows[t.numRows++],w=L.jacobian;w.lin1X=0,w.lin1Y=0,w.lin1Z=0,w.lin2X=0,w.lin2Y=0,w.lin2Z=0,w.ang1X=0,w.ang1Y=0,w.ang1Z=0,w.ang2X=0,w.ang2Y=0,w.ang2Z=0,L.rhs=0,L.cfm=0,L.minImpulse=0,L.maxImpulse=0,L.motorSpeed=0,L.motorMaxImpulse=0,L.impulse=null,L.impulse=V,L.rhs=a,L.cfm=0,L.minImpulse=-Infinity,L.maxImpulse=Infinity;let k=L.jacobian;k.lin1X=1,k.lin1Y=0,k.lin1Z=0,k.lin2X=1,k.lin2Y=0,k.lin2Z=0,k.ang1X=r,k.ang1Y=_,k.ang1Z=l,k.ang2X=f,k.ang2Y=u,k.ang2Z=y;let A=this._impulses[1],B=t.rows[t.numRows++],P=B.jacobian;P.lin1X=0,P.lin1Y=0,P.lin1Z=0,P.lin2X=0,P.lin2Y=0,P.lin2Z=0,P.ang1X=0,P.ang1Y=0,P.ang1Z=0,P.ang2X=0,P.ang2Y=0,P.ang2Z=0,B.rhs=0,B.cfm=0,B.minImpulse=0,B.maxImpulse=0,B.motorSpeed=0,B.motorMaxImpulse=0,B.impulse=null,B.impulse=A,B.rhs=o,B.cfm=0,B.minImpulse=-Infinity,B.maxImpulse=Infinity,k=B.jacobian,k.lin1X=0,k.lin1Y=1,k.lin1Z=0,k.lin2X=0,k.lin2Y=1,k.lin2Z=0,k.ang1X=h,k.ang1Y=c,k.ang1Z=m,k.ang2X=v,k.ang2Y=d,k.ang2Z=g;let S=this._impulses[2],T=t.rows[t.numRows++],C=T.jacobian;if(C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,T.rhs=0,T.cfm=0,T.minImpulse=0,T.maxImpulse=0,T.motorSpeed=0,T.motorMaxImpulse=0,T.impulse=null,T.impulse=S,T.rhs=n,T.cfm=0,T.minImpulse=-Infinity,T.maxImpulse=Infinity,k=T.jacobian,k.lin1X=0,k.lin1Y=0,k.lin1Z=1,k.lin2X=0,k.lin2Y=0,k.lin2Z=1,k.ang1X=b,k.ang1Y=p,k.ang1Z=x,k.ang2X=X,k.ang2Y=Y,k.ang2Z=z,this._sd.frequency<=0||!s){let a=this._impulses[3],o=t.rows[t.numRows++],n=o.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,o.rhs=0,o.cfm=0,o.minImpulse=0,o.maxImpulse=0,o.motorSpeed=0,o.motorMaxImpulse=0,o.impulse=null,o.impulse=a,this.setSolverInfoRowAngular(o,this.angle,this._lm,I,this._sd,i,s),k=o.jacobian,k.ang1X=this._basis.xX,k.ang1Y=this._basis.xY,k.ang1Z=this._basis.xZ,k.ang2X=this._basis.xX,k.ang2Y=this._basis.xY,k.ang2Z=this._basis.xZ}let j=this._impulses[4],R=t.rows[t.numRows++],E=R.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=j,R.rhs=Z,R.cfm=0,R.minImpulse=-Infinity,R.maxImpulse=Infinity,k=R.jacobian,k.ang1X=this._basis.yX,k.ang1Y=this._basis.yY,k.ang1Z=this._basis.yZ,k.ang2X=this._basis.yX,k.ang2Y=this._basis.yY,k.ang2Z=this._basis.yZ;let q=this._impulses[5],N=t.rows[t.numRows++],D=N.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,N.rhs=0,N.cfm=0,N.minImpulse=0,N.maxImpulse=0,N.motorSpeed=0,N.motorMaxImpulse=0,N.impulse=null,N.impulse=q,N.rhs=M,N.cfm=0,N.minImpulse=-Infinity,N.maxImpulse=Infinity,k=N.jacobian,k.ang1X=this._basis.zX,k.ang1Y=this._basis.zY,k.ang1Z=this._basis.zZ,k.ang2X=this._basis.zX,k.ang2Y=this._basis.zY,k.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();let t,i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T,C,j,R,E,q,N,D,F=this._basis,H=F.joint._b1._invMass,G=F.joint._b2._invMass,W=F.joint._basisX1X*F.joint._basisX2X+F.joint._basisX1Y*F.joint._basisX2Y+F.joint._basisX1Z*F.joint._basisX2Z;if(W<-.999999999){let o,n,e,r,_=F.joint._basisX1X,l=F.joint._basisX1Y,h=F.joint._basisX1Z,c=_*_,m=l*l,b=h*h;c<m?c<b?(r=1/Math.sqrt(m+b),o=0,n=h*r,e=-l*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),o=-h*r,n=0,e=_*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0),t=o,i=n,s=e,a=0}else{let o,n,e;o=F.joint._basisX1Y*F.joint._basisX2Z-F.joint._basisX1Z*F.joint._basisX2Y,n=F.joint._basisX1Z*F.joint._basisX2X-F.joint._basisX1X*F.joint._basisX2Z,e=F.joint._basisX1X*F.joint._basisX2Y-F.joint._basisX1Y*F.joint._basisX2X;let r=Math.sqrt(.5*(1+W));W=.5/r,o*=W,n*=W,e*=W,t=o,i=n,s=e,a=r}o=0,n=0,e=0,r=1,T=0,C=0,j=0,R=1,E=t,q=i,N=s,D=a;let O=T*E+C*q+j*N+R*D;if(O<0&&(O=-O,E=-E,q=-q,N=-N,D=-D),O>.999999){let t,i,s,a;t=E-T,i=q-C,s=N-j,a=D-R,E=T+t*(H/(H+G)),q=C+i*(H/(H+G)),N=j+s*(H/(H+G)),D=R+a*(H/(H+G));let o=E*E+q*q+N*N+D*D;o>1e-32&&(o=1/Math.sqrt(o)),_=E*o,l=q*o,h=N*o,c=D*o}else{let t=H/(H+G)*Math.acos(O);E+=T*-O,q+=C*-O,N+=j*-O,D+=R*-O;let i=E*E+q*q+N*N+D*D;i>1e-32&&(i=1/Math.sqrt(i)),E*=i,q*=i,N*=i,D*=i;let s=Math.sin(t),a=Math.cos(t);T*=a,C*=a,j*=a,R*=a,_=T+E*s,l=C+q*s,h=j+N*s,c=R+D*s}let J,U,Q,K=2*_,$=2*l,tt=2*h,it=_*K,st=l*$,at=h*tt,ot=_*$,nt=l*tt,et=_*tt,rt=c*K,_t=c*$,lt=c*tt;m=1-st-at,b=ot-lt,p=et+_t,x=ot+lt,f=1-it-at,u=nt-rt,y=et-_t,v=nt+rt,d=1-it-st,J=m*F.joint._basisX1X+b*F.joint._basisX1Y+p*F.joint._basisX1Z,U=x*F.joint._basisX1X+f*F.joint._basisX1Y+u*F.joint._basisX1Z,Q=y*F.joint._basisX1X+v*F.joint._basisX1Y+d*F.joint._basisX1Z,g=J,X=U,Y=Q,w=F.xX,k=F.xY,A=F.xZ,B=F.yX,P=F.yY,S=F.yZ;let ht=w*g+k*X+A*Y;if(ht<-.999999999){let t,i,s,a,o=w,n=k,e=A,r=o*o,m=n*n,b=e*e;r<m?r<b?(a=1/Math.sqrt(m+b),t=0,i=e*a,s=-n*a):(a=1/Math.sqrt(r+m),t=n*a,i=-o*a,s=0):m<b?(a=1/Math.sqrt(b+r),t=-e*a,i=0,s=o*a):(a=1/Math.sqrt(r+m),t=n*a,i=-o*a,s=0),_=t,l=i,h=s,c=0}else{let t,i,s;t=k*Y-A*X,i=A*g-w*Y,s=w*X-k*g;let a=Math.sqrt(.5*(1+ht));ht=.5/a,t*=ht,i*=ht,s*=ht,_=t,l=i,h=s,c=a}let ct,mt,bt,pt,xt,ft,ut=2*_,yt=2*l,vt=2*h,dt=_*ut,gt=l*yt,Xt=h*vt,Yt=_*yt,zt=l*vt,Zt=_*vt,Mt=c*ut,It=c*yt,Vt=c*vt;if(m=1-gt-Xt,b=Yt-Vt,p=Zt+It,x=Yt+Vt,f=1-dt-Xt,u=zt-Mt,y=Zt-It,v=zt+Mt,d=1-dt-gt,ct=m*B+b*P+p*S,mt=x*B+f*P+u*S,bt=y*B+v*P+d*S,z=ct,Z=mt,M=bt,I=X*M-Y*Z,V=Y*z-g*M,L=g*Z-X*z,I*I+V*V+L*L>1e-6){let t=I*I+V*V+L*L;t>0&&(t=1/Math.sqrt(t)),I*=t,V*=t,L*=t}else{let t,i=g,s=X,a=Y,o=i*i,n=s*s,e=a*a;o<n?o<e?(t=1/Math.sqrt(n+e),I=0,V=a*t,L=-s*t):(t=1/Math.sqrt(o+n),I=s*t,V=-i*t,L=0):n<e?(t=1/Math.sqrt(e+o),I=-a*t,V=0,L=i*t):(t=1/Math.sqrt(o+n),I=s*t,V=-i*t,L=0)}z=V*Y-L*X,Z=L*g-I*Y,M=I*X-V*g,F.xX=g,F.xY=X,F.xZ=Y,F.yX=z,F.yY=Z,F.yZ=M,F.zX=I,F.zY=V,F.zZ=L,pt=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,xt=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,ft=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;let Lt,wt,kt,At=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,Bt=At<=-1?3.14159265358979:At>=1?0:Math.acos(At),Pt=pt*pt+xt*xt+ft*ft;Pt>0&&(Pt=1/Math.sqrt(Pt)),pt*=Pt,xt*=Pt,ft*=Pt,pt*=Bt,xt*=Bt,ft*=Bt,this.angularErrorY=pt*this._basis.yX+xt*this._basis.yY+ft*this._basis.yZ,this.angularErrorZ=pt*this._basis.zX+xt*this._basis.zY+ft*this._basis.zZ,Lt=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,wt=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,kt=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,At=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=At<=-1?3.14159265358979:At>=1?0:Math.acos(At),Lt*this._basis.xX+wt*this._basis.xY+kt*this._basis.xZ<0&&(this.angle=-this.angle),this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new s.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new s.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new s.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new s.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getAngle(){return this.angle}},s.dynamics.constraint.joint.RevoluteJointConfig=class extends s.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new s.common.Vec3(1,0,0),this.localAxis2=new s.common.Vec3(1,0,0),this.springDamper=new s.dynamics.constraint.joint.SpringDamper,this.limitMotor=new s.dynamics.constraint.joint.RotationalLimitMotor}init(t,i,s,a){this._init(t,i,s);let o,n,e,r,_,l,h=this.localAxis1;o=a.x,n=a.y,e=a.z,r=t._transform._rotation00*o+t._transform._rotation10*n+t._transform._rotation20*e,_=t._transform._rotation01*o+t._transform._rotation11*n+t._transform._rotation21*e,l=t._transform._rotation02*o+t._transform._rotation12*n+t._transform._rotation22*e,o=r,n=_,e=l,h.x=o,h.y=n,h.z=e;let c,m,b,p,x,f,u=this.localAxis2;return c=a.x,m=a.y,b=a.z,p=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*b,x=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*b,f=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*b,c=p,m=x,b=f,u.x=c,u.y=m,u.z=b,this}},s.dynamics.constraint.joint.RotationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorTorque=0}setLimits(t,i){return this.lowerLimit=t,this.upperLimit=i,this}setMotor(t,i){return this.motorSpeed=t,this.motorTorque=i,this}clone(){let t=new s.dynamics.constraint.joint.RotationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorTorque=this.motorTorque,t}},s.dynamics.constraint.joint.SphericalJoint=class extends s.dynamics.constraint.joint.Joint{constructor(t){super(t,0),this._sd=t.springDamper.clone()}getInfo(t,i,a){if(this._sd.frequency>0&&a)return;let o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L;if(o=this._anchor2X-this._anchor1X,n=this._anchor2Y-this._anchor1Y,e=this._anchor2Z-this._anchor1Z,this._sd.frequency>0){let t=6.28318530717958*this._sd.frequency,a=this._sd.dampingRatio;a<s.common.Setting.minSpringDamperDampingRatio&&(a=s.common.Setting.minSpringDamperDampingRatio);let o=i.dt,n=2*a*t,e=t*t;this._sd.useSymplecticEuler?(r=1/(o*n),_=e/n):(r=1/(o*(o*e+n)),_=e/(o*e+n)),r*=this._b1._invMass+this._b2._invMass}else r=0,_=this.getErp(i,a);l=o*_,h=n*_,c=e*_,m=0,b=-this._relativeAnchor1Z,p=this._relativeAnchor1Y,x=this._relativeAnchor1Z,f=0,u=-this._relativeAnchor1X,y=-this._relativeAnchor1Y,v=this._relativeAnchor1X,d=0,g=0,X=-this._relativeAnchor2Z,Y=this._relativeAnchor2Y,z=this._relativeAnchor2Z,Z=0,M=-this._relativeAnchor2X,I=-this._relativeAnchor2Y,V=this._relativeAnchor2X,L=0,m=-m,b=-b,p=-p,x=-x,f=-f,u=-u,y=-y,v=-v,d=-d,g=-g,X=-X,Y=-Y,z=-z,Z=-Z,M=-M,I=-I,V=-V,L=-L;let w=this._impulses[0],k=t.rows[t.numRows++],A=k.jacobian;A.lin1X=0,A.lin1Y=0,A.lin1Z=0,A.lin2X=0,A.lin2Y=0,A.lin2Z=0,A.ang1X=0,A.ang1Y=0,A.ang1Z=0,A.ang2X=0,A.ang2Y=0,A.ang2Z=0,k.rhs=0,k.cfm=0,k.minImpulse=0,k.maxImpulse=0,k.motorSpeed=0,k.motorMaxImpulse=0,k.impulse=null,k.impulse=w,k.rhs=l,k.cfm=r,k.minImpulse=-Infinity,k.maxImpulse=Infinity;let B=k.jacobian;B.lin1X=1,B.lin1Y=0,B.lin1Z=0,B.lin2X=1,B.lin2Y=0,B.lin2Z=0,B.ang1X=m,B.ang1Y=b,B.ang1Z=p,B.ang2X=g,B.ang2Y=X,B.ang2Z=Y;let P=this._impulses[1],S=t.rows[t.numRows++],T=S.jacobian;T.lin1X=0,T.lin1Y=0,T.lin1Z=0,T.lin2X=0,T.lin2Y=0,T.lin2Z=0,T.ang1X=0,T.ang1Y=0,T.ang1Z=0,T.ang2X=0,T.ang2Y=0,T.ang2Z=0,S.rhs=0,S.cfm=0,S.minImpulse=0,S.maxImpulse=0,S.motorSpeed=0,S.motorMaxImpulse=0,S.impulse=null,S.impulse=P,S.rhs=h,S.cfm=r,S.minImpulse=-Infinity,S.maxImpulse=Infinity,B=S.jacobian,B.lin1X=0,B.lin1Y=1,B.lin1Z=0,B.lin2X=0,B.lin2Y=1,B.lin2Z=0,B.ang1X=x,B.ang1Y=f,B.ang1Z=u,B.ang2X=z,B.ang2Y=Z,B.ang2Z=M;let C=this._impulses[2],j=t.rows[t.numRows++],R=j.jacobian;R.lin1X=0,R.lin1Y=0,R.lin1Z=0,R.lin2X=0,R.lin2Y=0,R.lin2Z=0,R.ang1X=0,R.ang1Y=0,R.ang1Z=0,R.ang2X=0,R.ang2Y=0,R.ang2Z=0,j.rhs=0,j.cfm=0,j.minImpulse=0,j.maxImpulse=0,j.motorSpeed=0,j.motorMaxImpulse=0,j.impulse=null,j.impulse=C,j.rhs=c,j.cfm=r,j.minImpulse=-Infinity,j.maxImpulse=Infinity,B=j.jacobian,B.lin1X=0,B.lin1Y=0,B.lin1Z=1,B.lin2X=0,B.lin2Y=0,B.lin2Z=1,B.ang1X=y,B.ang1Y=v,B.ang1Z=d,B.ang2X=I,B.ang2Y=V,B.ang2Z=L}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getSpringDamper(){return this._sd}},s.dynamics.constraint.joint.SphericalJointConfig=class extends s.dynamics.constraint.joint.JointConfig{constructor(){super(),this.springDamper=new s.dynamics.constraint.joint.SpringDamper}init(t,i,s){return this._init(t,i,s),this}},s.dynamics.constraint.joint.SpringDamper=class{constructor(){this.frequency=0,this.dampingRatio=0,this.useSymplecticEuler=!1}setSpring(t,i){return this.frequency=t,this.dampingRatio=i,this}setSymplecticEuler(t){return this.useSymplecticEuler=t,this}clone(){let t=new s.dynamics.constraint.joint.SpringDamper;return t.frequency=this.frequency,t.dampingRatio=this.dampingRatio,t.useSymplecticEuler=this.useSymplecticEuler,t}},s.dynamics.constraint.joint.TranslationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorForce=0}setLimits(t,i){return this.lowerLimit=t,this.upperLimit=i,this}setMotor(t,i){return this.motorSpeed=t,this.motorForce=i,this}clone(){let t=new s.dynamics.constraint.joint.TranslationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorForce=this.motorForce,t}},s.dynamics.constraint.joint.UniversalJoint=class extends s.dynamics.constraint.joint.Joint{constructor(t){super(t,s.dynamics.constraint.joint.JointType.UNIVERSAL);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let a=t.localAxis2;this._localBasisZ2X=a.x,this._localBasisZ2Y=a.y,this._localBasisZ2Z=a.z,this.buildLocalBasesFromX1Z2(),this._angleX=0,this._angleY=0,this._angleZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._sd1=t.springDamper1.clone(),this._sd2=t.springDamper2.clone(),this._lm1=t.limitMotor1.clone(),this._lm2=t.limitMotor2.clone()}getInfo(t,i,s){let a,o,n,e=this.getErp(i,s);a=this.linearErrorX*e,o=this.linearErrorY*e,n=this.linearErrorZ*e;let r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z=this._angleY*e;r=0,_=-this._relativeAnchor1Z,l=this._relativeAnchor1Y,h=this._relativeAnchor1Z,c=0,m=-this._relativeAnchor1X,b=-this._relativeAnchor1Y,p=this._relativeAnchor1X,x=0,f=0,u=-this._relativeAnchor2Z,y=this._relativeAnchor2Y,v=this._relativeAnchor2Z,d=0,g=-this._relativeAnchor2X,X=-this._relativeAnchor2Y,Y=this._relativeAnchor2X,z=0,r=-r,_=-_,l=-l,h=-h,c=-c,m=-m,b=-b,p=-p,x=-x,f=-f,u=-u,y=-y,v=-v,d=-d,g=-g,X=-X,Y=-Y,z=-z;let M=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),I=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ),V=this._impulses[0],L=t.rows[t.numRows++],w=L.jacobian;w.lin1X=0,w.lin1Y=0,w.lin1Z=0,w.lin2X=0,w.lin2Y=0,w.lin2Z=0,w.ang1X=0,w.ang1Y=0,w.ang1Z=0,w.ang2X=0,w.ang2Y=0,w.ang2Z=0,L.rhs=0,L.cfm=0,L.minImpulse=0,L.maxImpulse=0,L.motorSpeed=0,L.motorMaxImpulse=0,L.impulse=null,L.impulse=V,L.rhs=a,L.cfm=0,L.minImpulse=-Infinity,L.maxImpulse=Infinity;let k=L.jacobian;k.lin1X=1,k.lin1Y=0,k.lin1Z=0,k.lin2X=1,k.lin2Y=0,k.lin2Z=0,k.ang1X=r,k.ang1Y=_,k.ang1Z=l,k.ang2X=f,k.ang2Y=u,k.ang2Z=y;let A=this._impulses[1],B=t.rows[t.numRows++],P=B.jacobian;P.lin1X=0,P.lin1Y=0,P.lin1Z=0,P.lin2X=0,P.lin2Y=0,P.lin2Z=0,P.ang1X=0,P.ang1Y=0,P.ang1Z=0,P.ang2X=0,P.ang2Y=0,P.ang2Z=0,B.rhs=0,B.cfm=0,B.minImpulse=0,B.maxImpulse=0,B.motorSpeed=0,B.motorMaxImpulse=0,B.impulse=null,B.impulse=A,B.rhs=o,B.cfm=0,B.minImpulse=-Infinity,B.maxImpulse=Infinity,k=B.jacobian,k.lin1X=0,k.lin1Y=1,k.lin1Z=0,k.lin2X=0,k.lin2Y=1,k.lin2Z=0,k.ang1X=h,k.ang1Y=c,k.ang1Z=m,k.ang2X=v,k.ang2Y=d,k.ang2Z=g;let S=this._impulses[2],T=t.rows[t.numRows++],C=T.jacobian;if(C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,T.rhs=0,T.cfm=0,T.minImpulse=0,T.maxImpulse=0,T.motorSpeed=0,T.motorMaxImpulse=0,T.impulse=null,T.impulse=S,T.rhs=n,T.cfm=0,T.minImpulse=-Infinity,T.maxImpulse=Infinity,k=T.jacobian,k.lin1X=0,k.lin1Y=0,k.lin1Z=1,k.lin2X=0,k.lin2Y=0,k.lin2Z=1,k.ang1X=b,k.ang1Y=p,k.ang1Z=x,k.ang2X=X,k.ang2Y=Y,k.ang2Z=z,!this.xSingular&&(this._sd1.frequency<=0||!s)){let a=this._impulses[3],o=t.rows[t.numRows++],n=o.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,o.rhs=0,o.cfm=0,o.minImpulse=0,o.maxImpulse=0,o.motorSpeed=0,o.motorMaxImpulse=0,o.impulse=null,o.impulse=a,this.setSolverInfoRowAngular(o,this._angleX,this._lm1,M,this._sd1,i,s),k=o.jacobian,k.ang1X=this._axisXX,k.ang1Y=this._axisXY,k.ang1Z=this._axisXZ,k.ang2X=this._axisXX,k.ang2Y=this._axisXY,k.ang2Z=this._axisXZ}if(!this.ySingular){let i=this._impulses[4],s=t.rows[t.numRows++],a=s.jacobian;a.lin1X=0,a.lin1Y=0,a.lin1Z=0,a.lin2X=0,a.lin2Y=0,a.lin2Z=0,a.ang1X=0,a.ang1Y=0,a.ang1Z=0,a.ang2X=0,a.ang2Y=0,a.ang2Z=0,s.rhs=0,s.cfm=0,s.minImpulse=0,s.maxImpulse=0,s.motorSpeed=0,s.motorMaxImpulse=0,s.impulse=null,s.impulse=i,s.rhs=Z,s.cfm=0,s.minImpulse=-Infinity,s.maxImpulse=Infinity,k=s.jacobian,k.ang1X=this._axisYX,k.ang1Y=this._axisYY,k.ang1Z=this._axisYZ,k.ang2X=this._axisYX,k.ang2Y=this._axisYY,k.ang2Z=this._axisYZ}if(!this.zSingular&&(this._sd2.frequency<=0||!s)){let a=this._impulses[5],o=t.rows[t.numRows++],n=o.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,o.rhs=0,o.cfm=0,o.minImpulse=0,o.maxImpulse=0,o.motorSpeed=0,o.motorMaxImpulse=0,o.impulse=null,o.impulse=a,this.setSolverInfoRowAngular(o,this._angleZ,this._lm2,I,this._sd2,i,s),k=o.jacobian,k.ang1X=this._axisZX,k.ang1Y=this._axisZY,k.ang1Z=this._axisZZ,k.ang2X=this._axisZX,k.ang2Y=this._axisZY,k.ang2Z=this._axisZZ}}_syncAnchors(){let t,i,s,a,o,n,e,r,_;super._syncAnchors(),t=this._basisX1X,i=this._basisX1Y,s=this._basisX1Z,e=this._basisZ2X,r=this._basisZ2Y,_=this._basisZ2Z,a=r*s-_*i,o=_*t-e*s,n=e*i-r*t,this._axisXX=o*_-n*r,this._axisXY=n*e-a*_,this._axisXZ=a*r-o*e,this._axisYX=a,this._axisYY=o,this._axisYZ=n,this._axisZX=i*n-s*o,this._axisZY=s*a-t*n,this._axisZZ=t*o-i*a;let l=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;l>0&&(l=1/Math.sqrt(l)),this._axisXX*=l,this._axisXY*=l,this._axisXZ*=l;let h=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;h>0&&(h=1/Math.sqrt(h)),this._axisYX*=h,this._axisYY*=h,this._axisYZ*=h;let c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T,C,j,R,E,q,N,D,F,H,G=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;G>0&&(G=1/Math.sqrt(G)),this._axisZX*=G,this._axisZY*=G,this._axisZZ*=G,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0,c=this._basisX1X,m=this._basisY1X,b=this._basisZ1X,p=this._basisX1Y,x=this._basisY1Y,f=this._basisZ1Y,u=this._basisX1Z,y=this._basisY1Z,v=this._basisZ1Z,d=this._basisX2X,g=this._basisY2X,X=this._basisZ2X,Y=this._basisX2Y,z=this._basisY2Y,Z=this._basisZ2Y,M=this._basisX2Z,I=this._basisY2Z,V=this._basisZ2Z,T=c*d+p*Y+u*M,C=c*g+p*z+u*I,j=c*X+p*Z+u*V,R=m*g+x*z+y*I,E=m*X+x*Z+y*V,q=b*g+f*z+v*I,N=b*X+f*Z+v*V,L=T,w=C,k=j,A=R,B=E,P=q,S=N;let W=k;if(W<=-1){let t=Math.atan2(P,A);D=.5*t,F=-1.570796326794895,H=.5*-t}else if(W>=1){let t=Math.atan2(P,A);D=.5*t,F=1.570796326794895,H=.5*t}else D=Math.atan2(-B,S),F=Math.asin(W),H=Math.atan2(-w,L);this._angleX=D,this._angleY=F,this._angleZ=H,this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new s.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new s.common.Vec3;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z}getLocalAxis1(){let t=new s.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new s.common.Vec3;return t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z}getSpringDamper1(){return this._sd1}getSpringDamper2(){return this._sd2}getLimitMotor1(){return this._lm1}getLimitMotor2(){return this._lm2}getAngle1(){return this._angleX}getAngle2(){return this._angleZ}},s.dynamics.constraint.joint.UniversalJointConfig=class extends s.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new s.common.Vec3(1,0,0),this.localAxis2=new s.common.Vec3(1,0,0),this.springDamper1=new s.dynamics.constraint.joint.SpringDamper,this.springDamper2=new s.dynamics.constraint.joint.SpringDamper,this.limitMotor1=new s.dynamics.constraint.joint.RotationalLimitMotor,this.limitMotor2=new s.dynamics.constraint.joint.RotationalLimitMotor}init(t,i,s,a,o){this._init(t,i,s);let n,e,r,_,l,h,c=this.localAxis1;n=a.x,e=a.y,r=a.z,_=t._transform._rotation00*n+t._transform._rotation10*e+t._transform._rotation20*r,l=t._transform._rotation01*n+t._transform._rotation11*e+t._transform._rotation21*r,h=t._transform._rotation02*n+t._transform._rotation12*e+t._transform._rotation22*r,n=_,e=l,r=h,c.x=n,c.y=e,c.z=r;let m,b,p,x,f,u,y=this.localAxis2;return m=o.x,b=o.y,p=o.z,x=i._transform._rotation00*m+i._transform._rotation10*b+i._transform._rotation20*p,f=i._transform._rotation01*m+i._transform._rotation11*b+i._transform._rotation21*p,u=i._transform._rotation02*m+i._transform._rotation12*b+i._transform._rotation22*p,m=x,b=f,p=u,y.x=m,y.y=b,y.z=p,this}},s.dynamics.constraint.solver||(s.dynamics.constraint.solver={}),s.dynamics.constraint.solver.ConstraintSolverType=class{},s.dynamics.constraint.solver.common||(s.dynamics.constraint.solver.common={}),s.dynamics.constraint.solver.common.ContactSolverMassDataRow=class{constructor(){this.invMLinN1X=0,this.invMLinN1Y=0,this.invMLinN1Z=0,this.invMLinN2X=0,this.invMLinN2Y=0,this.invMLinN2Z=0,this.invMAngN1X=0,this.invMAngN1Y=0,this.invMAngN1Z=0,this.invMAngN2X=0,this.invMAngN2Y=0,this.invMAngN2Z=0,this.invMLinT1X=0,this.invMLinT1Y=0,this.invMLinT1Z=0,this.invMLinT2X=0,this.invMLinT2Y=0,this.invMLinT2Z=0,this.invMAngT1X=0,this.invMAngT1Y=0,this.invMAngT1Z=0,this.invMAngT2X=0,this.invMAngT2Y=0,this.invMAngT2Z=0,this.invMLinB1X=0,this.invMLinB1Y=0,this.invMLinB1Z=0,this.invMLinB2X=0,this.invMLinB2Y=0,this.invMLinB2Z=0,this.invMAngB1X=0,this.invMAngB1Y=0,this.invMAngB1Z=0,this.invMAngB2X=0,this.invMAngB2Y=0,this.invMAngB2Z=0,this.massN=0,this.massTB00=0,this.massTB01=0,this.massTB10=0,this.massTB11=0}},s.dynamics.constraint.solver.common.JointSolverMassDataRow=class{constructor(){this.invMLin1X=0,this.invMLin1Y=0,this.invMLin1Z=0,this.invMLin2X=0,this.invMLin2Y=0,this.invMLin2Z=0,this.invMAng1X=0,this.invMAng1Y=0,this.invMAng1Z=0,this.invMAng2X=0,this.invMAng2Y=0,this.invMAng2Z=0,this.mass=0,this.massWithoutCfm=0}},s.dynamics.constraint.solver.direct||(s.dynamics.constraint.solver.direct={}),s.dynamics.constraint.solver.direct.Boundary=class{constructor(t){this.iBounded=new Array(t),this.iUnbounded=new Array(t),this.signs=new Array(t),this.b=new Array(t),this.numBounded=0,this.numUnbounded=0,this.matrixId=0}init(t){this.numBounded=t.numBounded;let i=0,s=this.numBounded;for(;i<s;){let s=i++;this.iBounded[s]=t.iBounded[s],this.signs[s]=t.signs[s]}this.numUnbounded=t.numUnbounded,this.matrixId=0;let a=0,o=this.numUnbounded;for(;a<o;){let i=a++,s=t.iUnbounded[i];this.iUnbounded[i]=s,this.matrixId|=1<<s}}computeImpulses(t,i,a,o,n,e,r){let _=0,l=this.numUnbounded;for(;_<l;){let i=this.iUnbounded[_++],s=t.rows[i];this.b[i]=s.rhs*e-a[i]-s.cfm*o[i]}let h=i._invMassWithoutCfm,c=0,m=this.numBounded;for(;c<m;){let i=c++,s=this.iBounded[i],a=this.signs[i],e=t.rows[s],r=(a<0?e.minImpulse:a>0?e.maxImpulse:0)-o[s];if(n[s]=r,0!=r){let t=0,i=this.numUnbounded;for(;t<i;){let i=this.iUnbounded[t++];this.b[i]-=h[s][i]*r}}}let b,p=this.iUnbounded,x=this.numUnbounded,f=0,u=0;for(;u<x;)f|=1<<p[u++];i._cacheComputed[f]||(i.computeSubmatrix(f,p,x),i._cacheComputed[f]=!0),b=i._cachedSubmatrices[f];let y=!0,v=0,d=this.numUnbounded;for(;v<d;){let i=v++,a=this.iUnbounded[i],e=t.rows[a],r=o[a],_=r,l=0,h=this.numUnbounded;for(;l<h;){let t=l++;_+=this.b[this.iUnbounded[t]]*b[i][t]}if(_<e.minImpulse-s.common.Setting.directMlcpSolverEps||_>e.maxImpulse+s.common.Setting.directMlcpSolverEps){y=!1;break}n[a]=_-r}if(r)return!0;if(!y)return!1;let g=0,X=this.numBounded;for(;g<X;){let i=g++,r=this.iBounded[i],_=t.rows[r],l=this.signs[i],c=0,m=o[r]+n[r],b=a[r],p=0,x=t.numRows;for(;p<x;){let t=p++;b+=h[r][t]*n[t]}if(c=_.rhs*e-b-_.cfm*m,l<0&&c>s.common.Setting.directMlcpSolverEps||l>0&&c<-s.common.Setting.directMlcpSolverEps){y=!1;break}}return y}},s.dynamics.constraint.solver.direct.BoundaryBuildInfo=class{constructor(t){this.size=t,this.numBounded=0,this.iBounded=new Array(t),this.signs=new Array(t),this.numUnbounded=0,this.iUnbounded=new Array(t)}},s.dynamics.constraint.solver.direct.BoundaryBuilder=class{constructor(t){this.maxRows=t,this.numBoundaries=0,this.boundaries=new Array(1<<t),this.bbInfo=new s.dynamics.constraint.solver.direct.BoundaryBuildInfo(t)}buildBoundariesRecursive(t,i){if(i==t.numRows)return null==this.boundaries[this.numBoundaries]&&(this.boundaries[this.numBoundaries]=new s.dynamics.constraint.solver.direct.Boundary(this.maxRows)),void this.boundaries[this.numBoundaries++].init(this.bbInfo);let a=t.rows[i],o=a.minImpulse>-Infinity,n=a.maxImpulse<Infinity;if(0==a.minImpulse&&0==a.maxImpulse){let s=this.bbInfo;return s.iBounded[s.numBounded]=i,s.signs[s.numBounded]=0,s.numBounded++,this.buildBoundariesRecursive(t,i+1),void this.bbInfo.numBounded--}let e=this.bbInfo;if(e.iUnbounded[e.numUnbounded]=i,e.numUnbounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numUnbounded--,o){let s=this.bbInfo;s.iBounded[s.numBounded]=i,s.signs[s.numBounded]=-1,s.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}if(n){let s=this.bbInfo;s.iBounded[s.numBounded]=i,s.signs[s.numBounded]=1,s.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}}buildBoundaries(t){this.numBoundaries=0;let i=this.bbInfo;i.numBounded=0,i.numUnbounded=0,this.buildBoundariesRecursive(t,0)}},s.dynamics.constraint.solver.direct.BoundarySelector=class{constructor(t){this.n=t,this.indices=new Array(t),this.tmpIndices=new Array(t);let i=0;for(;i<t;){let t=i++;this.indices[t]=t}}getIndex(t){return this.indices[t]}select(t){let i=0;for(;this.indices[i]!=t;)++i;for(;i>0;){let t=this.indices[i];this.indices[i]=this.indices[i-1],this.indices[i-1]=t,--i}}setSize(t){let i=0,s=0,a=0,o=this.n;for(;a<o;){let o=this.indices[a++];o<t?(this.tmpIndices[i]=o,++i):(this.tmpIndices[t+s]=o,++s)}let n=this.indices;this.indices=this.tmpIndices,this.tmpIndices=n}},s.dynamics.constraint.solver.direct.DirectJointConstraintSolver=class extends s.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.joint=t,this.info=new s.dynamics.constraint.info.joint.JointSolverInfo;let i=s.common.Setting.maxJacobianRows;this.massMatrix=new s.dynamics.constraint.solver.direct.MassMatrix(i),this.boundaryBuilder=new s.dynamics.constraint.solver.direct.BoundaryBuilder(i),this.massData=new Array(i);let a=0,o=this.massData.length;for(;a<o;)this.massData[a++]=new s.dynamics.constraint.solver.common.JointSolverMassDataRow;let n=this.boundaryBuilder.boundaries.length;this.velBoundarySelector=new s.dynamics.constraint.solver.direct.BoundarySelector(n),this.posBoundarySelector=new s.dynamics.constraint.solver.direct.BoundarySelector(n),this.relVels=new Array(i),this.impulses=new Array(i),this.dImpulses=new Array(i),this.dTotalImpulses=new Array(i);let e=0;for(;e<i;){let t=e++;this.relVels[t]=0,this.impulses[t]=0,this.dImpulses[t]=0,this.dTotalImpulses[t]=0}}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let i=this.boundaryBuilder;i.numBoundaries=0;let s=i.bbInfo;s.numBounded=0,s.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);let a=this.velBoundarySelector,o=this.boundaryBuilder.numBoundaries,n=0,e=0,r=0,_=a.n;for(;r<_;){let t=a.indices[r++];t<o?(a.tmpIndices[n]=t,++n):(a.tmpIndices[o+e]=t,++e)}let l=a.indices;a.indices=a.tmpIndices,a.tmpIndices=l}warmStart(t){let i=this.joint._positionCorrectionAlgorithm==s.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?s.common.Setting.jointWarmStartingFactorForBaungarte:s.common.Setting.jointWarmStartingFactor;if(i*=t.dtRatio,i<=0){let t=0,i=this.info.numRows;for(;t<i;){let i=this.info.rows[t++].impulse;i.impulse=0,i.impulseM=0,i.impulseP=0}return}let a=0,o=this.info.numRows;for(;a<o;){let t=a++,s=this.info.rows[t],o=s.impulse,n=o.impulse*i;if(n<s.minImpulse?n=s.minImpulse:n>s.maxImpulse&&(n=s.maxImpulse),o.impulse=n,s.motorMaxImpulse>0){let t=o.impulseM*i,a=s.motorMaxImpulse;t<-a?t=-a:t>a&&(t=a),o.impulseM=t}else o.impulseM=0;this.dImpulses[t]=o.impulse+o.impulseM}let n,e,r,_,l,h,c,m,b,p,x,f,u=this.dImpulses,y=!1,v=!1;n=this._b1._velX,e=this._b1._velY,r=this._b1._velZ,_=this._b2._velX,l=this._b2._velY,h=this._b2._velZ,c=this._b1._angVelX,m=this._b1._angVelY,b=this._b1._angVelZ,p=this._b2._angVelX,x=this._b2._angVelY,f=this._b2._angVelZ;let d=0,g=this.info.numRows;for(;d<g;){let t=d++,i=this.info.rows[t].jacobian,s=this.massData[t],a=u[t];0!=(1&i.flag)&&(n+=s.invMLin1X*a,e+=s.invMLin1Y*a,r+=s.invMLin1Z*a,_+=s.invMLin2X*-a,l+=s.invMLin2Y*-a,h+=s.invMLin2Z*-a,y=!0),0!=(2&i.flag)&&(c+=s.invMAng1X*a,m+=s.invMAng1Y*a,b+=s.invMAng1Z*a,p+=s.invMAng2X*-a,x+=s.invMAng2Y*-a,f+=s.invMAng2Z*-a,v=!0)}y&&(this._b1._velX=n,this._b1._velY=e,this._b1._velZ=r,this._b2._velX=_,this._b2._velY=l,this._b2._velZ=h),v&&(this._b1._angVelX=c,this._b1._angVelY=m,this._b1._angVelZ=b,this._b2._angVelX=p,this._b2._angVelY=x,this._b2._angVelZ=f)}solveVelocity(){let t,i,s,a,o,n,e,r,_,l,h,c,m=this.info.numRows;t=this._b1._velX,i=this._b1._velY,s=this._b1._velZ,a=this._b2._velX,o=this._b2._velY,n=this._b2._velZ,e=this._b1._angVelX,r=this._b1._angVelY,_=this._b1._angVelZ,l=this._b2._angVelX,h=this._b2._angVelY,c=this._b2._angVelZ;let b=0;for(;b<m;){let m=b++,p=this.info.rows[m],x=p.jacobian,f=0;f+=t*x.lin1X+i*x.lin1Y+s*x.lin1Z,f-=a*x.lin2X+o*x.lin2Y+n*x.lin2Z,f+=e*x.ang1X+r*x.ang1Y+_*x.ang1Z,f-=l*x.ang2X+h*x.ang2Y+c*x.ang2Z,this.relVels[m]=f,this.impulses[m]=p.impulse.impulse,this.dTotalImpulses[m]=0}let p=this.massMatrix._invMassWithoutCfm,x=0;for(;x<m;){let t=x++,i=this.info.rows[t],s=i.impulse;if(i.motorMaxImpulse>0){let a=s.impulseM,o=a+this.massData[t].massWithoutCfm*(-i.motorSpeed-this.relVels[t]),n=i.motorMaxImpulse;o<-n?o=-n:o>n&&(o=n),s.impulseM=o;let e=o-a;this.dTotalImpulses[t]=e;let r=0;for(;r<m;){let i=r++;this.relVels[i]+=e*p[t][i]}}}let f=!1,u=0,y=this.boundaryBuilder.numBoundaries;for(;u<y;){let t=this.velBoundarySelector.indices[u++];if(this.boundaryBuilder.boundaries[t].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,!1)){let i=0;for(;i<m;){let t=i++,s=this.dImpulses[t];this.info.rows[t].impulse.impulse+=s,this.dTotalImpulses[t]+=s}let s,a,o,n,e,r,_,l,h,c,b,p,x=this.dTotalImpulses,u=!1,y=!1;s=this._b1._velX,a=this._b1._velY,o=this._b1._velZ,n=this._b2._velX,e=this._b2._velY,r=this._b2._velZ,_=this._b1._angVelX,l=this._b1._angVelY,h=this._b1._angVelZ,c=this._b2._angVelX,b=this._b2._angVelY,p=this._b2._angVelZ;let v=0,d=this.info.numRows;for(;v<d;){let t=v++,i=this.info.rows[t].jacobian,m=this.massData[t],f=x[t];0!=(1&i.flag)&&(s+=m.invMLin1X*f,a+=m.invMLin1Y*f,o+=m.invMLin1Z*f,n+=m.invMLin2X*-f,e+=m.invMLin2Y*-f,r+=m.invMLin2Z*-f,u=!0),0!=(2&i.flag)&&(_+=m.invMAng1X*f,l+=m.invMAng1Y*f,h+=m.invMAng1Z*f,c+=m.invMAng2X*-f,b+=m.invMAng2Y*-f,p+=m.invMAng2Z*-f,y=!0)}u&&(this._b1._velX=s,this._b1._velY=a,this._b1._velZ=o,this._b2._velX=n,this._b2._velY=e,this._b2._velZ=r),y&&(this._b1._angVelX=_,this._b1._angVelY=l,this._b1._angVelZ=h,this._b2._angVelX=c,this._b2._angVelY=b,this._b2._angVelZ=p);let g=this.velBoundarySelector,X=0;for(;g.indices[X]!=t;)++X;for(;X>0;){let t=g.indices[X];g.indices[X]=g.indices[X-1],g.indices[X-1]=t,--X}f=!0;break}}f||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:335:","could not find solution. (velocity)")}postSolveVelocity(t){let i,s,a,o,n,e;i=0,s=0,a=0,o=0,n=0,e=0;let r=0,_=this.info.numRows;for(;r<_;){let t=this.info.rows[r++],_=t.impulse,l=t.jacobian;0!=(1&l.flag)?(i+=l.lin1X*_.impulse,s+=l.lin1Y*_.impulse,a+=l.lin1Z*_.impulse):0!=(2&l.flag)&&(o+=l.ang1X*_.impulse,n+=l.ang1Y*_.impulse,e+=l.ang1Z*_.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=s*t.invDt,this.joint._appliedForceZ=a*t.invDt,this.joint._appliedTorqueX=o*t.invDt,this.joint._appliedTorqueY=n*t.invDt,this.joint._appliedTorqueZ=e*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let i=this.boundaryBuilder;i.numBoundaries=0;let s=i.bbInfo;s.numBounded=0,s.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);let a=this.posBoundarySelector,o=this.boundaryBuilder.numBoundaries,n=0,e=0,r=0,_=a.n;for(;r<_;){let t=a.indices[r++];t<o?(a.tmpIndices[n]=t,++n):(a.tmpIndices[o+e]=t,++e)}let l=a.indices;a.indices=a.tmpIndices,a.tmpIndices=l;let h=0,c=this.info.numRows;for(;h<c;)this.info.rows[h++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,i,a,o,n,e,r,_,l,h,c,m,b=this.info.numRows;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,a=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,n=this._b2._pseudoVelY,e=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,_=this._b1._angPseudoVelY,l=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,c=this._b2._angPseudoVelY,m=this._b2._angPseudoVelZ;let p=0;for(;p<b;){let s=p++,b=this.info.rows[s],x=b.jacobian,f=0;f+=t*x.lin1X+i*x.lin1Y+a*x.lin1Z,f-=o*x.lin2X+n*x.lin2Y+e*x.lin2Z,f+=r*x.ang1X+_*x.ang1Y+l*x.ang1Z,f-=h*x.ang2X+c*x.ang2Y+m*x.ang2Z,this.relVels[s]=f,this.impulses[s]=b.impulse.impulseP}let x=!1,f=0,u=this.boundaryBuilder.numBoundaries;for(;f<u;){let t=this.posBoundarySelector.indices[f++];if(this.boundaryBuilder.boundaries[t].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,s.common.Setting.positionSplitImpulseBaumgarte,!1)){let i=0;for(;i<b;){let t=i++;this.info.rows[t].impulse.impulseP+=this.dImpulses[t]}let s,a,o,n,e,r,_,l,h,c,m,p,f=this.dImpulses,u=!1,y=!1;s=this._b1._pseudoVelX,a=this._b1._pseudoVelY,o=this._b1._pseudoVelZ,n=this._b2._pseudoVelX,e=this._b2._pseudoVelY,r=this._b2._pseudoVelZ,_=this._b1._angPseudoVelX,l=this._b1._angPseudoVelY,h=this._b1._angPseudoVelZ,c=this._b2._angPseudoVelX,m=this._b2._angPseudoVelY,p=this._b2._angPseudoVelZ;let v=0,d=this.info.numRows;for(;v<d;){let t=v++,i=this.info.rows[t].jacobian,b=this.massData[t],x=f[t];0!=(1&i.flag)&&(s+=b.invMLin1X*x,a+=b.invMLin1Y*x,o+=b.invMLin1Z*x,n+=b.invMLin2X*-x,e+=b.invMLin2Y*-x,r+=b.invMLin2Z*-x,u=!0),0!=(2&i.flag)&&(_+=b.invMAng1X*x,l+=b.invMAng1Y*x,h+=b.invMAng1Z*x,c+=b.invMAng2X*-x,m+=b.invMAng2Y*-x,p+=b.invMAng2Z*-x,y=!0)}u&&(this._b1._pseudoVelX=s,this._b1._pseudoVelY=a,this._b1._pseudoVelZ=o,this._b2._pseudoVelX=n,this._b2._pseudoVelY=e,this._b2._pseudoVelZ=r),y&&(this._b1._angPseudoVelX=_,this._b1._angPseudoVelY=l,this._b1._angPseudoVelZ=h,this._b2._angPseudoVelX=c,this._b2._angPseudoVelY=m,this._b2._angPseudoVelZ=p);let g=this.posBoundarySelector,X=0;for(;g.indices[X]!=t;)++X;for(;X>0;){let t=g.indices[X];g.indices[X]=g.indices[X-1],g.indices[X-1]=t,--X}x=!0;break}}x||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:450:","could not find solution. (split impulse)")}solvePositionNgs(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let i=this.boundaryBuilder;i.numBoundaries=0;let a=i.bbInfo;a.numBounded=0,a.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);let o=this.posBoundarySelector,n=this.boundaryBuilder.numBoundaries,e=0,r=0,_=0,l=o.n;for(;_<l;){let t=o.indices[_++];t<n?(o.tmpIndices[e]=t,++e):(o.tmpIndices[n+r]=t,++r)}let h=o.indices;o.indices=o.tmpIndices,o.tmpIndices=h;let c=this.info.numRows,m=0;for(;m<c;){let t=m++,i=this.info.rows[t].impulse;this.relVels[t]=0,this.impulses[t]=i.impulseP}let b=!1,p=0,x=this.boundaryBuilder.numBoundaries;for(;p<x;){let t=this.posBoundarySelector.indices[p++];if(this.boundaryBuilder.boundaries[t].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,s.common.Setting.positionNgsBaumgarte,!1)){let i=0;for(;i<c;){let t=i++;this.info.rows[t].impulse.impulseP+=this.dImpulses[t]}let s,a,o,n,e,r,_,l,h,m,p,x,f=this.dImpulses,u=!1,y=!1;s=0,a=0,o=0,n=0,e=0,r=0,_=0,l=0,h=0,m=0,p=0,x=0;let v=0,d=this.info.numRows;for(;v<d;){let t=v++,i=this.info.rows[t].jacobian,c=this.massData[t],b=f[t];0!=(1&i.flag)&&(s+=c.invMLin1X*b,a+=c.invMLin1Y*b,o+=c.invMLin1Z*b,n+=c.invMLin2X*-b,e+=c.invMLin2Y*-b,r+=c.invMLin2Z*-b,u=!0),0!=(2&i.flag)&&(_+=c.invMAng1X*b,l+=c.invMAng1Y*b,h+=c.invMAng1Z*b,m+=c.invMAng2X*-b,p+=c.invMAng2Y*-b,x+=c.invMAng2Z*-b,y=!0)}if(u){let t=this._b1;t._transform._positionX+=s,t._transform._positionY+=a,t._transform._positionZ+=o;let i=this._b2;i._transform._positionX+=n,i._transform._positionY+=e,i._transform._positionZ+=r}if(y){let t,i,s,a,o,n,e,r,c,b,f,u,y,v=this._b1,d=Math.sqrt(_*_+l*l+h*h),g=.5*d;if(g<.5){let s=g*g;t=.5*(1-.16666666666666666*s+s*s*.008333333333333333),i=1-.5*s+s*s*.041666666666666664}else t=Math.sin(g)/d,i=Math.cos(g);s=_*t,a=l*t,o=h*t,n=s,e=a,r=o,c=i;let X,Y=v._transform._rotation00,z=v._transform._rotation11,Z=v._transform._rotation22,M=Y+z+Z;M>0?(X=Math.sqrt(M+1),y=.5*X,X=.5/X,b=(v._transform._rotation21-v._transform._rotation12)*X,f=(v._transform._rotation02-v._transform._rotation20)*X,u=(v._transform._rotation10-v._transform._rotation01)*X):Y>z?Y>Z?(X=Math.sqrt(Y-z-Z+1),b=.5*X,X=.5/X,f=(v._transform._rotation01+v._transform._rotation10)*X,u=(v._transform._rotation02+v._transform._rotation20)*X,y=(v._transform._rotation21-v._transform._rotation12)*X):(X=Math.sqrt(Z-Y-z+1),u=.5*X,X=.5/X,b=(v._transform._rotation02+v._transform._rotation20)*X,f=(v._transform._rotation12+v._transform._rotation21)*X,y=(v._transform._rotation10-v._transform._rotation01)*X):z>Z?(X=Math.sqrt(z-Z-Y+1),f=.5*X,X=.5/X,b=(v._transform._rotation01+v._transform._rotation10)*X,u=(v._transform._rotation12+v._transform._rotation21)*X,y=(v._transform._rotation02-v._transform._rotation20)*X):(X=Math.sqrt(Z-Y-z+1),u=.5*X,X=.5/X,b=(v._transform._rotation02+v._transform._rotation20)*X,f=(v._transform._rotation12+v._transform._rotation21)*X,y=(v._transform._rotation10-v._transform._rotation01)*X),b=c*b+n*y+e*u-r*f,f=c*f-n*u+e*y+r*b,u=c*u+n*f-e*b+r*y,y=c*y-n*b-e*f-r*u;let I=b*b+f*f+u*u+y*y;I>1e-32&&(I=1/Math.sqrt(I)),b*=I,f*=I,u*=I,y*=I;let V,L,w,k,A,B,P,S,T,C,j,R,E,q,N,D,F,H,G=2*b,W=2*f,O=2*u,J=b*G,U=f*W,Q=u*O,K=b*W,$=f*O,tt=b*O,it=y*G,st=y*W,at=y*O;v._transform._rotation00=1-U-Q,v._transform._rotation01=K-at,v._transform._rotation02=tt+st,v._transform._rotation10=K+at,v._transform._rotation11=1-J-Q,v._transform._rotation12=$-it,v._transform._rotation20=tt-st,v._transform._rotation21=$+it,v._transform._rotation22=1-J-U,V=v._transform._rotation00*v._invLocalInertia00+v._transform._rotation01*v._invLocalInertia10+v._transform._rotation02*v._invLocalInertia20,L=v._transform._rotation00*v._invLocalInertia01+v._transform._rotation01*v._invLocalInertia11+v._transform._rotation02*v._invLocalInertia21,w=v._transform._rotation00*v._invLocalInertia02+v._transform._rotation01*v._invLocalInertia12+v._transform._rotation02*v._invLocalInertia22,k=v._transform._rotation10*v._invLocalInertia00+v._transform._rotation11*v._invLocalInertia10+v._transform._rotation12*v._invLocalInertia20,A=v._transform._rotation10*v._invLocalInertia01+v._transform._rotation11*v._invLocalInertia11+v._transform._rotation12*v._invLocalInertia21,B=v._transform._rotation10*v._invLocalInertia02+v._transform._rotation11*v._invLocalInertia12+v._transform._rotation12*v._invLocalInertia22,P=v._transform._rotation20*v._invLocalInertia00+v._transform._rotation21*v._invLocalInertia10+v._transform._rotation22*v._invLocalInertia20,S=v._transform._rotation20*v._invLocalInertia01+v._transform._rotation21*v._invLocalInertia11+v._transform._rotation22*v._invLocalInertia21,T=v._transform._rotation20*v._invLocalInertia02+v._transform._rotation21*v._invLocalInertia12+v._transform._rotation22*v._invLocalInertia22,v._invInertia00=V,v._invInertia01=L,v._invInertia02=w,v._invInertia10=k,v._invInertia11=A,v._invInertia12=B,v._invInertia20=P,v._invInertia21=S,v._invInertia22=T,C=v._invInertia00*v._transform._rotation00+v._invInertia01*v._transform._rotation01+v._invInertia02*v._transform._rotation02,j=v._invInertia00*v._transform._rotation10+v._invInertia01*v._transform._rotation11+v._invInertia02*v._transform._rotation12,R=v._invInertia00*v._transform._rotation20+v._invInertia01*v._transform._rotation21+v._invInertia02*v._transform._rotation22,E=v._invInertia10*v._transform._rotation00+v._invInertia11*v._transform._rotation01+v._invInertia12*v._transform._rotation02,q=v._invInertia10*v._transform._rotation10+v._invInertia11*v._transform._rotation11+v._invInertia12*v._transform._rotation12,N=v._invInertia10*v._transform._rotation20+v._invInertia11*v._transform._rotation21+v._invInertia12*v._transform._rotation22,D=v._invInertia20*v._transform._rotation00+v._invInertia21*v._transform._rotation01+v._invInertia22*v._transform._rotation02,F=v._invInertia20*v._transform._rotation10+v._invInertia21*v._transform._rotation11+v._invInertia22*v._transform._rotation12,H=v._invInertia20*v._transform._rotation20+v._invInertia21*v._transform._rotation21+v._invInertia22*v._transform._rotation22,v._invInertia00=C,v._invInertia01=j,v._invInertia02=R,v._invInertia10=E,v._invInertia11=q,v._invInertia12=N,v._invInertia20=D,v._invInertia21=F,v._invInertia22=H,v._invInertia00*=v._rotFactor.x,v._invInertia01*=v._rotFactor.x,v._invInertia02*=v._rotFactor.x,v._invInertia10*=v._rotFactor.y,v._invInertia11*=v._rotFactor.y,v._invInertia12*=v._rotFactor.y,v._invInertia20*=v._rotFactor.z,v._invInertia21*=v._rotFactor.z,v._invInertia22*=v._rotFactor.z;let ot,nt,et,rt,_t,lt,ht,ct,mt,bt,pt,xt,ft,ut=this._b2,yt=Math.sqrt(m*m+p*p+x*x),vt=.5*yt;if(vt<.5){let t=vt*vt;ot=.5*(1-.16666666666666666*t+t*t*.008333333333333333),nt=1-.5*t+t*t*.041666666666666664}else ot=Math.sin(vt)/yt,nt=Math.cos(vt);et=m*ot,rt=p*ot,_t=x*ot,lt=et,ht=rt,ct=_t,mt=nt;let dt,gt=ut._transform._rotation00,Xt=ut._transform._rotation11,Yt=ut._transform._rotation22,zt=gt+Xt+Yt;zt>0?(dt=Math.sqrt(zt+1),ft=.5*dt,dt=.5/dt,bt=(ut._transform._rotation21-ut._transform._rotation12)*dt,pt=(ut._transform._rotation02-ut._transform._rotation20)*dt,xt=(ut._transform._rotation10-ut._transform._rotation01)*dt):gt>Xt?gt>Yt?(dt=Math.sqrt(gt-Xt-Yt+1),bt=.5*dt,dt=.5/dt,pt=(ut._transform._rotation01+ut._transform._rotation10)*dt,xt=(ut._transform._rotation02+ut._transform._rotation20)*dt,ft=(ut._transform._rotation21-ut._transform._rotation12)*dt):(dt=Math.sqrt(Yt-gt-Xt+1),xt=.5*dt,dt=.5/dt,bt=(ut._transform._rotation02+ut._transform._rotation20)*dt,pt=(ut._transform._rotation12+ut._transform._rotation21)*dt,ft=(ut._transform._rotation10-ut._transform._rotation01)*dt):Xt>Yt?(dt=Math.sqrt(Xt-Yt-gt+1),pt=.5*dt,dt=.5/dt,bt=(ut._transform._rotation01+ut._transform._rotation10)*dt,xt=(ut._transform._rotation12+ut._transform._rotation21)*dt,ft=(ut._transform._rotation02-ut._transform._rotation20)*dt):(dt=Math.sqrt(Yt-gt-Xt+1),xt=.5*dt,dt=.5/dt,bt=(ut._transform._rotation02+ut._transform._rotation20)*dt,pt=(ut._transform._rotation12+ut._transform._rotation21)*dt,ft=(ut._transform._rotation10-ut._transform._rotation01)*dt),bt=mt*bt+lt*ft+ht*xt-ct*pt,pt=mt*pt-lt*xt+ht*ft+ct*bt,xt=mt*xt+lt*pt-ht*bt+ct*ft,ft=mt*ft-lt*bt-ht*pt-ct*xt;let Zt=bt*bt+pt*pt+xt*xt+ft*ft;Zt>1e-32&&(Zt=1/Math.sqrt(Zt)),bt*=Zt,pt*=Zt,xt*=Zt,ft*=Zt;let Mt,It,Vt,Lt,wt,kt,At,Bt,Pt,St,Tt,Ct,jt,Rt,Et,qt,Nt,Dt,Ft=2*bt,Ht=2*pt,Gt=2*xt,Wt=bt*Ft,Ot=pt*Ht,Jt=xt*Gt,Ut=bt*Ht,Qt=pt*Gt,Kt=bt*Gt,$t=ft*Ft,ti=ft*Ht,ii=ft*Gt;ut._transform._rotation00=1-Ot-Jt,ut._transform._rotation01=Ut-ii,ut._transform._rotation02=Kt+ti,ut._transform._rotation10=Ut+ii,ut._transform._rotation11=1-Wt-Jt,ut._transform._rotation12=Qt-$t,ut._transform._rotation20=Kt-ti,ut._transform._rotation21=Qt+$t,ut._transform._rotation22=1-Wt-Ot,Mt=ut._transform._rotation00*ut._invLocalInertia00+ut._transform._rotation01*ut._invLocalInertia10+ut._transform._rotation02*ut._invLocalInertia20,It=ut._transform._rotation00*ut._invLocalInertia01+ut._transform._rotation01*ut._invLocalInertia11+ut._transform._rotation02*ut._invLocalInertia21,Vt=ut._transform._rotation00*ut._invLocalInertia02+ut._transform._rotation01*ut._invLocalInertia12+ut._transform._rotation02*ut._invLocalInertia22,Lt=ut._transform._rotation10*ut._invLocalInertia00+ut._transform._rotation11*ut._invLocalInertia10+ut._transform._rotation12*ut._invLocalInertia20,wt=ut._transform._rotation10*ut._invLocalInertia01+ut._transform._rotation11*ut._invLocalInertia11+ut._transform._rotation12*ut._invLocalInertia21,kt=ut._transform._rotation10*ut._invLocalInertia02+ut._transform._rotation11*ut._invLocalInertia12+ut._transform._rotation12*ut._invLocalInertia22,At=ut._transform._rotation20*ut._invLocalInertia00+ut._transform._rotation21*ut._invLocalInertia10+ut._transform._rotation22*ut._invLocalInertia20,Bt=ut._transform._rotation20*ut._invLocalInertia01+ut._transform._rotation21*ut._invLocalInertia11+ut._transform._rotation22*ut._invLocalInertia21,Pt=ut._transform._rotation20*ut._invLocalInertia02+ut._transform._rotation21*ut._invLocalInertia12+ut._transform._rotation22*ut._invLocalInertia22,ut._invInertia00=Mt,ut._invInertia01=It,ut._invInertia02=Vt,ut._invInertia10=Lt,ut._invInertia11=wt,ut._invInertia12=kt,ut._invInertia20=At,ut._invInertia21=Bt,ut._invInertia22=Pt,St=ut._invInertia00*ut._transform._rotation00+ut._invInertia01*ut._transform._rotation01+ut._invInertia02*ut._transform._rotation02,Tt=ut._invInertia00*ut._transform._rotation10+ut._invInertia01*ut._transform._rotation11+ut._invInertia02*ut._transform._rotation12,Ct=ut._invInertia00*ut._transform._rotation20+ut._invInertia01*ut._transform._rotation21+ut._invInertia02*ut._transform._rotation22,jt=ut._invInertia10*ut._transform._rotation00+ut._invInertia11*ut._transform._rotation01+ut._invInertia12*ut._transform._rotation02,Rt=ut._invInertia10*ut._transform._rotation10+ut._invInertia11*ut._transform._rotation11+ut._invInertia12*ut._transform._rotation12,Et=ut._invInertia10*ut._transform._rotation20+ut._invInertia11*ut._transform._rotation21+ut._invInertia12*ut._transform._rotation22,qt=ut._invInertia20*ut._transform._rotation00+ut._invInertia21*ut._transform._rotation01+ut._invInertia22*ut._transform._rotation02,Nt=ut._invInertia20*ut._transform._rotation10+ut._invInertia21*ut._transform._rotation11+ut._invInertia22*ut._transform._rotation12,Dt=ut._invInertia20*ut._transform._rotation20+ut._invInertia21*ut._transform._rotation21+ut._invInertia22*ut._transform._rotation22,ut._invInertia00=St,ut._invInertia01=Tt,ut._invInertia02=Ct,ut._invInertia10=jt,ut._invInertia11=Rt,ut._invInertia12=Et,ut._invInertia20=qt,ut._invInertia21=Nt,ut._invInertia22=Dt,ut._invInertia00*=ut._rotFactor.x,ut._invInertia01*=ut._rotFactor.x,ut._invInertia02*=ut._rotFactor.x,ut._invInertia10*=ut._rotFactor.y,ut._invInertia11*=ut._rotFactor.y,ut._invInertia12*=ut._rotFactor.y,ut._invInertia20*=ut._rotFactor.z,ut._invInertia21*=ut._rotFactor.z,ut._invInertia22*=ut._rotFactor.z}let g=this.posBoundarySelector,X=0;for(;g.indices[X]!=t;)++X;for(;X>0;){let t=g.indices[X];g.indices[X]=g.indices[X-1],g.indices[X-1]=t,--X}b=!0;break}}b||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:502:","could not find solution. (NGS)")}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}},s.dynamics.constraint.solver.direct.MassMatrix=class{constructor(t){this._size=t,this.tmpMatrix=new Array(this._size),this._invMass=new Array(this._size),this._invMassWithoutCfm=new Array(this._size);let i=0,s=this._size;for(;i<s;){let t=i++;this.tmpMatrix[t]=new Array(this._size),this._invMass[t]=new Array(this._size),this._invMassWithoutCfm[t]=new Array(this._size);let s=0,a=this._size;for(;s<a;){let i=s++;this.tmpMatrix[t][i]=0,this._invMass[t][i]=0,this._invMassWithoutCfm[t][i]=0}}this._maxSubmatrixId=1<<this._size,this._cacheComputed=new Array(this._maxSubmatrixId),this._cachedSubmatrices=new Array(this._maxSubmatrixId);let a=0,o=this._maxSubmatrixId;for(;a<o;){let t,i=a++;t=(85&i)+(i>>1&85),t=(51&t)+(t>>2&51),t=(15&t)+(t>>4&15);let s=t,o=new Array(s),n=0;for(;n<s;){let t=n++;o[t]=new Array(s);let i=0;for(;i<s;)o[t][i++]=0}this._cacheComputed[i]=!1,this._cachedSubmatrices[i]=o}}computeSubmatrix(t,i,s){let a=0;for(;a<s;){let t=a++,o=i[t],n=0;for(;n<s;){let s=n++;this.tmpMatrix[t][s]=this._invMass[o][i[s]]}}let o,n,e,r,_,l=this.tmpMatrix,h=this._cachedSubmatrices[t];switch(s){case 4:o=l[0],n=h[0],_=1/o[0],n[0]=_,o[1]*=_,o[2]*=_,o[3]*=_,e=l[1],r=h[1],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e=l[2],r=h[2],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e=l[3],r=h[3],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],o=l[1],n=h[1],_=1/o[1],n[1]=_,n[0]*=_,o[2]*=_,o[3]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e=l[2],r=h[2],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e=l[3],r=h[3],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],o=l[2],n=h[2],_=1/o[2],n[2]=_,n[0]*=_,n[1]*=_,o[3]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[2],e[3]-=o[3]*e[2],e=l[1],r=h[1],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],e[3]-=o[3]*e[2],e=l[3],r=h[3],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],r[2]=-_*e[2],e[3]-=o[3]*e[2],o=l[3],n=h[3],_=1/o[3],n[3]=_,n[0]*=_,n[1]*=_,n[2]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[3],e=l[1],r=h[1],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],e=l[2],r=h[2],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],r[2]-=n[2]*e[3],n=h[1],h[0][1]=n[0],n=h[2],h[0][2]=n[0],h[1][2]=n[1],n=h[3],h[0][3]=n[0],h[1][3]=n[1],h[2][3]=n[2];break;case 5:o=l[0],n=h[0],_=1/o[0],n[0]=_,o[1]*=_,o[2]*=_,o[3]*=_,o[4]*=_,e=l[1],r=h[1],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e=l[2],r=h[2],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e=l[3],r=h[3],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e=l[4],r=h[4],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],o=l[1],n=h[1],_=1/o[1],n[1]=_,n[0]*=_,o[2]*=_,o[3]*=_,o[4]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e=l[2],r=h[2],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e=l[3],r=h[3],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e=l[4],r=h[4],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],o=l[2],n=h[2],_=1/o[2],n[2]=_,n[0]*=_,n[1]*=_,o[3]*=_,o[4]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e=l[1],r=h[1],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e=l[3],r=h[3],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],r[2]=-_*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e=l[4],r=h[4],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],r[2]=-_*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],o=l[3],n=h[3],_=1/o[3],n[3]=_,n[0]*=_,n[1]*=_,n[2]*=_,o[4]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[3],e[4]-=o[4]*e[3],e=l[1],r=h[1],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],e[4]-=o[4]*e[3],e=l[2],r=h[2],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],r[2]-=n[2]*e[3],e[4]-=o[4]*e[3],e=l[4],r=h[4],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],r[2]-=n[2]*e[3],r[3]=-_*e[3],e[4]-=o[4]*e[3],o=l[4],n=h[4],_=1/o[4],n[4]=_,n[0]*=_,n[1]*=_,n[2]*=_,n[3]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[4],e=l[1],r=h[1],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],e=l[2],r=h[2],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],r[2]-=n[2]*e[4],e=l[3],r=h[3],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],r[2]-=n[2]*e[4],r[3]-=n[3]*e[4],n=h[1],h[0][1]=n[0],n=h[2],h[0][2]=n[0],h[1][2]=n[1],n=h[3],h[0][3]=n[0],h[1][3]=n[1],h[2][3]=n[2],n=h[4],h[0][4]=n[0],h[1][4]=n[1],h[2][4]=n[2],h[3][4]=n[3];break;case 6:o=l[0],n=h[0],_=1/o[0],n[0]=_,o[1]*=_,o[2]*=_,o[3]*=_,o[4]*=_,o[5]*=_,e=l[1],r=h[1],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e[5]-=o[5]*e[0],e=l[2],r=h[2],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e[5]-=o[5]*e[0],e=l[3],r=h[3],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e[5]-=o[5]*e[0],e=l[4],r=h[4],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e[5]-=o[5]*e[0],e=l[5],r=h[5],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e[5]-=o[5]*e[0],o=l[1],n=h[1],_=1/o[1],n[1]=_,n[0]*=_,o[2]*=_,o[3]*=_,o[4]*=_,o[5]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e[5]-=o[5]*e[1],e=l[2],r=h[2],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e[5]-=o[5]*e[1],e=l[3],r=h[3],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e[5]-=o[5]*e[1],e=l[4],r=h[4],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e[5]-=o[5]*e[1],e=l[5],r=h[5],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e[5]-=o[5]*e[1],o=l[2],n=h[2],_=1/o[2],n[2]=_,n[0]*=_,n[1]*=_,o[3]*=_,o[4]*=_,o[5]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e[5]-=o[5]*e[2],e=l[1],r=h[1],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e[5]-=o[5]*e[2],e=l[3],r=h[3],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],r[2]=-_*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e[5]-=o[5]*e[2],e=l[4],r=h[4],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],r[2]=-_*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e[5]-=o[5]*e[2],e=l[5],r=h[5],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],r[2]=-_*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e[5]-=o[5]*e[2],o=l[3],n=h[3],_=1/o[3],n[3]=_,n[0]*=_,n[1]*=_,n[2]*=_,o[4]*=_,o[5]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[3],e[4]-=o[4]*e[3],e[5]-=o[5]*e[3],e=l[1],r=h[1],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],e[4]-=o[4]*e[3],e[5]-=o[5]*e[3],e=l[2],r=h[2],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],r[2]-=n[2]*e[3],e[4]-=o[4]*e[3],e[5]-=o[5]*e[3],e=l[4],r=h[4],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],r[2]-=n[2]*e[3],r[3]=-_*e[3],e[4]-=o[4]*e[3],e[5]-=o[5]*e[3],e=l[5],r=h[5],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],r[2]-=n[2]*e[3],r[3]=-_*e[3],e[4]-=o[4]*e[3],e[5]-=o[5]*e[3],o=l[4],n=h[4],_=1/o[4],n[4]=_,n[0]*=_,n[1]*=_,n[2]*=_,n[3]*=_,o[5]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[4],e[5]-=o[5]*e[4],e=l[1],r=h[1],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],e[5]-=o[5]*e[4],e=l[2],r=h[2],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],r[2]-=n[2]*e[4],e[5]-=o[5]*e[4],e=l[3],r=h[3],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],r[2]-=n[2]*e[4],r[3]-=n[3]*e[4],e[5]-=o[5]*e[4],e=l[5],r=h[5],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],r[2]-=n[2]*e[4],r[3]-=n[3]*e[4],r[4]=-_*e[4],e[5]-=o[5]*e[4],o=l[5],n=h[5],_=1/o[5],n[5]=_,n[0]*=_,n[1]*=_,n[2]*=_,n[3]*=_,n[4]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[5],e=l[1],r=h[1],r[0]-=n[0]*e[5],r[1]-=n[1]*e[5],e=l[2],r=h[2],r[0]-=n[0]*e[5],r[1]-=n[1]*e[5],r[2]-=n[2]*e[5],e=l[3],r=h[3],r[0]-=n[0]*e[5],r[1]-=n[1]*e[5],r[2]-=n[2]*e[5],r[3]-=n[3]*e[5],e=l[4],r=h[4],r[0]-=n[0]*e[5],r[1]-=n[1]*e[5],r[2]-=n[2]*e[5],r[3]-=n[3]*e[5],r[4]-=n[4]*e[5],n=h[1],h[0][1]=n[0],n=h[2],h[0][2]=n[0],h[1][2]=n[1],n=h[3],h[0][3]=n[0],h[1][3]=n[1],h[2][3]=n[2],n=h[4],h[0][4]=n[0],h[1][4]=n[1],h[2][4]=n[2],h[3][4]=n[3],n=h[5],h[0][5]=n[0],h[1][5]=n[1],h[2][5]=n[2],h[3][5]=n[3],h[4][5]=n[4];break;default:let t=0;for(;t<s;){let i=t++;o=l[i],n=h[i];let a=1/o[i];n[i]=a;let _=0;for(;_<i;)n[_++]*=a;let c=i+1;for(;c<s;)o[c++]*=a;let m=0;for(;m<i;){let t=m++;e=l[t],r=h[t];let a=0,_=t+1;for(;a<_;){let t=a++;r[t]-=n[t]*e[i]}let c=i+1;for(;c<s;){let t=c++;e[t]-=o[t]*e[i]}}let b=i+1;for(;b<s;){let t=b++;e=l[t],r=h[t];let _=0;for(;_<i;){let t=_++;r[t]-=n[t]*e[i]}r[i]=-a*e[i];let c=i+1;for(;c<s;){let t=c++;e[t]-=o[t]*e[i]}}}let i=1;for(;i<s;){let t=i++;n=h[t];let s=0;for(;s<t;){let i=s++;h[i][t]=n[i]}}}}computeInvMass(t,i){let s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d=this._invMass,g=this._invMassWithoutCfm,X=t.numRows,Y=t.b1,z=t.b2,Z=Y._invMass,M=z._invMass;s=Y._invInertia00,a=Y._invInertia01,o=Y._invInertia02,n=Y._invInertia10,e=Y._invInertia11,r=Y._invInertia12,_=Y._invInertia20,l=Y._invInertia21,h=Y._invInertia22,c=z._invInertia00,m=z._invInertia01,b=z._invInertia02,p=z._invInertia10,x=z._invInertia11,f=z._invInertia12,u=z._invInertia20,y=z._invInertia21,v=z._invInertia22;let I=0;for(;I<X;){let d=I++,g=t.rows[d].jacobian,X=i[d];if(g.updateSparsity(),0!=(1&g.flag)?(X.invMLin1X=g.lin1X*Z,X.invMLin1Y=g.lin1Y*Z,X.invMLin1Z=g.lin1Z*Z,X.invMLin2X=g.lin2X*M,X.invMLin2Y=g.lin2Y*M,X.invMLin2Z=g.lin2Z*M):(X.invMLin1X=0,X.invMLin1Y=0,X.invMLin1Z=0,X.invMLin2X=0,X.invMLin2Y=0,X.invMLin2Z=0),0!=(2&g.flag)){let t,i,d,Y,z,Z;t=s*g.ang1X+a*g.ang1Y+o*g.ang1Z,i=n*g.ang1X+e*g.ang1Y+r*g.ang1Z,d=_*g.ang1X+l*g.ang1Y+h*g.ang1Z,X.invMAng1X=t,X.invMAng1Y=i,X.invMAng1Z=d,Y=c*g.ang2X+m*g.ang2Y+b*g.ang2Z,z=p*g.ang2X+x*g.ang2Y+f*g.ang2Z,Z=u*g.ang2X+y*g.ang2Y+v*g.ang2Z,X.invMAng2X=Y,X.invMAng2Y=z,X.invMAng2Z=Z}else X.invMAng1X=0,X.invMAng1Y=0,X.invMAng1Z=0,X.invMAng2X=0,X.invMAng2Y=0,X.invMAng2Z=0}let V=0;for(;V<X;){let s=V++,a=t.rows[s].jacobian,o=s;for(;o<X;){let n=o++,e=i[n],r=a.lin1X*e.invMLin1X+a.lin1Y*e.invMLin1Y+a.lin1Z*e.invMLin1Z+(a.ang1X*e.invMAng1X+a.ang1Y*e.invMAng1Y+a.ang1Z*e.invMAng1Z)+(a.lin2X*e.invMLin2X+a.lin2Y*e.invMLin2Y+a.lin2Z*e.invMLin2Z)+(a.ang2X*e.invMAng2X+a.ang2Y*e.invMAng2Y+a.ang2Z*e.invMAng2Z);s==n?(d[s][n]=r+t.rows[s].cfm,g[s][n]=r,e.mass=r+t.rows[s].cfm,e.massWithoutCfm=r,0!=e.mass&&(e.mass=1/e.mass),0!=e.massWithoutCfm&&(e.massWithoutCfm=1/e.massWithoutCfm)):(d[s][n]=r,d[n][s]=r,g[s][n]=r,g[n][s]=r)}}let L=0,w=this._maxSubmatrixId;for(;L<w;)this._cacheComputed[L++]=!1}},s.dynamics.constraint.solver.pgs||(s.dynamics.constraint.solver.pgs={}),s.dynamics.constraint.solver.pgs.PgsContactConstraintSolver=class extends s.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.constraint=t,this.info=new s.dynamics.constraint.info.contact.ContactSolverInfo,this.massData=new Array(s.common.Setting.maxManifoldPoints);let i=0,a=this.massData.length;for(;i<a;)this.massData[i++]=new s.dynamics.constraint.solver.common.ContactSolverMassDataRow}preSolveVelocity(t){this.constraint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v=this._b1._invMass,d=this._b2._invMass;i=this._b1._invInertia00,s=this._b1._invInertia01,a=this._b1._invInertia02,o=this._b1._invInertia10,n=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,l=this._b1._invInertia22,h=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,p=this._b2._invInertia11,x=this._b2._invInertia12,f=this._b2._invInertia20,u=this._b2._invInertia21,y=this._b2._invInertia22;let g=0,X=this.info.numRows;for(;g<X;){let t,X,Y,z,Z,M,I=g++,V=this.info.rows[I],L=this.massData[I],w=V.jacobianN;L.invMLinN1X=w.lin1X*v,L.invMLinN1Y=w.lin1Y*v,L.invMLinN1Z=w.lin1Z*v,L.invMLinN2X=w.lin2X*d,L.invMLinN2Y=w.lin2Y*d,L.invMLinN2Z=w.lin2Z*d,t=i*w.ang1X+s*w.ang1Y+a*w.ang1Z,X=o*w.ang1X+n*w.ang1Y+e*w.ang1Z,Y=r*w.ang1X+_*w.ang1Y+l*w.ang1Z,L.invMAngN1X=t,L.invMAngN1Y=X,L.invMAngN1Z=Y,z=h*w.ang2X+c*w.ang2Y+m*w.ang2Z,Z=b*w.ang2X+p*w.ang2Y+x*w.ang2Z,M=f*w.ang2X+u*w.ang2Y+y*w.ang2Z,L.invMAngN2X=z,L.invMAngN2Y=Z,L.invMAngN2Z=M,L.massN=v+d+(L.invMAngN1X*w.ang1X+L.invMAngN1Y*w.ang1Y+L.invMAngN1Z*w.ang1Z)+(L.invMAngN2X*w.ang2X+L.invMAngN2Y*w.ang2Y+L.invMAngN2Z*w.ang2Z),0!=L.massN&&(L.massN=1/L.massN);let k,A,B,P,S,T,C,j,R,E,q,N,D=V.jacobianT,F=V.jacobianB;L.invMLinT1X=D.lin1X*v,L.invMLinT1Y=D.lin1Y*v,L.invMLinT1Z=D.lin1Z*v,L.invMLinT2X=D.lin2X*d,L.invMLinT2Y=D.lin2Y*d,L.invMLinT2Z=D.lin2Z*d,L.invMLinB1X=F.lin1X*v,L.invMLinB1Y=F.lin1Y*v,L.invMLinB1Z=F.lin1Z*v,L.invMLinB2X=F.lin2X*d,L.invMLinB2Y=F.lin2Y*d,L.invMLinB2Z=F.lin2Z*d,k=i*D.ang1X+s*D.ang1Y+a*D.ang1Z,A=o*D.ang1X+n*D.ang1Y+e*D.ang1Z,B=r*D.ang1X+_*D.ang1Y+l*D.ang1Z,L.invMAngT1X=k,L.invMAngT1Y=A,L.invMAngT1Z=B,P=h*D.ang2X+c*D.ang2Y+m*D.ang2Z,S=b*D.ang2X+p*D.ang2Y+x*D.ang2Z,T=f*D.ang2X+u*D.ang2Y+y*D.ang2Z,L.invMAngT2X=P,L.invMAngT2Y=S,L.invMAngT2Z=T,C=i*F.ang1X+s*F.ang1Y+a*F.ang1Z,j=o*F.ang1X+n*F.ang1Y+e*F.ang1Z,R=r*F.ang1X+_*F.ang1Y+l*F.ang1Z,L.invMAngB1X=C,L.invMAngB1Y=j,L.invMAngB1Z=R,E=h*F.ang2X+c*F.ang2Y+m*F.ang2Z,q=b*F.ang2X+p*F.ang2Y+x*F.ang2Z,N=f*F.ang2X+u*F.ang2Y+y*F.ang2Z,L.invMAngB2X=E,L.invMAngB2Y=q,L.invMAngB2Z=N;let H=v+d+(L.invMAngT1X*D.ang1X+L.invMAngT1Y*D.ang1Y+L.invMAngT1Z*D.ang1Z)+(L.invMAngT2X*D.ang2X+L.invMAngT2Y*D.ang2Y+L.invMAngT2Z*D.ang2Z),G=L.invMAngT1X*F.ang1X+L.invMAngT1Y*F.ang1Y+L.invMAngT1Z*F.ang1Z+(L.invMAngT2X*F.ang2X+L.invMAngT2Y*F.ang2Y+L.invMAngT2Z*F.ang2Z),W=v+d+(L.invMAngB1X*F.ang1X+L.invMAngB1Y*F.ang1Y+L.invMAngB1Z*F.ang1Z)+(L.invMAngB2X*F.ang2X+L.invMAngB2Y*F.ang2Y+L.invMAngB2Z*F.ang2Z),O=H*W-G*G;0!=O&&(O=1/O),L.massTB00=W*O,L.massTB01=-G*O,L.massTB10=-G*O,L.massTB11=H*O}}warmStart(t){let i,s,a,o,n,e,r,_,l,h,c,m;i=this._b1._velX,s=this._b1._velY,a=this._b1._velZ,o=this._b2._velX,n=this._b2._velY,e=this._b2._velZ,r=this._b1._angVelX,_=this._b1._angVelY,l=this._b1._angVelZ,h=this._b2._angVelX,c=this._b2._angVelY,m=this._b2._angVelZ;let b=0,p=this.info.numRows;for(;b<p;){let p=b++,x=this.info.rows[p],f=x.impulse,u=this.massData[p],y=x.jacobianT,v=x.jacobianB,d=f.impulseN,g=f.impulseLX*y.lin1X+f.impulseLY*y.lin1Y+f.impulseLZ*y.lin1Z,X=f.impulseLX*v.lin1X+f.impulseLY*v.lin1Y+f.impulseLZ*v.lin1Z;f.impulseT=g,f.impulseB=X,f.impulseN*=t.dtRatio,f.impulseT*=t.dtRatio,f.impulseB*=t.dtRatio,i+=u.invMLinN1X*d,s+=u.invMLinN1Y*d,a+=u.invMLinN1Z*d,i+=u.invMLinT1X*g,s+=u.invMLinT1Y*g,a+=u.invMLinT1Z*g,i+=u.invMLinB1X*X,s+=u.invMLinB1Y*X,a+=u.invMLinB1Z*X,o+=u.invMLinN2X*-d,n+=u.invMLinN2Y*-d,e+=u.invMLinN2Z*-d,o+=u.invMLinT2X*-g,n+=u.invMLinT2Y*-g,e+=u.invMLinT2Z*-g,o+=u.invMLinB2X*-X,n+=u.invMLinB2Y*-X,e+=u.invMLinB2Z*-X,r+=u.invMAngN1X*d,_+=u.invMAngN1Y*d,l+=u.invMAngN1Z*d,r+=u.invMAngT1X*g,_+=u.invMAngT1Y*g,l+=u.invMAngT1Z*g,r+=u.invMAngB1X*X,_+=u.invMAngB1Y*X,l+=u.invMAngB1Z*X,h+=u.invMAngN2X*-d,c+=u.invMAngN2Y*-d,m+=u.invMAngN2Z*-d,h+=u.invMAngT2X*-g,c+=u.invMAngT2Y*-g,m+=u.invMAngT2Z*-g,h+=u.invMAngB2X*-X,c+=u.invMAngB2Y*-X,m+=u.invMAngB2Z*-X}this._b1._velX=i,this._b1._velY=s,this._b1._velZ=a,this._b2._velX=o,this._b2._velY=n,this._b2._velZ=e,this._b1._angVelX=r,this._b1._angVelY=_,this._b1._angVelZ=l,this._b2._angVelX=h,this._b2._angVelY=c,this._b2._angVelZ=m}solveVelocity(){let t,i,s,a,o,n,e,r,_,l,h,c;t=this._b1._velX,i=this._b1._velY,s=this._b1._velZ,a=this._b2._velX,o=this._b2._velY,n=this._b2._velZ,e=this._b1._angVelX,r=this._b1._angVelY,_=this._b1._angVelZ,l=this._b2._angVelX,h=this._b2._angVelY,c=this._b2._angVelZ;let m=0,b=this.info.numRows;for(;m<b;){let b=m++,p=this.info.rows[b],x=this.massData[b],f=p.impulse,u=0,y=p.jacobianT;u+=t*y.lin1X+i*y.lin1Y+s*y.lin1Z,u-=a*y.lin2X+o*y.lin2Y+n*y.lin2Z,u+=e*y.ang1X+r*y.ang1Y+_*y.ang1Z,u-=l*y.ang2X+h*y.ang2Y+c*y.ang2Z;let v=0;y=p.jacobianB,v+=t*y.lin1X+i*y.lin1Y+s*y.lin1Z,v-=a*y.lin2X+o*y.lin2Y+n*y.lin2Z,v+=e*y.ang1X+r*y.ang1Y+_*y.ang1Z,v-=l*y.ang2X+h*y.ang2Y+c*y.ang2Z;let d=-(u*x.massTB00+v*x.massTB01),g=-(u*x.massTB10+v*x.massTB11),X=f.impulseT,Y=f.impulseB;f.impulseT+=d,f.impulseB+=g;let z=p.friction*f.impulseN;if(0==z)f.impulseT=0,f.impulseB=0;else{let t=f.impulseT*f.impulseT+f.impulseB*f.impulseB;if(t>z*z){let i=z/Math.sqrt(t);f.impulseT*=i,f.impulseB*=i}}d=f.impulseT-X,g=f.impulseB-Y,t+=x.invMLinT1X*d,i+=x.invMLinT1Y*d,s+=x.invMLinT1Z*d,t+=x.invMLinB1X*g,i+=x.invMLinB1Y*g,s+=x.invMLinB1Z*g,a+=x.invMLinT2X*-d,o+=x.invMLinT2Y*-d,n+=x.invMLinT2Z*-d,a+=x.invMLinB2X*-g,o+=x.invMLinB2Y*-g,n+=x.invMLinB2Z*-g,e+=x.invMAngT1X*d,r+=x.invMAngT1Y*d,_+=x.invMAngT1Z*d,e+=x.invMAngB1X*g,r+=x.invMAngB1Y*g,_+=x.invMAngB1Z*g,l+=x.invMAngT2X*-d,h+=x.invMAngT2Y*-d,c+=x.invMAngT2Z*-d,l+=x.invMAngB2X*-g,h+=x.invMAngB2Y*-g,c+=x.invMAngB2Z*-g}let p=0,x=this.info.numRows;for(;p<x;){let m=p++,b=this.info.rows[m],x=this.massData[m],f=b.impulse,u=0,y=b.jacobianN;u+=t*y.lin1X+i*y.lin1Y+s*y.lin1Z,u-=a*y.lin2X+o*y.lin2Y+n*y.lin2Z,u+=e*y.ang1X+r*y.ang1Y+_*y.ang1Z,u-=l*y.ang2X+h*y.ang2Y+c*y.ang2Z;let v=(b.rhs-u)*x.massN,d=f.impulseN;f.impulseN+=v,f.impulseN<0&&(f.impulseN=0),v=f.impulseN-d,t+=x.invMLinN1X*v,i+=x.invMLinN1Y*v,s+=x.invMLinN1Z*v,a+=x.invMLinN2X*-v,o+=x.invMLinN2Y*-v,n+=x.invMLinN2Z*-v,e+=x.invMAngN1X*v,r+=x.invMAngN1Y*v,_+=x.invMAngN1Z*v,l+=x.invMAngN2X*-v,h+=x.invMAngN2Y*-v,c+=x.invMAngN2Z*-v}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=s,this._b2._velX=a,this._b2._velY=o,this._b2._velZ=n,this._b1._angVelX=e,this._b1._angVelY=r,this._b1._angVelZ=_,this._b2._angVelX=l,this._b2._angVelY=h,this._b2._angVelZ=c}preSolvePosition(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v=this._b1._invMass,d=this._b2._invMass;i=this._b1._invInertia00,s=this._b1._invInertia01,a=this._b1._invInertia02,o=this._b1._invInertia10,n=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,l=this._b1._invInertia22,h=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,p=this._b2._invInertia11,x=this._b2._invInertia12,f=this._b2._invInertia20,u=this._b2._invInertia21,y=this._b2._invInertia22;let g=0,X=this.info.numRows;for(;g<X;){let t,X,Y,z,Z,M,I=g++,V=this.massData[I],L=this.info.rows[I].jacobianN;V.invMLinN1X=L.lin1X*v,V.invMLinN1Y=L.lin1Y*v,V.invMLinN1Z=L.lin1Z*v,V.invMLinN2X=L.lin2X*d,V.invMLinN2Y=L.lin2Y*d,V.invMLinN2Z=L.lin2Z*d,t=i*L.ang1X+s*L.ang1Y+a*L.ang1Z,X=o*L.ang1X+n*L.ang1Y+e*L.ang1Z,Y=r*L.ang1X+_*L.ang1Y+l*L.ang1Z,V.invMAngN1X=t,V.invMAngN1Y=X,V.invMAngN1Z=Y,z=h*L.ang2X+c*L.ang2Y+m*L.ang2Z,Z=b*L.ang2X+p*L.ang2Y+x*L.ang2Z,M=f*L.ang2X+u*L.ang2Y+y*L.ang2Z,V.invMAngN2X=z,V.invMAngN2Y=Z,V.invMAngN2Z=M,V.massN=v+d+(V.invMAngN1X*L.ang1X+V.invMAngN1Y*L.ang1Y+V.invMAngN1Z*L.ang1Z)+(V.invMAngN2X*L.ang2X+V.invMAngN2Y*L.ang2Y+V.invMAngN2Z*L.ang2Z),0!=V.massN&&(V.massN=1/V.massN)}let Y=0,z=this.info.numRows;for(;Y<z;)this.info.rows[Y++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,i,a,o,n,e,r,_,l,h,c,m;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,a=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,n=this._b2._pseudoVelY,e=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,_=this._b1._angPseudoVelY,l=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,c=this._b2._angPseudoVelY,m=this._b2._angPseudoVelZ;let b=0,p=this.info.numRows;for(;b<p;){let p=b++,x=this.info.rows[p],f=this.massData[p],u=x.impulse,y=x.jacobianN,v=0;v+=t*y.lin1X+i*y.lin1Y+a*y.lin1Z,v-=o*y.lin2X+n*y.lin2Y+e*y.lin2Z,v+=r*y.ang1X+_*y.ang1Y+l*y.ang1Z,v-=h*y.ang2X+c*y.ang2Y+m*y.ang2Z;let d=(x.rhs-v)*f.massN*s.common.Setting.positionSplitImpulseBaumgarte,g=u.impulseP;u.impulseP+=d,u.impulseP<0&&(u.impulseP=0),d=u.impulseP-g,t+=f.invMLinN1X*d,i+=f.invMLinN1Y*d,a+=f.invMLinN1Z*d,o+=f.invMLinN2X*-d,n+=f.invMLinN2Y*-d,e+=f.invMLinN2Z*-d,r+=f.invMAngN1X*d,_+=f.invMAngN1Y*d,l+=f.invMAngN1Z*d,h+=f.invMAngN2X*-d,c+=f.invMAngN2Y*-d,m+=f.invMAngN2Z*-d}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=a,this._b2._pseudoVelX=o,this._b2._pseudoVelY=n,this._b2._pseudoVelZ=e,this._b1._angPseudoVelX=r,this._b1._angPseudoVelY=_,this._b1._angPseudoVelZ=l,this._b2._angPseudoVelX=h,this._b2._angPseudoVelY=c,this._b2._angPseudoVelZ=m}solvePositionNgs(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);let i,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d=this._b1._invMass,g=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,o=this._b1._invInertia02,n=this._b1._invInertia10,e=this._b1._invInertia11,r=this._b1._invInertia12,_=this._b1._invInertia20,l=this._b1._invInertia21,h=this._b1._invInertia22,c=this._b2._invInertia00,m=this._b2._invInertia01,b=this._b2._invInertia02,p=this._b2._invInertia10,x=this._b2._invInertia11,f=this._b2._invInertia12,u=this._b2._invInertia20,y=this._b2._invInertia21,v=this._b2._invInertia22;let X,Y,z,Z,M,I,V,L,w,k,A,B,P=0,S=this.info.numRows;for(;P<S;){let t,s,X,Y,z,Z,M=P++,I=this.massData[M],V=this.info.rows[M].jacobianN;I.invMLinN1X=V.lin1X*d,I.invMLinN1Y=V.lin1Y*d,I.invMLinN1Z=V.lin1Z*d,I.invMLinN2X=V.lin2X*g,I.invMLinN2Y=V.lin2Y*g,I.invMLinN2Z=V.lin2Z*g,t=i*V.ang1X+a*V.ang1Y+o*V.ang1Z,s=n*V.ang1X+e*V.ang1Y+r*V.ang1Z,X=_*V.ang1X+l*V.ang1Y+h*V.ang1Z,I.invMAngN1X=t,I.invMAngN1Y=s,I.invMAngN1Z=X,Y=c*V.ang2X+m*V.ang2Y+b*V.ang2Z,z=p*V.ang2X+x*V.ang2Y+f*V.ang2Z,Z=u*V.ang2X+y*V.ang2Y+v*V.ang2Z,I.invMAngN2X=Y,I.invMAngN2Y=z,I.invMAngN2Z=Z,I.massN=d+g+(I.invMAngN1X*V.ang1X+I.invMAngN1Y*V.ang1Y+I.invMAngN1Z*V.ang1Z)+(I.invMAngN2X*V.ang2X+I.invMAngN2Y*V.ang2Y+I.invMAngN2Z*V.ang2Z),0!=I.massN&&(I.massN=1/I.massN)}X=0,Y=0,z=0,Z=0,M=0,I=0,V=0,L=0,w=0,k=0,A=0,B=0;let T=0,C=this.info.numRows;for(;T<C;){let t=T++,i=this.info.rows[t],a=this.massData[t],o=i.impulse,n=i.jacobianN,e=0;e+=X*n.lin1X+Y*n.lin1Y+z*n.lin1Z,e-=Z*n.lin2X+M*n.lin2Y+I*n.lin2Z,e+=V*n.ang1X+L*n.ang1Y+w*n.ang1Z,e-=k*n.ang2X+A*n.ang2Y+B*n.ang2Z;let r=(i.rhs-e)*a.massN*s.common.Setting.positionNgsBaumgarte,_=o.impulseP;o.impulseP+=r,o.impulseP<0&&(o.impulseP=0),r=o.impulseP-_,X+=a.invMLinN1X*r,Y+=a.invMLinN1Y*r,z+=a.invMLinN1Z*r,Z+=a.invMLinN2X*-r,M+=a.invMLinN2Y*-r,I+=a.invMLinN2Z*-r,V+=a.invMAngN1X*r,L+=a.invMAngN1Y*r,w+=a.invMAngN1Z*r,k+=a.invMAngN2X*-r,A+=a.invMAngN2Y*-r,B+=a.invMAngN2Z*-r}let j=this._b1;j._transform._positionX+=X,j._transform._positionY+=Y,j._transform._positionZ+=z;let R=this._b2;R._transform._positionX+=Z,R._transform._positionY+=M,R._transform._positionZ+=I;let E,q,N,D,F,H,G,W,O,J,U,Q,K,$=this._b1,tt=Math.sqrt(V*V+L*L+w*w),it=.5*tt;if(it<.5){let t=it*it;E=.5*(1-.16666666666666666*t+t*t*.008333333333333333),q=1-.5*t+t*t*.041666666666666664}else E=Math.sin(it)/tt,q=Math.cos(it);N=V*E,D=L*E,F=w*E,H=N,G=D,W=F,O=q;let st,at=$._transform._rotation00,ot=$._transform._rotation11,nt=$._transform._rotation22,et=at+ot+nt;et>0?(st=Math.sqrt(et+1),K=.5*st,st=.5/st,J=($._transform._rotation21-$._transform._rotation12)*st,U=($._transform._rotation02-$._transform._rotation20)*st,Q=($._transform._rotation10-$._transform._rotation01)*st):at>ot?at>nt?(st=Math.sqrt(at-ot-nt+1),J=.5*st,st=.5/st,U=($._transform._rotation01+$._transform._rotation10)*st,Q=($._transform._rotation02+$._transform._rotation20)*st,K=($._transform._rotation21-$._transform._rotation12)*st):(st=Math.sqrt(nt-at-ot+1),Q=.5*st,st=.5/st,J=($._transform._rotation02+$._transform._rotation20)*st,U=($._transform._rotation12+$._transform._rotation21)*st,K=($._transform._rotation10-$._transform._rotation01)*st):ot>nt?(st=Math.sqrt(ot-nt-at+1),U=.5*st,st=.5/st,J=($._transform._rotation01+$._transform._rotation10)*st,Q=($._transform._rotation12+$._transform._rotation21)*st,K=($._transform._rotation02-$._transform._rotation20)*st):(st=Math.sqrt(nt-at-ot+1),Q=.5*st,st=.5/st,J=($._transform._rotation02+$._transform._rotation20)*st,U=($._transform._rotation12+$._transform._rotation21)*st,K=($._transform._rotation10-$._transform._rotation01)*st),J=O*J+H*K+G*Q-W*U,U=O*U-H*Q+G*K+W*J,Q=O*Q+H*U-G*J+W*K,K=O*K-H*J-G*U-W*Q;let rt=J*J+U*U+Q*Q+K*K;rt>1e-32&&(rt=1/Math.sqrt(rt)),J*=rt,U*=rt,Q*=rt,K*=rt;let _t,lt,ht,ct,mt,bt,pt,xt,ft,ut,yt,vt,dt,gt,Xt,Yt,zt,Zt,Mt=2*J,It=2*U,Vt=2*Q,Lt=J*Mt,wt=U*It,kt=Q*Vt,At=J*It,Bt=U*Vt,Pt=J*Vt,St=K*Mt,Tt=K*It,Ct=K*Vt;$._transform._rotation00=1-wt-kt,$._transform._rotation01=At-Ct,$._transform._rotation02=Pt+Tt,$._transform._rotation10=At+Ct,$._transform._rotation11=1-Lt-kt,$._transform._rotation12=Bt-St,$._transform._rotation20=Pt-Tt,$._transform._rotation21=Bt+St,$._transform._rotation22=1-Lt-wt,_t=$._transform._rotation00*$._invLocalInertia00+$._transform._rotation01*$._invLocalInertia10+$._transform._rotation02*$._invLocalInertia20,lt=$._transform._rotation00*$._invLocalInertia01+$._transform._rotation01*$._invLocalInertia11+$._transform._rotation02*$._invLocalInertia21,ht=$._transform._rotation00*$._invLocalInertia02+$._transform._rotation01*$._invLocalInertia12+$._transform._rotation02*$._invLocalInertia22,ct=$._transform._rotation10*$._invLocalInertia00+$._transform._rotation11*$._invLocalInertia10+$._transform._rotation12*$._invLocalInertia20,mt=$._transform._rotation10*$._invLocalInertia01+$._transform._rotation11*$._invLocalInertia11+$._transform._rotation12*$._invLocalInertia21,bt=$._transform._rotation10*$._invLocalInertia02+$._transform._rotation11*$._invLocalInertia12+$._transform._rotation12*$._invLocalInertia22,pt=$._transform._rotation20*$._invLocalInertia00+$._transform._rotation21*$._invLocalInertia10+$._transform._rotation22*$._invLocalInertia20,xt=$._transform._rotation20*$._invLocalInertia01+$._transform._rotation21*$._invLocalInertia11+$._transform._rotation22*$._invLocalInertia21,ft=$._transform._rotation20*$._invLocalInertia02+$._transform._rotation21*$._invLocalInertia12+$._transform._rotation22*$._invLocalInertia22,$._invInertia00=_t,$._invInertia01=lt,$._invInertia02=ht,$._invInertia10=ct,$._invInertia11=mt,$._invInertia12=bt,$._invInertia20=pt,$._invInertia21=xt,$._invInertia22=ft,ut=$._invInertia00*$._transform._rotation00+$._invInertia01*$._transform._rotation01+$._invInertia02*$._transform._rotation02,yt=$._invInertia00*$._transform._rotation10+$._invInertia01*$._transform._rotation11+$._invInertia02*$._transform._rotation12,vt=$._invInertia00*$._transform._rotation20+$._invInertia01*$._transform._rotation21+$._invInertia02*$._transform._rotation22,dt=$._invInertia10*$._transform._rotation00+$._invInertia11*$._transform._rotation01+$._invInertia12*$._transform._rotation02,gt=$._invInertia10*$._transform._rotation10+$._invInertia11*$._transform._rotation11+$._invInertia12*$._transform._rotation12,Xt=$._invInertia10*$._transform._rotation20+$._invInertia11*$._transform._rotation21+$._invInertia12*$._transform._rotation22,Yt=$._invInertia20*$._transform._rotation00+$._invInertia21*$._transform._rotation01+$._invInertia22*$._transform._rotation02,zt=$._invInertia20*$._transform._rotation10+$._invInertia21*$._transform._rotation11+$._invInertia22*$._transform._rotation12,Zt=$._invInertia20*$._transform._rotation20+$._invInertia21*$._transform._rotation21+$._invInertia22*$._transform._rotation22,$._invInertia00=ut,$._invInertia01=yt,$._invInertia02=vt,$._invInertia10=dt,$._invInertia11=gt,$._invInertia12=Xt,$._invInertia20=Yt,$._invInertia21=zt,$._invInertia22=Zt,$._invInertia00*=$._rotFactor.x,$._invInertia01*=$._rotFactor.x,$._invInertia02*=$._rotFactor.x,$._invInertia10*=$._rotFactor.y,$._invInertia11*=$._rotFactor.y,$._invInertia12*=$._rotFactor.y,$._invInertia20*=$._rotFactor.z,$._invInertia21*=$._rotFactor.z,$._invInertia22*=$._rotFactor.z;let jt,Rt,Et,qt,Nt,Dt,Ft,Ht,Gt,Wt,Ot,Jt,Ut,Qt=this._b2,Kt=Math.sqrt(k*k+A*A+B*B),$t=.5*Kt;if($t<.5){let t=$t*$t;jt=.5*(1-.16666666666666666*t+t*t*.008333333333333333),Rt=1-.5*t+t*t*.041666666666666664}else jt=Math.sin($t)/Kt,Rt=Math.cos($t);Et=k*jt,qt=A*jt,Nt=B*jt,Dt=Et,Ft=qt,Ht=Nt,Gt=Rt;let ti,ii=Qt._transform._rotation00,si=Qt._transform._rotation11,ai=Qt._transform._rotation22,oi=ii+si+ai;oi>0?(ti=Math.sqrt(oi+1),Ut=.5*ti,ti=.5/ti,Wt=(Qt._transform._rotation21-Qt._transform._rotation12)*ti,Ot=(Qt._transform._rotation02-Qt._transform._rotation20)*ti,Jt=(Qt._transform._rotation10-Qt._transform._rotation01)*ti):ii>si?ii>ai?(ti=Math.sqrt(ii-si-ai+1),Wt=.5*ti,ti=.5/ti,Ot=(Qt._transform._rotation01+Qt._transform._rotation10)*ti,Jt=(Qt._transform._rotation02+Qt._transform._rotation20)*ti,Ut=(Qt._transform._rotation21-Qt._transform._rotation12)*ti):(ti=Math.sqrt(ai-ii-si+1),Jt=.5*ti,ti=.5/ti,Wt=(Qt._transform._rotation02+Qt._transform._rotation20)*ti,Ot=(Qt._transform._rotation12+Qt._transform._rotation21)*ti,Ut=(Qt._transform._rotation10-Qt._transform._rotation01)*ti):si>ai?(ti=Math.sqrt(si-ai-ii+1),Ot=.5*ti,ti=.5/ti,Wt=(Qt._transform._rotation01+Qt._transform._rotation10)*ti,Jt=(Qt._transform._rotation12+Qt._transform._rotation21)*ti,Ut=(Qt._transform._rotation02-Qt._transform._rotation20)*ti):(ti=Math.sqrt(ai-ii-si+1),Jt=.5*ti,ti=.5/ti,Wt=(Qt._transform._rotation02+Qt._transform._rotation20)*ti,Ot=(Qt._transform._rotation12+Qt._transform._rotation21)*ti,Ut=(Qt._transform._rotation10-Qt._transform._rotation01)*ti),Wt=Gt*Wt+Dt*Ut+Ft*Jt-Ht*Ot,Ot=Gt*Ot-Dt*Jt+Ft*Ut+Ht*Wt,Jt=Gt*Jt+Dt*Ot-Ft*Wt+Ht*Ut,Ut=Gt*Ut-Dt*Wt-Ft*Ot-Ht*Jt;let ni=Wt*Wt+Ot*Ot+Jt*Jt+Ut*Ut;ni>1e-32&&(ni=1/Math.sqrt(ni)),Wt*=ni,Ot*=ni,Jt*=ni,Ut*=ni;let ei,ri,_i,li,hi,ci,mi,bi,pi,xi,fi,ui,yi,vi,di,gi,Xi,Yi,zi=2*Wt,Zi=2*Ot,Mi=2*Jt,Ii=Wt*zi,Vi=Ot*Zi,Li=Jt*Mi,wi=Wt*Zi,ki=Ot*Mi,Ai=Wt*Mi,Bi=Ut*zi,Pi=Ut*Zi,Si=Ut*Mi;Qt._transform._rotation00=1-Vi-Li,Qt._transform._rotation01=wi-Si,Qt._transform._rotation02=Ai+Pi,Qt._transform._rotation10=wi+Si,Qt._transform._rotation11=1-Ii-Li,Qt._transform._rotation12=ki-Bi,Qt._transform._rotation20=Ai-Pi,Qt._transform._rotation21=ki+Bi,Qt._transform._rotation22=1-Ii-Vi,ei=Qt._transform._rotation00*Qt._invLocalInertia00+Qt._transform._rotation01*Qt._invLocalInertia10+Qt._transform._rotation02*Qt._invLocalInertia20,ri=Qt._transform._rotation00*Qt._invLocalInertia01+Qt._transform._rotation01*Qt._invLocalInertia11+Qt._transform._rotation02*Qt._invLocalInertia21,_i=Qt._transform._rotation00*Qt._invLocalInertia02+Qt._transform._rotation01*Qt._invLocalInertia12+Qt._transform._rotation02*Qt._invLocalInertia22,li=Qt._transform._rotation10*Qt._invLocalInertia00+Qt._transform._rotation11*Qt._invLocalInertia10+Qt._transform._rotation12*Qt._invLocalInertia20,hi=Qt._transform._rotation10*Qt._invLocalInertia01+Qt._transform._rotation11*Qt._invLocalInertia11+Qt._transform._rotation12*Qt._invLocalInertia21,ci=Qt._transform._rotation10*Qt._invLocalInertia02+Qt._transform._rotation11*Qt._invLocalInertia12+Qt._transform._rotation12*Qt._invLocalInertia22,mi=Qt._transform._rotation20*Qt._invLocalInertia00+Qt._transform._rotation21*Qt._invLocalInertia10+Qt._transform._rotation22*Qt._invLocalInertia20,bi=Qt._transform._rotation20*Qt._invLocalInertia01+Qt._transform._rotation21*Qt._invLocalInertia11+Qt._transform._rotation22*Qt._invLocalInertia21,pi=Qt._transform._rotation20*Qt._invLocalInertia02+Qt._transform._rotation21*Qt._invLocalInertia12+Qt._transform._rotation22*Qt._invLocalInertia22,Qt._invInertia00=ei,Qt._invInertia01=ri,Qt._invInertia02=_i,Qt._invInertia10=li,Qt._invInertia11=hi,Qt._invInertia12=ci,Qt._invInertia20=mi,Qt._invInertia21=bi,Qt._invInertia22=pi,xi=Qt._invInertia00*Qt._transform._rotation00+Qt._invInertia01*Qt._transform._rotation01+Qt._invInertia02*Qt._transform._rotation02,fi=Qt._invInertia00*Qt._transform._rotation10+Qt._invInertia01*Qt._transform._rotation11+Qt._invInertia02*Qt._transform._rotation12,ui=Qt._invInertia00*Qt._transform._rotation20+Qt._invInertia01*Qt._transform._rotation21+Qt._invInertia02*Qt._transform._rotation22,yi=Qt._invInertia10*Qt._transform._rotation00+Qt._invInertia11*Qt._transform._rotation01+Qt._invInertia12*Qt._transform._rotation02,vi=Qt._invInertia10*Qt._transform._rotation10+Qt._invInertia11*Qt._transform._rotation11+Qt._invInertia12*Qt._transform._rotation12,di=Qt._invInertia10*Qt._transform._rotation20+Qt._invInertia11*Qt._transform._rotation21+Qt._invInertia12*Qt._transform._rotation22,gi=Qt._invInertia20*Qt._transform._rotation00+Qt._invInertia21*Qt._transform._rotation01+Qt._invInertia22*Qt._transform._rotation02,Xi=Qt._invInertia20*Qt._transform._rotation10+Qt._invInertia21*Qt._transform._rotation11+Qt._invInertia22*Qt._transform._rotation12,Yi=Qt._invInertia20*Qt._transform._rotation20+Qt._invInertia21*Qt._transform._rotation21+Qt._invInertia22*Qt._transform._rotation22,Qt._invInertia00=xi,Qt._invInertia01=fi,Qt._invInertia02=ui,Qt._invInertia10=yi,Qt._invInertia11=vi,Qt._invInertia12=di,Qt._invInertia20=gi,Qt._invInertia21=Xi,Qt._invInertia22=Yi,Qt._invInertia00*=Qt._rotFactor.x,Qt._invInertia01*=Qt._rotFactor.x,Qt._invInertia02*=Qt._rotFactor.x,Qt._invInertia10*=Qt._rotFactor.y,Qt._invInertia11*=Qt._rotFactor.y,Qt._invInertia12*=Qt._rotFactor.y,Qt._invInertia20*=Qt._rotFactor.z,Qt._invInertia21*=Qt._rotFactor.z,Qt._invInertia22*=Qt._rotFactor.z}postSolve(){let t,i,s,a,o,n,e,r,_;t=0,i=0,s=0,a=0,o=0,n=0,e=0,r=0,_=0;let l=0,h=this.info.numRows;for(;l<h;){let h,c,m,b=this.info.rows[l++],p=b.impulse,x=b.jacobianN,f=b.jacobianT,u=b.jacobianB,y=p.impulseN,v=p.impulseT,d=p.impulseB;h=0,c=0,m=0,h+=f.lin1X*v,c+=f.lin1Y*v,m+=f.lin1Z*v,h+=u.lin1X*d,c+=u.lin1Y*d,m+=u.lin1Z*d,p.impulseLX=h,p.impulseLY=c,p.impulseLZ=m,t+=x.lin1X*y,i+=x.lin1Y*y,s+=x.lin1Z*y,a+=x.ang1X*y,o+=x.ang1Y*y,n+=x.ang1Z*y,e+=x.ang2X*y,r+=x.ang2Y*y,_+=x.ang2Z*y,t+=f.lin1X*v,i+=f.lin1Y*v,s+=f.lin1Z*v,a+=f.ang1X*v,o+=f.ang1Y*v,n+=f.ang1Z*v,e+=f.ang2X*v,r+=f.ang2Y*v,_+=f.ang2Z*v,t+=u.lin1X*d,i+=u.lin1Y*d,s+=u.lin1Z*d,a+=u.ang1X*d,o+=u.ang1Y*d,n+=u.ang1Z*d,e+=u.ang2X*d,r+=u.ang2Y*d,_+=u.ang2Z*d}this._b1._linearContactImpulseX+=t,this._b1._linearContactImpulseY+=i,this._b1._linearContactImpulseZ+=s,this._b1._angularContactImpulseX+=a,this._b1._angularContactImpulseY+=o,this._b1._angularContactImpulseZ+=n,this._b2._linearContactImpulseX-=t,this._b2._linearContactImpulseY-=i,this._b2._linearContactImpulseZ-=s,this._b2._angularContactImpulseX-=e,this._b2._angularContactImpulseY-=r,this._b2._angularContactImpulseZ-=_,this.constraint._syncManifold()}},s.dynamics.constraint.solver.pgs.PgsJointConstraintSolver=class extends s.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.joint=t,this.info=new s.dynamics.constraint.info.joint.JointSolverInfo,this.massData=new Array(s.common.Setting.maxJacobianRows);let i=0,a=this.massData.length;for(;i<a;)this.massData[i++]=new s.dynamics.constraint.solver.common.JointSolverMassDataRow}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v=this._b1._invMass,d=this._b2._invMass;i=this._b1._invInertia00,s=this._b1._invInertia01,a=this._b1._invInertia02,o=this._b1._invInertia10,n=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,l=this._b1._invInertia22,h=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,p=this._b2._invInertia11,x=this._b2._invInertia12,f=this._b2._invInertia20,u=this._b2._invInertia21,y=this._b2._invInertia22;let g=0,X=this.info.numRows;for(;g<X;){let t=g++,X=this.info.rows[t],Y=this.massData[t],z=X.jacobian;if(z.updateSparsity(),0!=(1&z.flag)?(Y.invMLin1X=z.lin1X*v,Y.invMLin1Y=z.lin1Y*v,Y.invMLin1Z=z.lin1Z*v,Y.invMLin2X=z.lin2X*d,Y.invMLin2Y=z.lin2Y*d,Y.invMLin2Z=z.lin2Z*d):(Y.invMLin1X=0,Y.invMLin1Y=0,Y.invMLin1Z=0,Y.invMLin2X=0,Y.invMLin2Y=0,Y.invMLin2Z=0),0!=(2&z.flag)){let t,v,d,g,X,Z;t=i*z.ang1X+s*z.ang1Y+a*z.ang1Z,v=o*z.ang1X+n*z.ang1Y+e*z.ang1Z,d=r*z.ang1X+_*z.ang1Y+l*z.ang1Z,Y.invMAng1X=t,Y.invMAng1Y=v,Y.invMAng1Z=d,g=h*z.ang2X+c*z.ang2Y+m*z.ang2Z,X=b*z.ang2X+p*z.ang2Y+x*z.ang2Z,Z=f*z.ang2X+u*z.ang2Y+y*z.ang2Z,Y.invMAng2X=g,Y.invMAng2Y=X,Y.invMAng2Z=Z}else Y.invMAng1X=0,Y.invMAng1Y=0,Y.invMAng1Z=0,Y.invMAng2X=0,Y.invMAng2Y=0,Y.invMAng2Z=0;Y.massWithoutCfm=Y.invMLin1X*z.lin1X+Y.invMLin1Y*z.lin1Y+Y.invMLin1Z*z.lin1Z+(Y.invMLin2X*z.lin2X+Y.invMLin2Y*z.lin2Y+Y.invMLin2Z*z.lin2Z)+(Y.invMAng1X*z.ang1X+Y.invMAng1Y*z.ang1Y+Y.invMAng1Z*z.ang1Z)+(Y.invMAng2X*z.ang2X+Y.invMAng2Y*z.ang2Y+Y.invMAng2Z*z.ang2Z),Y.mass=Y.massWithoutCfm+X.cfm,0!=Y.massWithoutCfm&&(Y.massWithoutCfm=1/Y.massWithoutCfm),0!=Y.mass&&(Y.mass=1/Y.mass)}}warmStart(t){let i,a,o,n,e,r,_,l,h,c,m,b,p=this.joint._positionCorrectionAlgorithm==s.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?s.common.Setting.jointWarmStartingFactorForBaungarte:s.common.Setting.jointWarmStartingFactor;if(p*=t.dtRatio,p<=0){let t=0,i=this.info.numRows;for(;t<i;){let i=this.info.rows[t++].impulse;i.impulse=0,i.impulseM=0,i.impulseP=0}return}i=this._b1._velX,a=this._b1._velY,o=this._b1._velZ,n=this._b2._velX,e=this._b2._velY,r=this._b2._velZ,_=this._b1._angVelX,l=this._b1._angVelY,h=this._b1._angVelZ,c=this._b2._angVelX,m=this._b2._angVelY,b=this._b2._angVelZ;let x=0,f=this.info.numRows;for(;x<f;){let t=x++,s=this.massData[t],f=this.info.rows[t].impulse;f.impulse*=p,f.impulseM*=p;let u=f.impulse+f.impulseM;i+=s.invMLin1X*u,a+=s.invMLin1Y*u,o+=s.invMLin1Z*u,n+=s.invMLin2X*-u,e+=s.invMLin2Y*-u,r+=s.invMLin2Z*-u,_+=s.invMAng1X*u,l+=s.invMAng1Y*u,h+=s.invMAng1Z*u,c+=s.invMAng2X*-u,m+=s.invMAng2Y*-u,b+=s.invMAng2Z*-u}this._b1._velX=i,this._b1._velY=a,this._b1._velZ=o,this._b2._velX=n,this._b2._velY=e,this._b2._velZ=r,this._b1._angVelX=_,this._b1._angVelY=l,this._b1._angVelZ=h,this._b2._angVelX=c,this._b2._angVelY=m,this._b2._angVelZ=b}solveVelocity(){let t,i,s,a,o,n,e,r,_,l,h,c;t=this._b1._velX,i=this._b1._velY,s=this._b1._velZ,a=this._b2._velX,o=this._b2._velY,n=this._b2._velZ,e=this._b1._angVelX,r=this._b1._angVelY,_=this._b1._angVelZ,l=this._b2._angVelX,h=this._b2._angVelY,c=this._b2._angVelZ;let m=0,b=this.info.numRows;for(;m<b;){let b=m++,p=this.info.rows[b],x=this.massData[b],f=p.impulse,u=p.jacobian;if(0==p.motorMaxImpulse)continue;let y=0;y+=t*u.lin1X+i*u.lin1Y+s*u.lin1Z,y-=a*u.lin2X+o*u.lin2Y+n*u.lin2Z,y+=e*u.ang1X+r*u.ang1Y+_*u.ang1Z,y-=l*u.ang2X+h*u.ang2Y+c*u.ang2Z;let v=(-p.motorSpeed-y)*x.massWithoutCfm,d=f.impulseM;f.impulseM+=v,f.impulseM<-p.motorMaxImpulse?f.impulseM=-p.motorMaxImpulse:f.impulseM>p.motorMaxImpulse&&(f.impulseM=p.motorMaxImpulse),v=f.impulseM-d,0!=(1&u.flag)&&(t+=x.invMLin1X*v,i+=x.invMLin1Y*v,s+=x.invMLin1Z*v,a+=x.invMLin2X*-v,o+=x.invMLin2Y*-v,n+=x.invMLin2Z*-v),0!=(2&u.flag)&&(e+=x.invMAng1X*v,r+=x.invMAng1Y*v,_+=x.invMAng1Z*v,l+=x.invMAng2X*-v,h+=x.invMAng2Y*-v,c+=x.invMAng2Z*-v)}let p=0,x=this.info.numRows;for(;p<x;){let m=p++,b=this.info.rows[m],x=this.massData[m],f=b.impulse,u=b.jacobian,y=0;y+=t*u.lin1X+i*u.lin1Y+s*u.lin1Z,y-=a*u.lin2X+o*u.lin2Y+n*u.lin2Z,y+=e*u.ang1X+r*u.ang1Y+_*u.ang1Z,y-=l*u.ang2X+h*u.ang2Y+c*u.ang2Z;let v=(b.rhs-y-f.impulse*b.cfm)*x.mass,d=f.impulse;f.impulse+=v,f.impulse<b.minImpulse?f.impulse=b.minImpulse:f.impulse>b.maxImpulse&&(f.impulse=b.maxImpulse),v=f.impulse-d,0!=(1&u.flag)&&(t+=x.invMLin1X*v,i+=x.invMLin1Y*v,s+=x.invMLin1Z*v,a+=x.invMLin2X*-v,o+=x.invMLin2Y*-v,n+=x.invMLin2Z*-v),0!=(2&u.flag)&&(e+=x.invMAng1X*v,r+=x.invMAng1Y*v,_+=x.invMAng1Z*v,l+=x.invMAng2X*-v,h+=x.invMAng2Y*-v,c+=x.invMAng2Z*-v)}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=s,this._b2._velX=a,this._b2._velY=o,this._b2._velZ=n,this._b1._angVelX=e,this._b1._angVelY=r,this._b1._angVelZ=_,this._b2._angVelX=l,this._b2._angVelY=h,this._b2._angVelZ=c}postSolveVelocity(t){let i,s,a,o,n,e;i=0,s=0,a=0,o=0,n=0,e=0;let r=0,_=this.info.numRows;for(;r<_;){let t=this.info.rows[r++],_=t.impulse,l=t.jacobian;0!=(1&l.flag)?(i+=l.lin1X*_.impulse,s+=l.lin1Y*_.impulse,a+=l.lin1Z*_.impulse):0!=(2&l.flag)&&(o+=l.ang1X*_.impulse,n+=l.ang1Y*_.impulse,e+=l.ang1Z*_.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=s*t.invDt,this.joint._appliedForceZ=a*t.invDt,this.joint._appliedTorqueX=o*t.invDt,this.joint._appliedTorqueY=n*t.invDt,this.joint._appliedTorqueZ=e*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v=this._b1._invMass,d=this._b2._invMass;i=this._b1._invInertia00,s=this._b1._invInertia01,a=this._b1._invInertia02,o=this._b1._invInertia10,n=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,l=this._b1._invInertia22,h=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,p=this._b2._invInertia11,x=this._b2._invInertia12,f=this._b2._invInertia20,u=this._b2._invInertia21,y=this._b2._invInertia22;let g=0,X=this.info.numRows;for(;g<X;){let t,X,Y,z,Z,M,I=g++,V=this.massData[I],L=this.info.rows[I].jacobian;V.invMLin1X=L.lin1X*v,V.invMLin1Y=L.lin1Y*v,V.invMLin1Z=L.lin1Z*v,V.invMLin2X=L.lin2X*d,V.invMLin2Y=L.lin2Y*d,V.invMLin2Z=L.lin2Z*d,t=i*L.ang1X+s*L.ang1Y+a*L.ang1Z,X=o*L.ang1X+n*L.ang1Y+e*L.ang1Z,Y=r*L.ang1X+_*L.ang1Y+l*L.ang1Z,V.invMAng1X=t,V.invMAng1Y=X,V.invMAng1Z=Y,z=h*L.ang2X+c*L.ang2Y+m*L.ang2Z,Z=b*L.ang2X+p*L.ang2Y+x*L.ang2Z,M=f*L.ang2X+u*L.ang2Y+y*L.ang2Z,V.invMAng2X=z,V.invMAng2Y=Z,V.invMAng2Z=M,V.mass=V.invMLin1X*L.lin1X+V.invMLin1Y*L.lin1Y+V.invMLin1Z*L.lin1Z+(V.invMLin2X*L.lin2X+V.invMLin2Y*L.lin2Y+V.invMLin2Z*L.lin2Z)+(V.invMAng1X*L.ang1X+V.invMAng1Y*L.ang1Y+V.invMAng1Z*L.ang1Z)+(V.invMAng2X*L.ang2X+V.invMAng2Y*L.ang2Y+V.invMAng2Z*L.ang2Z),0!=V.mass&&(V.mass=1/V.mass)}let Y=0,z=this.info.numRows;for(;Y<z;)this.info.rows[Y++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,i,a,o,n,e,r,_,l,h,c,m;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,a=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,n=this._b2._pseudoVelY,e=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,_=this._b1._angPseudoVelY,l=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,c=this._b2._angPseudoVelY,m=this._b2._angPseudoVelZ;let b=0,p=this.info.numRows;for(;b<p;){let p=b++,x=this.info.rows[p],f=this.massData[p],u=x.impulse,y=x.jacobian,v=0;v+=t*y.lin1X+i*y.lin1Y+a*y.lin1Z,v-=o*y.lin2X+n*y.lin2Y+e*y.lin2Z,v+=r*y.ang1X+_*y.ang1Y+l*y.ang1Z,v-=h*y.ang2X+c*y.ang2Y+m*y.ang2Z;let d=(x.rhs*s.common.Setting.positionSplitImpulseBaumgarte-v)*f.mass,g=u.impulseP;u.impulseP+=d,u.impulseP<x.minImpulse?u.impulseP=x.minImpulse:u.impulseP>x.maxImpulse&&(u.impulseP=x.maxImpulse),d=u.impulseP-g,t+=f.invMLin1X*d,i+=f.invMLin1Y*d,a+=f.invMLin1Z*d,o+=f.invMLin2X*-d,n+=f.invMLin2Y*-d,e+=f.invMLin2Z*-d,r+=f.invMAng1X*d,_+=f.invMAng1Y*d,l+=f.invMAng1Z*d,h+=f.invMAng2X*-d,c+=f.invMAng2Y*-d,m+=f.invMAng2Z*-d}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=a,this._b2._pseudoVelX=o,this._b2._pseudoVelY=n,this._b2._pseudoVelZ=e,this._b1._angPseudoVelX=r,this._b1._angPseudoVelY=_,this._b1._angPseudoVelZ=l,this._b2._angPseudoVelX=h,this._b2._angPseudoVelY=c,this._b2._angPseudoVelZ=m}solvePositionNgs(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d=this._b1._invMass,g=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,o=this._b1._invInertia02,n=this._b1._invInertia10,e=this._b1._invInertia11,r=this._b1._invInertia12,_=this._b1._invInertia20,l=this._b1._invInertia21,h=this._b1._invInertia22,c=this._b2._invInertia00,m=this._b2._invInertia01,b=this._b2._invInertia02,p=this._b2._invInertia10,x=this._b2._invInertia11,f=this._b2._invInertia12,u=this._b2._invInertia20,y=this._b2._invInertia21,v=this._b2._invInertia22;let X,Y,z,Z,M,I,V,L,w,k,A,B,P=0,S=this.info.numRows;for(;P<S;){let t,s,X,Y,z,Z,M=P++,I=this.massData[M],V=this.info.rows[M].jacobian;I.invMLin1X=V.lin1X*d,I.invMLin1Y=V.lin1Y*d,I.invMLin1Z=V.lin1Z*d,I.invMLin2X=V.lin2X*g,I.invMLin2Y=V.lin2Y*g,I.invMLin2Z=V.lin2Z*g,t=i*V.ang1X+a*V.ang1Y+o*V.ang1Z,s=n*V.ang1X+e*V.ang1Y+r*V.ang1Z,X=_*V.ang1X+l*V.ang1Y+h*V.ang1Z,I.invMAng1X=t,I.invMAng1Y=s,I.invMAng1Z=X,Y=c*V.ang2X+m*V.ang2Y+b*V.ang2Z,z=p*V.ang2X+x*V.ang2Y+f*V.ang2Z,Z=u*V.ang2X+y*V.ang2Y+v*V.ang2Z,I.invMAng2X=Y,I.invMAng2Y=z,I.invMAng2Z=Z,I.mass=I.invMLin1X*V.lin1X+I.invMLin1Y*V.lin1Y+I.invMLin1Z*V.lin1Z+(I.invMLin2X*V.lin2X+I.invMLin2Y*V.lin2Y+I.invMLin2Z*V.lin2Z)+(I.invMAng1X*V.ang1X+I.invMAng1Y*V.ang1Y+I.invMAng1Z*V.ang1Z)+(I.invMAng2X*V.ang2X+I.invMAng2Y*V.ang2Y+I.invMAng2Z*V.ang2Z),0!=I.mass&&(I.mass=1/I.mass)}X=0,Y=0,z=0,Z=0,M=0,I=0,V=0,L=0,w=0,k=0,A=0,B=0;let T=0,C=this.info.numRows;for(;T<C;){let t=T++,i=this.info.rows[t],a=this.massData[t],o=i.impulse,n=i.jacobian,e=0;e+=X*n.lin1X+Y*n.lin1Y+z*n.lin1Z,e-=Z*n.lin2X+M*n.lin2Y+I*n.lin2Z,e+=V*n.ang1X+L*n.ang1Y+w*n.ang1Z,e-=k*n.ang2X+A*n.ang2Y+B*n.ang2Z;let r=(i.rhs*s.common.Setting.positionNgsBaumgarte-e)*a.mass,_=o.impulseP;o.impulseP+=r,o.impulseP<i.minImpulse?o.impulseP=i.minImpulse:o.impulseP>i.maxImpulse&&(o.impulseP=i.maxImpulse),r=o.impulseP-_,X+=a.invMLin1X*r,Y+=a.invMLin1Y*r,z+=a.invMLin1Z*r,Z+=a.invMLin2X*-r,M+=a.invMLin2Y*-r,I+=a.invMLin2Z*-r,V+=a.invMAng1X*r,L+=a.invMAng1Y*r,w+=a.invMAng1Z*r,k+=a.invMAng2X*-r,A+=a.invMAng2Y*-r,B+=a.invMAng2Z*-r}let j=this._b1;j._transform._positionX+=X,j._transform._positionY+=Y,j._transform._positionZ+=z;let R=this._b2;R._transform._positionX+=Z,R._transform._positionY+=M,R._transform._positionZ+=I;let E,q,N,D,F,H,G,W,O,J,U,Q,K,$=this._b1,tt=Math.sqrt(V*V+L*L+w*w),it=.5*tt;if(it<.5){let t=it*it;E=.5*(1-.16666666666666666*t+t*t*.008333333333333333),q=1-.5*t+t*t*.041666666666666664}else E=Math.sin(it)/tt,q=Math.cos(it);N=V*E,D=L*E,F=w*E,H=N,G=D,W=F,O=q;let st,at=$._transform._rotation00,ot=$._transform._rotation11,nt=$._transform._rotation22,et=at+ot+nt;et>0?(st=Math.sqrt(et+1),K=.5*st,st=.5/st,J=($._transform._rotation21-$._transform._rotation12)*st,U=($._transform._rotation02-$._transform._rotation20)*st,Q=($._transform._rotation10-$._transform._rotation01)*st):at>ot?at>nt?(st=Math.sqrt(at-ot-nt+1),J=.5*st,st=.5/st,U=($._transform._rotation01+$._transform._rotation10)*st,Q=($._transform._rotation02+$._transform._rotation20)*st,K=($._transform._rotation21-$._transform._rotation12)*st):(st=Math.sqrt(nt-at-ot+1),Q=.5*st,st=.5/st,J=($._transform._rotation02+$._transform._rotation20)*st,U=($._transform._rotation12+$._transform._rotation21)*st,K=($._transform._rotation10-$._transform._rotation01)*st):ot>nt?(st=Math.sqrt(ot-nt-at+1),U=.5*st,st=.5/st,J=($._transform._rotation01+$._transform._rotation10)*st,Q=($._transform._rotation12+$._transform._rotation21)*st,K=($._transform._rotation02-$._transform._rotation20)*st):(st=Math.sqrt(nt-at-ot+1),Q=.5*st,st=.5/st,J=($._transform._rotation02+$._transform._rotation20)*st,U=($._transform._rotation12+$._transform._rotation21)*st,K=($._transform._rotation10-$._transform._rotation01)*st),J=O*J+H*K+G*Q-W*U,U=O*U-H*Q+G*K+W*J,Q=O*Q+H*U-G*J+W*K,K=O*K-H*J-G*U-W*Q;let rt=J*J+U*U+Q*Q+K*K;rt>1e-32&&(rt=1/Math.sqrt(rt)),J*=rt,U*=rt,Q*=rt,K*=rt;let _t,lt,ht,ct,mt,bt,pt,xt,ft,ut,yt,vt,dt,gt,Xt,Yt,zt,Zt,Mt=2*J,It=2*U,Vt=2*Q,Lt=J*Mt,wt=U*It,kt=Q*Vt,At=J*It,Bt=U*Vt,Pt=J*Vt,St=K*Mt,Tt=K*It,Ct=K*Vt;$._transform._rotation00=1-wt-kt,$._transform._rotation01=At-Ct,$._transform._rotation02=Pt+Tt,$._transform._rotation10=At+Ct,$._transform._rotation11=1-Lt-kt,$._transform._rotation12=Bt-St,$._transform._rotation20=Pt-Tt,$._transform._rotation21=Bt+St,$._transform._rotation22=1-Lt-wt,_t=$._transform._rotation00*$._invLocalInertia00+$._transform._rotation01*$._invLocalInertia10+$._transform._rotation02*$._invLocalInertia20,lt=$._transform._rotation00*$._invLocalInertia01+$._transform._rotation01*$._invLocalInertia11+$._transform._rotation02*$._invLocalInertia21,ht=$._transform._rotation00*$._invLocalInertia02+$._transform._rotation01*$._invLocalInertia12+$._transform._rotation02*$._invLocalInertia22,ct=$._transform._rotation10*$._invLocalInertia00+$._transform._rotation11*$._invLocalInertia10+$._transform._rotation12*$._invLocalInertia20,mt=$._transform._rotation10*$._invLocalInertia01+$._transform._rotation11*$._invLocalInertia11+$._transform._rotation12*$._invLocalInertia21,bt=$._transform._rotation10*$._invLocalInertia02+$._transform._rotation11*$._invLocalInertia12+$._transform._rotation12*$._invLocalInertia22,pt=$._transform._rotation20*$._invLocalInertia00+$._transform._rotation21*$._invLocalInertia10+$._transform._rotation22*$._invLocalInertia20,xt=$._transform._rotation20*$._invLocalInertia01+$._transform._rotation21*$._invLocalInertia11+$._transform._rotation22*$._invLocalInertia21,ft=$._transform._rotation20*$._invLocalInertia02+$._transform._rotation21*$._invLocalInertia12+$._transform._rotation22*$._invLocalInertia22,$._invInertia00=_t,$._invInertia01=lt,$._invInertia02=ht,$._invInertia10=ct,$._invInertia11=mt,$._invInertia12=bt,$._invInertia20=pt,$._invInertia21=xt,$._invInertia22=ft,ut=$._invInertia00*$._transform._rotation00+$._invInertia01*$._transform._rotation01+$._invInertia02*$._transform._rotation02,yt=$._invInertia00*$._transform._rotation10+$._invInertia01*$._transform._rotation11+$._invInertia02*$._transform._rotation12,vt=$._invInertia00*$._transform._rotation20+$._invInertia01*$._transform._rotation21+$._invInertia02*$._transform._rotation22,dt=$._invInertia10*$._transform._rotation00+$._invInertia11*$._transform._rotation01+$._invInertia12*$._transform._rotation02,gt=$._invInertia10*$._transform._rotation10+$._invInertia11*$._transform._rotation11+$._invInertia12*$._transform._rotation12,Xt=$._invInertia10*$._transform._rotation20+$._invInertia11*$._transform._rotation21+$._invInertia12*$._transform._rotation22,Yt=$._invInertia20*$._transform._rotation00+$._invInertia21*$._transform._rotation01+$._invInertia22*$._transform._rotation02,zt=$._invInertia20*$._transform._rotation10+$._invInertia21*$._transform._rotation11+$._invInertia22*$._transform._rotation12,Zt=$._invInertia20*$._transform._rotation20+$._invInertia21*$._transform._rotation21+$._invInertia22*$._transform._rotation22,$._invInertia00=ut,$._invInertia01=yt,$._invInertia02=vt,$._invInertia10=dt,$._invInertia11=gt,$._invInertia12=Xt,$._invInertia20=Yt,$._invInertia21=zt,$._invInertia22=Zt,$._invInertia00*=$._rotFactor.x,$._invInertia01*=$._rotFactor.x,$._invInertia02*=$._rotFactor.x,$._invInertia10*=$._rotFactor.y,$._invInertia11*=$._rotFactor.y,$._invInertia12*=$._rotFactor.y,$._invInertia20*=$._rotFactor.z,$._invInertia21*=$._rotFactor.z,$._invInertia22*=$._rotFactor.z;let jt,Rt,Et,qt,Nt,Dt,Ft,Ht,Gt,Wt,Ot,Jt,Ut,Qt=this._b2,Kt=Math.sqrt(k*k+A*A+B*B),$t=.5*Kt;if($t<.5){let t=$t*$t;jt=.5*(1-.16666666666666666*t+t*t*.008333333333333333),Rt=1-.5*t+t*t*.041666666666666664}else jt=Math.sin($t)/Kt,Rt=Math.cos($t);Et=k*jt,qt=A*jt,Nt=B*jt,Dt=Et,Ft=qt,Ht=Nt,Gt=Rt;let ti,ii=Qt._transform._rotation00,si=Qt._transform._rotation11,ai=Qt._transform._rotation22,oi=ii+si+ai;oi>0?(ti=Math.sqrt(oi+1),Ut=.5*ti,ti=.5/ti,Wt=(Qt._transform._rotation21-Qt._transform._rotation12)*ti,Ot=(Qt._transform._rotation02-Qt._transform._rotation20)*ti,Jt=(Qt._transform._rotation10-Qt._transform._rotation01)*ti):ii>si?ii>ai?(ti=Math.sqrt(ii-si-ai+1),Wt=.5*ti,ti=.5/ti,Ot=(Qt._transform._rotation01+Qt._transform._rotation10)*ti,Jt=(Qt._transform._rotation02+Qt._transform._rotation20)*ti,Ut=(Qt._transform._rotation21-Qt._transform._rotation12)*ti):(ti=Math.sqrt(ai-ii-si+1),Jt=.5*ti,ti=.5/ti,Wt=(Qt._transform._rotation02+Qt._transform._rotation20)*ti,Ot=(Qt._transform._rotation12+Qt._transform._rotation21)*ti,Ut=(Qt._transform._rotation10-Qt._transform._rotation01)*ti):si>ai?(ti=Math.sqrt(si-ai-ii+1),Ot=.5*ti,ti=.5/ti,Wt=(Qt._transform._rotation01+Qt._transform._rotation10)*ti,Jt=(Qt._transform._rotation12+Qt._transform._rotation21)*ti,Ut=(Qt._transform._rotation02-Qt._transform._rotation20)*ti):(ti=Math.sqrt(ai-ii-si+1),Jt=.5*ti,ti=.5/ti,Wt=(Qt._transform._rotation02+Qt._transform._rotation20)*ti,Ot=(Qt._transform._rotation12+Qt._transform._rotation21)*ti,Ut=(Qt._transform._rotation10-Qt._transform._rotation01)*ti),Wt=Gt*Wt+Dt*Ut+Ft*Jt-Ht*Ot,Ot=Gt*Ot-Dt*Jt+Ft*Ut+Ht*Wt,Jt=Gt*Jt+Dt*Ot-Ft*Wt+Ht*Ut,Ut=Gt*Ut-Dt*Wt-Ft*Ot-Ht*Jt;let ni=Wt*Wt+Ot*Ot+Jt*Jt+Ut*Ut;ni>1e-32&&(ni=1/Math.sqrt(ni)),Wt*=ni,Ot*=ni,Jt*=ni,Ut*=ni;let ei,ri,_i,li,hi,ci,mi,bi,pi,xi,fi,ui,yi,vi,di,gi,Xi,Yi,zi=2*Wt,Zi=2*Ot,Mi=2*Jt,Ii=Wt*zi,Vi=Ot*Zi,Li=Jt*Mi,wi=Wt*Zi,ki=Ot*Mi,Ai=Wt*Mi,Bi=Ut*zi,Pi=Ut*Zi,Si=Ut*Mi;Qt._transform._rotation00=1-Vi-Li,Qt._transform._rotation01=wi-Si,Qt._transform._rotation02=Ai+Pi,Qt._transform._rotation10=wi+Si,Qt._transform._rotation11=1-Ii-Li,Qt._transform._rotation12=ki-Bi,Qt._transform._rotation20=Ai-Pi,Qt._transform._rotation21=ki+Bi,Qt._transform._rotation22=1-Ii-Vi,ei=Qt._transform._rotation00*Qt._invLocalInertia00+Qt._transform._rotation01*Qt._invLocalInertia10+Qt._transform._rotation02*Qt._invLocalInertia20,ri=Qt._transform._rotation00*Qt._invLocalInertia01+Qt._transform._rotation01*Qt._invLocalInertia11+Qt._transform._rotation02*Qt._invLocalInertia21,_i=Qt._transform._rotation00*Qt._invLocalInertia02+Qt._transform._rotation01*Qt._invLocalInertia12+Qt._transform._rotation02*Qt._invLocalInertia22,li=Qt._transform._rotation10*Qt._invLocalInertia00+Qt._transform._rotation11*Qt._invLocalInertia10+Qt._transform._rotation12*Qt._invLocalInertia20,hi=Qt._transform._rotation10*Qt._invLocalInertia01+Qt._transform._rotation11*Qt._invLocalInertia11+Qt._transform._rotation12*Qt._invLocalInertia21,ci=Qt._transform._rotation10*Qt._invLocalInertia02+Qt._transform._rotation11*Qt._invLocalInertia12+Qt._transform._rotation12*Qt._invLocalInertia22,mi=Qt._transform._rotation20*Qt._invLocalInertia00+Qt._transform._rotation21*Qt._invLocalInertia10+Qt._transform._rotation22*Qt._invLocalInertia20,bi=Qt._transform._rotation20*Qt._invLocalInertia01+Qt._transform._rotation21*Qt._invLocalInertia11+Qt._transform._rotation22*Qt._invLocalInertia21,pi=Qt._transform._rotation20*Qt._invLocalInertia02+Qt._transform._rotation21*Qt._invLocalInertia12+Qt._transform._rotation22*Qt._invLocalInertia22,Qt._invInertia00=ei,Qt._invInertia01=ri,Qt._invInertia02=_i,Qt._invInertia10=li,Qt._invInertia11=hi,Qt._invInertia12=ci,Qt._invInertia20=mi,Qt._invInertia21=bi,Qt._invInertia22=pi,xi=Qt._invInertia00*Qt._transform._rotation00+Qt._invInertia01*Qt._transform._rotation01+Qt._invInertia02*Qt._transform._rotation02,fi=Qt._invInertia00*Qt._transform._rotation10+Qt._invInertia01*Qt._transform._rotation11+Qt._invInertia02*Qt._transform._rotation12,ui=Qt._invInertia00*Qt._transform._rotation20+Qt._invInertia01*Qt._transform._rotation21+Qt._invInertia02*Qt._transform._rotation22,yi=Qt._invInertia10*Qt._transform._rotation00+Qt._invInertia11*Qt._transform._rotation01+Qt._invInertia12*Qt._transform._rotation02,vi=Qt._invInertia10*Qt._transform._rotation10+Qt._invInertia11*Qt._transform._rotation11+Qt._invInertia12*Qt._transform._rotation12,di=Qt._invInertia10*Qt._transform._rotation20+Qt._invInertia11*Qt._transform._rotation21+Qt._invInertia12*Qt._transform._rotation22,gi=Qt._invInertia20*Qt._transform._rotation00+Qt._invInertia21*Qt._transform._rotation01+Qt._invInertia22*Qt._transform._rotation02,Xi=Qt._invInertia20*Qt._transform._rotation10+Qt._invInertia21*Qt._transform._rotation11+Qt._invInertia22*Qt._transform._rotation12,Yi=Qt._invInertia20*Qt._transform._rotation20+Qt._invInertia21*Qt._transform._rotation21+Qt._invInertia22*Qt._transform._rotation22,Qt._invInertia00=xi,Qt._invInertia01=fi,Qt._invInertia02=ui,Qt._invInertia10=yi,Qt._invInertia11=vi,Qt._invInertia12=di,Qt._invInertia20=gi,Qt._invInertia21=Xi,Qt._invInertia22=Yi,Qt._invInertia00*=Qt._rotFactor.x,Qt._invInertia01*=Qt._rotFactor.x,Qt._invInertia02*=Qt._rotFactor.x,Qt._invInertia10*=Qt._rotFactor.y,Qt._invInertia11*=Qt._rotFactor.y,Qt._invInertia12*=Qt._rotFactor.y,Qt._invInertia20*=Qt._rotFactor.z,Qt._invInertia21*=Qt._rotFactor.z,Qt._invInertia22*=Qt._rotFactor.z}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}},s.dynamics.rigidbody||(s.dynamics.rigidbody={}),s.dynamics.rigidbody.MassData=class{constructor(){this.mass=0,this.localInertia=new s.common.Mat3}},s.dynamics.rigidbody.RigidBody=class{constructor(t){this._next=null,this._prev=null,this._shapeList=null,this._shapeListLast=null,this._numShapes=0,this._contactLinkList=null,this._contactLinkListLast=null,this._numContactLinks=0,this._jointLinkList=null,this._jointLinkListLast=null,this._numJointLinks=0;let i=t.linearVelocity;this._velX=i.x,this._velY=i.y,this._velZ=i.z;let a=t.angularVelocity;this._angVelX=a.x,this._angVelY=a.y,this._angVelZ=a.z,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._ptransform=new s.common.Transform,this._transform=new s.common.Transform;let o=t.position;this._ptransform._positionX=o.x,this._ptransform._positionY=o.y,this._ptransform._positionZ=o.z;let n=t.rotation;this._ptransform._rotation00=n.e00,this._ptransform._rotation01=n.e01,this._ptransform._rotation02=n.e02,this._ptransform._rotation10=n.e10,this._ptransform._rotation11=n.e11,this._ptransform._rotation12=n.e12,this._ptransform._rotation20=n.e20,this._ptransform._rotation21=n.e21,this._ptransform._rotation22=n.e22;let e=this._transform,r=this._ptransform;e._positionX=r._positionX,e._positionY=r._positionY,e._positionZ=r._positionZ,e._rotation00=r._rotation00,e._rotation01=r._rotation01,e._rotation02=r._rotation02,e._rotation10=r._rotation10,e._rotation11=r._rotation11,e._rotation12=r._rotation12,e._rotation20=r._rotation20,e._rotation21=r._rotation21,e._rotation22=r._rotation22,this._type=t.type,this._sleepTime=0,this._sleeping=!1,this._autoSleep=t.autoSleep,this._mass=0,this._invMass=0,this._localInertia00=0,this._localInertia01=0,this._localInertia02=0,this._localInertia10=0,this._localInertia11=0,this._localInertia12=0,this._localInertia20=0,this._localInertia21=0,this._localInertia22=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._invInertia00=0,this._invInertia01=0,this._invInertia02=0,this._invInertia10=0,this._invInertia11=0,this._invInertia12=0,this._invInertia20=0,this._invInertia21=0,this._invInertia22=0,this._linearDamping=t.linearDamping,this._angularDamping=t.angularDamping,this._forceX=0,this._forceY=0,this._forceZ=0,this._torqueX=0,this._torqueY=0,this._torqueZ=0,this._linearContactImpulseX=0,this._linearContactImpulseY=0,this._linearContactImpulseZ=0,this._angularContactImpulseX=0,this._angularContactImpulseY=0,this._angularContactImpulseZ=0,this._rotFactor=new s.common.Vec3(1,1,1),this._addedToIsland=!1,this._gravityScale=1,this._world=null}_integrate(t){switch(this._type){case 1:this._velX=0,this._velY=0,this._velZ=0,this._angVelX=0,this._angVelY=0,this._angVelZ=0,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:let i,a,o,n,e,r;i=this._velX*t,a=this._velY*t,o=this._velZ*t,n=this._angVelX*t,e=this._angVelY*t,r=this._angVelZ*t;let _=i*i+a*a+o*o,l=n*n+e*e+r*r;if(0==_&&0==l)return;if(_>s.common.Setting.maxTranslationPerStep*s.common.Setting.maxTranslationPerStep){let t=s.common.Setting.maxTranslationPerStep/Math.sqrt(_);this._velX*=t,this._velY*=t,this._velZ*=t,i*=t,a*=t,o*=t}if(l>s.common.Setting.maxRotationPerStep*s.common.Setting.maxRotationPerStep){let t=s.common.Setting.maxRotationPerStep/Math.sqrt(l);this._angVelX*=t,this._angVelY*=t,this._angVelZ*=t,n*=t,e*=t,r*=t}this._transform._positionX+=i,this._transform._positionY+=a,this._transform._positionZ+=o;let h,c,m,b,p,x,f,u,y,v,d,g,X,Y=Math.sqrt(n*n+e*e+r*r),z=.5*Y;if(z<.5){let t=z*z;h=.5*(1-.16666666666666666*t+t*t*.008333333333333333),c=1-.5*t+t*t*.041666666666666664}else h=Math.sin(z)/Y,c=Math.cos(z);m=n*h,b=e*h,p=r*h,x=m,f=b,u=p,y=c;let Z,M=this._transform._rotation00,I=this._transform._rotation11,V=this._transform._rotation22,L=M+I+V;L>0?(Z=Math.sqrt(L+1),X=.5*Z,Z=.5/Z,v=(this._transform._rotation21-this._transform._rotation12)*Z,d=(this._transform._rotation02-this._transform._rotation20)*Z,g=(this._transform._rotation10-this._transform._rotation01)*Z):M>I?M>V?(Z=Math.sqrt(M-I-V+1),v=.5*Z,Z=.5/Z,d=(this._transform._rotation01+this._transform._rotation10)*Z,g=(this._transform._rotation02+this._transform._rotation20)*Z,X=(this._transform._rotation21-this._transform._rotation12)*Z):(Z=Math.sqrt(V-M-I+1),g=.5*Z,Z=.5/Z,v=(this._transform._rotation02+this._transform._rotation20)*Z,d=(this._transform._rotation12+this._transform._rotation21)*Z,X=(this._transform._rotation10-this._transform._rotation01)*Z):I>V?(Z=Math.sqrt(I-V-M+1),d=.5*Z,Z=.5/Z,v=(this._transform._rotation01+this._transform._rotation10)*Z,g=(this._transform._rotation12+this._transform._rotation21)*Z,X=(this._transform._rotation02-this._transform._rotation20)*Z):(Z=Math.sqrt(V-M-I+1),g=.5*Z,Z=.5/Z,v=(this._transform._rotation02+this._transform._rotation20)*Z,d=(this._transform._rotation12+this._transform._rotation21)*Z,X=(this._transform._rotation10-this._transform._rotation01)*Z),v=y*v+x*X+f*g-u*d,d=y*d-x*g+f*X+u*v,g=y*g+x*d-f*v+u*X,X=y*X-x*v-f*d-u*g;let w=v*v+d*d+g*g+X*X;w>1e-32&&(w=1/Math.sqrt(w)),v*=w,d*=w,g*=w,X*=w;let k,A,B,P,S,T,C,j,R,E,q,N,D,F,H,G,W,O,J=2*v,U=2*d,Q=2*g,K=v*J,$=d*U,tt=g*Q,it=v*U,st=d*Q,at=v*Q,ot=X*J,nt=X*U,et=X*Q;this._transform._rotation00=1-$-tt,this._transform._rotation01=it-et,this._transform._rotation02=at+nt,this._transform._rotation10=it+et,this._transform._rotation11=1-K-tt,this._transform._rotation12=st-ot,this._transform._rotation20=at-nt,this._transform._rotation21=st+ot,this._transform._rotation22=1-K-$,k=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,A=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,B=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,P=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,S=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,T=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,C=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,j=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,R=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=k,this._invInertia01=A,this._invInertia02=B,this._invInertia10=P,this._invInertia11=S,this._invInertia12=T,this._invInertia20=C,this._invInertia21=j,this._invInertia22=R,E=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,q=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,N=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,D=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,F=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,H=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,G=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,W=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,O=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=E,this._invInertia01=q,this._invInertia02=N,this._invInertia10=D,this._invInertia11=F,this._invInertia12=H,this._invInertia20=G,this._invInertia21=W,this._invInertia22=O,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z}}_integratePseudoVelocity(){if(this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ!=0||this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ!=0)switch(this._type){case 1:this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:let t,i,s,a,o,n;t=this._pseudoVelX,i=this._pseudoVelY,s=this._pseudoVelZ,a=this._angPseudoVelX,o=this._angPseudoVelY,n=this._angPseudoVelZ,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._transform._positionX+=t,this._transform._positionY+=i,this._transform._positionZ+=s;let e,r,_,l,h,c,m,b,p,x,f,u,y,v=Math.sqrt(a*a+o*o+n*n),d=.5*v;if(d<.5){let t=d*d;e=.5*(1-.16666666666666666*t+t*t*.008333333333333333),r=1-.5*t+t*t*.041666666666666664}else e=Math.sin(d)/v,r=Math.cos(d);_=a*e,l=o*e,h=n*e,c=_,m=l,b=h,p=r;let g,X=this._transform._rotation00,Y=this._transform._rotation11,z=this._transform._rotation22,Z=X+Y+z;Z>0?(g=Math.sqrt(Z+1),y=.5*g,g=.5/g,x=(this._transform._rotation21-this._transform._rotation12)*g,f=(this._transform._rotation02-this._transform._rotation20)*g,u=(this._transform._rotation10-this._transform._rotation01)*g):X>Y?X>z?(g=Math.sqrt(X-Y-z+1),x=.5*g,g=.5/g,f=(this._transform._rotation01+this._transform._rotation10)*g,u=(this._transform._rotation02+this._transform._rotation20)*g,y=(this._transform._rotation21-this._transform._rotation12)*g):(g=Math.sqrt(z-X-Y+1),u=.5*g,g=.5/g,x=(this._transform._rotation02+this._transform._rotation20)*g,f=(this._transform._rotation12+this._transform._rotation21)*g,y=(this._transform._rotation10-this._transform._rotation01)*g):Y>z?(g=Math.sqrt(Y-z-X+1),f=.5*g,g=.5/g,x=(this._transform._rotation01+this._transform._rotation10)*g,u=(this._transform._rotation12+this._transform._rotation21)*g,y=(this._transform._rotation02-this._transform._rotation20)*g):(g=Math.sqrt(z-X-Y+1),u=.5*g,g=.5/g,x=(this._transform._rotation02+this._transform._rotation20)*g,f=(this._transform._rotation12+this._transform._rotation21)*g,y=(this._transform._rotation10-this._transform._rotation01)*g),x=p*x+c*y+m*u-b*f,f=p*f-c*u+m*y+b*x,u=p*u+c*f-m*x+b*y,y=p*y-c*x-m*f-b*u;let M=x*x+f*f+u*u+y*y;M>1e-32&&(M=1/Math.sqrt(M)),x*=M,f*=M,u*=M,y*=M;let I,V,L,w,k,A,B,P,S,T,C,j,R,E,q,N,D,F,H=2*x,G=2*f,W=2*u,O=x*H,J=f*G,U=u*W,Q=x*G,K=f*W,$=x*W,tt=y*H,it=y*G,st=y*W;this._transform._rotation00=1-J-U,this._transform._rotation01=Q-st,this._transform._rotation02=$+it,this._transform._rotation10=Q+st,this._transform._rotation11=1-O-U,this._transform._rotation12=K-tt,this._transform._rotation20=$-it,this._transform._rotation21=K+tt,this._transform._rotation22=1-O-J,I=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,V=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,L=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,w=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,k=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,A=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,B=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,P=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,S=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=I,this._invInertia01=V,this._invInertia02=L,this._invInertia10=w,this._invInertia11=k,this._invInertia12=A,this._invInertia20=B,this._invInertia21=P,this._invInertia22=S,T=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,C=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,j=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,R=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,E=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,q=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,N=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,D=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,F=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=T,this._invInertia01=C,this._invInertia02=j,this._invInertia10=R,this._invInertia11=E,this._invInertia12=q,this._invInertia20=N,this._invInertia21=D,this._invInertia22=F,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z}}updateMass(){let t,i,s,a,o,n,e,r,_;t=0,i=0,s=0,a=0,o=0,n=0,e=0,r=0,_=0;let l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I=0,V=this._shapeList;for(;null!=V;){let l=V._next,h=V._geom;h._updateMass();let c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,L,w,k,A,B,P,S,T,C,j,R,E,q,N,D,F,H,G,W,O,J=V._density*h._volume;d=V._localTransform._rotation00*h._inertiaCoeff00+V._localTransform._rotation01*h._inertiaCoeff10+V._localTransform._rotation02*h._inertiaCoeff20,g=V._localTransform._rotation00*h._inertiaCoeff01+V._localTransform._rotation01*h._inertiaCoeff11+V._localTransform._rotation02*h._inertiaCoeff21,X=V._localTransform._rotation00*h._inertiaCoeff02+V._localTransform._rotation01*h._inertiaCoeff12+V._localTransform._rotation02*h._inertiaCoeff22,Y=V._localTransform._rotation10*h._inertiaCoeff00+V._localTransform._rotation11*h._inertiaCoeff10+V._localTransform._rotation12*h._inertiaCoeff20,z=V._localTransform._rotation10*h._inertiaCoeff01+V._localTransform._rotation11*h._inertiaCoeff11+V._localTransform._rotation12*h._inertiaCoeff21,Z=V._localTransform._rotation10*h._inertiaCoeff02+V._localTransform._rotation11*h._inertiaCoeff12+V._localTransform._rotation12*h._inertiaCoeff22,M=V._localTransform._rotation20*h._inertiaCoeff00+V._localTransform._rotation21*h._inertiaCoeff10+V._localTransform._rotation22*h._inertiaCoeff20,L=V._localTransform._rotation20*h._inertiaCoeff01+V._localTransform._rotation21*h._inertiaCoeff11+V._localTransform._rotation22*h._inertiaCoeff21,w=V._localTransform._rotation20*h._inertiaCoeff02+V._localTransform._rotation21*h._inertiaCoeff12+V._localTransform._rotation22*h._inertiaCoeff22,c=d,m=g,b=X,p=Y,x=z,f=Z,u=M,y=L,v=w,k=c*V._localTransform._rotation00+m*V._localTransform._rotation01+b*V._localTransform._rotation02,A=c*V._localTransform._rotation10+m*V._localTransform._rotation11+b*V._localTransform._rotation12,B=c*V._localTransform._rotation20+m*V._localTransform._rotation21+b*V._localTransform._rotation22,P=p*V._localTransform._rotation00+x*V._localTransform._rotation01+f*V._localTransform._rotation02,S=p*V._localTransform._rotation10+x*V._localTransform._rotation11+f*V._localTransform._rotation12,T=p*V._localTransform._rotation20+x*V._localTransform._rotation21+f*V._localTransform._rotation22,C=u*V._localTransform._rotation00+y*V._localTransform._rotation01+v*V._localTransform._rotation02,j=u*V._localTransform._rotation10+y*V._localTransform._rotation11+v*V._localTransform._rotation12,R=u*V._localTransform._rotation20+y*V._localTransform._rotation21+v*V._localTransform._rotation22,c=k,m=A,b=B,p=P,x=S,f=T,u=C,y=j,v=R,c*=J,m*=J,b*=J,p*=J,x*=J,f*=J,u*=J,y*=J,v*=J;let U=V._localTransform._positionX*V._localTransform._positionX,Q=V._localTransform._positionY*V._localTransform._positionY,K=V._localTransform._positionZ*V._localTransform._positionZ,$=-V._localTransform._positionX*V._localTransform._positionY,tt=-V._localTransform._positionY*V._localTransform._positionZ,it=-V._localTransform._positionZ*V._localTransform._positionX;E=Q+K,q=$,N=it,D=$,F=U+K,H=tt,G=it,W=tt,O=U+Q,c+=E*J,m+=q*J,b+=N*J,p+=D*J,x+=F*J,f+=H*J,u+=G*J,y+=W*J,v+=O*J,I+=J,t+=c,i+=m,s+=b,a+=p,o+=x,n+=f,e+=u,r+=y,_+=v,V=l}if(this._mass=I,this._localInertia00=t,this._localInertia01=i,this._localInertia02=s,this._localInertia10=a,this._localInertia11=o,this._localInertia12=n,this._localInertia20=e,this._localInertia21=r,this._localInertia22=_,this._mass>0&&this._localInertia00*(this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21)-this._localInertia01*(this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20)+this._localInertia02*(this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20)>0&&0==this._type){this._invMass=1/this._mass;let t=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,i=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,s=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,a=this._localInertia00*t-this._localInertia01*i+this._localInertia02*s;(a<-1e-32||a>1e-32)&&(a=1/a),this._invLocalInertia00=t*a,this._invLocalInertia01=-(this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21)*a,this._invLocalInertia02=(this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11)*a,this._invLocalInertia10=-i*a,this._invLocalInertia11=(this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20)*a,this._invLocalInertia12=-(this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10)*a,this._invLocalInertia20=s*a,this._invLocalInertia21=-(this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20)*a,this._invLocalInertia22=(this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10)*a,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);l=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,h=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,c=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,m=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,b=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,p=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,x=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,f=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,u=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=l,this._invInertia01=h,this._invInertia02=c,this._invInertia10=m,this._invInertia11=b,this._invInertia12=p,this._invInertia20=x,this._invInertia21=f,this._invInertia22=u,y=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,v=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,d=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,g=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,X=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,Y=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,z=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,Z=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,M=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=y,this._invInertia01=v,this._invInertia02=d,this._invInertia10=g,this._invInertia11=X,this._invInertia12=Y,this._invInertia20=z,this._invInertia21=Z,this._invInertia22=M,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getPosition(){let t=new s.common.Vec3;return t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ,t}getPositionTo(t){t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ}setPosition(t){this._transform._positionX=t.x,this._transform._positionY=t.y,this._transform._positionZ=t.z;let i=this._ptransform,s=this._transform;i._positionX=s._positionX,i._positionY=s._positionY,i._positionZ=s._positionZ,i._rotation00=s._rotation00,i._rotation01=s._rotation01,i._rotation02=s._rotation02,i._rotation10=s._rotation10,i._rotation11=s._rotation11,i._rotation12=s._rotation12,i._rotation20=s._rotation20,i._rotation21=s._rotation21,i._rotation22=s._rotation22;let a=this._shapeList;for(;null!=a;){let t,i,s,o,n,e,r,_,l,h,c,m,b=a._next,p=this._ptransform,x=this._transform,f=a._ptransform,u=a._localTransform;t=p._rotation00*u._rotation00+p._rotation01*u._rotation10+p._rotation02*u._rotation20,i=p._rotation00*u._rotation01+p._rotation01*u._rotation11+p._rotation02*u._rotation21,s=p._rotation00*u._rotation02+p._rotation01*u._rotation12+p._rotation02*u._rotation22,o=p._rotation10*u._rotation00+p._rotation11*u._rotation10+p._rotation12*u._rotation20,n=p._rotation10*u._rotation01+p._rotation11*u._rotation11+p._rotation12*u._rotation21,e=p._rotation10*u._rotation02+p._rotation11*u._rotation12+p._rotation12*u._rotation22,r=p._rotation20*u._rotation00+p._rotation21*u._rotation10+p._rotation22*u._rotation20,_=p._rotation20*u._rotation01+p._rotation21*u._rotation11+p._rotation22*u._rotation21,l=p._rotation20*u._rotation02+p._rotation21*u._rotation12+p._rotation22*u._rotation22,f._rotation00=t,f._rotation01=i,f._rotation02=s,f._rotation10=o,f._rotation11=n,f._rotation12=e,f._rotation20=r,f._rotation21=_,f._rotation22=l,h=p._rotation00*u._positionX+p._rotation01*u._positionY+p._rotation02*u._positionZ,c=p._rotation10*u._positionX+p._rotation11*u._positionY+p._rotation12*u._positionZ,m=p._rotation20*u._positionX+p._rotation21*u._positionY+p._rotation22*u._positionZ,f._positionX=h,f._positionY=c,f._positionZ=m,f._positionX+=p._positionX,f._positionY+=p._positionY,f._positionZ+=p._positionZ;let y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T=a._transform,C=a._localTransform;if(y=x._rotation00*C._rotation00+x._rotation01*C._rotation10+x._rotation02*C._rotation20,v=x._rotation00*C._rotation01+x._rotation01*C._rotation11+x._rotation02*C._rotation21,d=x._rotation00*C._rotation02+x._rotation01*C._rotation12+x._rotation02*C._rotation22,g=x._rotation10*C._rotation00+x._rotation11*C._rotation10+x._rotation12*C._rotation20,X=x._rotation10*C._rotation01+x._rotation11*C._rotation11+x._rotation12*C._rotation21,Y=x._rotation10*C._rotation02+x._rotation11*C._rotation12+x._rotation12*C._rotation22,z=x._rotation20*C._rotation00+x._rotation21*C._rotation10+x._rotation22*C._rotation20,Z=x._rotation20*C._rotation01+x._rotation21*C._rotation11+x._rotation22*C._rotation21,M=x._rotation20*C._rotation02+x._rotation21*C._rotation12+x._rotation22*C._rotation22,T._rotation00=y,T._rotation01=v,T._rotation02=d,T._rotation10=g,T._rotation11=X,T._rotation12=Y,T._rotation20=z,T._rotation21=Z,T._rotation22=M,I=x._rotation00*C._positionX+x._rotation01*C._positionY+x._rotation02*C._positionZ,V=x._rotation10*C._positionX+x._rotation11*C._positionY+x._rotation12*C._positionZ,L=x._rotation20*C._positionX+x._rotation21*C._positionY+x._rotation22*C._positionZ,T._positionX=I,T._positionY=V,T._positionZ=L,T._positionX+=x._positionX,T._positionY+=x._positionY,T._positionZ+=x._positionZ,a._geom._computeAabb(a._aabb,a._ptransform),w=a._aabb._minX,k=a._aabb._minY,A=a._aabb._minZ,B=a._aabb._maxX,P=a._aabb._maxY,S=a._aabb._maxZ,a._geom._computeAabb(a._aabb,a._transform),a._aabb._minX=w<a._aabb._minX?w:a._aabb._minX,a._aabb._minY=k<a._aabb._minY?k:a._aabb._minY,a._aabb._minZ=A<a._aabb._minZ?A:a._aabb._minZ,a._aabb._maxX=B>a._aabb._maxX?B:a._aabb._maxX,a._aabb._maxY=P>a._aabb._maxY?P:a._aabb._maxY,a._aabb._maxZ=S>a._aabb._maxZ?S:a._aabb._maxZ,null!=a._proxy){let t,i,s;t=a._transform._positionX-a._ptransform._positionX,i=a._transform._positionY-a._ptransform._positionY,s=a._transform._positionZ-a._ptransform._positionZ;let o=a.displacement;o.x=t,o.y=i,o.z=s,a._rigidBody._world._broadPhase.moveProxy(a._proxy,a._aabb,a.displacement)}a=b}this._sleeping=!1,this._sleepTime=0}translate(t){let i,s,a;i=t.x,s=t.y,a=t.z,this._transform._positionX+=i,this._transform._positionY+=s,this._transform._positionZ+=a;let o=this._ptransform,n=this._transform;o._positionX=n._positionX,o._positionY=n._positionY,o._positionZ=n._positionZ,o._rotation00=n._rotation00,o._rotation01=n._rotation01,o._rotation02=n._rotation02,o._rotation10=n._rotation10,o._rotation11=n._rotation11,o._rotation12=n._rotation12,o._rotation20=n._rotation20,o._rotation21=n._rotation21,o._rotation22=n._rotation22;let e=this._shapeList;for(;null!=e;){let t,i,s,a,o,n,r,_,l,h,c,m,b=e._next,p=this._ptransform,x=this._transform,f=e._ptransform,u=e._localTransform;t=p._rotation00*u._rotation00+p._rotation01*u._rotation10+p._rotation02*u._rotation20,i=p._rotation00*u._rotation01+p._rotation01*u._rotation11+p._rotation02*u._rotation21,s=p._rotation00*u._rotation02+p._rotation01*u._rotation12+p._rotation02*u._rotation22,a=p._rotation10*u._rotation00+p._rotation11*u._rotation10+p._rotation12*u._rotation20,o=p._rotation10*u._rotation01+p._rotation11*u._rotation11+p._rotation12*u._rotation21,n=p._rotation10*u._rotation02+p._rotation11*u._rotation12+p._rotation12*u._rotation22,r=p._rotation20*u._rotation00+p._rotation21*u._rotation10+p._rotation22*u._rotation20,_=p._rotation20*u._rotation01+p._rotation21*u._rotation11+p._rotation22*u._rotation21,l=p._rotation20*u._rotation02+p._rotation21*u._rotation12+p._rotation22*u._rotation22,f._rotation00=t,f._rotation01=i,f._rotation02=s,f._rotation10=a,f._rotation11=o,f._rotation12=n,f._rotation20=r,f._rotation21=_,f._rotation22=l,h=p._rotation00*u._positionX+p._rotation01*u._positionY+p._rotation02*u._positionZ,c=p._rotation10*u._positionX+p._rotation11*u._positionY+p._rotation12*u._positionZ,m=p._rotation20*u._positionX+p._rotation21*u._positionY+p._rotation22*u._positionZ,f._positionX=h,f._positionY=c,f._positionZ=m,f._positionX+=p._positionX,f._positionY+=p._positionY,f._positionZ+=p._positionZ;let y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T=e._transform,C=e._localTransform;if(y=x._rotation00*C._rotation00+x._rotation01*C._rotation10+x._rotation02*C._rotation20,v=x._rotation00*C._rotation01+x._rotation01*C._rotation11+x._rotation02*C._rotation21,d=x._rotation00*C._rotation02+x._rotation01*C._rotation12+x._rotation02*C._rotation22,g=x._rotation10*C._rotation00+x._rotation11*C._rotation10+x._rotation12*C._rotation20,X=x._rotation10*C._rotation01+x._rotation11*C._rotation11+x._rotation12*C._rotation21,Y=x._rotation10*C._rotation02+x._rotation11*C._rotation12+x._rotation12*C._rotation22,z=x._rotation20*C._rotation00+x._rotation21*C._rotation10+x._rotation22*C._rotation20,Z=x._rotation20*C._rotation01+x._rotation21*C._rotation11+x._rotation22*C._rotation21,M=x._rotation20*C._rotation02+x._rotation21*C._rotation12+x._rotation22*C._rotation22,T._rotation00=y,T._rotation01=v,T._rotation02=d,T._rotation10=g,T._rotation11=X,T._rotation12=Y,T._rotation20=z,T._rotation21=Z,T._rotation22=M,I=x._rotation00*C._positionX+x._rotation01*C._positionY+x._rotation02*C._positionZ,V=x._rotation10*C._positionX+x._rotation11*C._positionY+x._rotation12*C._positionZ,L=x._rotation20*C._positionX+x._rotation21*C._positionY+x._rotation22*C._positionZ,T._positionX=I,T._positionY=V,T._positionZ=L,T._positionX+=x._positionX,T._positionY+=x._positionY,T._positionZ+=x._positionZ,e._geom._computeAabb(e._aabb,e._ptransform),w=e._aabb._minX,k=e._aabb._minY,A=e._aabb._minZ,B=e._aabb._maxX,P=e._aabb._maxY,S=e._aabb._maxZ,e._geom._computeAabb(e._aabb,e._transform),e._aabb._minX=w<e._aabb._minX?w:e._aabb._minX,e._aabb._minY=k<e._aabb._minY?k:e._aabb._minY,e._aabb._minZ=A<e._aabb._minZ?A:e._aabb._minZ,e._aabb._maxX=B>e._aabb._maxX?B:e._aabb._maxX,e._aabb._maxY=P>e._aabb._maxY?P:e._aabb._maxY,e._aabb._maxZ=S>e._aabb._maxZ?S:e._aabb._maxZ,null!=e._proxy){let t,i,s;t=e._transform._positionX-e._ptransform._positionX,i=e._transform._positionY-e._ptransform._positionY,s=e._transform._positionZ-e._ptransform._positionZ;let a=e.displacement;a.x=t,a.y=i,a.z=s,e._rigidBody._world._broadPhase.moveProxy(e._proxy,e._aabb,e.displacement)}e=b}this._sleeping=!1,this._sleepTime=0}getRotation(){let t=new s.common.Mat3;return t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22,t}getRotationTo(t){t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22}setRotation(t){let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y;this._transform._rotation00=t.e00,this._transform._rotation01=t.e01,this._transform._rotation02=t.e02,this._transform._rotation10=t.e10,this._transform._rotation11=t.e11,this._transform._rotation12=t.e12,this._transform._rotation20=t.e20,this._transform._rotation21=t.e21,this._transform._rotation22=t.e22,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,a=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=s,this._invInertia02=a,this._invInertia10=o,this._invInertia11=n,this._invInertia12=e,this._invInertia20=r,this._invInertia21=_,this._invInertia22=l,h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,f=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=c,this._invInertia02=m,this._invInertia10=b,this._invInertia11=p,this._invInertia12=x,this._invInertia20=f,this._invInertia21=u,this._invInertia22=y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let v=this._ptransform,d=this._transform;v._positionX=d._positionX,v._positionY=d._positionY,v._positionZ=d._positionZ,v._rotation00=d._rotation00,v._rotation01=d._rotation01,v._rotation02=d._rotation02,v._rotation10=d._rotation10,v._rotation11=d._rotation11,v._rotation12=d._rotation12,v._rotation20=d._rotation20,v._rotation21=d._rotation21,v._rotation22=d._rotation22;let g=this._shapeList;for(;null!=g;){let t,i,s,a,o,n,e,r,_,l,h,c,m=g._next,b=this._ptransform,p=this._transform,x=g._ptransform,f=g._localTransform;t=b._rotation00*f._rotation00+b._rotation01*f._rotation10+b._rotation02*f._rotation20,i=b._rotation00*f._rotation01+b._rotation01*f._rotation11+b._rotation02*f._rotation21,s=b._rotation00*f._rotation02+b._rotation01*f._rotation12+b._rotation02*f._rotation22,a=b._rotation10*f._rotation00+b._rotation11*f._rotation10+b._rotation12*f._rotation20,o=b._rotation10*f._rotation01+b._rotation11*f._rotation11+b._rotation12*f._rotation21,n=b._rotation10*f._rotation02+b._rotation11*f._rotation12+b._rotation12*f._rotation22,e=b._rotation20*f._rotation00+b._rotation21*f._rotation10+b._rotation22*f._rotation20,r=b._rotation20*f._rotation01+b._rotation21*f._rotation11+b._rotation22*f._rotation21,_=b._rotation20*f._rotation02+b._rotation21*f._rotation12+b._rotation22*f._rotation22,x._rotation00=t,x._rotation01=i,x._rotation02=s,x._rotation10=a,x._rotation11=o,x._rotation12=n,x._rotation20=e,x._rotation21=r,x._rotation22=_,l=b._rotation00*f._positionX+b._rotation01*f._positionY+b._rotation02*f._positionZ,h=b._rotation10*f._positionX+b._rotation11*f._positionY+b._rotation12*f._positionZ,c=b._rotation20*f._positionX+b._rotation21*f._positionY+b._rotation22*f._positionZ,x._positionX=l,x._positionY=h,x._positionZ=c,x._positionX+=b._positionX,x._positionY+=b._positionY,x._positionZ+=b._positionZ;let u,y,v,d,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T=g._transform,C=g._localTransform;if(u=p._rotation00*C._rotation00+p._rotation01*C._rotation10+p._rotation02*C._rotation20,y=p._rotation00*C._rotation01+p._rotation01*C._rotation11+p._rotation02*C._rotation21,v=p._rotation00*C._rotation02+p._rotation01*C._rotation12+p._rotation02*C._rotation22,d=p._rotation10*C._rotation00+p._rotation11*C._rotation10+p._rotation12*C._rotation20,X=p._rotation10*C._rotation01+p._rotation11*C._rotation11+p._rotation12*C._rotation21,Y=p._rotation10*C._rotation02+p._rotation11*C._rotation12+p._rotation12*C._rotation22,z=p._rotation20*C._rotation00+p._rotation21*C._rotation10+p._rotation22*C._rotation20,Z=p._rotation20*C._rotation01+p._rotation21*C._rotation11+p._rotation22*C._rotation21,M=p._rotation20*C._rotation02+p._rotation21*C._rotation12+p._rotation22*C._rotation22,T._rotation00=u,T._rotation01=y,T._rotation02=v,T._rotation10=d,T._rotation11=X,T._rotation12=Y,T._rotation20=z,T._rotation21=Z,T._rotation22=M,I=p._rotation00*C._positionX+p._rotation01*C._positionY+p._rotation02*C._positionZ,V=p._rotation10*C._positionX+p._rotation11*C._positionY+p._rotation12*C._positionZ,L=p._rotation20*C._positionX+p._rotation21*C._positionY+p._rotation22*C._positionZ,T._positionX=I,T._positionY=V,T._positionZ=L,T._positionX+=p._positionX,T._positionY+=p._positionY,T._positionZ+=p._positionZ,g._geom._computeAabb(g._aabb,g._ptransform),w=g._aabb._minX,k=g._aabb._minY,A=g._aabb._minZ,B=g._aabb._maxX,P=g._aabb._maxY,S=g._aabb._maxZ,g._geom._computeAabb(g._aabb,g._transform),g._aabb._minX=w<g._aabb._minX?w:g._aabb._minX,g._aabb._minY=k<g._aabb._minY?k:g._aabb._minY,g._aabb._minZ=A<g._aabb._minZ?A:g._aabb._minZ,g._aabb._maxX=B>g._aabb._maxX?B:g._aabb._maxX,g._aabb._maxY=P>g._aabb._maxY?P:g._aabb._maxY,g._aabb._maxZ=S>g._aabb._maxZ?S:g._aabb._maxZ,null!=g._proxy){let t,i,s;t=g._transform._positionX-g._ptransform._positionX,i=g._transform._positionY-g._ptransform._positionY,s=g._transform._positionZ-g._ptransform._positionZ;let a=g.displacement;a.x=t,a.y=i,a.z=s,g._rigidBody._world._broadPhase.moveProxy(g._proxy,g._aabb,g.displacement)}g=m}this._sleeping=!1,this._sleepTime=0}setRotationXyz(t){let i,s,a;i=t.x,s=t.y,a=t.z;let o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X=Math.sin(i),Y=Math.sin(s),z=Math.sin(a),Z=Math.cos(i),M=Math.cos(s),I=Math.cos(a);this._transform._rotation00=M*I,this._transform._rotation01=-M*z,this._transform._rotation02=Y,this._transform._rotation10=Z*z+I*X*Y,this._transform._rotation11=Z*I-X*Y*z,this._transform._rotation12=-M*X,this._transform._rotation20=X*z-Z*I*Y,this._transform._rotation21=I*X+Z*Y*z,this._transform._rotation22=Z*M,o=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,n=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,e=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,r=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,_=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,l=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,h=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,c=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,m=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=o,this._invInertia01=n,this._invInertia02=e,this._invInertia10=r,this._invInertia11=_,this._invInertia12=l,this._invInertia20=h,this._invInertia21=c,this._invInertia22=m,b=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,p=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,x=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,f=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,u=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,y=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,v=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,d=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,g=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=b,this._invInertia01=p,this._invInertia02=x,this._invInertia10=f,this._invInertia11=u,this._invInertia12=y,this._invInertia20=v,this._invInertia21=d,this._invInertia22=g,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let V=this._ptransform,L=this._transform;V._positionX=L._positionX,V._positionY=L._positionY,V._positionZ=L._positionZ,V._rotation00=L._rotation00,V._rotation01=L._rotation01,V._rotation02=L._rotation02,V._rotation10=L._rotation10,V._rotation11=L._rotation11,V._rotation12=L._rotation12,V._rotation20=L._rotation20,V._rotation21=L._rotation21,V._rotation22=L._rotation22;let w=this._shapeList;for(;null!=w;){let t,i,s,a,o,n,e,r,_,l,h,c,m=w._next,b=this._ptransform,p=this._transform,x=w._ptransform,f=w._localTransform;t=b._rotation00*f._rotation00+b._rotation01*f._rotation10+b._rotation02*f._rotation20,i=b._rotation00*f._rotation01+b._rotation01*f._rotation11+b._rotation02*f._rotation21,s=b._rotation00*f._rotation02+b._rotation01*f._rotation12+b._rotation02*f._rotation22,a=b._rotation10*f._rotation00+b._rotation11*f._rotation10+b._rotation12*f._rotation20,o=b._rotation10*f._rotation01+b._rotation11*f._rotation11+b._rotation12*f._rotation21,n=b._rotation10*f._rotation02+b._rotation11*f._rotation12+b._rotation12*f._rotation22,e=b._rotation20*f._rotation00+b._rotation21*f._rotation10+b._rotation22*f._rotation20,r=b._rotation20*f._rotation01+b._rotation21*f._rotation11+b._rotation22*f._rotation21,_=b._rotation20*f._rotation02+b._rotation21*f._rotation12+b._rotation22*f._rotation22,x._rotation00=t,x._rotation01=i,x._rotation02=s,x._rotation10=a,x._rotation11=o,x._rotation12=n,x._rotation20=e,x._rotation21=r,x._rotation22=_,l=b._rotation00*f._positionX+b._rotation01*f._positionY+b._rotation02*f._positionZ,h=b._rotation10*f._positionX+b._rotation11*f._positionY+b._rotation12*f._positionZ,c=b._rotation20*f._positionX+b._rotation21*f._positionY+b._rotation22*f._positionZ,x._positionX=l,x._positionY=h,x._positionZ=c,x._positionX+=b._positionX,x._positionY+=b._positionY,x._positionZ+=b._positionZ;let u,y,v,d,g,X,Y,z,Z,M,I,V,L,k,A,B,P,S,T=w._transform,C=w._localTransform;if(u=p._rotation00*C._rotation00+p._rotation01*C._rotation10+p._rotation02*C._rotation20,y=p._rotation00*C._rotation01+p._rotation01*C._rotation11+p._rotation02*C._rotation21,v=p._rotation00*C._rotation02+p._rotation01*C._rotation12+p._rotation02*C._rotation22,d=p._rotation10*C._rotation00+p._rotation11*C._rotation10+p._rotation12*C._rotation20,g=p._rotation10*C._rotation01+p._rotation11*C._rotation11+p._rotation12*C._rotation21,X=p._rotation10*C._rotation02+p._rotation11*C._rotation12+p._rotation12*C._rotation22,Y=p._rotation20*C._rotation00+p._rotation21*C._rotation10+p._rotation22*C._rotation20,z=p._rotation20*C._rotation01+p._rotation21*C._rotation11+p._rotation22*C._rotation21,Z=p._rotation20*C._rotation02+p._rotation21*C._rotation12+p._rotation22*C._rotation22,T._rotation00=u,T._rotation01=y,T._rotation02=v,T._rotation10=d,T._rotation11=g,T._rotation12=X,T._rotation20=Y,T._rotation21=z,T._rotation22=Z,M=p._rotation00*C._positionX+p._rotation01*C._positionY+p._rotation02*C._positionZ,I=p._rotation10*C._positionX+p._rotation11*C._positionY+p._rotation12*C._positionZ,V=p._rotation20*C._positionX+p._rotation21*C._positionY+p._rotation22*C._positionZ,T._positionX=M,T._positionY=I,T._positionZ=V,T._positionX+=p._positionX,T._positionY+=p._positionY,T._positionZ+=p._positionZ,w._geom._computeAabb(w._aabb,w._ptransform),L=w._aabb._minX,k=w._aabb._minY,A=w._aabb._minZ,B=w._aabb._maxX,P=w._aabb._maxY,S=w._aabb._maxZ,w._geom._computeAabb(w._aabb,w._transform),w._aabb._minX=L<w._aabb._minX?L:w._aabb._minX,w._aabb._minY=k<w._aabb._minY?k:w._aabb._minY,w._aabb._minZ=A<w._aabb._minZ?A:w._aabb._minZ,w._aabb._maxX=B>w._aabb._maxX?B:w._aabb._maxX,w._aabb._maxY=P>w._aabb._maxY?P:w._aabb._maxY,w._aabb._maxZ=S>w._aabb._maxZ?S:w._aabb._maxZ,null!=w._proxy){let t,i,s;t=w._transform._positionX-w._ptransform._positionX,i=w._transform._positionY-w._ptransform._positionY,s=w._transform._positionZ-w._ptransform._positionZ;let a=w.displacement;a.x=t,a.y=i,a.z=s,w._rigidBody._world._broadPhase.moveProxy(w._proxy,w._aabb,w.displacement)}w=m}this._sleeping=!1,this._sleepTime=0}rotate(t){let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T;i=t.e00,s=t.e01,a=t.e02,o=t.e10,n=t.e11,e=t.e12,r=t.e20,_=t.e21,l=t.e22,h=i*this._transform._rotation00+s*this._transform._rotation10+a*this._transform._rotation20,c=i*this._transform._rotation01+s*this._transform._rotation11+a*this._transform._rotation21,m=i*this._transform._rotation02+s*this._transform._rotation12+a*this._transform._rotation22,b=o*this._transform._rotation00+n*this._transform._rotation10+e*this._transform._rotation20,p=o*this._transform._rotation01+n*this._transform._rotation11+e*this._transform._rotation21,x=o*this._transform._rotation02+n*this._transform._rotation12+e*this._transform._rotation22,f=r*this._transform._rotation00+_*this._transform._rotation10+l*this._transform._rotation20,u=r*this._transform._rotation01+_*this._transform._rotation11+l*this._transform._rotation21,y=r*this._transform._rotation02+_*this._transform._rotation12+l*this._transform._rotation22,this._transform._rotation00=h,this._transform._rotation01=c,this._transform._rotation02=m,this._transform._rotation10=b,this._transform._rotation11=p,this._transform._rotation12=x,this._transform._rotation20=f,this._transform._rotation21=u,this._transform._rotation22=y,v=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,d=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,g=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,X=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,Y=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,z=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Z=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,M=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,I=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=v,this._invInertia01=d,this._invInertia02=g,this._invInertia10=X,this._invInertia11=Y,this._invInertia12=z,this._invInertia20=Z,this._invInertia21=M,this._invInertia22=I,V=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,L=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,w=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,k=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,A=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,B=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,P=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,S=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,T=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=V,this._invInertia01=L,this._invInertia02=w,this._invInertia10=k,this._invInertia11=A,this._invInertia12=B,this._invInertia20=P,this._invInertia21=S,this._invInertia22=T,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let C=this._ptransform,j=this._transform;C._positionX=j._positionX,C._positionY=j._positionY,C._positionZ=j._positionZ,C._rotation00=j._rotation00,C._rotation01=j._rotation01,C._rotation02=j._rotation02,C._rotation10=j._rotation10,C._rotation11=j._rotation11,C._rotation12=j._rotation12,C._rotation20=j._rotation20,C._rotation21=j._rotation21,C._rotation22=j._rotation22;let R=this._shapeList;for(;null!=R;){let t,i,s,a,o,n,e,r,_,l,h,c,m=R._next,b=this._ptransform,p=this._transform,x=R._ptransform,f=R._localTransform;t=b._rotation00*f._rotation00+b._rotation01*f._rotation10+b._rotation02*f._rotation20,i=b._rotation00*f._rotation01+b._rotation01*f._rotation11+b._rotation02*f._rotation21,s=b._rotation00*f._rotation02+b._rotation01*f._rotation12+b._rotation02*f._rotation22,a=b._rotation10*f._rotation00+b._rotation11*f._rotation10+b._rotation12*f._rotation20,o=b._rotation10*f._rotation01+b._rotation11*f._rotation11+b._rotation12*f._rotation21,n=b._rotation10*f._rotation02+b._rotation11*f._rotation12+b._rotation12*f._rotation22,e=b._rotation20*f._rotation00+b._rotation21*f._rotation10+b._rotation22*f._rotation20,r=b._rotation20*f._rotation01+b._rotation21*f._rotation11+b._rotation22*f._rotation21,_=b._rotation20*f._rotation02+b._rotation21*f._rotation12+b._rotation22*f._rotation22,x._rotation00=t,x._rotation01=i,x._rotation02=s,x._rotation10=a,x._rotation11=o,x._rotation12=n,x._rotation20=e,x._rotation21=r,x._rotation22=_,l=b._rotation00*f._positionX+b._rotation01*f._positionY+b._rotation02*f._positionZ,h=b._rotation10*f._positionX+b._rotation11*f._positionY+b._rotation12*f._positionZ,c=b._rotation20*f._positionX+b._rotation21*f._positionY+b._rotation22*f._positionZ,x._positionX=l,x._positionY=h,x._positionZ=c,x._positionX+=b._positionX,x._positionY+=b._positionY,x._positionZ+=b._positionZ;let u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S=R._transform,T=R._localTransform;if(u=p._rotation00*T._rotation00+p._rotation01*T._rotation10+p._rotation02*T._rotation20,y=p._rotation00*T._rotation01+p._rotation01*T._rotation11+p._rotation02*T._rotation21,v=p._rotation00*T._rotation02+p._rotation01*T._rotation12+p._rotation02*T._rotation22,d=p._rotation10*T._rotation00+p._rotation11*T._rotation10+p._rotation12*T._rotation20,g=p._rotation10*T._rotation01+p._rotation11*T._rotation11+p._rotation12*T._rotation21,X=p._rotation10*T._rotation02+p._rotation11*T._rotation12+p._rotation12*T._rotation22,Y=p._rotation20*T._rotation00+p._rotation21*T._rotation10+p._rotation22*T._rotation20,z=p._rotation20*T._rotation01+p._rotation21*T._rotation11+p._rotation22*T._rotation21,Z=p._rotation20*T._rotation02+p._rotation21*T._rotation12+p._rotation22*T._rotation22,S._rotation00=u,S._rotation01=y,S._rotation02=v,S._rotation10=d,S._rotation11=g,S._rotation12=X,S._rotation20=Y,S._rotation21=z,S._rotation22=Z,M=p._rotation00*T._positionX+p._rotation01*T._positionY+p._rotation02*T._positionZ,I=p._rotation10*T._positionX+p._rotation11*T._positionY+p._rotation12*T._positionZ,V=p._rotation20*T._positionX+p._rotation21*T._positionY+p._rotation22*T._positionZ,S._positionX=M,S._positionY=I,S._positionZ=V,S._positionX+=p._positionX,S._positionY+=p._positionY,S._positionZ+=p._positionZ,R._geom._computeAabb(R._aabb,R._ptransform),L=R._aabb._minX,w=R._aabb._minY,k=R._aabb._minZ,A=R._aabb._maxX,B=R._aabb._maxY,P=R._aabb._maxZ,R._geom._computeAabb(R._aabb,R._transform),R._aabb._minX=L<R._aabb._minX?L:R._aabb._minX,R._aabb._minY=w<R._aabb._minY?w:R._aabb._minY,R._aabb._minZ=k<R._aabb._minZ?k:R._aabb._minZ,R._aabb._maxX=A>R._aabb._maxX?A:R._aabb._maxX,R._aabb._maxY=B>R._aabb._maxY?B:R._aabb._maxY,R._aabb._maxZ=P>R._aabb._maxZ?P:R._aabb._maxZ,null!=R._proxy){let t,i,s;t=R._transform._positionX-R._ptransform._positionX,i=R._transform._positionY-R._ptransform._positionY,s=R._transform._positionZ-R._ptransform._positionZ;let a=R.displacement;a.x=t,a.y=i,a.z=s,R._rigidBody._world._broadPhase.moveProxy(R._proxy,R._aabb,R.displacement)}R=m}this._sleeping=!1,this._sleepTime=0}rotateXyz(t){let i,s,a,o,n,e,r,_,l,h,c,m;i=t.x,s=t.y,a=t.z;let b,p,x,f,u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T,C,j,R,E=Math.sin(i),q=Math.sin(s),N=Math.sin(a),D=Math.cos(i),F=Math.cos(s),H=Math.cos(a);o=F*H,n=-F*N,e=q,r=D*N+H*E*q,_=D*H-E*q*N,l=-F*E,h=E*N-D*H*q,c=H*E+D*q*N,m=D*F,b=o*this._transform._rotation00+n*this._transform._rotation10+e*this._transform._rotation20,p=o*this._transform._rotation01+n*this._transform._rotation11+e*this._transform._rotation21,x=o*this._transform._rotation02+n*this._transform._rotation12+e*this._transform._rotation22,f=r*this._transform._rotation00+_*this._transform._rotation10+l*this._transform._rotation20,u=r*this._transform._rotation01+_*this._transform._rotation11+l*this._transform._rotation21,y=r*this._transform._rotation02+_*this._transform._rotation12+l*this._transform._rotation22,v=h*this._transform._rotation00+c*this._transform._rotation10+m*this._transform._rotation20,d=h*this._transform._rotation01+c*this._transform._rotation11+m*this._transform._rotation21,g=h*this._transform._rotation02+c*this._transform._rotation12+m*this._transform._rotation22,this._transform._rotation00=b,this._transform._rotation01=p,this._transform._rotation02=x,this._transform._rotation10=f,this._transform._rotation11=u,this._transform._rotation12=y,this._transform._rotation20=v,this._transform._rotation21=d,this._transform._rotation22=g,X=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,Y=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,z=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,Z=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,M=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,I=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,V=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,L=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,w=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=X,this._invInertia01=Y,this._invInertia02=z,this._invInertia10=Z,this._invInertia11=M,this._invInertia12=I,this._invInertia20=V,this._invInertia21=L,this._invInertia22=w,k=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,A=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,B=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,P=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,S=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,T=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,C=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,j=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,R=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=k,this._invInertia01=A,this._invInertia02=B,this._invInertia10=P,this._invInertia11=S,this._invInertia12=T,this._invInertia20=C,this._invInertia21=j,this._invInertia22=R,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let G=this._ptransform,W=this._transform;G._positionX=W._positionX,G._positionY=W._positionY,G._positionZ=W._positionZ,G._rotation00=W._rotation00,G._rotation01=W._rotation01,G._rotation02=W._rotation02,G._rotation10=W._rotation10,G._rotation11=W._rotation11,G._rotation12=W._rotation12,G._rotation20=W._rotation20,G._rotation21=W._rotation21,G._rotation22=W._rotation22;let O=this._shapeList;for(;null!=O;){let t,i,s,a,o,n,e,r,_,l,h,c,m=O._next,b=this._ptransform,p=this._transform,x=O._ptransform,f=O._localTransform;t=b._rotation00*f._rotation00+b._rotation01*f._rotation10+b._rotation02*f._rotation20,i=b._rotation00*f._rotation01+b._rotation01*f._rotation11+b._rotation02*f._rotation21,s=b._rotation00*f._rotation02+b._rotation01*f._rotation12+b._rotation02*f._rotation22,a=b._rotation10*f._rotation00+b._rotation11*f._rotation10+b._rotation12*f._rotation20,o=b._rotation10*f._rotation01+b._rotation11*f._rotation11+b._rotation12*f._rotation21,n=b._rotation10*f._rotation02+b._rotation11*f._rotation12+b._rotation12*f._rotation22,e=b._rotation20*f._rotation00+b._rotation21*f._rotation10+b._rotation22*f._rotation20,r=b._rotation20*f._rotation01+b._rotation21*f._rotation11+b._rotation22*f._rotation21,_=b._rotation20*f._rotation02+b._rotation21*f._rotation12+b._rotation22*f._rotation22,x._rotation00=t,x._rotation01=i,x._rotation02=s,x._rotation10=a,x._rotation11=o,x._rotation12=n,x._rotation20=e,x._rotation21=r,x._rotation22=_,l=b._rotation00*f._positionX+b._rotation01*f._positionY+b._rotation02*f._positionZ,h=b._rotation10*f._positionX+b._rotation11*f._positionY+b._rotation12*f._positionZ,c=b._rotation20*f._positionX+b._rotation21*f._positionY+b._rotation22*f._positionZ,x._positionX=l,x._positionY=h,x._positionZ=c,x._positionX+=b._positionX,x._positionY+=b._positionY,x._positionZ+=b._positionZ;let u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S=O._transform,T=O._localTransform;if(u=p._rotation00*T._rotation00+p._rotation01*T._rotation10+p._rotation02*T._rotation20,y=p._rotation00*T._rotation01+p._rotation01*T._rotation11+p._rotation02*T._rotation21,v=p._rotation00*T._rotation02+p._rotation01*T._rotation12+p._rotation02*T._rotation22,d=p._rotation10*T._rotation00+p._rotation11*T._rotation10+p._rotation12*T._rotation20,g=p._rotation10*T._rotation01+p._rotation11*T._rotation11+p._rotation12*T._rotation21,X=p._rotation10*T._rotation02+p._rotation11*T._rotation12+p._rotation12*T._rotation22,Y=p._rotation20*T._rotation00+p._rotation21*T._rotation10+p._rotation22*T._rotation20,z=p._rotation20*T._rotation01+p._rotation21*T._rotation11+p._rotation22*T._rotation21,Z=p._rotation20*T._rotation02+p._rotation21*T._rotation12+p._rotation22*T._rotation22,S._rotation00=u,S._rotation01=y,S._rotation02=v,S._rotation10=d,S._rotation11=g,S._rotation12=X,S._rotation20=Y,S._rotation21=z,S._rotation22=Z,M=p._rotation00*T._positionX+p._rotation01*T._positionY+p._rotation02*T._positionZ,I=p._rotation10*T._positionX+p._rotation11*T._positionY+p._rotation12*T._positionZ,V=p._rotation20*T._positionX+p._rotation21*T._positionY+p._rotation22*T._positionZ,S._positionX=M,S._positionY=I,S._positionZ=V,S._positionX+=p._positionX,S._positionY+=p._positionY,S._positionZ+=p._positionZ,O._geom._computeAabb(O._aabb,O._ptransform),L=O._aabb._minX,w=O._aabb._minY,k=O._aabb._minZ,A=O._aabb._maxX,B=O._aabb._maxY,P=O._aabb._maxZ,O._geom._computeAabb(O._aabb,O._transform),O._aabb._minX=L<O._aabb._minX?L:O._aabb._minX,O._aabb._minY=w<O._aabb._minY?w:O._aabb._minY,O._aabb._minZ=k<O._aabb._minZ?k:O._aabb._minZ,O._aabb._maxX=A>O._aabb._maxX?A:O._aabb._maxX,O._aabb._maxY=B>O._aabb._maxY?B:O._aabb._maxY,O._aabb._maxZ=P>O._aabb._maxZ?P:O._aabb._maxZ,null!=O._proxy){let t,i,s;t=O._transform._positionX-O._ptransform._positionX,i=O._transform._positionY-O._ptransform._positionY,s=O._transform._positionZ-O._ptransform._positionZ;let a=O.displacement;a.x=t,a.y=i,a.z=s,O._rigidBody._world._broadPhase.moveProxy(O._proxy,O._aabb,O.displacement)}O=m}this._sleeping=!1,this._sleepTime=0}getOrientation(){let t,i,a,o,n,e=new s.common.Quat,r=this._transform._rotation00,_=this._transform._rotation11,l=this._transform._rotation22,h=r+_+l;return h>0?(n=Math.sqrt(h+1),o=.5*n,n=.5/n,t=(this._transform._rotation21-this._transform._rotation12)*n,i=(this._transform._rotation02-this._transform._rotation20)*n,a=(this._transform._rotation10-this._transform._rotation01)*n):r>_?r>l?(n=Math.sqrt(r-_-l+1),t=.5*n,n=.5/n,i=(this._transform._rotation01+this._transform._rotation10)*n,a=(this._transform._rotation02+this._transform._rotation20)*n,o=(this._transform._rotation21-this._transform._rotation12)*n):(n=Math.sqrt(l-r-_+1),a=.5*n,n=.5/n,t=(this._transform._rotation02+this._transform._rotation20)*n,i=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation10-this._transform._rotation01)*n):_>l?(n=Math.sqrt(_-l-r+1),i=.5*n,n=.5/n,t=(this._transform._rotation01+this._transform._rotation10)*n,a=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation02-this._transform._rotation20)*n):(n=Math.sqrt(l-r-_+1),a=.5*n,n=.5/n,t=(this._transform._rotation02+this._transform._rotation20)*n,i=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation10-this._transform._rotation01)*n),e.x=t,e.y=i,e.z=a,e.w=o,e}getOrientationTo(t){let i,s,a,o,n,e=this._transform._rotation00,r=this._transform._rotation11,_=this._transform._rotation22,l=e+r+_;l>0?(n=Math.sqrt(l+1),o=.5*n,n=.5/n,i=(this._transform._rotation21-this._transform._rotation12)*n,s=(this._transform._rotation02-this._transform._rotation20)*n,a=(this._transform._rotation10-this._transform._rotation01)*n):e>r?e>_?(n=Math.sqrt(e-r-_+1),i=.5*n,n=.5/n,s=(this._transform._rotation01+this._transform._rotation10)*n,a=(this._transform._rotation02+this._transform._rotation20)*n,o=(this._transform._rotation21-this._transform._rotation12)*n):(n=Math.sqrt(_-e-r+1),a=.5*n,n=.5/n,i=(this._transform._rotation02+this._transform._rotation20)*n,s=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation10-this._transform._rotation01)*n):r>_?(n=Math.sqrt(r-_-e+1),s=.5*n,n=.5/n,i=(this._transform._rotation01+this._transform._rotation10)*n,a=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation02-this._transform._rotation20)*n):(n=Math.sqrt(_-e-r+1),a=.5*n,n=.5/n,i=(this._transform._rotation02+this._transform._rotation20)*n,s=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation10-this._transform._rotation01)*n),t.x=i,t.y=s,t.z=a,t.w=o}setOrientation(t){let i,s,a,o;i=t.x,s=t.y,a=t.z,o=t.w;let n,e,r,_,l,h,c,m,b,p,x,f,u,y,v,d,g,X,Y=2*i,z=2*s,Z=2*a,M=i*Y,I=s*z,V=a*Z,L=i*z,w=s*Z,k=i*Z,A=o*Y,B=o*z,P=o*Z;this._transform._rotation00=1-I-V,this._transform._rotation01=L-P,this._transform._rotation02=k+B,this._transform._rotation10=L+P,this._transform._rotation11=1-M-V,this._transform._rotation12=w-A,this._transform._rotation20=k-B,this._transform._rotation21=w+A,this._transform._rotation22=1-M-I,n=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,e=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,r=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,_=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,l=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,h=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,c=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,m=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,b=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=n,this._invInertia01=e,this._invInertia02=r,this._invInertia10=_,this._invInertia11=l,this._invInertia12=h,this._invInertia20=c,this._invInertia21=m,this._invInertia22=b,p=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,x=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,f=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,u=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,y=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,v=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,d=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,g=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,X=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=p,this._invInertia01=x,this._invInertia02=f,this._invInertia10=u,this._invInertia11=y,this._invInertia12=v,this._invInertia20=d,this._invInertia21=g,this._invInertia22=X,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let S=this._ptransform,T=this._transform;S._positionX=T._positionX,S._positionY=T._positionY,S._positionZ=T._positionZ,S._rotation00=T._rotation00,S._rotation01=T._rotation01,S._rotation02=T._rotation02,S._rotation10=T._rotation10,S._rotation11=T._rotation11,S._rotation12=T._rotation12,S._rotation20=T._rotation20,S._rotation21=T._rotation21,S._rotation22=T._rotation22;let C=this._shapeList;for(;null!=C;){let t,i,s,a,o,n,e,r,_,l,h,c,m=C._next,b=this._ptransform,p=this._transform,x=C._ptransform,f=C._localTransform;t=b._rotation00*f._rotation00+b._rotation01*f._rotation10+b._rotation02*f._rotation20,i=b._rotation00*f._rotation01+b._rotation01*f._rotation11+b._rotation02*f._rotation21,s=b._rotation00*f._rotation02+b._rotation01*f._rotation12+b._rotation02*f._rotation22,a=b._rotation10*f._rotation00+b._rotation11*f._rotation10+b._rotation12*f._rotation20,o=b._rotation10*f._rotation01+b._rotation11*f._rotation11+b._rotation12*f._rotation21,n=b._rotation10*f._rotation02+b._rotation11*f._rotation12+b._rotation12*f._rotation22,e=b._rotation20*f._rotation00+b._rotation21*f._rotation10+b._rotation22*f._rotation20,r=b._rotation20*f._rotation01+b._rotation21*f._rotation11+b._rotation22*f._rotation21,_=b._rotation20*f._rotation02+b._rotation21*f._rotation12+b._rotation22*f._rotation22,x._rotation00=t,x._rotation01=i,x._rotation02=s,x._rotation10=a,x._rotation11=o,x._rotation12=n,x._rotation20=e,x._rotation21=r,x._rotation22=_,l=b._rotation00*f._positionX+b._rotation01*f._positionY+b._rotation02*f._positionZ,h=b._rotation10*f._positionX+b._rotation11*f._positionY+b._rotation12*f._positionZ,c=b._rotation20*f._positionX+b._rotation21*f._positionY+b._rotation22*f._positionZ,x._positionX=l,x._positionY=h,x._positionZ=c,x._positionX+=b._positionX,x._positionY+=b._positionY,x._positionZ+=b._positionZ;let u,y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S=C._transform,T=C._localTransform;if(u=p._rotation00*T._rotation00+p._rotation01*T._rotation10+p._rotation02*T._rotation20,y=p._rotation00*T._rotation01+p._rotation01*T._rotation11+p._rotation02*T._rotation21,v=p._rotation00*T._rotation02+p._rotation01*T._rotation12+p._rotation02*T._rotation22,d=p._rotation10*T._rotation00+p._rotation11*T._rotation10+p._rotation12*T._rotation20,g=p._rotation10*T._rotation01+p._rotation11*T._rotation11+p._rotation12*T._rotation21,X=p._rotation10*T._rotation02+p._rotation11*T._rotation12+p._rotation12*T._rotation22,Y=p._rotation20*T._rotation00+p._rotation21*T._rotation10+p._rotation22*T._rotation20,z=p._rotation20*T._rotation01+p._rotation21*T._rotation11+p._rotation22*T._rotation21,Z=p._rotation20*T._rotation02+p._rotation21*T._rotation12+p._rotation22*T._rotation22,S._rotation00=u,S._rotation01=y,S._rotation02=v,S._rotation10=d,S._rotation11=g,S._rotation12=X,S._rotation20=Y,S._rotation21=z,S._rotation22=Z,M=p._rotation00*T._positionX+p._rotation01*T._positionY+p._rotation02*T._positionZ,I=p._rotation10*T._positionX+p._rotation11*T._positionY+p._rotation12*T._positionZ,V=p._rotation20*T._positionX+p._rotation21*T._positionY+p._rotation22*T._positionZ,S._positionX=M,S._positionY=I,S._positionZ=V,S._positionX+=p._positionX,S._positionY+=p._positionY,S._positionZ+=p._positionZ,C._geom._computeAabb(C._aabb,C._ptransform),L=C._aabb._minX,w=C._aabb._minY,k=C._aabb._minZ,A=C._aabb._maxX,B=C._aabb._maxY,P=C._aabb._maxZ,C._geom._computeAabb(C._aabb,C._transform),C._aabb._minX=L<C._aabb._minX?L:C._aabb._minX,C._aabb._minY=w<C._aabb._minY?w:C._aabb._minY,C._aabb._minZ=k<C._aabb._minZ?k:C._aabb._minZ,C._aabb._maxX=A>C._aabb._maxX?A:C._aabb._maxX,C._aabb._maxY=B>C._aabb._maxY?B:C._aabb._maxY,C._aabb._maxZ=P>C._aabb._maxZ?P:C._aabb._maxZ,null!=C._proxy){let t,i,s;t=C._transform._positionX-C._ptransform._positionX,i=C._transform._positionY-C._ptransform._positionY,s=C._transform._positionZ-C._ptransform._positionZ;let a=C.displacement;a.x=t,a.y=i,a.z=s,C._rigidBody._world._broadPhase.moveProxy(C._proxy,C._aabb,C.displacement)}C=m}this._sleeping=!1,this._sleepTime=0}getTransform(){let t=this._transform,i=new s.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getTransformTo(t){let i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}setTransform(t){let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y;this._transform._positionX=t._positionX,this._transform._positionY=t._positionY,this._transform._positionZ=t._positionZ,this._transform._rotation00=t._rotation00,this._transform._rotation01=t._rotation01,this._transform._rotation02=t._rotation02,this._transform._rotation10=t._rotation10,this._transform._rotation11=t._rotation11,this._transform._rotation12=t._rotation12,this._transform._rotation20=t._rotation20,this._transform._rotation21=t._rotation21,this._transform._rotation22=t._rotation22,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,a=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=s,this._invInertia02=a,this._invInertia10=o,this._invInertia11=n,this._invInertia12=e,this._invInertia20=r,this._invInertia21=_,this._invInertia22=l,h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,f=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=c,this._invInertia02=m,this._invInertia10=b,this._invInertia11=p,this._invInertia12=x,this._invInertia20=f,this._invInertia21=u,this._invInertia22=y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let v=this._ptransform,d=this._transform;v._positionX=d._positionX,v._positionY=d._positionY,v._positionZ=d._positionZ,v._rotation00=d._rotation00,v._rotation01=d._rotation01,v._rotation02=d._rotation02,v._rotation10=d._rotation10,v._rotation11=d._rotation11,v._rotation12=d._rotation12,v._rotation20=d._rotation20,v._rotation21=d._rotation21,v._rotation22=d._rotation22;let g=this._shapeList;for(;null!=g;){let t,i,s,a,o,n,e,r,_,l,h,c,m=g._next,b=this._ptransform,p=this._transform,x=g._ptransform,f=g._localTransform;t=b._rotation00*f._rotation00+b._rotation01*f._rotation10+b._rotation02*f._rotation20,i=b._rotation00*f._rotation01+b._rotation01*f._rotation11+b._rotation02*f._rotation21,s=b._rotation00*f._rotation02+b._rotation01*f._rotation12+b._rotation02*f._rotation22,a=b._rotation10*f._rotation00+b._rotation11*f._rotation10+b._rotation12*f._rotation20,o=b._rotation10*f._rotation01+b._rotation11*f._rotation11+b._rotation12*f._rotation21,n=b._rotation10*f._rotation02+b._rotation11*f._rotation12+b._rotation12*f._rotation22,e=b._rotation20*f._rotation00+b._rotation21*f._rotation10+b._rotation22*f._rotation20,r=b._rotation20*f._rotation01+b._rotation21*f._rotation11+b._rotation22*f._rotation21,_=b._rotation20*f._rotation02+b._rotation21*f._rotation12+b._rotation22*f._rotation22,x._rotation00=t,x._rotation01=i,x._rotation02=s,x._rotation10=a,x._rotation11=o,x._rotation12=n,x._rotation20=e,x._rotation21=r,x._rotation22=_,l=b._rotation00*f._positionX+b._rotation01*f._positionY+b._rotation02*f._positionZ,h=b._rotation10*f._positionX+b._rotation11*f._positionY+b._rotation12*f._positionZ,c=b._rotation20*f._positionX+b._rotation21*f._positionY+b._rotation22*f._positionZ,x._positionX=l,x._positionY=h,x._positionZ=c,x._positionX+=b._positionX,x._positionY+=b._positionY,x._positionZ+=b._positionZ;let u,y,v,d,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T=g._transform,C=g._localTransform;if(u=p._rotation00*C._rotation00+p._rotation01*C._rotation10+p._rotation02*C._rotation20,y=p._rotation00*C._rotation01+p._rotation01*C._rotation11+p._rotation02*C._rotation21,v=p._rotation00*C._rotation02+p._rotation01*C._rotation12+p._rotation02*C._rotation22,d=p._rotation10*C._rotation00+p._rotation11*C._rotation10+p._rotation12*C._rotation20,X=p._rotation10*C._rotation01+p._rotation11*C._rotation11+p._rotation12*C._rotation21,Y=p._rotation10*C._rotation02+p._rotation11*C._rotation12+p._rotation12*C._rotation22,z=p._rotation20*C._rotation00+p._rotation21*C._rotation10+p._rotation22*C._rotation20,Z=p._rotation20*C._rotation01+p._rotation21*C._rotation11+p._rotation22*C._rotation21,M=p._rotation20*C._rotation02+p._rotation21*C._rotation12+p._rotation22*C._rotation22,T._rotation00=u,T._rotation01=y,T._rotation02=v,T._rotation10=d,T._rotation11=X,T._rotation12=Y,T._rotation20=z,T._rotation21=Z,T._rotation22=M,I=p._rotation00*C._positionX+p._rotation01*C._positionY+p._rotation02*C._positionZ,V=p._rotation10*C._positionX+p._rotation11*C._positionY+p._rotation12*C._positionZ,L=p._rotation20*C._positionX+p._rotation21*C._positionY+p._rotation22*C._positionZ,T._positionX=I,T._positionY=V,T._positionZ=L,T._positionX+=p._positionX,T._positionY+=p._positionY,T._positionZ+=p._positionZ,g._geom._computeAabb(g._aabb,g._ptransform),w=g._aabb._minX,k=g._aabb._minY,A=g._aabb._minZ,B=g._aabb._maxX,P=g._aabb._maxY,S=g._aabb._maxZ,g._geom._computeAabb(g._aabb,g._transform),g._aabb._minX=w<g._aabb._minX?w:g._aabb._minX,g._aabb._minY=k<g._aabb._minY?k:g._aabb._minY,g._aabb._minZ=A<g._aabb._minZ?A:g._aabb._minZ,g._aabb._maxX=B>g._aabb._maxX?B:g._aabb._maxX,g._aabb._maxY=P>g._aabb._maxY?P:g._aabb._maxY,g._aabb._maxZ=S>g._aabb._maxZ?S:g._aabb._maxZ,null!=g._proxy){let t,i,s;t=g._transform._positionX-g._ptransform._positionX,i=g._transform._positionY-g._ptransform._positionY,s=g._transform._positionZ-g._ptransform._positionZ;let a=g.displacement;a.x=t,a.y=i,a.z=s,g._rigidBody._world._broadPhase.moveProxy(g._proxy,g._aabb,g.displacement)}g=m}this._sleeping=!1,this._sleepTime=0}getMass(){return this._mass}getLocalInertia(){let t=new s.common.Mat3;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,t}getLocalInertiaTo(t){t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22}getMassData(){let t=new s.dynamics.rigidbody.MassData;t.mass=this._mass;let i=t.localInertia;return i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22,t}getMassDataTo(t){t.mass=this._mass;let i=t.localInertia;i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22}setMassData(t){this._mass=t.mass;let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v=t.localInertia;if(this._localInertia00=v.e00,this._localInertia01=v.e01,this._localInertia02=v.e02,this._localInertia10=v.e10,this._localInertia11=v.e11,this._localInertia12=v.e12,this._localInertia20=v.e20,this._localInertia21=v.e21,this._localInertia22=v.e22,this._mass>0&&this._localInertia00*(this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21)-this._localInertia01*(this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20)+this._localInertia02*(this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20)>0&&0==this._type){this._invMass=1/this._mass;let t=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,i=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,s=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,a=this._localInertia00*t-this._localInertia01*i+this._localInertia02*s;(a<-1e-32||a>1e-32)&&(a=1/a),this._invLocalInertia00=t*a,this._invLocalInertia01=-(this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21)*a,this._invLocalInertia02=(this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11)*a,this._invLocalInertia10=-i*a,this._invLocalInertia11=(this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20)*a,this._invLocalInertia12=-(this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10)*a,this._invLocalInertia20=s*a,this._invLocalInertia21=-(this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20)*a,this._invLocalInertia22=(this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10)*a,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,a=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=s,this._invInertia02=a,this._invInertia10=o,this._invInertia11=n,this._invInertia12=e,this._invInertia20=r,this._invInertia21=_,this._invInertia22=l,h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,f=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=c,this._invInertia02=m,this._invInertia10=b,this._invInertia11=p,this._invInertia12=x,this._invInertia20=f,this._invInertia21=u,this._invInertia22=y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getRotationFactor(){let t=this._rotFactor;return new s.common.Vec3(t.x,t.y,t.z)}setRotationFactor(t){let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,v=this._rotFactor;v.x=t.x,v.y=t.y,v.z=t.z,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,a=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=s,this._invInertia02=a,this._invInertia10=o,this._invInertia11=n,this._invInertia12=e,this._invInertia20=r,this._invInertia21=_,this._invInertia22=l,h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,f=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=c,this._invInertia02=m,this._invInertia10=b,this._invInertia11=p,this._invInertia12=x,this._invInertia20=f,this._invInertia21=u,this._invInertia22=y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getLinearVelocity(){let t=new s.common.Vec3;return t.x=this._velX,t.y=this._velY,t.z=this._velZ,t}getLinearVelocityTo(t){t.x=this._velX,t.y=this._velY,t.z=this._velZ}setLinearVelocity(t){1==this._type?(this._velX=0,this._velY=0,this._velZ=0):(this._velX=t.x,this._velY=t.y,this._velZ=t.z),this._sleeping=!1,this._sleepTime=0}getAngularVelocity(){let t=new s.common.Vec3;return t.x=this._angVelX,t.y=this._angVelY,t.z=this._angVelZ,t}getAngularVelocityTo(t){t.x=this._velX,t.y=this._velY,t.z=this._velZ}setAngularVelocity(t){1==this._type?(this._angVelX=0,this._angVelY=0,this._angVelZ=0):(this._angVelX=t.x,this._angVelY=t.y,this._angVelZ=t.z),this._sleeping=!1,this._sleepTime=0}addLinearVelocity(t){if(1!=this._type){let i,s,a;i=t.x,s=t.y,a=t.z,this._velX+=i,this._velY+=s,this._velZ+=a}this._sleeping=!1,this._sleepTime=0}addAngularVelocity(t){if(1!=this._type){let i,s,a;i=t.x,s=t.y,a=t.z,this._angVelX+=i,this._angVelY+=s,this._angVelZ+=a}this._sleeping=!1,this._sleepTime=0}applyImpulse(t,i){let s,a,o,n,e,r,_,l,h,c,m,b;s=t.x,a=t.y,o=t.z,this._velX+=s*this._invMass,this._velY+=a*this._invMass,this._velZ+=o*this._invMass,_=i.x,l=i.y,h=i.z,_-=this._transform._positionX,l-=this._transform._positionY,h-=this._transform._positionZ,n=l*o-h*a,e=h*s-_*o,r=_*a-l*s,c=this._invInertia00*n+this._invInertia01*e+this._invInertia02*r,m=this._invInertia10*n+this._invInertia11*e+this._invInertia12*r,b=this._invInertia20*n+this._invInertia21*e+this._invInertia22*r,n=c,e=m,r=b,this._angVelX+=n,this._angVelY+=e,this._angVelZ+=r,this._sleeping=!1,this._sleepTime=0}applyLinearImpulse(t){let i,s,a;i=t.x,s=t.y,a=t.z,this._velX+=i*this._invMass,this._velY+=s*this._invMass,this._velZ+=a*this._invMass,this._sleeping=!1,this._sleepTime=0}applyAngularImpulse(t){let i,s,a,o,n,e;i=t.x,s=t.y,a=t.z,o=this._invInertia00*i+this._invInertia01*s+this._invInertia02*a,n=this._invInertia10*i+this._invInertia11*s+this._invInertia12*a,e=this._invInertia20*i+this._invInertia21*s+this._invInertia22*a,i=o,s=n,a=e,this._angVelX+=i,this._angVelY+=s,this._angVelZ+=a,this._sleeping=!1,this._sleepTime=0}applyForce(t,i){let s,a,o,n,e,r,_,l,h;s=t.x,a=t.y,o=t.z,this._forceX+=s,this._forceY+=a,this._forceZ+=o,_=i.x,l=i.y,h=i.z,_-=this._transform._positionX,l-=this._transform._positionY,h-=this._transform._positionZ,n=l*o-h*a,e=h*s-_*o,r=_*a-l*s,this._torqueX+=n,this._torqueY+=e,this._torqueZ+=r,this._sleeping=!1,this._sleepTime=0}applyForceToCenter(t){let i,s,a;i=t.x,s=t.y,a=t.z,this._forceX+=i,this._forceY+=s,this._forceZ+=a,this._sleeping=!1,this._sleepTime=0}applyTorque(t){let i,s,a;i=t.x,s=t.y,a=t.z,this._torqueX+=i,this._torqueY+=s,this._torqueZ+=a,this._sleeping=!1,this._sleepTime=0}getLinearContactImpulse(){let t=new s.common.Vec3;return t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ,t}getLinearContactImpulseTo(t){t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ}getAngularContactImpulse(){let t=new s.common.Vec3;return t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ,t}getAngularContactImpulseTo(t){t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ}getGravityScale(){return this._gravityScale}setGravityScale(t){this._gravityScale=t,this._sleeping=!1,this._sleepTime=0}getLocalPoint(t){let i,a,o,n,e,r;i=t.x,a=t.y,o=t.z,i-=this._transform._positionX,a-=this._transform._positionY,o-=this._transform._positionZ,n=this._transform._rotation00*i+this._transform._rotation10*a+this._transform._rotation20*o,e=this._transform._rotation01*i+this._transform._rotation11*a+this._transform._rotation21*o,r=this._transform._rotation02*i+this._transform._rotation12*a+this._transform._rotation22*o,i=n,a=e,o=r;let _=new s.common.Vec3;return _.x=i,_.y=a,_.z=o,_}getLocalPointTo(t,i){let s,a,o,n,e,r;s=t.x,a=t.y,o=t.z,s-=this._transform._positionX,a-=this._transform._positionY,o-=this._transform._positionZ,n=this._transform._rotation00*s+this._transform._rotation10*a+this._transform._rotation20*o,e=this._transform._rotation01*s+this._transform._rotation11*a+this._transform._rotation21*o,r=this._transform._rotation02*s+this._transform._rotation12*a+this._transform._rotation22*o,s=n,a=e,o=r,i.x=s,i.y=a,i.z=o}getLocalVector(t){let i,a,o,n,e,r;i=t.x,a=t.y,o=t.z,n=this._transform._rotation00*i+this._transform._rotation10*a+this._transform._rotation20*o,e=this._transform._rotation01*i+this._transform._rotation11*a+this._transform._rotation21*o,r=this._transform._rotation02*i+this._transform._rotation12*a+this._transform._rotation22*o,i=n,a=e,o=r;let _=new s.common.Vec3;return _.x=i,_.y=a,_.z=o,_}getLocalVectorTo(t,i){let s,a,o,n,e,r;s=t.x,a=t.y,o=t.z,n=this._transform._rotation00*s+this._transform._rotation10*a+this._transform._rotation20*o,e=this._transform._rotation01*s+this._transform._rotation11*a+this._transform._rotation21*o,r=this._transform._rotation02*s+this._transform._rotation12*a+this._transform._rotation22*o,s=n,a=e,o=r,i.x=s,i.y=a,i.z=o}getWorldPoint(t){let i,a,o,n,e,r;i=t.x,a=t.y,o=t.z,n=this._transform._rotation00*i+this._transform._rotation01*a+this._transform._rotation02*o,e=this._transform._rotation10*i+this._transform._rotation11*a+this._transform._rotation12*o,r=this._transform._rotation20*i+this._transform._rotation21*a+this._transform._rotation22*o,i=n,a=e,o=r,i+=this._transform._positionX,a+=this._transform._positionY,o+=this._transform._positionZ;let _=new s.common.Vec3;return _.x=i,_.y=a,_.z=o,_}getWorldPointTo(t,i){let s,a,o,n,e,r;s=t.x,a=t.y,o=t.z,n=this._transform._rotation00*s+this._transform._rotation01*a+this._transform._rotation02*o,e=this._transform._rotation10*s+this._transform._rotation11*a+this._transform._rotation12*o,r=this._transform._rotation20*s+this._transform._rotation21*a+this._transform._rotation22*o,s=n,a=e,o=r,s+=this._transform._positionX,a+=this._transform._positionY,o+=this._transform._positionZ,i.x=s,i.y=a,i.z=o}getWorldVector(t){let i,a,o,n,e,r;i=t.x,a=t.y,o=t.z,n=this._transform._rotation00*i+this._transform._rotation01*a+this._transform._rotation02*o,e=this._transform._rotation10*i+this._transform._rotation11*a+this._transform._rotation12*o,r=this._transform._rotation20*i+this._transform._rotation21*a+this._transform._rotation22*o,i=n,a=e,o=r;let _=new s.common.Vec3;return _.x=i,_.y=a,_.z=o,_}getWorldVectorTo(t,i){let s,a,o,n,e,r;s=t.x,a=t.y,o=t.z,n=this._transform._rotation00*s+this._transform._rotation01*a+this._transform._rotation02*o,e=this._transform._rotation10*s+this._transform._rotation11*a+this._transform._rotation12*o,r=this._transform._rotation20*s+this._transform._rotation21*a+this._transform._rotation22*o,s=n,a=e,o=r,i.x=s,i.y=a,i.z=o}getNumShapes(){return this._numShapes}getShapeList(){return this._shapeList}getNumContactLinks(){return this._numContactLinks}getContactLinkList(){return this._contactLinkList}getNumJointLinks(){return this._numJointLinks}getJointLinkList(){return this._jointLinkList}addShape(t){if(null==this._shapeList?(this._shapeList=t,this._shapeListLast=t):(this._shapeListLast._next=t,t._prev=this._shapeListLast,this._shapeListLast=t),this._numShapes++,t._rigidBody=this,null!=this._world){let i=this._world;t._proxy=i._broadPhase.createProxy(t,t._aabb),t._id=i._shapeIdCount++,i._numShapes++}this.updateMass();let i=this._shapeList;for(;null!=i;){let t,s,a,o,n,e,r,_,l,h,c,m,b=i._next,p=this._ptransform,x=this._transform,f=i._ptransform,u=i._localTransform;t=p._rotation00*u._rotation00+p._rotation01*u._rotation10+p._rotation02*u._rotation20,s=p._rotation00*u._rotation01+p._rotation01*u._rotation11+p._rotation02*u._rotation21,a=p._rotation00*u._rotation02+p._rotation01*u._rotation12+p._rotation02*u._rotation22,o=p._rotation10*u._rotation00+p._rotation11*u._rotation10+p._rotation12*u._rotation20,n=p._rotation10*u._rotation01+p._rotation11*u._rotation11+p._rotation12*u._rotation21,e=p._rotation10*u._rotation02+p._rotation11*u._rotation12+p._rotation12*u._rotation22,r=p._rotation20*u._rotation00+p._rotation21*u._rotation10+p._rotation22*u._rotation20,_=p._rotation20*u._rotation01+p._rotation21*u._rotation11+p._rotation22*u._rotation21,l=p._rotation20*u._rotation02+p._rotation21*u._rotation12+p._rotation22*u._rotation22,f._rotation00=t,f._rotation01=s,f._rotation02=a,f._rotation10=o,f._rotation11=n,f._rotation12=e,f._rotation20=r,f._rotation21=_,f._rotation22=l,h=p._rotation00*u._positionX+p._rotation01*u._positionY+p._rotation02*u._positionZ,c=p._rotation10*u._positionX+p._rotation11*u._positionY+p._rotation12*u._positionZ,m=p._rotation20*u._positionX+p._rotation21*u._positionY+p._rotation22*u._positionZ,f._positionX=h,f._positionY=c,f._positionZ=m,f._positionX+=p._positionX,f._positionY+=p._positionY,f._positionZ+=p._positionZ;let y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T=i._transform,C=i._localTransform;if(y=x._rotation00*C._rotation00+x._rotation01*C._rotation10+x._rotation02*C._rotation20,v=x._rotation00*C._rotation01+x._rotation01*C._rotation11+x._rotation02*C._rotation21,d=x._rotation00*C._rotation02+x._rotation01*C._rotation12+x._rotation02*C._rotation22,g=x._rotation10*C._rotation00+x._rotation11*C._rotation10+x._rotation12*C._rotation20,X=x._rotation10*C._rotation01+x._rotation11*C._rotation11+x._rotation12*C._rotation21,Y=x._rotation10*C._rotation02+x._rotation11*C._rotation12+x._rotation12*C._rotation22,z=x._rotation20*C._rotation00+x._rotation21*C._rotation10+x._rotation22*C._rotation20,Z=x._rotation20*C._rotation01+x._rotation21*C._rotation11+x._rotation22*C._rotation21,M=x._rotation20*C._rotation02+x._rotation21*C._rotation12+x._rotation22*C._rotation22,T._rotation00=y,T._rotation01=v,T._rotation02=d,T._rotation10=g,T._rotation11=X,T._rotation12=Y,T._rotation20=z,T._rotation21=Z,T._rotation22=M,I=x._rotation00*C._positionX+x._rotation01*C._positionY+x._rotation02*C._positionZ,V=x._rotation10*C._positionX+x._rotation11*C._positionY+x._rotation12*C._positionZ,L=x._rotation20*C._positionX+x._rotation21*C._positionY+x._rotation22*C._positionZ,T._positionX=I,T._positionY=V,T._positionZ=L,T._positionX+=x._positionX,T._positionY+=x._positionY,T._positionZ+=x._positionZ,i._geom._computeAabb(i._aabb,i._ptransform),w=i._aabb._minX,k=i._aabb._minY,A=i._aabb._minZ,B=i._aabb._maxX,P=i._aabb._maxY,S=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=w<i._aabb._minX?w:i._aabb._minX,i._aabb._minY=k<i._aabb._minY?k:i._aabb._minY,i._aabb._minZ=A<i._aabb._minZ?A:i._aabb._minZ,i._aabb._maxX=B>i._aabb._maxX?B:i._aabb._maxX,i._aabb._maxY=P>i._aabb._maxY?P:i._aabb._maxY,i._aabb._maxZ=S>i._aabb._maxZ?S:i._aabb._maxZ,null!=i._proxy){let t,s,a;t=i._transform._positionX-i._ptransform._positionX,s=i._transform._positionY-i._ptransform._positionY,a=i._transform._positionZ-i._ptransform._positionZ;let o=i.displacement;o.x=t,o.y=s,o.z=a,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=b}}removeShape(t){let i=t._prev,s=t._next;if(null!=i&&(i._next=s),null!=s&&(s._prev=i),t==this._shapeList&&(this._shapeList=this._shapeList._next),t==this._shapeListLast&&(this._shapeListLast=this._shapeListLast._prev),t._next=null,t._prev=null,this._numShapes--,t._rigidBody=null,null!=this._world){let i=this._world;i._broadPhase.destroyProxy(t._proxy),t._proxy=null,t._id=-1;let s=t._rigidBody._contactLinkList;for(;null!=s;){let a=s._next,o=s._contact;if(o._s1==t||o._s2==t){let t=s._other;t._sleeping=!1,t._sleepTime=0;let a=i._contactManager,n=o._prev,e=o._next;if(null!=n&&(n._next=e),null!=e&&(e._prev=n),o==a._contactList&&(a._contactList=a._contactList._next),o==a._contactListLast&&(a._contactListLast=a._contactListLast._prev),o._next=null,o._prev=null,o._touching){let t=o._s1._contactCallback,i=o._s2._contactCallback;t==i&&(i=null),null!=t&&t.endContact(o),null!=i&&i.endContact(o)}let r=o._link1._prev,_=o._link1._next;null!=r&&(r._next=_),null!=_&&(_._prev=r),o._link1==o._b1._contactLinkList&&(o._b1._contactLinkList=o._b1._contactLinkList._next),o._link1==o._b1._contactLinkListLast&&(o._b1._contactLinkListLast=o._b1._contactLinkListLast._prev),o._link1._next=null,o._link1._prev=null;let l=o._link2._prev,h=o._link2._next;null!=l&&(l._next=h),null!=h&&(h._prev=l),o._link2==o._b2._contactLinkList&&(o._b2._contactLinkList=o._b2._contactLinkList._next),o._link2==o._b2._contactLinkListLast&&(o._b2._contactLinkListLast=o._b2._contactLinkListLast._prev),o._link2._next=null,o._link2._prev=null,o._b1._numContactLinks--,o._b2._numContactLinks--,o._link1._other=null,o._link2._other=null,o._link1._contact=null,o._link2._contact=null,o._s1=null,o._s2=null,o._b1=null,o._b2=null,o._touching=!1,o._cachedDetectorData._clear(),o._manifold._clear(),o._detector=null;let c=o._contactConstraint;c._s1=null,c._s2=null,c._b1=null,c._b2=null,c._tf1=null,c._tf2=null,o._next=a._contactPool,a._contactPool=o,a._numContacts--}s=a}i._numShapes--}this.updateMass();let a=this._shapeList;for(;null!=a;){let t,i,s,o,n,e,r,_,l,h,c,m,b=a._next,p=this._ptransform,x=this._transform,f=a._ptransform,u=a._localTransform;t=p._rotation00*u._rotation00+p._rotation01*u._rotation10+p._rotation02*u._rotation20,i=p._rotation00*u._rotation01+p._rotation01*u._rotation11+p._rotation02*u._rotation21,s=p._rotation00*u._rotation02+p._rotation01*u._rotation12+p._rotation02*u._rotation22,o=p._rotation10*u._rotation00+p._rotation11*u._rotation10+p._rotation12*u._rotation20,n=p._rotation10*u._rotation01+p._rotation11*u._rotation11+p._rotation12*u._rotation21,e=p._rotation10*u._rotation02+p._rotation11*u._rotation12+p._rotation12*u._rotation22,r=p._rotation20*u._rotation00+p._rotation21*u._rotation10+p._rotation22*u._rotation20,_=p._rotation20*u._rotation01+p._rotation21*u._rotation11+p._rotation22*u._rotation21,l=p._rotation20*u._rotation02+p._rotation21*u._rotation12+p._rotation22*u._rotation22,f._rotation00=t,f._rotation01=i,f._rotation02=s,f._rotation10=o,f._rotation11=n,f._rotation12=e,f._rotation20=r,f._rotation21=_,f._rotation22=l,h=p._rotation00*u._positionX+p._rotation01*u._positionY+p._rotation02*u._positionZ,c=p._rotation10*u._positionX+p._rotation11*u._positionY+p._rotation12*u._positionZ,m=p._rotation20*u._positionX+p._rotation21*u._positionY+p._rotation22*u._positionZ,f._positionX=h,f._positionY=c,f._positionZ=m,f._positionX+=p._positionX,f._positionY+=p._positionY,f._positionZ+=p._positionZ;let y,v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T=a._transform,C=a._localTransform;if(y=x._rotation00*C._rotation00+x._rotation01*C._rotation10+x._rotation02*C._rotation20,v=x._rotation00*C._rotation01+x._rotation01*C._rotation11+x._rotation02*C._rotation21,d=x._rotation00*C._rotation02+x._rotation01*C._rotation12+x._rotation02*C._rotation22,g=x._rotation10*C._rotation00+x._rotation11*C._rotation10+x._rotation12*C._rotation20,X=x._rotation10*C._rotation01+x._rotation11*C._rotation11+x._rotation12*C._rotation21,Y=x._rotation10*C._rotation02+x._rotation11*C._rotation12+x._rotation12*C._rotation22,z=x._rotation20*C._rotation00+x._rotation21*C._rotation10+x._rotation22*C._rotation20,Z=x._rotation20*C._rotation01+x._rotation21*C._rotation11+x._rotation22*C._rotation21,M=x._rotation20*C._rotation02+x._rotation21*C._rotation12+x._rotation22*C._rotation22,T._rotation00=y,T._rotation01=v,T._rotation02=d,T._rotation10=g,T._rotation11=X,T._rotation12=Y,T._rotation20=z,T._rotation21=Z,T._rotation22=M,I=x._rotation00*C._positionX+x._rotation01*C._positionY+x._rotation02*C._positionZ,V=x._rotation10*C._positionX+x._rotation11*C._positionY+x._rotation12*C._positionZ,L=x._rotation20*C._positionX+x._rotation21*C._positionY+x._rotation22*C._positionZ,T._positionX=I,T._positionY=V,T._positionZ=L,T._positionX+=x._positionX,T._positionY+=x._positionY,T._positionZ+=x._positionZ,a._geom._computeAabb(a._aabb,a._ptransform),w=a._aabb._minX,k=a._aabb._minY,A=a._aabb._minZ,B=a._aabb._maxX,P=a._aabb._maxY,S=a._aabb._maxZ,a._geom._computeAabb(a._aabb,a._transform),a._aabb._minX=w<a._aabb._minX?w:a._aabb._minX,a._aabb._minY=k<a._aabb._minY?k:a._aabb._minY,a._aabb._minZ=A<a._aabb._minZ?A:a._aabb._minZ,a._aabb._maxX=B>a._aabb._maxX?B:a._aabb._maxX,a._aabb._maxY=P>a._aabb._maxY?P:a._aabb._maxY,a._aabb._maxZ=S>a._aabb._maxZ?S:a._aabb._maxZ,null!=a._proxy){let t,i,s;t=a._transform._positionX-a._ptransform._positionX,i=a._transform._positionY-a._ptransform._positionY,s=a._transform._positionZ-a._ptransform._positionZ;let o=a.displacement;o.x=t,o.y=i,o.z=s,a._rigidBody._world._broadPhase.moveProxy(a._proxy,a._aabb,a.displacement)}a=b}}getType(){return this._type}setType(t){this._type=t,this.updateMass()}wakeUp(){this._sleeping=!1,this._sleepTime=0}sleep(){this._sleeping=!0,this._sleepTime=0}isSleeping(){return this._sleeping}getSleepTime(){return this._sleepTime}setAutoSleep(t){this._autoSleep=t,this._sleeping=!1,this._sleepTime=0}getLinearDamping(){return this._linearDamping}setLinearDamping(t){this._linearDamping=t}getAngularDamping(){return this._angularDamping}setAngularDamping(t){this._angularDamping=t}getPrev(){return this._prev}getNext(){return this._next}},s.dynamics.rigidbody.RigidBodyConfig=class{constructor(){this.position=new s.common.Vec3,this.rotation=new s.common.Mat3,this.linearVelocity=new s.common.Vec3,this.angularVelocity=new s.common.Vec3,this.type=0,this.autoSleep=!0,this.linearDamping=0,this.angularDamping=0}},s.dynamics.rigidbody.RigidBodyType=class{},s.dynamics.rigidbody.Shape=class{constructor(t){this._id=-1,this._localTransform=new s.common.Transform,this._ptransform=new s.common.Transform,this._transform=new s.common.Transform;let i=t.position;this._localTransform._positionX=i.x,this._localTransform._positionY=i.y,this._localTransform._positionZ=i.z;let a=t.rotation;this._localTransform._rotation00=a.e00,this._localTransform._rotation01=a.e01,this._localTransform._rotation02=a.e02,this._localTransform._rotation10=a.e10,this._localTransform._rotation11=a.e11,this._localTransform._rotation12=a.e12,this._localTransform._rotation20=a.e20,this._localTransform._rotation21=a.e21,this._localTransform._rotation22=a.e22;let o=this._ptransform,n=this._localTransform;o._positionX=n._positionX,o._positionY=n._positionY,o._positionZ=n._positionZ,o._rotation00=n._rotation00,o._rotation01=n._rotation01,o._rotation02=n._rotation02,o._rotation10=n._rotation10,o._rotation11=n._rotation11,o._rotation12=n._rotation12,o._rotation20=n._rotation20,o._rotation21=n._rotation21,o._rotation22=n._rotation22;let e=this._transform,r=this._localTransform;e._positionX=r._positionX,e._positionY=r._positionY,e._positionZ=r._positionZ,e._rotation00=r._rotation00,e._rotation01=r._rotation01,e._rotation02=r._rotation02,e._rotation10=r._rotation10,e._rotation11=r._rotation11,e._rotation12=r._rotation12,e._rotation20=r._rotation20,e._rotation21=r._rotation21,e._rotation22=r._rotation22,this._restitution=t.restitution,this._friction=t.friction,this._density=t.density,this._geom=t.geometry,this._collisionGroup=t.collisionGroup,this._collisionMask=t.collisionMask,this._contactCallback=t.contactCallback,this._aabb=new s.collision.geometry.Aabb,this._proxy=null,this.displacement=new s.common.Vec3}getFriction(){return this._friction}setFriction(t){this._friction=t}getRestitution(){return this._restitution}setRestitution(t){this._restitution=t}getLocalTransform(){let t=this._localTransform,i=new s.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getLocalTransformTo(t){let i=this._localTransform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}getTransform(){let t=this._transform,i=new s.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getTransformTo(t){let i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}setLocalTransform(t){let i=this._localTransform;if(i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,null!=this._rigidBody){let t=this._rigidBody;t.updateMass();let i=t._shapeList;for(;null!=i;){let s,a,o,n,e,r,_,l,h,c,m,b,p=i._next,x=t._ptransform,f=t._transform,u=i._ptransform,y=i._localTransform;s=x._rotation00*y._rotation00+x._rotation01*y._rotation10+x._rotation02*y._rotation20,a=x._rotation00*y._rotation01+x._rotation01*y._rotation11+x._rotation02*y._rotation21,o=x._rotation00*y._rotation02+x._rotation01*y._rotation12+x._rotation02*y._rotation22,n=x._rotation10*y._rotation00+x._rotation11*y._rotation10+x._rotation12*y._rotation20,e=x._rotation10*y._rotation01+x._rotation11*y._rotation11+x._rotation12*y._rotation21,r=x._rotation10*y._rotation02+x._rotation11*y._rotation12+x._rotation12*y._rotation22,_=x._rotation20*y._rotation00+x._rotation21*y._rotation10+x._rotation22*y._rotation20,l=x._rotation20*y._rotation01+x._rotation21*y._rotation11+x._rotation22*y._rotation21,h=x._rotation20*y._rotation02+x._rotation21*y._rotation12+x._rotation22*y._rotation22,u._rotation00=s,u._rotation01=a,u._rotation02=o,u._rotation10=n,u._rotation11=e,u._rotation12=r,u._rotation20=_,u._rotation21=l,u._rotation22=h,c=x._rotation00*y._positionX+x._rotation01*y._positionY+x._rotation02*y._positionZ,m=x._rotation10*y._positionX+x._rotation11*y._positionY+x._rotation12*y._positionZ,b=x._rotation20*y._positionX+x._rotation21*y._positionY+x._rotation22*y._positionZ,u._positionX=c,u._positionY=m,u._positionZ=b,u._positionX+=x._positionX,u._positionY+=x._positionY,u._positionZ+=x._positionZ;let v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T,C=i._transform,j=i._localTransform;if(v=f._rotation00*j._rotation00+f._rotation01*j._rotation10+f._rotation02*j._rotation20,d=f._rotation00*j._rotation01+f._rotation01*j._rotation11+f._rotation02*j._rotation21,g=f._rotation00*j._rotation02+f._rotation01*j._rotation12+f._rotation02*j._rotation22,X=f._rotation10*j._rotation00+f._rotation11*j._rotation10+f._rotation12*j._rotation20,Y=f._rotation10*j._rotation01+f._rotation11*j._rotation11+f._rotation12*j._rotation21,z=f._rotation10*j._rotation02+f._rotation11*j._rotation12+f._rotation12*j._rotation22,Z=f._rotation20*j._rotation00+f._rotation21*j._rotation10+f._rotation22*j._rotation20,M=f._rotation20*j._rotation01+f._rotation21*j._rotation11+f._rotation22*j._rotation21,I=f._rotation20*j._rotation02+f._rotation21*j._rotation12+f._rotation22*j._rotation22,C._rotation00=v,C._rotation01=d,C._rotation02=g,C._rotation10=X,C._rotation11=Y,C._rotation12=z,C._rotation20=Z,C._rotation21=M,C._rotation22=I,V=f._rotation00*j._positionX+f._rotation01*j._positionY+f._rotation02*j._positionZ,L=f._rotation10*j._positionX+f._rotation11*j._positionY+f._rotation12*j._positionZ,w=f._rotation20*j._positionX+f._rotation21*j._positionY+f._rotation22*j._positionZ,C._positionX=V,C._positionY=L,C._positionZ=w,C._positionX+=f._positionX,C._positionY+=f._positionY,C._positionZ+=f._positionZ,i._geom._computeAabb(i._aabb,i._ptransform),k=i._aabb._minX,A=i._aabb._minY,B=i._aabb._minZ,P=i._aabb._maxX,S=i._aabb._maxY,T=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=k<i._aabb._minX?k:i._aabb._minX,i._aabb._minY=A<i._aabb._minY?A:i._aabb._minY,i._aabb._minZ=B<i._aabb._minZ?B:i._aabb._minZ,i._aabb._maxX=P>i._aabb._maxX?P:i._aabb._maxX,i._aabb._maxY=S>i._aabb._maxY?S:i._aabb._maxY,i._aabb._maxZ=T>i._aabb._maxZ?T:i._aabb._maxZ,null!=i._proxy){let t,s,a;t=i._transform._positionX-i._ptransform._positionX,s=i._transform._positionY-i._ptransform._positionY,a=i._transform._positionZ-i._ptransform._positionZ;let o=i.displacement;o.x=t,o.y=s,o.z=a,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=p}}}getDensity(){return this._density}setDensity(t){if(this._density=t,null!=this._rigidBody){let t=this._rigidBody;t.updateMass();let i=t._shapeList;for(;null!=i;){let s,a,o,n,e,r,_,l,h,c,m,b,p=i._next,x=t._ptransform,f=t._transform,u=i._ptransform,y=i._localTransform;s=x._rotation00*y._rotation00+x._rotation01*y._rotation10+x._rotation02*y._rotation20,a=x._rotation00*y._rotation01+x._rotation01*y._rotation11+x._rotation02*y._rotation21,o=x._rotation00*y._rotation02+x._rotation01*y._rotation12+x._rotation02*y._rotation22,n=x._rotation10*y._rotation00+x._rotation11*y._rotation10+x._rotation12*y._rotation20,e=x._rotation10*y._rotation01+x._rotation11*y._rotation11+x._rotation12*y._rotation21,r=x._rotation10*y._rotation02+x._rotation11*y._rotation12+x._rotation12*y._rotation22,_=x._rotation20*y._rotation00+x._rotation21*y._rotation10+x._rotation22*y._rotation20,l=x._rotation20*y._rotation01+x._rotation21*y._rotation11+x._rotation22*y._rotation21,h=x._rotation20*y._rotation02+x._rotation21*y._rotation12+x._rotation22*y._rotation22,u._rotation00=s,u._rotation01=a,u._rotation02=o,u._rotation10=n,u._rotation11=e,u._rotation12=r,u._rotation20=_,u._rotation21=l,u._rotation22=h,c=x._rotation00*y._positionX+x._rotation01*y._positionY+x._rotation02*y._positionZ,m=x._rotation10*y._positionX+x._rotation11*y._positionY+x._rotation12*y._positionZ,b=x._rotation20*y._positionX+x._rotation21*y._positionY+x._rotation22*y._positionZ,u._positionX=c,u._positionY=m,u._positionZ=b,u._positionX+=x._positionX,u._positionY+=x._positionY,u._positionZ+=x._positionZ;let v,d,g,X,Y,z,Z,M,I,V,L,w,k,A,B,P,S,T,C=i._transform,j=i._localTransform;if(v=f._rotation00*j._rotation00+f._rotation01*j._rotation10+f._rotation02*j._rotation20,d=f._rotation00*j._rotation01+f._rotation01*j._rotation11+f._rotation02*j._rotation21,g=f._rotation00*j._rotation02+f._rotation01*j._rotation12+f._rotation02*j._rotation22,X=f._rotation10*j._rotation00+f._rotation11*j._rotation10+f._rotation12*j._rotation20,Y=f._rotation10*j._rotation01+f._rotation11*j._rotation11+f._rotation12*j._rotation21,z=f._rotation10*j._rotation02+f._rotation11*j._rotation12+f._rotation12*j._rotation22,Z=f._rotation20*j._rotation00+f._rotation21*j._rotation10+f._rotation22*j._rotation20,M=f._rotation20*j._rotation01+f._rotation21*j._rotation11+f._rotation22*j._rotation21,I=f._rotation20*j._rotation02+f._rotation21*j._rotation12+f._rotation22*j._rotation22,C._rotation00=v,C._rotation01=d,C._rotation02=g,C._rotation10=X,C._rotation11=Y,C._rotation12=z,C._rotation20=Z,C._rotation21=M,C._rotation22=I,V=f._rotation00*j._positionX+f._rotation01*j._positionY+f._rotation02*j._positionZ,L=f._rotation10*j._positionX+f._rotation11*j._positionY+f._rotation12*j._positionZ,w=f._rotation20*j._positionX+f._rotation21*j._positionY+f._rotation22*j._positionZ,C._positionX=V,C._positionY=L,C._positionZ=w,C._positionX+=f._positionX,C._positionY+=f._positionY,C._positionZ+=f._positionZ,i._geom._computeAabb(i._aabb,i._ptransform),k=i._aabb._minX,A=i._aabb._minY,B=i._aabb._minZ,P=i._aabb._maxX,S=i._aabb._maxY,T=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=k<i._aabb._minX?k:i._aabb._minX,i._aabb._minY=A<i._aabb._minY?A:i._aabb._minY,i._aabb._minZ=B<i._aabb._minZ?B:i._aabb._minZ,i._aabb._maxX=P>i._aabb._maxX?P:i._aabb._maxX,i._aabb._maxY=S>i._aabb._maxY?S:i._aabb._maxY,i._aabb._maxZ=T>i._aabb._maxZ?T:i._aabb._maxZ,null!=i._proxy){let t,s,a;t=i._transform._positionX-i._ptransform._positionX,s=i._transform._positionY-i._ptransform._positionY,a=i._transform._positionZ-i._ptransform._positionZ;let o=i.displacement;o.x=t,o.y=s,o.z=a,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=p}}}getAabb(){return this._aabb.clone()}getAabbTo(t){t.copyFrom(this._aabb)}getGeometry(){return this._geom}getRigidBody(){return this._rigidBody}getCollisionGroup(){return this._collisionGroup}setCollisionGroup(t){this._collisionGroup=t}getCollisionMask(){return this._collisionMask}setCollisionMask(t){this._collisionMask=t}getContactCallback(){return this._contactCallback}setContactCallback(t){this._contactCallback=t}getPrev(){return this._prev}getNext(){return this._next}},s.dynamics.rigidbody.ShapeConfig=class{constructor(){this.position=new s.common.Vec3,this.rotation=new s.common.Mat3,this.friction=s.common.Setting.defaultFriction,this.restitution=s.common.Setting.defaultRestitution,this.density=s.common.Setting.defaultDensity,this.collisionGroup=s.common.Setting.defaultCollisionGroup,this.collisionMask=s.common.Setting.defaultCollisionMask,this.geometry=null,this.contactCallback=null}},s.m||(s.m={}),s.m.M=class{},s.collision.broadphase.BroadPhaseType._BRUTE_FORCE=1,s.collision.broadphase.BroadPhaseType._BVH=2,s.collision.broadphase.BroadPhaseType.BRUTE_FORCE=1,s.collision.broadphase.BroadPhaseType.BVH=2,s.collision.broadphase.bvh.BvhInsertionStrategy.SIMPLE=0,s.collision.broadphase.bvh.BvhInsertionStrategy.MINIMIZE_SURFACE_AREA=1,s.collision.geometry.GeometryType._SPHERE=0,s.collision.geometry.GeometryType._BOX=1,s.collision.geometry.GeometryType._CYLINDER=2,s.collision.geometry.GeometryType._CONE=3,s.collision.geometry.GeometryType._CAPSULE=4,s.collision.geometry.GeometryType._CONVEX_HULL=5,s.collision.geometry.GeometryType._CONVEX_MIN=0,s.collision.geometry.GeometryType._CONVEX_MAX=5,s.collision.geometry.GeometryType.SPHERE=0,s.collision.geometry.GeometryType.BOX=1,s.collision.geometry.GeometryType.CYLINDER=2,s.collision.geometry.GeometryType.CONE=3,s.collision.geometry.GeometryType.CAPSULE=4,s.collision.geometry.GeometryType.CONVEX_HULL=5,s.collision.narrowphase.detector.BoxBoxDetector.EDGE_BIAS_MULT=1,s.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.OK=0,s.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.INVALID_TRIANGLE=1,s.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_PAIR_INDEX=2,s.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_TRIANGLE=3,s.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.EDGE_LOOP_BROKEN=4,s.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_OUTER_TRIANGLE=5,s.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.TRIANGLE_INVISIBLE=6,s.collision.narrowphase.detector.gjkepa.EpaTriangle.count=0,s.common.Vec3.numCreations=0,s.common.Setting.defaultFriction=.2,s.common.Setting.defaultRestitution=.2,s.common.Setting.defaultDensity=1,s.common.Setting.defaultCollisionGroup=1,s.common.Setting.defaultCollisionMask=1,s.common.Setting.maxTranslationPerStep=20,s.common.Setting.maxRotationPerStep=3.14159265358979,s.common.Setting.bvhProxyPadding=.1,s.common.Setting.bvhIncrementalCollisionThreshold=.45,s.common.Setting.defaultGJKMargin=.05,s.common.Setting.enableGJKCaching=!0,s.common.Setting.maxEPAVertices=128,s.common.Setting.maxEPAPolyhedronFaces=128,s.common.Setting.contactEnableBounceThreshold=.5,s.common.Setting.velocityBaumgarte=.2,s.common.Setting.positionSplitImpulseBaumgarte=.4,s.common.Setting.positionNgsBaumgarte=1,s.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05,s.common.Setting.defaultContactPositionCorrectionAlgorithm=0,s.common.Setting.alternativeContactPositionCorrectionAlgorithm=1,s.common.Setting.contactPersistenceThreshold=.05,s.common.Setting.maxManifoldPoints=4,s.common.Setting.defaultJointConstraintSolverType=0,s.common.Setting.defaultJointPositionCorrectionAlgorithm=0,s.common.Setting.jointWarmStartingFactorForBaungarte=.8,s.common.Setting.jointWarmStartingFactor=.95,s.common.Setting.minSpringDamperDampingRatio=1e-6,s.common.Setting.minRagdollMaxSwingAngle=1e-6,s.common.Setting.maxJacobianRows=6,s.common.Setting.directMlcpSolverEps=1e-9,s.common.Setting.islandInitialRigidBodyArraySize=128,s.common.Setting.islandInitialConstraintArraySize=128,s.common.Setting.sleepingVelocityThreshold=.2,s.common.Setting.sleepingAngularVelocityThreshold=.5,s.common.Setting.sleepingTimeThreshold=1,s.common.Setting.disableSleeping=!1,s.common.Setting.linearSlop=.005,s.common.Setting.angularSlop=.017453292519943278,s.collision.narrowphase.detector.gjkepa.GjkEpa.instance=new s.collision.narrowphase.detector.gjkepa.GjkEpa,s.collision.narrowphase.detector.gjkepa.GjkEpaResultState._SUCCEEDED=0,s.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_FAILED_TO_MAKE_TETRAHEDRON=1,s.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_DID_NOT_CONVERGE=2,s.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_INIT=257,s.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_ADD_VERTEX=258,s.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_DID_NOT_CONVERGE=259,s.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED=0,s.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_FAILED_TO_MAKE_TETRAHEDRON=1,s.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_DID_NOT_CONVERGE=2,s.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT=257,s.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX=258,s.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE=259,s.common.Mat3.numCreations=0,s.common.Mat4.numCreations=0,s.common.MathUtil.POSITIVE_INFINITY=Infinity,s.common.MathUtil.NEGATIVE_INFINITY=-Infinity,s.common.MathUtil.PI=3.14159265358979,s.common.MathUtil.TWO_PI=6.28318530717958,s.common.MathUtil.HALF_PI=1.570796326794895,s.common.MathUtil.TO_RADIANS=.017453292519943278,s.common.MathUtil.TO_DEGREES=57.29577951308238,s.common.Quat.numCreations=0,s.dynamics.common.DebugDraw.SPHERE_PHI_DIVISION=8,s.dynamics.common.DebugDraw.SPHERE_THETA_DIVISION=4,s.dynamics.common.DebugDraw.CIRCLE_THETA_DIVISION=8,s.dynamics.common.Performance.broadPhaseCollisionTime=0,s.dynamics.common.Performance.narrowPhaseCollisionTime=0,s.dynamics.common.Performance.dynamicsTime=0,s.dynamics.common.Performance.totalTime=0,s.dynamics.constraint.PositionCorrectionAlgorithm._BAUMGARTE=0,s.dynamics.constraint.PositionCorrectionAlgorithm._SPLIT_IMPULSE=1,s.dynamics.constraint.PositionCorrectionAlgorithm._NGS=2,s.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE=0,s.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE=1,s.dynamics.constraint.PositionCorrectionAlgorithm.NGS=2,s.dynamics.constraint.info.JacobianRow.BIT_LINEAR_SET=1,s.dynamics.constraint.info.JacobianRow.BIT_ANGULAR_SET=2,s.dynamics.constraint.joint.JointType._SPHERICAL=0,s.dynamics.constraint.joint.JointType._REVOLUTE=1,s.dynamics.constraint.joint.JointType._CYLINDRICAL=2,s.dynamics.constraint.joint.JointType._PRISMATIC=3,s.dynamics.constraint.joint.JointType._UNIVERSAL=4,s.dynamics.constraint.joint.JointType._RAGDOLL=5,s.dynamics.constraint.joint.JointType._GENERIC=6,s.dynamics.constraint.joint.JointType.SPHERICAL=0,s.dynamics.constraint.joint.JointType.REVOLUTE=1,s.dynamics.constraint.joint.JointType.CYLINDRICAL=2,s.dynamics.constraint.joint.JointType.PRISMATIC=3,s.dynamics.constraint.joint.JointType.UNIVERSAL=4,s.dynamics.constraint.joint.JointType.RAGDOLL=5,s.dynamics.constraint.joint.JointType.GENERIC=6,s.dynamics.constraint.solver.ConstraintSolverType._ITERATIVE=0,s.dynamics.constraint.solver.ConstraintSolverType._DIRECT=1,s.dynamics.constraint.solver.ConstraintSolverType.ITERATIVE=0,s.dynamics.constraint.solver.ConstraintSolverType.DIRECT=1,s.dynamics.rigidbody.RigidBodyType._DYNAMIC=0,s.dynamics.rigidbody.RigidBodyType._STATIC=1,s.dynamics.rigidbody.RigidBodyType._KINEMATIC=2,s.dynamics.rigidbody.RigidBodyType.DYNAMIC=0,s.dynamics.rigidbody.RigidBodyType.STATIC=1,s.dynamics.rigidbody.RigidBodyType.KINEMATIC=2;const a=new Map,o=new Map,n={Ar:null,ArPos:{},world:null,bodyRef:null,queryCollector:null,delta:0,deltaTime:0,tmpStep:0,substep:1,key:[],gravity:[0,9.81,0],reflow:{ray:[],stat:{fps:0,delta:0}}},e={clear:()=>{o.clear(),a.clear()},byName:t=>a.has(t)?a.get(t):null,byId:t=>o.has(t)?o.get(t):null,add:t=>{"ray"!==t.type&&"contact"!==t.type&&"terrain"!==t.type&&"joint"!==t.type&&t.type,"body"!==t.type&&"solid"!==t.type||o.set(t[0],t),a.set(t.name,t)},remove:t=>{if("ray"!==t.type&&"contact"!==t.type)switch(t.type){case"terrain":t.release();break;case"joint":havok.HP_Constraint_SetEnabled(t,!1),havok.HP_Constraint_Release(t);break;default:havok.HP_World_RemoveBody(n.world,t),havok.HP_Body_Release(t)}a.delete(t.name)},stats:()=>{},extends:()=>{}},r=2e3,_=500,l=50,h=100,c=50,m=50,b=20,p={bodyFull:14,body:8,joint:16,contact:8,ray:11,character:16,vehicle:72,solver:128},x=Math.PI,f=x/180,u=180/x,y=Number.EPSILON,v={todeg:u,torad:f,toFixed:(t,i=3)=>1*t.toFixed(i),clamp:(t,i,s)=>t=(t=t<i?i:t)>s?s:t,clampA:(t,i,s)=>Math.max(i,Math.min(s,t)),lerp:(t,i,s)=>(1-s)*t+s*i,damp:(t,i,s,a)=>v.lerp(t,i,1-Math.exp(-s*a)),nearAngle:(t,i,s=!1)=>i+Math.atan2(Math.sin(t-i),Math.cos(t-i))*(s?u:1),unwrapDeg:t=>t-360*Math.floor((t+180)/360),unwrapRad:t=>Math.atan2(Math.sin(t),Math.cos(t)),nearEquals:(t,i,s)=>Math.abs(t-i)<=s,autoSize:(t=[1,1,1],i="box")=>{1===t.length&&(t[1]=t[0]);let s=t[0],a=t[1];return"sphere"===i&&(t=[s,s,s]),"cylinder"!==i&&"wheel"!==i&&"capsule"!==i||(t=[s,a,s]),"cone"!==i&&"pyramid"!==i||(t=[s,a,s]),2===t.length&&(t[2]=t[0]),t},randomSign:()=>Math.random()<.5?-1:1,randSpread:t=>t*(.5-Math.random()),rand:(t=0,i=1)=>t+Math.random()*(i-t),randInt:(t,i)=>t+Math.floor(Math.random()*(i-t+1)),equalArray:(t,i)=>{let s=t.length;for(;s--;)if(t[s]!==i[s])return!1;return!0},composeMatrixArray:(t,i,s=[1,1,1])=>{const a=i[0],o=i[1],n=i[2],e=i[3],r=a+a,_=o+o,l=n+n,h=a*r,c=a*_,m=a*l,b=o*_,p=o*l,x=n*l,f=e*r,u=e*_,y=e*l,v=s[0],d=s[1],g=s[2];return[(1-(b+x))*v,(c+y)*v,(m-u)*v,0,(c-y)*d,(1-(h+x))*d,(p+f)*d,0,(m+u)*g,(p-f)*g,(1-(h+b))*g,0,t[0],t[1],t[2],1]},decomposeMatrixArray:t=>[t[12],t[13],t[14]],applyTransformArray:(t,i,s,a=[1,1,1])=>{const o=v.composeMatrixArray(i,s,a),n=t[0],e=t[1],r=t[2],_=1/(o[3]*n+o[7]*e+o[11]*r+o[15]);return[(o[0]*n+o[4]*e+o[8]*r+o[12])*_,(o[1]*n+o[5]*e+o[9]*r+o[13])*_,(o[2]*n+o[6]*e+o[10]*r+o[14])*_]},equalArray:(t,i)=>{let s=t.length;for(;s--;)if(t[s]!==i[s])return!1;return!0},lerpArray:(t,i,s)=>{if(0===s)return t;if(1===s)return i;let a=t.length,o=[];for(;a--;)o[a]=t[a],o[a]+=(i[a]-o[a])*s;return o},slerpQuatArray:(t,i,s)=>{if(0===s)return t;if(1===s)return i;let a=[...t];const o=t[0],n=t[1],e=t[2],r=t[3],_=i[0],l=i[1],h=i[2],c=i[3];let m=r*c+o*_+n*l+e*h;if(m<0?(a=[-_,-l,-h,-c],m=-m):a=[...i],m>=1)return t;const b=1-m*m;if(b<=y){const t=1-s;return a[3]=t*r+s*a[3],a[0]=t*o+s*a[0],a[1]=t*n+s*a[1],a[2]=t*e+s*a[2],v.quatNomalize(a)}const p=Math.sqrt(b),x=Math.atan2(p,m),f=Math.sin((1-s)*x)/p,u=Math.sin(s*x)/p;return a[3]=r*f+a[3]*u,a[0]=o*f+a[0]*u,a[1]=n*f+a[1]*u,a[2]=e*f+a[2]*u,a},toLocalQuatArray:(t=[0,0,0],i)=>{let s=v.quatFromEuler(t),a=v.quatInvert(i.quaternion.toArray());return v.quatMultiply(a,s)},quatFromEuler:(t=[0,0,0],i=!0)=>{const s=Math.cos,a=Math.sin,o=i?f:1,n=t[0]*o*.5,e=t[1]*o*.5,r=t[2]*o*.5,_=s(n),l=s(e),h=s(r),c=a(n),m=a(e),b=a(r);return[c*l*h+_*m*b,_*m*h-c*l*b,_*l*b+c*m*h,_*l*h-c*m*b]},quatFromAxis:(t=[0,0,0],i,s=!0)=>{const a=.5*i*(s?f:1),o=Math.sin(a);return[t[0]*o,t[1]*o,t[2]*o,Math.cos(a)]},quatNomalize:t=>{let i=v.lengthArray(t);return 0===i?[0,0,0,1]:(i=1/i,v.scaleArray(t,i,4))},quatInvert:t=>[-t[0],-t[1],-t[2],t[3]],quatMultiply:(t,i)=>{const s=t[0],a=t[1],o=t[2],n=t[3],e=i[0],r=i[1],_=i[2],l=i[3];return[s*l+n*e+a*_-o*r,a*l+n*r+o*e-s*_,o*l+n*_+s*r-a*e,n*l-s*e-a*r-o*_]},quatToAxis:t=>{let i=2*Math.acos(t[3]);const s=Math.sqrt(1-t[3]*t[3]);return s<1e-4?[1,0,0]:[t[0]/s,t[1]/s,t[2]/s,i]},eulerFromMatrix:t=>{const i=t[0],s=t[4],a=t[8];t[1];const o=t[5],n=t[9];t[2];const e=t[6],r=t[10];let _=[0,0,0];return _[1]=Math.asin(v.clamp(a,-1,1)),Math.abs(a)<.9999999?(_[0]=Math.atan2(-n,r),_[2]=Math.atan2(-s,i)):(_[0]=Math.atan2(e,o),_[2]=0),_},angleTo:(t,i)=>2*Math.acos(Math.abs(v.clamp(v.dotArray(t,i),-1,1))),lengthArray:t=>{let i=t.length,s=0;for(;i--;)s+=t[i]*t[i];return Math.sqrt(s)},dotArray:(t,i)=>{let s=t.length,a=0;for(;s--;)a+=t[s]*i[s];return a},addArray:(t,i,s)=>{s=s??t.length;let a=[];for(;s--;)a[s]=t[s]+i[s];return a},subArray:(t,i,s)=>{s=s??t.length;let a=[];for(;s--;)a[s]=t[s]-i[s];return a},mulArray:(t,i,s)=>{for(s=s??t.length;s--;)t[s]*=i;return t},divArray:(t,i,s)=>v.scaleArray(t,1/i,s),scaleArray:(t,i,s)=>{for(s=s??t.length;s--;)t[s]*=i;return t},fillArray(t,i,s,a){for(s=s||0,a=a??t.length;a--;)i[s+a]=t[a]},copyArray:(t,i)=>{},distanceArray:(t,i=[0,0,0])=>v.lengthArray(v.subArray(t,i)),getVolume:(t,i,s=null)=>{let a=1,o=i;switch(t){case"sphere":a=4*Math.PI*o[0]*o[0]*o[0]/3;break;case"cone":a=Math.PI*o[0]*(.5*o[1])*2;break;case"box":a=.5*o[0]*8*(.5*o[1])*(.5*o[2]);break;case"cylinder":a=Math.PI*o[0]*o[0]*(.5*o[1])*2;break;case"capsule":a=4*Math.PI*o[0]*o[0]*o[0]/3+Math.PI*o[0]*o[0]*(.5*o[1])*2;break;case"convex":case"mesh":a=v.getConvexVolume(s)}return a},getConvexVolume:t=>{let i,s=t.length/3,a=[0,0,0],o=[0,0,0];for(;s--;)i=3*s,t[i]<a[0]?a[0]=t[i]:t[i]>o[0]&&(o[0]=t[i]),t[i+1]<a[1]?a[1]=t[i+1]:t[i+1]>o[1]&&(o[1]=t[i+1]),t[i+2]<a[2]?a[2]=t[i+2]:t[i+2]>o[2]&&(o[2]=t[i+2]);let n=[o[0]-a[0],o[1]-a[1],o[2]-a[2]];return.5*n[0]*8*(.5*n[1])*(.5*n[2])},massFromDensity:(t,i)=>t*i,densityFromMass:(t,i)=>t/i,getIndex:t=>t.index&&t.index.array||null,getVertex:(t,i)=>{let s=t.attributes.position.array;if(i){s=t.clone().toNonIndexed().attributes.position.array}return s},reduce:t=>{},barycentric:(t,i)=>{},solve:(t,i)=>{}};class d{constructor(){this.id=0,this.list=[],this.type="item",this.Utils=null}reset(){let t=this.list.length;for(;t--;)this.dispose(this.list[t]);this.list=[],this.id=0}byName(t){return this.Utils.byName(t)}setName(t={}){let i=void 0!==t.name?t.name:this.type+this.id++;return t.id=this.remove(i,!0),t.name=i,i}addToWorld(t,i=-1){this.Utils.add(t),-1!==i?this.list[i]=t:this.list.push(t)}remove(t,i){let s=this.byName(t);return s?this.clear(s,i):-1}clear(t,i){let s=this.list.indexOf(t);return-1===s||i?this.list[s]=null:this.list.splice(s,1),this.dispose(t),s}dispose(t){null!==t&&this.Utils.remove(t)}vecZero(t,i,s){for(;s--;)t[i+s]=0}fillArray(t,i,s,a){for(s=s||0,a=a??t.length;a--;)i[s+a]=t[a]}arLength(t){let i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return i<.001&&(i=0),i}multiplyScalar(t,i,s){for(s=s??t.length;s--;)t[s]*=i}divideScalar(t,i,s){this.multiplyScalar(t,1/i,s)}add(t={}){}set(t={}){}step(t,i){}}class g extends d{constructor(){super(),this.Utils=e,this.type="body",this.itype="body",this.num=p[this.type],this.full=!1}setFull(t){this.num=p[t?"bodyFull":"body"],this.full=t}step(){const t=n.Ar,i=n.ArPos[this.itype];let s,a,o,e,r,_,l=this.list.length;for(;l--;)s=this.list[l],a=i+l*this.num,s?(s.lockPos&&(s.isKinematic?havok.HP_Body_SetTargetQTransform(s,[s.lockPos,s.lockQuat]):havok.HP_Body_SetQTransform(s,[s.lockPos,s.lockQuat])),e=havok.HP_Body_GetLinearVelocity(s)[1],_=1===havok.HP_Body_GetActivationState(s),t[a]=_?0:9.8*this.arLength(e),o=havok.HP_Body_GetQTransform(s)[1],s.pos=o[0],s.quat=o[1],this.fillArray(o[0],t,a+1,3),this.fillArray(o[1],t,a+4,4),this.full&&(r=havok.HP_Body_GetAngularVelocity(s)[1],this.fillArray(e,t,a+8,3),this.fillArray(r,t,a+11,3))):this.vecZero(t,a,this.num)}shape(t={}){let i,s,a,o,n=t.type||"box",e=t.size||[1,1,1],r=t.localPos||[0,0,0],_=[r[0],r[1]-.5*e[1],r[2]],l=[r[0],r[1]+.5*e[1],r[2]],h=t.localQuat||[0,0,0,1];switch(n){case"plane":1===e[0]&&(e=[300,0,300]),e[1]=0,s=[.5*e[0],0,.5*e[2],.5*e[0],0,.5*-e[2],.5*-e[0],0,.5*-e[2],.5*-e[0],0,.5*e[2]],o=this.getVertices(s),i=havok.HP_Shape_CreateConvexHull(o.byteOffset,4)[1];break;case"box":i=havok.HP_Shape_CreateBox(r,h,e)[1];break;case"sphere":i=havok.HP_Shape_CreateSphere(r,e[0])[1];break;case"particle":i=havok.HP_Shape_CreateSphere(r,t.pSize)[1];break;case"cylinder":i=havok.HP_Shape_CreateCylinder(_,l,e[0])[1];break;case"capsule":i=havok.HP_Shape_CreateCapsule(_,l,e[0])[1];break;case"convex":a=Math.floor(t.v.length/3),o=this.getVertices(t.v),i=havok.HP_Shape_CreateConvexHull(o.byteOffset,a)[1];break;case"mesh":a=Math.floor(t.v.length/3),o=this.getVertices(t.v);let n=Math.floor(t.index.length/3),c=this.getTriangles(t.index);i=havok.HP_Shape_CreateMesh(o.byteOffset,a,c.byteOffset,n)[1]}return t.density&&havok.HP_Shape_SetDensity(i,t.density),t.isTrigger&&havok.HP_Shape_SetTrigger(i,!0),this.setMaterial(i,t),this.setFilter(i,t),i.volume=v.getVolume(n,e,t.v),i}setFilter(t,i){i.mask||(i.mask=-1),i.group||(i.group="body"===this.type?1:2),havok.HP_Shape_SetFilterInfo(t,[i.group,i.mask])}setMaterial(t,i){const s=void 0!==i.friction?i.friction:.5,a=void 0!==i.staticFriction?i.staticFriction:s,o=void 0!==i.restitution?i.restitution:0,n=i.frictionCombine??"MINIMUM",e=i.restitutionCombine??"MINIMUM",r=[a,s,o,this.materialCombine(n),this.materialCombine(e)];havok.HP_Shape_SetMaterial(t,r)}materialCombine(t){switch(t){case"GEOMETRIC_MEAN":return havok.MaterialCombine.GEOMETRIC_MEAN;case"MINIMUM":return havok.MaterialCombine.MINIMUM;case"MAXIMUM":return havok.MaterialCombine.MAXIMUM;case"ARITHMETIC_MEAN":return havok.MaterialCombine.ARITHMETIC_MEAN;case"MULTIPLY":return havok.MaterialCombine.MULTIPLY}}getVertices(t){const i=3*t.length,s=4*i,a=havok._malloc(s),o=new Float32Array(havok.HEAPU8.buffer,a,i);for(let i=0;i<t.length;i++)o[i]=t[i];return o}getTriangles(t){const i=4*t.length,s=havok._malloc(i),a=new Int32Array(havok.HEAPU8.buffer,s,t.length);for(let i=0;i<t.length;i++)a[i]=t[i];return a}add(t={}){let i=this.setName(t);const s="body"===this.type?t.kinematic?"KINEMATIC":"DYNAMIC":"STATIC";let a,o=havok.HP_Body_Create()[1];switch(t.type){case"null":a=havok.HP_Shape_CreateContainer()[1],havok.HP_Body_SetShape(o,a),this.applyMass(o,a,t);break;case"compound":let i;a=havok.HP_Shape_CreateContainer()[1];for(let s=0;s<t.shapes.length;s++){i=t.shapes[s],void 0!==t.density&&(i.density=t.density),void 0!==t.friction&&(i.friction=t.friction),void 0!==t.restitution&&(i.restitution=t.restitution),void 0!==t.mask&&(i.collisionMask=t.mask),void 0!==t.group&&(i.collisionGroup=t.group),i.localQuat&&delete i.localQuat,i.localPos&&delete i.localPos;let o=[i.pos||[0,0,0],i.quat||[0,0,0,1],[1,1,1]];havok.HP_Shape_AddChild(a,this.shape(i),o)}havok.HP_Body_SetShape(o,a),this.applyMass(o,a,t);break;default:a=this.shape(t),havok.HP_Body_SetShape(o,a),this.applyMass(o,a,t)}o.name=i,o.type=this.type,o.breakable=t.breakable||!1,o.isKinematic=t.kinematic||!1,o.sleep=t.sleep||!1,o.button=t.button||!1,o.pos=t.pos||[0,0,0],o.quat=t.quat||[0,0,0,1],o.oldp=t.pos||[0,0,0],t.pos&&delete t.pos,t.quat&&delete t.quat,havok.HP_Body_SetQTransform(o,[o.pos,o.quat]),havok.HP_Body_SetMotionType(o,havok.MotionType[s]),t.kinematic&&delete t.kinematic,havok.HP_World_AddBody(n.world,o,t.startSleep||!1),this.addToWorld(o,t.id),this.set(t,o)}applyMass(t,i,s){if("solid"===this.type)return;let a=[[0,0,0],1,[1,1,1],[0,0,0,1]];if(i){const t=havok.HP_Shape_BuildMassProperties(i);t[0]===havok.Result.RESULT_OK&&(a=t[1])}void 0!==s.mass&&(a[1]=s.mass),s.inertia&&(a[2]=s.inertia),havok.HP_Body_SetMassProperties(t,a)}set(t={},i=null){if(null===i&&(i=this.byName(t.name)),null!==i){if(void 0!==t.kinematic&&havok.HP_Body_SetMotionType(i,havok.MotionType[t.kinematic?"KINEMATIC":"DYNAMIC"]),t.sleep&&havok.HP_Body_SetActivationState(i,havok.ActivationState.INACTIVE),(t.activate||t.wake)&&(havok.HP_Body_SetActivationControl(i,havok.ActivationControl.SIMULATION_CONTROLLED),havok.HP_Body_SetActivationState(i,havok.ActivationState.ACTIVE)),void 0!==t.neverSleep&&havok.HP_Body_SetActivationControl(i,t.neverSleep?havok.ActivationControl.ALWAYS_ACTIVE:havok.ActivationControl.SIMULATION_CONTROLLED),void 0!==t.alwaySleep&&havok.HP_Body_SetActivationControl(i,t.alwaySleep?havok.ActivationControl.ALWAYS_INACTIVE:havok.ActivationControl.SIMULATION_CONTROLLED),void 0!==t.gravityFactor&&havok.HP_Body_SetGravityFactor(i,t.gravityFactor),void 0!==t.gravity&&havok.HP_Body_SetGravityFactor(i,t.gravity?1:0),t.pos||t.quat){t.pos||(t.pos=i.pos),t.quat||(t.quat=i.quat);let s=!0;i.isKinematic&&(v.equalArray(i.oldp,t.pos)?s=!1:i.oldp=t.pos);let a=[t.pos,t.quat];i.isKinematic&&s?havok.HP_Body_SetTargetQTransform(i,a):havok.HP_Body_SetQTransform(i,a)}t.linearVelocity&&havok.HP_Body_SetLinearVelocity(i,t.linearVelocity),t.angularVelocity&&havok.HP_Body_SetAngularVelocity(i,t.angularVelocity),t.damping&&(havok.HP_Body_SetAngularDamping(i,t.damping[0]),havok.HP_Body_SetLinearDamping(i,t.damping[1])),t.force&&(t.location||(t.location=[0,0,0]),t.local||(t.location=havok.HP_Body_GetPosition(i)[1]),havok.HP_Body_ApplyImpulse(i,t.location,t.force)),t.impulse&&(t.impulseCenter?havok.HP_Body_ApplyImpulse(i,t.impulseCenter,t.impulse):havok.HP_Body_ApplyImpulse(i,i.pos,t.impulse)),t.lockPos&&(i.lockPos=t.pos,i.lockQuat=t.quat),t.reset&&(havok.HP_Body_SetLinearVelocity(i,[0,0,0]),havok.HP_Body_SetAngularVelocity(i,[0,0,0]))}}addCollisionCallback(t,i){const s=havok.EventType.COLLISION_STARTED.value|havok.EventType.COLLISION_CONTINUED.value|havok.EventType.COLLISION_FINISHED.value;havok.HP_Body_SetEventMask(t,i?s:0)}freeze(t,i){i?(havok.HP_Body_SetGravityFactor(t,0),havok.HP_Body_SetLinearVelocity(t,[0,0,0]),havok.HP_Body_SetAngularVelocity(t,[0,0,0]),t.sleep=!0):t.sleep&&(havok.HP_Body_SetGravityFactor(t,1),t.sleep=!1)}setShapes(t={},i=null){}}class X extends d{constructor(){super(),this.Utils=e,this.type="joint",this.LimitMode={FREE:havok.ConstraintAxisLimitMode.FREE,LOCKED:havok.ConstraintAxisLimitMode.LOCKED,LIMITED:havok.ConstraintAxisLimitMode.LIMITED},this.ConstraintAxis={LINEAR_X:havok.ConstraintAxis.LINEAR_X,LINEAR_Y:havok.ConstraintAxis.LINEAR_Y,LINEAR_Z:havok.ConstraintAxis.LINEAR_Z,ANGULAR_X:havok.ConstraintAxis.ANGULAR_X,ANGULAR_Y:havok.ConstraintAxis.ANGULAR_Y,ANGULAR_Z:havok.ConstraintAxis.ANGULAR_Z,LINEAR_DISTANCE:havok.ConstraintAxis.LINEAR_DISTANCE},this.MotorType={POSITION:havok.ConstraintMotorType.POSITION,VELOCITY:havok.ConstraintMotorType.VELOCITY,NONE:havok.ConstraintMotorType.NONE},this.convert={x:"LINEAR_X",y:"LINEAR_Y",z:"LINEAR_Z",rx:"ANGULAR_X",ry:"ANGULAR_Y",rz:"ANGULAR_Z",distance:"LINEAR_DISTANCE",twist:"ANGULAR_X",swing1:"ANGULAR_Y",swing2:"ANGULAR_Z",free:"FREE",locked:"LOCKED",limited:"LIMITED"},this.angulars=["ANGULAR_X","ANGULAR_Y","ANGULAR_Z","rx","ry","rz"]}step(){}getNormalToRef(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);let s=Math.acos(t[1]/i);const a=Math.atan2(t[2],t[0]);s>.5*Math.PI?s-=.5*Math.PI:s+=.5*Math.PI;return[i*Math.sin(s)*Math.cos(a),i*Math.cos(s),i*Math.sin(s)*Math.sin(a)]}crossVectors(t,i){const s=t[0],a=t[1],o=t[2],n=i[0],e=i[1],r=i[2];return[a*r-o*e,o*n-s*r,s*e-a*n]}add(t={}){let i=this.setName(t);const s=havok.HP_Constraint_Create()[1];let a=this.byName(t.b1),o=this.byName(t.b2);null!==a&&havok.HP_Constraint_SetParentBody(s,a),null!==o&&havok.HP_Constraint_SetChildBody(s,o);const n=t.pos1?t.pos1:[0,0,0],e=t.axis1?t.axis1:[1,0,0],r=this.getNormalToRef(e);havok.HP_Constraint_SetAnchorInParent(s,n,e,r);const _=t.pos2?t.pos2:[0,0,0],l=t.axis2?t.axis2:[1,0,0],h=this.getNormalToRef(l);havok.HP_Constraint_SetAnchorInChild(s,_,l,h),this.ConstraintAxis,this.LimitMode;let c=t.mode||"revolute";switch("d6"!==c&&"universal"!==c&&"dof"!==c&&"ragdoll"!==c||(c="generic"),"revolute"===c&&(c="hinge"),"cylindrical"===c&&(c="slider"),c){case"fixe":this.lock(s,["x","y","z","rx","ry","rz"]);break;case"hinge":this.lock(s,["x","y","z","ry","rz"]);break;case"prismatic":this.lock(s,["y","z","rx","ry","rz"]);break;case"slider":this.lock(s,["y","z","ry","rz"]);break;case"spherical":this.lock(s,["x","y","z"]);break;case"generic":this.lock(s,["x","y","z","rx","ry","rz"])}let m=void 0!==t.collision&&t.collision;havok.HP_Constraint_SetCollisionsEnabled(s,m),havok.HP_Constraint_SetEnabled(s,!0),s.name=i,s.type=this.type,s.mode=c,s.visible=void 0===t.visible||t.visible,this.set(t,s),this.addToWorld(s)}set(t={},i=null){if(null===i&&(i=this.byName(t.name)),null===i)return;let s;switch(this.ConstraintAxis,this.LimitMode,void 0!==t.enable&&havok.HP_Constraint_SetEnabled(i,t.enable),i.mode){case"hinge":t.limit&&this.setLimit(i,["rx",...t.limit]),t.spring&&this.setSpring(i,["rx",...t.spring]),t.motor&&this.setMotor(i,t.motor[1],t.motor[2],"ANGULAR_X"),void 0!==t.friction&&this.setFriction(i,t.friction,"ANGULAR_X");break;case"prismatic":t.limit&&this.setLimit(i,["x",...t.limit]),t.spring&&this.setSpring(i,["x",...t.spring]),t.friction&&this.setFriction(i,"x",t.friction);break;case"slider":t.lm&&this.setLimit(i,["x",...t.lm]),t.lmr&&this.setLimit(i,["rx",...t.lmr]);break;case"spherical":t.lm&&(this.setLimit(i,["rx",...t.lm]),this.setLimit(i,["ry",...t.lm]),this.setLimit(i,["rz",...t.lm]));break;case"distance":t.limit&&this.setLimit(i,["distance",...t.limit]),t.spring&&this.setSpring(i,["distance",...t.spring]),t.friction&&this.setFriction(i,"distance",t.friction);break;case"generic":if(t.motion)for(s=t.motion.length;s--;)this.setLimitMode(i,this.convert[t.motion[s][0]],this.convert[t.motion[s][1]]);if(t.lm)for(s=t.lm.length;s--;)this.setLimit(i,t.lm[s]);if(t.motor)for(s=t.motor.length;s--;)this.setMotor(i,t.motor[s][1],t.motor[s][2],this.convert[t.motor[s][0]]);if(void 0!==t.friction){if(!t.friction instanceof Array){let i=t.friction;t.friction=[["x",i],["y",i],["z",i],["rx",i],["ry",i],["rz",i]]}for(s=t.friction.length;s--;)this.setFriction(i,t.friction[s][0],t.friction[s][1])}}}lock(t,i){let s=i.length;for(;s--;)havok.HP_Constraint_SetAxisMode(t,this.ConstraintAxis[this.convert[i[s]]],this.LimitMode.LOCKED)}setLimitMode(t,i,s){havok.HP_Constraint_SetAxisMode(t,this.ConstraintAxis[i],this.LimitMode[s])}setLimit(t,i){let s=-1!==this.angulars.indexOf(i[0])?f:1;const a=this.ConstraintAxis[this.convert[i[0]]];havok.HP_Constraint_SetAxisMode(t,a,this.LimitMode.LIMITED),havok.HP_Constraint_SetAxisMinLimit(t,a,i[1]*s),havok.HP_Constraint_SetAxisMaxLimit(t,a,i[2]*s),void 0!==i[3]&&havok.HP_Constraint_SetAxisStiffness(t,a,i[3]),void 0!==i[4]&&havok.HP_Constraint_SetAxisDamping(t,a,i[4])}setSpring(t,i){const s=this.ConstraintAxis[this.convert[i[0]]];void 0!==i[1]&&havok.HP_Constraint_SetAxisStiffness(t,s,i[1]),void 0!==i[2]&&havok.HP_Constraint_SetAxisDamping(t,s,i[2])}setFriction(t,i,s=0){const a=this.ConstraintAxis[this.convert[i]];havok.HP_Constraint_SetAxisFriction(t,a,s)}setMotor(t,i,s,a){let o=-1!==this.angulars.indexOf(a)?f:1;const n=this.ConstraintAxis[a];havok.HP_Constraint_SetAxisMotorType(t,n,this.MotorType.VELOCITY),havok.HP_Constraint_SetAxisMotorTarget(t,n,i*o),s&&havok.HP_Constraint_SetAxisMotorMaxForce(t,n,s)}}class Y extends d{constructor(){super(),this.Utils=e,this.type="ray"}step(){const t=n.Ar,i=n.ArPos[this.type];n.reflow.ray=[];let s,a,o,r,_,l,h,c,m,b,x=this.list.length;for(;x--;)a=i+x*p.ray,s=this.list[x],_=s.getPoint(),h=-1,c=-1,r=[_[0],_[1],[-1,-1]],t[a]=0,havok.HP_World_CastRayWithCollector(n.world,n.queryCollector,r),havok.HP_QueryCollector_GetNumHits(n.queryCollector)[1]>0&&(b=havok.HP_QueryCollector_GetCastRayResult(n.queryCollector,0)[1],l=b[1][3],m=b[1][4],t[a]=1,t[a+1]=v.distanceArray(_[0],l),t[a+2]=_[0][0],t[a+3]=_[0][1],t[a+4]=_[0][2],t[a+5]=l[0],t[a+6]=l[1],t[a+7]=l[2],t[a+8]=m[0],t[a+9]=m[1],t[a+10]=m[2],o=e.byId(b[1][0][0]),o&&(n.reflow.ray[x]=o.name))}add(t={}){this.setName(t);let i=new z(t);this.addToWorld(i,t.id)}set(t={},i=null){null===i&&(i=this.byName(t.name)),null!==i&&(t.begin&&(i.begin=t.begin),t.end&&(i.end=t.end))}}class z{constructor(t={}){this.type="ray",this.name=t.name,this.parent=t.parent||"",this.begin=t.begin||[0,0,0],this.end=t.end||[0,0,1]}getPoint(){if(this.parent){const t=e.byName(this.parent);if(t){const i=havok.HP_Body_GetQTransform(t)[1],s=i[0],a=i[1];return[v.applyTransformArray(this.begin,s,a),v.applyTransformArray(this.end,s,a)]}}return[this.begin,this.end]}}class Z extends d{constructor(){super(),this.Utils=e,this.type="contact"}step(){n.ArPos[this.type];let t=this.list.length;for(;t--;)this.list[t]}add(t={}){if(this.setName(t),t.b1=this.byName(t.b1),t.b2=this.byName(t.b2),null===t.b1)return;let i=new M(t);n.bodyRef.addCollisionCallback(t.b1,!0),this.addToWorld(i,t.id)}}class M{constructor(t={}){this.type="contact",this.name=t.name,this.b1=t.b1||null,this.b2=t.b2||null,this.ignore=t.ignore||[],this.result={hit:!1,point:[0,0,0],normal:[0,0,0],distance:0}}update(){}}class I extends g{constructor(){super(),this.itype="character",this.num=p.character}add(t={}){t.type="capsule",super.add(t)}remove(t={}){}dispose(t){}}class V extends d{constructor(){super(),this.type="terrain",this.Utils=e}add(t){this.setName(t);let i=new L(t);this.addToWorld(i,t.id)}set(t={},i=null){null===i&&(i=this.byName(t.name)),null!==i&&i.set(t)}}class L{constructor(t){this.type="terrain",this.name=t.name,this.needUpdate=!1,this.heightField=null,this.geometry=null,this.heights=null,this.init(t)}init(t){this.size=t.size,this.sample=t.sample,this.squarSize=[this.size[0]/(this.sample[0]-1),this.size[2]/(this.sample[1]-1)],this.setData(t),this.body=havok.HP_Body_Create()[1],havok.HP_Body_SetShape(this.body,this.geometry);let i=t.pos||[0,0,0];i[0]=i[0]+.5*this.squarSize[0],i[2]=i[2]+.5*this.squarSize[1],havok.HP_Body_SetPosition(this.body,i),t.quat&&havok.HP_Body_SetOrientation(this.body,t.quat),havok.HP_World_AddBody(n.world,this.body,!1)}getVertices(t){if(!this.heights){const i=t.length,s=i*4,a=havok._malloc(s);this.heights=new Float32Array(havok.HEAPU8.buffer,a,i)}let i=t.length,s=0;for(;i--;)this.heights[i]=t[s],s++}setMaterial(t,i){if(!i.friction&&!i.restitution)return;if(.5===i.friction&&0===!i.restitution)return;const s=i.friction??.5,a=i.staticFriction??s,o=i.restitution??0,n=i.frictionCombine??"MINIMUM",e=i.restitutionCombine??"MAXIMUM",r=[a,s,o,this.materialCombine(n),this.materialCombine(e)];havok.HP_Shape_SetMaterial(t,r)}setData(t){this.getVertices(t.heightData),this.divid=t.sample?t.sample:this.sample,this.scale=[this.squarSize[0],this.size[1],this.squarSize[1]],this.geometry=havok.HP_Shape_CreateHeightField(this.divid[0],this.divid[1],this.scale,this.heights.byteOffset)[1],this.setMaterial(this.geometry,t)}release(){havok.HP_World_RemoveBody(n.world,this.body),havok.HP_Body_Release(this.body)}set(t){t.heightData&&(this.geometry&&havok.HP_Shape_Release(this.geometry),this.getVertices(t.heightData),this.geometry=havok.HP_Shape_CreateHeightField(this.divid[0],this.divid[1],this.scale,this.heights.byteOffset)[1],this.setMaterial(this.geometry,t),havok.HP_Body_SetShape(this.body,this.geometry))}}let w;self.onmessage=function(t){U.message(t)};let k,A,B=!1,P=!1,S=!1;const T="undefined"==typeof performance?Date:performance,C={tmp:0,n:0,dt:0,fps:0};let j,R=1/60,E=16.67,q=1,N=!0,D=0,F=0,H=!0,G=null,W=null,O={},J="";class U{static test(){}static message(t){let i=t.data;i.Ar&&(n.Ar=i.Ar),i.flow&&(O=i.flow),U[i.m]||console.log(i.m),i.m&&U[i.m](i.o)}static post(t,i){A?self.postMessage(t,i):k({data:t})}static init(t={}){A=!0,S=t.isBuffer||!1,void 0!==t.fps&&(R=1/t.fps),void 0!==t.substep&&(q=t.substep),t.message&&(k=t.message,A=!1,S=!1),t.blob&&importScripts(t.blob),HavokPhysics().then((t=>{self.havok=t,U.initItems(),U.post({m:"ready",o:{}})}))}static set(t={}){n.ArPos=t.ArPos||function(t,i=!1){let s={},a={body:r*(i?p.bodyFull:p.body),joint:_*p.joint,ray:h*p.ray,contact:l*p.contact,character:c*p.character};"PHYSX"!==t&&"AMMO"!==t||(a.vehicle=m*p.vehicle),"PHYSX"===t&&(a.solver=b*p.solver),"HAVOK"!==t&&"RAPIER"!==t||(p.joint=0);let o=0;for(let t in a)s[t]=o,o+=a[t];return s.total=o,s}("HAVOK",t.full),w.body.setFull(t.full),P=t.outsideStep||!1,B=t.isTimeout||!1,R=1/(t.fps||60),E=v.toFixed(1e3*R,2),q=t.forceSubstep||1,n.substep=q,N=void 0===t.fixe||t.fixe,n.gravity=t.gravity||[0,-9.80665,0],null===n.world&&U.start()}static setGravity(t){n.gravity=t.gravity,n.world&&havok.HP_World_SetGravity(n.world,n.gravity)}static start(){null===n.world&&(n.Ar=new Float32Array(n.ArPos.total),U.initWorld()),H=!1,j=!1,F=0,n.tmpStep=0,P||(B?(W&&clearTimeout(W),W=setTimeout(U.step,0)):G=setInterval(U.step,E))}static initWorld(){n.world=havok.HP_World_Create()[1],n.queryCollector=havok.HP_QueryCollector_Create(1)[1],havok.HP_World_SetGravity(n.world,n.gravity)}static controle(t){t!==J&&(this.enable(J,!1),J=t,this.enable(J,!0))}static enable(t,i){if(""===t)return;let s=U.byName(t);null!==s&&(s.enable=i)}static dispatch(){if(n.key=O.key,O.remove)for(;O.remove.length>0;)this.remove(O.remove.shift());if(O.add)for(;O.add.length>0;)this.add(O.add.shift());if(O.tmp)for(;O.tmp.length>0;)this.change(O.tmp.shift());this.controle(O.current)}static readToRef(t,i){const s=new Int32Array(t,i),a=new Float32Array(t,i);let o=e.byId(BigInt(s[2])),n=e.byId(BigInt(s[18]));return o&&n?{b1:o.name,b2:n.name,pos1:[a[10],a[11],a[12]],normal1:[a[13],a[14],a[15]],pos2:[a[26],a[27],a[28]],normal2:[a[29],a[30],a[31]],impulse:a[33]}:null}static notifyCollisions(){let t=havok.HP_World_GetCollisionEvents(n.world)[1];const i=Number(n.world);for(;t;)U.readToRef(havok.HEAPU8.buffer,t),t=havok.HP_World_GetNextCollisionEvent(i,t);let s=havok.HP_World_GetTriggerEvents(n.world)[1];for(;s;)U.readToRef(havok.HEAPU8.buffer,s),s=havok.HP_World_GetNextTriggerEvent(i,t)}static collisionEventType(t){let i="";switch(t){case havok.EventType.COLLISION_STARTED.value:i="COLLISION_STARTED";break;case havok.EventType.COLLISION_FINISHED.value:i="COLLISION_FINISHED";break;case havok.EventType.COLLISION_CONTINUED.value:i="COLLISION_CONTINUED"}return i}static triggerEventType(t){let i="";switch(t){case 8:i="TRIGGER_ENTERED";break;case 16:i="TRIGGER_EXITED"}return i}static poststep(){if(!H&&(n.tmpStep=1,this.dispatch(),!P&&B)){W&&clearTimeout(W);let t=E-(T.now()-F);t<0&&(t=0),W=setTimeout(U.step,t)}}static step(t){if(j&&U.endReset(),H||n.tmpStep>=2)return;n.tmpStep=2,D=t||T.now(),n.delta=.001*(D-F),F=D,n.deltaTime=N?R/q:n.delta/q;let i=q;for(;i--;)havok.HP_World_Step(n.world,n.deltaTime),U.stepItems(),n.tmpStep++;U.notifyCollisions(),D-1e3>C.tmp&&(C.tmp=D,n.reflow.stat.fps=C.n,C.n=0),C.n++,n.reflow.stat.delta=n.delta,S?U.post({m:"step",reflow:n.reflow,Ar:n.Ar},[n.Ar.buffer]):U.post({m:"step",reflow:n.reflow,Ar:n.Ar})}static byName(t){return e.byName(t)}static reset(){j=!0}static endReset(){U.stop(),U.resetItems(),havok.HP_QueryCollector_Release(n.queryCollector),havok.HP_World_Release(n.world),n.world=null,J="",e.clear(),U.post({m:"resetCallback",o:{}})}static stop(){H=!0,P||(W&&clearTimeout(W),G&&clearInterval(G),G=null,W=null)}static pause(t){let i=t.value;i!==H&&(i?this.stop():this.start())}static initItems(){w={ray:new Y,body:new g,solid:new Q,joint:new X,contact:new Z,character:new I,terrain:new V},n.bodyRef=w.body}static resetItems(){Object.values(w).forEach((t=>t.reset()))}static stepItems(){Object.values(w).forEach((t=>t.step()))}static add(t={}){let i=function(t){switch(t.type){case"plane":case"box":case"sphere":case"highSphere":case"cylinder":case"stair":case"particle":case"cone":case"capsule":case"mesh":case"convex":case"compound":case"null":return t.mass||t.density||t.kinematic?"body":"solid";case"generic":case"hinge":case"slider":case"spherical":case"fixe":case"dof":case"d6":case"ragdoll":case"universal":case"cylindrical":case"distance":case"revolute":case"prismatic":return"joint";default:return t.type}}(t);w[i].add(t)}static remove(t={}){let i=this.byName(t.name);null!==i&&w[i.type].clear(i)}static change(t={}){let i=this.byName(t.name);null!==i&&w[i.type].set(t,i)}}class Q extends g{constructor(){super(),this.type="solid"}step(t,i){}}t.engine=U,Object.defineProperty(t,"__esModule",{value:!0})}));
