!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("three"),require("three/addons/renderers/webgpu/WebGPURenderer.js")):"function"==typeof define&&define.amd?define(["exports","three","three/addons/renderers/webgpu/WebGPURenderer.js"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Main={},t.THREE$1,t.WebGPURenderer)}(this,(function(t,e,i){"use strict";function s(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}function n(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(i){if("default"!==i){var s=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:function(){return t[i]}})}})),e.default=t,Object.freeze(e)}var r=n(e),o=s(i),a=function(t){var e,i=Object.prototype,s=i.hasOwnProperty,n=Object.defineProperty||function(t,e,i){t[e]=i.value},r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function h(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,i){return t[e]=i}}function c(t,e,i,s){var r=e&&e.prototype instanceof v?e:v,o=Object.create(r.prototype),a=new _(s||[]);return n(o,"_invoke",{value:T(t,i,a)}),o}function u(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var d="suspendedStart",p="suspendedYield",f="executing",m="completed",g={};function v(){}function y(){}function b(){}var x={};h(x,o,(function(){return this}));var O=Object.getPrototypeOf,w=O&&O(O(R([])));w&&w!==i&&s.call(w,o)&&(x=w);var S=b.prototype=v.prototype=Object.create(x);function k(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function A(t,e){function i(n,r,o,a){var l=u(t[n],t,r);if("throw"!==l.type){var h=l.arg,c=h.value;return c&&"object"==typeof c&&s.call(c,"__await")?e.resolve(c.__await).then((function(t){i("next",t,o,a)}),(function(t){i("throw",t,o,a)})):e.resolve(c).then((function(t){h.value=t,o(h)}),(function(t){return i("throw",t,o,a)}))}a(l.arg)}var r;n(this,"_invoke",{value:function(t,s){function n(){return new e((function(e,n){i(t,s,e,n)}))}return r=r?r.then(n,n):n()}})}function T(t,e,i){var s=d;return function(n,r){if(s===f)throw new Error("Generator is already running");if(s===m){if("throw"===n)throw r;return E()}for(i.method=n,i.arg=r;;){var o=i.delegate;if(o){var a=M(o,i);if(a){if(a===g)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(s===d)throw s=m,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);s=f;var l=u(t,e,i);if("normal"===l.type){if(s=i.done?m:p,l.arg===g)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(s=m,i.method="throw",i.arg=l.arg)}}}function M(t,i){var s=i.method,n=t.iterator[s];if(n===e)return i.delegate=null,"throw"===s&&t.iterator.return&&(i.method="return",i.arg=e,M(t,i),"throw"===i.method)||"return"!==s&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+s+"' method")),g;var r=u(n,t.iterator,i.arg);if("throw"===r.type)return i.method="throw",i.arg=r.arg,i.delegate=null,g;var o=r.arg;return o?o.done?(i[t.resultName]=o.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=e),i.delegate=null,g):o:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,g)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function R(t){if(t){var i=t[o];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function i(){for(;++n<t.length;)if(s.call(t,n))return i.value=t[n],i.done=!1,i;return i.value=e,i.done=!0,i};return r.next=r}}return{next:E}}function E(){return{value:e,done:!0}}return y.prototype=b,n(S,"constructor",{value:b,configurable:!0}),n(b,"constructor",{value:y,configurable:!0}),y.displayName=h(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,h(t,l,"GeneratorFunction")),t.prototype=Object.create(S),t},t.awrap=function(t){return{__await:t}},k(A.prototype),h(A.prototype,a,(function(){return this})),t.AsyncIterator=A,t.async=function(e,i,s,n,r){void 0===r&&(r=Promise);var o=new A(c(e,i,s,n),r);return t.isGeneratorFunction(i)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},k(S),h(S,l,"Generator"),h(S,o,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),i=[];for(var s in e)i.push(s);return i.reverse(),function t(){for(;i.length;){var s=i.pop();if(s in e)return t.value=s,t.done=!1,t}return t.done=!0,t}},t.values=R,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var i in this)"t"===i.charAt(0)&&s.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var i=this;function n(s,n){return a.type="throw",a.arg=t,i.next=s,n&&(i.method="next",i.arg=e),!!n}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var l=s.call(o,"catchLoc"),h=s.call(o,"finallyLoc");if(l&&h){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&s.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=t,o.arg=e,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),C(i),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var s=i.completion;if("throw"===s.type){var n=s.arg;C(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,i,s){return this.delegate={iterator:R(t),resultName:i,nextLoc:s},"next"===this.method&&(this.arg=e),g}},t}("object"==typeof module?module.exports:{});try{regeneratorRuntime=a}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=a:Function("r","regeneratorRuntime = r")(a)}
/**
   * @license
   * Copyright 2010-2021 Uil.js Authors
   * SPDX-License-Identifier: MIT
   */const l={ui:[],dom:null,ID:null,lock:!1,wlock:!1,current:-1,needReZone:!0,needResize:!1,forceZone:!1,isEventsInit:!1,isLeave:!1,downTime:0,prevTime:0,prevDefault:["contextmenu"],pointerEvent:["pointerdown","pointermove","pointerup"],eventOut:["pointercancel","pointerout","pointerleave"],xmlserializer:null,tmpTime:null,tmpImage:null,oldCursor:"auto",input:null,parent:null,firstImput:!0,hiddenImput:null,hiddenSizer:null,hasFocus:!1,startInput:!1,inputRange:[0,0],cursorId:0,str:"",pos:0,startX:-1,moveX:-1,debugInput:!1,isLoop:!1,listens:[],e:{type:null,clientX:0,clientY:0,keyCode:NaN,key:null,delta:0},isMobile:!1,now:null,getTime:function(){return self.performance&&self.performance.now?self.performance.now.bind(performance):Date.now},add:function(t){l.ui.push(t),l.getZone(t),l.isEventsInit||l.initEvents()},testMobile:function(){let t=navigator.userAgent;return!!(t.match(/Android/i)||t.match(/webOS/i)||t.match(/iPhone/i)||t.match(/iPad/i)||t.match(/iPod/i)||t.match(/BlackBerry/i)||t.match(/Windows Phone/i))},remove:function(t){let e=l.ui.indexOf(t);-1!==e&&(l.removeListen(t),l.ui.splice(e,1)),0===l.ui.length&&l.removeEvents()},initEvents:function(){if(l.isEventsInit)return;let t=document.body;l.isMobile=l.testMobile(),l.now=l.getTime(),l.isMobile?t.style.touchAction="none":t.addEventListener("wheel",l,{passive:!1}),t.addEventListener("pointercancel",l),t.addEventListener("pointerleave",l),t.addEventListener("pointermove",l),t.addEventListener("pointerdown",l),t.addEventListener("pointerup",l),t.addEventListener("keydown",l,!1),t.addEventListener("keyup",l,!1),window.addEventListener("resize",l.resize,!1),l.isEventsInit=!0,l.dom=t},removeEvents:function(){if(!l.isEventsInit)return;let t=document.body;l.isMobile||t.removeEventListener("wheel",l),t.removeEventListener("pointercancel",l),t.removeEventListener("pointerleave",l),t.removeEventListener("pointermove",l),t.removeEventListener("pointerdown",l),t.removeEventListener("pointerup",l),t.removeEventListener("keydown",l),t.removeEventListener("keyup",l),window.removeEventListener("resize",l.resize),l.isEventsInit=!1},resize:function(){let t,e=l.ui.length;for(;e--;)t=l.ui[e],t.isGui&&!t.isCanvasOnly&&t.autoResize&&t.calc();l.needReZone=!0,l.needResize=!1},out:function(){console.log("im am out"),l.clearOldID()},in:function(){console.log("im am in")},fakeUp:function(){this.handleEvent({type:"pointerup"})},handleEvent:function(t){-1!==l.prevDefault.indexOf(t.type)&&t.preventDefault(),l.needResize&&l.resize(),l.findZone(l.forceZone);let e=l.e,i=!1;"keydown"===t.type&&l.keydown(t),"keyup"===t.type&&l.keyup(t),"wheel"===t.type?e.delta=t.deltaY>0?1:-1:e.delta=0;let s=t.pointerType;if(e.clientX=("touch"===s?t.pageX:t.clientX)||0,e.clientY=("touch"===s?t.pageY:t.clientY)||0,e.type=t.type,-1!==l.eventOut.indexOf(t.type)&&(i=!0,e.type="mouseup"),"pointerleave"===t.type&&(l.isLeave=!0),"pointerdown"===t.type&&(e.type="mousedown"),"pointerup"===t.type&&(e.type="mouseup"),"pointermove"===t.type&&(l.isLeave&&(l.isLeave=!1,l.resize()),e.type="mousemove"),"mousedown"===e.type){if(l.downTime=l.now(),l.downTime-l.prevTime<200)return l.selectAll(),!1;l.prevTime=l.downTime,l.forceZone=!1}"mousedown"===e.type&&l.clearInput(),"mousedown"===e.type&&(l.lock=!0),"mouseup"===e.type&&(l.lock=!1),l.isMobile&&"mousedown"===e.type&&l.findID(e),"mousemove"!==e.type||l.lock||l.findID(e),null!==l.ID&&(l.ID.isCanvasOnly&&(e.clientX=l.ID.mouse.x,e.clientY=l.ID.mouse.y),l.ID.handleEvent(e)),l.isMobile&&"mouseup"===e.type&&l.clearOldID(),i&&l.clearOldID()},findID:function(t){let e,i,s,n=l.ui.length,r=-1;for(;n--;)if(e=l.ui[n],e.isCanvasOnly?(i=e.mouse.x,s=e.mouse.y):(i=t.clientX,s=t.clientY),l.onZone(e,i,s)){r=n,r!==l.current&&(l.clearOldID(),l.current=r,l.ID=e);break}-1===r&&l.clearOldID()},clearOldID:function(){l.ID&&(l.current=-1,l.ID.reset(),l.ID=null,l.cursor())},calcUis:(t,e,i,s=!1)=>{let n,r,o,a=t.length,h=0,c=0,u=0;for(;a--;)n=t[c],c++,!s&&n.isGroup&&n.calcUis(),o=n.margin,n.zone.w=n.w,n.zone.h=n.h+o,n.autoWidth?(h=0,n.zone.x=e.x+n.dx,n.zone.y=i,i+=n.h+o,u+=n.h+o):(0===h&&(u+=n.h+o),n.zone.x=e.x+h,n.zone.y=i,r=l.getWidth(n),r?n.zone.w=n.w=r:n.fw&&(n.zone.w=n.w=n.fw),h+=n.zone.w,h>=e.w&&(i+=n.h+o,h=0));return u},findTarget:function(t,e){let i=t.length;for(;i--;)if(l.onZone(t[i],e.clientX,e.clientY))return i;return-1},findZone:function(t){if(l.needReZone||t){for(var e,i=l.ui.length;i--;)e=l.ui[i],l.getZone(e),e.isGui&&e.calcUis();l.needReZone=!1}},onZone:function(t,e,i){if(void 0===e||void 0===i)return!1;let s=t.zone,n=e-s.x,r=i-s.y,o=n>=0&&r>=0&&n<=s.w&&r<=s.h;return o?t.local.set(n,r):t.local.neg(),o},getWidth:function(t){return t.getDom().clientWidth},getZone:function(t){if(t.isCanvasOnly)return;let e=t.getDom().getBoundingClientRect();t.zone={x:e.left,y:e.top,w:e.width,h:e.height}},cursor:function(t){(t=t||"auto")!==l.oldCursor&&(document.body.style.cursor=t,l.oldCursor=t)},toCanvas:function(t,e,i,s){if(l.xmlserializer||(l.xmlserializer=new XMLSerializer),s&&null!==l.tmpTime&&(clearTimeout(l.tmpTime),l.tmpTime=null),null!==l.tmpTime)return;l.lock&&(l.tmpTime=setTimeout((function(){l.tmpTime=null}),10));let n=!1;e===t.canvas.width&&i===t.canvas.height||(n=!0),null===l.tmpImage&&(l.tmpImage=new Image);let r=l.tmpImage,o=l.xmlserializer.serializeToString(t.content),a='<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+i+'"><foreignObject style="pointer-events: none; left:0;" width="100%" height="100%">'+o+"</foreignObject></svg>";r.onload=function(){let s=t.canvas.getContext("2d");n?(t.canvas.width=e,t.canvas.height=i):s.clearRect(0,0,e,i),s.drawImage(this,0,0),t.onDraw()},r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a),r.crossOrigin=""},setHidden:function(){null===l.hiddenImput&&(l.hiddenImput=document.createElement("input"),l.hiddenImput.type="text",l.hiddenSizer=document.createElement("div"),document.body.appendChild(l.hiddenImput),document.body.appendChild(l.hiddenSizer));let t=l.debugInput?"":"opacity:0; zIndex:0;",e=l.parent.css.txtselect+"padding:0; width:auto; height:auto; left:10px; top:auto; color:#FFF; background:#000;"+t;l.hiddenImput.style.cssText=e+"bottom:10px;"+(l.debugInput?"":"transform:scale(0);"),l.hiddenSizer.style.cssText=e+"bottom:40px;",l.hiddenImput.style.width=l.input.clientWidth+"px",l.hiddenImput.value=l.str,l.hiddenSizer.innerHTML=l.str,l.hasFocus=!0},clearHidden:function(t){null!==l.hiddenImput&&(l.hasFocus=!1)},clickPos:function(t){let e=l.str.length,i=0,s=0;for(;e--&&(i+=l.textWidth(l.str[s]),!(i>=t));)s++;return s},upInput:function(t,e){if(null===l.parent)return!1;let i=!1;if(e){let e=l.clickPos(t);l.moveX=e,-1===l.startX?(l.startX=e,l.cursorId=e,l.inputRange=[l.startX,l.startX]):l.moveX!==l.startX&&(l.startX>l.moveX?l.inputRange=[l.moveX,l.startX]:l.inputRange=[l.startX,l.moveX]),i=!0}else-1!==l.startX&&(l.hasFocus=!0,l.hiddenImput.focus(),l.hiddenImput.selectionStart=l.inputRange[0],l.hiddenImput.selectionEnd=l.inputRange[1],l.startX=-1,i=!0);return i&&l.selectParent(),i},selectAll:function(){l.parent&&(l.str=l.input.textContent,l.inputRange=[0,l.str.length],l.hasFocus=!0,l.hiddenImput.focus(),l.hiddenImput.selectionStart=l.inputRange[0],l.hiddenImput.selectionEnd=l.inputRange[1],l.cursorId=l.inputRange[1],l.selectParent())},selectParent:function(){var t=l.textWidth(l.str.substring(0,l.cursorId)),e=l.textWidth(l.str.substring(0,l.inputRange[0])),i=l.textWidth(l.str.substring(l.inputRange[0],l.inputRange[1]));l.parent.select(t,e,i,l.hiddenSizer.innerHTML)},textWidth:function(t){return null===l.hiddenSizer?0:(t=t.replace(/ /g,"&nbsp;"),l.hiddenSizer.innerHTML=t,l.hiddenSizer.clientWidth)},clearInput:function(){null!==l.parent&&(l.firstImput||l.parent.validate(!0),l.clearHidden(),l.parent.unselect(),l.input.style.background=l.parent.colors.back,l.input.style.borderColor=l.parent.colors.border,l.parent.isEdit=!1,l.input=null,l.parent=null,l.str="",l.firstImput=!0)},setInput:function(t,e){l.clearInput(),l.input=t,l.parent=e,l.input.style.background=l.parent.colors.backoff,l.input.style.borderColor=l.parent.colors.select,l.str=l.input.textContent,l.setHidden()},keydown:function(t){if(null===l.parent)return;let e=t.which;t.shiftKey,l.firstImput=!1,l.hasFocus&&(window.focus(),l.hiddenImput.focus()),l.parent.isEdit=!0,13===e?l.clearInput():l.input.isNum?t.keyCode>47&&t.keyCode<58||t.keyCode>95&&t.keyCode<106||190===t.keyCode||110===t.keyCode||8===t.keyCode||109===t.keyCode?l.hiddenImput.readOnly=!1:l.hiddenImput.readOnly=!0:l.hiddenImput.readOnly=!1},keyup:function(t){null!==l.parent&&(l.str=l.hiddenImput.value,l.parent.allEqual?l.parent.sameStr(l.str):l.input.textContent=l.str,l.cursorId=l.hiddenImput.selectionStart,l.inputRange=[l.hiddenImput.selectionStart,l.hiddenImput.selectionEnd],l.selectParent(),l.parent.validate())},loop:function(){l.isLoop&&requestAnimationFrame(l.loop),l.update()},update:function(){let t=l.listens.length;for(;t--;)l.listens[t].listening()},removeListen:function(t){let e=l.listens.indexOf(t);-1!==e&&l.listens.splice(e,1),0===l.listens.length&&(l.isLoop=!1)},addListen:function(t){return-1===l.listens.indexOf(t)&&(l.listens.push(t),l.isLoop||(l.isLoop=!0,l.loop()),!0)}},h=l,c={texture:null,transition:.2,frag:document.createDocumentFragment(),colorRing:null,joystick_0:null,joystick_1:null,circular:null,knob:null,pad2d:null,svgns:"http://www.w3.org/2000/svg",links:"http://www.w3.org/1999/xlink",htmls:"http://www.w3.org/1999/xhtml",DOM_SIZE:["height","width","top","left","bottom","right","margin-left","margin-right","margin-top","margin-bottom"],SVG_TYPE_D:["pattern","defs","transform","stop","animate","radialGradient","linearGradient","animateMotion","use","filter","feColorMatrix"],SVG_TYPE_G:["svg","rect","circle","path","polygon","text","g","line","foreignObject"],PI:Math.PI,TwoPI:2*Math.PI,pi90:.5*Math.PI,pi60:Math.PI/3,torad:Math.PI/180,todeg:180/Math.PI,clamp:(t,e,i)=>(t=t<e?e:t)>i?i:t,isDivid:t=>.5*t===Math.floor(.5*t),size:{w:240,h:20,p:30,s:8},defineColor:(t,e=c.colors)=>{let i={...e},s=["fontFamily","fontWeight","fontShadow","fontSize"],n=!1;t.font&&(t.fontFamily=t.font),t.shadow&&(t.fontShadow=t.shadow),t.weight&&(t.fontWeight=t.weight),t.fontColor&&(t.text=t.fontColor),t.color&&(t.text=t.color),t.text&&(i.text=t.text,t.fontColor||t.color||(i.title=c.ColorLuma(t.text,-.25),i.titleoff=c.ColorLuma(t.text,-.5)),i.textOver=c.ColorLuma(t.text,.25),i.textSelect=c.ColorLuma(t.text,.5)),t.button&&(i.button=t.button,i.border=c.ColorLuma(t.button,.1),i.overoff=c.ColorLuma(t.button,.2)),t.select&&(i.select=t.select,i.over=c.ColorLuma(t.select,-.1)),t.itemBg&&(t.back=t.itemBg),t.back&&(i.back=t.back,i.backoff=c.ColorLuma(t.back,-.1)),t.fontSelect&&(i.textSelect=t.fontSelect),t.groupBorder&&(i.gborder=t.groupBorder),t.bgOver&&(i.backgroundOver=t.bgOver);for(let e in i)void 0!==t[e]&&(i[e]=t[e]);for(let e in t)-1!==s.indexOf(e)&&(n=!0);return n&&c.defineText(i),i},colors:{sx:4,sy:2,radius:2,showOver:1,content:"none",background:"rgba(50,50,50,0.15)",backgroundOver:"rgba(50,50,50,0.3)",title:"#CCC",titleoff:"#BBB",text:"#DDD",textOver:"#EEE",textSelect:"#FFF",back:"rgba(0,0,0,0.2)",backoff:"rgba(0,0,0,0.3)",border:"#4c4c4c",borderSize:1,gborder:"none",groups:"none",button:"#3c3c3c",overoff:"#5c5c5c",over:"#024699",select:"#308AFF",action:"#FF3300",fontFamily:"Consolas, monospace",fontWeight:"normal",fontShadow:"none",fontSize:12,joyOver:"rgba(48,138,255,0.25)",joyOut:"rgba(100,100,100,0.5)",joySelect:"#308AFF",hide:"rgba(0,0,0,0)"},css:{basic:"position:absolute; pointer-events:none; box-sizing:border-box; margin:0; padding:0; overflow:hidden; -o-user-select:none; -ms-user-select:none; -khtml-user-select:none; -webkit-user-select:none; -moz-user-select:none;",button:"display:flex; align-items:center; justify-content:center; text-align:center;",middle:"display:flex; align-items:center; justify-content:left; text-align:left; flex-direction: row-reverse;"},svgs:{g1:"M 6 4 L 0 4 0 6 6 6 6 4 M 6 0 L 0 0 0 2 6 2 6 0 Z",g2:"M 6 0 L 4 0 4 6 6 6 6 0 M 2 0 L 0 0 0 6 2 6 2 0 Z",group:"M 7 7 L 7 8 8 8 8 7 7 7 M 5 7 L 5 8 6 8 6 7 5 7 M 3 7 L 3 8 4 8 4 7 3 7 M 7 5 L 7 6 8 6 8 5 7 5 M 6 6 L 6 5 5 5 5 6 6 6 M 7 3 L 7 4 8 4 8 3 7 3 M 6 4 L 6 3 5 3 5 4 6 4 M 3 5 L 3 6 4 6 4 5 3 5 M 3 3 L 3 4 4 4 4 3 3 3 Z",arrow:"M 3 8 L 8 5 3 2 3 8 Z",arrowDown:"M 5 8 L 8 3 2 3 5 8 Z",arrowUp:"M 5 2 L 2 7 8 7 5 2 Z",solid:"M 13 10 L 13 1 4 1 1 4 1 13 10 13 13 10 M 11 3 L 11 9 9 11 3 11 3 5 5 3 11 3 Z",body:"M 13 10 L 13 1 4 1 1 4 1 13 10 13 13 10 M 11 3 L 11 9 9 11 3 11 3 5 5 3 11 3 M 5 4 L 4 5 4 10 9 10 10 9 10 4 5 4 Z",vehicle:"M 13 6 L 11 1 3 1 1 6 1 13 3 13 3 11 11 11 11 13 13 13 13 6 M 2.4 6 L 4 2 10 2 11.6 6 2.4 6 M 12 8 L 12 10 10 10 10 8 12 8 M 4 8 L 4 10 2 10 2 8 4 8 Z",articulation:"M 13 9 L 12 9 9 2 9 1 5 1 5 2 2 9 1 9 1 13 5 13 5 9 4 9 6 5 8 5 10 9 9 9 9 13 13 13 13 9 Z",character:"M 13 4 L 12 3 9 4 5 4 2 3 1 4 5 6 5 8 4 13 6 13 7 9 8 13 10 13 9 8 9 6 13 4 M 6 1 L 6 3 8 3 8 1 6 1 Z",terrain:"M 13 8 L 12 7 Q 9.06 -3.67 5.95 4.85 4.04 3.27 2 7 L 1 8 7 13 13 8 M 3 8 Q 3.78 5.420 5.4 6.6 5.20 7.25 5 8 L 7 8 Q 8.39 -0.16 11 8 L 7 11 3 8 Z",joint:"M 7.7 7.7 Q 8 7.45 8 7 8 6.6 7.7 6.3 7.45 6 7 6 6.6 6 6.3 6.3 6 6.6 6 7 6 7.45 6.3 7.7 6.6 8 7 8 7.45 8 7.7 7.7 M 3.35 8.65 L 1 11 3 13 5.35 10.65 Q 6.1 11 7 11 8.28 11 9.25 10.25 L 7.8 8.8 Q 7.45 9 7 9 6.15 9 5.55 8.4 5 7.85 5 7 5 6.54 5.15 6.15 L 3.7 4.7 Q 3 5.712 3 7 3 7.9 3.35 8.65 M 10.25 9.25 Q 11 8.28 11 7 11 6.1 10.65 5.35 L 13 3 11 1 8.65 3.35 Q 7.9 3 7 3 5.7 3 4.7 3.7 L 6.15 5.15 Q 6.54 5 7 5 7.85 5 8.4 5.55 9 6.15 9 7 9 7.45 8.8 7.8 L 10.25 9.25 Z",ray:"M 9 11 L 5 11 5 12 9 12 9 11 M 12 5 L 11 5 11 9 12 9 12 5 M 11.5 10 Q 10.9 10 10.45 10.45 10 10.9 10 11.5 10 12.2 10.45 12.55 10.9 13 11.5 13 12.2 13 12.55 12.55 13 12.2 13 11.5 13 10.9 12.55 10.45 12.2 10 11.5 10 M 9 10 L 10 9 2 1 1 2 9 10 Z",collision:"M 11 12 L 13 10 10 7 13 4 11 2 7.5 5.5 9 7 7.5 8.5 11 12 M 3 2 L 1 4 4 7 1 10 3 12 8 7 3 2 Z",map:"M 13 1 L 1 1 1 13 13 13 13 1 M 12 2 L 12 7 7 7 7 12 2 12 2 7 7 7 7 2 12 2 Z",material:"M 13 1 L 1 1 1 13 13 13 13 1 M 12 2 L 12 7 7 7 7 12 2 12 2 7 7 7 7 2 12 2 Z",texture:"M 13 4 L 13 1 1 1 1 4 5 4 5 13 9 13 9 4 13 4 Z",object:"M 10 1 L 7 4 4 1 1 1 1 13 4 13 4 5 7 8 10 5 10 13 13 13 13 1 10 1 Z",none:"M 9 5 L 5 5 5 9 9 9 9 5 Z",cursor:"M 4 7 L 1 10 1 12 2 13 4 13 7 10 9 14 14 0 0 5 4 7 Z",load:"M 13 8 L 11.5 6.5 9 9 9 3 5 3 5 9 2.5 6.5 1 8 7 14 13 8 M 9 2 L 9 0 5 0 5 2 9 2 Z",save:"M 9 12 L 5 12 5 14 9 14 9 12 M 11.5 7.5 L 13 6 7 0 1 6 2.5 7.5 5 5 5 11 9 11 9 5 11.5 7.5 Z",extern:"M 14 14 L 14 0 0 0 0 14 14 14 M 12 6 L 12 12 2 12 2 6 12 6 M 12 2 L 12 4 2 4 2 2 12 2 Z"},rezone(){h.needReZone=!0},getImput:function(){return!!h.input},setStyle:function(t){for(var e in t)c.colors[e]&&(c.colors[e]=t[e]);c.setText()},defineText:function(t){c.setText(t.fontSize,t.text,t.fontFamily,t.fontShadow,t.fontWeight)},setText:function(t,e,i,s,n){let r=c.colors;void 0===i&&(i=r.fontFamily),void 0===t&&(t=r.fontSize),void 0===s&&(s=r.fontShadow),void 0===n&&(n=r.fontWeight),void 0===e&&(e=r.text),isNaN(t)?-1===t.search("em")&&(t+="px"):t+="px",c.css.txt=c.css.basic+c.css.middle+" font-family:"+i+"; font-weight:"+n+"; font-size:"+t+"; color:"+r.text+"; padding:0px 8px; left:0; top:2px; height:16px; width:100px; overflow:hidden; white-space: nowrap; letter-spacing: normal;","none"!==s&&(c.css.txt+=" text-shadow: 1px 1px 1px "+s+";"),c.css.txtselect=c.css.txt+"padding:0px 4px; border:1px dashed "+r.border+";",c.css.item=c.css.txt+"padding:0px 4px; position:relative; margin-bottom:1px; "},cloneCss:function(){return{...c.css}},clone:function(t){return t.cloneNode(!0)},setSvg:function(t,e,i,s,n){-1===s?t.setAttributeNS(null,e,i):void 0!==n?t.childNodes[s||0].childNodes[n||0].setAttributeNS(null,e,i):t.childNodes[s||0].setAttributeNS(null,e,i)},setCss:function(t,e){for(let i in e)-1!==c.DOM_SIZE.indexOf(i)?t.style[i]=e[i]+"px":t.style[i]=e[i]},set:function(t,e){for(let i in e)"txt"===i&&(t.textContent=e[i]),"link"===i?t.setAttributeNS(c.links,"xlink:href",e[i]):t.setAttributeNS(null,i,e[i])},get:function(t,e){if(void 0===e)return t;if(!isNaN(e))return t.childNodes[e];if(e instanceof Array){if(2===e.length)return t.childNodes[e[0]].childNodes[e[1]];if(3===e.length)return t.childNodes[e[0]].childNodes[e[1]].childNodes[e[2]]}},dom:function(t,e,i,s,n){return t=t||"div",-1!==c.SVG_TYPE_D.indexOf(t)||-1!==c.SVG_TYPE_G.indexOf(t)?"svg"===t?(s=document.createElementNS(c.svgns,"svg"),c.set(s,i)):(void 0===s&&(s=document.createElementNS(c.svgns,"svg")),c.addAttributes(s,t,i,n)):s=void 0===s?document.createElementNS(c.htmls,t):s.appendChild(document.createElementNS(c.htmls,t)),e&&(s.style.cssText=e),void 0===n?s:s.childNodes[n||0]},addAttributes:function(t,e,i,s){let n=document.createElementNS(c.svgns,e);return c.set(n,i),c.get(t,s).appendChild(n),-1!==c.SVG_TYPE_G.indexOf(e)&&(n.style.pointerEvents="none"),n},clear:function(t){for(c.purge(t);t.firstChild;)t.firstChild.firstChild&&c.clear(t.firstChild),t.removeChild(t.firstChild)},purge:function(t){let e,i,s=t.attributes;if(s)for(e=s.length;e--;)i=s[e].name,"function"==typeof t[i]&&(t[i]=null);if(s=t.childNodes,s)for(e=s.length;e--;)c.purge(t.childNodes[e])},addSVGGlowEffect:function(){if(null!==document.getElementById("UILGlow"))return;let t=c.initUILEffects(),e=c.addAttributes(t,"filter",{id:"UILGlow",x:"-20%",y:"-20%",width:"140%",height:"140%"});c.addAttributes(e,"feGaussianBlur",{in:"SourceGraphic",stdDeviation:"3",result:"uilBlur"});let i=c.addAttributes(e,"feMerge",{});for(let t=0;t<=3;t++)c.addAttributes(i,"feMergeNode",{in:"uilBlur"});c.addAttributes(i,"feMergeNode",{in:"SourceGraphic"})},initUILEffects:function(){let t=document.getElementById("UILSVGEffects");return null===t&&(t=c.dom("svg",void 0,{id:"UILSVGEffects",width:"0",height:"0"}),document.body.appendChild(t)),t},ColorLuma:function(t,e){"n"===t&&(t="#000"),(t=String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;let i,s,n="#";for(s=0;s<3;s++)i=parseInt(t.substr(2*s,2),16),i=Math.round(Math.min(Math.max(0,i+i*e),255)).toString(16),n+=("00"+i).substr(i.length);return n},findDeepInver:function(t){return.3*t[0]+.59*t[1]+.11*t[2]<=.6},lerpColor:function(t,e,i){let s={};for(let n=0;n<3;n++)s[n]=t[n]+(e[n]-t[n])*i;return s},hexToHtml:function(t){return"#"+("000000"+(t=void 0===t?0:t).toString(16)).substr(-6)},htmlToHex:function(t){return t.toUpperCase().replace("#","0x")},u255:function(t,e){return parseInt(t.substring(e,e+2),16)/255},u16:function(t,e){return parseInt(t.substring(e,e+1),16)/15},unpack:function(t){return 7==t.length?[c.u255(t,1),c.u255(t,3),c.u255(t,5)]:4==t.length?[c.u16(t,1),c.u16(t,2),c.u16(t,3)]:void 0},p255:function(t){let e=Math.round(255*t).toString(16);return e.length<2&&(e="0"+e),e},pack:function(t){return"#"+c.p255(t[0])+c.p255(t[1])+c.p255(t[2])},htmlRgba:function(t,e){return t=c.unpack(t),"rgba("+Math.round(255*t[0])+","+Math.round(255*t[1])+","+Math.round(255*t[2])+","+e+")"},htmlRgb:function(t,e){return"rgb("+Math.round(255*t[0])+","+Math.round(255*t[1])+","+Math.round(255*t[2])+")"},pad:function(t){return 1==t.length&&(t="0"+t),t},rgbToHex:function(t){let e=Math.round(255*t[0]).toString(16),i=Math.round(255*t[1]).toString(16),s=Math.round(255*t[2]).toString(16);return"#"+c.pad(e)+c.pad(i)+c.pad(s)},hueToRgb:function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t},rgbToHsl:function(t){let e=t[0],i=t[1],s=t[2],n=Math.min(e,i,s),r=Math.max(e,i,s),o=r-n,a=0,l=0,h=(n+r)/2;return h>0&&h<1&&(l=o/(h<.5?2*h:2-2*h)),o>0&&(r==e&&r!=i&&(a+=(i-s)/o),r==i&&r!=s&&(a+=2+(s-e)/o),r==s&&r!=e&&(a+=4+(e-i)/o),a/=6),[a,l,h]},hslToRgb:function(t){let e,i,s=t[0],n=t[1],r=t[2];return 0===n?[r,r,r]:(i=r<=.5?r*(n+1):r+n-r*n,e=2*r-i,[c.hueToRgb(e,i,s+.33333),c.hueToRgb(e,i,s),c.hueToRgb(e,i,s-.33333)])},makeGradiant:function(t,e,i,s){c.dom(t,null,e,i,0);let n,r=i.childNodes[0].childNodes.length-1;for(let t=0;t<s.length;t++)n=s[t],c.dom("stop",null,{offset:n[0]+"%","stop-color":n[1],"stop-opacity":n[2]},i,[0,r])},makePad:function(t){let e=c.dom("svg",c.css.basic+"position:relative;",{viewBox:"0 0 256 256",width:256,height:256,preserveAspectRatio:"none"});u.dom("rect","",{x:28,y:28,width:200,height:200,fill:c.colors.back},e),u.dom("rect","",{x:38,y:38,width:180,height:180,fill:c.colors.button},e),u.dom("line","",{x1:38,y1:128,x2:218,y2:128,stroke:c.colors.back,"stroke-width":2},e),u.dom("line","",{x1:128,x2:128,y1:38,y2:218,stroke:c.colors.back,"stroke-width":2},e),u.dom("circle","",{cx:128,cy:128,r:5,stroke:c.colors.text,"stroke-width":5,fill:"none"},e),c.pad2d=e},makeKnob:function(t){let e=c.dom("svg",c.css.basic+"position:relative;",{viewBox:"0 0 128 128",width:128,height:128,preserveAspectRatio:"none"});c.dom("circle","",{cx:64,cy:64,r:34,fill:c.colors.button,stroke:"rgba(0,0,0,0.3)","stroke-width":8},e),c.dom("path","",{d:"",stroke:c.colors.text,"stroke-width":4,fill:"none","stroke-linecap":"round"},e),c.dom("circle","",{cx:64,cy:64,r:41,stroke:"rgba(0,0,0,0.1)","stroke-width":7,fill:"none"},e),c.dom("path","",{d:"",stroke:"rgba(255,255,255,0.3)","stroke-width":2,fill:"none","stroke-linecap":"round","stroke-opacity":.5},e),c.knob=e},makeCircular:function(t){let e=c.dom("svg",c.css.basic+"position:relative;",{viewBox:"0 0 128 128",width:128,height:128,preserveAspectRatio:"none"});c.dom("circle","",{cx:64,cy:64,r:40,stroke:"rgba(0,0,0,0.1)","stroke-width":10,fill:"none"},e),c.dom("path","",{d:"",stroke:c.colors.text,"stroke-width":7,fill:"none","stroke-linecap":"butt"},e),c.circular=e},makeJoystick:function(t){let e,i=Math.floor(49),s=Math.floor(.6*i),n=c.dom("svg",c.css.basic+"position:relative;",{viewBox:"0 0 128 128",width:128,height:128,preserveAspectRatio:"none"});if(c.dom("defs",null,{},n),c.dom("g",null,{},n),0===t){e=[[40,"rgb(0,0,0)",.3],[80,"rgb(0,0,0)",0],[90,"rgb(50,50,50)",.4],[100,"rgb(50,50,50)",0]],c.makeGradiant("radialGradient",{id:"grad",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},n,e),e=[[60,"rgb(0,0,0)",.5],[100,"rgb(0,0,0)",0]],c.makeGradiant("radialGradient",{id:"gradS",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},n,e);let t=["rgb(40,40,40)","rgb(48,48,48)","rgb(30,30,30)"],r=["rgb(1,90,197)","rgb(3,95,207)","rgb(0,65,167)"];e=[[30,t[0],1],[60,t[1],1],[80,t[1],1],[100,t[2],1]],c.makeGradiant("radialGradient",{id:"gradIn",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},n,e),e=[[30,r[0],1],[60,r[1],1],[80,r[1],1],[100,r[2],1]],c.makeGradiant("radialGradient",{id:"gradIn2",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},n,e),c.dom("circle","",{cx:64,cy:64,r:i,fill:"url(#grad)"},n),c.dom("circle","",{cx:69,cy:74,r:s+10,fill:"url(#gradS)"},n),c.dom("circle","",{cx:64,cy:64,r:s,fill:"url(#gradIn)"},n),c.joystick_0=n}else e=[[69,"rgb(0,0,0)",0],[70,"rgb(0,0,0)",.3],[100,"rgb(0,0,0)",0]],c.makeGradiant("radialGradient",{id:"gradX",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},n,e),c.dom("circle","",{cx:64,cy:64,r:i,fill:"none",stroke:"rgba(100,100,100,0.25)","stroke-width":"4"},n),c.dom("circle","",{cx:64,cy:64,r:s+14,fill:"url(#gradX)"},n),c.dom("circle","",{cx:64,cy:64,r:s,fill:"none",stroke:"rgb(100,100,100)","stroke-width":"4"},n),c.joystick_1=n},makeColorRing:function(){let t=c.dom("svg",c.css.basic+"position:relative;",{viewBox:"0 0 256 256",width:256,height:256,preserveAspectRatio:"none"});c.dom("defs",null,{},t),c.dom("g",null,{},t);let e,i,s,n,r,o,a,l,h,u=8/113/24*Math.PI,d=0,p=[];for(o=0;o<=24;++o){if(s=o/24,n=s*c.TwoPI,e=.5*(d+n),i=1/Math.cos(.5*(n-d)),r=[Math.sin(d),-Math.cos(d),Math.sin(e)*i,-Math.cos(e)*i,Math.sin(n),-Math.cos(n)],p[1]=c.rgbToHex(c.hslToRgb([s,1,.5])),o>0){for(a=6;a--;)r[a]=(113*r[a]+128).toFixed(2);l=" M"+r[0]+" "+r[1]+" Q"+r[2]+" "+r[3]+" "+r[4]+" "+r[5],h=[[0,p[0],1],[100,p[1],1]],c.makeGradiant("linearGradient",{id:"G"+o,x1:r[0],y1:r[1],x2:r[4],y2:r[5],gradientUnits:"userSpaceOnUse"},t,h),c.dom("path","",{d:l,"stroke-width":30,stroke:"url(#G"+o+")","stroke-linecap":"butt"},t,1)}d=n-u,p[0]=p[1]}h=[[0,"#FFFFFF",1],[50,"#FFFFFF",0],[50,"#000000",0],[100,"#000000",1]],c.makeGradiant("linearGradient",{id:"GL0",x1:0,y1:128-84.9,x2:0,y2:212.9,gradientUnits:"userSpaceOnUse"},t,h),h=[[0,"#7f7f7f",1],[50,"#7f7f7f",.5],[100,"#7f7f7f",0]],c.makeGradiant("linearGradient",{id:"GL1",x1:78.95,y1:0,x2:226,y2:0,gradientUnits:"userSpaceOnUse"},t,h),c.dom("g",null,{"transform-origin":"128px 128px",transform:"rotate(0)"},t),c.dom("polygon","",{points:"78.95 43.1 78.95 212.85 226 128",fill:"red"},t,2),c.dom("polygon","",{points:"78.95 43.1 78.95 212.85 226 128",fill:"url(#GL1)","stroke-width":1,stroke:"url(#GL1)"},t,2),c.dom("polygon","",{points:"78.95 43.1 78.95 212.85 226 128",fill:"url(#GL0)","stroke-width":1,stroke:"url(#GL0)"},t,2),c.dom("path","",{d:"M 255.75 136.5 Q 256 132.3 256 128 256 123.7 255.75 119.5 L 241 128 255.75 136.5 Z",fill:"none","stroke-width":2,stroke:"#000"},t,2),c.dom("circle","",{cx:128,cy:128,r:6,"stroke-width":2,stroke:"#000",fill:"none"},t),c.colorRing=t},icon:function(t,e,i){i=i||40;let s=["<svg xmlns='"+c.svgns+"' version='1.1' xmlns:xlink='"+c.htmls+"' style='pointer-events:none;' preserveAspectRatio='xMinYMax meet' x='0px' y='0px' width='"+i+"px' height='"+i+"px' viewBox='0 0 256 256'><g>"];switch(t){case"logo":s[1]="<path id='logoin' fill='"+e+"' stroke='none' d='"+c.logoFill_d+"'/>";break;case"donate":s[1]="<path id='logoin' fill='"+e+"' stroke='none' d='"+c.logo_donate+"'/>";break;case"neo":s[1]="<path id='logoin' fill='"+e+"' stroke='none' d='"+c.logo_neo+"'/>";break;case"phy":s[1]="<path id='logoin' stroke='"+e+"' stroke-width='49' stroke-linejoin='round' stroke-linecap='butt' fill='none' d='"+c.logo_phy+"'/>";break;case"config":s[1]="<path id='logoin' stroke='"+e+"' stroke-width='49' stroke-linejoin='round' stroke-linecap='butt' fill='none' d='"+c.logo_config+"'/>";break;case"github":s[1]="<path id='logoin' fill='"+e+"' stroke='none' d='"+c.logo_github+"'/>";break;case"save":s[1]="<path stroke='"+e+"' stroke-width='4' stroke-linejoin='round' stroke-linecap='round' fill='none' d='M 26.125 17 L 20 22.95 14.05 17 M 20 9.95 L 20 22.95'/><path stroke='"+e,s[1]+="' stroke-width='2.5' stroke-linejoin='round' stroke-linecap='round' fill='none' d='M 32.6 23 L 32.6 25.5 Q 32.6 28.5 29.6 28.5 L 10.6 28.5 Q 7.6 28.5 7.6 25.5 L 7.6 23'/>"}return s[2]="</g></svg>",s.join("\n")},logoFill_d:"\n    M 171 150.75 L 171 33.25 155.5 33.25 155.5 150.75 Q 155.5 162.2 147.45 170.2 139.45 178.25 128 178.25 116.6 178.25 108.55 170.2 100.5 162.2 100.5 150.75 \n    L 100.5 33.25 85 33.25 85 150.75 Q 85 168.65 97.55 181.15 110.15 193.75 128 193.75 145.9 193.75 158.4 181.15 171 168.65 171 150.75 \n    M 200 33.25 L 184 33.25 184 150.8 Q 184 174.1 167.6 190.4 151.3 206.8 128 206.8 104.75 206.8 88.3 190.4 72 174.1 72 150.8 L 72 33.25 56 33.25 56 150.75 \n    Q 56 180.55 77.05 201.6 98.2 222.75 128 222.75 157.8 222.75 178.9 201.6 200 180.55 200 150.75 L 200 33.25 Z\n    ",logo_github:"\n    M 180.5 70 Q 186.3 82.4 181.55 96.55 196.5 111.5 189.7 140.65 183.65 168.35 146 172.7 152.5 178.7 152.55 185.9 L 152.55 218.15 Q 152.84 224.56 159.15 223.3 \n    159.21 223.3 159.25 223.3 181.14 216.25 198.7 198.7 228 169.4 228 128 228 86.6 198.7 57.3 169.4 28 128 28 86.6 28 57.3 57.3 28 86.6 28 128 28 169.4 57.3 198.7 74.85 \n    216.25 96.75 223.3 96.78 223.3 96.8 223.3 103.16 224.54 103.45 218.15 L 103.45 200 Q 82.97 203.1 75.1 196.35 69.85 191.65 68.4 185.45 64.27 177.055 59.4 174.15 49.20 \n    166.87 60.8 167.8 69.85 169.61 75.7 180 81.13 188.09 90 188.55 98.18 188.86 103.45 185.9 103.49 178.67 110 172.7 72.33 168.33 66.3 140.65 59.48 111.49 74.45 96.55 69.7 \n    82.41 75.5 70 84.87 68.74 103.15 80 115.125 76.635 128 76.85 140.85 76.65 152.85 80 171.1 68.75 180.5 70 Z\n    ",logo_neo:"\n    M 219 52 L 206 52 206 166 Q 206 183.4 193.75 195.65 181.4 208 164 208 146.6 208 134.35 195.65 122 183.4 122 166 L 122 90 Q 122 77.6 113.15 68.85 104.4 60 92 60 79.55 \n    60 70.75 68.85 62 77.6 62 90 L 62 204 75 204 75 90 Q 75 83 79.95 78 84.95 73 92 73 99 73 104 78 109 83 109 90 L 109 166 Q 109 188.8 125.15 204.85 141.2 221 164 221 \n    186.75 221 202.95 204.85 219 188.8 219 166 L 219 52 M 194 52 L 181 52 181 166 Q 181 173 176.05 178 171.05 183 164 183 157 183 152 178 147 173 147 166 L 147 90 Q 147 \n    67.2 130.85 51.15 114.8 35 92 35 69.25 35 53.05 51.15 37 67.2 37 90 L 37 204 50 204 50 90 Q 50 72.6 62.25 60.35 74.6 48 92 48 109.4 48 121.65 60.35 134 72.6 134 90 L \n    134 166 Q 134 178.4 142.85 187.15 151.6 196 164 196 176.45 196 185.25 187.15 194 178.4 194 166 L 194 52 Z\n    ",logo_phy:"\n    M 103.55 37.95 L 127.95 37.95 Q 162.35 37.95 186.5 55 210.9 72.35 210.9 96.5 210.9 120.65 186.5 137.7 162.35 155 127.95 155 L 127.95 237.95 M 127.95 155 \n    Q 93.55 155 69.15 137.7 45 120.65 45 96.5 45 72.35 69.15 55 70.9 53.8 72.85 52.85 M 127.95 155 L 127.95 37.95\n    ",logo_config:"\n    M 204.35 51.65 L 173.25 82.75 Q 192 101.5 192 128 L 236 128 M 192 128 Q 192 154.55 173.25 173.25 L 204.4 204.4 M 51.65 51.65 L 82.75 82.75 Q 101.5 64 128 64 \n    L 128 20 M 51.6 204.4 L 82.75 173.25 Q 64 154.55 64 128 L 20 128 M 128 236 L 128 192 Q 101.5 192 82.75 173.25 M 64 128 Q 64 101.5 82.75 82.75 M 173.25 173.25 \n    Q 154.55 192 128 192 M 128 64 Q 154.55 64 173.25 82.75\n    ",logo_donate:"\n    M 171.3 80.3 Q 179.5 62.15 171.3 45.8 164.1 32.5 141.35 30.1 L 94.35 30.1 Q 89.35 30.4 88.3 35.15 L 70.5 148.05 Q 70.2 152.5 73.7 152.6 L 100.95 152.6 107 111.6 Q 108.75 \n    106.55 112.6 106.45 130.45 108.05 145.3 103.9 163.35 98.75 171.3 80.3 M 179.8 71.5 Q 178.6 79.75 174.9 87.85 168.45 102.9 151.9 109.15 140.65 113.95 117.55 113 113.15 \n    112.75 111 117.45 L 102.7 169.95 Q 102.45 173.8 105.5 173.85 L 128.95 173.85 Q 132.2 174.2 133.35 169.65 L 138.3 139.95 Q 139.75 135.6 143.1 135.5 146.6 135.75 150.6 135.65 \n    154.55 135.5 157.35 135.1 160.15 134.7 166.75 132.35 181.35 127.4 187.9 111.2 194.25 95.75 189.5 81.95 186.75 74.85 179.8 71.5 M 103.5 209.9 Q 103.5 202.85 99.7 198.85 95.95 \n    194.75 89.4 194.75 82.8 194.75 79.05 198.85 75.3 202.9 75.3 209.9 75.3 216.85 79.05 220.95 82.8 225.05 89.4 225.05 95.95 225.05 99.7 221 103.5 216.95 103.5 209.9 M 95.45 205.5 \n    Q 95.95 207.3 95.95 209.9 95.95 212.65 95.45 214.35 94.95 216 94 217.3 93.1 218.45 91.9 219 90.7 219.55 89.4 219.55 88.15 219.55 86.95 219.05 85.75 218.55 84.8 217.3 83.9 216.15 \n    83.4 214.35 82.85 212.6 82.85 209.9 82.85 207.3 83.4 205.45 83.95 203.55 84.85 202.45 85.9 201.2 86.95 200.75 88.05 200.25 89.4 200.25 90.7 200.25 91.85 200.8 93.05 201.3 94 202.5 \n    94.9 203.65 95.45 205.5 M 153.3 195.35 L 145.3 195.35 135.5 224.45 142.8 224.45 144.6 218.5 153.75 218.5 155.6 224.45 163.1 224.45 153.3 195.35 M 152.15 213.25 L 146.25 213.25 \n    149.2 203.65 152.15 213.25 M 116.75 195.35 L 107.8 195.35 107.8 224.45 114.5 224.45 114.5 204.2 125.7 224.45 132.75 224.45 132.75 195.35 126.05 195.35 126.05 212.05 116.75 195.35 M \n    66.5 197.65 Q 64.15 196.15 61.45 195.75 58.8 195.35 55.75 195.35 L 46.7 195.35 46.7 224.45 55.8 224.45 Q 58.8 224.45 61.5 224.05 64.15 223.6 66.4 222.15 69.15 220.45 70.9 217.2 \n    72.7 214 72.7 209.95 72.7 205.7 71 202.6 69.35 199.5 66.5 197.65 M 64.2 205 Q 65.2 207 65.2 209.9 65.2 212.75 64.25 214.75 63.3 216.75 61.5 217.85 60 218.85 58.3 218.9 56.6 219 \n    54.15 219 L 54 219 54 200.8 54.15 200.8 Q 56.4 200.8 58.05 200.9 59.7 200.95 61.15 201.75 63.2 202.95 64.2 205 M 210.2 195.35 L 190.5 195.35 190.5 224.45 210.2 224.45 210.2 218.9 \n    197.75 218.9 197.75 211.55 209.2 211.55 209.2 206 197.75 206 197.75 200.9 210.2 200.9 210.2 195.35 M 187.5 195.35 L 163 195.35 163 200.9 171.6 200.9 171.6 224.45 178.9 224.45 178.9 \n    200.9 187.5 200.9 187.5 195.35 Z\n    "};c.setText();const u=c;class d{static autoTypes(t){let e=[];switch(t){case"svg":e=[{accept:{"image/svg+xml":".svg"}}];break;case"wav":e=[{accept:{"audio/wav":".wav"}}];break;case"mp3":e=[{accept:{"audio/mpeg":".mp3"}}];break;case"mp4":e=[{accept:{"video/mp4":".mp4"}}];break;case"bin":case"hex":e=[{description:"Binary Files",accept:{"application/octet-stream":[".bin",".hex"]}}];break;case"text":e=[{description:"Text Files",accept:{"text/plain":[".txt",".text"],"text/html":[".html",".htm"]}}];break;case"json":e=[{description:"JSON Files",accept:{"application/json":[".json"]}}];break;case"js":e=[{description:"JavaScript Files",accept:{"text/javascript":[".js"]}}];break;case"image":e=[{description:"Images",accept:{"image/*":[".png",".gif",".jpeg",".jpg"]}}];break;case"icon":e=[{description:"Icons",accept:{"image/x-ico":[".ico"]}}];break;case"lut":e=[{description:"Lut",accept:{"text/plain":[".cube",".3dl"]}}]}return e}static async load(t={}){"function"!=typeof window.showOpenFilePicker&&(window.showOpenFilePicker=d.showOpenFilePickerPolyfill);try{let e=t.type||"";const i={excludeAcceptAllOption:!!e,multiple:!1};i.types=d.autoTypes(e);const s=await window.showOpenFilePicker(i),n=await s[0].getFile();if(!n)return null;let r=n.name,o=r.substring(r.lastIndexOf(".")+1,r.length);const a=["png","jpg","jpeg","mp4","webm","ogg","mp3"],l=["sea","z","hex","bvh","BVH","glb","gltf","exr"],h=new FileReader;-1!==a.indexOf(o)?h.readAsDataURL(n):-1!==l.indexOf(o)?h.readAsArrayBuffer(n):h.readAsText(n),h.onload=function(i){let s=i.target.result;switch(e){case"image":let e=new Image;e.onload=function(){e.width=e.width,e.height=e.height,t.callback&&t.callback(e,r,o,[e.width,e.height])},e.src=s;break;case"json":t.callback&&t.callback(JSON.parse(s),r,o);break;default:t.callback&&t.callback(s,r,o)}}}catch(e){console.log(e),t.always&&t.callback&&t.callback(null)}}static showOpenFilePickerPolyfill(t){return new Promise((e=>{const i=document.createElement("input");i.type="file",i.multiple=t.multiple,i.accept=t.types.map((t=>t.accept)).flatMap((t=>Object.keys(t).flatMap((e=>t[e])))).join(","),i.addEventListener("change",(()=>{e([...i.files].map((t=>({getFile:async()=>new Promise((e=>{e(t)}))}))))})),i.click()}))}static async save(t={}){let e=!1;"function"!=typeof window.showSaveFilePicker&&(window.showSaveFilePicker=d.showSaveFilePickerPolyfill,e=!0);try{let i=t.type||"";const s={suggestedName:t.name||"hello",data:t.data||""};s.types=d.autoTypes(i),s.finalType=Object.keys(s.types[0].accept)[0],s.suggestedName+=s.types[0].accept[s.finalType][0];const n=await window.showSaveFilePicker(s);if(e)return;const r=await n.createWritable();let o=new Blob([s.data],{type:s.finalType});await r.write(o),await r.close()}catch(t){console.log(t)}}static showSaveFilePickerPolyfill(t){return new Promise((e=>{const i=document.createElement("a");i.download=t.suggestedName||"my-file.txt";let s=new Blob([t.data],{type:t.finalType});i.href=URL.createObjectURL(s),i.addEventListener("click",(()=>{e(setTimeout((()=>URL.revokeObjectURL(i.href)),1e3))})),i.click()}))}static async getFolder(){try{const t=await window.showDirectoryPicker(),e=[];for await(const i of t.values()){const t=await i.getFile();e.push(t)}return console.log(e),e}catch(t){console.log(t)}}}class p{constructor(t=0,e=0){this.x=t,this.y=e}set(t,e){return this.x=t,this.y=e,this}divide(t){return this.x/=t.x,this.y/=t.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divideScalar(t){return this.multiplyScalar(1/t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}angle(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t}addScalar(t){return this.x+=t,this.y+=t,this}negate(){return this.x*=-1,this.y*=-1,this}neg(){return this.x=-1,this.y=-1,this}isZero(){return 0===this.x&&0===this.y}copy(t){return this.x=t.x,this.y=t.y,this}equals(t){return t.x===this.x&&t.y===this.y}nearEquals(t,e){return t.x.toFixed(e)===this.x.toFixed(e)&&t.y.toFixed(e)===this.y.toFixed(e)}lerp(t,e){return null===t?(this.x-=this.x*e,this.y-=this.y*e):(this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e),this}}class f{constructor(t={}){this.lock=t.lock||!1,this.neverlock=!1,this.isSpace=t.isSpace||!1,this.main=t.main||null,this.isUI=t.isUI||!1,this.group=t.group||null,this.isListen=!1,this.top=0,this.ytop=0,this.dx=t.dx||0,this.isSelectable=void 0!==t.selectable&&t.selectable,this.unselectable=void 0!==t.unselect?t.unselect:this.isSelectable,this.ontop=!!t.ontop&&t.ontop,this.css=this.main?this.main.css:u.css,this.colors=u.defineColor(t,this.main?this.group?this.group.colors:this.main.colors:u.colors),this.overEffect=this.colors.showOver,this.svgs=u.svgs,this.zone={x:0,y:0,w:0,h:0,d:0},this.local=(new p).neg(),this.isCanvasOnly=!1,this.isSelect=!1,this.p=void 0!==t.p?t.p:u.size.p,this.w=this.isUI?this.main.size.w:u.size.w,void 0!==t.w&&(this.w=t.w),this.h=this.isUI?this.main.size.h:u.size.h,void 0!==t.h&&(this.h=t.h),this.isSpace?this.lock=!0:this.h=this.h<11?11:this.h,this.fw=t.fw||0,this.autoWidth=t.auto||!0,this.isOpen=!1,this.radius=t.radius||this.colors.radius,this.transition=t.transition||u.transition,this.isNumber=!1,this.noNeg=t.noNeg||!1,this.allEqual=t.allEqual||!1,this.mono=!1,this.isEdit=!1,this.simple=t.simple||!1,this.simple&&(this.sa=0),this.setSize(this.w),void 0!==t.sa&&(this.sa=t.sa),void 0!==t.sb&&(this.sb=t.sb),this.simple&&(this.sb=this.w-this.sa),this.sc=void 0===t.sc?47:t.sc,this.objectLink=null,this.isSend=!1,this.objectKey=null,this.txt=t.name||"",this.name=t.rename||this.txt,this.target=t.target||null,this.callback=void 0===t.callback?null:t.callback,this.endCallback=null,this.openCallback=void 0===t.openCallback?null:t.openCallback,this.closeCallback=void 0===t.closeCallback?null:t.closeCallback,null===this.callback&&this.isUI&&null!==this.main.callback&&(this.callback=this.group?this.group.callback:this.main.callback),this.c=[],this.s=[],this.useFlex=!!this.isUI&&this.main.useFlex;let e=this.useFlex?"display:flex; justify-content:center; align-items:center; text-align:center; flex: 1 100%;":"float:left;";this.c[0]=u.dom("div",this.css.basic+e+"position:relative; height:20px;"),this.s[0]=this.c[0].style,this.margin=this.colors.sy,this.mtop=0;let i=u.isDivid(this.margin);if(this.isUI&&this.margin&&(this.s[0].boxSizing="content-box",i?(this.mtop=.5*this.margin,this.s[0].borderTop=this.mtop+"px solid transparent",this.s[0].borderBottom=this.mtop+"px solid transparent"):this.s[0].borderBottom=this.margin+"px solid transparent"),this.simple||(this.c[1]=u.dom("div",this.css.txt+this.css.middle),this.s[1]=this.c[1].style,this.c[1].textContent=this.name,this.s[1].color=this.lock?this.colors.titleoff:this.colors.title),t.pos){this.s[0].position="absolute";for(let e in t.pos)this.s[0][e]=t.pos[e];this.mono=!0}t.css&&(this.s[0].cssText=t.css)}init(){this.ytop=this.top+this.mtop,this.zone.h=this.h+this.margin,this.zone.w=this.w;let t=this.s,e=this.c;t[0].height=this.h+"px",this.isUI&&(t[0].background=this.colors.background),!this.autoWidth&&this.useFlex?(t[0].flex="1 0 auto",t[0].minWidth=this.minw+"px",t[0].textAlign="center"):this.isUI&&(t[0].width="100%"),void 0!==e[1]&&this.autoWidth&&(t[1]=e[1].style,t[1].top="1px",t[1].height=this.h-2+"px");let i=u.frag;for(let s=1,n=e.length;s!==n;s++)void 0!==e[s]&&(i.appendChild(e[s]),t[s]=e[s].style);let s=null!==this.target?this.target:this.isUI?this.main.inner:document.body;this.ontop?s.insertAdjacentElement("afterbegin",e[0]):s.appendChild(e[0]),e[0].appendChild(i),this.rSize(),this.isUI||(this.c[0].style.pointerEvents="auto",h.add(this))}addTransition(){this.baseH&&this.transition&&this.isUI&&(this.c[0].style.transition="height "+this.transition+"s ease-out")}dom(t,e,i,s,n){return u.dom(t,e,i,s,n)}setSvg(t,e,i,s,n){u.setSvg(t,e,i,s,n)}setCss(t,e){u.setCss(t,e)}clamp(t,e,i){return u.clamp(t,e,i)}getColorRing(){return u.colorRing||u.makeColorRing(),u.clone(u.colorRing)}getJoystick(t){return u["joystick_"+t]||u.makeJoystick(t),u.clone(u["joystick_"+t])}getCircular(t){return u.circular||u.makeCircular(t),u.clone(u.circular)}getKnob(t){return u.knob||u.makeKnob(t),u.clone(u.knob)}getPad2d(t){return u.pad2d||u.makePad(t),u.clone(u.pad2d)}cursor(t){h.cursor(t)}update(){}reset(){}appendChild(t){this.c[0].appendChild(t)}content(){return this.c[0]}getDom(){return this.c[0]}uiout(){this.lock||this.overEffect&&this.s&&(this.s[0].background=this.colors.background)}uiover(){this.lock||this.overEffect&&this.s&&(this.s[0].background=this.colors.backgroundOver)}rename(t){void 0!==this.c[1]&&(this.c[1].textContent=t)}listen(){return this.isListen=h.addListen(this),this}listening(){null!==this.objectLink&&(this.isSend||this.isEdit||this.setValue(this.objectLink[this.objectKey]))}setValue(t){this.isNumber?this.value=this.numValue(t):this.value=t,this.update()}onChange(t){if(!this.isSpace)return this.callback=t||null,this}onFinishChange(t){if(!this.isSpace)return this.callback=null,this.endCallback=t,this}onOpen(t){return this.openCallback=t,this}onClose(t){return this.closeCallback=t,this}send(t){(t=t||this.value)instanceof Array&&1===t.length&&(t=t[0]),this.isSend=!0,null!==this.objectLink&&(this.objectLink[this.objectKey].isColor?this.objectLink[this.objectKey].setHex(t):this.objectLink[this.objectKey]=t),this.callback&&this.callback(t,this.objectKey),this.isSend=!1}sendEnd(t){(t=t||this.value)instanceof Array&&1===t.length&&(t=t[0]),this.endCallback&&this.endCallback(t),null!==this.objectLink&&(this.objectLink[this.objectKey]=t)}dispose(){this.isListen&&h.removeListen(this),u.clear(this.c[0]),null!==this.target?null!==this.group?this.group.clearOne(this):this.target.removeChild(this.c[0]):this.isUI?this.main.clearOne(this):document.body.removeChild(this.c[0]),this.isUI||h.remove(this),this.c=null,this.s=null,this.callback=null,this.target=null,this.isListen=!1}clear(){}getWidth(){let t=h.getWidth(this);t&&(this.w=t)}setSize(t){if(this.autoWidth)if(this.w=t,this.simple)this.sb=this.w-this.sa;else{let t=this.w*(this.p/100);this.sa=Math.floor(t+8),this.sb=Math.floor(this.w-t-16)}}rSize(){this.autoWidth&&(this.isUI||(this.s[0].width=this.w+"px"),this.simple||(this.s[1].width=this.sa+"px"))}setTypeNumber(t){let e;switch(this.isNumber=!0,this.value=0,void 0!==t.value&&("string"==typeof t.value?this.value=1*t.value:this.value=t.value),this.min=void 0===t.min?-1/0:t.min,this.max=void 0===t.max?1/0:t.max,this.precision=void 0===t.precision?2:t.precision,this.precision){case 0:e=1;break;case 1:e=.1;break;case 2:e=.01;break;case 3:e=.001;break;case 4:e=1e-4;break;case 5:e=1e-5;break;case 6:e=1e-6}this.step=void 0===t.step?e:t.step,this.range=this.max-this.min,this.value=this.numValue(this.value)}numValue(t){return this.noNeg&&(t=Math.abs(t)),1*Math.min(this.max,Math.max(this.min,t)).toFixed(this.precision)}handleEvent(t){if(!this.lock)return this.neverlock&&(h.lock=!1),this[t.type]?this[t.type](t):console.error(t.type,"this type of event no existe !")}wheel(t){return!1}mousedown(t){return!1}mousemove(t){return!1}mouseup(t){return!1}keydown(t){return!1}keyup(t){return!1}setReferency(t,e){this.objectLink=t,this.objectKey=e}display(t=!1){this.s[0].visibility=t?"visible":"hidden"}open(){this.isOpen||(this.isOpen=!0,h.needResize=!0,this.openCallback&&this.openCallback())}close(){this.isOpen&&(this.isOpen=!1,h.needResize=!0,this.closeCallback&&this.closeCallback())}needZone(){h.needReZone=!0}rezone(){h.needReZone=!0}select(){}unselect(){}setInput(t){h.setInput(t,this)}upInput(t,e){return h.upInput(t,e)}selected(t){this.isSelect=t||!1}}class m extends f{constructor(t={}){super(t),this.value=t.value||!1,this.model=void 0!==t.mode?t.mode:0,this.onName=t.rename||this.txt,t.onName&&(t.onname=t.onName),t.onname&&(this.onName=t.onname),this.inh=t.inh||Math.floor(.8*this.h),this.inw=t.inw||36;let e=this.colors;if(0===this.model){let t=Math.floor(.5*this.h)-.5*(this.inh-2);this.c[2]=this.dom("div",this.css.basic+"background:"+e.inputBg+"; height:"+(this.inh-2)+"px; width:"+this.inw+"px; top:"+t+"px; border-radius:10px; border:2px solid "+e.back),this.c[3]=this.dom("div",this.css.basic+"height:"+(this.inh-6)+"px; width:16px; top:"+(t+2)+"px; border-radius:10px; background:"+e.button+";")}else this.p=0,void 0!==this.c[1]&&(this.c[1].textContent=""),this.c[2]=this.dom("div",this.css.txt+this.css.button+"top:1px; background:"+e.button+"; height:"+(this.h-2)+"px; border:"+e.borderSize+"px solid "+e.border+"; border-radius:"+this.radius+"px;");this.stat=-1,this.init(),this.update()}mousedown(t){return this.value=!this.value,this.update(!0),this.mousemove(t)}mousemove(t){return this.cursor("pointer"),this.mode(!0)}reset(){return this.cursor(),this.mode()}mode(t){let e,i=!1,s=this.colors,n=this.s,r=this.value;if(e=t?r?4:3:r?2:1,this.stat!==e){if(this.stat=e,0!==this.model){switch(e){case 1:n[2].color=s.text,n[2].background=s.button;break;case 2:n[2].color=s.textSelect,n[2].background=s.select;break;case 3:n[2].color=s.textOver,n[2].background=s.overoff;break;case 4:n[2].color=s.textOver,n[2].background=s.over}this.c[2].innerHTML=r?this.onName:this.name}else{switch(e){case 1:n[2].background=n[2].borderColor=s.backoff,n[3].background=s.button;break;case 2:n[2].background=n[2].borderColor=s.back,n[3].background=s.textOver;break;case 3:n[2].background=n[2].borderColor=s.back,n[3].background=s.overoff;break;case 4:n[2].background=n[2].borderColor=s.backoff,n[3].background=s.textSelect}n[3].marginLeft=r?"17px":"2px",this.c[1].textContent=r?this.onName:this.name}i=!0}return i}update(t){this.mode(),t&&this.send()}rSize(){super.rSize();let t=this.s,e=this.w-10-this.inw;0===this.model?(t[2].left=e+"px",t[3].left=e+"px"):(t[2].left=this.sa+"px",t[2].width=this.sb+"px")}}class g extends f{constructor(t={}){super(t),this.value="",void 0!==t.value&&(this.value=t.value),this.values=t.value||this.txt,t.values&&(this.values=t.values),t.values||t.value||(this.txt=""),this.onName=t.onName||null,this.on=!1,this.bw=t.forceWidth||0,t.bw&&(this.bw=t.bw),this.space=t.space||3,"string"==typeof this.values&&(this.values=[this.values]),this.isDown=!1,this.neverlock=!0,this.res=0,this.lng=this.values.length,this.tmp=[],this.stat=[];let e,i=this.colors;for(let t=0;t<this.lng;t++)e=!1,this.values[t]===this.value&&this.isSelectable&&(e=!0),this.c[t+2]=this.dom("div",this.css.txt+this.css.button+"top:1px; height:"+(this.h-2)+"px; border:"+i.borderSize+"px solid "+i.border+"; border-radius:"+this.radius+"px;"),this.c[t+2].style.background=e?i.select:i.button,this.c[t+2].style.color=e?i.textSelect:i.text,this.c[t+2].innerHTML=this.values[t],this.stat[t]=e?3:1;""===this.txt&&(this.p=0),(t.value||t.values)&&0!==this.p||void 0!==this.c[1]&&(this.c[1].textContent=""),this.init()}onOff(){this.on=!this.on,this.label(this.on?this.onName:this.value)}testZone(t){let e=this.local;if(-1===e.x&&-1===e.y)return-1;let i=this.lng,s=this.tmp;for(;i--;)if(e.x>s[i][0]&&e.x<s[i][2])return i;return-1}mouseup(t){return!!this.isDown&&(this.isDown=!1,-1!==this.res&&(this.value===this.values[this.res]&&this.unselectable?this.value="":this.value=this.values[this.res],null!==this.onName&&this.onOff(),this.send()),this.mousemove(t))}mousedown(t){return!this.isDown&&(this.isDown=!0,this.mousemove(t))}mousemove(t){let e=!1;return this.res=this.testZone(t),-1!==this.res?(this.cursor("pointer"),e=this.modes(this.isDown?3:2,this.res)):e=this.reset(),e}modes(t=1,e=-1){let i,s,n=this.lng,r=!1;for(;n--;)s=t,i=!!this.isSelectable&&this.values[n]===this.value,n===e?i&&2===s&&(s=3):(s=1,i&&(s=4)),r=this.mode(s,n);return r}mode(t,e){let i=!1,s=this.colors,n=this.s,r=e+2;if(this.stat[e]!==t){switch(this.stat[e]=t,t){case 1:n[r].color=s.text,n[r].background=s.button;break;case 2:n[r].color=s.textOver,n[r].background=s.overoff;break;case 3:n[r].color=s.textOver,n[r].background=s.over;break;case 4:n[r].color=s.textSelect,n[r].background=s.select}i=!0}return i}reset(){return this.res=-1,this.cursor(),this.modes()}label(t,e){e=e||2,this.c[e].textContent=t}switchValues(t,e){this.c[t+2].innerHTML=this.values[t]=e}icon(t,e=0,i=2){return this.s[i].padding=e+"px 0px",this.c[i].innerHTML=t,this}rSize(){super.rSize();let t=this.s,e=this.sb,i=this.sa,s=this.lng,n=this.colors.sx,r=(e-n*(s-1))/s;for(this.bw&&(r=this.bw<r?this.bw:r,i=.5*(this.w-(r*s+n*(s-1))));s--;)this.tmp[s]=[i+r*s+n*s,r],this.tmp[s][2]=this.tmp[s][0]+this.tmp[s][1],t[s+2].left=this.tmp[s][0]+"px",t[s+2].width=this.tmp[s][1]+"px"}}class v extends f{constructor(t={}){super(t),this.isCyclic=t.cyclic||!1,this.model=t.stype||0,void 0!==t.mode&&(this.model=t.mode),this.autoWidth=!1,this.minw=this.w,this.diam=t.diam||this.w,this.setTypeNumber(t),this.twoPi=u.TwoPI,this.pi90=u.pi90,this.offset=new p,this.h=t.h||this.w+10,this.c[0].style.width=this.w+"px",this.c[0].style.display="block",void 0!==this.c[1]&&(this.c[1].style.width="100%",this.c[1].style.justifyContent="center",this.top=10,this.h+=10),this.percent=0,this.cmode=0;let e=this.colors;this.c[2]=this.dom("div",this.css.txt+"justify-content:center; top:"+(this.h-20)+"px; width:100%; color:"+e.text),this.c[3]=this.getCircular(),this.setSvg(this.c[3],"stroke",e.back,0),this.setSvg(this.c[3],"d",this.makePath(),1),this.setSvg(this.c[3],"stroke",e.text,1),this.setSvg(this.c[3],"viewBox","0 0 "+this.diam+" "+this.diam),this.setCss(this.c[3],{width:this.diam,height:this.diam,left:0,top:this.top}),this.init(),this.update()}mode(t){if(this.cmode===t)return!1;let e,i=this.colors;switch(t){case 0:this.s[2].color=i.text,this.setSvg(this.c[3],"stroke",i.back,0),e=this.model>0?u.pack(u.lerpColor(u.unpack(u.ColorLuma(i.text,-.75)),u.unpack(i.text),this.percent)):i.text,this.setSvg(this.c[3],"stroke",e,1);break;case 1:this.s[2].color=i.textOver,this.setSvg(this.c[3],"stroke",i.backoff,0),e=this.model>0?u.pack(u.lerpColor(u.unpack(u.ColorLuma(i.text,-.75)),u.unpack(i.text),this.percent)):i.textOver,this.setSvg(this.c[3],"stroke",e,1)}return this.cmode=t,!0}reset(){this.isDown=!1}testZone(t){let e=this.local;return-1===e.x&&-1===e.y?"":e.y<=this.c[1].offsetHeight?"title":e.y>this.h-this.c[2].offsetHeight?"text":"circular"}mouseup(t){return this.isDown=!1,this.sendEnd(),this.mode(0)}mousedown(t){return this.isDown=!0,this.old=this.value,this.oldr=null,this.mousemove(t),this.mode(1)}mousemove(t){if(!this.isDown)return;let e=this.offset;if(e.x=.5*this.w-(t.clientX-this.zone.x),e.y=.5*this.diam-(t.clientY-this.zone.y-this.ytop),this.r=e.angle()-this.pi90,this.r=(this.r%this.twoPi+this.twoPi)%this.twoPi,null!==this.oldr){let t=this.r-this.oldr;this.r=Math.abs(t)>Math.PI?this.oldr:this.r,t>6&&(this.r=0),t<-6&&(this.r=this.twoPi)}let i=1/this.twoPi,s=this.r*i,n=this.range*s+this.min-this.old;(n>=this.step||n<=this.step)&&(n=~~(n/this.step),this.value=this.numValue(this.old+n*this.step),this.update(!0),this.old=this.value,this.oldr=this.r)}wheel(t){if("circular"===this.testZone(t)){let e=this.value-this.step*t.delta;return e>this.max?e=this.isCyclic?this.min:this.max:e<this.min&&(e=this.isCyclic?this.max:this.min),this.setValue(e),this.old=e,this.update(!0),!0}return!1}makePath(){let t=this.percent*this.twoPi-.001,e=40+40*Math.sin(t)+24,i=40-40*Math.cos(t)+24;return"M 64,24 A 40,40 0 "+(t>Math.PI?1:0)+" 1 "+e+","+i}update(t){if(this.c[2].textContent=this.value,this.percent=(this.value-this.min)/this.range,this.setSvg(this.c[3],"d",this.makePath(),1),this.model>0){let t=this.colors,e=u.pack(u.lerpColor(u.unpack(u.ColorLuma(t.text,-.75)),u.unpack(t.text),this.percent));this.setSvg(this.c[3],"stroke",e,1)}t&&this.send()}}class y extends f{constructor(t={}){super(t),this.ctype=t.ctype||"hex",this.wfixe=256,this.cw=this.sb>256?256:this.sb,null!=t.cw&&(this.cw=t.cw),this.side=t.side||"down",this.up="down"===this.side?0:1,this.baseH=this.h,this.offset=new p,this.decal=new p,this.pp=new p;let e=this.colors;this.c[2]=this.dom("div",`${this.css.txt} ${this.css.middle} top:1px; height:${this.h-2}px; border-radius:${this.radius}px; text-shadow:none; border:${e.borderSize}px solid ${e.border};`),this.c[0].style.display="block",this.c[3]=this.getColorRing(),this.c[3].style.visibility="hidden",this.hsl=null,this.value="#ffffff",void 0!==t.value&&(t.value.isColor?this.value="#"+t.value.getHexString():t.value instanceof Array?this.value=u.rgbToHex(t.value):isNaN(t.value)?this.value=t.value:this.value=u.hexToHtml(t.value)),this.bcolor=null,this.isDown=!1,this.fistDown=!1,this.notext=t.notext||!1,this.tr=98,this.tsl=Math.sqrt(3)*this.tr,this.hue=0,this.d=256,this.init(),this.setColor(this.value),void 0!==t.open&&this.open()}testZone(t,e){let i=this.local;return-1===i.x&&-1===i.y?"":this.up&&this.isOpen?i.y>this.wfixe?"title":"color":i.y<this.baseH+2?"title":this.isOpen?"color":void 0}mouseup(t){this.isDown=!1,this.d=256}mousedown(t){let e=this.testZone(t.clientX,t.clientY);if("title"===e)return this.isOpen?this.close():this.open(),!0;"color"===e&&(this.isDown=!0,this.fistDown=!0,this.mousemove(t))}mousemove(t){let e,i,s,n,r,o,a,l,h,c=this.testZone(t.clientX,t.clientY),d=u;if("title"===c&&this.cursor("pointer"),"color"===c&&(e=this.offset,e.x=t.clientX-(this.zone.x+this.decal.x+this.mid),e.y=t.clientY-(this.zone.y+this.decal.y+this.mid)-this.ytop,i=e.length()*this.ratio,h=e.angle(),h<0&&(h+=2*d.PI),i<128?this.cursor("crosshair"):this.isDown||this.cursor(),this.isDown&&(this.fistDown&&(this.d=i,this.fistDown=!1),this.d<128)))if(this.d>this.tr)s=(h+d.pi90)/d.TwoPI,this.hue=(s+1)%1,this.setHSL([(s+1)%1,this.hsl[1],this.hsl[2]]);else{a=e.x*this.ratio,l=e.y*this.ratio;let t=this.hue*d.TwoPI+d.PI;t<0&&(t+=2*d.PI),o=Math.atan2(-l,a),o<0&&(o+=2*d.PI);let i=(o+d.pi90+d.TwoPI+t)%d.TwoPI,s=i%(2/3*d.PI)-d.pi60,h=.5*this.tr,c=Math.tan(s)*h,u=Math.sqrt(a*a+l*l),p=Math.sqrt(h*h+c*c);if(u>p){let e=Math.tan(s)*u,n=Math.atan(e/p);n>d.pi60?n=d.pi60:n<-d.pi60&&(n=-d.pi60),o+=n-s,i=(o+d.pi90+d.TwoPI+t)%d.TwoPI,s=i%(2/3*d.PI)-d.pi60,c=Math.tan(s)*h,u=p=Math.sqrt(h*h+c*c)}r=Math.sin(i)*u/this.tsl+.5;let f=1-2*Math.abs(r-.5);n=(Math.cos(i)*u+this.tr/2)/(1.5*this.tr)/f,n=d.clamp(n,0,1),this.setHSL([this.hsl[0],n,r])}}setHeight(){this.h=this.isOpen?this.wfixe+this.baseH+5:this.baseH,this.s[0].height=this.h+"px",this.zone.h=this.h}parentHeight(t){null!==this.group?this.group.calc(t):this.isUI&&this.main.calc(t)}open(){super.open(),this.setHeight(),this.up&&(this.zone.y-=this.wfixe+5);let t=this.h-this.baseH;this.s[3].visibility="visible",this.parentHeight(t)}close(){super.close(),this.up&&(this.zone.y+=this.wfixe+5);let t=this.h-this.baseH;this.setHeight(),this.s[3].visibility="hidden",this.parentHeight(-t)}update(t){let e=u.rgbToHex(u.hslToRgb([this.hsl[0],1,.5]));this.moveMarkers(),this.value=this.bcolor,this.setSvg(this.c[3],"fill",e,2,0),this.s[2].background=this.bcolor,this.notext||(this.c[2].textContent=u.htmlToHex(this.bcolor)),this.invert=u.findDeepInver(this.rgb),this.s[2].color=this.invert?"#fff":"#000",t&&("array"===this.ctype&&this.send(this.rgb),"rgb"===this.ctype&&this.send(u.htmlRgb(this.rgb)),"hex"===this.ctype&&this.send(u.htmlToHex(this.value)),"html"===this.ctype&&this.send())}setValue(t){t instanceof Array?this.value=u.rgbToHex(t):isNaN(t)?this.value=t:this.value=u.hexToHtml(t),this.setColor(this.value),this.update()}setColor(t){let e=u.unpack(t);return this.bcolor!==t&&e&&(this.bcolor=t,this.rgb=e,this.hsl=u.rgbToHsl(this.rgb),this.hue=this.hsl[0],this.update()),this}setHSL(t){return this.hsl=t,this.rgb=u.hslToRgb(t),this.bcolor=u.rgbToHex(this.rgb),this.update(!0),this}moveMarkers(){let t=this.pp,e=u;this.invert;let i=this.hsl[0]*e.TwoPI,s=2/3*e.PI,n=this.tr,r=this.hsl[0],o=this.hsl[1],a=this.hsl[2],l=(i-e.pi90)*e.todeg;r=-i+e.pi90;let h=Math.cos(r)*n,c=-Math.sin(r)*n,d=Math.cos(r-s)*n,p=-Math.sin(r-s)*n,f=Math.cos(r+s)*n,m=-Math.sin(r+s)*n,g=(d+f)/2,v=(p+m)/2;i=(1-2*Math.abs(a-.5))*o;let y=d+(f-d)*a+(h-g)*i,b=p+(m-p)*a+(c-v)*i;t.set(y,b).addScalar(128),this.setSvg(this.c[3],"transform","rotate("+l+" )",2),this.setSvg(this.c[3],"cx",t.x,3),this.setSvg(this.c[3],"cy",t.y,3),this.setSvg(this.c[3],"stroke",this.invert?"#fff":"#000",2,3),this.setSvg(this.c[3],"stroke",this.invert?"#fff":"#000",3),this.setSvg(this.c[3],"fill",this.bcolor,3)}rSize(){super.rSize();let t=this.s;t[2].width=this.sb+"px",t[2].left=this.sa+"px",this.cw=this.sb>256?256:this.sb,this.rSizeColor(this.cw),this.decal.x=Math.floor(.5*(this.w-this.wfixe))}rSizeColor(t){if(t===this.wfixe)return;this.wfixe=t;let e=this.s;this.decal.y="up"===this.side?2:this.baseH+2,this.mid=Math.floor(.5*this.wfixe),this.setSvg(this.c[3],"viewBox","0 0 "+this.wfixe+" "+this.wfixe),e[3].width=this.wfixe+"px",e[3].height=this.wfixe+"px",e[3].top=this.decal.y+"px",this.ratio=256/this.wfixe,this.square=1/(this.wfixe/256*60),this.setHeight()}}class b extends f{constructor(t={}){super(t),this.round=Math.round,this.baseH=this.h,this.hplus=t.hplus||50,this.res=t.res||40,this.l=1,this.precision=t.precision||0,this.custom=t.custom||!1,this.names=t.names||["FPS","MS"];let e=t.cc||["220,220,220","255,255,0"];this.adding=t.adding||!1,this.range=t.range||[165,100,100],this.alpha=t.alpha||.25,this.values=[],this.points=[],this.textDisplay=[],this.custom||(this.now=h.getTime(),this.startTime=0,this.prevTime=0,this.frames=0,this.ms=0,this.fps=0,this.mem=0,this.mm=0,this.isMem=!(!self.performance||!self.performance.memory),this.isMem&&(this.names.push("MEM"),e.push("0,255,255")),this.txt=t.name||"Fps");let i=Math.floor(.5*this.h)-3;const s=this.colors;this.c[1].textContent=this.txt,this.c[0].style.cursor="pointer",this.c[0].style.pointerEvents="auto";let n="display:none; left:10px; top:"+this.h+"px; height:"+(this.hplus-8)+"px; box-sizing:border-box; background: rgba(0, 0, 0, 0.2); border:1px solid "+s.border+";";0!==this.radius&&(n+="border-radius:"+this.radius+"px;"),this.c[2]=this.dom("path",this.css.basic+n,{}),this.c[2].setAttribute("viewBox","0 0 "+this.res+" 50"),this.c[2].setAttribute("height","100%"),this.c[2].setAttribute("width","100%"),this.c[2].setAttribute("preserveAspectRatio","none"),this.c[3]=this.dom("path",this.css.basic+"position:absolute; width:6px; height:6px; left:0; top:"+i+"px;",{d:this.svgs.g1,fill:s.text,stroke:"none"}),this.c[4]=this.dom("div",this.css.txt+"position:absolute; left:10px; top:"+(this.h+2)+"px; display:none; width:100%; text-align:center;"),t.bottomLine&&(this.c[4]=this.dom("div",this.css.basic+"width:100%; bottom:0px; height:1px; background: rgba(255, 255, 255, 0.2);")),this.isShow=!1;let r=this.s;r[1].lineHeight=this.h-4,r[1].color=s.text,0!==this.radius&&(r[0].borderRadius=this.radius+"px"),"none"!==this.colors.gborder&&(r[0].border="1px solid "+s.gborder);let o=0;for(o=0;o<this.names.length;o++){let t=[],i=this.res+1;for(;i--;)t.push(50);this.range[o]=1/this.range[o]*49,this.points.push(t),this.values.push(0),this.textDisplay.push("<span style='color:rgb("+e[o]+")'> "+this.names[o]+" ")}for(o=this.names.length;o--;)this.dom("path",null,{fill:"rgba("+e[o]+","+this.alpha+")","stroke-width":1,stroke:"rgba("+e[o]+",1)","vector-effect":"non-scaling-stroke"},this.c[2]);this.init()}mousedown(t){this.isShow?this.close():this.open()}tick(t){this.values=t,this.isShow&&(this.drawGraph(),this.upText())}makePath(t){let e="";e+="M -1 50";for(let i=0;i<this.res+1;i++)e+=" L "+i+" "+t[i];return e+=" L "+(this.res+1)+" 50",e}upText(t){let e=t||this.values,i="";for(let t=0,s=this.names.length;t<s;t++)i+=this.textDisplay[t]+e[t].toFixed(this.precision)+"</span>";this.c[4].innerHTML=i}drawGraph(){let t,e=this.c[2],i=this.names.length,s=0,n=0;for(;i--;)t=this.adding?(this.values[n]+s)*this.range[n]:this.values[n]*this.range[n],this.points[n].shift(),this.points[n].push(50-t),this.setSvg(e,"d",this.makePath(this.points[n]),i+1),s+=this.values[n],n++}open(){super.open(),this.h=this.hplus+this.baseH,this.setSvg(this.c[3],"d",this.svgs.g2),null!==this.group?this.group.calc(this.hplus):this.isUI&&this.main.calc(this.hplus),this.s[0].height=this.h+"px",this.s[2].display="block",this.s[4].display="block",this.isShow=!0,this.custom||h.addListen(this)}close(){super.close(),this.h=this.baseH,this.setSvg(this.c[3],"d",this.svgs.g1),null!==this.group?this.group.calc(-this.hplus):this.isUI&&this.main.calc(-this.hplus),this.s[0].height=this.h+"px",this.s[2].display="none",this.s[4].display="none",this.isShow=!1,this.custom||h.removeListen(this),this.c[4].innerHTML=""}begin(){this.startTime=this.now()}end(){let t=this.now();if(this.ms=t-this.startTime,this.frames++,t>this.prevTime+1e3&&(this.fps=this.round(1e3*this.frames/(t-this.prevTime)),this.prevTime=t,this.frames=0,this.isMem)){let t=performance.memory.usedJSHeapSize,e=performance.memory.jsHeapSizeLimit;this.mem=this.round(954e-9*t),this.mm=t/e}return this.values=[this.fps,this.ms,this.mm],this.drawGraph(),this.upText([this.fps,this.ms,this.mem]),t}listening(){this.custom||(this.startTime=this.end())}rSize(){let t=this.s,e=this.w;t[3].left=this.sa+this.sb-6+"px",t[0].width=e+"px",t[1].width=e+"px",t[2].left="10px",t[2].width=e-20+"px",t[4].width=e-20+"px"}}class x extends f{constructor(t={}){super(t),this.value=void 0!==t.value?t.value:[0,0,0],this.lng=this.value.length,this.precision=void 0!==t.precision?t.precision:2,this.multiplicator=t.multiplicator||1,this.neg=t.neg||!1,this.line=void 0===t.line||t.line,this.autoWidth=void 0===t.autoWidth||t.autoWidth,this.isNumber=!1,this.isDown=!1,this.h=t.h||138,this.rh=this.h-10,this.top=0,this.c[0].style.width=this.w+"px",void 0!==this.c[1]&&(this.c[1].style.width=this.w+"px",this.autoWidth||(this.c[1].style.width="100%",this.c[1].style.justifyContent="center"),this.top=10,this.h+=10),this.gh=this.rh-28,this.gw=this.w-28,this.c[2]=this.dom("div",this.css.txt+"display:block; text-align:center; padding:0px 0px; top:"+(this.h-20)+"px; left:14px; width:"+this.gw+"px;  color:"+this.colors.text),this.c[2].innerHTML=this.valueToHtml();let e=this.dom("svg",this.css.basic,{viewBox:"0 0 "+this.w+" "+this.rh,width:this.w,height:this.rh,preserveAspectRatio:"none"});this.setCss(e,{width:this.w,height:this.rh,left:0,top:this.top}),this.dom("path","",{d:"",stroke:this.colors.text,"stroke-width":2,fill:"none","stroke-linecap":"butt"},e),this.dom("rect","",{x:10,y:10,width:this.gw+8,height:this.gh+8,stroke:"rgba(0,0,0,0.3)","stroke-width":1,fill:"none"},e),this.iw=(this.gw-4*(this.lng-1))/this.lng;let i=[];this.cMode=[],this.v=[];for(let t=0;t<this.lng;t++)i[t]=[14+t*this.iw+4*t,this.iw],i[t][2]=i[t][0]+i[t][1],this.cMode[t]=0,this.neg?this.v[t]=.5*(1+this.value[t]/this.multiplicator):this.v[t]=this.value[t]/this.multiplicator,this.dom("rect","",{x:i[t][0],y:14,width:i[t][1],height:1,fill:this.colors.text,"fill-opacity":.3},e);this.tmp=i,this.c[3]=e,this.init(),void 0!==this.c[1]&&(this.c[1].style.top="0px",this.c[1].style.height="20px",this.s[1].lineHeight="15px"),this.update(!1)}setValue(t){this.value=t,this.lng=this.value.length;for(var e=0;e<this.lng;e++)this.neg?this.v[e]=.5*(1+t[e]/this.multiplicator):this.v[e]=t[e]/this.multiplicator;this.update()}valueToHtml(){let t=this.lng,e=0,i='<table style="width:100%;"><tr>',s="width:"+100/this.lng+"%;";for(;t--;)e===this.lng-1?i+="<td style="+s+">"+this.value[e]+"</td></tr></table>":i+="<td style="+s+">"+this.value[e]+"</td>",e++;return i}updateSVG(){this.line&&this.setSvg(this.c[3],"d",this.makePath(),0);for(let t=0;t<this.lng;t++)this.setSvg(this.c[3],"height",this.v[t]*this.gh,t+2),this.setSvg(this.c[3],"y",this.gh-this.v[t]*this.gh+14,t+2),this.neg?this.value[t]=1*((2*this.v[t]-1)*this.multiplicator).toFixed(this.precision):this.value[t]=1*(this.v[t]*this.multiplicator).toFixed(this.precision);this.c[2].innerHTML=this.valueToHtml()}testZone(t){let e=this.local;if(-1===e.x&&-1===e.y)return"";let i=this.lng,s=this.tmp;if(e.y>this.top&&e.y<this.h-20)for(;i--;)if(e.x>s[i][0]&&e.x<s[i][2])return i;return""}mode(t,e){if(t===this.cMode[e])return!1;let i;switch(t){case 0:i=.3;break;case 1:i=.6;break;case 2:i=1}return this.reset(),this.setSvg(this.c[3],"fill-opacity",i,e+2),this.cMode[e]=t,!0}reset(){let t=!1,e=this.lng;for(;e--;)0!==this.cMode[e]&&(this.cMode[e]=0,this.setSvg(this.c[3],"fill-opacity",.3,e+2),t=!0);return t}mouseup(t){if(this.isDown=!1,-1!==this.current)return this.reset()}mousedown(t){return this.isDown=!0,this.mousemove(t)}mousemove(t){let e=!1,i=this.testZone(t);return""===i?e=this.reset():(e=this.mode(this.isDown?2:1,i),this.isDown&&(this.v[i]=this.clamp(1-(t.clientY-this.zone.y-this.ytop-10)/this.gh,0,1),this.update(!0))),e}update(t){this.updateSVG(),t&&this.send()}makePath(){let t,e,i,s,n,r,o="";for(let a=0;a<this.lng;a++)t=this.gh-this.v[a]*this.gh+14,e=14+a*this.iw+4*a,s=e+.5*this.iw,i=e+this.iw,o+=0===a?"M "+e+" "+t+" T "+s+" "+t:" C "+n+" "+r+","+e+" "+t+","+s+" "+t,a===this.lng-1&&(o+=" T "+i+" "+t),n=i,r=t;return o}rSize(){super.rSize();let t=this.s;void 0!==this.c[1]&&(t[1].width=this.w+"px"),t[3].width=this.w+"px";let e=this.w-28,i=(e-4*(this.lng-1))/this.lng,s=[];t[2].width=e+"px";for(let t=0;t<this.lng;t++)s[t]=[14+t*i+4*t,i],s[t][2]=s[t][0]+s[t][1];this.tmp=s}}class O extends f{constructor(t={}){t.isSpace=!0,t.margin=0,t.h||(t.h=10),super(t),this.init()}}class w extends f{constructor(t={}){super(t),this.isGroup=!0,this.ADD=t.add,this.autoHeight=!0,this.uis=[],this.current=-1,this.proto=null,this.isEmpty=!0,this.decal=t.group?8:0,this.baseH=this.h,this.spaceY=new O({h:this.margin});let e=Math.floor(.5*this.h)-3;const i=this.colors;this.useFlex=!0;let s=this.useFlex?"display:flex; flex-flow: row wrap;":"";this.c[2]=this.dom("div",this.css.basic+s+"width:100%; left:0;  overflow:hidden; top:"+this.h+"px"),this.c[3]=this.dom("path",this.css.basic+"position:absolute; width:6px; height:6px; left:0; top:"+e+"px;",{d:this.svgs.g1,fill:i.text,stroke:"none"});let n=0===this.mtop?this.margin:this.mtop;this.c[4]=this.dom("div",this.css.basic+"width:100%; left:0; height:"+(n+1)+"px; top:"+(this.h-1)+"px; background:none;"),this.s,this.c[1].name="group",this.c[1].style.color=i.text,this.init(),this.setBG(t.bg),t.open&&this.open()}setBG(t){const e=this.colors,i=this.s;void 0!==t&&(e.groups=t),"none"===e.groups&&(e.groups=e.background),e.background="none",i[0].background="none",i[1].background=e.groups,i[2].background=e.groups,"none"!==e.gborder&&(i[1].border=e.borderSize+"px solid "+e.gborder),0!==this.radius&&(i[1].borderRadius=this.radius+"px",i[2].borderRadius=this.radius+"px")}testZone(t){let e=this.local;if(-1===e.x&&-1===e.y)return"";let i="";return e.y<this.baseH+this.margin?i="title":this.isOpen&&(i="content"),i}clearTarget(){return-1!==this.current&&(this.proto.s&&(this.proto.uiout(),this.proto.reset()),this.proto=null,this.current=-1,this.cursor(),!0)}reset(){this.clearTarget()}handleEvent(t){let e=t.type,i=!1,s=!1,n=this.testZone(t);if(n){switch(n){case"content":h.isMobile&&"mousedown"===e&&this.getNext(t,i),this.proto&&(s=this.proto.handleEvent(t)),h.lock||this.getNext(t,i);break;case"title":this.cursor("pointer"),"mousedown"===e&&(this.isOpen?this.close():this.open())}return this.isDown&&(i=!0),s&&(i=!0),i}}getNext(t,e){let i=h.findTarget(this.uis,t);i!==this.current&&(this.clearTarget(),this.current=i),-1!==i&&(this.proto=this.uis[this.current],this.proto.uiover())}add(){let t=arguments;"object"==typeof t[1]?(t[1].isUI=this.isUI,t[1].target=this.c[2],t[1].main=this.main,t[1].group=this):"string"==typeof arguments[1]&&(void 0===t[2]?[].push.call(t,{isUI:!0,target:this.c[2],main:this.main}):(t[2].isUI=!0,t[2].target=this.c[2],t[2].main=this.main,t[2].group=this));let e=this.ADD.apply(this,t);return e.isGroup&&(e.dx=8),h.forceZone=!0,this.uis.push(e),this.isEmpty=!1,e}remove(t){t.dispose&&t.dispose()}dispose(){this.clear(),this.isUI&&this.main.calc(),super.dispose()}clear(){this.empty()}empty(){this.close();let t,e=this.uis.length;for(;e--;)t=this.uis.pop(),this.c[2].removeChild(t.c[0]),t.clear(!0);this.isEmpty=!0,this.h=this.baseH}clearOne(t){let e=this.uis.indexOf(t);-1!==e&&(this.calc(-(this.uis[e].h+this.margin)),this.c[2].removeChild(this.uis[e].c[0]),this.uis.splice(e,1),0===this.uis.length&&(this.isEmpty=!0,this.close()))}open(){super.open(),this.setSvg(this.c[3],"d",this.svgs.g2),this.rSizeContent();const t=this.s,e=this.colors;t[2].top=this.h+this.mtop+"px",t[4].background=e.groups,this.radius&&(t[1].borderRadius="0px",t[2].borderRadius="0px",t[1].borderTopLeftRadius=this.radius+"px",t[1].borderTopRightRadius=this.radius+"px",t[2].borderBottomLeftRadius=this.radius+"px",t[2].borderBottomRightRadius=this.radius+"px"),"none"!==e.gborder&&(t[4].borderLeft=e.borderSize+"px solid "+e.gborder,t[4].borderRight=e.borderSize+"px solid "+e.gborder,t[2].border=e.borderSize+"px solid "+e.gborder,t[2].borderTop="none",t[1].borderBottom=e.borderSize+"px solid rgba(0,0,0,0)"),this.parentHeight()}close(){super.close(),this.setSvg(this.c[3],"d",this.svgs.g1),this.h=this.baseH;const t=this.s,e=this.colors;t[0].height=this.h+"px",t[2].top=this.h+this.mtop+"px",t[4].background="none","none"!==e.gborder&&(t[4].border="none",t[2].border="none",t[1].border=e.borderSize+"px solid "+e.gborder),this.radius&&(t[1].borderRadius=this.radius+"px"),this.parentHeight()}calcUis(){!this.isOpen||this.isEmpty?this.h=this.baseH:this.h=h.calcUis([...this.uis,this.spaceY],this.zone,this.zone.y+this.baseH+this.margin,!0)+this.baseH,this.s[0].height=this.h+"px",this.s[2].height=this.h-this.baseH+"px"}parentHeight(t){null!==this.group?this.group.calc(t):this.isUI&&this.main.calc(t)}calc(t){this.isOpen&&(this.isUI?this.main.calc():this.calcUis(),this.s[0].height=this.h+"px",this.s[2].height=this.h+"px")}rSizeContent(){let t=this.uis.length;for(;t--;)this.uis[t].setSize(this.w),this.uis[t].rSize()}rSize(){super.rSize();let t=this.s;this.w=this.w-this.decal,t[3].left=this.sa+this.sb-6+"px",t[1].width=this.w+"px",t[2].width=this.w+"px",t[1].left=this.decal+"px",t[2].left=this.decal+"px",this.isOpen&&this.rSizeContent()}}class S extends f{constructor(t={}){super(t),this.autoWidth=!1,this.value=[0,0],this.minw=this.w,this.diam=t.diam||this.w,this.joyType="analogique",this.model=void 0!==t.mode?t.mode:0,this.precision=t.precision||2,this.multiplicator=t.multiplicator||1,this.pos=new p,this.tmp=new p,this.interval=null,this.c[0].style.display="block",this.haveText=void 0===t.text||t.text,this.distance=.5*this.diam*.25,this.h=t.h||this.w+(this.haveText?10:0),this.c[0].style.width=this.w+"px",void 0!==this.c[1]&&(this.c[1].style.width="100%",this.c[1].style.justifyContent="center",this.top=10,this.h+=10);let e=this.colors;this.c[2]=this.dom("div",this.css.txt+"justify-content:center; top:"+(this.h-20)+"px; width:100%; color:"+e.text),this.c[2].textContent=this.haveText?this.value:"",this.c[3]=this.getJoystick(this.model),this.setSvg(this.c[3],"viewBox","0 0 "+this.diam+" "+this.diam),this.setCss(this.c[3],{width:this.diam,height:this.diam,left:0,top:this.top}),this.mode(0),this.ratio=128/this.w,this.init(),this.update(!1)}mode(t){let e=this.colors;switch(t){case 0:0===this.model?(this.setSvg(this.c[3],"fill","url(#gradIn)",4),this.setSvg(this.c[3],"stroke","#000",4)):(this.setSvg(this.c[3],"stroke",e.joyOut,2),this.setSvg(this.c[3],"stroke",e.joyOut,4),this.setSvg(this.c[3],"fill","none",4));break;case 1:0===this.model?(this.setSvg(this.c[3],"fill","url(#gradIn2)",4),this.setSvg(this.c[3],"stroke","rgba(0,0,0,0)",4)):(this.setSvg(this.c[3],"stroke",e.joyOver,2),this.setSvg(this.c[3],"stroke",e.joySelect,4),this.setSvg(this.c[3],"fill",e.joyOver,4))}}addInterval(){null!==this.interval&&this.stopInterval(),this.pos.isZero()||(this.interval=setInterval(function(){this.update()}.bind(this),10))}stopInterval(){null!==this.interval&&(clearInterval(this.interval),this.interval=null)}reset(){this.addInterval(),this.mode(0)}mouseup(t){this.addInterval(),this.isDown=!1}mousedown(t){this.isDown=!0,this.mousemove(t),this.mode(2)}mousemove(t){if(this.mode(1),this.isDown){if(this.tmp.x=.5*this.w-(t.clientX-this.zone.x),this.tmp.y=.5*this.diam-(t.clientY-this.zone.y-this.ytop),this.tmp.length()>this.distance){let t=Math.atan2(this.tmp.x,this.tmp.y);this.tmp.x=Math.sin(t)*this.distance,this.tmp.y=Math.cos(t)*this.distance}this.pos.copy(this.tmp).divideScalar(this.distance).negate(),this.update()}}setValue(t){void 0===t&&(t=[0,0]),this.pos.set(t[0]||0,t[1]||0),this.updateSVG()}update(t){void 0===t&&(t=!0),null!==this.interval&&(this.isDown||(this.pos.lerp(null,.3),this.pos.x=Math.abs(this.pos.x)<.01?0:this.pos.x,this.pos.y=Math.abs(this.pos.y)<.01?0:this.pos.y,this.isUI&&this.main.isCanvas&&this.main.draw())),this.updateSVG(),t&&this.send(),this.pos.isZero()&&this.stopInterval()}updateSVG(){let t=.5*this.diam- -this.pos.x*this.distance,e=.5*this.diam- -this.pos.y*this.distance;if(0===this.model){let i=t+5*this.pos.x+5,s=e+5*this.pos.y+10;this.setSvg(this.c[3],"cx",i*this.ratio,3),this.setSvg(this.c[3],"cy",s*this.ratio,3)}else this.setSvg(this.c[3],"cx",t*this.ratio,3),this.setSvg(this.c[3],"cy",e*this.ratio,3);this.setSvg(this.c[3],"cx",t*this.ratio,4),this.setSvg(this.c[3],"cy",e*this.ratio,4),this.value[0]=1*(this.pos.x*this.multiplicator).toFixed(this.precision),this.value[1]=1*(this.pos.y*this.multiplicator).toFixed(this.precision),this.haveText&&(this.c[2].textContent=this.value)}clear(){this.stopInterval(),super.clear()}}class k extends f{constructor(t={}){super(t),this.isCyclic=t.cyclic||!1,this.model=t.stype||0,void 0!==t.mode&&(this.model=t.mode),this.autoWidth=!1,this.setTypeNumber(t),this.minw=this.w,this.diam=t.diam||this.w,this.mPI=.8*Math.PI,this.toDeg=180/Math.PI,this.cirRange=2*this.mPI,this.offset=new p,this.h=t.h||this.w+10,this.c[0].style.width=this.w+"px",this.c[0].style.display="block",void 0!==this.c[1]&&(this.c[1].style.width="100%",this.c[1].style.justifyContent="center",this.top=10,this.h+=10),this.percent=0,this.cmode=0;let e=this.colors;this.c[2]=this.dom("div",this.css.txt+"justify-content:center; top:"+(this.h-20)+"px; width:100%; color:"+e.text),this.c[3]=this.getKnob(),this.setSvg(this.c[3],"fill",e.button,0),this.setSvg(this.c[3],"stroke",e.text,1),this.setSvg(this.c[3],"stroke",e.text,3),this.setSvg(this.c[3],"d",this.makeGrad(),3),this.setSvg(this.c[3],"viewBox","0 0 "+this.diam+" "+this.diam),this.setCss(this.c[3],{width:this.diam,height:this.diam,left:0,top:this.top}),this.model>0&&(u.dom("path","",{d:"",stroke:e.text,"stroke-width":2,fill:"none","stroke-linecap":"round"},this.c[3]),2==this.model&&(u.addSVGGlowEffect(),this.setSvg(this.c[3],"style",'filter: url("#UILGlow");',4))),this.r=0,this.init(),this.update()}mode(t){let e=this.colors;if(this.cmode===t)return!1;switch(t){case 0:this.s[2].color=e.text,this.setSvg(this.c[3],"fill",e.button,0),this.setSvg(this.c[3],"stroke",e.text,1);break;case 1:this.s[2].color=e.textOver,this.setSvg(this.c[3],"fill",e.select,0),this.setSvg(this.c[3],"stroke",e.textOver,1)}return this.cmode=t,!0}testZone(t){let e=this.local;return-1===e.x&&-1===e.y?"":e.y<=this.c[1].offsetHeight?"title":e.y>this.h-this.c[2].offsetHeight?"text":"knob"}mouseup(t){return this.isDown=!1,this.sendEnd(),this.mode(0)}mousedown(t){return this.isDown=!0,this.old=this.value,this.oldr=null,this.mousemove(t),this.mode(1)}mousemove(t){if(!this.isDown)return;let e=this.offset;e.x=.5*this.w-(t.clientX-this.zone.x),e.y=.5*this.diam-(t.clientY-this.zone.y-this.ytop),this.r=-Math.atan2(e.x,e.y),null!==this.oldr&&(this.r=Math.abs(this.r-this.oldr)>Math.PI?this.oldr:this.r),this.r=this.r>this.mPI?this.mPI:this.r,this.r=this.r<-this.mPI?-this.mPI:this.r;let i=1/this.cirRange,s=(this.r+this.mPI)*i,n=this.range*s+this.min-this.old;(n>=this.step||n<=this.step)&&(n=Math.floor(n/this.step),this.value=this.numValue(this.old+n*this.step),this.update(!0),this.old=this.value,this.oldr=this.r)}wheel(t){if("knob"===this.testZone(t)){let e=this.value-this.step*t.delta;return e>this.max?e=this.isCyclic?this.min:this.max:e<this.min&&(e=this.isCyclic?this.max:this.min),this.setValue(e),this.old=e,this.update(!0),!0}return!1}makeGrad(){let t,e,i,s,n,r,o,a="",l=Math.PI+this.mPI,h=Math.PI-this.mPI;this.step>5?(e=this.range/this.step,t=(l-h)/e):(t=(l-h)/64*2,e=32);for(let h=0;h<=e;++h)i=l-t*h,s=64+44*Math.sin(i),n=64+44*Math.cos(i),r=64+40*Math.sin(i),o=64+40*Math.cos(i),a+="M"+s+" "+n+" L"+r+" "+o+" ";return a}update(t){this.c[2].textContent=this.value,this.percent=(this.value-this.min)/this.range;let e=Math.PI+this.mPI,i=this.percent*this.cirRange-this.mPI,s=Math.sin(i),n=Math.cos(i),r=25*s+64,o=-25*n+64,a=20*s+64,l=-20*n+64;if(this.setSvg(this.c[3],"d","M "+r+" "+o+" L "+a+" "+l,1),this.model>0){let t=36*Math.sin(e)+64,r=36*Math.cos(e)+64,o=36*s+64,a=-36*n+64,l=i<=Math.PI-this.mPI?0:1;this.setSvg(this.c[3],"d","M "+t+","+r+" A 36,36 1 "+l+" 1 "+o+","+a,4);let h=u.pack(u.lerpColor(u.unpack(u.ColorLuma(this.colors.text,-.75)),u.unpack(this.colors.text),this.percent));this.setSvg(this.c[3],"stroke",h,4)}t&&this.send()}}class A extends f{constructor(t={}){super(t),this.hideCurrent=!1,this.path=t.path||"",this.format=t.format||"",this.isWithImage=""!==this.path,this.preLoadComplete=!1,this.tmpImage={},this.tmpUrl=[],this.m=void 0!==t.m?t.m:5;let e=t.align||"left",i=t.scrollSize||10;this.ss=i+1,this.sMode=0,this.tMode=0,this.listOnly=t.listOnly||!1,this.staticTop=t.staticTop||!1,this.isSelectable=this.listOnly,void 0!==t.select&&(t.selectable=t.select),void 0!==t.selectable&&(this.isSelectable=t.selectable),""===this.txt&&(this.p=0);let s=Math.floor(.5*this.h)-3,n=this.colors;if(this.c[2]=this.dom("div",this.css.basic+"top:0; display:none; border-radius:"+this.radius+"px;"),this.c[3]=this.dom("div",this.css.item+"padding:0px "+this.m+"px; margin-bottom:0px; position:absolute; justify-content:"+e+"; text-align:"+e+"; line-height:"+(this.h-4)+"px; top:1px; background:"+n.button+"; height:"+(this.h-2)+"px; border:1px solid "+n.border+"; border-radius:"+this.radius+"px;"),this.c[4]=this.dom("path",this.css.basic+"position:absolute; width:6px; height:6px; top:"+s+"px;",{d:this.svgs.g1,fill:n.text,stroke:"none"}),this.scrollerBack=this.dom("div",this.css.basic+"right:0px; width:"+i+"px; background:"+n.back+"; display:none;"),this.scroller=this.dom("div",this.css.basic+"right:"+.5*(i-.25*i)+"px; width:"+.25*i+"px; background:"+n.text+"; display:none; "),this.c[3].style.color=n.text,this.list=[],this.refObject=null,t.list)if(t.list instanceof Array)this.list=t.list;else if(t.list instanceof Object){this.refObject=t.list;for(let t in this.refObject)this.list.push(t)}this.items=[],this.prevName="",this.tmpId=0,this.baseH=this.h,this.itemHeight=t.itemHeight||this.h,this.full=t.full||!1,this.py=0,this.ww=this.sb,this.scroll=!1,this.isDown=!1,this.current=null,this.side=t.side||"down",this.up="down"===this.side?0:1,this.up?(this.c[2].style.top="auto",this.c[3].style.top="auto",this.c[4].style.top="auto",this.c[2].style.bottom=this.h-2+"px",this.c[3].style.bottom="1px",this.c[4].style.bottom=s+"px"):this.c[2].style.top=this.baseH+"px",this.listIn=this.dom("div",this.css.basic+"left:0; top:0; width:100%; background:none;"),this.listIn.name="list",this.topList=0,this.c[2].appendChild(this.listIn),this.c[2].appendChild(this.scrollerBack),this.c[2].appendChild(this.scroller),void 0!==t.value?isNaN(t.value)?this.value=t.value:this.value=this.list[t.value]:this.value=this.list[0],this.isOpenOnStart=t.open||!1,this.listOnly&&(this.baseH=5,this.c[3].style.display="none",this.c[4].style.display="none",this.c[2].style.top=this.baseH+"px",this.isOpenOnStart=!0),this.miniCanvas=t.miniCanvas||!1,this.canvasBg=t.canvasBg||"rgba(0,0,0,0)",this.imageSize=t.imageSize||[20,20],this.drag=t.drag||!1,this.dragout=t.dragout||!1,this.dragstart=t.dragstart||null,this.dragend=t.dragend||null,this.setList(this.list),this.init(),this.isWithImage&&this.preloadImage(),this.isOpenOnStart&&this.open(!0),this.baseH+=this.mtop}preloadImage(){this.preLoadComplete=!1,this.tmpImage={};for(let t=0;t<this.list.length;t++)this.tmpUrl.push(this.list[t]);this.loadOne()}nextImg(){null!==this.c&&(this.tmpUrl.shift(),0===this.tmpUrl.length?(this.preLoadComplete=!0,this.addImages()):this.loadOne())}loadOne(){let t=this,e=this.tmpUrl[0],i=document.createElement("img");i.style.cssText="position:absolute; width:"+t.imageSize[0]+"px; height:"+t.imageSize[1]+"px",i.setAttribute("src",this.path+e+this.format),i.addEventListener("load",(function(){t.imageSize[2]=i.width,t.imageSize[3]=i.height,t.tmpImage[e]=i,t.nextImg()}))}testZone(t){let e=this.local;if(-1===e.x&&-1===e.y)return"";if(this.up&&this.isOpen){if(e.y>this.h-this.baseH)return"title";if(this.scroll&&e.x>this.sa+this.sb-this.ss)return"scroll";if(e.x>this.sa)return this.testItems(e.y-this.baseH)}else{if(e.y<this.baseH+2)return"title";if(this.isOpen){if(this.scroll&&e.x>this.sa+this.sb-this.ss)return"scroll";if(e.x>this.sa)return this.testItems(e.y-this.baseH)}}return""}testItems(t){let e,i,s,n="",r=this.items,o=r.length;for(;o--;)if(e=r[o],i=e.posy+this.topList,s=e.posy+this.itemHeight+1+this.topList,t>=i&&t<=s)return n="item"+o,this.modeItem(0),this.current=e,this.modeItem(1),n;return n}modeItem(t){if(!this.current)return;this.current.select&&0===t&&(t=2);let e=this.colors;switch(t){case 0:this.current.style.background=e.back,this.current.style.color=e.text;break;case 1:this.current.style.background=e.over,this.current.style.color=e.textOver;break;case 2:this.current.style.background=e.select,this.current.style.color=e.textSelect}}unSelected(){this.current&&(this.modeItem(0),this.current=null)}selected(){this.current&&(this.resetItems(),this.modeItem(2),this.current.select=!0)}resetItems(){let t=this.items.length;for(;t--;)this.items[t].select=!1,this.items[t].style.background=this.colors.back,this.items[t].style.color=this.colors.text}hideActive(){this.hideCurrent&&(this.current&&(this.tmpId=this.current.id),this.resetHide())}resetHide(){console.log(this.tmpId);let t=this.items.length;for(;t--;)t===this.tmpId?(this.items[t].style.height="0px",this.items[t].posy=-1):(this.items[t].style.height=this.itemHeight+"px",this.items[t].posy=(this.itemHeight+1)*(t-1))}mouseup(t){this.isDown=!1}mousedown(t){let e=this.testZone(t);return!!e&&("scroll"===e?(this.isDown=!0,this.mousemove(t)):"title"===e?(this.modeTitle(2),this.listOnly||(this.hideActive(),this.isOpen?this.close():this.open())):this.current&&(this.value=this.list[this.current.id],this.isSelectable&&this.selected(),this.send(this.value),this.listOnly||(this.close(),this.setTopItem())),!0)}mousemove(t){let e=!1,i=this.testZone(t);if(!i)return e;if("title"===i)this.unSelected(),this.modeTitle(1),this.cursor("pointer");else if("scroll"===i){if(this.cursor("s-resize"),this.modeScroll(1),this.isDown){this.modeScroll(2);let e=this.zone.y+this.baseH-2;this.update(t.clientY-e-.5*this.sh)}}else this.modeTitle(0),this.modeScroll(0),this.cursor("pointer");return i!==this.prevName&&(e=!0),this.prevName=i,e}wheel(t){return"title"!==this.testZone(t)&&(this.py+=10*t.delta,this.update(this.py),!0)}reset(){this.prevName="",this.unSelected(),this.modeTitle(0),this.modeScroll(0)}modeScroll(t){if(t===this.sMode)return;let e=this.scroller.style,i=this.colors;switch(t){case 0:e.background=i.text;break;case 1:case 2:e.background=i.select}this.sMode=t}modeTitle(t){if(t===this.tMode)return;let e=this.s,i=this.colors;switch(t){case 0:e[3].color=i.text,e[3].background=i.button;break;case 1:e[3].color=i.textOver,e[3].background=i.overoff;break;case 2:e[3].color=i.textSelect,e[3].background=i.overoff}this.tMode=t}clearList(){for(;this.listIn.children.length;)this.listIn.removeChild(this.listIn.lastChild);this.items=[]}setList(t){this.clearList(),this.list=t,this.length=this.list.length;let e,i,s=this.hideCurrent?this.length-1:this.length;this.maxItem=this.full?s:5,this.maxItem=s<this.maxItem?s:this.maxItem,this.maxHeight=this.maxItem*(this.itemHeight+1)+2,this.max=s*(this.itemHeight+1)+2,this.ratio=this.maxHeight/this.max,this.sh=this.maxHeight*this.ratio,this.range=this.maxHeight-this.sh,this.c[2].style.height=this.maxHeight+"px",this.scrollerBack.style.height=this.maxHeight+"px",this.scroller.style.height=this.sh+"px",this.max>this.maxHeight&&(this.ww=this.sb-this.ss,this.scroll=!0),this.miniCanvas&&(this.tmpCanvas=document.createElement("canvas"),this.tmpCanvas.width=this.imageSize[0],this.tmpCanvas.height=this.imageSize[1],this.tmpCtx=this.tmpCanvas.getContext("2d"),this.tmpCtx.fillStyle=this.canvasBg,this.tmpCtx.fillRect(0,0,this.imageSize[0],this.imageSize[1]));for(let t=0;t<this.length;t++){if(i=this.list[t],e=this.dom("div",this.css.item+"padding:0px "+(this.m+1)+"px; width:"+this.ww+"px; height:"+this.itemHeight+"px; line-height:"+(this.itemHeight-2)+"px; color:"+this.colors.text+"; background:"+this.colors.back+";"),e.name="item"+t,e.id=t,e.select=!1,e.posy=(this.itemHeight+1)*t,this.listIn.appendChild(e),this.items.push(e),i===this.value&&(this.current=e),this.isWithImage||(e.textContent=i),this.miniCanvas){let t=new Image;t.src=this.tmpCanvas.toDataURL(),t.style.cssText="margin-right:4px;",e.appendChild(t),this.tmpImage[i]=t}this.dragout&&(e.img=this.tmpImage[i],e.style.pointerEvents="auto",e.draggable="true",e.addEventListener("dragstart",this.dragstart||function(){}),e.addEventListener("drag",this.drag||function(){}),e.addEventListener("dragleave",(function(){h.fakeUp()})),e.addEventListener("dragend",this.dragend||function(){}.bind(this)))}this.setTopItem(),this.isSelectable&&this.selected()}drawImage(t,e,i,s,n,r){this.tmpCtx.clearRect(0,0,this.imageSize[0],this.imageSize[1]),this.tmpCtx.drawImage(e,i,s,n,r,0,0,this.imageSize[0],this.imageSize[1]),this.tmpImage[t].src=this.tmpCanvas.toDataURL()}addImages(){let t=this.list.length;for(let e=0;e<t;e++)this.items[e].appendChild(this.tmpImage[this.list[e]]);this.setTopItem()}setValue(t){isNaN(t)?this.value=t:this.value=this.list[t],this.setTopItem()}setTopItem(){if(!this.staticTop){if(this.isWithImage){if(!this.preLoadComplete)return;this.c[3].children.length||(this.canvas=document.createElement("canvas"),this.canvas.width=this.imageSize[0],this.canvas.height=this.imageSize[1],this.canvas.style.cssText="margin-right:4px;",this.ctx=this.canvas.getContext("2d"),this.c[3].style.textAlign="left",this.c[3].style.justifyContent="left",this.c[3].appendChild(this.canvas)),this.tmpImage[this.value],this.ctx.drawImage(this.tmpImage[this.value],0,0,this.imageSize[2],this.imageSize[3],0,0,this.imageSize[0],this.imageSize[1])}else this.c[3].textContent=this.value;this.miniCanvas&&(this.c[3].children.length||(this.canvas=document.createElement("canvas"),this.canvas.width=this.imageSize[0],this.canvas.height=this.imageSize[1],this.canvas.style.cssText="margin-right:4px;",this.ctx=this.canvas.getContext("2d"),this.c[3].style.textAlign="left",this.c[3].style.justifyContent="left",this.c[3].appendChild(this.canvas)),this.ctx.drawImage(this.tmpImage[this.value],0,0))}}update(t){this.scroll&&(t=(t=t<0?0:t)>this.range?this.range:t,this.topList=-Math.floor(t/this.ratio),this.listIn.style.top=this.topList+"px",this.scroller.style.top=Math.floor(t)+"px",this.py=t)}parentHeight(t){null!==this.group?this.group.calc(t):this.isUI&&this.main.calc(t)}open(t){super.open(),this.update(0),this.h=this.maxHeight+this.baseH+5,this.scroll?(this.scroller.style.display="block",this.scrollerBack.style.display="block"):(this.topList=0,this.h=this.baseH+5+this.max,this.scroller.style.display="none",this.scrollerBack.style.display="none"),this.s[0].height=this.h+"px",this.s[2].display="block",this.up?(this.zone.y-=this.h-(this.baseH-10),this.setSvg(this.c[4],"d",this.svgs.g1)):this.setSvg(this.c[4],"d",this.svgs.g2),this.rSizeContent();let e=this.h-this.baseH;this.zone.h=this.h,t||this.parentHeight(e)}close(){super.close(),this.up&&(this.zone.y+=this.h-(this.baseH-10));let t=this.h-this.baseH;this.h=this.baseH,this.s[0].height=this.h+"px",this.s[2].display="none",this.setSvg(this.c[4],"d",this.svgs.g1),this.zone.h=this.h,this.parentHeight(-t)}text(t){this.c[3].textContent=t}rSizeContent(){let t=this.length;for(;t--;)this.listIn.children[t].style.width=this.ww+"px"}rSize(){super.rSize();let t=this.s,e=this.sb,i=this.sa;void 0!==t[2]&&(t[2].width=e+"px",t[2].left=i+"px",t[3].width=e+"px",t[3].left=i+"px",t[4].left=i+e-15+"px",this.ww=e,this.max>this.maxHeight&&(this.ww=e-this.ss),this.isOpen&&this.rSizeContent())}}class T extends f{constructor(t={}){super(t),this.setTypeNumber(t),this.allway=t.allway||!1,this.isDown=!1,this.value=[0],this.multy=1,this.invmulty=1,this.isSingle=!0,this.isAngle=!1,this.isVector=!1,t.isAngle&&(this.isAngle=!0,this.multy=u.torad,this.invmulty=u.todeg),this.isDrag=t.drag||!1,void 0!==t.value&&(isNaN(t.value)?t.value instanceof Array?(this.value=t.value,this.isSingle=!1):t.value instanceof Object&&(this.value=[],void 0!==t.value.x&&(this.value[0]=t.value.x),void 0!==t.value.y&&(this.value[1]=t.value.y),void 0!==t.value.z&&(this.value[2]=t.value.z),void 0!==t.value.w&&(this.value[3]=t.value.w),this.isSingle=!1,this.isVector=!0):this.value=[t.value]),this.lng=this.value.length,this.tmp=[],this.current=-1,this.prev={x:0,y:0,d:0,v:0};let e=this.colors;this.c[2]=this.dom("div",this.css.basic+" background:"+e.select+"; top:4px; width:0px; height:"+(this.h-8)+"px;"),this.cMode=[];let i=this.lng;for(;i--;)this.isAngle&&(this.value[i]=(180*this.value[i]/Math.PI).toFixed(this.precision)),this.c[3+i]=this.dom("div",this.css.txtselect+"top:1px; height:"+(this.h-2)+"px; color:"+e.text+"; background:"+e.back+"; borderColor:"+e.border+"; border-radius:"+this.radius+"px;"),t.center&&(this.c[2+i].style.textAlign="center"),this.c[3+i].textContent=this.value[i],this.c[3+i].style.color=this.colors.text,this.c[3+i].isNum=!0,this.cMode[i]=0;this.selectId=3+this.lng,this.c[this.selectId]=this.dom("div",this.css.txtselect+"position:absolute; top:2px; height:"+(this.h-4)+"px; padding:0px 0px; width:0px; color:"+e.textSelect+"; background:"+e.select+"; border:none; border-radius:0px;"),this.cursorId=4+this.lng,this.c[this.cursorId]=this.dom("div",this.css.basic+"top:2px; height:"+(this.h-4)+"px; width:0px; background:"+e.text+";"),this.init()}testZone(t){let e=this.local;if(-1===e.x&&-1===e.y)return"";let i=this.lng,s=this.tmp;for(;i--;)if(e.x>s[i][0]&&e.x<s[i][2])return i;return""}mousedown(t){let e=this.testZone(t);return!this.isDown&&(this.isDown=!0,""!==e&&(this.current=e,this.prev={x:t.clientX,y:t.clientY,d:0,v:this.isSingle?parseFloat(this.value):parseFloat(this.value[this.current])},this.setInput(this.c[3+this.current])),this.mousemove(t))}mouseup(t){return!!this.isDown&&(this.isDown=!1,this.prev={x:0,y:0,d:0,v:0},this.mousemove(t))}mousemove(t){let e=!1,i=0;if(""===this.testZone(t)?this.cursor():this.isDrag?this.cursor(-1!==this.current?"move":"pointer"):this.cursor("text"),!this.isDrag)return this.isDown&&(i=t.clientX-this.zone.x-3),-1!==this.current&&(i-=this.tmp[this.current][0]),this.upInput(i,this.isDown);if(-1!==this.current){this.prev.d+=t.clientX-this.prev.x-(t.clientY-this.prev.y);let i=this.prev.v+this.prev.d*this.step;this.value[this.current]=this.numValue(i),this.c[3+this.current].textContent=this.value[this.current],this.validate(),this.prev.x=t.clientX,this.prev.y=t.clientY,e=!0}return e}reset(){return!1}setValue(t){this.isVector?(void 0!==t.x&&(this.value[0]=t.x),void 0!==t.y&&(this.value[1]=t.y),void 0!==t.z&&(this.value[2]=t.z),void 0!==t.w&&(this.value[3]=t.w)):this.value=this.isSingle?[t]:t,this.update()}sameStr(t){let e=this.value.length;for(;e--;)this.c[3+e].textContent=t}update(t){let e=this.value.length;for(;e--;)this.value[e]=this.numValue(this.value[e]*this.invmulty),this.c[3+e].textContent=this.value[e];t&&this.send()}send(t){t=t||this.value,this.isSend=!0,null!==this.objectLink&&(this.isVector?this.objectLink[this.objectKey].fromArray(t):this.objectLink[this.objectKey]=t),this.callback&&this.callback(t,this.objectKey),this.isSend=!1}select(t,e,i,s){let n=this.s,r=-1!==this.current?this.tmp[this.current][0]+5:0;n[this.cursorId].width="1px",n[this.cursorId].left=r+t+"px",n[this.selectId].left=r+e+"px",n[this.selectId].width=i+"px",this.c[this.selectId].innerHTML=s}unselect(){let t=this.s;t&&(this.c[this.selectId].innerHTML="",t[this.selectId].width="0px",t[this.cursorId].width="0px")}validate(t){let e=[],i=this.lng;for(this.allway&&(t=!0);i--;){if(isNaN(this.c[3+i].textContent))this.c[3+i].textContent=this.value[i];else{let t=this.numValue(this.c[3+i].textContent);this.c[3+i].textContent=t,this.value[i]=t}e[i]=this.value[i]*this.multy}t&&this.send(this.isSingle?e[0]:e)}rSize(){super.rSize();let t=this.colors.sx,e=t*(this.lng-1),i=(this.sb-e)/this.lng,s=this.s,n=this.lng;for(;n--;)this.tmp[n]=[this.sa+i*n+t*n,i],this.tmp[n][2]=this.tmp[n][0]+this.tmp[n][1],s[3+n].left=this.tmp[n][0]+"px",s[3+n].width=this.tmp[n][1]+"px"}}class M extends f{constructor(t={}){super(t),this.setTypeNumber(t),this.model=t.stype||0,void 0!==t.mode&&(this.model=t.mode),this.isDown=!1,this.isOver=!1,this.allway=t.allway||!1,this.isDeg=t.isDeg||!1,this.isCyclic=t.cyclic||!1,this.firstImput=!1;let e=this.colors;if(this.c[2]=this.dom("div",this.css.txtselect+"border:none; background:none; width:47px; color:"+e.text+";"),this.c[3]=this.dom("div",this.css.basic+" top:0; height:"+this.h+"px;"),this.c[4]=this.dom("div",this.css.basic+"background:"+e.back+"; top:2px; height:"+(this.h-4)+"px;"),this.c[5]=this.dom("div",this.css.basic+"left:4px; top:5px; height:"+(this.h-10)+"px; background:"+e.text+";"),this.c[2].isNum=!0,this.c[2].style.height=this.h-2+"px",this.c[2].style.lineHeight=this.h-10+"px",0!==this.model){let t=4,i=4,s=8,n=this.h-6,r=16;2===this.model&&(t=0,i=2,s=4,r=2,n=.5*(this.h-6)),3===this.model&&(this.c[5].style.visible="none"),this.c[4].style.borderRadius=t+"px",this.c[4].style.height=s+"px",this.c[4].style.top=.5*this.h-i+"px",this.c[5].style.borderRadius=.5*t+"px",this.c[5].style.height=i+"px",this.c[5].style.top=.5*this.h-.5*i+"px",this.c[6]=this.dom("div",this.css.basic+"border-radius:"+r+"px; margin-left:"+.5*-n+"px; background:"+e.text+"; left:4px; top:3px; height:"+(this.h-6)+"px; width:"+n+"px;")}this.init()}testZone(t){let e=this.local;return-1===e.x&&-1===e.y?"":e.x>=this.txl?"text":e.x>=this.sa?"scroll":""}mouseup(t){this.isDown&&(this.isDown=!1)}mousedown(t){let e=this.testZone(t);return!!e&&("scroll"===e&&(this.isDown=!0,this.old=this.value,this.mousemove(t)),!0)}mousemove(t){let e=!1;if("scroll"===this.testZone(t)?(this.mode(1),this.cursor("w-resize")):this.cursor(),this.isDown){let i=(t.clientX-(this.zone.x+this.sa)-3)/this.ww*this.range+this.min-this.old;(i>=this.step||i<=this.step)&&(i=Math.floor(i/this.step),this.value=this.numValue(this.old+i*this.step),this.update(!0),this.old=this.value),e=!0}return e}wheel(t){if("scroll"===this.testZone(t)){let e=this.value-this.step*t.delta;return e>this.max?e=this.isCyclic?this.min:this.max:e<this.min&&(e=this.isCyclic?this.max:this.min),this.setValue(e),this.old=e,this.update(!0),!0}return!1}validate(){let t=this.c[2].textContent;isNaN(t)?this.c[2].textContent=this.value+(this.isDeg?"":""):(this.value=this.numValue(t),this.update(!0))}reset(){this.isDown=!1,this.mode(0)}mode(t){let e=this.s,i=this.colors;switch(t){case 0:e[2].color=i.text,e[4].background=i.back,e[5].background=i.text,0!==this.model&&(e[6].background=i.text);break;case 1:e[2].color=i.textOver,e[4].background=i.back,e[5].background=i.textOver,0!==this.model&&(e[6].background=i.textOver)}}update(t){let e=Math.floor(this.ww*((this.value-this.min)/this.range));3!==this.model&&(this.s[5].width=e+"px"),this.s[6]&&(this.s[6].left=this.sa+e+3+"px"),this.c[2].textContent=this.value+(this.isDeg?"":""),t&&this.send()}rSize(){super.rSize();let t=this.sb-this.sc;this.ww=t-6;let e=this.sc;!this.isUI&&this.simple||(e=this.sc+10),this.txl=this.w-e+2;let i=this.s;i[2].width=this.sc-6+"px",i[2].left=this.txl+4+"px",i[3].left=this.sa+"px",i[3].width=t+"px",i[4].left=this.sa+"px",i[4].width=t+"px",i[5].left=this.sa+3+"px",this.update()}}class P extends f{constructor(t={}){super(t),this.cmode=0,this.value=void 0!==t.value?t.value:"",this.placeHolder=t.placeHolder||"",this.allway=t.allway||!1,this.editable=void 0===t.edit||t.edit,this.isDown=!1;let e=this.colors;this.c[2]=this.dom("div",this.css.txtselect+"top:1px; height:"+(this.h-2)+"px; color:"+e.text+"; background:"+e.back+"; borderColor:"+e.border+"; border-radius:"+this.radius+"px;"),this.c[2].textContent=this.value,this.c[3]=this.dom("div",this.css.txtselect+"position:absolute; top:2px; height:"+(this.h-4)+"px; padding:0px 0px; width:0px; color:"+e.textSelect+"; background:"+e.select+"; border:none; border-radius:0px;"),this.c[4]=this.dom("div",this.css.basic+"top:2px; height:"+(this.h-4)+"px; width:0px; background:"+e.text+";"),this.c[5]=this.dom("div",this.css.txtselect+"top:1px; height:"+(this.h-2)+"px; border:none; justify-content: center; font-style: italic; color:"+e.border+";"),""===this.value&&(this.c[5].textContent=this.placeHolder),this.init()}testZone(t){let e=this.local;return-1===e.x&&-1===e.y?"":e.x>=this.sa?"text":""}mouseup(t){if(this.editable)return!!this.isDown&&(this.isDown=!1,this.mousemove(t))}mousedown(t){if(!this.editable)return;let e=this.testZone(t);return!this.isDown&&(this.isDown=!0,"text"===e&&this.setInput(this.c[2]),this.mousemove(t))}mousemove(t){if(!this.editable)return;let e=0;return"text"===this.testZone(t)?this.cursor("text"):this.cursor(),this.isDown&&(e=t.clientX-this.zone.x),this.upInput(e-this.sa-3,this.isDown)}update(){this.c[2].textContent=this.value}reset(){this.cursor()}select(t,e,i,s){let n=this.s,r=this.sa+5;n[4].width="1px",n[4].left=r+e+"px",n[3].left=r+e+"px",n[3].width=i+"px",this.c[3].innerHTML=s}unselect(){let t=this.s;t&&(t[3].width="0px",this.c[3].innerHTML="t",t[4].width="0px")}validate(t){this.allway&&(t=!0),this.value=this.c[2].textContent,""!==this.value?this.c[5].textContent="":this.c[5].textContent=this.placeHolder,t&&this.send()}rSize(){super.rSize();let t=this.s;t[2].left=this.sa+"px",t[2].width=this.sb+"px",t[5].left=this.sa+"px",t[5].width=this.sb+"px"}}class C extends f{constructor(t={}){super(t);let e=t.prefix||"";this.c[2]=this.dom("div",this.css.txt+"justify-content:right; width:60px; line-height:"+(this.h-8)+"px; color:"+this.colors.text),31===this.h&&(this.s[0].height=this.h+"px",this.s[1].top="8px",this.c[2].style.top="8px");let i=this.s;i[1].justifyContent=t.align||"left",i[1].fontWeight=t.fontWeight||"bold",this.c[1].textContent=this.txt.substring(0,1).toUpperCase()+this.txt.substring(1).replace("-"," "),this.c[2].textContent=e,this.init()}text(t){this.c[1].textContent=t}text2(t){this.c[2].textContent=t}rSize(){super.rSize(),this.s[1].width=this.w+"px",this.s[2].left=this.w+"px"}setColor(t){this.s[1].color=t,this.s[2].color=t}}class _ extends f{constructor(t={}){super(t),this.value=t.value||"",this.isDown=!1,this.onActif=t.onActif||function(){};const e=this.colors;this.c[2]=this.dom("div",this.css.txt+this.css.button+" top:1px; background:"+e.button+"; height:"+(this.h-2)+"px; border:"+e.buttonBorder+"; border-radius:15px; width:30px; left:10px;"),this.c[3]=this.dom("div",this.css.txtselect+"height:"+(this.h-4)+"px; background:"+e.inputBg+"; borderColor:"+e.inputBorder+"; border-radius:"+this.radius+"px;"),this.c[3].textContent=this.value;let i=Math.floor(.5*this.h)-7;this.c[4]=this.dom("path",this.css.basic+"position:absolute; width:14px; height:14px; left:5px; top:"+i+"px;",{d:this.svgs.cursor,fill:e.text,stroke:"none"}),this.stat=1,this.isActif=!1,this.init()}testZone(t){let e=this.local;return-1===e.x&&-1===e.y?"":e.x>this.sa&&e.x<this.sa+30?"over":"0"}mouseup(t){return!!this.isDown&&(this.isDown=!1,this.mousemove(t))}mousedown(t){return!!this.testZone(t)&&(this.isDown=!0,this.mousemove(t))}mousemove(t){let e=!1;return"over"===this.testZone(t)?(this.cursor("pointer"),e=this.mode(this.isDown?3:2)):e=this.reset(),e}apply(t){(t=t||"")!==this.value&&(this.value=t,this.c[3].textContent=this.value,this.send()),this.mode(1)}update(){this.mode(3)}mode(t){let e=!1,i=this.colors;if(this.stat!==t){switch(1===t&&(this.isActif=!1),3===t&&(this.isActif?this.isActif=!1:(this.isActif=!0,t=4,this.onActif(this))),2===t&&this.isActif&&(t=4),this.stat=t,t){case 1:this.s[2].color=i.text,this.s[2].background=i.button;break;case 2:this.s[2].color=i.textOver,this.s[2].background=i.overoff;break;case 3:this.s[2].color=i.textOver,this.s[2].background=i.action;break;case 4:this.s[2].color=i.textSelect,this.s[2].background=i.action}e=!0}return e}reset(){return this.cursor(),this.mode(this.isActif?4:1)}text(t){this.c[3].textContent=t}rSize(){super.rSize();let t=this.s;t[2].left=this.sa+"px",t[3].left=this.sa+40+"px",t[3].width=this.sb-40+"px",t[4].left=this.sa+8+"px"}}class R extends f{constructor(t={}){super(t),this.value=t.value||"",this.colorSpace=t.colorSpace||"",this.img=null,this.value.isTexture&&this.value.image&&this.value.image.currentSrc&&(this.img=this.value.image),this.isDown=!1,this.neverlock=!0;const e=this.colors;this.c[2]=this.dom("div",this.css.txt+this.css.button+" top:1px; background:"+e.button+"; height:"+(this.h-2)+"px; border:"+e.buttonBorder+"; border-radius:2px; width:30px; "),this.c[3]=this.dom("div",this.css.txtselect+"height:"+(this.h-4)+"px; background:"+e.back+"; borderColor:"+e.inputBorder+"; border-radius:"+this.radius+"px;"),this.img||(this.c[3].textContent="null");let i=Math.floor(.5*this.h)-7;this.c[4]=this.dom("path",this.css.basic+"position:absolute; width:14px; height:14px; left:5px; top:"+i+"px;",{d:this.svgs.load,fill:e.text,stroke:"none"}),this.stat=1,this.makePreview(),this.init()}testZone(t){let e=this.local;return-1===e.x&&-1===e.y?"":e.x>this.sa&&e.x<this.sa+30?"over":e.x>this.sa-30&&e.x<this.sa?"delete":"0"}mouseup(t){return!!this.isDown&&(this.isDown=!1,this.mousemove(t))}mousedown(t){let e=this.testZone(t);return!!e&&("over"===e&&(this.isDown=!0,d.load({callback:this.changeBitmap.bind(this),always:!0,type:"image"})),this.mousemove(t))}mousemove(t){let e=!1;return"over"===this.testZone(t)?(this.cursor("pointer"),e=this.mode(this.isDown?3:2)):e=this.reset(),e}makePreview(){this.img?(this.c[3].style.background="url("+this.img.src+")",this.c[3].style.backgroundSize=this.sb-40+"px "+(this.sb-40)+"px",this.c[3].style.backgroundPosition="center",this.c[3].style.backgroundRepeat="no-repeat"):(this.c[3].style.background=this.colors.back,this.c[3].style.backgroundImage="none")}changeBitmap(t,e,i){t?(this.img=t,this.apply(e)):(this.img=null,this.apply("null")),this.makePreview(),this.threeTexture()}threeTexture(){if(null===this.objectLink)return;let t=this.objectLink[this.objectKey];this.img?null!==t?(t.image=this.img,this.objectLink[this.objectKey]=t.clone(),t.dispose(),this.objectLink[this.objectKey].needsUpdate=!0):u.texture&&(t=new u.texture(this.img),console.log("colorSpace",t.colorSpace),this.colorSpace&&(t.colorSpace=this.colorSpace),this.objectLink[this.objectKey]=t,this.objectLink[this.objectKey].needsUpdate=!0):this.objectLink[this.objectKey]=null,this.objectLink.needsUpdate=!0}apply(t){t=t||"";let e=null!==this.objectLink?this.objectKey:this.name;t!==this.value&&(this.value=t,null!==this.img?(this.c[3].textContent="",this.callback&&this.callback(this.value,this.img,e)):(this.c[3].textContent="null",this.callback&&this.callback(null,null,e))),this.mode(1)}update(){this.mode(3)}mode(t,e){let i=!1,s=this.colors;if(this.stat!==t){switch(this.stat=t,t){case 1:this.s[2].color=s.text,this.s[2].background=s.button;break;case 2:this.s[2].color=s.textOver,this.s[2].background=s.overoff;break;case 3:this.s[2].color=s.textOver,this.s[2].background=s.over;break;case 4:this.s[2].color=s.textSelect,this.s[2].background=s.select}i=!0}return i}reset(){return this.cursor(),this.mode(this.isActif?4:1)}text(t){this.c[3].textContent=t}rSize(){super.rSize();let t=this.s;t[2].left=this.sa+"px",t[3].left=this.sa+40+"px",t[3].width=this.sb-40+"px",t[4].left=this.sa+8+"px"}}class E extends g{constructor(t={}){void 0===t.selectable&&(t.selectable=!0),super(t)}}class Q extends f{constructor(t={}){super(t),this.p=100,this.value=this.txt,this.status=1,this.itype=t.itype||"none",this.val=this.itype,this.graph=this.svgs[this.itype];let e=Math.floor(.5*this.h)-7;this.c[2]=this.dom("path",this.css.basic+"position:absolute; width:14px; height:14px; left:5px; top:"+e+"px;",{d:this.graph,fill:this.colors.text,stroke:"none"}),this.s[1].marginLeft="20px",this.init()}mousemove(t){this.cursor("pointer")}mousedown(t){return this.isUI&&this.main.resetItem(),this.selected(!0),this.send(),!0}uiout(){this.isSelect?this.mode(3):this.mode(1)}uiover(){this.isSelect?this.mode(4):this.mode(2)}update(){}mode(t){let e=!1;if(this.status!==t){this.status=t;let i=this.s,s=this.colors;switch(t){case 1:this.status=1,i[1].color=s.text,i[0].background="none";break;case 2:this.status=2,i[1].color=s.textOver,i[0].background=s.back;break;case 3:this.status=3,i[1].color=s.textSelect,i[0].background=s.select;break;case 4:this.status=4,i[1].color=s.textOver,i[0].background=s.over}e=!0}return e}reset(){this.cursor()}selected(t){this.isSelect&&this.mode(1),this.isSelect=t||!1,this.isSelect&&this.mode(3)}}class L extends f{constructor(t={}){if(super(t),this.values=[],t.values)if(t.values instanceof Array)this.values=t.values;else if(t.values instanceof String)this.values=[t.values];else if(t.values instanceof Object){this.refObject=t.values;for(let t in this.refObject)this.values.push(t)}this.lng=this.values.length,this.value=t.value||null;let e=this.colors;this.isSelectable=t.selectable||!1,this.spaces=t.spaces||[e.sx,e.sy],this.bsize=t.bsize||[90,this.h],this.bsizeMax=this.bsize[0],this.tmp=[],this.stat=[],this.grid=[2,Math.round(.5*this.lng)],this.h=this.grid[1]*this.bsize[1]+this.grid[1]*this.spaces[1],this.c[1].textContent="",this.c[2]=this.dom("table",this.css.basic+"width:100%; border-spacing: "+(this.spaces[0]-2)+"px "+this.spaces[1]+"px; border:none;");let i,s,n,r,o=0;this.res=-1,this.isDown=!1,this.neverlock=!0,this.buttons=[],this.stat=[],this.tmpX=[],this.tmpY=[];for(let t=0;t<this.grid[1];t++){n=this.c[2].insertRow(),n.style.cssText="pointer-events:none;";for(let t=0;t<this.grid[0];t++)s=n.insertCell(),s.style.cssText="pointer-events:none;",this.values[o]?(r=!1,this.values[o]===this.value&&this.isSelectable&&(r=!0),i=document.createElement("div"),i.style.cssText=this.css.txt+this.css.button+"position:static; top:1px; width:"+this.bsize[0]+"px; height:"+(this.bsize[1]-2)+"px; border:"+e.borderSize+"px solid "+e.border+"; left:auto; right:auto; border-radius:"+this.radius+"px;",i.style.background=r?e.select:e.button,i.style.color=r?e.textSelect:e.text,i.innerHTML=this.values[o],s.appendChild(i),this.buttons.push(i),this.stat.push(1)):(i=document.createElement("div"),i.style.cssText=this.css.txt+"position:static; width:"+this.bsize[0]+"px; height:"+this.bsize[1]+"px; text-align:center; left:auto; right:auto; background:none;",s.appendChild(i)),i.style.cssText+=0===t?"float:right;":"float:left;",o++}this.s[0].border="none",this.init()}testZone(t){let e=this.local;if(-1===e.x&&-1===e.y)return-1;e.y+=this.mtop;let i=this.tmpX,s=this.tmpY,n=-1,r=-1,o=-1,a=this.grid[0];for(;a--;)e.x>i[a][0]&&e.x<i[a][1]&&(r=a);for(a=this.grid[1];a--;)e.y>s[a][0]&&e.y<s[a][1]&&(o=a);return-1!==r&&-1!==o&&(n=r+2*o,n>this.lng-1&&(n=-1)),n}mouseup(t){return!!this.isDown&&(this.isDown=!1,-1!==this.res&&(this.value=this.values[this.res],this.send()),this.mousemove(t))}mousedown(t){return!this.isDown&&(this.isDown=!0,this.mousemove(t))}mousemove(t){let e=!1;return this.res=this.testZone(t),-1!==this.res?(this.cursor("pointer"),e=this.modes(this.isDown?3:2,this.res)):e=this.reset(),e}modes(t=1,e=-1){let i,s,n=this.lng,r=!1;for(;n--;)s=t,i=!!this.isSelectable&&this.values[n]===this.value,n===e?i&&2===s&&(s=3):(s=1,i&&(s=4)),this.mode(s,n)&&(r=!0);return r}mode(t,e){let i=!1,s=this.colors,n=this.buttons,r=e;if(this.stat[e]!==t){switch(this.stat[e]=t,t){case 1:n[r].style.color=s.text,n[r].style.background=s.button;break;case 2:n[r].style.color=s.textOver,n[r].style.background=s.overoff;break;case 3:n[r].style.color=s.textOver,n[r].style.background=s.over;break;case 4:n[r].style.color=s.textSelect,n[r].style.background=s.select}i=!0}return i}reset(){return this.res=-1,this.cursor(),this.modes()}label(t,e){this.buttons[e].textContent=t}icon(t,e,i){this.buttons[i].style.padding=(e||0)+"px 0px",this.buttons[i].innerHTML=t}testW(){let t=!1;if(3*this.spaces[0]+2*this.bsizeMax>this.w?(this.bsize[0]=.5*(this.w-3*this.spaces[0]),t=!0):this.bsize[0]!==this.bsizeMax&&(this.bsize[0]=this.bsizeMax,t=!0),!t)return;let e=this.buttons.length;for(;e--;)this.buttons[e].style.width=this.bsize[0]+"px"}rSize(){let t;super.rSize(),this.testW(),this.tmpX=[],this.tmpY=[];for(let e=0;e<this.grid[0];e++)0===e?(t=.5*this.w-.5*this.spaces[0],this.tmpX.push([t-this.bsize[0],t])):(t=.5*this.w+.5*this.spaces[0],this.tmpX.push([t,t+this.bsize[0]]));t=this.spaces[1];for(let e=0;e<this.grid[1];e++)this.tmpY.push([t,t+this.bsize[1]]),t+=this.bsize[1]+this.spaces[1]}}class F extends f{constructor(t={}){super(t),this.autoWidth=!1,this.minw=this.w,this.diam=t.diam||this.w,this.pos=new p(0,0),this.maxPos=90,this.model=t.stype||0,void 0!==t.mode&&(this.model=t.mode),this.min=void 0===t.min?-1:t.min,this.max=void 0===t.max?1:t.max,this.range=.5*(this.max-this.min),this.cmode=0,this.c[0].style.display="block",this.precision=void 0===t.precision?2:t.precision,this.value=Array.isArray(t.value)&&2==t.value.length?t.value:[0,0],this.h=t.h||this.w+10,this.c[0].style.width=this.w+"px",void 0!==this.c[1]&&(this.c[1].style.width="100%",this.c[1].style.justifyContent="center",this.top=10,this.h+=10);let e=this.colors;this.c[2]=this.dom("div",this.css.txt+"justify-content:center; top:"+(this.h-20)+"px; width:100%; color:"+e.text),this.c[2].textContent=this.value;let i=this.getPad2d();this.setSvg(i,"fill",e.back,0),this.setSvg(i,"fill",e.button,1),this.setSvg(i,"stroke",e.back,2),this.setSvg(i,"stroke",e.back,3),this.setSvg(i,"stroke",e.text,4),this.setSvg(i,"viewBox","0 0 "+this.diam+" "+this.diam),this.setCss(i,{width:this.diam,height:this.diam,left:0,top:this.top}),this.c[3]=i,this.init(),this.setValue()}testZone(t){let e=this.local;return-1===e.x&&-1===e.y?"":e.y<=this.c[1].offsetHeight?"title":e.y>this.h-this.c[2].offsetHeight?"text":"pad"}mouseup(t){return this.isDown=!1,this.mode(0)}mousedown(t){if("pad"===this.testZone(t))return this.isDown=!0,this.mousemove(t),this.mode(1)}mousemove(t){if(!this.isDown)return;let e=.5*this.w-(t.clientX-this.zone.x),i=.5*this.diam-(t.clientY-this.zone.y-this.ytop),s=256/this.diam;e=-e*s,i=-i*s,e=u.clamp(e,-this.maxPos,this.maxPos),i=u.clamp(i,-this.maxPos,this.maxPos),this.setPos([e,i]),this.update(!0)}mode(t){if(this.cmode===t)return!1;let e=this.colors;switch(t){case 0:this.s[2].color=e.text,this.setSvg(this.c[3],"fill",e.back,0),this.setSvg(this.c[3],"fill",e.button,1),this.setSvg(this.c[3],"stroke",e.back,2),this.setSvg(this.c[3],"stroke",e.back,3),this.setSvg(this.c[3],"stroke",e.text,4);break;case 1:this.s[2].color=e.textSelect,this.setSvg(this.c[3],"fill",e.backoff,0),this.setSvg(this.c[3],"fill",e.overoff,1),this.setSvg(this.c[3],"stroke",e.backoff,2),this.setSvg(this.c[3],"stroke",e.backoff,3),this.setSvg(this.c[3],"stroke",e.textSelect,4)}return this.cmode=t,!0}update(t){this.c[2].textContent=this.value,this.updateSVG(),t&&this.send()}updateSVG(){1==this.model&&(this.setSvg(this.c[3],"y1",this.pos.y,2),this.setSvg(this.c[3],"y2",this.pos.y,2),this.setSvg(this.c[3],"x1",this.pos.x,3),this.setSvg(this.c[3],"x2",this.pos.x,3)),this.setSvg(this.c[3],"cx",this.pos.x,4),this.setSvg(this.c[3],"cy",this.pos.y,4)}setPos(t){this.pos.set(t[0]+128,t[1]+128);let e=1/this.maxPos;this.value[0]=(t[0]*e*this.range).toFixed(this.precision),this.value[1]=(t[1]*e*this.range).toFixed(this.precision)}setValue(t,e=!1){void 0===t&&(t=this.value),this.value[0]=1*Math.min(this.max,Math.max(this.min,t[0])).toFixed(this.precision),this.value[1]=1*Math.min(this.max,Math.max(this.min,t[1])).toFixed(this.precision),this.pos.set(this.value[0]/this.range*this.maxPos+128,this.value[1]/this.range*this.maxPos+128),this.update(e)}}const I=function(){let t,e,i=arguments,s=!1,n=null;"string"==typeof i[0]?(t=i[0],e=i[1]||{}):"object"==typeof i[0]&&(s=!0,void 0===i[2]&&[].push.call(i,{}),t=i[2].type?i[2].type:D(i[0][i[1]],i[2]),e=i[2],e.name=i[1],"list"!==t||e.list?e.value=i[0][i[1]]:e.list=i[0][i[1]]);let r=t.toLowerCase();switch("group"===r&&(e.add=I),r){case"bool":case"boolean":n=new m(e);break;case"button":n=new g(e);break;case"circular":n=new v(e);break;case"color":n=new y(e);break;case"fps":n=new b(e);break;case"graph":n=new x(e);break;case"group":n=new w(e);break;case"joystick":n=new S(e);break;case"knob":n=new k(e);break;case"list":n=new A(e);break;case"numeric":case"number":n=new T(e);break;case"slide":n=new M(e);break;case"textInput":case"string":n=new P(e);break;case"title":case"text":n=new C(e);break;case"select":n=new _(e);break;case"bitmap":n=new R(e);break;case"selector":n=new E(e);break;case"empty":case"space":n=new O(e);break;case"item":n=new Q(e);break;case"grid":n=new L(e);break;case"pad2d":case"pad":n=new F(e)}if(null!==n)return h.needResize=!0,s&&n.setReferency(i[0],i[1]),n},D=function(t,e){let i="slide";return t.isColor?i="color":t.isTexture?i="bitmap":"boolean"==typeof t?i="bool":"string"==typeof t?i="#"===t.substring(0,1)?"color":"string":"number"==typeof t?i=e.ctype?"color":"slide":"array"==typeof t&&t instanceof Array?"number"==typeof t[0]?i="number":"string"==typeof t[0]&&(i="list"):"object"==typeof t&&t instanceof Object&&(i=void 0!==t.x?"number":"list"),i};class U{constructor(t={}){this.isGui=!0,this.name="gui",this.canvas=null,this.screen=null,this.plane=t.plane||null,t.config&&(t.colors=t.config),t.colors?this.setConfig(t.colors):this.colors=u.defineColor(t),this.css=u.cloneCss(),this.isReset=!0,this.tmpAdd=null,this.isCanvas=t.isCanvas||!1,this.isCanvasOnly=!1,this.callback=void 0===t.callback?null:t.callback,this.forceHeight=t.maxHeight||0,this.lockHeight=t.lockHeight||!1,this.isItemMode=void 0!==t.itemMode&&t.itemMode,this.cn="",this.size=u.size,void 0!==t.p&&(this.size.p=t.p),void 0!==t.w&&(this.size.w=t.w),void 0!==t.h&&(this.size.h=t.h),void 0!==t.s&&(this.size.s=t.s),this.size.h=this.size.h<11?11:this.size.h,this.local=(new p).neg(),this.zone={x:0,y:0,w:this.size.w,h:0},this.mouse=(new p).neg(),this.h=0,this.sw=0,this.margin=this.colors.sy,this.marginDiv=u.isDivid(this.margin),this.isWithClose=void 0===t.close||t.close,this.bh=this.isWithClose?this.size.h:0,this.autoResize=void 0===t.autoResize||t.autoResize,this.isCenter=t.center||!1,this.cssGui=void 0!==t.css?t.css:this.isCenter?"":"right:10px;",this.isOpen=void 0===t.open||t.open,this.isDown=!1,this.isScroll=!1,this.uis=[],this.current=-1,this.proto=null,this.isEmpty=!0,this.decal=0,this.ratio=1,this.oy=0,this.isNewTarget=!1;let e=this.colors;this.content=u.dom("div",this.css.basic+" width:0px; height:auto; top:0px; background:"+e.content+"; "+this.cssGui),this.innerContent=u.dom("div",this.css.basic+"width:100%; top:0; left:0; height:auto; overflow:hidden;"),this.content.appendChild(this.innerContent),this.useFlex=!0;let i=this.useFlex?"display:flex; flex-flow: row wrap;":"";this.inner=u.dom("div",this.css.basic+i+"width:100%; left:0; "),this.innerContent.appendChild(this.inner),this.scrollBG=u.dom("div",this.css.basic+"right:0; top:0; width:"+(this.size.s-1)+"px; height:10px; display:none; background:"+e.background+";"),this.content.appendChild(this.scrollBG),this.scroll=u.dom("div",this.css.basic+"background:"+e.button+"; right:2px; top:0; width:"+(this.size.s-4)+"px; height:10px;"),this.scrollBG.appendChild(this.scroll),this.bottomText=t.bottomText||["open","close"];let s=e.radius;this.bottom=u.dom("div",this.css.txt+"width:100%; top:auto; bottom:0; left:0; border-bottom-right-radius:"+s+"px; border-bottom-left-radius:"+s+"px; justify-content:center; height:"+this.bh+"px; line-height:"+(this.bh-5)+"px; color:"+e.text+";"),this.content.appendChild(this.bottom),this.bottom.textContent=this.isOpen?this.bottomText[1]:this.bottomText[0],this.bottom.style.background=e.background,this.parent=void 0!==t.parent?t.parent:null,this.parent=void 0!==t.target?t.target:this.parent,null!==this.parent||this.isCanvas||(this.parent=document.body),null!==this.parent&&this.parent.appendChild(this.content),this.isCanvas&&null===this.parent&&(this.isCanvasOnly=!0),this.isCanvasOnly?(this.content.style.left="0px",this.content.style.right="auto",t.transition=0):this.content.style.pointerEvents="auto",this.transition=void 0!==t.transition?t.transition:u.transition,this.transition&&setTimeout(this.addTransition.bind(this),1e3),this.setWidth(),this.isCanvas&&this.makeCanvas(),h.add(this)}setTop(t,e){this.content.style.top=t+"px",void 0!==e&&(this.forceHeight=e),this.calc(),h.needReZone=!0}addTransition(){this.transition&&!this.isCanvas&&(this.innerContent.style.transition="height "+this.transition+"s ease-out",this.content.style.transition="height "+this.transition+"s ease-out",this.bottom.style.transition="top "+this.transition+"s ease-out");let t=this.uis.length;for(;t--;)this.uis[t].addTransition()}onDraw(){}makeCanvas(){this.canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.canvas.width=this.zone.w,this.canvas.height=this.forceHeight?this.forceHeight:this.zone.h}draw(t){if(null===this.canvas)return;let e=this.zone.w,i=this.forceHeight?this.forceHeight:this.zone.h;h.toCanvas(this,e,i,t)}getDom(){return this.content}noMouse(){this.mouse.neg()}setMouse(t,e=!0){e?this.mouse.set(Math.round(t.x*this.canvas.width),this.canvas.height-Math.round(t.y*this.canvas.height)):this.mouse.set(Math.round(t.x*this.canvas.width),Math.round(t.y*this.canvas.height))}setConfig(t){u.setText(),this.colors=u.defineColor(t)}setColors(t){for(let e in t)this.colors[e]&&(this.colors[e]=t[e])}setText(t,e,i,s){u.setText(t,e,i,s)}hide(t){this.content.style.visibility=t?"hidden":"visible"}display(t=!1){this.content.style.visibility=t?"visible":"hidden"}onChange(t){return this.callback=t||null,this}mode(t){let e=!1,i=this.colors;if(t!==this.cn){switch(this.cn=t,t){case"def":h.cursor(),this.scroll.style.background=i.button,this.bottom.style.background=i.background,this.bottom.style.color=i.text;break;case"scrollOver":h.cursor("ns-resize"),this.scroll.style.background=i.select;break;case"scrollDown":this.scroll.style.background=i.select;break;case"bottomOver":h.cursor("pointer"),this.bottom.style.background=i.backgroundOver,this.bottom.style.color=i.textOver}e=!0}return e}clearTarget(){return-1!==this.current&&(this.proto.s&&(this.proto.uiout(),this.proto.reset()),this.proto=null,this.current=-1,h.cursor(),!0)}testZone(t){let e=this.local;if(-1===e.x&&-1===e.y)return"";this.isReset=!1;let i="",s=this.isScroll?this.zone.w-this.size.s:this.zone.w;return i=e.y>this.zone.h-this.bh&&e.y<this.zone.h?"bottom":e.x>s?"scroll":"content",i}handleEvent(t){let e=t.type,i=!1,s=!1,n=this.testZone(t);if("mouseup"===e&&this.isDown&&(this.isDown=!1),"mousedown"!==e||this.isDown||(this.isDown=!0),this.isDown&&this.isNewTarget&&(h.clearInput(),this.isNewTarget=!1),n){switch(n){case"content":t.clientY=this.isScroll?t.clientY+this.decal:t.clientY,h.isMobile&&"mousedown"===e&&this.getNext(t,i),this.proto&&(s=this.proto.handleEvent(t)),"mousemove"===e&&(i=this.mode("def")),"wheel"===e&&!s&&this.isScroll&&(i=this.onWheel(t)),h.lock||this.getNext(t,i);break;case"bottom":this.clearTarget(),"mousemove"===e&&(i=this.mode("bottomOver")),"mousedown"===e&&(this.isOpen=!this.isOpen,this.bottom.textContent=this.isOpen?this.bottomText[1]:this.bottomText[0],this.calc(),this.mode("def"),i=!0);break;case"scroll":this.clearTarget(),"mousemove"===e&&(i=this.mode("scrollOver")),"mousedown"===e&&(i=this.mode("scrollDown")),"wheel"===e&&(i=this.onWheel(t)),this.isDown&&this.update(t.clientY-this.zone.y-.5*this.sh)}this.isDown&&(i=!0),s&&(i=!0),"keyup"===e&&(i=!0),"keydown"===e&&(i=!0),i&&this.draw()}}getNext(t,e){let i=h.findTarget(this.uis,t);i!==this.current&&(this.clearTarget(),this.current=i,this.isNewTarget=!0),-1!==i&&(this.proto=this.uis[this.current],this.proto.uiover())}onWheel(t){return this.oy+=20*t.delta,this.update(this.oy),!0}reset(t){if(this.isReset)return;this.mouse.neg(),this.isDown=!1;let e=this.mode("def"),i=this.clearTarget();(e||i)&&this.draw(!0),this.isReset=!0}add(){let t=arguments,e=!1;"object"==typeof t[1]?(t[1].isUI=!0,t[1].main=this,e=!!t[1].ontop&&t[1].ontop):"string"==typeof t[1]&&(void 0===t[2]?[].push.call(t,{isUI:!0,main:this}):(t[2].isUI=!0,t[2].main=this,e=!!t[2].ontop&&t[2].ontop));let i=I.apply(this,t);if(null!==i)return e?this.uis.unshift(i):this.uis.push(i),this.calc(),this.isEmpty=!1,i}remove(t){t.dispose&&t.dispose()}clearOne(t){let e=this.uis.indexOf(t);-1!==e&&(this.inner.removeChild(this.uis[e].c[0]),this.uis.splice(e,1),this.calc())}empty(){let t,e=this.uis.length;for(;e--;)t=this.uis.pop(),this.inner.removeChild(t.c[0]),t.dispose();this.uis=[],this.isEmpty=!0,this.calc()}clear(){this.empty()}clear2(){setTimeout(this.empty.bind(this),0)}dispose(){this.clear(),null!==this.parent&&this.parent.removeChild(this.content),h.remove(this)}resetItem(){if(!this.isItemMode)return;let t=this.uis.length;for(;t--;)this.uis[t].selected()}setItem(t){if(!this.isItemMode)return;if(t=t||"",this.resetItem(),!t)return void this.update(0);let e=this.uis.length;for(;e--;)this.uis[e].value===t&&(this.uis[e].selected(!0),this.isScroll&&this.update(e*(this.uis[e].h+this.margin)*this.ratio))}upScroll(t){this.sw=t?this.size.s:0,this.oy=t?this.oy:0,this.scrollBG.style.display=t?"block":"none",t&&(this.total=this.h,this.maxView=this.maxHeight,this.ratio=this.maxView/this.total,this.sh=this.maxView*this.ratio,this.range=this.maxView-this.sh,this.oy=u.clamp(this.oy,0,this.range),this.scrollBG.style.height=this.maxView+"px",this.scroll.style.height=this.sh+"px"),this.setItemWidth(this.zone.w-this.sw),this.update(this.oy)}update(t){t=u.clamp(t,0,this.range),this.decal=Math.floor(t/this.ratio),this.inner.style.top=-this.decal+"px",this.scroll.style.top=Math.floor(t)+"px",this.oy=t}calcUis(){return h.calcUis(this.uis,this.zone,this.zone.y)}calc(){clearTimeout(this.tmp),this.tmp=setTimeout(this.setHeight.bind(this),10)}setHeight(){if(this.tmp&&clearTimeout(this.tmp),this.zone.h=this.bh,this.isScroll=!1,this.isOpen){this.h=this.calcUis();let t=this.forceHeight?this.forceHeight+this.zone.y:window.innerHeight;this.maxHeight=t-this.zone.y-this.bh,this.h-this.maxHeight>1?(this.isScroll=!0,this.zone.h=this.maxHeight+this.bh):this.zone.h=this.h+this.bh}this.upScroll(this.isScroll),this.innerContent.style.height=this.zone.h-this.bh+"px",this.content.style.height=this.zone.h+"px",this.bottom.style.top=this.zone.h-this.bh+"px",this.forceHeight&&this.lockHeight&&(this.content.style.height=this.forceHeight+"px"),this.isCanvas&&this.draw(!0)}rezone(){h.needReZone=!0}setWidth(t){t&&(this.zone.w=t),this.zone.w=Math.floor(this.zone.w),this.content.style.width=this.zone.w+"px",this.isCenter&&(this.content.style.marginLeft=-Math.floor(.5*this.zone.w)+"px"),this.setItemWidth(this.zone.w-this.sw)}setItemWidth(t){let e=this.uis.length;for(;e--;)this.uis[e].setSize(t),this.uis[e].rSize()}}var z;z=function(){const t=6406,e=6407,i=6408,s=6409,n=6410,r=6402,o=34041,a=33321,l=36756,h=33325,c=33326,u=33330,d=33329,p=33338,f=33337,m=33340,g=33339,v=33323,y=36757,b=33327,x=33328,O=33336,w=33335,S=33332,k=33331,A=33334,T=33333,M=32849,P=35905,C=36194,_=36758,R=35898,E=35901,Q=34843,L=34837,F=36221,I=36239,D=36215,U=36233,z=36209,N=36227,V=32856,B=35907,$=36759,X=32855,j=32854,G=32857,Z=34842,q=34836,W=36220,H=36238,Y=36975,K=36214,J=36232,tt=36226,et=36208,it=33189,st=33190,nt=36012,rt=36013,ot=35056,at=5121,lt=5123,ht=5125,ct=5126,ut=32819,dt=32820,pt=33635,ft=5131,mt=36193,gt=35906;let vt;function yt(t,e,i){return function(s,n,r){return((s+t-1)/t|0)*((n+e-1)/e|0)*i*r}}function bt(t,e,i){return function(s,n,r){return(Math.max(s,t)*Math.max(n,e)/i|0)*r}}const xt=new Map([[33776,yt(4,4,8)],[33777,yt(4,4,8)],[33778,yt(4,4,16)],[33779,yt(4,4,16)],[36196,yt(4,4,8)],[35840,bt(8,8,2)],[35842,bt(8,8,2)],[35841,bt(16,8,4)],[35843,bt(16,8,4)],[37488,yt(4,4,8)],[37489,yt(4,4,8)],[37492,yt(4,4,8)],[37493,yt(4,4,8)],[37494,yt(4,4,8)],[37495,yt(4,4,8)],[37490,yt(4,4,16)],[37491,yt(4,4,16)],[37496,yt(4,4,16)],[37497,yt(4,4,16)],[37808,yt(4,4,16)],[37840,yt(4,4,16)],[37809,yt(5,4,16)],[37841,yt(5,4,16)],[37810,yt(5,5,16)],[37842,yt(5,5,16)],[37811,yt(6,5,16)],[37843,yt(6,5,16)],[37812,yt(6,6,16)],[37844,yt(6,6,16)],[37813,yt(8,5,16)],[37845,yt(8,5,16)],[37814,yt(8,6,16)],[37846,yt(8,6,16)],[37815,yt(8,8,16)],[37847,yt(8,8,16)],[37816,yt(10,5,16)],[37848,yt(10,5,16)],[37817,yt(10,6,16)],[37849,yt(10,6,16)],[37818,yt(10,8,16)],[37850,yt(10,8,16)],[37819,yt(10,10,16)],[37851,yt(10,10,16)],[37820,yt(12,10,16)],[37852,yt(12,10,16)],[37821,yt(12,12,16)],[37853,yt(12,12,16)],[35916,yt(4,4,8)],[35917,yt(4,4,8)],[35918,yt(4,4,16)],[35919,yt(4,4,16)],[36492,yt(4,4,16)],[36493,yt(4,4,16)],[36494,yt(4,4,16)],[36495,yt(4,4,16)],[36283,yt(4,4,8)],[36284,yt(4,4,8)],[36285,yt(4,4,16)],[36286,yt(4,4,16)]]);function Ot(yt,bt){const xt=function(yt){if(!vt){const yt={};yt[t]={bytesPerElement:[1,2,2,4],type:[at,ft,mt,ct]},yt[s]={bytesPerElement:[1,2,2,4],type:[at,ft,mt,ct]},yt[n]={bytesPerElement:[2,4,4,8],type:[at,ft,mt,ct]},yt[e]={bytesPerElement:[3,6,6,12,2],type:[at,ft,mt,ct,pt]},yt[i]={bytesPerElement:[4,8,8,16,2,2],type:[at,ft,mt,ct,ut,dt]},yt[gt]={bytesPerElement:[4,8,8,16,2,2],type:[at,ft,mt,ct,ut,dt]},yt[r]={bytesPerElement:[2,4],type:[ht,lt]},yt[o]={bytesPerElement:[4]},yt[a]={bytesPerElement:[1]},yt[l]={bytesPerElement:[1]},yt[h]={bytesPerElement:[2]},yt[c]={bytesPerElement:[4]},yt[u]={bytesPerElement:[1]},yt[d]={bytesPerElement:[1]},yt[S]={bytesPerElement:[2]},yt[k]={bytesPerElement:[2]},yt[A]={bytesPerElement:[4]},yt[T]={bytesPerElement:[4]},yt[v]={bytesPerElement:[2]},yt[y]={bytesPerElement:[2]},yt[b]={bytesPerElement:[4]},yt[x]={bytesPerElement:[8]},yt[O]={bytesPerElement:[2]},yt[w]={bytesPerElement:[2]},yt[p]={bytesPerElement:[4]},yt[f]={bytesPerElement:[4]},yt[m]={bytesPerElement:[8]},yt[g]={bytesPerElement:[8]},yt[M]={bytesPerElement:[3]},yt[P]={bytesPerElement:[3]},yt[C]={bytesPerElement:[2]},yt[_]={bytesPerElement:[3]},yt[R]={bytesPerElement:[4]},yt[E]={bytesPerElement:[4]},yt[Q]={bytesPerElement:[6]},yt[L]={bytesPerElement:[12]},yt[F]={bytesPerElement:[3]},yt[I]={bytesPerElement:[3]},yt[D]={bytesPerElement:[6]},yt[U]={bytesPerElement:[6]},yt[z]={bytesPerElement:[12]},yt[N]={bytesPerElement:[12]},yt[V]={bytesPerElement:[4]},yt[B]={bytesPerElement:[4]},yt[$]={bytesPerElement:[4]},yt[X]={bytesPerElement:[2]},yt[j]={bytesPerElement:[2]},yt[G]={bytesPerElement:[4]},yt[Z]={bytesPerElement:[8]},yt[q]={bytesPerElement:[16]},yt[W]={bytesPerElement:[4]},yt[H]={bytesPerElement:[4]},yt[Y]={bytesPerElement:[4]},yt[K]={bytesPerElement:[8]},yt[J]={bytesPerElement:[8]},yt[tt]={bytesPerElement:[16]},yt[et]={bytesPerElement:[16]},yt[it]={bytesPerElement:[2]},yt[st]={bytesPerElement:[4]},yt[nt]={bytesPerElement:[4]},yt[ot]={bytesPerElement:[4]},yt[rt]={bytesPerElement:[4]},vt=yt}return vt[yt]}(yt);if(!xt)throw"unknown internal format";if(xt.type){const t=xt.type.indexOf(bt);if(t<0)throw new Error(`unsupported type ${bt} for internalformat ${yt}`);return xt.bytesPerElement[t]}return xt.bytesPerElement[0]}function wt(t,e,i,s,n){const r=xt.get(t);return r?r(e,i,s):function(t,e,i,s,n){return e*i*s*Ot(t,n)}(t,e,i,s,n)}function St(t){return function(t){return t&&t.buffer&&t.buffer instanceof ArrayBuffer}(t)||t instanceof ArrayBuffer}const kt=new Set;function At(t,e,i={}){if(kt.has(t))return t;kt.add(t);const s=i.origGLErrorFn||t.getError,n=i.sharedState||function(t){const e={samples:(s=t).getParameter(s.SAMPLES)||1,depthBits:s.getParameter(s.DEPTH_BITS),stencilBits:s.getParameter(s.STENCIL_BITS),contextAttributes:s.getContextAttributes()};var s;const n={baseContext:t,config:i,apis:{gman_webgl_memory:{ctx:{getMemoryInfo(){const i=function(t,e){if(t.isContextLost())return 0;const{samples:i}=e,s=t.drawingBufferWidth*t.drawingBufferHeight,n=function(t){const{depthBits:e,stencilBits:i}=t,s=(e+i+7)/8|0;return 3===s?4:s}(e);return 4*s+s*i*4+s*n}(t,e);return{memory:{...h,drawingbuffer:i,total:i+h.buffer+h.texture+h.renderbuffer},resources:{...c}}}}}},resources:{},memory:{texture:0,buffer:0,renderbuffer:0},bindings:new Map,defaultVertexArray:{},webglObjectToMemory:new Map},o=new Set(["webgl","webgl2","webgl_lose_context"]);function a(){n.bindings.clear(),n.webglObjectToMemory.clear(),n.webglObjectToMemory.set(n.defaultVertexArray,{}),n.currentVertexArray=n.defaultVertexArray,[n.resources,n.memory].forEach((function(t){for(let e in t)t[e]=0}))}return t.canvas&&(t.canvas.addEventListener("webglcontextlost",(function(){a(),n.isContextLost=!0;for(const[t,{ctx:e,origFuncs:i}]of[...Object.entries(n.apis)])if(!o.has(t)&&i){kt.delete(e);for(const[t,s]of Object.entries(i))e[t]=s;delete r[t]}})),t.canvas.addEventListener("webglcontextrestored",(function(){n.isContextLost=!1}))),a(),n}(t);i.sharedState=n;const{apis:r,baseContext:o,bindings:a,config:l,memory:h,resources:c,webglObjectToMemory:u}=n,d={};function p(){}function f(t,e,i){if(t[i||`create${e[0].toUpperCase()}${e.substr(1)}`])return c[e]=0,function(t,i,s,r){if(n.isContextLost)return null;++c[e],u.set(r,{size:0})}}function m(e,i=p,s){const r=s||`delete${e[0].toUpperCase()}${e.substr(1)}`;if(t[r])return function(t,s,r){if(n.isContextLost)return;const[o]=r,a=u.get(o);a&&(--c[e],i(o,a),u.delete(o))}}function g(t,e,i,s,r){if(n.isContextLost)return;const o=a.get(t);if(!o)throw new Error(`no renderbuffer bound to ${t}`);const l=u.get(o);if(!l)throw new Error(`unknown renderbuffer ${o}`);const c=wt(i,s,r,1)*e;h.renderbuffer-=l.size,l.size=c,h.renderbuffer+=c}const v=5121,y=34067,b=35866,x=34069,O=new Set([x,34070,34071,34072,34073,34074]);function w(t){return O.has(t)}function S(t){t=w(t)?y:t;const e=a.get(t);if(!e)throw new Error(`no texture bound to ${t}`);const i=u.get(e);if(!i)throw new Error(`unknown texture ${e}`);return i}function k(t,e,i,s,n,r,o,a){const l=t.size,c=wt(s,n,r,o,a),u=w(e)?e-x:0;t.mips=t.mips||[],t.mips[i]=t.mips[i]||[];const d=t.mips[i][u]||{};t.size-=d.size||0,d.size=c,d.internalFormat=s,d.type=a,d.width=n,d.height=r,d.depth=o,t.mips[i][u]=d,t.size+=c,h.texture-=l,h.texture+=t.size}function A(t,e,i,s,n,r){const o=S(t),a=t===y?6:1,l=t===y?x:t;for(let h=0;h<e;++h){for(let t=0;t<a;++t)k(o,l+t,h,i,s,n,r);s=Math.ceil(Math.max(s/2,1)),n=Math.ceil(Math.max(n/2,1)),r=t===b?r:Math.ceil(Math.max(r/2,1))}}function T(t,e,i){if(n.isContextLost)return;const[s]=i;n.currentVertexArray=s||n.defaultVertexArray}function M(t,e){n.isContextLost||(34963===t?u.get(n.currentVertexArray).elementArrayBuffer=e:a.set(t,e))}const P={},C={bufferData(t,e,i){if(n.isContextLost)return;const[s,r,,o=0,l]=i;let c;if(c=34963===s?u.get(n.currentVertexArray).elementArrayBuffer:a.get(s),!c)throw new Error(`no buffer bound to ${s}`);let d=0;if(void 0!==l)d=l*r.BYTES_PER_ELEMENT;else if(St(r))d=r.byteLength;else{if(!function(t){return"number"==typeof t}(r))throw new Error(`unsupported bufferData src type ${r}`);d=r}const p=u.get(c);if(!p)throw new Error(`unknown buffer ${c}`);h.buffer-=p.size,p.size=d,h.buffer+=d},bindVertexArray:T,bindVertexArrayOES:T,bindBuffer(t,e,i){const[s,n]=i;M(s,n)},bindBufferBase(t,e,i){const[s,n,r]=i;M(s,r)},bindBufferRange(t,e,i){const[s,n,r,o,a]=i;M(s,r)},bindRenderbuffer(t,e,i){if(n.isContextLost)return;const[s,r]=i;a.set(s,r)},bindTexture(t,e,i){if(n.isContextLost)return;const[s,r]=i;a.set(s,r)},copyTexImage2D(t,e,i){if(n.isContextLost)return;const[s,r,o,a,l,h,c,u]=i;k(S(s),s,r,o,h,c,1,v)},createBuffer:f(t,"buffer"),createFramebuffer:f(t,"framebuffer"),createRenderbuffer:f(t,"renderbuffer"),createProgram:f(t,"program"),createQuery:f(t,"query"),createShader:f(t,"shader"),createSampler:f(t,"sampler"),createTexture:f(t,"texture"),createTransformFeedback:f(t,"transformFeedback"),createVertexArray:f(t,"vertexArray"),createVertexArrayOES:f(t,"vertexArray","createVertexArrayOES"),compressedTexImage2D(t,e,i){if(n.isContextLost)return;const[s,r,o,a,l]=i;k(S(s),s,r,o,a,l,1,v)},compressedTexImage3D(t,e,i){if(n.isContextLost)return;const[s,r,o,a,l,h]=i;k(S(s),s,r,o,a,l,h,v)},deleteBuffer:m("buffer",(function(t,e){h.buffer-=e.size})),deleteFramebuffer:m("framebuffer"),deleteProgram:m("program"),deleteQuery:m("query"),deleteRenderbuffer:m("renderbuffer",(function(t,e){h.renderbuffer-=e.size})),deleteSampler:m("sampler"),deleteShader:m("shader"),deleteSync:m("sync"),deleteTexture:m("texture",(function(t,e){h.texture-=e.size})),deleteTransformFeedback:m("transformFeedback"),deleteVertexArray:m("vertexArray"),deleteVertexArrayOES:m("vertexArray",p,"deleteVertexArrayOES"),fenceSync:function(t){if(!n.isContextLost&&t.fenceSync)return c.sync=0,function(t,e,i,s){++c.sync,u.set(s,{size:0})}}(t),generateMipmap(t,e,i){if(n.isContextLost)return;const[s]=i,r=S(s),o=r.parameters&&r.parameters.get(33084)||0,a=r.parameters&&r.parameters.get(33085)||1024;let{width:l,height:h,depth:c,internalFormat:u,type:d}=r.mips[o][0],p=o+1;const f=s===y?6:1,m=s===y?x:s;for(;p<=a&&(1!==l||1!==h||1!==c&&s!==b);){l=Math.ceil(Math.max(l/2,1)),h=Math.ceil(Math.max(h/2,1)),c=s===b?c:Math.ceil(Math.max(c/2,1));for(let t=0;t<f;++t)k(r,m+t,p,u,l,h,c,d);++p}},getSupportedExtensions(t,e,i,s){n.isContextLost||s.push("GMAN_webgl_memory")},renderbufferStorage(t,e,i){const[s,n,r,o]=i;g(s,1,n,r,o)},renderbufferStorageMultisample(t,e,i){const[s,n,r,o,a]=i;g(s,n,r,o,a)},texImage2D(t,e,i){if(n.isContextLost)return;let s,r,o,[a,l,h]=i;if(6==i.length){const t=i[5];s=t.width,r=t.height,o=i[4]}else s=i[3],r=i[4],o=i[7];k(S(a),a,l,h,s,r,1,o)},texImage3D(t,e,i){if(n.isContextLost)return;let[s,r,o,a,l,h,c,u,d]=i;k(S(s),s,r,o,a,l,h,d)},texParameteri(t,e,i){if(n.isContextLost)return;let[s,r,o]=i;const a=S(s);a.parameters=a.parameters||new Map,a.parameters.set(r,o)},texStorage2D(t,e,i){let[s,n,r,o,a]=i;A(s,n,r,o,a,1)},texStorage3D(t,e,i){let[s,n,r,o,a,l]=i;A(s,n,r,o,a,l)}},_={getExtension(t,e){if(n.isContextLost)return null;const o=t[e];t[e]=function(...e){const n=e[0].toLowerCase(),a=r[n];if(a)return a.ctx;const l=o.call(t,...e);return l&&At(l,n,{...i,origGLErrorFn:s}),l}}};function R(t,e){const i=t[e],n=P[e]||p,r=C[e]||p;if(n===p&&C===p)return;t[e]=function(...s){n(t,e,s);const o=i.call(t,...s);return r(t,e,s,o),o};const o=_[e];o&&o(t,e,s)}for(const e in t)"function"==typeof t[e]&&(d[e]=t[e],R(t,e));r[e.toLowerCase()]={ctx:t,origFuncs:d}}function Tt(t){const e=t.prototype.getContext;t.prototype.getContext=function(t,...i){const s=e.call(this,t,...i);return s&&s.bindTexture&&(At(s,t,{}),s.getExtension("GMAN_webgl_memory")),s}}"undefined"!=typeof HTMLCanvasElement&&Tt(HTMLCanvasElement),"undefined"!=typeof OffscreenCanvas&&Tt(OffscreenCanvas)},"function"==typeof define&&define.amd?define(z):z();class N{constructor(t){this.renderer=t,this.memo=this.renderer.getContext().getExtension("GMAN_webgl_memory")}get(){const t=this.memo.getMemoryInfo(),e=this.renderer.info;return t.engine={geometries:e.memory.geometries,textures:e.memory.textures,calls:e.render.calls,triangles:e.render.triangles,points:e.render.points,lines:e.render.lines},1===t.engine.geometries&&(t.engine.geometries=0),this.format(t)}format(t){let e=t;if(""!==t){for(let e in t.memory)t.memory[e]="drawingbuffer"===e||"total"===e?Math.round(1e-6*t.memory[e])+" Mb":Math.round(.001*t.memory[e])+" Kb";e=JSON.stringify(t,null,2),e=e.replace(/[",.*+?^${}()|[\]\\]/g,"")}return e}}function V(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{l(s.next(t))}catch(t){r(t)}}function a(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}))}const B=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function $(t){return t.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const X="undefined"==typeof window,j=(()=>{if(X)return;const{userAgent:t,platform:e,maxTouchPoints:i}=window.navigator,s=/(iphone|ipod|ipad)/i.test(t),n="iPad"===e||"MacIntel"===e&&i>0&&!window.MSStream;return{isIpad:n,isMobile:/android/i.test(t)||s||n,isSafari12:/Version\/12.+Safari/.test(t)}})();function G(t,e,i){if(!i)return[e];const s=function(t){const e=t.createShader(35633),i=t.createShader(35632),s=t.createProgram();if(!(i&&e&&s))return;t.shaderSource(e,"\n    precision highp float;\n    attribute vec3 aPosition;\n    varying float vvv;\n    void main() {\n      vvv = 0.31622776601683794;\n      gl_Position = vec4(aPosition, 1.0);\n    }\n  "),t.shaderSource(i,"\n    precision highp float;\n    varying float vvv;\n    void main() {\n      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;\n      enc = fract(enc);\n      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n      gl_FragColor = enc;\n    }\n  "),t.compileShader(e),t.compileShader(i),t.attachShader(s,e),t.attachShader(s,i),t.linkProgram(s),t.detachShader(s,e),t.detachShader(s,i),t.deleteShader(e),t.deleteShader(i),t.useProgram(s);const n=t.createBuffer();t.bindBuffer(34962,n),t.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const r=t.getAttribLocation(s,"aPosition");t.vertexAttribPointer(r,3,5126,!1,0,0),t.enableVertexAttribArray(r),t.clearColor(1,1,1,1),t.clear(16384),t.viewport(0,0,1,1),t.drawArrays(4,0,3);const o=new Uint8Array(4);return t.readPixels(0,0,1,1,6408,5121,o),t.deleteProgram(s),t.deleteBuffer(n),o.join("")}(t),n="801621810",r="8016218135",o="80162181161",a=(null==j?void 0:j.isIpad)?[["a7",o,12],["a8",r,15],["a8x",r,15],["a9",r,15],["a9x",r,15],["a10",r,15],["a10x",r,15],["a12",n,15],["a12x",n,15],["a12z",n,15],["a14",n,15],["m1",n,15]]:[["a7",o,12],["a8",r,12],["a9",r,15],["a10",r,15],["a11",n,15],["a12",n,15],["a13",n,15],["a14",n,15]];let l;return"80162181255"===s?l=a.filter((([,,t])=>t>=14)):(l=a.filter((([,t])=>t===s)),l.length||(l=a)),l.map((([t])=>`apple ${t} gpu`))}class Z extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}const q=[],W=[];function H(t,e){if(t===e)return 0;const i=t;t.length>e.length&&(t=e,e=i);let s=t.length,n=e.length;for(;s>0&&t.charCodeAt(~-s)===e.charCodeAt(~-n);)s--,n--;let r,o=0;for(;o<s&&t.charCodeAt(o)===e.charCodeAt(o);)o++;if(s-=o,n-=o,0===s)return n;let a,l,h=0,c=0,u=0;for(;c<s;)W[c]=t.charCodeAt(o+c),q[c]=++c;for(;u<n;)for(r=e.charCodeAt(o+u),a=u++,h=u,c=0;c<s;c++)l=r===W[c]?a:a+1,a=q[c],h=q[c]=a>h?l>h?h+1:l:l>a?a+1:l;return h}function Y(t){return null!=t}const K=({mobileTiers:t=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:i={},glContext:s,failIfMajorPerformanceCaveat:n=!1,benchmarksURL:r="https://unpkg.com/detect-gpu@5.0.15/dist/benchmarks"}={})=>V(void 0,void 0,void 0,(function*(){const o={};if(X)return{tier:0,type:"SSR"};const{isIpad:a=!!(null==j?void 0:j.isIpad),isMobile:l=!!(null==j?void 0:j.isMobile),screenSize:h=window.screen,loadBenchmarks:c=(t=>V(void 0,void 0,void 0,(function*(){const e=yield fetch(`${r}/${t}`).then((t=>t.json()));if(parseInt(e.shift().split(".")[0],10)<4)throw new Z("Detect GPU benchmark data is out of date. Please update to version 4x");return e})))}=i;let{renderer:u}=i;const d=(t,e,i,s,n)=>({device:n,fps:s,gpu:i,isMobile:l,tier:t,type:e});let p,f="";if(u)u=$(u),p=[u];else{const t=s||function(t,e=!1){const i={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:e,powerPreference:"high-performance",stencil:!1};t&&delete i.powerPreference;const s=window.document.createElement("canvas"),n=s.getContext("webgl",i)||s.getContext("experimental-webgl",i);return null!=n?n:void 0}(null==j?void 0:j.isSafari12,n);if(!t)return d(0,"WEBGL_UNSUPPORTED");const e=t.getExtension("WEBGL_debug_renderer_info");if(e&&(u=t.getParameter(e.UNMASKED_RENDERER_WEBGL)),!u)return d(1,"FALLBACK");f=u,u=$(u),p=function(t,e,i){return"apple gpu"===e?G(t,e,i):[e]}(t,u,l)}const m=(yield Promise.all(p.map((function(t){var e;return V(this,void 0,void 0,(function*(){const i=(t=>{const e=l?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce"];for(const i of e)if(t.includes(i))return i})(t);if(!i)return;const s=`${l?"m":"d"}-${i}${a?"-ipad":""}.json`,n=o[s]=null!==(e=o[s])&&void 0!==e?e:c(s);let r;try{r=yield n}catch(i){if(i instanceof Z)throw i;return}const u=function(t){var e;const i=(t=t.replace(/\([^)]+\)/,"")).match(/\d+/)||t.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return null!==(e=null==i?void 0:i.join("").replace(/\W|amd/g,""))&&void 0!==e?e:""}(t);let d=r.filter((([,t])=>t===u));d.length||(d=r.filter((([e])=>e.includes(t))));const p=d.length;if(0===p)return;const f=t.split(/[.,()\[\]/\s]/g).sort().filter(((t,e,i)=>0===e||t!==i[e-1])).join(" ");let m,[g,,,,v]=p>1?d.map((t=>[t,H(f,t[2])])).sort((([,t],[,e])=>t-e))[0][0]:d[0],y=Number.MAX_VALUE;const{devicePixelRatio:b}=window,x=h.width*b*h.height*b;for(const t of v){const[e,i]=t,s=e*i,n=Math.abs(x-s);n<y&&(y=n,m=t)}if(!m)return;const[,,O,w]=m;return[y,O,g,w]}))})))).filter(Y).sort((([t=Number.MAX_VALUE,e],[i=Number.MAX_VALUE,s])=>t===i?e-s:t-i));if(!m.length){const t=B.find((t=>u.includes(t)));return t?d(0,"BLOCKLISTED",t):d(1,"FALLBACK",`${u} (${f})`)}const[,g,v,y]=m[0];if(-1===g)return d(0,"BLOCKLISTED",v,g,y);const b=l?t:e;let x=0;for(let t=0;t<b.length;t++)g>=b[t]&&(x=t);return d(x,"BENCHMARK",v,g,y)}));var J={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-J.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*J.Bounce.In(2*t):.5*J.Bounce.Out(2*t-1)+.5}}},tt="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},et=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},t.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},t.prototype.update=function(t,e){void 0===t&&(t=tt()),void 0===e&&(e=!1);var i=Object.keys(this._tweens);if(0===i.length)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var s=0;s<i.length;s++){var n=this._tweens[i[s]],r=!e;n&&!1===n.update(t,r)&&!e&&delete this._tweens[i[s]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),it={Linear:function(t,e){var i=t.length-1,s=i*e,n=Math.floor(s),r=it.Utils.Linear;return e<0?r(t[0],t[1],s):e>1?r(t[i],t[i-1],i-s):r(t[n],t[n+1>i?i:n+1],s-n)},Bezier:function(t,e){for(var i=0,s=t.length-1,n=Math.pow,r=it.Utils.Bernstein,o=0;o<=s;o++)i+=n(1-e,s-o)*n(e,o)*t[o]*r(s,o);return i},CatmullRom:function(t,e){var i=t.length-1,s=i*e,n=Math.floor(s),r=it.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(n=Math.floor(s=i*(1+e))),r(t[(n-1+i)%i],t[n],t[(n+1)%i],t[(n+2)%i],s-n)):e<0?t[0]-(r(t[0],t[0],t[1],t[1],-s)-t[0]):e>1?t[i]-(r(t[i],t[i],t[i-1],t[i-1],s-i)-t[i]):r(t[n?n-1:0],t[n],t[i<n+1?i:n+1],t[i<n+2?i:n+2],s-n)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=it.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){var t=[1];return function(e){var i=1;if(t[e])return t[e];for(var s=e;s>1;s--)i*=s;return t[e]=i,i}}(),CatmullRom:function(t,e,i,s,n){var r=.5*(i-t),o=.5*(s-e),a=n*n;return(2*e-2*i+r+o)*(n*a)+(-3*e+3*i-2*r-o)*a+r*n+e}}},st=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),nt=new et,rt=function(){function t(t,e){void 0===e&&(e=nt),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=J.Linear.None,this._interpolationFunction=it.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=st.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},t.prototype.duration=function(t){return this._duration=t,this},t.prototype.start=function(t){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var e in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==t?"string"==typeof t?tt()+parseFloat(t):t:tt(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},t.prototype._setupProperties=function(t,e,i,s){for(var n in i){var r=t[n],o=Array.isArray(r),a=o?"array":typeof r,l=!o&&Array.isArray(i[n]);if("undefined"!==a&&"function"!==a){if(l){var h=i[n];if(0===h.length)continue;h=h.map(this._handleRelativeValue.bind(this,r)),i[n]=[r].concat(h)}if("object"!==a&&!o||!r||l)void 0===e[n]&&(e[n]=r),o||(e[n]*=1),s[n]=l?i[n].slice().reverse():e[n]||0;else{for(var c in e[n]=o?[]:{},r)e[n][c]=r[c];s[n]=o?[]:{},this._setupProperties(r,e[n],i[n],s[n])}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},t.prototype.pause=function(t){return void 0===t&&(t=tt()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this)),this},t.prototype.resume=function(t){return void 0===t&&(t=tt()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return this._group=t,this},t.prototype.delay=function(t){return this._delayTime=t,this},t.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return this._yoyo=t,this},t.prototype.easing=function(t){return this._easingFunction=t,this},t.prototype.interpolation=function(t){return this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(t,e){if(void 0===t&&(t=tt()),void 0===e&&(e=!0),this._isPaused)return!0;var i,s,n=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>n)return!1;e&&this.start(t)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),s=(t-this._startTime)/this._duration,s=0===this._duration||s>1?1:s;var r=this._easingFunction(s);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,r),this._onUpdateCallback&&this._onUpdateCallback(this._object,s),1===s){if(this._repeat>0){for(i in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[i]||(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var o=0,a=this._chainedTweens.length;o<a;o++)this._chainedTweens[o].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,i,s){for(var n in i)if(void 0!==e[n]){var r=e[n]||0,o=i[n],a=Array.isArray(t[n]),l=Array.isArray(o);!a&&l?t[n]=this._interpolationFunction(o,s):"object"==typeof o&&o?this._updateProperties(t[n],r,o,s):"number"==typeof(o=this._handleRelativeValue(r,o))&&(t[n]=r+(o-r)*s)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],i=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof i?this._valuesStartRepeat[t]+parseFloat(i):this._valuesEnd[t],this._valuesEnd[t]=e},t}();st.nextId;var ot=nt;ot.getAll.bind(ot),ot.removeAll.bind(ot),ot.add.bind(ot);var at=ot.remove.bind(ot);ot.update.bind(ot);const lt={type:"change"},ht={type:"start"},ct={type:"end"},ut=new e.Ray,dt=new e.Plane,pt=Math.cos(70*e.MathUtils.DEG2RAD);class ft extends e.EventDispatcher{constructor(t,i){super(),this.object=t,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new e.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:e.MOUSE.ROTATE,MIDDLE:e.MOUSE.DOLLY,RIGHT:e.MOUSE.PAN},this.touches={ONE:e.TOUCH.ROTATE,TWO:e.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getSpherical=function(){return a},this.getState=function(){return r},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",Z),this._domElementKeyEvents=t},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Z),this._domElementKeyEvents=null},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(lt),s.update(),r=n.NONE},this.update=function(){const i=new e.Vector3,u=(new e.Quaternion).setFromUnitVectors(t.up,new e.Vector3(0,1,0)),d=u.clone().invert(),p=new e.Vector3,f=new e.Quaternion,m=new e.Vector3,g=2*Math.PI;return function(v=null){const y=s.object.position;i.copy(y).sub(s.target),i.applyQuaternion(u),a.setFromVector3(i),s.autoRotate&&r===n.NONE&&T(function(t){return null!==t?2*Math.PI/60*s.autoRotateSpeed*t:2*Math.PI/60/60*s.autoRotateSpeed}(v)),s.enableDamping?(a.theta+=l.theta*s.dampingFactor,a.phi+=l.phi*s.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let b=s.minAzimuthAngle,S=s.maxAzimuthAngle;isFinite(b)&&isFinite(S)&&(b<-Math.PI?b+=g:b>Math.PI&&(b-=g),S<-Math.PI?S+=g:S>Math.PI&&(S-=g),a.theta=b<=S?Math.max(b,Math.min(S,a.theta)):a.theta>(b+S)/2?Math.max(b,a.theta):Math.min(S,a.theta)),a.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,a.phi)),a.makeSafe(),!0===s.enableDamping?s.target.addScaledVector(c,s.dampingFactor):s.target.add(c),s.zoomToCursor&&w||s.object.isOrthographicCamera?a.radius=L(a.radius):a.radius=L(a.radius*h),i.setFromSpherical(a),i.applyQuaternion(d),y.copy(s.target).add(i),s.object.lookAt(s.target),!0===s.enableDamping?(l.theta*=1-s.dampingFactor,l.phi*=1-s.dampingFactor,c.multiplyScalar(1-s.dampingFactor)):(l.set(0,0,0),c.set(0,0,0));let k=!1;if(s.zoomToCursor&&w){let n=null;if(s.object.isPerspectiveCamera){const t=i.length();n=L(t*h);const e=t-n;s.object.position.addScaledVector(x,e),s.object.updateMatrixWorld()}else if(s.object.isOrthographicCamera){const t=new e.Vector3(O.x,O.y,0);t.unproject(s.object),s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/h)),s.object.updateProjectionMatrix(),k=!0;const r=new e.Vector3(O.x,O.y,0);r.unproject(s.object),s.object.position.sub(r).add(t),s.object.updateMatrixWorld(),n=i.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),s.zoomToCursor=!1;null!==n&&(this.screenSpacePanning?s.target.set(0,0,-1).transformDirection(s.object.matrix).multiplyScalar(n).add(s.object.position):(ut.origin.copy(s.object.position),ut.direction.set(0,0,-1).transformDirection(s.object.matrix),Math.abs(s.object.up.dot(ut.direction))<pt?t.lookAt(s.target):(dt.setFromNormalAndCoplanarPoint(s.object.up,s.target),ut.intersectPlane(dt,s.target))))}else s.object.isOrthographicCamera&&(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/h)),s.object.updateProjectionMatrix(),k=!0);return h=1,w=!1,!!(k||p.distanceToSquared(s.object.position)>o||8*(1-f.dot(s.object.quaternion))>o||m.distanceToSquared(s.target)>0)&&(s.dispatchEvent(lt),p.copy(s.object.position),f.copy(s.object.quaternion),m.copy(s.target),k=!1,!0)}}(),this.dispose=function(){s.domElement.removeEventListener("contextmenu",q),s.domElement.removeEventListener("pointerdown",$),s.domElement.removeEventListener("pointercancel",j),s.domElement.removeEventListener("wheel",G),s.domElement.removeEventListener("pointermove",X),s.domElement.removeEventListener("pointerup",j),null!==s._domElementKeyEvents&&(s._domElementKeyEvents.removeEventListener("keydown",Z),s._domElementKeyEvents=null)};const s=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=n.NONE;const o=1e-6,a=new e.Spherical,l=new e.Spherical;let h=1;const c=new e.Vector3,u=new e.Vector2,d=new e.Vector2,p=new e.Vector2,f=new e.Vector2,m=new e.Vector2,g=new e.Vector2,v=new e.Vector2,y=new e.Vector2,b=new e.Vector2,x=new e.Vector3,O=new e.Vector2;let w=!1;const S=[],k={};function A(){return Math.pow(.95,s.zoomSpeed)}function T(t){l.theta-=t}function M(t){l.phi-=t}const P=function(){const t=new e.Vector3;return function(e,i){t.setFromMatrixColumn(i,0),t.multiplyScalar(-e),c.add(t)}}(),C=function(){const t=new e.Vector3;return function(e,i){!0===s.screenSpacePanning?t.setFromMatrixColumn(i,1):(t.setFromMatrixColumn(i,0),t.crossVectors(s.object.up,t)),t.multiplyScalar(e),c.add(t)}}(),_=function(){const t=new e.Vector3;return function(e,i){const n=s.domElement;if(s.object.isPerspectiveCamera){const r=s.object.position;t.copy(r).sub(s.target);let o=t.length();o*=Math.tan(s.object.fov/2*Math.PI/180),P(2*e*o/n.clientHeight,s.object.matrix),C(2*i*o/n.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(P(e*(s.object.right-s.object.left)/s.object.zoom/n.clientWidth,s.object.matrix),C(i*(s.object.top-s.object.bottom)/s.object.zoom/n.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function R(t){s.object.isPerspectiveCamera||s.object.isOrthographicCamera?h/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function E(t){s.object.isPerspectiveCamera||s.object.isOrthographicCamera?h*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function Q(t){if(!s.zoomToCursor)return;w=!0;const e=s.domElement.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top,r=e.width,o=e.height;O.x=i/r*2-1,O.y=-n/o*2+1,x.set(O.x,O.y,1).unproject(s.object).sub(s.object.position).normalize()}function L(t){return Math.max(s.minDistance,Math.min(s.maxDistance,t))}function F(t){u.set(t.clientX,t.clientY)}function I(t){f.set(t.clientX,t.clientY)}function D(){if(1===S.length)u.set(S[0].pageX,S[0].pageY);else{const t=.5*(S[0].pageX+S[1].pageX),e=.5*(S[0].pageY+S[1].pageY);u.set(t,e)}}function U(){if(1===S.length)f.set(S[0].pageX,S[0].pageY);else{const t=.5*(S[0].pageX+S[1].pageX),e=.5*(S[0].pageY+S[1].pageY);f.set(t,e)}}function z(){const t=S[0].pageX-S[1].pageX,e=S[0].pageY-S[1].pageY,i=Math.sqrt(t*t+e*e);v.set(0,i)}function N(t){if(1==S.length)d.set(t.pageX,t.pageY);else{const e=H(t),i=.5*(t.pageX+e.x),s=.5*(t.pageY+e.y);d.set(i,s)}p.subVectors(d,u).multiplyScalar(s.rotateSpeed);const e=s.domElement;T(2*Math.PI*p.x/e.clientHeight),M(2*Math.PI*p.y/e.clientHeight),u.copy(d)}function V(t){if(1===S.length)m.set(t.pageX,t.pageY);else{const e=H(t),i=.5*(t.pageX+e.x),s=.5*(t.pageY+e.y);m.set(i,s)}g.subVectors(m,f).multiplyScalar(s.panSpeed),_(g.x,g.y),f.copy(m)}function B(t){const e=H(t),i=t.pageX-e.x,n=t.pageY-e.y,r=Math.sqrt(i*i+n*n);y.set(0,r),b.set(0,Math.pow(y.y/v.y,s.zoomSpeed)),R(b.y),v.copy(y)}function $(t){!1!==s.enabled&&(0===S.length&&(s.domElement.setPointerCapture(t.pointerId),s.domElement.addEventListener("pointermove",X),s.domElement.addEventListener("pointerup",j)),function(t){S.push(t)}(t),"touch"===t.pointerType?function(t){switch(W(t),S.length){case 1:switch(s.touches.ONE){case e.TOUCH.ROTATE:if(!1===s.enableRotate)return;D(),r=n.TOUCH_ROTATE;break;case e.TOUCH.PAN:if(!1===s.enablePan)return;U(),r=n.TOUCH_PAN;break;default:r=n.NONE}break;case 2:switch(s.touches.TWO){case e.TOUCH.DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;s.enableZoom&&z(),s.enablePan&&U(),r=n.TOUCH_DOLLY_PAN;break;case e.TOUCH.DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;s.enableZoom&&z(),s.enableRotate&&D(),r=n.TOUCH_DOLLY_ROTATE;break;default:r=n.NONE}break;default:r=n.NONE}r!==n.NONE&&s.dispatchEvent(ht)}(t):function(t){let i;switch(t.button){case 0:i=s.mouseButtons.LEFT;break;case 1:i=s.mouseButtons.MIDDLE;break;case 2:i=s.mouseButtons.RIGHT;break;default:i=-1}switch(i){case e.MOUSE.DOLLY:if(!1===s.enableZoom)return;!function(t){Q(t),v.set(t.clientX,t.clientY)}(t),r=n.DOLLY;break;case e.MOUSE.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===s.enablePan)return;I(t),r=n.PAN}else{if(!1===s.enableRotate)return;F(t),r=n.ROTATE}break;case e.MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===s.enableRotate)return;F(t),r=n.ROTATE}else{if(!1===s.enablePan)return;I(t),r=n.PAN}break;default:r=n.NONE}r!==n.NONE&&s.dispatchEvent(ht)}(t))}function X(t){!1!==s.enabled&&("touch"===t.pointerType?function(t){switch(W(t),r){case n.TOUCH_ROTATE:if(!1===s.enableRotate)return;N(t),s.update();break;case n.TOUCH_PAN:if(!1===s.enablePan)return;V(t),s.update();break;case n.TOUCH_DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(t){s.enableZoom&&B(t),s.enablePan&&V(t)}(t),s.update();break;case n.TOUCH_DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;!function(t){s.enableZoom&&B(t),s.enableRotate&&N(t)}(t),s.update();break;default:r=n.NONE}}(t):function(t){switch(r){case n.ROTATE:if(!1===s.enableRotate)return;!function(t){d.set(t.clientX,t.clientY),p.subVectors(d,u).multiplyScalar(s.rotateSpeed);const e=s.domElement;T(2*Math.PI*p.x/e.clientHeight),M(2*Math.PI*p.y/e.clientHeight),u.copy(d),s.update()}(t);break;case n.DOLLY:if(!1===s.enableZoom)return;!function(t){y.set(t.clientX,t.clientY),b.subVectors(y,v),b.y>0?R(A()):b.y<0&&E(A()),v.copy(y),s.update()}(t);break;case n.PAN:if(!1===s.enablePan)return;!function(t){m.set(t.clientX,t.clientY),g.subVectors(m,f).multiplyScalar(s.panSpeed),_(g.x,g.y),f.copy(m),s.update()}(t)}}(t))}function j(t){!function(t){delete k[t.pointerId];for(let e=0;e<S.length;e++)if(S[e].pointerId==t.pointerId)return void S.splice(e,1)}(t),0===S.length&&(s.domElement.releasePointerCapture(t.pointerId),s.domElement.removeEventListener("pointermove",X),s.domElement.removeEventListener("pointerup",j)),s.dispatchEvent(ct),r=n.NONE}function G(t){!1!==s.enabled&&!1!==s.enableZoom&&r===n.NONE&&(t.preventDefault(),s.dispatchEvent(ht),function(t){Q(t),t.deltaY<0?E(A()):t.deltaY>0&&R(A()),s.update()}(t),s.dispatchEvent(ct))}function Z(t){!1!==s.enabled&&!1!==s.enablePan&&function(t){let e=!1;switch(t.code){case s.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?M(2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):_(0,s.keyPanSpeed),e=!0;break;case s.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?M(-2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):_(0,-s.keyPanSpeed),e=!0;break;case s.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?T(2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):_(s.keyPanSpeed,0),e=!0;break;case s.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?T(-2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):_(-s.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),s.update())}(t)}function q(t){!1!==s.enabled&&t.preventDefault()}function W(t){let i=k[t.pointerId];void 0===i&&(i=new e.Vector2,k[t.pointerId]=i),i.set(t.pageX,t.pageY)}function H(t){const e=t.pointerId===S[0].pointerId?S[1]:S[0];return k[e.pointerId]}s.domElement.addEventListener("contextmenu",q),s.domElement.addEventListener("pointerdown",$),s.domElement.addEventListener("pointercancel",j),s.domElement.addEventListener("wheel",G,{passive:!1}),this.update()}}const mt={torad:Math.PI/180,todeg:180/Math.PI,Pi:Math.PI,TwoPI:2*Math.PI,PI90:.5*Math.PI,PI45:.25*Math.PI,PI270:.5*Math.PI*3,inv255:.003921569,golden:1.618033,epsilon:Math.pow(2,-52),randomSign:()=>Math.random()<.5?-1:1,randSpread:t=>t*(.5-Math.random()),rand:(t=0,e=1)=>t+Math.random()*(e-t),randInt:(t,e)=>t+Math.floor(Math.random()*(e-t+1)),toFixed:(t,e=3)=>1*t.toFixed(e),int:t=>Math.floor(t),lerp:(t,e,i)=>(1-i)*t+i*e,clamp:(t,e,i)=>Math.max(e,Math.min(i,t)),nearEquals:(t,e,i)=>Math.abs(t-e)<=i,lerpAr:(t,e,i,s)=>{let n=t.length;for(;n--;)t[n]=mt.lerp(e[n],i[n],s)},unwrapDeg:t=>t-360*Math.floor((t+180)/360),unwrapRad:t=>Math.atan2(Math.sin(t),Math.cos(t)),scaleArray:(t,e)=>{for(var i=t.length;i--;)t[i]*=e;return t},addArray:(t,e)=>{for(var i=[],s=t.length;s--;)i[s]=t[s]+e[s];return i},angleDistance:(t,e)=>{var i=(t-e+180)%360-180;return i<-180?i+360:i},tmpE:new e.Euler,tmpM:new e.Matrix4,tmpM2:new e.Matrix4,tmpV:new e.Vector3,tmpQ:new e.Quaternion,fromTransformToQ:(t,e,i)=>(i=i||!1,mt.tmpM.compose(mt.tmpV.fromArray(t),mt.tmpQ.fromArray(e),{x:1,y:1,z:1}),mt.tmpM.decompose(mt.tmpV,mt.tmpQ,{x:1,y:1,z:1}),i&&mt.tmpQ.invert(),mt.tmpQ.toArray()),fromTransform:(t,e,i,s,n)=>(n=n||!1,s=s||[0,0,0,1],mt.tmpM.compose(mt.tmpV.fromArray(t),mt.tmpQ.fromArray(e),{x:1,y:1,z:1}),mt.tmpM2.compose(mt.tmpV.fromArray(i),mt.tmpQ.fromArray(s),{x:1,y:1,z:1}),n?(mt.tmpM.invert(),mt.tmpM.multiply(mt.tmpM2)):mt.tmpM.multiply(mt.tmpM2),mt.tmpM.decompose(mt.tmpV,mt.tmpQ,{x:1,y:1,z:1}),mt.tmpV.toArray()),arCopy:(t,e)=>{},axisToQuatArray:(t,e)=>(e=e||!1,mt.tmpQ.setFromAxisAngle(mt.tmpV.fromArray(t,1),e?t[0]*mt.torad:t[0]).normalize().toArray()),toQuatArray:t=>mt.tmpQ.setFromEuler(mt.tmpE.fromArray(mt.vectorad(t))).toArray(),vectorad:t=>{let e=3,i=[];for(;e--;)i[e]=t[e]*mt.torad;return i[3]=t[3],i},rgbToHex:t=>"0x"+("000000"+(255*t[0]<<16^255*t[1]<<8^255*t[2]<<0).toString(16)).slice(-6),hexToRgb:t=>[((t=Math.floor(t))>>16&255)/255,(t>>8&255)/255,(255&t)/255],htmlToHex:t=>t.toUpperCase().replace("#","0x"),hexToHtml:t=>"#"+("000000"+(t=void 0===t?0:t).toString(16)).substr(-6),rgbToHtml:t=>"#"+("000000"+(255*t[0]<<16^255*t[1]<<8^255*t[2]<<0).toString(16)).slice(-6),perlin:null,resetPerlin:()=>{null!==mt.perlin&&(mt.perlin=null)},noise:(t,e)=>{null===mt.perlin&&(mt.perlin=new gt);let i,s,n=(e=e||{}).level||[1,.2,.05],r=e.frequency||[.016,.05,.2],o=0,a=0;for(i=0;i<n.length;i++)s=r[i],o+=n[i]*(.5+.5*mt.perlin.noise3d(t.x*s,t.y*s,t.z*s)),a+=n[i];return o/=a,o}};class gt{constructor(t){null==t&&(t=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var e=0;e<256;e++)this.p[e]=Math.floor(256*t.random());this.perm=[];for(e=0;e<512;e++)this.perm[e]=this.p[255&e];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(t,e,i){return t[0]*e+t[1]*i}dot3(t,e,i,s){return t[0]*e+t[1]*i+t[2]*s}dot4(t,e,i,s,n){return t[0]*e+t[1]*i+t[2]*s+t[3]*n}noise(t,e){var i,s,n=(t+e)*(.5*(Math.sqrt(3)-1)),r=Math.floor(t+n),o=Math.floor(e+n),a=(3-Math.sqrt(3))/6,l=(r+o)*a,h=t-(r-l),c=e-(o-l);h>c?(i=1,s=0):(i=0,s=1);var u=h-i+a,d=c-s+a,p=h-1+2*a,f=c-1+2*a,m=255&r,g=255&o,v=this.perm[m+this.perm[g]]%12,y=this.perm[m+i+this.perm[g+s]]%12,b=this.perm[m+1+this.perm[g+1]]%12,x=.5-h*h-c*c,O=.5-u*u-d*d,w=.5-p*p-f*f;return 70*((x<0?0:(x*=x)*x*this.dot(this.grad3[v],h,c))+(O<0?0:(O*=O)*O*this.dot(this.grad3[y],u,d))+(w<0?0:(w*=w)*w*this.dot(this.grad3[b],p,f)))}noise3d(t,e,i){var s,n,r,o,a,l,h=(t+e+i)*(1/3),c=Math.floor(t+h),u=Math.floor(e+h),d=Math.floor(i+h),p=1/6,f=(c+u+d)*p,m=t-(c-f),g=e-(u-f),v=i-(d-f);m>=g?g>=v?(s=1,n=0,r=0,o=1,a=1,l=0):m>=v?(s=1,n=0,r=0,o=1,a=0,l=1):(s=0,n=0,r=1,o=1,a=0,l=1):g<v?(s=0,n=0,r=1,o=0,a=1,l=1):m<v?(s=0,n=1,r=0,o=0,a=1,l=1):(s=0,n=1,r=0,o=1,a=1,l=0);var y=m-s+p,b=g-n+p,x=v-r+p,O=m-o+2*p,w=g-a+2*p,S=v-l+2*p,k=m-1+.5,A=g-1+.5,T=v-1+.5,M=255&c,P=255&u,C=255&d,_=this.perm[M+this.perm[P+this.perm[C]]]%12,R=this.perm[M+s+this.perm[P+n+this.perm[C+r]]]%12,E=this.perm[M+o+this.perm[P+a+this.perm[C+l]]]%12,Q=this.perm[M+1+this.perm[P+1+this.perm[C+1]]]%12,L=.6-m*m-g*g-v*v,F=.6-y*y-b*b-x*x,I=.6-O*O-w*w-S*S,D=.6-k*k-A*A-T*T;return 32*((L<0?0:(L*=L)*L*this.dot3(this.grad3[_],m,g,v))+(F<0?0:(F*=F)*F*this.dot3(this.grad3[R],y,b,x))+(I<0?0:(I*=I)*I*this.dot3(this.grad3[E],O,w,S))+(D<0?0:(D*=D)*D*this.dot3(this.grad3[Q],k,A,T)))}noise4d(t,e,i,s){var n,r,o,a,l,h,c,u,d,p,f,m,g=this.grad4,v=this.simplex,y=this.perm,b=(Math.sqrt(5)-1)/4,x=(5-Math.sqrt(5))/20,O=(t+e+i+s)*b,w=Math.floor(t+O),S=Math.floor(e+O),k=Math.floor(i+O),A=Math.floor(s+O),T=(w+S+k+A)*x,M=t-(w-T),P=e-(S-T),C=i-(k-T),_=s-(A-T),R=(M>P?32:0)+(M>C?16:0)+(P>C?8:0)+(M>_?4:0)+(P>_?2:0)+(C>_?1:0),E=M-(n=v[R][0]>=3?1:0)+x,Q=P-(r=v[R][1]>=3?1:0)+x,L=C-(o=v[R][2]>=3?1:0)+x,F=_-(a=v[R][3]>=3?1:0)+x,I=M-(l=v[R][0]>=2?1:0)+2*x,D=P-(h=v[R][1]>=2?1:0)+2*x,U=C-(c=v[R][2]>=2?1:0)+2*x,z=_-(u=v[R][3]>=2?1:0)+2*x,N=M-(d=v[R][0]>=1?1:0)+3*x,V=P-(p=v[R][1]>=1?1:0)+3*x,B=C-(f=v[R][2]>=1?1:0)+3*x,$=_-(m=v[R][3]>=1?1:0)+3*x,X=M-1+4*x,j=P-1+4*x,G=C-1+4*x,Z=_-1+4*x,q=255&w,W=255&S,H=255&k,Y=255&A,K=y[q+y[W+y[H+y[Y]]]]%32,J=y[q+n+y[W+r+y[H+o+y[Y+a]]]]%32,tt=y[q+l+y[W+h+y[H+c+y[Y+u]]]]%32,et=y[q+d+y[W+p+y[H+f+y[Y+m]]]]%32,it=y[q+1+y[W+1+y[H+1+y[Y+1]]]]%32,st=.6-M*M-P*P-C*C-_*_,nt=.6-E*E-Q*Q-L*L-F*F,rt=.6-I*I-D*D-U*U-z*z,ot=.6-N*N-V*V-B*B-$*$,at=.6-X*X-j*j-G*G-Z*Z;return 27*((st<0?0:(st*=st)*st*this.dot4(g[K],M,P,C,_))+(nt<0?0:(nt*=nt)*nt*this.dot4(g[J],E,Q,L,F))+(rt<0?0:(rt*=rt)*rt*this.dot4(g[tt],I,D,U,z))+(ot<0?0:(ot*=ot)*ot*this.dot4(g[et],N,V,B,$))+(at<0?0:(at*=at)*at*this.dot4(g[it],X,j,G,Z)))}}class vt extends ft{constructor(t,i,s){super(t,i),this.followTarget=null,this.camTween=[],this.isDecal=!1,this.isInDecal=!1,this.tmpP=new e.Vector3,this.tmpQ=new e.Quaternion,this.cam={stiffness:.15,stiffnessTarget:1,theta:180,phi:20,distance:10,maxDistance:10,height:.6,v:new e.Vector3,d:new e.Vector3,tmp:new e.Vector3,oldp:new e.Vector3,oldq:new e.Quaternion,offset:new e.Vector3,position:new e.Vector3,decal:new e.Vector3,multy:1,clipper:!0,forceFree:!1,simple:!1},this.reverse=!1,this.followGroup=s,this.tmpMatrix=new e.Matrix4,this.tmpE=new e.Euler,this.tmpV=new e.Vector3,this.info={x:0,y:0,z:0,distance:0,phi:0,theta:0,fov:0,zoom:0},this.getInfo(),this.isFree=!0,this.rayClipper=null,this.tmpV1=new e.Vector3}upExtra(t){this.cam.distance*=t}startFollow(t,e){void 0!==e.d&&(e.distance=e.d),void 0!==e.h&&(e.theta=e.h),void 0!==e.v&&(e.phi=e.v),this.moveCam(e);let i=this.cam;if(i.simple=void 0!==e.simple&&e.simple,i.stiffness=void 0!==e.stiffness?e.stiffness:.15,i.stiffnessTarget=void 0!==e.stiffnessTarget?e.stiffnessTarget:1,i.height=void 0!==e.height?e.height:.6,i.d.set(0,this.cam.height,0),i.theta=void 0!==e.theta?e.theta:180,i.phi=void 0!==e.phi?e.phi:20,i.distance=void 0!==e.distance?e.distance:10,i.maxDistance=i.distance,i.rotation=void 0===e.rotation||e.rotation,i.offset.set(0,0,0),i.decal.fromArray(void 0!==e.decal?e.decal:[0,0,0]),void 0!==e.dx&&(i.decal.x=e.dx),void 0!==e.dy&&(i.decal.y=e.dy),void 0!==e.dz&&(i.decal.z=e.dz),i.clipper=e.clipper||!1,i.exr=e.exr||0,i.forceFree=e.forceFree||!1,e.direct)return this.enablePan=!1,void this.initFollow(t,e);let s=this.getTargetStart(t);e.target=s.p,e.theta=mt.unwrapDeg(e.theta+s.r);var n=e.callback;e.callback=function(){n&&n(),this.initFollow(t,e)}.bind(this)}getTargetStart(t){t.updateMatrix(),this.tmpMatrix.makeRotationFromQuaternion(t.quaternion);let e=this.cam,i=Math.atan2(this.tmpMatrix.elements[8],this.tmpMatrix.elements[10]);return 0===e.decal.x&&0===e.decal.z||e.offset.copy(e.position).add(e.decal).applyAxisAngle({x:0,y:1,z:0},i),{p:e.tmp.copy(t.position).add(e.offset).add(e.d).toArray(),r:i*mt.todeg}}initFollow(t,e){this.enableDamping=!1,this.screenSpacePanning=!1,this.cam.oldp.copy(t.position),this.cam.oldq.copy(t.quaternion),this.stopMoveCam(),this.followTarget=t}onRayClipper(t){t.hit?this.cam.distance=mt.clamp(t.distance,this.minDistance,this.cam.maxDistance):this.cam.distance<this.cam.maxDistance&&(this.cam.distance+=this.cam.maxDistance/16),this.maxDistance=this.cam.distance}resetAll(){this.enablePan=!0,this.enableDamping=!0,this.screenSpacePanning=!0,this.stopMoveCam(),this.resetFov(),this.resetFollow(),this.setLimite(),this.reverse=!1}setLimite(t){t=t||{},this.minPolarAngle=void 0!==t.minV?(90-t.minV)*mt.torad:0,this.maxPolarAngle=void 0!==t.maxV?(90-t.maxV)*mt.torad:Math.PI,this.minAzimuthAngle=void 0!==t.minH?t.minH*mt.torad:-1/0,this.maxAzimuthAngle=void 0!==t.maxH?t.maxH*mt.torad:1/0,this.minDistance=void 0!==t.minD?t.minD:.01,this.maxDistance=void 0!==t.maxD?t.maxD:1/0}resetFov(){this.object.fov=50,this.object.zoom=1,this.object.updateProjectionMatrix()}resetFollow(){this.followGroup.position.set(0,0,0),this.followTarget=null,this.enabled=!0}follow(t){if(!this.followTarget)return;const e=this.cam,i=this.object,s=this.target,n=this.getSpherical(),r=this.getState();this.tmpP.copy(this.followTarget.position),this.tmpQ.copy(this.followTarget.quaternion);let o=this.tmpP,a=this.tmpQ,l=(90-e.phi)*mt.torad,h=e.distance;if(e.simple)return this.tmpV.copy(e.decal),this.tmpV.applyAxisAngle({x:0,y:1,z:0},n.theta),s.copy(o).add(this.tmpV),i.position.setFromSpherical(n).add(s),i.lookAt(s),void this.updateFollowGroup();this.tmpMatrix.makeRotationFromQuaternion(a);let c=Math.atan2(this.tmpMatrix.elements[8],this.tmpMatrix.elements[10]),u=e.theta*mt.torad+c;this.isFree=!1;var d=o.distanceTo(e.oldp),p=a.x-e.oldq.x,f=a.y-e.oldq.y,m=a.z-e.oldq.z,g=a.w-e.oldq.w,v=Math.sqrt(p*p+f*f+m*m+g*g);this.enabled?0===r||3===r||d<.01&&v<.001?this.isFree=!0:e.forceFree||n.set(h,l,u):n.set(h,l,u),this.tmpV.copy(e.decal).applyAxisAngle({x:1,y:0,z:0},l-mt.PI90),e.offset.copy(e.position).add(this.tmpV).applyAxisAngle({x:0,y:1,z:0},c),e.v.copy(o).add(e.offset).add(e.d),e.tmp.setFromSpherical(n).add(e.v),this.reverse?(1!==e.stiffnessTarget?i.position.lerp(e.v,e.stiffnessTarget):i.position.copy(e.v),this.isDecal?s.copy(e.tmp):s.lerp(e.tmp,e.stiffness)):(this.isDecal?i.position.copy(e.tmp):i.position.lerp(e.tmp,e.stiffness),1!==e.stiffnessTarget?s.lerp(e.v,e.stiffnessTarget):s.copy(e.v)),i.lookAt(s),this.updateFollowGroup(),e.oldp.copy(o),e.oldq.copy(a),this.isInDecal&&(this.isDecal=!1,this.isInDecal=!1),this.isDecal&&(this.isInDecal=!0),this.cam.clipper&&(this.rayClipper.start.copy(o).add(e.offset).add(e.d),this.tmpV1.set(0,0,-1).applyQuaternion(i.quaternion).normalize().multiplyScalar(e.maxDistance),this.rayClipper.end.copy(this.rayClipper.start).sub(this.tmpV1))}updateFollowGroup(){this.followGroup.position.copy(this.target)}getInfo(){this.update();var t=this.target,e=this.object,i=this.getSpherical();this.info.x=t.x,this.info.y=t.y,this.info.z=t.z,this.object.dist=i.radius,this.info.distance=i.radius,this.info.phi=mt.unwrapDeg(90-Math.floor(i.phi*mt.todeg)),this.info.theta=mt.unwrapDeg(Math.floor(i.theta*mt.todeg)),this.info.fov=e.fov,this.info.zoom=e.zoom}stopMoveCam(){for(var t=this.camTween.length;t--;)at(this.camTween[t]),this.camTween[t]=null;this.camTween=[],this.getInfo()}moveCam(t={}){this.followTarget&&this.resetFollow();var e=this;this.getInfo();var i={};void 0!==t.phi&&(i.phi=t.phi),void 0!==t.theta&&(i.theta=t.theta),void 0!==t.distance&&(i.distance=t.distance),void 0!==t.v&&(i.phi=t.v),void 0!==t.h&&(i.theta=t.h),void 0!==t.d&&(i.distance=t.d),void 0!==t.fov&&(i.fov=t.fov),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.x&&(i.x=t.x),void 0!==t.y&&(i.y=t.y),void 0!==t.z&&(i.z=t.z);var s=void 0===t.shortest||t.shortest;if(void 0!==i.theta&&s){var n=this.getSpherical().theta*mt.todeg;i.theta=n+mt.angleDistance(i.theta,n)}var r=void 0!==t.time?t.time:0,o=void 0!==t.tween?t.tween:J.Quadratic.Out,a=void 0!==t.delay?t.delay:0;this.enabled=!1;var l=[];for(var h in i)l[h]=this.info[h];var c=t.callback||function(){};if(0===r){for(var h in i)l[h]=i[h];return this.stopMoveCam(),this.orbit(l),this.enabled=!0,void c()}var u=new rt(l).to(i,r).delay(a).easing(o).onUpdate((function(t){e.orbit(t)})).onComplete((function(){e.enabled=!0,c()})).start();this.camTween.push(u)}zommer(t,e,i){this.stopMoveCam();var s=this.cam,n=this.object,r={zoom:t.zoom,fov:t.fov,distance:t.distance,dx:void 0!==t.dx?t.dx:s.decal.x,dy:void 0!==t.dy?t.dy:s.decal.y,dz:void 0!==t.dz?t.dz:s.decal.z,exr:void 0!==t.exr?t.exr:s.exr,multy:void 0!==t.multy?t.multy:s.multy},o=new rt({zoom:n.zoom,fov:n.fov,distance:s.distance,dx:s.decal.x,dy:s.decal.y,dz:s.decal.z,exr:s.exr,multy:s.multy}).to(r,e||300).onUpdate((function(t){n.fov=t.fov,n.zoom=t.zoom,s.distance=t.distance,s.decal.x=t.dx,s.decal.y=t.dy,s.decal.z=t.dz,s.exr=t.exr,s.multy=t.multy,n.updateProjectionMatrix()})).onComplete((function(){i&&i()})).start();this.camTween.push(o)}orbit(t){var e=this.info;for(var i in t)e[i]=t[i];var s=this.object,n=this.target,r=this.getSpherical(),o=!1;s.fov!==e.fov&&(s.fov=e.fov,o=!0),s.zoom!==e.zoom&&(s.zoom=e.zoom,o=!0),o&&s.updateProjectionMatrix(),r.set(e.distance,(90-e.phi)*mt.torad,e.theta*mt.torad),r.makeSafe(),this.reverse?(s.position.set(e.x,e.y,e.z),n.setFromSpherical(r).add(s.position),s.lookAt(n)):(n.set(e.x,e.y,e.z),s.position.setFromSpherical(r).add(n),s.lookAt(n))}getDirection(){return mt.tmpV.subVectors(this.target,this.object.position).normalize().toArray()}}function yt(t,i=!1){const s=null!==t[0].index,n=new Set(Object.keys(t[0].attributes)),r=new Set(Object.keys(t[0].morphAttributes)),o={},a={},l=t[0].morphTargetsRelative,h=new e.BufferGeometry;let c=0;for(let e=0;e<t.length;++e){const u=t[e];let d=0;if(s!==(null!==u.index))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+e+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const t in u.attributes){if(!n.has(t))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+e+'. All geometries must have compatible attributes; make sure "'+t+'" attribute exists among all geometries, or in none of them.'),null;void 0===o[t]&&(o[t]=[]),o[t].push(u.attributes[t]),d++}if(d!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+e+". Make sure all geometries have the same number of attributes."),null;if(l!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+e+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const t in u.morphAttributes){if(!r.has(t))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+e+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===a[t]&&(a[t]=[]),a[t].push(u.morphAttributes[t])}if(i){let t;if(s)t=u.index.count;else{if(void 0===u.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+e+". The geometry must have either an index or a position attribute"),null;t=u.attributes.position.count}h.addGroup(c,t,e),c+=t}}if(s){let e=0;const i=[];for(let s=0;s<t.length;++s){const n=t[s].index;for(let t=0;t<n.count;++t)i.push(n.getX(t)+e);e+=t[s].attributes.position.count}h.setIndex(i)}for(const t in o){const e=bt(o[t]);if(!e)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+t+" attribute."),null;h.setAttribute(t,e)}for(const t in a){const e=a[t][0].length;if(0===e)break;h.morphAttributes=h.morphAttributes||{},h.morphAttributes[t]=[];for(let i=0;i<e;++i){const e=[];for(let s=0;s<a[t].length;++s)e.push(a[t][s][i]);const s=bt(e);if(!s)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+t+" morphAttribute."),null;h.morphAttributes[t].push(s)}}return h}function bt(t){let i,s,n,r=-1,o=0;for(let e=0;e<t.length;++e){const a=t[e];if(a.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===i&&(i=a.array.constructor),i!==a.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===s&&(s=a.itemSize),s!==a.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===n&&(n=a.normalized),n!==a.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(-1===r&&(r=a.gpuType),r!==a.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;o+=a.array.length}const a=new i(o);let l=0;for(let e=0;e<t.length;++e)a.set(t[e].array,l),l+=t[e].array.length;const h=new e.BufferAttribute(a,s,n);return void 0!==r&&(h.gpuType=r),h}function xt(t,i=1e-4){i=Math.max(i,Number.EPSILON);const s={},n=t.getIndex(),r=t.getAttribute("position"),o=n?n.count:r.count;let a=0;const l=Object.keys(t.attributes),h={},c={},u=[],d=["getX","getY","getZ","getW"],p=["setX","setY","setZ","setW"];for(let i=0,s=l.length;i<s;i++){const s=l[i],n=t.attributes[s];h[s]=new e.BufferAttribute(new n.array.constructor(n.count*n.itemSize),n.itemSize,n.normalized);const r=t.morphAttributes[s];r&&(c[s]=new e.BufferAttribute(new r.array.constructor(r.count*r.itemSize),r.itemSize,r.normalized))}const f=Math.log10(1/i),m=Math.pow(10,f);for(let e=0;e<o;e++){const i=n?n.getX(e):e;let r="";for(let e=0,s=l.length;e<s;e++){const s=l[e],n=t.getAttribute(s),o=n.itemSize;for(let t=0;t<o;t++)r+=~~(n[d[t]](i)*m)+","}if(r in s)u.push(s[r]);else{for(let e=0,s=l.length;e<s;e++){const s=l[e],n=t.getAttribute(s),r=t.morphAttributes[s],o=n.itemSize,u=h[s],f=c[s];for(let t=0;t<o;t++){const e=d[t],s=p[t];if(u[s](a,n[e](i)),r)for(let t=0,n=r.length;t<n;t++)f[t][s](a,r[t][e](i))}}s[r]=a,u.push(a),a++}}const g=t.clone();for(const i in t.attributes){const t=h[i];if(g.setAttribute(i,new e.BufferAttribute(t.array.slice(0,a*t.itemSize),t.itemSize,t.normalized)),i in c)for(let t=0;t<c[i].length;t++){const s=c[i][t];g.morphAttributes[i][t]=new e.BufferAttribute(s.array.slice(0,a*s.itemSize),s.itemSize,s.normalized)}}return g.setIndex(u),g}function Ot(t,i){if(i===e.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(i===e.TriangleFanDrawMode||i===e.TriangleStripDrawMode){let s=t.getIndex();if(null===s){const e=[],i=t.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<i.count;t++)e.push(t);t.setIndex(e),s=t.getIndex()}const n=s.count-2,r=[];if(i===e.TriangleFanDrawMode)for(let t=1;t<=n;t++)r.push(s.getX(0)),r.push(s.getX(t)),r.push(s.getX(t+1));else for(let t=0;t<n;t++)t%2==0?(r.push(s.getX(t)),r.push(s.getX(t+1)),r.push(s.getX(t+2))):(r.push(s.getX(t+2)),r.push(s.getX(t+1)),r.push(s.getX(t)));r.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=t.clone();return o.setIndex(r),o.clearGroups(),o}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",i),t}class wt extends e.Loader{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new Pt(t)})),this.register((function(t){return new It(t)})),this.register((function(t){return new Dt(t)})),this.register((function(t){return new Ut(t)})),this.register((function(t){return new _t(t)})),this.register((function(t){return new Rt(t)})),this.register((function(t){return new Et(t)})),this.register((function(t){return new Qt(t)})),this.register((function(t){return new Mt(t)})),this.register((function(t){return new Lt(t)})),this.register((function(t){return new Ct(t)})),this.register((function(t){return new Ft(t)})),this.register((function(t){return new At(t)})),this.register((function(t){return new zt(t)})),this.register((function(t){return new Nt(t)}))}load(t,i,s,n){const r=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:e.LoaderUtils.extractUrlBase(t),this.manager.itemStart(t);const a=function(e){n?n(e):console.error(e),r.manager.itemError(t),r.manager.itemEnd(t)},l=new e.FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(t,(function(e){try{r.parse(e,o,(function(e){i(e),r.manager.itemEnd(t)}),a)}catch(t){a(t)}}),s,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,s){let n;const r={},o={},a=new TextDecoder;if("string"==typeof t)n=JSON.parse(t);else if(t instanceof ArrayBuffer){if(a.decode(new Uint8Array(t,0,4))===Vt){try{r[kt.KHR_BINARY_GLTF]=new Xt(t)}catch(t){return void(s&&s(t))}n=JSON.parse(r[kt.KHR_BINARY_GLTF].content)}else n=JSON.parse(a.decode(t))}else n=t;if(void 0===n.asset||n.asset.version[0]<2)return void(s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new me(n,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let t=0;t<this.pluginCallbacks.length;t++){const e=this.pluginCallbacks[t](l);o[e.name]=e,r[e.name]=!0}if(n.extensionsUsed)for(let t=0;t<n.extensionsUsed.length;++t){const e=n.extensionsUsed[t],i=n.extensionsRequired||[];switch(e){case kt.KHR_MATERIALS_UNLIT:r[e]=new Tt;break;case kt.KHR_DRACO_MESH_COMPRESSION:r[e]=new jt(n,this.dracoLoader);break;case kt.KHR_TEXTURE_TRANSFORM:r[e]=new Gt;break;case kt.KHR_MESH_QUANTIZATION:r[e]=new Zt;break;default:i.indexOf(e)>=0&&void 0===o[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(r),l.setPlugins(o),l.parse(i,s)}parseAsync(t,e){const i=this;return new Promise((function(s,n){i.parse(t,e,s,n)}))}}function St(){let t={};return{get:function(e){return t[e]},add:function(e,i){t[e]=i},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const kt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class At{constructor(t){this.parser=t,this.name=kt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let i=0,s=e.length;i<s;i++){const s=e[i];s.extensions&&s.extensions[this.name]&&void 0!==s.extensions[this.name].light&&t._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(t){const i=this.parser,s="light:"+t;let n=i.cache.get(s);if(n)return n;const r=i.json,o=((r.extensions&&r.extensions[this.name]||{}).lights||[])[t];let a;const l=new e.Color(16777215);void 0!==o.color&&l.fromArray(o.color);const h=void 0!==o.range?o.range:0;switch(o.type){case"directional":a=new e.DirectionalLight(l),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new e.PointLight(l),a.distance=h;break;case"spot":a=new e.SpotLight(l),a.distance=h,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,a.angle=o.spot.outerConeAngle,a.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return a.position.set(0,0,0),a.decay=2,he(a,o),void 0!==o.intensity&&(a.intensity=o.intensity),a.name=i.createUniqueName(o.name||"light_"+t),n=Promise.resolve(a),i.cache.add(s,n),n}getDependency(t,e){if("light"===t)return this._loadLight(e)}createNodeAttachment(t){const e=this,i=this.parser,s=i.json.nodes[t],n=(s.extensions&&s.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then((function(t){return i._getNodeRef(e.cache,n,t)}))}}class Tt{constructor(){this.name=kt.KHR_MATERIALS_UNLIT}getMaterialType(){return e.MeshBasicMaterial}extendParams(t,i,s){const n=[];t.color=new e.Color(1,1,1),t.opacity=1;const r=i.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const e=r.baseColorFactor;t.color.fromArray(e),t.opacity=e[3]}void 0!==r.baseColorTexture&&n.push(s.assignTexture(t,"map",r.baseColorTexture,e.SRGBColorSpace))}return Promise.all(n)}}class Mt{constructor(t){this.parser=t,this.name=kt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return void 0!==s&&(e.emissiveIntensity=s),Promise.resolve()}}class Pt{constructor(t){this.parser=t,this.name=kt.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(t,i){const s=this.parser,n=s.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];if(void 0!==o.clearcoatFactor&&(i.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&r.push(s.assignTexture(i,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(i.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&r.push(s.assignTexture(i,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(r.push(s.assignTexture(i,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const t=o.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new e.Vector2(t,t)}return Promise.all(r)}}class Ct{constructor(t){this.parser=t,this.name=kt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];return void 0!==r.iridescenceFactor&&(e.iridescence=r.iridescenceFactor),void 0!==r.iridescenceTexture&&n.push(i.assignTexture(e,"iridescenceMap",r.iridescenceTexture)),void 0!==r.iridescenceIor&&(e.iridescenceIOR=r.iridescenceIor),void 0===e.iridescenceThicknessRange&&(e.iridescenceThicknessRange=[100,400]),void 0!==r.iridescenceThicknessMinimum&&(e.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),void 0!==r.iridescenceThicknessMaximum&&(e.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),void 0!==r.iridescenceThicknessTexture&&n.push(i.assignTexture(e,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(n)}}class _t{constructor(t){this.parser=t,this.name=kt.KHR_MATERIALS_SHEEN}getMaterialType(t){const i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(t,i){const s=this.parser,n=s.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[];i.sheenColor=new e.Color(0,0,0),i.sheenRoughness=0,i.sheen=1;const o=n.extensions[this.name];return void 0!==o.sheenColorFactor&&i.sheenColor.fromArray(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&(i.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&r.push(s.assignTexture(i,"sheenColorMap",o.sheenColorTexture,e.SRGBColorSpace)),void 0!==o.sheenRoughnessTexture&&r.push(s.assignTexture(i,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}class Rt{constructor(t){this.parser=t,this.name=kt.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];return void 0!==r.transmissionFactor&&(e.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&n.push(i.assignTexture(e,"transmissionMap",r.transmissionTexture)),Promise.all(n)}}class Et{constructor(t){this.parser=t,this.name=kt.KHR_MATERIALS_VOLUME}getMaterialType(t){const i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(t,i){const s=this.parser,n=s.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];i.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&r.push(s.assignTexture(i,"thicknessMap",o.thicknessTexture)),i.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return i.attenuationColor=new e.Color(a[0],a[1],a[2]),Promise.all(r)}}class Qt{constructor(t){this.parser=t,this.name=kt.KHR_MATERIALS_IOR}getMaterialType(t){const i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return e.ior=void 0!==s.ior?s.ior:1.5,Promise.resolve()}}class Lt{constructor(t){this.parser=t,this.name=kt.KHR_MATERIALS_SPECULAR}getMaterialType(t){const i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(t,i){const s=this.parser,n=s.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];i.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&r.push(s.assignTexture(i,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return i.specularColor=new e.Color(a[0],a[1],a[2]),void 0!==o.specularColorTexture&&r.push(s.assignTexture(i,"specularColorMap",o.specularColorTexture,e.SRGBColorSpace)),Promise.all(r)}}class Ft{constructor(t){this.parser=t,this.name=kt.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];return void 0!==r.anisotropyStrength&&(e.anisotropy=r.anisotropyStrength),void 0!==r.anisotropyRotation&&(e.anisotropyRotation=r.anisotropyRotation),void 0!==r.anisotropyTexture&&n.push(i.assignTexture(e,"anisotropyMap",r.anisotropyTexture)),Promise.all(n)}}class It{constructor(t){this.parser=t,this.name=kt.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,i=e.json,s=i.textures[t];if(!s.extensions||!s.extensions[this.name])return null;const n=s.extensions[this.name],r=e.options.ktx2Loader;if(!r){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,n.source,r)}}class Dt{constructor(t){this.parser=t,this.name=kt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,s=i.json,n=s.textures[t];if(!n.extensions||!n.extensions[e])return null;const r=n.extensions[e],o=s.images[r.source];let a=i.textureLoader;if(o.uri){const t=i.options.manager.getHandler(o.uri);null!==t&&(a=t)}return this.detectSupport().then((function(n){if(n)return i.loadTextureImage(t,r.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class Ut{constructor(t){this.parser=t,this.name=kt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,s=i.json,n=s.textures[t];if(!n.extensions||!n.extensions[e])return null;const r=n.extensions[e],o=s.images[r.source];let a=i.textureLoader;if(o.uri){const t=i.options.manager.getHandler(o.uri);null!==t&&(a=t)}return this.detectSupport().then((function(n){if(n)return i.loadTextureImage(t,r.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class zt{constructor(t){this.name=kt.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){const t=i.extensions[this.name],s=this.parser.getDependency("buffer",t.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then((function(e){const i=t.byteOffset||0,s=t.byteLength||0,r=t.count,o=t.byteStride,a=new Uint8Array(e,i,s);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(r,o,a,t.mode,t.filter).then((function(t){return t.buffer})):n.ready.then((function(){const e=new ArrayBuffer(r*o);return n.decodeGltfBuffer(new Uint8Array(e),r,o,a,t.mode,t.filter),e}))}))}return null}}class Nt{constructor(t){this.name=kt.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const i=this.parser.json,s=i.nodes[t];if(!s.extensions||!s.extensions[this.name]||void 0===s.mesh)return null;const n=i.meshes[s.mesh];for(const t of n.primitives)if(t.mode!==Yt.TRIANGLES&&t.mode!==Yt.TRIANGLE_STRIP&&t.mode!==Yt.TRIANGLE_FAN&&void 0!==t.mode)return null;const r=s.extensions[this.name].attributes,o=[],a={};for(const t in r)o.push(this.parser.getDependency("accessor",r[t]).then((e=>(a[t]=e,a[t]))));return o.length<1?null:(o.push(this.parser.createNodeMesh(t)),Promise.all(o).then((t=>{const i=t.pop(),s=i.isGroup?i.children:[i],n=t[0].count,r=[];for(const t of s){const i=new e.Matrix4,s=new e.Vector3,o=new e.Quaternion,l=new e.Vector3(1,1,1),h=new e.InstancedMesh(t.geometry,t.material,n);for(let t=0;t<n;t++)a.TRANSLATION&&s.fromBufferAttribute(a.TRANSLATION,t),a.ROTATION&&o.fromBufferAttribute(a.ROTATION,t),a.SCALE&&l.fromBufferAttribute(a.SCALE,t),h.setMatrixAt(t,i.compose(s,o,l));for(const e in a)"TRANSLATION"!==e&&"ROTATION"!==e&&"SCALE"!==e&&t.geometry.setAttribute(e,a[e]);e.Object3D.prototype.copy.call(h,t),this.parser.assignFinalMaterial(h),r.push(h)}return i.isGroup?(i.clear(),i.add(...r),i):r[0]})))}}const Vt="glTF",Bt=1313821514,$t=5130562;class Xt{constructor(t){this.name=kt.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Vt)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,n=new DataView(t,12);let r=0;for(;r<s;){const e=n.getUint32(r,!0);r+=4;const s=n.getUint32(r,!0);if(r+=4,s===Bt){const s=new Uint8Array(t,12+r,e);this.content=i.decode(s)}else if(s===$t){const i=12+r;this.body=t.slice(i,i+e)}r+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class jt{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=kt.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const i=this.json,s=this.dracoLoader,n=t.extensions[this.name].bufferView,r=t.extensions[this.name].attributes,o={},a={},l={};for(const t in r){const e=ie[t]||t.toLowerCase();o[e]=r[t]}for(const e in t.attributes){const s=ie[e]||e.toLowerCase();if(void 0!==r[e]){const n=i.accessors[t.attributes[e]],r=Kt[n.componentType];l[s]=r.name,a[s]=!0===n.normalized}}return e.getDependency("bufferView",n).then((function(t){return new Promise((function(e){s.decodeDracoFile(t,(function(t){for(const e in t.attributes){const i=t.attributes[e],s=a[e];void 0!==s&&(i.normalized=s)}e(t)}),o,l)}))}))}}class Gt{constructor(){this.name=kt.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&e.texCoord!==t.channel||void 0!==e.offset||void 0!==e.rotation||void 0!==e.scale?(t=t.clone(),void 0!==e.texCoord&&(t.channel=e.texCoord),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0,t):t}}class Zt{constructor(){this.name=kt.KHR_MESH_QUANTIZATION}}class qt extends e.Interpolant{constructor(t,e,i,s){super(t,e,i,s)}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,n=t*s*3+s;for(let t=0;t!==s;t++)e[t]=i[n+t];return e}interpolate_(t,e,i,s){const n=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,h=s-e,c=(i-e)/h,u=c*c,d=u*c,p=t*l,f=p-l,m=-2*d+3*u,g=d-u,v=1-m,y=g-u+c;for(let t=0;t!==o;t++){const e=r[f+t+o],i=r[f+t+a]*h,s=r[p+t+o],l=r[p+t]*h;n[t]=v*e+y*i+m*s+g*l}return n}}const Wt=new e.Quaternion;class Ht extends qt{interpolate_(t,e,i,s){const n=super.interpolate_(t,e,i,s);return Wt.fromArray(n).normalize().toArray(n),n}}const Yt={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Kt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Jt={9728:e.NearestFilter,9729:e.LinearFilter,9984:e.NearestMipmapNearestFilter,9985:e.LinearMipmapNearestFilter,9986:e.NearestMipmapLinearFilter,9987:e.LinearMipmapLinearFilter},te={33071:e.ClampToEdgeWrapping,33648:e.MirroredRepeatWrapping,10497:e.RepeatWrapping},ee={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ie={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},se={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ne={CUBICSPLINE:void 0,LINEAR:e.InterpolateLinear,STEP:e.InterpolateDiscrete},re="OPAQUE",oe="MASK",ae="BLEND";function le(t,e,i){for(const s in i.extensions)void 0===t[s]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=i.extensions[s])}function he(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function ce(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let i=0,s=e.weights.length;i<s;i++)t.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length){t.morphTargetDictionary={};for(let e=0,s=i.length;e<s;e++)t.morphTargetDictionary[i[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ue(t){let e;const i=t.extensions&&t.extensions[kt.KHR_DRACO_MESH_COMPRESSION];if(e=i?"draco:"+i.bufferView+":"+i.indices+":"+de(i.attributes):t.indices+":"+de(t.attributes)+":"+t.mode,void 0!==t.targets)for(let i=0,s=t.targets.length;i<s;i++)e+=":"+de(t.targets[i]);return e}function de(t){let e="";const i=Object.keys(t).sort();for(let s=0,n=i.length;s<n;s++)e+=i[s]+":"+t[i[s]]+";";return e}function pe(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const fe=new e.Matrix4;class me{constructor(t={},i={}){this.json=t,this.extensions={},this.plugins={},this.options=i,this.cache=new St,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,n=!1,r=-1;"undefined"!=typeof navigator&&(s=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=navigator.userAgent.indexOf("Firefox")>-1,r=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||s||n&&r<98?this.textureLoader=new e.TextureLoader(this.options.manager):this.textureLoader=new e.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new e.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const i=this,s=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])})).then((function(e){const r={scene:e[0][s.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:s.asset,parser:i,userData:{}};le(n,r,s),he(r,s),Promise.all(i._invokeAll((function(t){return t.afterRoot&&t.afterRoot(r)}))).then((function(){t(r)}))})).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let i=0,s=e.length;i<s;i++){const s=e[i].joints;for(let e=0,i=s.length;e<i;e++)t[s[e]].isBone=!0}for(let e=0,s=t.length;e<s;e++){const s=t[e];void 0!==s.mesh&&(this._addNodeRef(this.meshCache,s.mesh),void 0!==s.skin&&(i[s.mesh].isSkinnedMesh=!0)),void 0!==s.camera&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,i){if(t.refs[e]<=1)return i;const s=i.clone(),n=(t,e)=>{const i=this.associations.get(t);null!=i&&this.associations.set(e,i);for(const[i,s]of t.children.entries())n(s,e.children[i])};return n(i,s),s.name+="_instance_"+t.uses[e]++,s}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const s=t(e[i]);if(s)return s}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let s=0;s<e.length;s++){const n=t(e[s]);n&&i.push(n)}return i}getDependency(t,e){const i=t+":"+e;let s=this.cache.get(i);if(!s){switch(t){case"scene":s=this.loadScene(e);break;case"node":s=this._invokeOne((function(t){return t.loadNode&&t.loadNode(e)}));break;case"mesh":s=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":s=this.loadAccessor(e);break;case"bufferView":s=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":s=this.loadBuffer(e);break;case"material":s=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":s=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":s=this.loadSkin(e);break;case"animation":s=this._invokeOne((function(t){return t.loadAnimation&&t.loadAnimation(e)}));break;case"camera":s=this.loadCamera(e);break;default:if(s=this._invokeOne((function(i){return i!=this&&i.getDependency&&i.getDependency(t,e)})),!s)throw new Error("Unknown type: "+t)}this.cache.add(i,s)}return s}getDependencies(t){let e=this.cache.get(t);if(!e){const i=this,s=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(s.map((function(e,s){return i.getDependency(t,s)}))),this.cache.add(t,e)}return e}loadBuffer(t){const i=this.json.buffers[t],s=this.fileLoader;if(i.type&&"arraybuffer"!==i.type)throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(void 0===i.uri&&0===t)return Promise.resolve(this.extensions[kt.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(t,r){s.load(e.LoaderUtils.resolveURL(i.uri,n.path),t,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))}))}))}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){const i=e.byteLength||0,s=e.byteOffset||0;return t.slice(s,s+i)}))}loadAccessor(t){const i=this,s=this.json,n=this.json.accessors[t];if(void 0===n.bufferView&&void 0===n.sparse){const t=ee[n.type],i=Kt[n.componentType],s=!0===n.normalized,r=new i(n.count*t);return Promise.resolve(new e.BufferAttribute(r,t,s))}const r=[];return void 0!==n.bufferView?r.push(this.getDependency("bufferView",n.bufferView)):r.push(null),void 0!==n.sparse&&(r.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(r).then((function(t){const r=t[0],o=ee[n.type],a=Kt[n.componentType],l=a.BYTES_PER_ELEMENT,h=l*o,c=n.byteOffset||0,u=void 0!==n.bufferView?s.bufferViews[n.bufferView].byteStride:void 0,d=!0===n.normalized;let p,f;if(u&&u!==h){const t=Math.floor(c/u),s="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+t+":"+n.count;let h=i.cache.get(s);h||(p=new a(r,t*u,n.count*u/l),h=new e.InterleavedBuffer(p,u/l),i.cache.add(s,h)),f=new e.InterleavedBufferAttribute(h,o,c%u/l,d)}else p=null===r?new a(n.count*o):new a(r,c,n.count*o),f=new e.BufferAttribute(p,o,d);if(void 0!==n.sparse){const i=ee.SCALAR,s=Kt[n.sparse.indices.componentType],l=n.sparse.indices.byteOffset||0,h=n.sparse.values.byteOffset||0,c=new s(t[1],l,n.sparse.count*i),u=new a(t[2],h,n.sparse.count*o);null!==r&&(f=new e.BufferAttribute(f.array.slice(),f.itemSize,f.normalized));for(let t=0,e=c.length;t<e;t++){const e=c[t];if(f.setX(e,u[t*o]),o>=2&&f.setY(e,u[t*o+1]),o>=3&&f.setZ(e,u[t*o+2]),o>=4&&f.setW(e,u[t*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f}))}loadTexture(t){const e=this.json,i=this.options,s=e.textures[t].source,n=e.images[s];let r=this.textureLoader;if(n.uri){const t=i.manager.getHandler(n.uri);null!==t&&(r=t)}return this.loadTextureImage(t,s,r)}loadTextureImage(t,i,s){const n=this,r=this.json,o=r.textures[t],a=r.images[i],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const h=this.loadImageSource(i,s).then((function(i){i.flipY=!1,i.name=o.name||a.name||"",""===i.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(i.name=a.uri);const s=(r.samplers||{})[o.sampler]||{};return i.magFilter=Jt[s.magFilter]||e.LinearFilter,i.minFilter=Jt[s.minFilter]||e.LinearMipmapLinearFilter,i.wrapS=te[s.wrapS]||e.RepeatWrapping,i.wrapT=te[s.wrapT]||e.RepeatWrapping,n.associations.set(i,{textures:t}),i})).catch((function(){return null}));return this.textureCache[l]=h,h}loadImageSource(t,i){const s=this,n=this.json,r=this.options;if(void 0!==this.sourceCache[t])return this.sourceCache[t].then((t=>t.clone()));const o=n.images[t],a=self.URL||self.webkitURL;let l=o.uri||"",h=!1;if(void 0!==o.bufferView)l=s.getDependency("bufferView",o.bufferView).then((function(t){h=!0;const e=new Blob([t],{type:o.mimeType});return l=a.createObjectURL(e),l}));else if(void 0===o.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const c=Promise.resolve(l).then((function(t){return new Promise((function(s,n){let o=s;!0===i.isImageBitmapLoader&&(o=function(t){const i=new e.Texture(t);i.needsUpdate=!0,s(i)}),i.load(e.LoaderUtils.resolveURL(t,r.path),o,void 0,n)}))})).then((function(t){var e;return!0===h&&a.revokeObjectURL(l),t.userData.mimeType=o.mimeType||((e=o.uri).search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":"image/png"),t})).catch((function(t){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),t}));return this.sourceCache[t]=c,c}assignTexture(t,e,i,s){const n=this;return this.getDependency("texture",i.index).then((function(r){if(!r)return null;if(void 0!==i.texCoord&&i.texCoord>0&&((r=r.clone()).channel=i.texCoord),n.extensions[kt.KHR_TEXTURE_TRANSFORM]){const t=void 0!==i.extensions?i.extensions[kt.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const e=n.associations.get(r);r=n.extensions[kt.KHR_TEXTURE_TRANSFORM].extendTexture(r,t),n.associations.set(r,e)}}return void 0!==s&&(r.colorSpace=s),t[e]=r,r}))}assignFinalMaterial(t){const i=t.geometry;let s=t.material;const n=void 0===i.attributes.tangent,r=void 0!==i.attributes.color,o=void 0===i.attributes.normal;if(t.isPoints){const t="PointsMaterial:"+s.uuid;let i=this.cache.get(t);i||(i=new e.PointsMaterial,e.Material.prototype.copy.call(i,s),i.color.copy(s.color),i.map=s.map,i.sizeAttenuation=!1,this.cache.add(t,i)),s=i}else if(t.isLine){const t="LineBasicMaterial:"+s.uuid;let i=this.cache.get(t);i||(i=new e.LineBasicMaterial,e.Material.prototype.copy.call(i,s),i.color.copy(s.color),i.map=s.map,this.cache.add(t,i)),s=i}if(n||r||o){let t="ClonedMaterial:"+s.uuid+":";n&&(t+="derivative-tangents:"),r&&(t+="vertex-colors:"),o&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=s.clone(),r&&(e.vertexColors=!0),o&&(e.flatShading=!0),n&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(s))),s=e}t.material=s}getMaterialType(){return e.MeshStandardMaterial}loadMaterial(t){const i=this,s=this.json,n=this.extensions,r=s.materials[t];let o;const a={},l=[];if((r.extensions||{})[kt.KHR_MATERIALS_UNLIT]){const t=n[kt.KHR_MATERIALS_UNLIT];o=t.getMaterialType(),l.push(t.extendParams(a,r,i))}else{const s=r.pbrMetallicRoughness||{};if(a.color=new e.Color(1,1,1),a.opacity=1,Array.isArray(s.baseColorFactor)){const t=s.baseColorFactor;a.color.fromArray(t),a.opacity=t[3]}void 0!==s.baseColorTexture&&l.push(i.assignTexture(a,"map",s.baseColorTexture,e.SRGBColorSpace)),a.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,a.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(l.push(i.assignTexture(a,"metalnessMap",s.metallicRoughnessTexture)),l.push(i.assignTexture(a,"roughnessMap",s.metallicRoughnessTexture))),o=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),l.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,a)}))))}!0===r.doubleSided&&(a.side=e.DoubleSide);const h=r.alphaMode||re;if(h===ae?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===oe&&(a.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&o!==e.MeshBasicMaterial&&(l.push(i.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new e.Vector2(1,1),void 0!==r.normalTexture.scale)){const t=r.normalTexture.scale;a.normalScale.set(t,t)}return void 0!==r.occlusionTexture&&o!==e.MeshBasicMaterial&&(l.push(i.assignTexture(a,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(a.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&o!==e.MeshBasicMaterial&&(a.emissive=(new e.Color).fromArray(r.emissiveFactor)),void 0!==r.emissiveTexture&&o!==e.MeshBasicMaterial&&l.push(i.assignTexture(a,"emissiveMap",r.emissiveTexture,e.SRGBColorSpace)),Promise.all(l).then((function(){const e=new o(a);return r.name&&(e.name=r.name),he(e,r),i.associations.set(e,{materials:t}),r.extensions&&le(n,e,r),e}))}createUniqueName(t){const i=e.PropertyBinding.sanitizeNodeName(t||"");return i in this.nodeNamesUsed?i+"_"+ ++this.nodeNamesUsed[i]:(this.nodeNamesUsed[i]=0,i)}loadGeometries(t){const i=this,s=this.extensions,n=this.primitiveCache;function r(t){return s[kt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,i).then((function(e){return ge(e,t,i)}))}const o=[];for(let s=0,a=t.length;s<a;s++){const a=t[s],l=ue(a),h=n[l];if(h)o.push(h.promise);else{let t;t=a.extensions&&a.extensions[kt.KHR_DRACO_MESH_COMPRESSION]?r(a):ge(new e.BufferGeometry,a,i),n[l]={primitive:a,promise:t},o.push(t)}}return Promise.all(o)}loadMesh(t){const i=this,s=this.json,n=this.extensions,r=s.meshes[t],o=r.primitives,a=[];for(let t=0,i=o.length;t<i;t++){const i=void 0===o[t].material?(void 0===(l=this.cache).DefaultMaterial&&(l.DefaultMaterial=new e.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:e.FrontSide})),l.DefaultMaterial):this.getDependency("material",o[t].material);a.push(i)}var l;return a.push(i.loadGeometries(o)),Promise.all(a).then((function(s){const a=s.slice(0,s.length-1),l=s[s.length-1],h=[];for(let s=0,c=l.length;s<c;s++){const c=l[s],u=o[s];let d;const p=a[s];if(u.mode===Yt.TRIANGLES||u.mode===Yt.TRIANGLE_STRIP||u.mode===Yt.TRIANGLE_FAN||void 0===u.mode)d=!0===r.isSkinnedMesh?new e.SkinnedMesh(c,p):new e.Mesh(c,p),!0===d.isSkinnedMesh&&d.normalizeSkinWeights(),u.mode===Yt.TRIANGLE_STRIP?d.geometry=Ot(d.geometry,e.TriangleStripDrawMode):u.mode===Yt.TRIANGLE_FAN&&(d.geometry=Ot(d.geometry,e.TriangleFanDrawMode));else if(u.mode===Yt.LINES)d=new e.LineSegments(c,p);else if(u.mode===Yt.LINE_STRIP)d=new e.Line(c,p);else if(u.mode===Yt.LINE_LOOP)d=new e.LineLoop(c,p);else{if(u.mode!==Yt.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);d=new e.Points(c,p)}Object.keys(d.geometry.morphAttributes).length>0&&ce(d,r),d.name=i.createUniqueName(r.name||"mesh_"+t),he(d,r),u.extensions&&le(n,d,u),i.assignFinalMaterial(d),h.push(d)}for(let e=0,s=h.length;e<s;e++)i.associations.set(h[e],{meshes:t,primitives:e});if(1===h.length)return r.extensions&&le(n,h[0],r),h[0];const c=new e.Group;r.extensions&&le(n,c,r),i.associations.set(c,{meshes:t});for(let t=0,e=h.length;t<e;t++)c.add(h[t]);return c}))}loadCamera(t){let i;const s=this.json.cameras[t],n=s[s.type];if(n)return"perspective"===s.type?i=new e.PerspectiveCamera(e.MathUtils.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===s.type&&(i=new e.OrthographicCamera(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),s.name&&(i.name=this.createUniqueName(s.name)),he(i,s),Promise.resolve(i);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){const i=this.json.skins[t],s=[];for(let t=0,e=i.joints.length;t<e;t++)s.push(this._loadNodeShallow(i.joints[t]));return void 0!==i.inverseBindMatrices?s.push(this.getDependency("accessor",i.inverseBindMatrices)):s.push(null),Promise.all(s).then((function(t){const s=t.pop(),n=t,r=[],o=[];for(let t=0,a=n.length;t<a;t++){const a=n[t];if(a){r.push(a);const i=new e.Matrix4;null!==s&&i.fromArray(s.array,16*t),o.push(i)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[t])}return new e.Skeleton(r,o)}))}loadAnimation(t){const i=this.json,s=this,n=i.animations[t],r=n.name?n.name:"animation_"+t,o=[],a=[],l=[],h=[],c=[];for(let t=0,e=n.channels.length;t<e;t++){const e=n.channels[t],i=n.samplers[e.sampler],s=e.target,r=s.node,u=void 0!==n.parameters?n.parameters[i.input]:i.input,d=void 0!==n.parameters?n.parameters[i.output]:i.output;void 0!==s.node&&(o.push(this.getDependency("node",r)),a.push(this.getDependency("accessor",u)),l.push(this.getDependency("accessor",d)),h.push(i),c.push(s))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(h),Promise.all(c)]).then((function(t){const i=t[0],n=t[1],o=t[2],a=t[3],l=t[4],h=[];for(let t=0,e=i.length;t<e;t++){const e=i[t],r=n[t],c=o[t],u=a[t],d=l[t];if(void 0===e)continue;e.updateMatrix&&e.updateMatrix();const p=s._createAnimationTracks(e,r,c,u,d);if(p)for(let t=0;t<p.length;t++)h.push(p[t])}return new e.AnimationClip(r,void 0,h)}))}createNodeMesh(t){const e=this.json,i=this,s=e.nodes[t];return void 0===s.mesh?null:i.getDependency("mesh",s.mesh).then((function(t){const e=i._getNodeRef(i.meshCache,s.mesh,t);return void 0!==s.weights&&e.traverse((function(t){if(t.isMesh)for(let e=0,i=s.weights.length;e<i;e++)t.morphTargetInfluences[e]=s.weights[e]})),e}))}loadNode(t){const e=this,i=this.json.nodes[t],s=e._loadNodeShallow(t),n=[],r=i.children||[];for(let t=0,i=r.length;t<i;t++)n.push(e.getDependency("node",r[t]));const o=void 0===i.skin?Promise.resolve(null):e.getDependency("skin",i.skin);return Promise.all([s,Promise.all(n),o]).then((function(t){const e=t[0],i=t[1],s=t[2];null!==s&&e.traverse((function(t){t.isSkinnedMesh&&t.bind(s,fe)}));for(let t=0,s=i.length;t<s;t++)e.add(i[t]);return e}))}_loadNodeShallow(t){const i=this.json,s=this.extensions,n=this;if(void 0!==this.nodeCache[t])return this.nodeCache[t];const r=i.nodes[t],o=r.name?n.createUniqueName(r.name):"",a=[],l=n._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return l&&a.push(l),void 0!==r.camera&&a.push(n.getDependency("camera",r.camera).then((function(t){return n._getNodeRef(n.cameraCache,r.camera,t)}))),n._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){a.push(t)})),this.nodeCache[t]=Promise.all(a).then((function(i){let a;if(a=!0===r.isBone?new e.Bone:i.length>1?new e.Group:1===i.length?i[0]:new e.Object3D,a!==i[0])for(let t=0,e=i.length;t<e;t++)a.add(i[t]);if(r.name&&(a.userData.name=r.name,a.name=o),he(a,r),r.extensions&&le(s,a,r),void 0!==r.matrix){const t=new e.Matrix4;t.fromArray(r.matrix),a.applyMatrix4(t)}else void 0!==r.translation&&a.position.fromArray(r.translation),void 0!==r.rotation&&a.quaternion.fromArray(r.rotation),void 0!==r.scale&&a.scale.fromArray(r.scale);return n.associations.has(a)||n.associations.set(a,{}),n.associations.get(a).nodes=t,a})),this.nodeCache[t]}loadScene(t){const i=this.extensions,s=this.json.scenes[t],n=this,r=new e.Group;s.name&&(r.name=n.createUniqueName(s.name)),he(r,s),s.extensions&&le(i,r,s);const o=s.nodes||[],a=[];for(let t=0,e=o.length;t<e;t++)a.push(n.getDependency("node",o[t]));return Promise.all(a).then((function(t){for(let e=0,i=t.length;e<i;e++)r.add(t[e]);return n.associations=(t=>{const i=new Map;for(const[t,s]of n.associations)(t instanceof e.Material||t instanceof e.Texture)&&i.set(t,s);return t.traverse((t=>{const e=n.associations.get(t);null!=e&&i.set(t,e)})),i})(r),r}))}_createAnimationTracks(t,i,s,n,r){const o=[],a=t.name?t.name:t.uuid,l=[];let h;switch(se[r.path]===se.weights?t.traverse((function(t){t.morphTargetInfluences&&l.push(t.name?t.name:t.uuid)})):l.push(a),se[r.path]){case se.weights:h=e.NumberKeyframeTrack;break;case se.rotation:h=e.QuaternionKeyframeTrack;break;case se.position:case se.scale:h=e.VectorKeyframeTrack;break;default:if(1===s.itemSize)h=e.NumberKeyframeTrack;else h=e.VectorKeyframeTrack}const c=void 0!==n.interpolation?ne[n.interpolation]:e.InterpolateLinear,u=this._getArrayFromAccessor(s);for(let t=0,e=l.length;t<e;t++){const e=new h(l[t]+"."+se[r.path],i.array,u,c);"CUBICSPLINE"===n.interpolation&&this._createCubicSplineTrackInterpolant(e),o.push(e)}return o}_getArrayFromAccessor(t){let e=t.array;if(t.normalized){const t=pe(e.constructor),i=new Float32Array(e.length);for(let s=0,n=e.length;s<n;s++)i[s]=e[s]*t;e=i}return e}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(t){return new(this instanceof e.QuaternionKeyframeTrack?Ht:qt)(this.times,this.values,this.getValueSize()/3,t)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function ge(t,i,s){const n=i.attributes,r=[];function o(e,i){return s.getDependency("accessor",e).then((function(e){t.setAttribute(i,e)}))}for(const e in n){const i=ie[e]||e.toLowerCase();i in t.attributes||r.push(o(n[e],i))}if(void 0!==i.indices&&!t.index){const e=s.getDependency("accessor",i.indices).then((function(e){t.setIndex(e)}));r.push(e)}return he(t,i),function(t,i,s){const n=i.attributes,r=new e.Box3;if(void 0===n.POSITION)return;{const t=s.json.accessors[n.POSITION],i=t.min,o=t.max;if(void 0===i||void 0===o)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new e.Vector3(i[0],i[1],i[2]),new e.Vector3(o[0],o[1],o[2])),t.normalized){const e=pe(Kt[t.componentType]);r.min.multiplyScalar(e),r.max.multiplyScalar(e)}}const o=i.targets;if(void 0!==o){const t=new e.Vector3,i=new e.Vector3;for(let e=0,n=o.length;e<n;e++){const n=o[e];if(void 0!==n.POSITION){const e=s.json.accessors[n.POSITION],r=e.min,o=e.max;if(void 0!==r&&void 0!==o){if(i.setX(Math.max(Math.abs(r[0]),Math.abs(o[0]))),i.setY(Math.max(Math.abs(r[1]),Math.abs(o[1]))),i.setZ(Math.max(Math.abs(r[2]),Math.abs(o[2]))),e.normalized){const t=pe(Kt[e.componentType]);i.multiplyScalar(t)}t.max(i)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(t)}t.boundingBox=r;const a=new e.Sphere;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,t.boundingSphere=a}(t,i,s),Promise.all(r).then((function(){return void 0!==i.targets?function(t,e,i){let s=!1,n=!1,r=!1;for(let t=0,i=e.length;t<i;t++){const i=e[t];if(void 0!==i.POSITION&&(s=!0),void 0!==i.NORMAL&&(n=!0),void 0!==i.COLOR_0&&(r=!0),s&&n&&r)break}if(!s&&!n&&!r)return Promise.resolve(t);const o=[],a=[],l=[];for(let h=0,c=e.length;h<c;h++){const c=e[h];if(s){const e=void 0!==c.POSITION?i.getDependency("accessor",c.POSITION):t.attributes.position;o.push(e)}if(n){const e=void 0!==c.NORMAL?i.getDependency("accessor",c.NORMAL):t.attributes.normal;a.push(e)}if(r){const e=void 0!==c.COLOR_0?i.getDependency("accessor",c.COLOR_0):t.attributes.color;l.push(e)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then((function(e){const i=e[0],o=e[1],a=e[2];return s&&(t.morphAttributes.position=i),n&&(t.morphAttributes.normal=o),r&&(t.morphAttributes.color=a),t.morphTargetsRelative=!0,t}))}(t,i.targets,s):t}))}const ve=new WeakMap;class ye extends e.Loader{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,i,s,n){const r=new e.FileLoader(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,(t=>{this.parse(t,i,n)}),s,n)}parse(t,i,s){this.decodeDracoFile(t,i,null,null,e.SRGBColorSpace).catch(s)}decodeDracoFile(t,i,s,n,r=e.LinearSRGBColorSpace){const o={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!s,vertexColorSpace:r};return this.decodeGeometry(t,o).then(i)}decodeGeometry(t,e){const i=JSON.stringify(e);if(ve.has(t)){const e=ve.get(t);if(e.key===i)return e.promise;if(0===t.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const n=this.workerNextTaskID++,r=t.byteLength,o=this._getWorker(n,r).then((i=>(s=i,new Promise(((i,r)=>{s._callbacks[n]={resolve:i,reject:r},s.postMessage({type:"decode",id:n,taskConfig:e,buffer:t},[t])}))))).then((t=>this._createGeometry(t.geometry)));return o.catch((()=>!0)).then((()=>{s&&n&&this._releaseTask(s,n)})),ve.set(t,{key:i,promise:o}),o}_createGeometry(t){const i=new e.BufferGeometry;t.index&&i.setIndex(new e.BufferAttribute(t.index.array,1));for(let s=0;s<t.attributes.length;s++){const n=t.attributes[s],r=n.name,o=n.array,a=n.itemSize,l=new e.BufferAttribute(o,a);"color"===r&&(this._assignVertexColorSpace(l,n.vertexColorSpace),l.normalized=o instanceof Float32Array==!1),i.setAttribute(r,l)}return i}_assignVertexColorSpace(t,i){if(i!==e.SRGBColorSpace)return;const s=new e.Color;for(let e=0,i=t.count;e<i;e++)s.fromBufferAttribute(t,e).convertSRGBToLinear(),t.setXYZ(e,s.r,s.g,s.b)}_loadLibrary(t,i){const s=new e.FileLoader(this.manager);return s.setPath(this.decoderPath),s.setResponseType(i),s.setWithCredentials(this.withCredentials),new Promise(((e,i)=>{s.load(t,e,void 0,i)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then((e=>{const i=e[0];t||(this.decoderConfig.wasmBinary=e[1]);const s=be.toString(),n=["/* draco decoder */",i,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n]))})),this.decoderPending}_getWorker(t,e){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const t=new Worker(this.workerSourceURL);t._callbacks={},t._taskCosts={},t._taskLoad=0,t.postMessage({type:"init",decoderConfig:this.decoderConfig}),t.onmessage=function(e){const i=e.data;switch(i.type){case"decode":t._callbacks[i.id].resolve(i);break;case"error":t._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(t)}else this.workerPool.sort((function(t,e){return t._taskLoad>e._taskLoad?-1:1}));const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[t]=e,i._taskLoad+=e,i}))}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map((t=>t._taskLoad)))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function be(){let t,e;function i(t,e,i,s,n,r){const o=r.num_components(),a=i.num_points()*o,l=a*n.BYTES_PER_ELEMENT,h=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}(t,n),c=t._malloc(l);e.GetAttributeDataArrayForAllPoints(i,r,h,l,c);const u=new n(t.HEAPF32.buffer,c,a).slice();return t._free(c),{name:s,array:u,itemSize:o}}onmessage=function(s){const n=s.data;switch(n.type){case"init":t=n.decoderConfig,e=new Promise((function(e){t.onModuleLoaded=function(t){e({draco:t})},DracoDecoderModule(t)}));break;case"decode":const s=n.buffer,r=n.taskConfig;e.then((t=>{const e=t.draco,o=new e.Decoder;try{const t=function(t,e,s,n){const r=n.attributeIDs,o=n.attributeTypes;let a,l;const h=e.GetEncodedGeometryType(s);if(h===t.TRIANGULAR_MESH)a=new t.Mesh,l=e.DecodeArrayToMesh(s,s.byteLength,a);else{if(h!==t.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new t.PointCloud,l=e.DecodeArrayToPointCloud(s,s.byteLength,a)}if(!l.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const c={index:null,attributes:[]};for(const s in r){const l=self[o[s]];let h,u;if(n.useUniqueIDs)u=r[s],h=e.GetAttributeByUniqueId(a,u);else{if(u=e.GetAttributeId(a,t[r[s]]),-1===u)continue;h=e.GetAttribute(a,u)}const d=i(t,e,a,s,l,h);"color"===s&&(d.vertexColorSpace=n.vertexColorSpace),c.attributes.push(d)}h===t.TRIANGULAR_MESH&&(c.index=function(t,e,i){const s=i.num_faces(),n=3*s,r=4*n,o=t._malloc(r);e.GetTrianglesUInt32Array(i,r,o);const a=new Uint32Array(t.HEAPF32.buffer,o,n).slice();return t._free(o),{array:a,itemSize:1}}(t,e,a));return t.destroy(a),c}(e,o,new Int8Array(s),r),a=t.attributes.map((t=>t.array.buffer));t.index&&a.push(t.index.array.buffer),self.postMessage({type:"decode",id:n.id,geometry:t},a)}catch(t){console.error(t),self.postMessage({type:"error",id:n.id,error:t.message})}finally{e.destroy(o)}}))}}}
/*!
  fflate - fast JavaScript compression/decompression
  <https://101arrowz.github.io/fflate>
  Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
  version 0.6.9
  */var xe=function(t){return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};try{URL.revokeObjectURL(xe(""))}catch(V){xe=function(t){return"data:application/javascript;charset=UTF-8,"+encodeURI(t)}}var Oe=Uint8Array,we=Uint16Array,Se=Uint32Array,ke=new Oe([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ae=new Oe([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Te=new Oe([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Me=function(t,e){for(var i=new we(31),s=0;s<31;++s)i[s]=e+=1<<t[s-1];var n=new Se(i[30]);for(s=1;s<30;++s)for(var r=i[s];r<i[s+1];++r)n[r]=r-i[s]<<5|s;return[i,n]},Pe=Me(ke,2),Ce=Pe[0],_e=Pe[1];Ce[28]=258,_e[258]=28;for(var Re=Me(Ae,0)[0],Ee=new we(32768),Qe=0;Qe<32768;++Qe){var Le=(43690&Qe)>>>1|(21845&Qe)<<1;Le=(61680&(Le=(52428&Le)>>>2|(13107&Le)<<2))>>>4|(3855&Le)<<4,Ee[Qe]=((65280&Le)>>>8|(255&Le)<<8)>>>1}var Fe=function(t,e,i){for(var s=t.length,n=0,r=new we(e);n<s;++n)++r[t[n]-1];var o,a=new we(e);for(n=0;n<e;++n)a[n]=a[n-1]+r[n-1]<<1;if(i){o=new we(1<<e);var l=15-e;for(n=0;n<s;++n)if(t[n])for(var h=n<<4|t[n],c=e-t[n],u=a[t[n]-1]++<<c,d=u|(1<<c)-1;u<=d;++u)o[Ee[u]>>>l]=h}else for(o=new we(s),n=0;n<s;++n)t[n]&&(o[n]=Ee[a[t[n]-1]++]>>>15-t[n]);return o},Ie=new Oe(288);for(Qe=0;Qe<144;++Qe)Ie[Qe]=8;for(Qe=144;Qe<256;++Qe)Ie[Qe]=9;for(Qe=256;Qe<280;++Qe)Ie[Qe]=7;for(Qe=280;Qe<288;++Qe)Ie[Qe]=8;var De=new Oe(32);for(Qe=0;Qe<32;++Qe)De[Qe]=5;var Ue=Fe(Ie,9,1),ze=Fe(De,5,1),Ne=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},Ve=function(t,e,i){var s=e/8|0;return(t[s]|t[s+1]<<8)>>(7&e)&i},Be=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},$e=function(t){return(t/8|0)+(7&t&&1)},Xe=function(t,e,i){var s=t.length;if(!s||i&&!i.l&&s<5)return e||new Oe(0);var n=!e||i,r=!i||i.i;i||(i={}),e||(e=new Oe(3*s));var o=function(t){var i=e.length;if(t>i){var s=new Oe(Math.max(2*i,t));s.set(e),e=s}},a=i.f||0,l=i.p||0,h=i.b||0,c=i.l,u=i.d,d=i.m,p=i.n,f=8*s;do{if(!c){i.f=a=Ve(t,l,1);var m=Ve(t,l+1,3);if(l+=3,!m){var g=t[(M=$e(l)+4)-4]|t[M-3]<<8,v=M+g;if(v>s){if(r)throw"unexpected EOF";break}n&&o(h+g),e.set(t.subarray(M,v),h),i.b=h+=g,i.p=l=8*v;continue}if(1==m)c=Ue,u=ze,d=9,p=5;else{if(2!=m)throw"invalid block type";var y=Ve(t,l,31)+257,b=Ve(t,l+10,15)+4,x=y+Ve(t,l+5,31)+1;l+=14;for(var O=new Oe(x),w=new Oe(19),S=0;S<b;++S)w[Te[S]]=Ve(t,l+3*S,7);l+=3*b;var k=Ne(w),A=(1<<k)-1,T=Fe(w,k,1);for(S=0;S<x;){var M,P=T[Ve(t,l,A)];if(l+=15&P,(M=P>>>4)<16)O[S++]=M;else{var C=0,_=0;for(16==M?(_=3+Ve(t,l,3),l+=2,C=O[S-1]):17==M?(_=3+Ve(t,l,7),l+=3):18==M&&(_=11+Ve(t,l,127),l+=7);_--;)O[S++]=C}}var R=O.subarray(0,y),E=O.subarray(y);d=Ne(R),p=Ne(E),c=Fe(R,d,1),u=Fe(E,p,1)}if(l>f){if(r)throw"unexpected EOF";break}}n&&o(h+131072);for(var Q=(1<<d)-1,L=(1<<p)-1,F=l;;F=l){var I=(C=c[Be(t,l)&Q])>>>4;if((l+=15&C)>f){if(r)throw"unexpected EOF";break}if(!C)throw"invalid length/literal";if(I<256)e[h++]=I;else{if(256==I){F=l,c=null;break}var D=I-254;if(I>264){var U=ke[S=I-257];D=Ve(t,l,(1<<U)-1)+Ce[S],l+=U}var z=u[Be(t,l)&L],N=z>>>4;if(!z)throw"invalid distance";l+=15&z;E=Re[N];if(N>3){U=Ae[N];E+=Be(t,l)&(1<<U)-1,l+=U}if(l>f){if(r)throw"unexpected EOF";break}n&&o(h+131072);for(var V=h+D;h<V;h+=4)e[h]=e[h-E],e[h+1]=e[h+1-E],e[h+2]=e[h+2-E],e[h+3]=e[h+3-E];h=V}}i.l=c,i.p=F,i.b=h,c&&(a=1,i.m=d,i.d=u,i.n=p)}while(!a);return h==e.length?e:function(t,e,i){(null==e||e<0)&&(e=0),(null==i||i>t.length)&&(i=t.length);var s=new(t instanceof we?we:t instanceof Se?Se:Oe)(i-e);return s.set(t.subarray(e,i)),s}(e,0,h)},je=new Oe(0);function Ge(t,e){return Xe((function(t){if(8!=(15&t[0])||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(32&t[1])throw"invalid zlib data: preset dictionaries not supported"}(t),t.subarray(2,-4)),e)}var Ze="undefined"!=typeof TextDecoder&&new TextDecoder;try{Ze.decode(je,{stream:!0}),1}catch(V){}function qe(t,e,i){const s=i.length-t-1;if(e>=i[s])return s-1;if(e<=i[t])return t;let n=t,r=s,o=Math.floor((n+r)/2);for(;e<i[o]||e>=i[o+1];)e<i[o]?r=o:n=o,o=Math.floor((n+r)/2);return o}function We(t,e){let i=1;for(let e=2;e<=t;++e)i*=e;let s=1;for(let t=2;t<=e;++t)s*=t;for(let i=2;i<=t-e;++i)s*=i;return i/s}function He(t,i,s,n,r){const o=function(t,i,s,n,r){const o=r<t?r:t,a=[],l=qe(t,n,i),h=function(t,e,i,s,n){const r=[];for(let t=0;t<=i;++t)r[t]=0;const o=[];for(let t=0;t<=s;++t)o[t]=r.slice(0);const a=[];for(let t=0;t<=i;++t)a[t]=r.slice(0);a[0][0]=1;const l=r.slice(0),h=r.slice(0);for(let s=1;s<=i;++s){l[s]=e-n[t+1-s],h[s]=n[t+s]-e;let i=0;for(let t=0;t<s;++t){const e=h[t+1],n=l[s-t];a[s][t]=e+n;const r=a[t][s-1]/a[s][t];a[t][s]=i+e*r,i=n*r}a[s][s]=i}for(let t=0;t<=i;++t)o[0][t]=a[t][i];for(let t=0;t<=i;++t){let e=0,n=1;const l=[];for(let t=0;t<=i;++t)l[t]=r.slice(0);l[0][0]=1;for(let r=1;r<=s;++r){let s=0;const h=t-r,c=i-r;t>=r&&(l[n][0]=l[e][0]/a[c+1][h],s=l[n][0]*a[h][c]);const u=t-1<=c?r-1:i-t;for(let t=h>=-1?1:-h;t<=u;++t)l[n][t]=(l[e][t]-l[e][t-1])/a[c+1][h+t],s+=l[n][t]*a[h+t][c];t<=c&&(l[n][r]=-l[e][r-1]/a[c+1][t],s+=l[n][r]*a[t][c]),o[r][t]=s;const d=e;e=n,n=d}}let c=i;for(let t=1;t<=s;++t){for(let e=0;e<=i;++e)o[t][e]*=c;c*=i-t}return o}(l,n,t,o,i),c=[];for(let t=0;t<s.length;++t){const e=s[t].clone(),i=e.w;e.x*=i,e.y*=i,e.z*=i,c[t]=e}for(let e=0;e<=o;++e){const i=c[l-t].clone().multiplyScalar(h[e][0]);for(let s=1;s<=t;++s)i.add(c[l-t+s].clone().multiplyScalar(h[e][s]));a[e]=i}for(let t=o+1;t<=r+1;++t)a[t]=new e.Vector4(0,0,0);return a}(t,i,s,n,r);return function(t){const i=t.length,s=[],n=[];for(let r=0;r<i;++r){const i=t[r];s[r]=new e.Vector3(i.x,i.y,i.z),n[r]=i.w}const r=[];for(let t=0;t<i;++t){const e=s[t].clone();for(let i=1;i<=t;++i)e.sub(r[t-i].clone().multiplyScalar(We(t,i)*n[i]));r[t]=e.divideScalar(n[0])}return r}(o)}class Ye extends e.Curve{constructor(t,i,s,n,r){super(),this.degree=t,this.knots=i,this.controlPoints=[],this.startKnot=n||0,this.endKnot=r||this.knots.length-1;for(let t=0;t<s.length;++t){const i=s[t];this.controlPoints[t]=new e.Vector4(i.x,i.y,i.z,i.w)}}getPoint(t,i=new e.Vector3){const s=i,n=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=function(t,i,s,n){const r=qe(t,n,i),o=function(t,e,i,s){const n=[],r=[],o=[];n[0]=1;for(let a=1;a<=i;++a){r[a]=e-s[t+1-a],o[a]=s[t+a]-e;let i=0;for(let t=0;t<a;++t){const e=o[t+1],s=r[a-t],l=n[t]/(e+s);n[t]=i+e*l,i=s*l}n[a]=i}return n}(r,n,t,i),a=new e.Vector4(0,0,0,0);for(let e=0;e<=t;++e){const i=s[r-t+e],n=o[e],l=i.w*n;a.x+=i.x*l,a.y+=i.y*l,a.z+=i.z*l,a.w+=i.w*n}return a}(this.degree,this.knots,this.controlPoints,n);return 1!==r.w&&r.divideScalar(r.w),s.set(r.x,r.y,r.z)}getTangent(t,i=new e.Vector3){const s=i,n=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),r=He(this.degree,this.knots,this.controlPoints,n,1);return s.copy(r[1]).normalize(),s}}let Ke,Je,ti;class ei extends e.Loader{constructor(t){super(t)}load(t,i,s,n){const r=this,o=""===r.path?e.LoaderUtils.extractUrlBase(t):r.path,a=new e.FileLoader(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,(function(e){try{i(r.parse(e,o))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),s,n)}parse(t,i){if(function(t){const e="Kaydara FBX Binary  \0";return t.byteLength>=e.length&&e===yi(t,0,e.length)}(t))Ke=(new oi).parse(t);else{const e=yi(t);if(!function(t){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let i=0;function s(e){const s=t[e-1];return t=t.slice(i+e),i++,s}for(let t=0;t<e.length;++t){if(s(1)===e[t])return!1}return!0}(e))throw new Error("THREE.FBXLoader: Unknown format.");if(hi(e)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+hi(e));Ke=(new ri).parse(e)}const s=new e.TextureLoader(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin);return new ii(s,this.manager).parse(Ke)}}class ii{constructor(t,e){this.textureLoader=t,this.manager=e}parse(){Je=this.parseConnections();const t=this.parseImages(),e=this.parseTextures(t),i=this.parseMaterials(e),s=this.parseDeformers(),n=(new si).parse(s);return this.parseScene(s,n,i),ti}parseConnections(){const t=new Map;if("Connections"in Ke){Ke.Connections.connections.forEach((function(e){const i=e[0],s=e[1],n=e[2];t.has(i)||t.set(i,{parents:[],children:[]});const r={ID:s,relationship:n};t.get(i).parents.push(r),t.has(s)||t.set(s,{parents:[],children:[]});const o={ID:i,relationship:n};t.get(s).children.push(o)}))}return t}parseImages(){const t={},e={};if("Video"in Ke.Objects){const i=Ke.Objects.Video;for(const s in i){const n=i[s];if(t[parseInt(s)]=n.RelativeFilename||n.Filename,"Content"in n){const t=n.Content instanceof ArrayBuffer&&n.Content.byteLength>0,r="string"==typeof n.Content&&""!==n.Content;if(t||r){const t=this.parseImage(i[s]);e[n.RelativeFilename||n.Filename]=t}}}}for(const i in t){const s=t[i];void 0!==e[s]?t[i]=e[s]:t[i]=t[i].split("\\").pop()}return t}parseImage(t){const e=t.Content,i=t.RelativeFilename||t.Filename,s=i.slice(i.lastIndexOf(".")+1).toLowerCase();let n;switch(s){case"bmp":n="image/bmp";break;case"jpg":case"jpeg":n="image/jpeg";break;case"png":n="image/png";break;case"tif":n="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",i),n="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+s+'" is not supported.')}if("string"==typeof e)return"data:"+n+";base64,"+e;{const t=new Uint8Array(e);return window.URL.createObjectURL(new Blob([t],{type:n}))}}parseTextures(t){const e=new Map;if("Texture"in Ke.Objects){const i=Ke.Objects.Texture;for(const s in i){const n=this.parseTexture(i[s],t);e.set(parseInt(s),n)}}return e}parseTexture(t,i){const s=this.loadTexture(t,i);s.ID=t.id,s.name=t.attrName;const n=t.WrapModeU,r=t.WrapModeV,o=void 0!==n?n.value:0,a=void 0!==r?r.value:0;if(s.wrapS=0===o?e.RepeatWrapping:e.ClampToEdgeWrapping,s.wrapT=0===a?e.RepeatWrapping:e.ClampToEdgeWrapping,"Scaling"in t){const e=t.Scaling.value;s.repeat.x=e[0],s.repeat.y=e[1]}if("Translation"in t){const e=t.Translation.value;s.offset.x=e[0],s.offset.y=e[1]}return s}loadTexture(t,i){let s;const n=this.textureLoader.path,r=Je.get(t.id).children;let o;void 0!==r&&r.length>0&&void 0!==i[r[0].ID]&&(s=i[r[0].ID],0!==s.indexOf("blob:")&&0!==s.indexOf("data:")||this.textureLoader.setPath(void 0));const a=t.FileName.slice(-3).toLowerCase();if("tga"===a){const i=this.manager.getHandler(".tga");null===i?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),o=new e.Texture):(i.setPath(this.textureLoader.path),o=i.load(s))}else"psd"===a?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),o=new e.Texture):o=this.textureLoader.load(s);return this.textureLoader.setPath(n),o}parseMaterials(t){const e=new Map;if("Material"in Ke.Objects){const i=Ke.Objects.Material;for(const s in i){const n=this.parseMaterial(i[s],t);null!==n&&e.set(parseInt(s),n)}}return e}parseMaterial(t,i){const s=t.id,n=t.attrName;let r=t.ShadingModel;if("object"==typeof r&&(r=r.value),!Je.has(s))return null;const o=this.parseParameters(t,i,s);let a;switch(r.toLowerCase()){case"phong":a=new e.MeshPhongMaterial;break;case"lambert":a=new e.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new e.MeshPhongMaterial}return a.setValues(o),a.name=n,a}parseParameters(t,i,s){const n={};t.BumpFactor&&(n.bumpScale=t.BumpFactor.value),t.Diffuse?n.color=(new e.Color).fromArray(t.Diffuse.value).convertSRGBToLinear():!t.DiffuseColor||"Color"!==t.DiffuseColor.type&&"ColorRGB"!==t.DiffuseColor.type||(n.color=(new e.Color).fromArray(t.DiffuseColor.value).convertSRGBToLinear()),t.DisplacementFactor&&(n.displacementScale=t.DisplacementFactor.value),t.Emissive?n.emissive=(new e.Color).fromArray(t.Emissive.value).convertSRGBToLinear():!t.EmissiveColor||"Color"!==t.EmissiveColor.type&&"ColorRGB"!==t.EmissiveColor.type||(n.emissive=(new e.Color).fromArray(t.EmissiveColor.value).convertSRGBToLinear()),t.EmissiveFactor&&(n.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(n.opacity=parseFloat(t.Opacity.value)),n.opacity<1&&(n.transparent=!0),t.ReflectionFactor&&(n.reflectivity=t.ReflectionFactor.value),t.Shininess&&(n.shininess=t.Shininess.value),t.Specular?n.specular=(new e.Color).fromArray(t.Specular.value).convertSRGBToLinear():t.SpecularColor&&"Color"===t.SpecularColor.type&&(n.specular=(new e.Color).fromArray(t.SpecularColor.value).convertSRGBToLinear());const r=this;return Je.get(s).children.forEach((function(t){const s=t.relationship;switch(s){case"Bump":n.bumpMap=r.getTexture(i,t.ID);break;case"Maya|TEX_ao_map":n.aoMap=r.getTexture(i,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":n.map=r.getTexture(i,t.ID),void 0!==n.map&&(n.map.colorSpace=e.SRGBColorSpace);break;case"DisplacementColor":n.displacementMap=r.getTexture(i,t.ID);break;case"EmissiveColor":n.emissiveMap=r.getTexture(i,t.ID),void 0!==n.emissiveMap&&(n.emissiveMap.colorSpace=e.SRGBColorSpace);break;case"NormalMap":case"Maya|TEX_normal_map":n.normalMap=r.getTexture(i,t.ID);break;case"ReflectionColor":n.envMap=r.getTexture(i,t.ID),void 0!==n.envMap&&(n.envMap.mapping=e.EquirectangularReflectionMapping,n.envMap.colorSpace=e.SRGBColorSpace);break;case"SpecularColor":n.specularMap=r.getTexture(i,t.ID),void 0!==n.specularMap&&(n.specularMap.colorSpace=e.SRGBColorSpace);break;case"TransparentColor":case"TransparencyFactor":n.alphaMap=r.getTexture(i,t.ID),n.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",s)}})),n}getTexture(t,e){return"LayeredTexture"in Ke.Objects&&e in Ke.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),e=Je.get(e).children[0].ID),t.get(e)}parseDeformers(){const t={},e={};if("Deformer"in Ke.Objects){const i=Ke.Objects.Deformer;for(const s in i){const n=i[s],r=Je.get(parseInt(s));if("Skin"===n.attrType){const e=this.parseSkeleton(r,i);e.ID=s,r.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),e.geometryID=r.parents[0].ID,t[s]=e}else if("BlendShape"===n.attrType){const t={id:s};t.rawTargets=this.parseMorphTargets(r,i),t.id=s,r.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),e[s]=t}}}return{skeletons:t,morphTargets:e}}parseSkeleton(t,i){const s=[];return t.children.forEach((function(t){const n=i[t.ID];if("Cluster"!==n.attrType)return;const r={ID:t.ID,indices:[],weights:[],transformLink:(new e.Matrix4).fromArray(n.TransformLink.a)};"Indexes"in n&&(r.indices=n.Indexes.a,r.weights=n.Weights.a),s.push(r)})),{rawBones:s,bones:[]}}parseMorphTargets(t,e){const i=[];for(let s=0;s<t.children.length;s++){const n=t.children[s],r=e[n.ID],o={name:r.attrName,initialWeight:r.DeformPercent,id:r.id,fullWeights:r.FullWeights.a};if("BlendShapeChannel"!==r.attrType)return;o.geoID=Je.get(parseInt(n.ID)).children.filter((function(t){return void 0===t.relationship}))[0].ID,i.push(o)}return i}parseScene(t,i,s){ti=new e.Group;const n=this.parseModels(t.skeletons,i,s),r=Ke.Objects.Model,o=this;n.forEach((function(t){const e=r[t.ID];o.setLookAtProperties(t,e);Je.get(t.ID).parents.forEach((function(e){const i=n.get(e.ID);void 0!==i&&i.add(t)})),null===t.parent&&ti.add(t)})),this.bindSkeleton(t.skeletons,i,n),this.createAmbientLight(),ti.traverse((function(t){if(t.userData.transformData){t.parent&&(t.userData.transformData.parentMatrix=t.parent.matrix,t.userData.transformData.parentMatrixWorld=t.parent.matrixWorld);const e=mi(t.userData.transformData);t.applyMatrix4(e),t.updateWorldMatrix()}}));const a=(new ni).parse();1===ti.children.length&&ti.children[0].isGroup&&(ti.children[0].animations=a,ti=ti.children[0]),ti.animations=a}parseModels(t,i,s){const n=new Map,r=Ke.Objects.Model;for(const o in r){const a=parseInt(o),l=r[o],h=Je.get(a);let c=this.buildSkeleton(h,t,a,l.attrName);if(!c){switch(l.attrType){case"Camera":c=this.createCamera(h);break;case"Light":c=this.createLight(h);break;case"Mesh":c=this.createMesh(h,i,s);break;case"NurbsCurve":c=this.createCurve(h,i);break;case"LimbNode":case"Root":c=new e.Bone;break;default:c=new e.Group}c.name=l.attrName?e.PropertyBinding.sanitizeNodeName(l.attrName):"",c.ID=a}this.getTransformData(c,l),n.set(a,c)}return n}buildSkeleton(t,i,s,n){let r=null;return t.parents.forEach((function(t){for(const o in i){const a=i[o];a.rawBones.forEach((function(i,o){if(i.ID===t.ID){const t=r;r=new e.Bone,r.matrixWorld.copy(i.transformLink),r.name=n?e.PropertyBinding.sanitizeNodeName(n):"",r.ID=s,a.bones[o]=r,null!==t&&r.add(t)}}))}})),r}createCamera(t){let i,s;if(t.children.forEach((function(t){const e=Ke.Objects.NodeAttribute[t.ID];void 0!==e&&(s=e)})),void 0===s)i=new e.Object3D;else{let t=0;void 0!==s.CameraProjectionType&&1===s.CameraProjectionType.value&&(t=1);let n=1;void 0!==s.NearPlane&&(n=s.NearPlane.value/1e3);let r=1e3;void 0!==s.FarPlane&&(r=s.FarPlane.value/1e3);let o=window.innerWidth,a=window.innerHeight;void 0!==s.AspectWidth&&void 0!==s.AspectHeight&&(o=s.AspectWidth.value,a=s.AspectHeight.value);const l=o/a;let h=45;void 0!==s.FieldOfView&&(h=s.FieldOfView.value);const c=s.FocalLength?s.FocalLength.value:null;switch(t){case 0:i=new e.PerspectiveCamera(h,l,n,r),null!==c&&i.setFocalLength(c);break;case 1:i=new e.OrthographicCamera(-o/2,o/2,a/2,-a/2,n,r);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+t+"."),i=new e.Object3D}}return i}createLight(t){let i,s;if(t.children.forEach((function(t){const e=Ke.Objects.NodeAttribute[t.ID];void 0!==e&&(s=e)})),void 0===s)i=new e.Object3D;else{let t;t=void 0===s.LightType?0:s.LightType.value;let n=16777215;void 0!==s.Color&&(n=(new e.Color).fromArray(s.Color.value).convertSRGBToLinear());let r=void 0===s.Intensity?1:s.Intensity.value/100;void 0!==s.CastLightOnObject&&0===s.CastLightOnObject.value&&(r=0);let o=0;void 0!==s.FarAttenuationEnd&&(o=void 0!==s.EnableFarAttenuation&&0===s.EnableFarAttenuation.value?0:s.FarAttenuationEnd.value);const a=1;switch(t){case 0:i=new e.PointLight(n,r,o,a);break;case 1:i=new e.DirectionalLight(n,r);break;case 2:let t=Math.PI/3;void 0!==s.InnerAngle&&(t=e.MathUtils.degToRad(s.InnerAngle.value));let l=0;void 0!==s.OuterAngle&&(l=e.MathUtils.degToRad(s.OuterAngle.value),l=Math.max(l,1)),i=new e.SpotLight(n,r,o,t,l,a);break;default:console.warn("THREE.FBXLoader: Unknown light type "+s.LightType.value+", defaulting to a PointLight."),i=new e.PointLight(n,r)}void 0!==s.CastShadows&&1===s.CastShadows.value&&(i.castShadow=!0)}return i}createMesh(t,i,s){let n,r=null,o=null;const a=[];return t.children.forEach((function(t){i.has(t.ID)&&(r=i.get(t.ID)),s.has(t.ID)&&a.push(s.get(t.ID))})),a.length>1?o=a:a.length>0?o=a[0]:(o=new e.MeshPhongMaterial({name:e.Loader.DEFAULT_MATERIAL_NAME,color:13421772}),a.push(o)),"color"in r.attributes&&a.forEach((function(t){t.vertexColors=!0})),r.FBX_Deformer?(n=new e.SkinnedMesh(r,o),n.normalizeSkinWeights()):n=new e.Mesh(r,o),n}createCurve(t,i){const s=t.children.reduce((function(t,e){return i.has(e.ID)&&(t=i.get(e.ID)),t}),null),n=new e.LineBasicMaterial({name:e.Loader.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new e.Line(s,n)}getTransformData(t,e){const i={};"InheritType"in e&&(i.inheritType=parseInt(e.InheritType.value)),i.eulerOrder="RotationOrder"in e?gi(e.RotationOrder.value):"ZYX","Lcl_Translation"in e&&(i.translation=e.Lcl_Translation.value),"PreRotation"in e&&(i.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(i.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(i.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(i.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(i.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(i.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(i.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(i.rotationPivot=e.RotationPivot.value),t.userData.transformData=i}setLookAtProperties(t,i){if("LookAtProperty"in i){Je.get(t.ID).children.forEach((function(i){if("LookAtProperty"===i.relationship){const s=Ke.Objects.Model[i.ID];if("Lcl_Translation"in s){const i=s.Lcl_Translation.value;void 0!==t.target?(t.target.position.fromArray(i),ti.add(t.target)):t.lookAt((new e.Vector3).fromArray(i))}}}))}}bindSkeleton(t,i,s){const n=this.parsePoseNodes();for(const r in t){const o=t[r];Je.get(parseInt(o.ID)).parents.forEach((function(t){if(i.has(t.ID)){const i=t.ID;Je.get(i).parents.forEach((function(t){if(s.has(t.ID)){s.get(t.ID).bind(new e.Skeleton(o.bones),n[t.ID])}}))}}))}}parsePoseNodes(){const t={};if("Pose"in Ke.Objects){const i=Ke.Objects.Pose;for(const s in i)if("BindPose"===i[s].attrType&&i[s].NbPoseNodes>0){const n=i[s].PoseNode;Array.isArray(n)?n.forEach((function(i){t[i.Node]=(new e.Matrix4).fromArray(i.Matrix.a)})):t[n.Node]=(new e.Matrix4).fromArray(n.Matrix.a)}}return t}createAmbientLight(){if("GlobalSettings"in Ke&&"AmbientColor"in Ke.GlobalSettings){const t=Ke.GlobalSettings.AmbientColor.value,i=t[0],s=t[1],n=t[2];if(0!==i||0!==s||0!==n){const t=new e.Color(i,s,n).convertSRGBToLinear();ti.add(new e.AmbientLight(t,1))}}}}class si{constructor(){this.negativeMaterialIndices=!1}parse(t){const e=new Map;if("Geometry"in Ke.Objects){const i=Ke.Objects.Geometry;for(const s in i){const n=Je.get(parseInt(s)),r=this.parseGeometry(n,i[s],t);e.set(parseInt(s),r)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),e}parseGeometry(t,e,i){switch(e.attrType){case"Mesh":return this.parseMeshGeometry(t,e,i);case"NurbsCurve":return this.parseNurbsGeometry(e)}}parseMeshGeometry(t,e,i){const s=i.skeletons,n=[],r=t.parents.map((function(t){return Ke.Objects.Model[t.ID]}));if(0===r.length)return;const o=t.children.reduce((function(t,e){return void 0!==s[e.ID]&&(t=s[e.ID]),t}),null);t.children.forEach((function(t){void 0!==i.morphTargets[t.ID]&&n.push(i.morphTargets[t.ID])}));const a=r[0],l={};"RotationOrder"in a&&(l.eulerOrder=gi(a.RotationOrder.value)),"InheritType"in a&&(l.inheritType=parseInt(a.InheritType.value)),"GeometricTranslation"in a&&(l.translation=a.GeometricTranslation.value),"GeometricRotation"in a&&(l.rotation=a.GeometricRotation.value),"GeometricScaling"in a&&(l.scale=a.GeometricScaling.value);const h=mi(l);return this.genGeometry(e,o,n,h)}genGeometry(t,i,s,n){const r=new e.BufferGeometry;t.attrName&&(r.name=t.attrName);const o=this.parseGeoNode(t,i),a=this.genBuffers(o),l=new e.Float32BufferAttribute(a.vertex,3);if(l.applyMatrix4(n),r.setAttribute("position",l),a.colors.length>0&&r.setAttribute("color",new e.Float32BufferAttribute(a.colors,3)),i&&(r.setAttribute("skinIndex",new e.Uint16BufferAttribute(a.weightsIndices,4)),r.setAttribute("skinWeight",new e.Float32BufferAttribute(a.vertexWeights,4)),r.FBX_Deformer=i),a.normal.length>0){const t=(new e.Matrix3).getNormalMatrix(n),i=new e.Float32BufferAttribute(a.normal,3);i.applyNormalMatrix(t),r.setAttribute("normal",i)}if(a.uvs.forEach((function(t,i){const s=0===i?"uv":`uv${i}`;r.setAttribute(s,new e.Float32BufferAttribute(a.uvs[i],2))})),o.material&&"AllSame"!==o.material.mappingType){let t=a.materialIndex[0],e=0;if(a.materialIndex.forEach((function(i,s){i!==t&&(r.addGroup(e,s-e,t),t=i,e=s)})),r.groups.length>0){const e=r.groups[r.groups.length-1],i=e.start+e.count;i!==a.materialIndex.length&&r.addGroup(i,a.materialIndex.length-i,t)}0===r.groups.length&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,t,s,n),r}parseGeoNode(t,e){const i={};if(i.vertexPositions=void 0!==t.Vertices?t.Vertices.a:[],i.vertexIndices=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(i.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(i.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(i.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){i.uv=[];let e=0;for(;t.LayerElementUV[e];)t.LayerElementUV[e].UV&&i.uv.push(this.parseUVs(t.LayerElementUV[e])),e++}return i.weightTable={},null!==e&&(i.skeleton=e,e.rawBones.forEach((function(t,e){t.indices.forEach((function(s,n){void 0===i.weightTable[s]&&(i.weightTable[s]=[]),i.weightTable[s].push({id:e,weight:t.weights[n]})}))}))),i}genBuffers(t){const e={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,s=0,n=!1,r=[],o=[],a=[],l=[],h=[],c=[];const u=this;return t.vertexIndices.forEach((function(d,p){let f,m=!1;d<0&&(d^=-1,m=!0);let g=[],v=[];if(r.push(3*d,3*d+1,3*d+2),t.color){const e=di(p,i,d,t.color);a.push(e[0],e[1],e[2])}if(t.skeleton){if(void 0!==t.weightTable[d]&&t.weightTable[d].forEach((function(t){v.push(t.weight),g.push(t.id)})),v.length>4){n||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),n=!0);const t=[0,0,0,0],e=[0,0,0,0];v.forEach((function(i,s){let n=i,r=g[s];e.forEach((function(e,i,s){if(n>e){s[i]=n,n=e;const o=t[i];t[i]=r,r=o}}))})),g=t,v=e}for(;v.length<4;)v.push(0),g.push(0);for(let t=0;t<4;++t)h.push(v[t]),c.push(g[t])}if(t.normal){const e=di(p,i,d,t.normal);o.push(e[0],e[1],e[2])}t.material&&"AllSame"!==t.material.mappingType&&(f=di(p,i,d,t.material)[0],f<0&&(u.negativeMaterialIndices=!0,f=0)),t.uv&&t.uv.forEach((function(t,e){const s=di(p,i,d,t);void 0===l[e]&&(l[e]=[]),l[e].push(s[0]),l[e].push(s[1])})),s++,m&&(s>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),u.genFace(e,t,r,f,o,a,l,h,c,s),i++,s=0,r=[],o=[],a=[],l=[],h=[],c=[])})),e}genFace(t,e,i,s,n,r,o,a,l,h){for(let c=2;c<h;c++)t.vertex.push(e.vertexPositions[i[0]]),t.vertex.push(e.vertexPositions[i[1]]),t.vertex.push(e.vertexPositions[i[2]]),t.vertex.push(e.vertexPositions[i[3*(c-1)]]),t.vertex.push(e.vertexPositions[i[3*(c-1)+1]]),t.vertex.push(e.vertexPositions[i[3*(c-1)+2]]),t.vertex.push(e.vertexPositions[i[3*c]]),t.vertex.push(e.vertexPositions[i[3*c+1]]),t.vertex.push(e.vertexPositions[i[3*c+2]]),e.skeleton&&(t.vertexWeights.push(a[0]),t.vertexWeights.push(a[1]),t.vertexWeights.push(a[2]),t.vertexWeights.push(a[3]),t.vertexWeights.push(a[4*(c-1)]),t.vertexWeights.push(a[4*(c-1)+1]),t.vertexWeights.push(a[4*(c-1)+2]),t.vertexWeights.push(a[4*(c-1)+3]),t.vertexWeights.push(a[4*c]),t.vertexWeights.push(a[4*c+1]),t.vertexWeights.push(a[4*c+2]),t.vertexWeights.push(a[4*c+3]),t.weightsIndices.push(l[0]),t.weightsIndices.push(l[1]),t.weightsIndices.push(l[2]),t.weightsIndices.push(l[3]),t.weightsIndices.push(l[4*(c-1)]),t.weightsIndices.push(l[4*(c-1)+1]),t.weightsIndices.push(l[4*(c-1)+2]),t.weightsIndices.push(l[4*(c-1)+3]),t.weightsIndices.push(l[4*c]),t.weightsIndices.push(l[4*c+1]),t.weightsIndices.push(l[4*c+2]),t.weightsIndices.push(l[4*c+3])),e.color&&(t.colors.push(r[0]),t.colors.push(r[1]),t.colors.push(r[2]),t.colors.push(r[3*(c-1)]),t.colors.push(r[3*(c-1)+1]),t.colors.push(r[3*(c-1)+2]),t.colors.push(r[3*c]),t.colors.push(r[3*c+1]),t.colors.push(r[3*c+2])),e.material&&"AllSame"!==e.material.mappingType&&(t.materialIndex.push(s),t.materialIndex.push(s),t.materialIndex.push(s)),e.normal&&(t.normal.push(n[0]),t.normal.push(n[1]),t.normal.push(n[2]),t.normal.push(n[3*(c-1)]),t.normal.push(n[3*(c-1)+1]),t.normal.push(n[3*(c-1)+2]),t.normal.push(n[3*c]),t.normal.push(n[3*c+1]),t.normal.push(n[3*c+2])),e.uv&&e.uv.forEach((function(e,i){void 0===t.uvs[i]&&(t.uvs[i]=[]),t.uvs[i].push(o[i][0]),t.uvs[i].push(o[i][1]),t.uvs[i].push(o[i][2*(c-1)]),t.uvs[i].push(o[i][2*(c-1)+1]),t.uvs[i].push(o[i][2*c]),t.uvs[i].push(o[i][2*c+1])}))}addMorphTargets(t,e,i,s){if(0===i.length)return;t.morphTargetsRelative=!0,t.morphAttributes.position=[];const n=this;i.forEach((function(i){i.rawTargets.forEach((function(i){const r=Ke.Objects.Geometry[i.geoID];void 0!==r&&n.genMorphGeometry(t,e,r,s,i.name)}))}))}genMorphGeometry(t,i,s,n,r){const o=void 0!==i.PolygonVertexIndex?i.PolygonVertexIndex.a:[],a=void 0!==s.Vertices?s.Vertices.a:[],l=void 0!==s.Indexes?s.Indexes.a:[],h=3*t.attributes.position.count,c=new Float32Array(h);for(let t=0;t<l.length;t++){const e=3*l[t];c[e]=a[3*t],c[e+1]=a[3*t+1],c[e+2]=a[3*t+2]}const u={vertexIndices:o,vertexPositions:c},d=this.genBuffers(u),p=new e.Float32BufferAttribute(d.vertex,3);p.name=r||s.attrName,p.applyMatrix4(n),t.morphAttributes.position.push(p)}parseNormals(t){const e=t.MappingInformationType,i=t.ReferenceInformationType,s=t.Normals.a;let n=[];return"IndexToDirect"===i&&("NormalIndex"in t?n=t.NormalIndex.a:"NormalsIndex"in t&&(n=t.NormalsIndex.a)),{dataSize:3,buffer:s,indices:n,mappingType:e,referenceType:i}}parseUVs(t){const e=t.MappingInformationType,i=t.ReferenceInformationType,s=t.UV.a;let n=[];return"IndexToDirect"===i&&(n=t.UVIndex.a),{dataSize:2,buffer:s,indices:n,mappingType:e,referenceType:i}}parseVertexColors(t){const i=t.MappingInformationType,s=t.ReferenceInformationType,n=t.Colors.a;let r=[];"IndexToDirect"===s&&(r=t.ColorIndex.a);for(let t=0,i=new e.Color;t<n.length;t+=4)i.fromArray(n,t).convertSRGBToLinear().toArray(n,t);return{dataSize:4,buffer:n,indices:r,mappingType:i,referenceType:s}}parseMaterialIndices(t){const e=t.MappingInformationType,i=t.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const s=t.Materials.a,n=[];for(let t=0;t<s.length;++t)n.push(t);return{dataSize:1,buffer:s,indices:n,mappingType:e,referenceType:i}}parseNurbsGeometry(t){const i=parseInt(t.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new e.BufferGeometry;const s=i-1,n=t.KnotVector.a,r=[],o=t.Points.a;for(let t=0,i=o.length;t<i;t+=4)r.push((new e.Vector4).fromArray(o,t));let a,l;if("Closed"===t.Form)r.push(r[0]);else if("Periodic"===t.Form){a=s,l=n.length-1-a;for(let t=0;t<s;++t)r.push(r[t])}const h=new Ye(s,n,r,a,l).getPoints(12*r.length);return(new e.BufferGeometry).setFromPoints(h)}}class ni{parse(){const t=[],e=this.parseClips();if(void 0!==e)for(const i in e){const s=e[i],n=this.addClip(s);t.push(n)}return t}parseClips(){if(void 0===Ke.Objects.AnimationCurve)return;const t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);const e=this.parseAnimationLayers(t);return this.parseAnimStacks(e)}parseAnimationCurveNodes(){const t=Ke.Objects.AnimationCurveNode,e=new Map;for(const i in t){const s=t[i];if(null!==s.attrName.match(/S|R|T|DeformPercent/)){const t={id:s.id,attr:s.attrName,curves:{}};e.set(t.id,t)}}return e}parseAnimationCurves(t){const e=Ke.Objects.AnimationCurve;for(const i in e){const s={id:e[i].id,times:e[i].KeyTime.a.map(ci),values:e[i].KeyValueFloat.a},n=Je.get(s.id);if(void 0!==n){const e=n.parents[0].ID,i=n.parents[0].relationship;i.match(/X/)?t.get(e).curves.x=s:i.match(/Y/)?t.get(e).curves.y=s:i.match(/Z/)?t.get(e).curves.z=s:i.match(/DeformPercent/)&&t.has(e)&&(t.get(e).curves.morph=s)}}}parseAnimationLayers(t){const i=Ke.Objects.AnimationLayer,s=new Map;for(const n in i){const i=[],r=Je.get(parseInt(n));if(void 0!==r){r.children.forEach((function(s,n){if(t.has(s.ID)){const r=t.get(s.ID);if(void 0!==r.curves.x||void 0!==r.curves.y||void 0!==r.curves.z){if(void 0===i[n]){const t=Je.get(s.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID;if(void 0!==t){const r=Ke.Objects.Model[t.toString()];if(void 0===r)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",s);const o={modelName:r.attrName?e.PropertyBinding.sanitizeNodeName(r.attrName):"",ID:r.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};ti.traverse((function(t){t.ID===r.id&&(o.transform=t.matrix,t.userData.transformData&&(o.eulerOrder=t.userData.transformData.eulerOrder))})),o.transform||(o.transform=new e.Matrix4),"PreRotation"in r&&(o.preRotation=r.PreRotation.value),"PostRotation"in r&&(o.postRotation=r.PostRotation.value),i[n]=o}}i[n]&&(i[n][r.attr]=r)}else if(void 0!==r.curves.morph){if(void 0===i[n]){const t=Je.get(s.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID,r=Je.get(t).parents[0].ID,o=Je.get(r).parents[0].ID,a=Je.get(o).parents[0].ID,l=Ke.Objects.Model[a],h={modelName:l.attrName?e.PropertyBinding.sanitizeNodeName(l.attrName):"",morphName:Ke.Objects.Deformer[t].attrName};i[n]=h}i[n][r.attr]=r}}})),s.set(parseInt(n),i)}}return s}parseAnimStacks(t){const e=Ke.Objects.AnimationStack,i={};for(const s in e){const n=Je.get(parseInt(s)).children;n.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const r=t.get(n[0].ID);i[s]={name:e[s].attrName,layer:r}}return i}addClip(t){let i=[];const s=this;return t.layer.forEach((function(t){i=i.concat(s.generateTracks(t))})),new e.AnimationClip(t.name,-1,i)}generateTracks(t){const i=[];let s=new e.Vector3,n=new e.Quaternion,r=new e.Vector3;if(t.transform&&t.transform.decompose(s,n,r),s=s.toArray(),n=(new e.Euler).setFromQuaternion(n,t.eulerOrder).toArray(),r=r.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){const e=this.generateVectorTrack(t.modelName,t.T.curves,s,"position");void 0!==e&&i.push(e)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){const e=this.generateRotationTrack(t.modelName,t.R.curves,n,t.preRotation,t.postRotation,t.eulerOrder);void 0!==e&&i.push(e)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){const e=this.generateVectorTrack(t.modelName,t.S.curves,r,"scale");void 0!==e&&i.push(e)}if(void 0!==t.DeformPercent){const e=this.generateMorphTrack(t);void 0!==e&&i.push(e)}return i}generateVectorTrack(t,i,s,n){const r=this.getTimesForAllAxes(i),o=this.getKeyframeTrackValues(r,i,s);return new e.VectorKeyframeTrack(t+"."+n,r,o)}generateRotationTrack(t,i,s,n,r,o){void 0!==i.x&&(this.interpolateRotations(i.x),i.x.values=i.x.values.map(e.MathUtils.degToRad)),void 0!==i.y&&(this.interpolateRotations(i.y),i.y.values=i.y.values.map(e.MathUtils.degToRad)),void 0!==i.z&&(this.interpolateRotations(i.z),i.z.values=i.z.values.map(e.MathUtils.degToRad));const a=this.getTimesForAllAxes(i),l=this.getKeyframeTrackValues(a,i,s);void 0!==n&&((n=n.map(e.MathUtils.degToRad)).push(o),n=(new e.Euler).fromArray(n),n=(new e.Quaternion).setFromEuler(n)),void 0!==r&&((r=r.map(e.MathUtils.degToRad)).push(o),r=(new e.Euler).fromArray(r),r=(new e.Quaternion).setFromEuler(r).invert());const h=new e.Quaternion,c=new e.Euler,u=[];for(let t=0;t<l.length;t+=3)c.set(l[t],l[t+1],l[t+2],o),h.setFromEuler(c),void 0!==n&&h.premultiply(n),void 0!==r&&h.multiply(r),h.toArray(u,t/3*4);return new e.QuaternionKeyframeTrack(t+".quaternion",a,u)}generateMorphTrack(t){const i=t.DeformPercent.curves.morph,s=i.values.map((function(t){return t/100})),n=ti.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new e.NumberKeyframeTrack(t.modelName+".morphTargetInfluences["+n+"]",i.times,s)}getTimesForAllAxes(t){let e=[];if(void 0!==t.x&&(e=e.concat(t.x.times)),void 0!==t.y&&(e=e.concat(t.y.times)),void 0!==t.z&&(e=e.concat(t.z.times)),e=e.sort((function(t,e){return t-e})),e.length>1){let t=1,i=e[0];for(let s=1;s<e.length;s++){const n=e[s];n!==i&&(e[t]=n,i=n,t++)}e=e.slice(0,t)}return e}getKeyframeTrackValues(t,e,i){const s=i,n=[];let r=-1,o=-1,a=-1;return t.forEach((function(t){if(e.x&&(r=e.x.times.indexOf(t)),e.y&&(o=e.y.times.indexOf(t)),e.z&&(a=e.z.times.indexOf(t)),-1!==r){const t=e.x.values[r];n.push(t),s[0]=t}else n.push(s[0]);if(-1!==o){const t=e.y.values[o];n.push(t),s[1]=t}else n.push(s[1]);if(-1!==a){const t=e.z.values[a];n.push(t),s[2]=t}else n.push(s[2])})),n}interpolateRotations(t){for(let e=1;e<t.values.length;e++){const i=t.values[e-1],s=t.values[e]-i,n=Math.abs(s);if(n>=180){const r=n/180,o=s/r;let a=i+o;const l=t.times[e-1],h=(t.times[e]-l)/r;let c=l+h;const u=[],d=[];for(;c<t.times[e];)u.push(c),c+=h,d.push(a),a+=o;t.times=bi(t.times,e,u),t.values=bi(t.values,e,d)}}}}class ri{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(t){this.nodeStack.push(t),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(t,e){this.currentProp=t,this.currentPropName=e}parse(t){this.currentIndent=0,this.allNodes=new li,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const e=this,i=t.split(/[\r\n]+/);return i.forEach((function(t,s){const n=t.match(/^[\s\t]*;/),r=t.match(/^[\s\t]*$/);if(n||r)return;const o=t.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),a=t.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=t.match("^\\t{"+(e.currentIndent-1)+"}}");o?e.parseNodeBegin(t,o):a?e.parseNodeProperty(t,a,i[++s]):l?e.popStack():t.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(t)})),this.allNodes}parseNodeBegin(t,e){const i=e[1].trim().replace(/^"/,"").replace(/"$/,""),s=e[2].split(",").map((function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")})),n={name:i},r=this.parseNodeAttr(s),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(i,n):i in o?("PoseNode"===i?o.PoseNode.push(n):void 0!==o[i].id&&(o[i]={},o[i][o[i].id]=o[i]),""!==r.id&&(o[i][r.id]=n)):"number"==typeof r.id?(o[i]={},o[i][r.id]=n):"Properties70"!==i&&(o[i]="PoseNode"===i?[n]:n),"number"==typeof r.id&&(n.id=r.id),""!==r.name&&(n.attrName=r.name),""!==r.type&&(n.attrType=r.type),this.pushStack(n)}parseNodeAttr(t){let e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));let i="",s="";return t.length>1&&(i=t[1].replace(/^(\w+)::/,""),s=t[2]),{id:e,name:i,type:s}}parseNodeProperty(t,e,i){let s=e[1].replace(/^"/,"").replace(/"$/,"").trim(),n=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===s&&","===n&&(n=i.replace(/"/g,"").replace(/,$/,"").trim());const r=this.getCurrentNode();if("Properties70"!==r.name){if("C"===s){const t=n.split(",").slice(1),e=parseInt(t[0]),i=parseInt(t[1]);let o=n.split(",").slice(3);o=o.map((function(t){return t.trim().replace(/^"/,"")})),s="connections",n=[e,i],function(t,e){for(let i=0,s=t.length,n=e.length;i<n;i++,s++)t[s]=e[i]}(n,o),void 0===r[s]&&(r[s]=[])}"Node"===s&&(r.id=n),s in r&&Array.isArray(r[s])?r[s].push(n):"a"!==s?r[s]=n:r.a=n,this.setCurrentProp(r,s),"a"===s&&","!==n.slice(-1)&&(r.a=vi(n))}else this.parseNodeSpecialProperty(t,s,n)}parseNodePropertyContinued(t){const e=this.getCurrentNode();e.a+=t,","!==t.slice(-1)&&(e.a=vi(e.a))}parseNodeSpecialProperty(t,e,i){const s=i.split('",').map((function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")})),n=s[0],r=s[1],o=s[2],a=s[3];let l=s[4];switch(r){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=vi(l)}this.getPrevNode()[n]={type:r,type2:o,flag:a,value:l},this.setCurrentProp(this.getPrevNode(),n)}}class oi{parse(t){const e=new ai(t);e.skip(23);const i=e.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const s=new li;for(;!this.endOfContent(e);){const t=this.parseNode(e,i);null!==t&&s.add(t.name,t)}return s}endOfContent(t){return t.size()%16==0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()}parseNode(t,e){const i={},s=e>=7500?t.getUint64():t.getUint32(),n=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();const r=t.getUint8(),o=t.getString(r);if(0===s)return null;const a=[];for(let e=0;e<n;e++)a.push(this.parseProperty(t));const l=a.length>0?a[0]:"",h=a.length>1?a[1]:"",c=a.length>2?a[2]:"";for(i.singleProperty=1===n&&t.getOffset()===s;s>t.getOffset();){const s=this.parseNode(t,e);null!==s&&this.parseSubNode(o,i,s)}return i.propertyList=a,"number"==typeof l&&(i.id=l),""!==h&&(i.attrName=h),""!==c&&(i.attrType=c),""!==o&&(i.name=o),i}parseSubNode(t,e,i){if(!0===i.singleProperty){const t=i.propertyList[0];Array.isArray(t)?(e[i.name]=i,i.a=t):e[i.name]=t}else if("Connections"===t&&"C"===i.name){const t=[];i.propertyList.forEach((function(e,i){0!==i&&t.push(e)})),void 0===e.connections&&(e.connections=[]),e.connections.push(t)}else if("Properties70"===i.name){Object.keys(i).forEach((function(t){e[t]=i[t]}))}else if("Properties70"===t&&"P"===i.name){let t=i.propertyList[0],s=i.propertyList[1];const n=i.propertyList[2],r=i.propertyList[3];let o;0===t.indexOf("Lcl ")&&(t=t.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),o="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:i.propertyList[4],e[t]={type:s,type2:n,flag:r,value:o}}else void 0===e[i.name]?"number"==typeof i.id?(e[i.name]={},e[i.name][i.id]=i):e[i.name]=i:"PoseNode"===i.name?(Array.isArray(e[i.name])||(e[i.name]=[e[i.name]]),e[i.name].push(i)):void 0===e[i.name][i.id]&&(e[i.name][i.id]=i)}parseProperty(t){const e=t.getString(1);let i;switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":return i=t.getUint32(),t.getArrayBuffer(i);case"S":return i=t.getUint32(),t.getString(i);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=t.getUint32(),n=t.getUint32(),r=t.getUint32();if(0===n)switch(e){case"b":case"c":return t.getBooleanArray(s);case"d":return t.getFloat64Array(s);case"f":return t.getFloat32Array(s);case"i":return t.getInt32Array(s);case"l":return t.getInt64Array(s)}const o=Ge(new Uint8Array(t.getArrayBuffer(r))),a=new ai(o.buffer);switch(e){case"b":case"c":return a.getBooleanArray(s);case"d":return a.getFloat64Array(s);case"f":return a.getFloat32Array(s);case"i":return a.getInt32Array(s);case"l":return a.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+e)}}}class ai{constructor(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(t){this.offset+=t}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(t){const e=[];for(let i=0;i<t;i++)e.push(this.getBoolean());return e}getUint8(){const t=this.dv.getUint8(this.offset);return this.offset+=1,t}getInt16(){const t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}getInt32(){const t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}getInt32Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getInt32());return e}getUint32(){const t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}getInt64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,t=4294967295&~t,4294967295===t&&(e=e+1&4294967295),t=t+1&4294967295,-(4294967296*e+t)):4294967296*e+t}getInt64Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getInt64());return e}getUint64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t}getFloat32(){const t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}getFloat32Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getFloat32());return e}getFloat64(){const t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}getFloat64Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getFloat64());return e}getArrayBuffer(t){const e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}getString(t){const e=this.offset;let i=new Uint8Array(this.dv.buffer,e,t);this.skip(t);const s=i.indexOf(0);return s>=0&&(i=new Uint8Array(this.dv.buffer,e,s)),this._textDecoder.decode(i)}}class li{add(t,e){this[t]=e}}function hi(t){const e=t.match(/FBXVersion: (\d+)/);if(e){return parseInt(e[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function ci(t){return t/46186158e3}const ui=[];function di(t,e,i,s){let n;switch(s.mappingType){case"ByPolygonVertex":n=t;break;case"ByPolygon":n=e;break;case"ByVertice":n=i;break;case"AllSame":n=s.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+s.mappingType)}"IndexToDirect"===s.referenceType&&(n=s.indices[n]);const r=n*s.dataSize,o=r+s.dataSize;return function(t,e,i,s){for(let n=i,r=0;n<s;n++,r++)t[r]=e[n];return t}(ui,s.buffer,r,o)}const pi=new e.Euler,fi=new e.Vector3;function mi(t){const i=new e.Matrix4,s=new e.Matrix4,n=new e.Matrix4,r=new e.Matrix4,o=new e.Matrix4,a=new e.Matrix4,l=new e.Matrix4,h=new e.Matrix4,c=new e.Matrix4,u=new e.Matrix4,d=new e.Matrix4,p=new e.Matrix4,f=t.inheritType?t.inheritType:0;if(t.translation&&i.setPosition(fi.fromArray(t.translation)),t.preRotation){const i=t.preRotation.map(e.MathUtils.degToRad);i.push(t.eulerOrder||e.Euler.DEFAULT_ORDER),s.makeRotationFromEuler(pi.fromArray(i))}if(t.rotation){const i=t.rotation.map(e.MathUtils.degToRad);i.push(t.eulerOrder||e.Euler.DEFAULT_ORDER),n.makeRotationFromEuler(pi.fromArray(i))}if(t.postRotation){const i=t.postRotation.map(e.MathUtils.degToRad);i.push(t.eulerOrder||e.Euler.DEFAULT_ORDER),r.makeRotationFromEuler(pi.fromArray(i)),r.invert()}t.scale&&o.scale(fi.fromArray(t.scale)),t.scalingOffset&&l.setPosition(fi.fromArray(t.scalingOffset)),t.scalingPivot&&a.setPosition(fi.fromArray(t.scalingPivot)),t.rotationOffset&&h.setPosition(fi.fromArray(t.rotationOffset)),t.rotationPivot&&c.setPosition(fi.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(d.copy(t.parentMatrix),u.copy(t.parentMatrixWorld));const m=s.clone().multiply(n).multiply(r),g=new e.Matrix4;g.extractRotation(u);const v=new e.Matrix4;v.copyPosition(u);const y=v.clone().invert().multiply(u),b=g.clone().invert().multiply(y),x=o,O=new e.Matrix4;if(0===f)O.copy(g).multiply(m).multiply(b).multiply(x);else if(1===f)O.copy(g).multiply(b).multiply(m).multiply(x);else{const t=(new e.Matrix4).scale((new e.Vector3).setFromMatrixScale(d)).clone().invert(),i=b.clone().multiply(t);O.copy(g).multiply(m).multiply(i).multiply(x)}const w=c.clone().invert(),S=a.clone().invert();let k=i.clone().multiply(h).multiply(c).multiply(s).multiply(n).multiply(r).multiply(w).multiply(l).multiply(a).multiply(o).multiply(S);const A=(new e.Matrix4).copyPosition(k),T=u.clone().multiply(A);return p.copyPosition(T),k=p.clone().multiply(O),k.premultiply(u.invert()),k}function gi(t){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(t=t||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[t]}function vi(t){return t.split(",").map((function(t){return parseFloat(t)}))}function yi(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=t.byteLength),(new TextDecoder).decode(new Uint8Array(t,e,i))}function bi(t,e,i){return t.slice(0,e).concat(i).concat(t.slice(e))}class xi extends e.DataTextureLoader{constructor(t){super(t),this.type=e.HalfFloatType}parse(t){const i=function(t,e){switch(t){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(e||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(e||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(e||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(e||""))}},s=function(t,e,i){e=e||1024;let s=t.pos,n=-1,r=0,o="",a=String.fromCharCode.apply(null,new Uint16Array(t.subarray(s,s+128)));for(;0>(n=a.indexOf("\n"))&&r<e&&s<t.byteLength;)o+=a,r+=a.length,s+=128,a+=String.fromCharCode.apply(null,new Uint16Array(t.subarray(s,s+128)));return-1<n&&(!1!==i&&(t.pos+=r+n+1),o+a.slice(0,n))},n=function(t,e,i,s){const n=t[e+3],r=Math.pow(2,n-128)/255;i[s+0]=t[e+0]*r,i[s+1]=t[e+1]*r,i[s+2]=t[e+2]*r,i[s+3]=1},r=function(t,i,s,n){const r=t[i+3],o=Math.pow(2,r-128)/255;s[n+0]=e.DataUtils.toHalfFloat(Math.min(t[i+0]*o,65504)),s[n+1]=e.DataUtils.toHalfFloat(Math.min(t[i+1]*o,65504)),s[n+2]=e.DataUtils.toHalfFloat(Math.min(t[i+2]*o,65504)),s[n+3]=e.DataUtils.toHalfFloat(1)},o=new Uint8Array(t);o.pos=0;const a=function(t){const e=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,h;for((t.pos>=t.byteLength||!(l=s(t)))&&i(1,"no header found"),(h=l.match(/^#\?(\S+)/))||i(3,"bad initial token"),a.valid|=1,a.programtype=h[1],a.string+=l+"\n";l=s(t),!1!==l;)if(a.string+=l+"\n","#"!==l.charAt(0)){if((h=l.match(e))&&(a.gamma=parseFloat(h[1])),(h=l.match(n))&&(a.exposure=parseFloat(h[1])),(h=l.match(r))&&(a.valid|=2,a.format=h[1]),(h=l.match(o))&&(a.valid|=4,a.height=parseInt(h[1],10),a.width=parseInt(h[2],10)),2&a.valid&&4&a.valid)break}else a.comments+=l+"\n";return 2&a.valid||i(3,"missing format specifier"),4&a.valid||i(3,"missing image size specifier"),a}(o),l=a.width,h=a.height,c=function(t,e,s){const n=e;if(n<8||n>32767||2!==t[0]||2!==t[1]||128&t[2])return new Uint8Array(t);n!==(t[2]<<8|t[3])&&i(3,"wrong scanline width");const r=new Uint8Array(4*e*s);r.length||i(4,"unable to allocate buffer space");let o=0,a=0;const l=4*n,h=new Uint8Array(4),c=new Uint8Array(l);let u=s;for(;u>0&&a<t.byteLength;){a+4>t.byteLength&&i(1),h[0]=t[a++],h[1]=t[a++],h[2]=t[a++],h[3]=t[a++],2==h[0]&&2==h[1]&&(h[2]<<8|h[3])==n||i(3,"bad rgbe scanline format");let e,s=0;for(;s<l&&a<t.byteLength;){e=t[a++];const n=e>128;if(n&&(e-=128),(0===e||s+e>l)&&i(3,"bad scanline data"),n){const i=t[a++];for(let t=0;t<e;t++)c[s++]=i}else c.set(t.subarray(a,a+e),s),s+=e,a+=e}const d=n;for(let t=0;t<d;t++){let e=0;r[o]=c[t+e],e+=n,r[o+1]=c[t+e],e+=n,r[o+2]=c[t+e],e+=n,r[o+3]=c[t+e],o+=4}u--}return r}(o.subarray(o.pos),l,h);let u,d,p;switch(this.type){case e.FloatType:p=c.length/4;const t=new Float32Array(4*p);for(let e=0;e<p;e++)n(c,4*e,t,4*e);u=t,d=e.FloatType;break;case e.HalfFloatType:p=c.length/4;const i=new Uint16Array(4*p);for(let t=0;t<p;t++)r(c,4*t,i,4*t);u=i,d=e.HalfFloatType;break;default:throw new Error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:l,height:h,data:u,header:a.string,gamma:a.gamma,exposure:a.exposure,type:d}}setDataType(t){return this.type=t,this}load(t,i,s,n){return super.load(t,(function(t,s){switch(t.type){case e.FloatType:case e.HalfFloatType:t.colorSpace=e.LinearSRGBColorSpace,t.minFilter=e.LinearFilter,t.magFilter=e.LinearFilter,t.generateMipmaps=!1,t.flipY=!0}i&&i(t,s)}),s,n)}}class Oi extends e.DataTextureLoader{constructor(t){super(t),this.type=e.HalfFloatType}parse(t){const i=65536,s=14,n=65537,r=16384,o=Math.pow(2.7182818,2.2);const a={l:0,c:0,lc:0};function l(t,e,i,s,n){for(;i<t;)e=e<<8|B(s,n),i+=8;i-=t,a.l=e>>i&(1<<t)-1,a.c=e,a.lc=i}const h=new Array(59);function c(t,e,i,s,r,o){const c=e;let u=0,d=0;for(;s<=r;s++){if(c.value-e.value>i)return!1;l(6,u,d,t,c);const n=a.l;if(u=a.c,d=a.lc,o[s]=n,63==n){if(c.value-e.value>i)throw new Error("Something wrong with hufUnpackEncTable");l(8,u,d,t,c);let n=a.l+6;if(u=a.c,d=a.lc,s+n>r+1)throw new Error("Something wrong with hufUnpackEncTable");for(;n--;)o[s++]=0;s--}else if(n>=59){let t=n-59+2;if(s+t>r+1)throw new Error("Something wrong with hufUnpackEncTable");for(;t--;)o[s++]=0;s--}}!function(t){for(let t=0;t<=58;++t)h[t]=0;for(let e=0;e<n;++e)h[t[e]]+=1;let e=0;for(let t=58;t>0;--t){const i=e+h[t]>>1;h[t]=e,e=i}for(let e=0;e<n;++e){const i=t[e];i>0&&(t[e]=i|h[i]++<<6)}}(o)}function u(t){return 63&t}function d(t){return t>>6}const p={c:0,lc:0};function f(t,e,i,s){t=t<<8|B(i,s),e+=8,p.c=t,p.lc=e}const m={c:0,lc:0};function g(t,e,i,s,n,r,o,a,l){if(t==e){s<8&&(f(i,s,n,r),i=p.c,s=p.lc);let t=i>>(s-=8);if(t=new Uint8Array([t])[0],a.value+t>l)return!1;const e=o[a.value-1];for(;t-- >0;)o[a.value++]=e}else{if(!(a.value<l))return!1;o[a.value++]=t}m.c=i,m.lc=s}function v(t){return 65535&t}function y(t){const e=v(t);return e>32767?e-65536:e}const b={a:0,b:0};function x(t,e){const i=y(t),s=y(e),n=i+(1&s)+(s>>1),r=n,o=n-s;b.a=r,b.b=o}function O(t,e){const i=v(t),s=v(e),n=i-(s>>1)&65535,r=s+n-32768&65535;b.a=r,b.b=n}function w(t,e,i,s,n,r,o){const a=o<16384,l=i>n?n:i;let h,c,u=1;for(;u<=l;)u<<=1;for(u>>=1,h=u,u>>=1;u>=1;){c=0;const o=c+r*(n-h),l=r*u,d=r*h,p=s*u,f=s*h;let m,g,v,y;for(;c<=o;c+=d){let n=c;const r=c+s*(i-h);for(;n<=r;n+=f){const i=n+p,s=n+l,r=s+p;a?(x(t[n+e],t[s+e]),m=b.a,v=b.b,x(t[i+e],t[r+e]),g=b.a,y=b.b,x(m,g),t[n+e]=b.a,t[i+e]=b.b,x(v,y),t[s+e]=b.a,t[r+e]=b.b):(O(t[n+e],t[s+e]),m=b.a,v=b.b,O(t[i+e],t[r+e]),g=b.a,y=b.b,O(m,g),t[n+e]=b.a,t[i+e]=b.b,O(v,y),t[s+e]=b.a,t[r+e]=b.b)}if(i&u){const i=n+l;a?x(t[n+e],t[i+e]):O(t[n+e],t[i+e]),m=b.a,t[i+e]=b.b,t[n+e]=m}}if(n&u){let n=c;const r=c+s*(i-h);for(;n<=r;n+=f){const i=n+p;a?x(t[n+e],t[i+e]):O(t[n+e],t[i+e]),m=b.a,t[i+e]=b.b,t[n+e]=m}}h=u,u>>=1}return c}function S(t,e,i,o,a,l){const h=i.value,v=V(e,i),y=V(e,i);i.value+=4;const b=V(e,i);if(i.value+=4,v<0||v>=n||y<0||y>=n)throw new Error("Something wrong with HUF_ENCSIZE");const x=new Array(n),O=new Array(r);!function(t){for(let e=0;e<r;e++)t[e]={},t[e].len=0,t[e].lit=0,t[e].p=null}(O);if(c(t,i,o-(i.value-h),v,y,x),b>8*(o-(i.value-h)))throw new Error("Something wrong with hufUncompress");!function(t,e,i,n){for(;e<=i;e++){const i=d(t[e]),r=u(t[e]);if(i>>r)throw new Error("Invalid table entry");if(r>s){const t=n[i>>r-s];if(t.len)throw new Error("Invalid table entry");if(t.lit++,t.p){const e=t.p;t.p=new Array(t.lit);for(let i=0;i<t.lit-1;++i)t.p[i]=e[i]}else t.p=new Array(1);t.p[t.lit-1]=e}else if(r){let t=0;for(let o=1<<s-r;o>0;o--){const o=n[(i<<s-r)+t];if(o.len||o.p)throw new Error("Invalid table entry");o.len=r,o.lit=e,t++}}}}(x,v,y,O),function(t,e,i,n,r,o,a,l,h){let c=0,v=0;const y=a,b=Math.trunc(n.value+(r+7)/8);for(;n.value<b;)for(f(c,v,i,n),c=p.c,v=p.lc;v>=s;){const r=e[c>>v-s&16383];if(r.len)v-=r.len,g(r.lit,o,c,v,i,n,l,h,y),c=m.c,v=m.lc;else{if(!r.p)throw new Error("hufDecode issues");let e;for(e=0;e<r.lit;e++){const s=u(t[r.p[e]]);for(;v<s&&n.value<b;)f(c,v,i,n),c=p.c,v=p.lc;if(v>=s&&d(t[r.p[e]])==(c>>v-s&(1<<s)-1)){v-=s,g(r.p[e],o,c,v,i,n,l,h,y),c=m.c,v=m.lc;break}}if(e==r.lit)throw new Error("hufDecode issues")}}const x=8-r&7;for(c>>=x,v-=x;v>0;){const t=e[c<<s-v&16383];if(!t.len)throw new Error("hufDecode issues");v-=t.len,g(t.lit,o,c,v,i,n,l,h,y),c=m.c,v=m.lc}}(x,O,t,i,b,y,l,a,{value:0})}function k(t){for(let e=1;e<t.length;e++){const i=t[e-1]+t[e]-128;t[e]=i}}function A(t,e){let i=0,s=Math.floor((t.length+1)/2),n=0;const r=t.length-1;for(;!(n>r||(e[n++]=t[i++],n>r));)e[n++]=t[s++]}function T(t){let e=t.byteLength;const i=new Array;let s=0;const n=new DataView(t);for(;e>0;){const t=n.getInt8(s++);if(t<0){const r=-t;e-=r+1;for(let t=0;t<r;t++)i.push(n.getUint8(s++))}else{const r=t;e-=2;const o=n.getUint8(s++);for(let t=0;t<r+1;t++)i.push(o)}}return i}function M(t,e,i){let s,n=1;for(;n<64;)s=e[t.value],65280==s?n=64:s>>8==255?n+=255&s:(i[n]=s,n++),t.value++}function P(t,e){e[0]=Z(t[0]),e[1]=Z(t[1]),e[2]=Z(t[5]),e[3]=Z(t[6]),e[4]=Z(t[14]),e[5]=Z(t[15]),e[6]=Z(t[27]),e[7]=Z(t[28]),e[8]=Z(t[2]),e[9]=Z(t[4]),e[10]=Z(t[7]),e[11]=Z(t[13]),e[12]=Z(t[16]),e[13]=Z(t[26]),e[14]=Z(t[29]),e[15]=Z(t[42]),e[16]=Z(t[3]),e[17]=Z(t[8]),e[18]=Z(t[12]),e[19]=Z(t[17]),e[20]=Z(t[25]),e[21]=Z(t[30]),e[22]=Z(t[41]),e[23]=Z(t[43]),e[24]=Z(t[9]),e[25]=Z(t[11]),e[26]=Z(t[18]),e[27]=Z(t[24]),e[28]=Z(t[31]),e[29]=Z(t[40]),e[30]=Z(t[44]),e[31]=Z(t[53]),e[32]=Z(t[10]),e[33]=Z(t[19]),e[34]=Z(t[23]),e[35]=Z(t[32]),e[36]=Z(t[39]),e[37]=Z(t[45]),e[38]=Z(t[52]),e[39]=Z(t[54]),e[40]=Z(t[20]),e[41]=Z(t[22]),e[42]=Z(t[33]),e[43]=Z(t[38]),e[44]=Z(t[46]),e[45]=Z(t[51]),e[46]=Z(t[55]),e[47]=Z(t[60]),e[48]=Z(t[21]),e[49]=Z(t[34]),e[50]=Z(t[37]),e[51]=Z(t[47]),e[52]=Z(t[50]),e[53]=Z(t[56]),e[54]=Z(t[59]),e[55]=Z(t[61]),e[56]=Z(t[35]),e[57]=Z(t[36]),e[58]=Z(t[48]),e[59]=Z(t[49]),e[60]=Z(t[57]),e[61]=Z(t[58]),e[62]=Z(t[62]),e[63]=Z(t[63])}function C(t){const e=.5*Math.cos(.7853975),i=.5*Math.cos(3.14159/16),s=.5*Math.cos(3.14159/8),n=.5*Math.cos(3*3.14159/16),r=.5*Math.cos(.981746875),o=.5*Math.cos(3*3.14159/8),a=.5*Math.cos(1.374445625),l=new Array(4),h=new Array(4),c=new Array(4),u=new Array(4);for(let d=0;d<8;++d){const p=8*d;l[0]=s*t[p+2],l[1]=o*t[p+2],l[2]=s*t[p+6],l[3]=o*t[p+6],h[0]=i*t[p+1]+n*t[p+3]+r*t[p+5]+a*t[p+7],h[1]=n*t[p+1]-a*t[p+3]-i*t[p+5]-r*t[p+7],h[2]=r*t[p+1]-i*t[p+3]+a*t[p+5]+n*t[p+7],h[3]=a*t[p+1]-r*t[p+3]+n*t[p+5]-i*t[p+7],c[0]=e*(t[p+0]+t[p+4]),c[3]=e*(t[p+0]-t[p+4]),c[1]=l[0]+l[3],c[2]=l[1]-l[2],u[0]=c[0]+c[1],u[1]=c[3]+c[2],u[2]=c[3]-c[2],u[3]=c[0]-c[1],t[p+0]=u[0]+h[0],t[p+1]=u[1]+h[1],t[p+2]=u[2]+h[2],t[p+3]=u[3]+h[3],t[p+4]=u[3]-h[3],t[p+5]=u[2]-h[2],t[p+6]=u[1]-h[1],t[p+7]=u[0]-h[0]}for(let d=0;d<8;++d)l[0]=s*t[16+d],l[1]=o*t[16+d],l[2]=s*t[48+d],l[3]=o*t[48+d],h[0]=i*t[8+d]+n*t[24+d]+r*t[40+d]+a*t[56+d],h[1]=n*t[8+d]-a*t[24+d]-i*t[40+d]-r*t[56+d],h[2]=r*t[8+d]-i*t[24+d]+a*t[40+d]+n*t[56+d],h[3]=a*t[8+d]-r*t[24+d]+n*t[40+d]-i*t[56+d],c[0]=e*(t[d]+t[32+d]),c[3]=e*(t[d]-t[32+d]),c[1]=l[0]+l[3],c[2]=l[1]-l[2],u[0]=c[0]+c[1],u[1]=c[3]+c[2],u[2]=c[3]-c[2],u[3]=c[0]-c[1],t[0+d]=u[0]+h[0],t[8+d]=u[1]+h[1],t[16+d]=u[2]+h[2],t[24+d]=u[3]+h[3],t[32+d]=u[3]-h[3],t[40+d]=u[2]-h[2],t[48+d]=u[1]-h[1],t[56+d]=u[0]-h[0]}function _(t){for(let e=0;e<64;++e){const i=t[0][e],s=t[1][e],n=t[2][e];t[0][e]=i+1.5747*n,t[1][e]=i-.1873*s-.4682*n,t[2][e]=i+1.8556*s}}function R(t,i,s){for(let n=0;n<64;++n)i[s+n]=e.DataUtils.toHalfFloat(E(t[n]))}function E(t){return t<=1?Math.sign(t)*Math.pow(Math.abs(t),2.2):Math.sign(t)*Math.pow(o,Math.abs(t)-1)}function Q(t){return new DataView(t.array.buffer,t.offset.value,t.size)}function L(t){const e=t.viewer.buffer.slice(t.offset.value,t.offset.value+t.size),i=new Uint8Array(T(e)),s=new Uint8Array(i.length);return k(i),A(i,s),new DataView(s.buffer)}function F(t){const e=Ge(t.array.slice(t.offset.value,t.offset.value+t.size)),i=new Uint8Array(e.length);return k(e),A(e,i),new DataView(i.buffer)}function I(t){const e=t.viewer,s={value:t.offset.value},n=new Uint16Array(t.width*t.scanlineBlockSize*(t.channels*t.type)),r=new Uint8Array(8192);let o=0;const a=new Array(t.channels);for(let e=0;e<t.channels;e++)a[e]={},a[e].start=o,a[e].end=a[e].start,a[e].nx=t.width,a[e].ny=t.lines,a[e].size=t.type,o+=a[e].nx*a[e].ny*a[e].size;const l=q(e,s),h=q(e,s);if(h>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(l<=h)for(let t=0;t<h-l+1;t++)r[t+l]=$(e,s);const c=new Uint16Array(i),u=function(t,e){let s=0;for(let n=0;n<i;++n)(0==n||t[n>>3]&1<<(7&n))&&(e[s++]=n);const n=s-1;for(;s<i;)e[s++]=0;return n}(r,c),d=V(e,s);S(t.array,e,s,d,n,o);for(let e=0;e<t.channels;++e){const t=a[e];for(let i=0;i<a[e].size;++i)w(n,t.start+i,t.nx,t.size,t.ny,t.nx*t.size,u)}!function(t,e,i){for(let s=0;s<i;++s)e[s]=t[e[s]]}(c,n,o);let p=0;const f=new Uint8Array(n.buffer.byteLength);for(let e=0;e<t.lines;e++)for(let e=0;e<t.channels;e++){const t=a[e],i=t.nx*t.size,s=new Uint8Array(n.buffer,2*t.end,2*i);f.set(s,p),p+=2*i,t.end+=i}return new DataView(f.buffer)}function D(t){const e=Ge(t.array.slice(t.offset.value,t.offset.value+t.size)),i=t.lines*t.channels*t.width,s=1==t.type?new Uint16Array(i):new Uint32Array(i);let n=0,r=0;const o=new Array(4);for(let i=0;i<t.lines;i++)for(let i=0;i<t.channels;i++){let i=0;switch(t.type){case 1:o[0]=n,o[1]=o[0]+t.width,n=o[1]+t.width;for(let n=0;n<t.width;++n){i+=e[o[0]++]<<8|e[o[1]++],s[r]=i,r++}break;case 2:o[0]=n,o[1]=o[0]+t.width,o[2]=o[1]+t.width,n=o[2]+t.width;for(let n=0;n<t.width;++n){i+=e[o[0]++]<<24|e[o[1]++]<<16|e[o[2]++]<<8,s[r]=i,r++}}}return new DataView(s.buffer)}function U(t){const e=t.viewer,i={value:t.offset.value},s=new Uint8Array(t.width*t.lines*(t.channels*t.type*2)),n={version:X(e,i),unknownUncompressedSize:X(e,i),unknownCompressedSize:X(e,i),acCompressedSize:X(e,i),dcCompressedSize:X(e,i),rleCompressedSize:X(e,i),rleUncompressedSize:X(e,i),rleRawSize:X(e,i),totalAcUncompressedCount:X(e,i),totalDcUncompressedCount:X(e,i),acCompression:X(e,i)};if(n.version<2)throw new Error("EXRLoader.parse: "+tt.compression+" version "+n.version+" is unsupported");const r=new Array;let o=q(e,i)-2;for(;o>0;){const t=z(e.buffer,i),s=$(e,i),n=s>>2&3,a=new Int8Array([(s>>4)-1])[0],l=$(e,i);r.push({name:t,index:a,type:l,compression:n}),o-=t.length+3}const a=tt.channels,l=new Array(t.channels);for(let e=0;e<t.channels;++e){const i=l[e]={},s=a[e];i.name=s.name,i.compression=0,i.decoded=!1,i.type=s.pixelType,i.pLinear=s.pLinear,i.width=t.width,i.height=t.lines}const h={idx:new Array(3)};for(let e=0;e<t.channels;++e){const t=l[e];for(let i=0;i<r.length;++i){const s=r[i];t.name==s.name&&(t.compression=s.compression,s.index>=0&&(h.idx[s.index]=e),t.offset=e)}}let c,u,d;if(n.acCompressedSize>0)switch(n.acCompression){case 0:c=new Uint16Array(n.totalAcUncompressedCount),S(t.array,e,i,n.acCompressedSize,c,n.totalAcUncompressedCount);break;case 1:const s=Ge(t.array.slice(i.value,i.value+n.totalAcUncompressedCount));c=new Uint16Array(s.buffer),i.value+=n.totalAcUncompressedCount}if(n.dcCompressedSize>0){const e={array:t.array,offset:i,size:n.dcCompressedSize};u=new Uint16Array(F(e).buffer),i.value+=n.dcCompressedSize}if(n.rleRawSize>0){d=T(Ge(t.array.slice(i.value,i.value+n.rleCompressedSize)).buffer),i.value+=n.rleCompressedSize}let p=0;const f=new Array(l.length);for(let t=0;t<f.length;++t)f[t]=new Array;for(let e=0;e<t.lines;++e)for(let e=0;e<l.length;++e)f[e].push(p),p+=l[e].width*t.type*2;!function(t,e,i,s,n,r){let o=new DataView(r.buffer);const a=i[t.idx[0]].width,l=i[t.idx[0]].height,h=Math.floor(a/8),c=Math.ceil(a/8),u=Math.ceil(l/8),d=a-8*(c-1),p=l-8*(u-1),f={value:0},m=new Array(3),g=new Array(3),v=new Array(3),y=new Array(3),b=new Array(3);for(let i=0;i<3;++i)b[i]=e[t.idx[i]],m[i]=i<1?0:m[i-1]+c*u,g[i]=new Float32Array(64),v[i]=new Uint16Array(64),y[i]=new Uint16Array(64*c);for(let e=0;e<u;++e){let r=8;e==u-1&&(r=p);let a=8;for(let t=0;t<c;++t){t==c-1&&(a=d);for(let t=0;t<3;++t)v[t].fill(0),v[t][0]=n[m[t]++],M(f,s,v[t]),P(v[t],g[t]),C(g[t]);_(g);for(let e=0;e<3;++e)R(g[e],y[e],64*t)}let l=0;for(let s=0;s<3;++s){const n=i[t.idx[s]].type;for(let t=8*e;t<8*e+r;++t){l=b[s][t];for(let e=0;e<h;++e){const i=64*e+8*(7&t);o.setUint16(l+0*n,y[s][i+0],!0),o.setUint16(l+2*n,y[s][i+1],!0),o.setUint16(l+4*n,y[s][i+2],!0),o.setUint16(l+6*n,y[s][i+3],!0),o.setUint16(l+8*n,y[s][i+4],!0),o.setUint16(l+10*n,y[s][i+5],!0),o.setUint16(l+12*n,y[s][i+6],!0),o.setUint16(l+14*n,y[s][i+7],!0),l+=16*n}}if(h!=c)for(let t=8*e;t<8*e+r;++t){const e=b[s][t]+8*h*2*n,i=64*h+8*(7&t);for(let t=0;t<a;++t)o.setUint16(e+2*t*n,y[s][i+t],!0)}}}const x=new Uint16Array(a);o=new DataView(r.buffer);for(let e=0;e<3;++e){i[t.idx[e]].decoded=!0;const s=i[t.idx[e]].type;if(2==i[e].type)for(let t=0;t<l;++t){const i=b[e][t];for(let t=0;t<a;++t)x[t]=o.getUint16(i+2*t*s,!0);for(let t=0;t<a;++t)o.setFloat32(i+2*t*s,Z(x[t]),!0)}}}(h,f,l,c,u,s);for(let e=0;e<l.length;++e){const i=l[e];if(!i.decoded){if(2!==i.compression)throw new Error("EXRLoader.parse: unsupported channel compression");{let n=0,r=0;for(let o=0;o<t.lines;++o){let t=f[e][n];for(let e=0;e<i.width;++e){for(let e=0;e<2*i.type;++e)s[t++]=d[r+e*i.width*i.height];r++}n++}}}}return new DataView(s.buffer)}function z(t,e){const i=new Uint8Array(t);let s=0;for(;0!=i[e.value+s];)s+=1;const n=(new TextDecoder).decode(i.slice(e.value,e.value+s));return e.value=e.value+s+1,n}function N(t,e){const i=t.getInt32(e.value,!0);return e.value=e.value+4,i}function V(t,e){const i=t.getUint32(e.value,!0);return e.value=e.value+4,i}function B(t,e){const i=t[e.value];return e.value=e.value+1,i}function $(t,e){const i=t.getUint8(e.value);return e.value=e.value+1,i}const X=function(t,e){let i;return i="getBigInt64"in DataView.prototype?Number(t.getBigInt64(e.value,!0)):t.getUint32(e.value+4,!0)+Number(t.getUint32(e.value,!0)<<32),e.value+=8,i};function j(t,e){const i=t.getFloat32(e.value,!0);return e.value+=4,i}function G(t,i){return e.DataUtils.toHalfFloat(j(t,i))}function Z(t){const e=(31744&t)>>10,i=1023&t;return(t>>15?-1:1)*(e?31===e?i?NaN:1/0:Math.pow(2,e-15)*(1+i/1024):i/1024*6103515625e-14)}function q(t,e){const i=t.getUint16(e.value,!0);return e.value+=2,i}function W(t,e){return Z(q(t,e))}function H(t,e,i,s,n){return"string"===s||"stringvector"===s||"iccProfile"===s?function(t,e,i){const s=(new TextDecoder).decode(new Uint8Array(t).slice(e.value,e.value+i));return e.value=e.value+i,s}(e,i,n):"chlist"===s?function(t,e,i,s){const n=i.value,r=[];for(;i.value<n+s-1;){const s=z(e,i),n=N(t,i),o=$(t,i);i.value+=3;const a=N(t,i),l=N(t,i);r.push({name:s,pixelType:n,pLinear:o,xSampling:a,ySampling:l})}return i.value+=1,r}(t,e,i,n):"chromaticities"===s?function(t,e){return{redX:j(t,e),redY:j(t,e),greenX:j(t,e),greenY:j(t,e),blueX:j(t,e),blueY:j(t,e),whiteX:j(t,e),whiteY:j(t,e)}}(t,i):"compression"===s?function(t,e){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][$(t,e)]}(t,i):"box2i"===s?function(t,e){return{xMin:V(t,e),yMin:V(t,e),xMax:V(t,e),yMax:V(t,e)}}(t,i):"lineOrder"===s?function(t,e){return["INCREASING_Y"][$(t,e)]}(t,i):"float"===s?j(t,i):"v2f"===s?function(t,e){return[j(t,e),j(t,e)]}(t,i):"v3f"===s?function(t,e){return[j(t,e),j(t,e),j(t,e)]}(t,i):"int"===s?N(t,i):"rational"===s?function(t,e){return[N(t,e),V(t,e)]}(t,i):"timecode"===s?function(t,e){return[V(t,e),V(t,e)]}(t,i):"preview"===s?(i.value+=n,"skipped"):void(i.value+=n)}const Y=new DataView(t),K=new Uint8Array(t),J={value:0},tt=function(t,e,i){const s={};if(20000630!=t.getUint32(0,!0))throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");s.version=t.getUint8(4);const n=t.getUint8(5);s.spec={singleTile:!!(2&n),longName:!!(4&n),deepFormat:!!(8&n),multiPart:!!(16&n)},i.value=8;let r=!0;for(;r;){const n=z(e,i);if(0==n)r=!1;else{const r=z(e,i),o=H(t,e,i,r,V(t,i));void 0===o?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${r}'.`):s[n]=o}}if(0!=(-5&n))throw console.error("EXRHeader:",s),new Error("THREE.EXRLoader: provided file is currently unsupported.");return s}(Y,t,J),et=function(t,i,s,n,r){const o={size:0,viewer:i,array:s,offset:n,width:t.dataWindow.xMax-t.dataWindow.xMin+1,height:t.dataWindow.yMax-t.dataWindow.yMin+1,channels:t.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:t.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:e.LinearSRGBColorSpace};switch(t.compression){case"NO_COMPRESSION":o.lines=1,o.uncompress=Q;break;case"RLE_COMPRESSION":o.lines=1,o.uncompress=L;break;case"ZIPS_COMPRESSION":o.lines=1,o.uncompress=F;break;case"ZIP_COMPRESSION":o.lines=16,o.uncompress=F;break;case"PIZ_COMPRESSION":o.lines=32,o.uncompress=I;break;case"PXR24_COMPRESSION":o.lines=16,o.uncompress=D;break;case"DWAA_COMPRESSION":o.lines=32,o.uncompress=U;break;case"DWAB_COMPRESSION":o.lines=256,o.uncompress=U;break;default:throw new Error("EXRLoader.parse: "+t.compression+" is unsupported")}if(o.scanlineBlockSize=o.lines,1==o.type)switch(r){case e.FloatType:o.getter=W,o.inputSize=2;break;case e.HalfFloatType:o.getter=q,o.inputSize=2}else{if(2!=o.type)throw new Error("EXRLoader.parse: unsupported pixelType "+o.type+" for "+t.compression+".");switch(r){case e.FloatType:o.getter=j,o.inputSize=4;break;case e.HalfFloatType:o.getter=G,o.inputSize=4}}o.blockCount=(t.dataWindow.yMax+1)/o.scanlineBlockSize;for(let t=0;t<o.blockCount;t++)X(i,n);o.outputChannels=3==o.channels?4:o.channels;const a=o.width*o.height*o.outputChannels;switch(r){case e.FloatType:o.byteArray=new Float32Array(a),o.channels<o.outputChannels&&o.byteArray.fill(1,0,a);break;case e.HalfFloatType:o.byteArray=new Uint16Array(a),o.channels<o.outputChannels&&o.byteArray.fill(15360,0,a);break;default:console.error("THREE.EXRLoader: unsupported type: ",r)}return o.bytesPerLine=o.width*o.inputSize*o.channels,4==o.outputChannels?(o.format=e.RGBAFormat,o.colorSpace=e.LinearSRGBColorSpace):(o.format=e.RedFormat,o.colorSpace=e.NoColorSpace),o}(tt,Y,K,J,this.type),it={value:0},st={R:0,G:1,B:2,A:3,Y:0};for(let t=0;t<et.height/et.scanlineBlockSize;t++){const e=V(Y,J);et.size=V(Y,J),et.lines=e+et.scanlineBlockSize>et.height?et.height-e:et.scanlineBlockSize;const i=et.size<et.lines*et.bytesPerLine?et.uncompress(et):Q(et);J.value+=et.size;for(let e=0;e<et.scanlineBlockSize;e++){const s=e+t*et.scanlineBlockSize;if(s>=et.height)break;for(let t=0;t<et.channels;t++){const n=st[tt.channels[t].name];for(let r=0;r<et.width;r++){it.value=(e*(et.channels*et.width)+t*et.width+r)*et.inputSize;const o=(et.height-1-s)*(et.width*et.outputChannels)+r*et.outputChannels+n;et.byteArray[o]=et.getter(i,it)}}}}return{header:tt,width:et.width,height:et.height,data:et.byteArray,format:et.format,colorSpace:et.colorSpace,type:this.type}}setDataType(t){return this.type=t,this}load(t,i,s,n){return super.load(t,(function(t,s){t.colorSpace=s.colorSpace,t.minFilter=e.LinearFilter,t.magFilter=e.LinearFilter,t.generateMipmaps=!1,t.flipY=!1,i&&i(t,s)}),s,n)}}class wi{constructor(t){this.callback_obj={},this.lzma_worker=new Worker(t||"./lzma_worker-min.js"),this.lzma_worker.onmessage=function(t){3===t.data.action?this.callback_obj[t.data.cbn]&&"function"==typeof this.callback_obj[t.data.cbn].on_progress&&this.callback_obj[t.data.cbn].on_progress(t.data.result):this.callback_obj[t.data.cbn]&&"function"==typeof this.callback_obj[t.data.cbn].on_finish&&(this.callback_obj[t.data.cbn].on_finish(t.data.result,t.data.error),delete this.callback_obj[t.data.cbn])}.bind(this),this.lzma_worker.onerror=function(t){var e=new Error(t.message+" ("+t.filename+":"+t.lineno+")");for(var i in this.callback_obj)this.callback_obj[i].on_finish(null,e);console.error("Uncaught error in lzma_worker",e)}.bind(this)}send_to_worker(t,e,i,s,n){var r;do{r=Math.floor(1e7*Math.random())}while(void 0!==this.callback_obj[r]);this.callback_obj[r]={on_finish:s,on_progress:n},this.lzma_worker.postMessage({action:t,cbn:r,data:e,mode:i})}compress(t,e,i,s){this.send_to_worker(1,t,e,i,s)}decompress(t,e,i){this.send_to_worker(2,t,!1,e,i)}worker(){return this.lzma_worker}}let Si=!0,ki=!1,Ai=null;const Ti=new Map,Mi={renderMode:{value:0},fogMode:{value:1},depthPacking:{value:1},time:{value:0},shadow:{value:.5},shadowGamma:{value:.25},shadowLuma:{value:0},shadowContrast:{value:1},lightSizeUV:{value:3},nearPlane:{value:9.5},rings:{value:11},nSample:{value:17},noiseIntensity:{value:1},softness:{value:1.6},noiseMap:{value:null},useNoiseMap:{value:0}};class Pi{get renderer(){return Ai}set renderer(t){Ai=t}static setGl2(t){Si=t}static getGl2(t){return Si}static setting(){return Mi}static getRandomUv(){return Ei}static addParsFragment(t,e){t.fragmentShader=t.fragmentShader.replace("#include <clipping_planes_pars_fragment>","#include <clipping_planes_pars_fragment>"+e)}static init(t={}){let i;e.ShaderChunk.tonemapping_pars_fragment=e.ShaderChunk.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }","#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\n            float toneMappingWhitePoint = 1.0;\n            vec3 CustomToneMapping( vec3 color ) {\n                color *= toneMappingExposure;\n                return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n            }"),this.up(t),i=e.ShaderChunk.shadowmap_pars_fragment,i=i.replace("#ifdef USE_SHADOWMAP",Ri),i=i.replace("shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );","\n                return PCSS( shadowMap, shadowCoord );\n            "),e.ShaderChunk.shadowmap_pars_fragment=i,i=e.ShaderChunk.common,i=i.replace("#define EPSILON 1e-6","\n        \t#define EPSILON 1e-6\n        \tuniform float shadow;\n            uniform float shadowLuma;\n            uniform float shadowContrast;\n            uniform float shadowGamma;\n\n            uniform int renderMode;\n            uniform int fogMode;\n            uniform int depthPacking;\n\n            varying vec2 vZW;\n            varying vec3 rayDir;\n            varying vec3 rayDir2;\n            varying vec3 rayOri;\n            //varying float fDist;\n\n            float shadowValue = 1.0;\n            float shadowTmp = 1.0;\n            vec3 shadowColor = vec3(1.0);\n            \n            float color_distance( vec3 a, vec3 b){\n                vec3 s = vec3( a - b );\n                float dist = sqrt( s.r * s.r + s.g * s.g + s.b * s.b );\n                return clamp(dist, 0.0, 1.0);\n            }\n\n            vec3 adjustContrast(vec3 color, float value) {\n                const vec3 zero = vec3(0.);\n                return max(zero, 0.5 + value * (color - 0.5));\n            }\n\n            vec3 hsv2rgb(vec3 c){\n                vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n                vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n                return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n            }\n\n            vec3 rgb2hsv(vec3 rgb) {\n                float Cmax = max(rgb.r, max(rgb.g, rgb.b));\n                float Cmin = min(rgb.r, min(rgb.g, rgb.b));\n                float delta = Cmax - Cmin;\n                vec3 hsv = vec3(0., 0., Cmax);\n                if (Cmax > Cmin) {\n                    hsv.y = delta / Cmax;\n                    if (rgb.r == Cmax) hsv.x = (rgb.g - rgb.b) / delta;\n                    else {\n                        if (rgb.g == Cmax) hsv.x = 2. + (rgb.b - rgb.r) / delta;\n                        else hsv.x = 4. + (rgb.r - rgb.g) / delta;\n                    }\n                    hsv.x = fract(hsv.x / 6.);\n                }\n                return hsv;\n            }\n\n            /*\n            vec3 rgb2hsv(vec3 c){\n                vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n                vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n                vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n                float d = q.x - min(q.w, q.y);\n                float e = 1.0e-10;\n                return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n            }\n\n            vec3 brightnessContrastCorrection(vec3 value, float brightness, float contrast){\n                return (value - 0.5) * contrast + 0.5 + brightness;\n            }\n\n            vec3 GammaCorrection(vec3 value, float param){\n                return vec3(pow(abs(value.r), param),pow(abs(value.g), param),pow(abs(value.b), param));\n            }\n            */\n            \n\n        "),e.ShaderChunk.common=i,e.ShaderChunk.clipping_planes_vertex="\n            #if NUM_CLIPPING_PLANES > 0\n                vClipPosition = - mvPosition.xyz;\n            #endif\n            vZW = gl_Position.zw;\n        ",i=e.ShaderChunk.lights_fragment_begin,i=i.replace("directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;","\n            shadowTmp = 1.0;\n            shadowTmp *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;;\n            //directLight.color *= shadowTmp;\n            shadowValue *= shadowTmp;\n        "),i=i.replace("directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;","\n            shadowTmp = 1.0;\n            shadowTmp *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n            //directLight.color *= shadowTmp;\n            shadowValue *= shadowTmp;\n        "),i=i.replace("directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","\n            shadowTmp = 1.0;\n            shadowTmp *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n            //directLight.color *= shadowTmp;\n            shadowValue *= shadowTmp;\n        "),e.ShaderChunk.lights_fragment_begin=i,e.ShaderChunk.fog_vertex=Ci,e.ShaderChunk.fog_fragment=_i,i=e.ShaderChunk.opaque_fragment,i=i.replace("gl_FragColor = vec4( outgoingLight, diffuseColor.a );","\n\n            gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n        \t#if defined( USE_SHADOWMAP )\n\n            shadowValue = (shadowValue - 0.5) * shadowContrast + 0.5 + shadowLuma;\n            shadowValue = pow(abs(shadowValue), shadowGamma );\n            shadowValue = clamp( shadowValue, 0.0, 1.0 );\n\n            shadowColor = vec3( shadowValue );\n\n            ///shadowColor = vec3( 0.0,0.0,1.0-shadowValue );\n\n            //vec3 sColor = vec3( 0.1, 0.1, 0.8 );\n            //shadowColor.b += 1.0-shadowValue ;\n\n\n\n            // TODO find better shadow variation\n\n            vec3 invert = vec3( 1.0 - gl_FragColor.rgb );\n            vec3 dd = vec3(0.38,0.42,0.63);\n            float gray = ((gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0);\n            vec3 invColor = gray * dd;\n            invColor = invColor * mix( invColor, invert, 1.0-gray*0.5 );\n\n\n\n\n                    \n\n\n            //gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * shadowColor, (1.0-shadowValue) * shadow );\n\n            //gl_FragColor.rgb *= ((1.0-shadowValue) * (1.0-shadow)) + shadowColor;\n\n            //gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * invColor, (1.0-shadowValue) * shadow );\n\n            gl_FragColor.rgb = mix( gl_FragColor.rgb, invColor, (1.0-shadowValue) * shadow );\n\n            //gl_FragColor.rgb = invColor;\n\n            //gl_FragColor.rgb = gl_FragColor.rgb * shadowColor;\n\n            //gl_FragColor.rgb *= ((1.0-shadowValue) * shadow) * invColor;\n\n\n        \t#endif\n            \n        "),e.ShaderChunk.opaque_fragment=i,i=e.ShaderChunk.dithering_fragment,i=i.replace("#endif","\n\n            #endif\n\n            #ifdef STANDARD\n\n            if( renderMode == 1 ){ \n                float fz = 0.5 * vZW[0] / vZW[1] + 0.5;\n                gl_FragColor = depthPacking == 1 ? packDepthToRGBA( fz ) : vec4( vec3( 1.0 - fz ), opacity );// depth render\n            }\n            if( renderMode == 2 ) gl_FragColor = vec4(  packNormalToRGB( normal ), opacity );// normal render\n            if( renderMode == 3 ) gl_FragColor = vec4(  shadowColor, opacity );// normal render\n\n            #else\n\n            if( renderMode != 0 ) discard;\n\n            #endif\n\n        "),e.ShaderChunk.dithering_fragment=i,i=e.ShaderChunk.color_vertex,i=i.replace("vColor.xyz *= instanceColor.xyz;","vColor.xyz = instanceColor.xyz;"),e.ShaderChunk.color_vertex=i,ki=!0}static add(t,i=null){if(!ki)return;if(!t)return;let s=t.name;Ti.has(s)?console.log("already add",s):(Ti.set(s,!0),null===t.shadowSide&&(t.shadowSide=e.DoubleSide),t.onBeforeCompile=function(t){Pi.modify(t),i&&i(t)})}static refresh(){}static setDefines(t){}static modify(t){if(ki)for(let e in Mi)t.uniforms[e]=Mi[e]}static up(t){for(let e in t)Mi[e]&&(Mi[e].value.isColor?Mi[e].value.setHex(t[e]):Mi[e].value=t[e])}static reset(){Ti.clear()}}const Ci="\n#ifdef USE_FOG\n\n    vFogDepth = - mvPosition.z;\n\n    rayDir2 = normalize( worldPosition.xyz - cameraPosition );\n    rayDir = normalize( mvPosition.xyz );\n    rayOri = cameraPosition.xyz;\n\n    //rayOri = worldPosition.xyz; //( cameraPosition-worldPosition.xyz  );\n    //vec3 tt = vec3(cameraPosition-mvPosition);\n    //float fDist = sqrt(tt.x*tt.x+tt.y*tt.y+tt.z*tt.z);\n    //fDist = distance(cameraPosition.xyz, mvPosition.xyz);\n\n#endif\n",_i="\n#ifdef USE_FOG\n\n    #ifdef FOG_EXP2\n\n        float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\n    #else\n\n        float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n        float fogDensity = 0.01;\n\n    #endif\n\n    \n\n    /*vec4 CCF = vec4(fogColor, 1.0);\n    #if defined( TONE_MAPPING )\n        CCF.rgb = toneMapping( CCF.rgb );\n        //CCF = linearToOutputTexel( CCF );\n    #endif*/\n\n    if( fogMode == 0 ){\n\n        gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n    } \n\n    if( fogMode == 1 ){\n\n        vec3 fcolor = fogColor;\n\n        #if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n            float aa = fogDensity * fogDensity * 1.0;\n            float bb = fogDensity * fogDensity * 12.0;\n            //bb = pow(bb, 0.8);\n            float distance = vFogDepth * vFogDepth;\n\n            fogFactor = 1.0 - exp( -distance*bb );\n            fogFactor = (aa/bb) * exp(-rayOri.y*bb) * (1.0-exp( -distance*rayDir2.y*bb ))/rayDir2.y;\n            fogFactor = clamp( fogFactor, 0.0, 1.0 );\n\n            vec3 sunDir = normalize( directionalLights[ 0 ].direction );\n            vec3 sunColor = directionalLights[ 0 ].color;\n            // sunColor = vec3(1,0,0);\n            float sunAmount = max( dot( rayDir, sunDir ), 0.0 );\n            //float sunAdd = clamp( pow(sunAmount, 60.0), 0.0, 1.0 );\n            float sunAdd = pow(sunAmount, 16.0);\n            fcolor = mix( fogColor, sunColor, sunAdd ); // 8.0\n\n        #endif\n\n        gl_FragColor.rgb = gl_FragColor.rgb * (1.0-fogFactor) + fcolor * fogFactor;\n\n    }\n\n#endif\n",Ri="\n#ifdef USE_SHADOWMAP\n\nuniform float lightSizeUV;\nuniform float nearPlane;\nuniform float rings;\nuniform int nSample;\nuniform float noiseIntensity;\nuniform float softness;\n\n//#define LIGHT_WORLD_SIZE 0.005\n//#define LIGHT_FRUSTUM_WIDTH 3.75\n//#define LIGHT_SIZE_UV (LIGHT_WORLD_SIZE / LIGHT_FRUSTUM_WIDTH)\n//#define NEAR_PLANE 9.5\n\n#define SAMPLE 16\n#define RINGS 4\n\nvec2 poissonDisk[32];\n\nvoid initPoissonSamples( const in vec2 randomSeed ) {\n\n    float ANGLE_STEP = PI2 * float(RINGS) / float( SAMPLE );\n    float INV_NUM_SAMPLES = 1.0 / float( SAMPLE );\n\n    // jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/\n    float angle = rand( randomSeed ) * PI2;\n    float radius = INV_NUM_SAMPLES;\n    float radiusStep = radius;\n\n    for( int i = 0; i < SAMPLE; i ++ ) {\n        poissonDisk[i] = vec2( cos( angle ), sin( angle ) ) * pow( radius, 0.75 );\n        radius += radiusStep;\n        angle += ANGLE_STEP;\n    }\n}\n\nfloat penumbraSize( const in float zReceiver, const in float zBlocker ) { // Parallel plane estimation\n    return (zReceiver - zBlocker) / zBlocker;\n}\n\nfloat findBlocker( sampler2D shadowMap, const in vec2 uv, const in float zReceiver, float ls ) {\n\n    // This uses similar triangles to compute what\n    // area of the shadow map we should search\n    float searchRadius = ls * ( zReceiver - nearPlane ) / zReceiver;\n    float blockerDepthSum = 0.0;\n    int numBlockers = 0;\n    float shadowMapDepth = 0.0;\n\n    for( int i = 0; i < SAMPLE; i++ ) {\n        shadowMapDepth = unpackRGBAToDepth(texture2D(shadowMap, uv + poissonDisk[i] * searchRadius));\n        if ( shadowMapDepth < zReceiver ) {\n            blockerDepthSum += shadowMapDepth;\n            numBlockers ++;\n        }\n    }\n\n    if( numBlockers == 0 ) return -1.0;\n\n    return blockerDepthSum / float( numBlockers );\n\n}\n\nfloat PCF_Filter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius ) {\n    \n    /*\n    int numSample = SAMPLE;\n    float sum = 0.0;\n    float depth;\n    #pragma unroll_loop_start\n    for( int i = 0; i < SAMPLE; i ++ ) {\n        depth = unpackRGBAToDepth( texture2D( shadowMap, uv + poissonDisk[ i ] * filterRadius ) );\n        if( zReceiver <= depth ) sum += 1.0;\n    }\n    #pragma unroll_loop_end\n    #pragma unroll_loop_start\n    for( int i = 0; i < SAMPLE; i ++ ) {\n        depth = unpackRGBAToDepth( texture2D( shadowMap, uv + -poissonDisk[ i ].yx * filterRadius ) );\n        if( zReceiver <= depth ) sum += 1.0;\n    }\n    #pragma unroll_loop_end\n    return sum / ( 2.0 * float( nSample ) );\n    */\n\n    \n    float sum = 0.0;\n    float top = 0.0;\n    float low = 0.0;\n    #pragma unroll_loop_start\n    for( int i = 0; i < 16; i ++ ) {\n        top = unpackRGBAToDepth( texture2D( shadowMap, uv + poissonDisk[ i ] * filterRadius ) );\n        low = unpackRGBAToDepth( texture2D( shadowMap, uv + -poissonDisk[ i ].yx * filterRadius ) );\n        if( zReceiver <= top ) sum += 1.0;\n        if( zReceiver <= low ) sum += 1.0;\n    }\n    #pragma unroll_loop_end\n    return sum / ( 2.0 * float( SAMPLE ) );\n}\n\nfloat PCSS ( sampler2D shadowMap, vec4 coords ) {\n\n    vec2 uv = coords.xy;\n    float zReceiver = coords.z; // Assumed to be eye-space z in this code\n    //float lightSizeUV = LIGHT_WORLD_SIZE / LIGHT_FRUSTUM_WIDTH;\n\n    float ls = lightSizeUV * 0.001;\n\n    initPoissonSamples( uv );\n    // STEP 1: blocker search\n    float avgBlockerDepth = findBlocker( shadowMap, uv, zReceiver, ls );\n\n    //There are no occluders so early out (this saves filtering)\n    if( avgBlockerDepth == -1.0 ) return 1.0;\n\n    // STEP 2: penumbra size\n    float penumbraRatio = penumbraSize( zReceiver, avgBlockerDepth );\n    float filterRadius = penumbraRatio * ls * nearPlane / zReceiver;\n\n    // STEP 3: filtering\n    //return avgBlockerDepth;\n    return PCF_Filter( shadowMap, uv, zReceiver, filterRadius * softness );\n}\n",Ei="\n\nuniform sampler2D noiseMap;\nuniform float useNoiseMap;\n\nfloat directNoise(vec2 p){\n    vec2 ip = floor(p);\n    vec2 u = fract(p);\n    u = u*u*(3.0-2.0*u);\n    \n    float res = mix(\n        mix(rand(ip),rand(ip+vec2(1.0,0.0)),u.x),\n        mix(rand(ip+vec2(0.0,1.0)),rand(ip+vec2(1.0,1.0)),u.x),u.y);\n    return res*res;\n}\n\nfloat sum( vec4 v ) { return v.x+v.y+v.z; }\n\nvec4 textureNoTile( sampler2D mapper, in vec2 uv ){\n\n    // sample variation pattern\n    float k = 0.0;\n    if( useNoiseMap == 1.0 ) k = texture2D( noiseMap, 0.005*uv ).x;\n    else k = directNoise( uv );\n    \n    // compute index    \n    float index = k*8.0;\n    float f = fract( index );\n\n    float ia = floor( index );\n    float ib = ia + 1.0;\n    // or\n    //float ia = floor(index+0.5); // suslik's method (see comments)\n    //float ib = floor(index);\n    //f = min(f, 1.0-f)*2.0;\n\n    // offsets for the different virtual patterns    \n    vec2 offa = sin(vec2(3.0,7.0)*ia); // can replace with any other hash    \n    vec2 offb = sin(vec2(3.0,7.0)*ib); // can replace with any other hash    \n\n    // compute derivatives for mip-mapping    \n    vec2 dx = dFdx(uv);\n    vec2 dy = dFdy(uv);\n    \n    // sample the two closest virtual patterns    \n    vec4 cola = textureGrad( mapper, uv + offa, dx, dy );\n    vec4 colb = textureGrad( mapper, uv + offb, dx, dy );\n\n    // interpolate between the two virtual patterns    \n    return mix( cola, colb, smoothstep(0.2,0.8,f-0.1*sum(cola-colb)) );\n\n}\n",Qi={getMesh:(t,e)=>{let i={};return t.traverse((t=>{t.isMesh&&(i[t.name]=t)})),i},keepMaterial:t=>{let e,i={};t.traverse((t=>{t.isMesh&&(e=t.material,i[e.name]||(Pi.add(e),i[e.name]=!0))}))},getGroup:(t,e,i)=>{const s={};let n=null;return i&&(n=Qi.getMaterial(t,!0)),t.traverse((t=>{t.isGroup&&(s[t.name]=e?Qi.groupToMesh(t,n):t)})),s},getMaterial:(t,e)=>{const i={},s=[];let n,r;return t.traverse((t=>{t.isMesh&&(n=t.material,i[n.name]||(Pi.add(n),i[n.name]=n,r=Number(n.name.substring(0,n.name.lastIndexOf("_"))),s[r]=n))})),e?s:i},groupToMesh:(t,e)=>{if(t.children[0].name!==t.name+"_1")return t;if(!t.children[0].isMesh)return t;let i,s=[],n=t.children.length,r=0;for(let e=0;e<n;e++)i=t.children[e].material.name,r=Number(i.substring(0,i.lastIndexOf("_"))),t.children[e].material.dispose(),s[e]=t.children[e].geometry,s[e].forceMatId=r;let o=new THREE.Mesh(new yt(s,!0),e);return o.name=t.name,o},symetric:t=>{t.isMesh&&(t=t.geometry);let e=t.attributes.uv.array,i=.5*e.length;for(;i--;)e[2*i]<0&&(e[2*i]*=-1);t.attributes.uv.needsUpdate=!0},uv2:t=>{t.isMesh&&(t=t.geometry),t.setAttribute("uv2",t.attributes.uv)},autoMorph:(t,i,s=!0,n=!1)=>{let r,o,a,l,h,c,u,d,p,f,m,g={},v=[];t.traverse((t=>{t.isMesh&&-1!==t.name.search("__M__")&&(g[t.name]=t.geometry,v.push(t))}));for(let t in g)if(r=t.substring(0,t.indexOf("__")),o=t.substring(t.lastIndexOf("__")+2),a=i[r],a)if(h=a.geometry,c=g[t],h.morphTargetsRelative=n,h.attributes.position.count===c.attributes.position.count){if(h.morphAttributes.position||(h.morphAttributes.position=[],s&&(h.morphAttributes.normal=[]),a.morphTargetInfluences=[],a.morphTargetDictionary={}),l=h.morphAttributes.position.length,n){for(u=c.attributes.position.array.length,f=[];u--;)f[u]=c.attributes.position.array[u]-h.attributes.position.array[u];d=new e.Float32BufferAttribute(f,3)}else d=new e.Float32BufferAttribute(c.attributes.position.array,3);h.morphAttributes.position.push(d),s&&(p=new e.Float32BufferAttribute(c.attributes.normal.array,3),h.morphAttributes.normal.push(p)),a.morphTargetInfluences.push(0),a.morphTargetDictionary[o]=l}else console.warn("Morph "+o+" target is no good on "+a.name);for(g={},u=v.length;u--;)m=v[u],m.parent&&m.parent.remove(m),m.material&&m.material.dispose(),m.geometry&&m.geometry.dispose()}},Li={msg:"",inLoad:!1,clip:[],data:new Map,tmp:[],dracoLoader:null,dracoLoaderType:"js",dracoPath:"./src/libs/draco/",maxAnisotropy:1,onLoad:()=>{},onEnd:()=>{},log:t=>{},materialRoot:t=>{console.log(t)},setLoadEvent:(t,e)=>{Li.onLoad=t,Li.onEnd=e},prefix:t=>{let e="";switch(t){case"S":case"sound":case"mp3":case"wav":case"ogg":e="S_";break;case"I":case"image":case"jpg":case"png":e="I_";break;case"E":case"hdr":case"env":case"T":case"texture":e="T_";break;case"J":case"json":e="J_";break;case"JS":case"js":e="JS_";break;case"O":case"object3d":e="O_";break;case"M":case"material":e="M_"}return e},dispose:()=>{Li.data.forEach((function(t,e){(t.isMaterial||t.isTexture)&&(t.dispose(),Li.data.delete(e)),t.isObject3D&&(t.traverse((function(t){t.isMesh&&(t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose())})),Li.data.delete(e))}))},createElementNS:t=>document.createElementNS("http://www.w3.org/1999/xhtml",t),exist:(t,e="")=>!!Li.get(t,e),delete:(t,e="")=>Li.data.delete(Li.prefix(e)+t),get:(t,e="")=>Li.data.get(Li.prefix(e)+t),set:(t,e,i="",s)=>{e.isMaterial&&(i="material",e.name=t,Li.materialRoot(e,s)),e.isTexture&&(i="texture"),e.isObject3D&&(i="object3d"),Li.get(t,i)||Li.data.set(Li.prefix(i)+t,e)},getScript:t=>Li.data.get(Li.prefix("js")+t),getMaterials:(t,e)=>("string"==typeof t&&(t=Li.get(t,"O")),Qi.getMaterial(t,e)),getMesh:(t,e)=>("string"==typeof t&&(t=Li.get(t,"O")),Qi.getMesh(t,e)),getGroup:(t,e,i)=>("string"==typeof t&&(t=Li.get(t,"O")),Qi.getGroup(t,e,i)),applyMorph(t,e=null,i=!0,s=!0){let n;n=t.isObject3D?t:Li.get(t,"O"),e||(e=Li.getMesh(t)),n&&e&&Qi.autoMorph(n,e,i,s)},uv2(t){Qi.uv2(t)},add:(t,e,i)=>{Li.set(t,e,i),Li.next()},getMaterial:t=>Li.data.get("M_"+t),texture:(t={})=>{Li.loaderMap||(Li.loaderMap=new e.TextureLoader);let i=t.name||"";return t.url&&(i=-1!==t.url.lastIndexOf(".")?t.url.substring(t.url.lastIndexOf("/")+1,t.url.lastIndexOf(".")):t.url.substring(t.url.lastIndexOf("/")+1)),-1===i.search("_c")&&-1===i.search("_l")&&-1===i.search("_u")&&-1===i.search("_d")||(t.srgb=!0),Li.exist(i,"texture")?Li.get(i,"texture"):Li.exist(i,"image")?Li.getTexture(i,t):Li.loaderMap.load(t.url,(function(e){return Li.setTextureOption(e,t),Li.data.set("T_"+i,e),t.callback&&t.callback(),e}))},getTexture:(t,i={})=>{let s=Li.get(t,"texture");if(!s){let n=Li.get(t,"image");if(!n)return console.log("not find image",t),null;s=new e.Texture(n),-1===t.search("_c")&&-1===t.search("_d")&&-1===t.search("_l")&&-1===t.search("_u")||(i.srgb=!0),Li.data.set("T_"+t,s)}return Li.setTextureOption(s,i),s},setTextureOption:(t,i={})=>{i.encoding&&(t.colorSpace=e.SRGBColorSpace),i.srgb&&(t.colorSpace=e.SRGBColorSpace),t.flipY=void 0!==(i.flipY||i.flip)&&i.flipY,t.anisotropy=void 0!==i.anisotropy?i.anisotropy:Li.maxAnisotropy,void 0!==i.generateMipmaps&&(t.generateMipmaps=i.generateMipmaps),i.repeat&&(t.repeat.fromArray(i.repeat),t.wrapS=t.wrapT=e.RepeatWrapping),i.center&&t.center.fromArray(i.center),i.offset&&t.offset.fromArray(i.offset),i.filter&&"near"===i.filter&&(t.minFilter=e.NearestFilter,t.magFilter=e.NearestFilter),i.channel&&(t.channel=i.channel),t.needsUpdate=!0},load:(t,e,i="",s="")=>{Li.msg=s;let n=[],r=e||function(){},o=("undefined"==typeof performance?Date:performance).now();"string"==typeof t||t instanceof String?n.push(t):n=n.concat(t),Li.tmp.push({urls:n,path:i,callback:r,start:o}),Li.inLoad||Li.loadOne()},loadOne:()=>{Li.inLoad=!0,Li.onLoad();let t=Li.tmp[0].path+Li.tmp[0].urls[0],e=t.substring(t.lastIndexOf("/")+1,t.lastIndexOf(".")),i=t.substring(t.lastIndexOf(".")+1).toLowerCase();Li.exist(e,i)?Li.next():Li.loading(t,e,i)},next:()=>{Li.tmp[0].urls.shift(),0===Li.tmp[0].urls.length?(Math.floor(("undefined"==typeof performance?Date:performance).now()-Li.tmp[0].start),Li.tmp[0].callback(),Li.tmp.shift(),Li.tmp.length>0?Li.loadOne():(Li.inLoad=!1,Li.onEnd())):Li.loadOne()},loading:(t,e,i)=>{switch(Li.log(Li.msg),i){case"glb":case"gltf":Li.load_GLTF(t,e);break;case"fbx":case"FBX":Li.load_FBX(t,e);break;case"hdr":Li.load_RGBE(t,e);break;case"exr":Li.load_EXR(t,e);break;default:Li.extand(t,e,i)}},extand:(t,e,i)=>{Li.XHTTP||(Li.XHTTP=new XMLHttpRequest);const s=Li.XHTTP;switch(s.open("GET",t,!0),"json"===i&&s.overrideMimeType("application/json"),i){case"hex":case"wasm":case"mp3":case"wav":case"ogg":s.responseType="arraybuffer";break;case"jpg":case"png":s.responseType="blob";break;case"bvh":case"glsl":case"js":case"json":s.responseType="text"}s.onreadystatechange=function(){4===s.readyState&&(s.status>=300?console.log("Error, status code = "+s.status):Li.direct(s.response,e,i))},"onprogress"in s&&(s.onprogress=function(t){}),s.send(null)},direct:(t,e,i)=>{switch(i){case"jpg":case"png":let s=Li.createElementNS("img");s.onload=function(t){window.URL.revokeObjectURL(s.src),Li.add(e,s,"image")},s.src=window.URL.createObjectURL(t);break;case"mp3":case"wav":case"ogg":AudioContext.getContext().decodeAudioData(t.slice(0),(function(t){Li.add(e,t,"sound")}),(function(t){console.error("decodeAudioData error",t)}));break;case"hex":LzmaUnpack.parse(t,(function(t){Li.add(e,t,i)}));break;case"wasm":Li.add(e,new Uint8Array(t),i);break;case"json":Li.add(e,JSON.parse(t),i);break;default:Li.add(e,t,i)}},loaderDRACO:()=>{if(Li.dracoLoader)return Li.dracoLoader;if(!Li.dracoLoaderType)if(navigator.userAgentData)Li.dracoLoaderType="wasm";else{let t=navigator.userAgent.toLowerCase();Li.dracoLoaderType=-1!==t.indexOf("safari")&&-1===t.indexOf("chrome")?"js":"wasm"}return Li.dracoLoader=(new ye).setDecoderPath(Li.dracoPath),Li.dracoLoader.setDecoderConfig({type:Li.dracoLoaderType}),Li.dracoLoader},loaderGLTF:()=>(Li.GLTF||(Li.GLTF=new wt,Li.GLTF.setDRACOLoader(Li.loaderDRACO())),Li.GLTF),loaderFBX:()=>(Li.FBX||(Li.FBX=new ei),Li.FBX),loaderRGBE:()=>(Li.RGBE||(Li.RGBE=new xi),Li.RGBE),loaderEXR:()=>(Li.EXR||(Li.EXR=new Oi),Li.EXR),load_GLTF:(t,i)=>{Li.loaderGLTF().load(t,(function(t){const s=t.scene;if(t.animations){const i=t.animations,n=new e.AnimationMixer(t.scene);s.mixer=n,s.actions={};for(let t=0;t<i.length;t++){let e=i[t];s.actions[e.name]=n.clipAction(e)}s.play=t=>{s.actions[t]&&(s.actions[t].paused=!1,s.actions[t].time=0,s.actions[t].play())},s.pause=(t,e=!0)=>{s.actions[t]&&(s.actions[t].paused=e)}}Li.add(i,s)}))},load_FBX:(t,e)=>{Li.loaderFBX().load(t,(function(t){Li.add(e,t)}))},load_RGBE:(t,i)=>{Li.loaderRGBE().load(t,(function(t){t.mapping=e.EquirectangularReflectionMapping,Li.add(i,t)}))},load_EXR:(t,e,i)=>{Li.loaderEXR().load(t,(function(t){return i&&i(t),t}))},direct_EXR:(t,e)=>{Li.loaderEXR().parse(url,(function(t){return Li.add(e,t),t}))}},Fi=Math.PI,Ii=Fi/180,Di=180/Fi,Ui=Number.EPSILON,zi=.5*Fi,Ni={todeg:Di,torad:Ii,toFixed:(t,e=3)=>1*t.toFixed(e),clamp:(t,e,i)=>t=(t=t<e?e:t)>i?i:t,clampA:(t,e,i)=>Math.max(e,Math.min(i,t)),lerp:(t,e,i)=>(1-i)*t+i*e,damp:(t,e,i,s)=>Ni.lerp(t,e,1-Math.exp(-i*s)),nearAngle:(t,e,i=!1)=>e+Math.atan2(Math.sin(t-e),Math.cos(t-e))*(i?Di:1),unwrapDeg:t=>t-360*Math.floor((t+180)/360),unwrapRad:t=>Math.atan2(Math.sin(t),Math.cos(t)),nearEquals:(t,e,i)=>Math.abs(t-e)<=i,autoSize:(t=[1,1,1],e="box")=>{1===t.length&&(t[1]=t[0]);let i=t[0],s=t[1];return"sphere"===e&&(t=[i,i,i]),"cylinder"!==e&&"wheel"!==e&&"capsule"!==e||(t=[i,s,i]),"cone"!==e&&"pyramid"!==e||(t=[i,s,i]),2===t.length&&(t[2]=t[0]),t},randomSign:()=>Math.random()<.5?-1:1,randSpread:t=>t*(.5-Math.random()),rand:(t=0,e=1)=>t+Math.random()*(e-t),randInt:(t,e)=>t+Math.floor(Math.random()*(e-t+1)),equalArray:(t,e)=>{let i=t.length;for(;i--;)if(t[i]!==e[i])return!1;return!0},composeMatrixArray:(t,e,i=[1,1,1])=>{const s=e[0],n=e[1],r=e[2],o=e[3],a=s+s,l=n+n,h=r+r,c=s*a,u=s*l,d=s*h,p=n*l,f=n*h,m=r*h,g=o*a,v=o*l,y=o*h,b=i[0],x=i[1],O=i[2];return[(1-(p+m))*b,(u+y)*b,(d-v)*b,0,(u-y)*x,(1-(c+m))*x,(f+g)*x,0,(d+v)*O,(f-g)*O,(1-(c+p))*O,0,t[0],t[1],t[2],1]},decomposeMatrixArray:t=>[t[12],t[13],t[14]],applyTransformArray:(t,e,i,s=[1,1,1])=>{const n=Ni.composeMatrixArray(e,i,s),r=t[0],o=t[1],a=t[2],l=1/(n[3]*r+n[7]*o+n[11]*a+n[15]);return[(n[0]*r+n[4]*o+n[8]*a+n[12])*l,(n[1]*r+n[5]*o+n[9]*a+n[13])*l,(n[2]*r+n[6]*o+n[10]*a+n[14])*l]},equalArray:(t,e)=>{let i=t.length;for(;i--;)if(t[i]!==e[i])return!1;return!0},lerpArray:(t,e,i)=>{if(0===i)return t;if(1===i)return e;let s=t.length,n=[];for(;s--;)n[s]=t[s],n[s]+=(e[s]-n[s])*i;return n},slerpQuatArray:(t,e,i)=>{if(0===i)return t;if(1===i)return e;let s=[...t];const n=t[0],r=t[1],o=t[2],a=t[3],l=e[0],h=e[1],c=e[2],u=e[3];let d=a*u+n*l+r*h+o*c;if(d<0?(s=[-l,-h,-c,-u],d=-d):s=[...e],d>=1)return t;const p=1-d*d;if(p<=Ui){const t=1-i;return s[3]=t*a+i*s[3],s[0]=t*n+i*s[0],s[1]=t*r+i*s[1],s[2]=t*o+i*s[2],Ni.quatNomalize(s)}const f=Math.sqrt(p),m=Math.atan2(f,d),g=Math.sin((1-i)*m)/f,v=Math.sin(i*m)/f;return s[3]=a*g+s[3]*v,s[0]=n*g+s[0]*v,s[1]=r*g+s[1]*v,s[2]=o*g+s[2]*v,s},toLocalQuatArray:(t=[0,0,0],e)=>{let i=Ni.quatFromEuler(t),s=Ni.quatInvert(e.quaternion.toArray());return Ni.quatMultiply(s,i)},quatFromEuler:(t=[0,0,0],e=!0)=>{const i=Math.cos,s=Math.sin,n=e?Ii:1,r=t[0]*n*.5,o=t[1]*n*.5,a=t[2]*n*.5,l=i(r),h=i(o),c=i(a),u=s(r),d=s(o),p=s(a);return[u*h*c+l*d*p,l*d*c-u*h*p,l*h*p+u*d*c,l*h*c-u*d*p]},quatFromAxis:(t=[0,0,0],e,i=!0)=>{const s=.5*e*(i?Ii:1),n=Math.sin(s);return[t[0]*n,t[1]*n,t[2]*n,Math.cos(s)]},quatNomalize:t=>{let e=Ni.lengthArray(t);return 0===e?[0,0,0,1]:(e=1/e,Ni.scaleArray(t,e,4))},quatInvert:t=>[-t[0],-t[1],-t[2],t[3]],quatMultiply:(t,e)=>{const i=t[0],s=t[1],n=t[2],r=t[3],o=e[0],a=e[1],l=e[2],h=e[3];return[i*h+r*o+s*l-n*a,s*h+r*a+n*o-i*l,n*h+r*l+i*a-s*o,r*h-i*o-s*a-n*l]},quatToAxis:t=>{let e=2*Math.acos(t[3]);const i=Math.sqrt(1-t[3]*t[3]);return i<1e-4?[1,0,0]:[t[0]/i,t[1]/i,t[2]/i,e]},eulerFromMatrix:t=>{const e=t[0],i=t[4],s=t[8];t[1];const n=t[5],r=t[9];t[2];const o=t[6],a=t[10];let l=[0,0,0];return l[1]=Math.asin(Ni.clamp(s,-1,1)),Math.abs(s)<.9999999?(l[0]=Math.atan2(-r,a),l[2]=Math.atan2(-i,e)):(l[0]=Math.atan2(o,n),l[2]=0),l},angleTo:(t,e)=>2*Math.acos(Math.abs(Ni.clamp(Ni.dotArray(t,e),-1,1))),lengthArray:t=>{let e=t.length,i=0;for(;e--;)i+=t[e]*t[e];return Math.sqrt(i)},dotArray:(t,e)=>{let i=t.length,s=0;for(;i--;)s+=t[i]*e[i];return s},addArray:(t,e,i)=>{i=i??t.length;let s=[];for(;i--;)s[i]=t[i]+e[i];return s},subArray:(t,e,i)=>{i=i??t.length;let s=[];for(;i--;)s[i]=t[i]-e[i];return s},mulArray:(t,e,i)=>{for(i=i??t.length;i--;)t[i]*=e;return t},divArray:(t,e,i)=>Ni.scaleArray(t,1/e,i),scaleArray:(t,e,i)=>{for(i=i??t.length;i--;)t[i]*=e;return t},fillArray(t,e,i,s){for(i=i||0,s=s??t.length;s--;)e[i+s]=t[s]},copyArray:(t,e)=>{},distanceArray:(t,e=[0,0,0])=>Ni.lengthArray(Ni.subArray(t,e)),getVolume:(t,e,i=null)=>{let s=1,n=e;switch(t){case"sphere":s=4*Math.PI*n[0]*n[0]*n[0]/3;break;case"cone":s=Math.PI*n[0]*(.5*n[1])*2;break;case"box":s=.5*n[0]*8*(.5*n[1])*(.5*n[2]);break;case"cylinder":s=Math.PI*n[0]*n[0]*(.5*n[1])*2;break;case"capsule":s=4*Math.PI*n[0]*n[0]*n[0]/3+Math.PI*n[0]*n[0]*(.5*n[1])*2;break;case"convex":case"mesh":s=Ni.getConvexVolume(i)}return s},getConvexVolume:t=>{let e,i=t.length/3,s=[0,0,0],n=[0,0,0];for(;i--;)e=3*i,t[e]<s[0]?s[0]=t[e]:t[e]>n[0]&&(n[0]=t[e]),t[e+1]<s[1]?s[1]=t[e+1]:t[e+1]>n[1]&&(n[1]=t[e+1]),t[e+2]<s[2]?s[2]=t[e+2]:t[e+2]>n[2]&&(n[2]=t[e+2]);let r=[n[0]-s[0],n[1]-s[1],n[2]-s[2]];return.5*r[0]*8*(.5*r[1])*(.5*r[2])},massFromDensity:(t,e)=>t*e,densityFromMass:(t,e)=>t/e,getIndex:t=>t.index&&t.index.array||null,getVertex:(t,e)=>{let i=t.attributes.position.array;if(e){i=t.clone().toNonIndexed().attributes.position.array}return i},reduce:t=>{},barycentric:(t,e)=>{},solve:(t,e)=>{}},Vi=2e3,Bi=500,$i=50,Xi=100,ji=50,Gi=50,Zi=20,qi={bodyFull:14,body:8,joint:16,contact:8,ray:11,character:16,vehicle:72,solver:128},Wi=new Map,Hi={Ar:null,ArPos:{},viewSize:null,engine:"OIMO",motor:null,scene:null,scenePlus:null,threeScene:null,post:null,jointVisible:!1,delta:0,add:null,remove:null,items:null,tmpMesh:[],instanceMesh:{},tmpTex:[],mouseDown:!1,flow:{stamp:0,current:"",key:[],tmp:[],add:[],remove:[]},reflow:{ray:[],stat:{fps:0},point:{}},extraMaterial:()=>{},disposeTmp:()=>{let t,e,i;for(t in Hi.tmpMesh){if(i=Hi.tmpMesh[t],i.children)for(e in i.children)Hi.disposeMesh(i.children[e]);Hi.disposeMesh(i),i.parent&&i.parent.remove(i)}for(t in Hi.tmpMesh=[],Hi.tmpTex)Hi.tmpTex[t].dispose()},disposeMesh:t=>{t.geometry&&t.geometry.dispose(),t.dispose&&t.dispose()}},Yi={byName:t=>Wi.has(t)?Wi.get(t):null,add:(t,e)=>{if("contact"!==t.type&&!t.isInstance&&t.isObject3D)if(e)e.add(t);else if(t.isButton)Hi.scene.add(t);else switch(t.type){case"terrain":case"solid":case"joint":case"ray":case"articulation":Hi.scenePlus.add(t);break;default:Hi.scene.add(t)}Wi.set(t.name,t)},remove:t=>{t.dispose&&t.dispose(),t.parent&&t.parent.remove(t),t.instance&&t.instance.remove(t.id),Wi.delete(t.name)},noRay:t=>{t.isObject3D&&(t.raycast=()=>{},t.traverse((t=>{t.isObject3D&&(t.raycast=()=>{})})))},morph:(t,e,i)=>{t.morphTargetInfluences&&void 0!==t.morphTargetDictionary[e]&&(t.morphTargetInfluences[t.morphTargetDictionary[e]]=i)},toLocal:(t,e,i=!1)=>{i||t.sub(e.position);let s=e.quaternion;return t.applyQuaternion({x:-s._x,y:-s._y,z:-s._z,w:s._w}),t},quatLocal:(t,i)=>{i.isObject3D&&i.updateWorldMatrix(!0,!1);let s=(new e.Quaternion).fromArray(t),n=i.quaternion.clone().invert();return s.premultiply(n),s.normalize().toArray()},axisLocal:(t,i)=>{i.isObject3D&&i.updateWorldMatrix(!0,!1);let s=(new e.Matrix3).setFromMatrix4(i.matrixWorld);return(new e.Vector3).fromArray(t).applyMatrix3(s).toArray()},quatToAngular:(t,i)=>{i[0]*=-1,i[1]*=-1,i[2]*=-1;let s,n=i[0]*t[3]+i[3]*t[0]+i[1]*t[2]-i[2]*t[1],r=i[1]*t[3]+i[3]*t[1]+i[2]*t[0]-i[0]*t[2],o=i[2]*t[3]+i[3]*t[2]+i[0]*t[1]-i[1]*t[0],a=i[3]*t[3]-i[0]*t[0]-i[1]*t[1]-i[2]*t[2],l=2*Math.acos(a),h=Math.sqrt(1-a*a);s=h<.001?[0,0,0]:[n/h,r/h,o/h];(new e.Vector3).fromArray(s).multiplyScalar(l/1)},refAxis:(t,i)=>{let s=(new e.Vector3).fromArray(i),n=new e.Vector3(1,0,0),r=new e.Vector3(0,1,0);Math.abs(i[1])>.9999||n.copy(s).cross(r).normalize(),r.copy(n).cross(s).normalize(),t.makeBasis(n,r,s)}};class Ki extends e.LineSegments{constructor(t,i=16776960){const s=new Uint16Array([0,1,1,2,2,3,3,4,4,5,5,0,6,7,7,8,8,9,9,10,10,11,11,6,12,13,13,14,14,15,15,16,16,17,17,12,18,19,20,21,22,23]),n=[.5,0,0,.25,.433,0,-.25,.433,0,-.5,0,0,-.25,-.433,0,.25,-.433,0,.5,0,0,.25,0,.433,-.25,0,.433,-.5,0,0,-.25,0,-.433,.25,0,-.433,0,.5,0,0,.25,.433,0,-.25,.433,0,-.5,0,0,-.25,-.433,0,.25,-.433,0,0,0,.6,0,0,0,0,0,0,.6,0,0,0,0,0,0,.6],r=new e.BufferGeometry;r.setIndex(new e.BufferAttribute(s,1)),r.setAttribute("position",new e.Float32BufferAttribute(n,3)),r.setAttribute("color",new e.Float32BufferAttribute([0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,0,1,0,0,1],3)),super(r,new e.LineBasicMaterial({color:i,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.box=t,this.type="CircleHelper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}let Ji=0,ts={};const es=t=>{ts["geo"+Ji++]=t},is=t=>{ts[t.name]=t},ss=(t,i={})=>{if(!ts[t]){let i;switch(t){case"plane":i=new e.PlaneGeometry(1,1),i.rotateX(.5*-Math.PI);break;case"box":i=new e.BoxGeometry(1,1,1);break;case"sphere":i=new e.SphereGeometry(1,16,12);break;case"cylinder":i=new e.CylinderGeometry(1,1,1,16);break;case"cone":i=new e.CylinderGeometry(.001,1,1,16);break;case"particle":i=new e.SphereGeometry(1,8,6);break;case"joint":i=(new Ki).geometry;break;default:return null}ts[t]=i}return ts[t]},ns=()=>{for(let t in ts)ts[t].dispose();ts={},Ji=0};class rs{constructor(t,i="rgb(69,69,69)",s="rgb(39,39,39)"){const n=document.createElement("canvas");n.width=n.height=128;const r=n.getContext("2d");if(r.fillStyle=i,r.fillRect(0,0,128,128),t){let e,n,o,a,l=[[0,0],[32,32],[64,64],[96,96],[96,-32]],h=[[0,64],[32,96],[64,128],[96,160],[-32,32]],c=t?"rgb(128,128,255)":i,u=t?"rgb(160,100,255)":s,d=t?"rgba(100,160,255, 0.5)":"rgba(0,0,0, 0.1)";for(r.strokeStyle=d,r.lineWidth=1,e=0;e<5;e++){a=r.createLinearGradient(0,h[e][0],0,h[e][1]),a.addColorStop(0,u),a.addColorStop(1,c),r.beginPath(),r.fillStyle=a,r.rect(l[e][0],l[e][1],32,64),r.fill();for(let t=0;t<8;t++)o=2*(Math.random()-.5),r.beginPath(),r.moveTo(l[e][0]+o+2+4*t,l[e][1]),r.lineTo(l[e][0]+o+2+4*t,l[e][1]+64),r.stroke()}for(l=[[32,0],[64,32],[96,64],[-32,64],[0,96]],h=[[32,96],[64,128],[96,160],[-32,32],[0,64]],e=0;e<5;e++)for(a=r.createLinearGradient(h[e][0],0,h[e][1],0),a.addColorStop(0,c),a.addColorStop(1,u),r.beginPath(),r.fillStyle=a,r.rect(l[e][0],l[e][1],64,32),r.fill(),n=0;n<8;n++)o=2*(Math.random()-.5),r.beginPath(),r.moveTo(l[e][0],l[e][1]+o+2+4*n),r.lineTo(l[e][0]+64,l[e][1]+o+2+4*n),r.stroke()}else r.beginPath(),r.fillStyle=s,r.rect(0,0,32,64),r.rect(32,32,32,64),r.rect(64,64,32,64),r.rect(96,96,32,64),r.rect(96,-32,32,64),r.fill();const o=new e.CanvasTexture(n);return o.wrapS=o.wrapT=e.RepeatWrapping,o.repeat.x=o.repeat.y=60,t||(o.colorSpace=e.SRGBColorSpace),o}}const os={};let as=[];const ls={metalness:0,roughness:.2},hs={body:new e.Color(15724500),sleep:new e.Color(12566461),solid:new e.Color(7105128),base:new e.Color(16777215),black:new e.Color(2236962),gold:new e.Color(.944,.776,.373),gold2:new e.Color(.998,.981,.751),copper:new e.Color(.96467984,.37626296,.25818297),carPaint:new e.Color(.1037792,.59212029,.85064936),clay:new e.Color(.604,.584,.497),concrete:new e.Color(11119017)},cs={extendShader:()=>{},addToTmp:t=>{as.push(t)},create:t=>{let i,s=null;if(t.isMaterial)i=t;else{let n=void 0!==t.type?t.type:"Standard";switch(t.type&&delete t.type,s=t.beforeCompile||null,t.beforeCompile&&delete t.beforeCompile,(t.thickness||t.sheen||t.clearcoat||t.transmission||t.specularColor)&&(n="Physical"),t.normalScale&&(t.normalScale.isVector2||(t.normalScale=(new e.Vector2).fromArray(t.normalScale))),n=n.toLowerCase(),n){case"physical":i=new e.MeshPhysicalMaterial(t),i.defines={STANDARD:"",PHYSICAL:"",USE_UV:"",USE_SPECULAR:""};break;case"phong":i=new e.MeshPhongMaterial(t);break;case"lambert":i=new e.MeshLambertMaterial(t);break;case"basic":i=new e.MeshBasicMaterial(t);break;case"line":i=new e.LineBasicMaterial(t);break;case"toon":i=new e.MeshToonMaterial(t);break;default:i=new e.MeshStandardMaterial(t)}}return os[i.name]?null:(cs.set(i,!1,s),i)},set:(t,e,i)=>{e||cs.extendShader(t,i),os[t.name]=t},changeType:()=>{},setEnvmapIntensity:t=>{let e;for(let i in os)e=os[i],e.userData.envp||(e.userData.envp=e.envMapIntensity),e.envMapIntensity=e.userData.envp*t},getList:()=>{let t={...os};const e=["line","debug","hide","svg"];let i=e.length;for(;i--;)delete t[e[i]];return t},get:t=>{if(!os[t])switch(t){case"body":cs.create({name:"body",color:hs.body,...ls});break;case"sleep":cs.create({name:"sleep",color:hs.sleep,...ls});break;case"solid":cs.create({name:"solid",color:hs.solid,metalness:.1,roughness:.8});break;case"clay":cs.create({name:"clay",color:hs.clay,metalness:0,roughness:.9});break;case"base":cs.create({name:"base",color:hs.base,...ls});break;case"concrete":cs.create({name:"concrete",color:hs.concrete,metalness:0,roughness:.9});break;case"black":cs.create({name:"black",color:hs.black,metalness:0,roughness:.25});break;case"chrome":cs.create({name:"chrome",color:13421772,metalness:1,roughness:.075});break;case"gold":cs.create({name:"gold",color:hs.gold,specularColor:hs.gold2,metalness:1,roughness:.02});break;case"copper":cs.create({name:"copper",color:hs.copper,metalness:1,roughness:.25,clearcoat:1,clearcoatRoughness:.2});break;case"carPaint":cs.create({name:"carPaint",color:hs.carPaint,metalness:0,anisotropy:new e.Vector2(.5,.5),roughness:.4,clearcoat:1,clearcoatRoughness:0});break;case"carbon":cs.create({name:"carbon",map:new rs,normalMap:new rs(!0),clearcoat:1,clearcoatRoughness:.1,roughness:.5});break;case"cloth":cs.create({name:"cloth",color:8391119,roughness:.5,sheenColor:13335807,sheen:1,sheenRoughness:.2});break;case"skinny":cs.create({name:"skinny",color:14724201,...ls});break;case"glass":cs.create({name:"glass",color:16777215,transparent:!0,opacity:.8,depthTest:!0,depthWrite:!0,roughness:.02,metalness:0,alphaToCoverage:!0,premultipliedAlpha:!0,transmission:1,clearcoat:1,thickness:.02});break;case"glassX":cs.create({name:"glassX",color:15658734,transparent:!1,opacity:1,roughness:.03,metalness:0,side:e.DoubleSide,transmission:1,clearcoat:1,clearcoatRoughness:0,thickness:.6,ior:1.52,envMapIntensity:1,shadowSide:1,reflectivity:.5,iridescence:0});break;case"plexi":cs.create({name:"plexi",color:16777215,transparent:!0,opacity:.4,metalness:1,roughness:0,clearcoat:1,side:e.DoubleSide});break;case"glass2":cs.create({name:"glass2",color:13421823,transparent:!0,opacity:.3});break;case"car":cs.create({name:"car",color:3158064,metalness:1,roughness:.5,clearcoat:1,clearcoatRoughness:.03,sheen:.5});break;case"carGlass":cs.create({name:"carGlass",color:16777215,metalness:0,roughness:0,transmission:1,ior:1.52});break;case"debug":cs.create({name:"debug",type:"Basic",color:15953986,wireframe:!0,toneMapped:!1,transparent:!0,opacity:.25});break;case"bones":cs.create({name:"bones",color:13412915,wireframe:!0});break;case"bones2":cs.create({name:"bones2",type:"basic",color:16746496,transparent:!0,opacity:.5,depthTest:!0,depthWrite:!1,alphaToCoverage:!0});break;case"button":cs.create({name:"button",color:16728139,...ls});break;case"line":cs.create({name:"line",type:"line",vertexColors:!0,toneMapped:!1});break;case"hide":cs.create({name:"hide",type:"basic",visible:!1});break;case"particle":cs.create({name:"particle",type:"basic",toneMapped:!1,color:65280});break;case"svg":cs.create({name:"svg",type:"basic",toneMapped:!1,vertexColors:!0,transparent:!1,side:e.DoubleSide})}return os[t]},dispose:()=>{for(let t in os)os[t].dispose(),delete os[t];let t=as.length;for(;t--;)as[t].dispose();as=[]}};class us{constructor(t){this.values=[],this.ready=0,this.key=t}update(){var t,e,i,s,n,r,o=this.fix,a=navigator.getGamepads();for(t=0;t<a.length;t++)if(r=a[t])if(i=r.axes.length,s=r.buttons.length){for(this.values[t]||(this.values[t]=[]),e=0;e<i;e++)n=o(r.axes[e],.08),0==this.ready&&0!==n&&(this.ready=1),this.values[t][e]=n;for(e=0;e<s;e++)n=o(r.buttons[e].value),0==this.ready&&0!==n&&(this.ready=1),this.values[t][i+e]=n}else this.values[t]&&(this.values[t]=null)}getValue(t){for(var e,i=19;i--;)e=this.values[t][i],0==this.ready&&0!==e&&(this.ready=1),this.key[i]=e}reset(){this.ready=0}fix(t,e){let i=Number(t.toString().substring(0,5));return e&&i<e&&i>-e&&(i=0),i}}class ds{constructor(){this.id=0,this.list=[],this.type="item",this.Utils=null}reset(){let t=this.list.length;for(;t--;)this.dispose(this.list[t]);this.list=[],this.id=0}byName(t){return this.Utils.byName(t)}setName(t={}){let e=void 0!==t.name?t.name:this.type+this.id++;return t.id=this.remove(e,!0),t.name=e,e}addToWorld(t,e=-1){this.Utils.add(t),-1!==e?this.list[e]=t:this.list.push(t)}remove(t,e){let i=this.byName(t);return i?this.clear(i,e):-1}clear(t,e){let i=this.list.indexOf(t);return-1===i||e?this.list[i]=null:this.list.splice(i,1),this.dispose(t),i}dispose(t){null!==t&&this.Utils.remove(t)}vecZero(t,e,i){for(;i--;)t[e+i]=0}fillArray(t,e,i,s){for(i=i||0,s=s??t.length;s--;)e[i+s]=t[s]}arLength(t){let e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return e<.001&&(e=0),e}multiplyScalar(t,e,i){for(i=i??t.length;i--;)t[i]*=e}divideScalar(t,e,i){this.multiplyScalar(t,1/e,i)}add(t={}){}set(t={}){}step(t,e){}}class ps extends ds{constructor(){super(),this.Utils=Yi,this.type="ray",this.iType="ray"}step(){const t=Hi.Ar,e=Hi.ArPos[this.type];let i,s,n=this.list.length;for(;n--;)i=this.list[n],s=e+n*qi.ray,i.update(t,s,Hi.reflow.ray[n]||null)}add(t={}){this.setName(t);let e=new fs(t);return e.visible=void 0===t.visible||t.visible,this.addToWorld(e,t.id),t.parent&&"string"!=typeof t.parent&&(t.parent=t.parent.name),t.callback&&delete t.callback,Hi.post({m:"add",o:t}),e}set(t={},e=null){null===e&&(e=this.byName(t.name)),null!==e&&e.setRay(t)}}class fs extends e.Line{constructor(t={}){super(new e.BufferGeometry,cs.get("line")),this.data={hit:!1,body:"",point:[0,0,0],normal:[0,0,0],distance:0,angle:0},this.type="ray",this.name=t.name,this.parentMesh=null,t.parent&&(this.parentMesh="string"==typeof t.parent?Yi.byName(t.parent):t.parent),this.callback=t.callback||function(){},this.c0=[.1,.1,.3],this.c1=[.1,.4,.6],this.c2=[1,.1,.1],this.c3=[.1,1,.1],this.begin=new e.Vector3,this.end=new e.Vector3(0,1,0),this.fullDistance=0,this.setRay(t),this.tmp=new e.Vector3,this.normal=new e.Vector3,this.vv1=new e.Vector3,this.vv2=new e.Vector3;this.geometry.setAttribute("position",new e.Float32BufferAttribute([0,0,0,0,0,0,0,0,0],3)),this.geometry.setAttribute("color",new e.Float32BufferAttribute([0,0,0,0,0,0,0,0,0],3)),this.vertices=this.geometry.attributes.position,this.colors=this.geometry.attributes.color,this.local=[0,0,0,0,0,0,0,0,0],this.matrixAutoUpdate=!1,this.frustumCulled=!1}setRay(t){t.begin&&this.begin.fromArray(t.begin),t.end&&this.end.fromArray(t.end),this.fullDistance=this.begin.distanceTo(this.end)}update(t,e=0,i=null){if(this.data.hit=0!==t[e],this.data.body=i||"",this.data.distance=t[e+1],this.data.hit)this.local[0]=t[e+2],this.local[1]=t[e+3],this.local[2]=t[e+4],this.tmp.fromArray(t,e+5),this.normal.fromArray(t,e+8),this.data.point=this.tmp.toArray(),this.data.normal=this.normal.toArray(),this.tmp.toArray(this.local,3),this.vv1.fromArray(this.local).sub(this.tmp).normalize(),this.tmp.addScaledVector(this.normal,this.fullDistance-this.data.distance),this.tmp.toArray(this.local,6),this.data.angle=Math.floor(Ni.angleTo(this.vv1.toArray(),this.data.normal)*Di);else if(this.parentMesh){const t=this.parentMesh.matrixWorld;this.tmp.copy(this.begin).applyMatrix4(t).toArray(this.local,0),this.tmp.copy(this.end).applyMatrix4(t),this.tmp.toArray(this.local,3),this.tmp.toArray(this.local,6)}else this.begin.toArray(this.local,0),this.end.toArray(this.local,3),this.end.toArray(this.local,6);this.updateGeometry(),this.callback(this.data)}dispose(){this.geometry.dispose()}raycast(){}updateGeometry(){if(!this.visible)return;let t=this.vertices.array,e=this.colors.array,i=this.local,s=this.data.hit,n=s?this.c2:this.c1,r=s?this.c3:this.c1;e[3]=n[0],e[4]=n[1],e[5]=n[2],e[6]=r[0],e[7]=r[1],e[8]=r[2],t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this.vertices.needsUpdate=!0,this.colors.needsUpdate=!0}}fs.prototype.isRay=!0;let ms=0;const gs=new e.Vector3,vs=new e.Quaternion,ys=new e.Matrix4,bs=new e.Vector3,xs=new e.Vector3,Os=new e.Vector3,ws=new e.Quaternion,Ss=new e.Vector3(1,0,0),ks=new e.Vector3(0,1,0),As=new e.Vector3(0,0,1),Ts={type:"added"},Ms={type:"removed"};class Ps extends e.EventDispatcher{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ms++}),this.uuid=e.MathUtils.generateUUID(),this.isRay=!0,this.matrix=new e.Matrix4,this.matrixWorld=new e.Matrix4,this.name="",this.type="Object3D",this.children=[],this.parent=null,this.position=new e.Vector3,this.quaternion=new e.Quaternion,this.scale=new e.Vector3(1,1,1),this.isKinematic=!1,this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.layers=new e.Layers,this.visible=!0,this.isVisible=!0,this.frustumCulled=!0,this.renderOrder=0,this.userData={},this.shapetype="box",this.size=[1,1,1],this.velocity=new e.Vector3,this.angular=new e.Vector3,this.defMat=!1,this.actif=!1,this.auto=!1,this.sleep=!1,this.mesh=null,this.linked=[]}select(t){}dispose(){this.traverse((function(t){t.isMesh&&t.unic&&t.geometry.dispose()})),this.children=[]}set receiveShadow(t){this.traverse((function(e){e.isMesh&&(e.receiveShadow=t)}))}get receiveShadow(){return!!this.children[0]&&this.children[0].receiveShadow}set castShadow(t){this.traverse((function(e){e.isMesh&&(e.castShadow=t)}))}get castShadow(){return!!this.children[0]&&this.children[0].castShadow}set material(t){this.traverse((function(e){e.isMesh&&(e.material=t)}))}get material(){return this.children,this.children[0]?this.children[0].material:null}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return vs.setFromAxisAngle(t,e),this.quaternion.multiply(vs),this}rotateOnWorldAxis(t,e){return vs.setFromAxisAngle(t,e),this.quaternion.premultiply(vs),this}rotateX(t){return this.rotateOnAxis(Ss,t)}rotateY(t){return this.rotateOnAxis(ks,t)}rotateZ(t){return this.rotateOnAxis(As,t)}translateOnAxis(t,e){return gs.copy(t).applyQuaternion(this.quaternion),this.position.add(gs.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Ss,t)}translateY(t){return this.translateOnAxis(ks,t)}translateZ(t){return this.translateOnAxis(As,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(ys.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?bs.copy(t):bs.set(t,e,i);const s=this.parent;this.updateWorldMatrix(!0,!1),xs.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ys.lookAt(xs,bs,this.up):ys.lookAt(bs,xs,this.up),this.quaternion.setFromRotationMatrix(ys),s&&(ys.extractRotation(s.matrixWorld),vs.setFromRotationMatrix(ys),this.quaternion.premultiply(vs.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Ts)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Ms)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){const t=this.children;let e=t.length;for(;e--;){const i=t[e];i.parent=null,i.dispatchEvent(Ms)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),ys.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),ys.multiply(t.parent.matrixWorld)),t.applyMatrix4(ys),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;const i=this.children;let s=i.length;for(;s--;){const n=i[s].getObjectByProperty(t,e);if(void 0!==n)return n}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xs,t,Os),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xs,ws,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}setRaycast(t){if(void 0!==t&&(this.isRay=t),!this.isRay){let t=this.children.length;for(;t--;)this.children[t].raycast=()=>{}}}raycast(t,e){if(!this.isRay)return;const i=this.children;let s=i.length;for(;s--;)i[s].layers.test(t.layers)&&i[s].raycast(t,e)}traverse(t){t(this);const e=this.children;let i=e.length;for(;i--;)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;let i=e.length;for(;i--;)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;let i=e.length;for(;i--;)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;let e=t.length;for(;e--;)t[e].updateWorldMatrix(!1,!0)}}}class Cs extends e.InstancedMesh{constructor(t,i,s=0){super(t,i,s),this.matrixAutoUpdate=!1,this.tmpMatrix=new e.Matrix4,this.tmpQuat=new e.Quaternion,this.instanceUv=null,this.instanceColor=null,this.needSphereUp=!1,this.isRay=!0}getInfo(t){this.tmpMatrix.fromArray(this.instanceMatrix.array,16*t);let e={x:0,y:0,z:0},i={x:0,y:0,z:0};return this.tmpMatrix.decompose(e,this.tmpQuat,i),{pos:[e.x,e.y,e.z],quat:this.tmpQuat.toArray(),scale:[i.x,i.y,i.z]}}add(t=[0,0,0],i=[0,0,0,1],s=[1,1,1],n=null,r=null){3===i.length&&(i=this.tmpQuat.setFromEuler({_x:i[0],_y:i[1],_z:i[2],_order:"XYZ"},!1).toArray()),n&&(n.isColor&&(n=n.toArray()),null===this.instanceColor&&(this.instanceColor=new e.InstancedBufferAttribute(new Float32Array(3*this.instanceMatrix.count),3))),this.expand(t,i,s,n,r)}setColorAt(t,i){null===this.instanceColor&&(this.instanceColor=new e.InstancedBufferAttribute(new Float32Array(3*this.instanceMatrix.count),3)),i.isColor&&(i=i.toArray());let s=3*t;this.instanceColor.array[s]=i[0],this.instanceColor.array[s+1]=i[1],this.instanceColor.array[s+2]=i[2]}remove(t){if(!this.count)return;let i=[...this.instanceMatrix.array];i.splice(16*t,16),this.instanceMatrix=new e.InstancedBufferAttribute(new Float32Array(i),16),null!==this.instanceColor&&(i=[...this.instanceColor.array],i.splice(3*t,3),this.instanceColor=new e.InstancedBufferAttribute(new Float32Array(i),3)),null!==this.instanceUv&&(i=[...this.instanceUv.array],i.splice(2*t,2),this.instanceUv=new e.InstancedBufferAttribute(new Float32Array(i),2)),this.count--}expand(t,i,s,n=[1,1,1],r){let o=null!==this.instanceMatrix?this.instanceMatrix.array:[];this.tmpMatrix.compose({x:t[0],y:t[1],z:t[2]},{_x:i[0],_y:i[1],_z:i[2],_w:i[3]},{x:s[0],y:s[1],z:s[2]}),this.instanceMatrix=new e.InstancedBufferAttribute(new Float32Array([...o,...this.tmpMatrix.toArray()]),16),null!==this.instanceColor&&(o=this.instanceColor.array,this.instanceColor=new e.InstancedBufferAttribute(new Float32Array([...o,...n]),3)),this.count++}setTransformAt(t,e,i,s){this.tmpMatrix.compose({x:e[0],y:e[1],z:e[2]},{_x:i[0],_y:i[1],_z:i[2],_w:i[3]},{x:s[0],y:s[1],z:s[2]}),this.tmpMatrix.toArray(this.instanceMatrix.array,16*t),this.needSphereUp=!0}dispose(){this.parent.remove(this),this.geometry.dispose(),this.instanceColor=null,this.count=0,this.dispatchEvent({type:"dispose"})}setRaycast(t){void 0!==t&&(this.isRay=t)}raycast(t,e){this.isRay&&super.raycast(t,e)}update(){this.needSphereUp&&this.computeBoundingSphere(),this.instanceMatrix&&(this.instanceMatrix.needsUpdate=!0),this.instanceColor&&(this.instanceColor.needsUpdate=!0),this.needSphereUp=!1}}class _s extends e.BufferGeometry{constructor(t=1,i=10,s=10,n=10,r=1){super(),this.type="SphereBox",this.name="SphereBox_"+t+"_"+i+"_"+s+"_"+n+"_"+r,t=t||1,i=Math.floor(i),s=Math.floor(s),n=Math.floor(n);let o,a=new e.BoxGeometry(1,1,1,i,s,n),l=new e.Vector3,h=new e.Vector3,c=a.attributes.position.array,u=a.attributes.normal.array;for(let e=0,i=a.attributes.position.count;e<i;e++)o=3*e,l.set(c[o],c[o+1],c[o+2]),h.copy(l).normalize(),l.lerp(h,r).multiplyScalar(t),c[o]=l.x,c[o+1]=l.y,c[o+2]=l.z,l.normalize(),u[o]=l.x,u[o+1]=l.y,u[o+2]=l.z;this.copy(a)}}class Rs extends e.BufferGeometry{constructor(t=1,i=1,s=12,n=1){super(),this.type="CapsuleGeometry";let r=Math.PI,o=t/(2*t+i),a=1-2*o;s=Math.floor(s),n=Math.floor(n);let l=Math.floor(.5*s),h=2*Math.PI,c=.5*Math.PI,u=new e.CylinderGeometry(t,t,i,s,n,!0);Is(u,0,o,1,a);let d=new e.SphereGeometry(t,s,l,0,h,0,c);Is(d,0,1-o,1,o);let p=new e.SphereGeometry(t,s,l,0,h,c,c);Is(p,0,0,1,o);let f=(new e.Matrix4).makeRotationY(.5*-r),m=(new e.Matrix4).makeTranslation(0,.5*i,0),g=(new e.Matrix4).makeTranslation(0,.5*-i,0);u.applyMatrix4(f),d.applyMatrix4(m),p.applyMatrix4(g);let v=xt(yt([u,d,p]));this.copy(v)}}class Es extends e.BufferGeometry{constructor(t=1,i=.4,s=8,n=6,r=2*Math.PI,o=0,a=Math.PI){super(),this.type="TorusGeometryFix",this.parameters={radius:t,tube:i,radialSegments:s,tubularSegments:n,arc:r},s=Math.floor(s),n=Math.floor(n);const l=[],h=[],c=[],u=[],d=new e.Vector3,p=new e.Vector3,f=new e.Vector3;let m,g;for(m=0;m<=s;m++)for(g=0;g<=n;g++){const e=g/n*r,l=m/s*a+o;p.x=(t+i*Math.cos(l))*Math.cos(e),p.y=(t+i*Math.cos(l))*Math.sin(e),p.z=i*Math.sin(l),h.push(p.x,p.y,p.z),d.x=t*Math.cos(e),d.y=t*Math.sin(e),f.subVectors(p,d).normalize(),c.push(f.x,f.y,f.z),u.push(g/n),u.push(m/s)}for(m=1;m<=s;m++)for(g=1;g<=n;g++){const t=(n+1)*m+g-1,e=(n+1)*(m-1)+g-1,i=(n+1)*(m-1)+g,s=(n+1)*m+g;l.push(t,e,s),l.push(e,i,s)}this.setIndex(l),this.setAttribute("position",new e.Float32BufferAttribute(h,3)),this.setAttribute("normal",new e.Float32BufferAttribute(c,3)),this.setAttribute("uv",new e.Float32BufferAttribute(u,2))}}class Qs extends e.BufferGeometry{constructor(t=1,i=1,s=1,n=.01,r=12,o=1,a=2){super(),this.type="ChamferCyl",r=Math.floor(r),o=Math.floor(o),a=Math.floor(a);let l=new e.Matrix4,h=new e.Matrix4,c=Math.PI,u=.5*c,d=2*c,p=n/s,f=1-2*p,m=new e.CylinderGeometry(t,i,s-2*n,r,o,!0,0);l.makeRotationY(u),m.applyMatrix4(l),Is(m,0,p,1,f);let g=new Es(t-n,n,a,r,d,0,u),v=new e.CircleGeometry(t-n,r);h.makeTranslation(0,0,n),v.applyMatrix4(h),Is(g,0,1-p,1,p);let y=yt([g,v]);l.makeTranslation(0,0,.5*s-n),h.makeRotationX(-u),y.applyMatrix4(h.multiply(l)),g=new Es(i-n,n,a,r,d,0,u),v=new e.CircleGeometry(i-n,r),h.makeTranslation(0,0,n),v.applyMatrix4(h),Is(g,0,1-p,1,p,!0);let b=yt([g,v]);l.makeTranslation(0,0,.5*s-n),h.makeRotationX(u),b.applyMatrix4(h.multiply(l));let x=xt(yt([y,m,b]));this.copy(x)}}class Ls extends e.BufferGeometry{constructor(t=1,i=1,s=1,n=.01,r=1,o=1,a=1,l=2){super(),this.type="ChamferBox",r=Math.floor(r),o=Math.floor(o),a=Math.floor(a),l=Math.floor(l);let h=Math.PI,c=.5*h,u=2*n,d=.5*t,p=.5*i,f=.5*s,m=new e.Matrix4,g=new e.Matrix4,v=new e.Matrix4,y=n/t,b=1-2*y,x=n/i,O=1-2*y,w=n/s,S=1-2*w,k=new e.PlaneGeometry(t-u,i-u,r,o),A=new e.CylinderGeometry(n,n,t-u,l,r,!0,0,c),T=new e.CylinderGeometry(n,n,i-u,l,o,!0,0,c),M=new Fs(n,l,l,0,c,0,-c),P=new Fs(n,l,l,0,c,0,-c);Is(k,-y,x,b,O),Is(A,0,y,x,b),g.makeTranslation(0,p-n,0),m.makeRotationX(c),M.applyMatrix4(g.multiply(m)),g.makeTranslation(0,-p+n,0),m.makeRotationX(c),v.makeRotationY(-c),P.applyMatrix4(g.multiply(m).multiply(v));let C=yt([T,M,P]),_=C.clone();g.makeTranslation(d-n,0,-n),C.applyMatrix4(g),g.makeTranslation(-d+n,0,-n),m.makeRotationZ(h),_.applyMatrix4(g.multiply(m));let R=A.clone();m.makeRotationZ(c),g.makeTranslation(0,p-n,-n),A.applyMatrix4(g.multiply(m)),g.makeTranslation(0,-p+n,-n),m.makeRotationZ(-c),R.applyMatrix4(g.multiply(m));let E=yt([A,R,k,C,_]),Q=E.clone();g.makeTranslation(0,0,f),E.applyMatrix4(g),g.makeTranslation(0,0,-f),m.makeRotationY(h),Q.applyMatrix4(g.multiply(m)),k=new e.PlaneGeometry(s-u,i-u,a,o),A=new e.CylinderGeometry(n,n,s-u,l,a,!0,0,c),R=A.clone(),Is(k,-w,x,S,O),g.makeTranslation(0,-(p-n),-n,0),m.makeRotationZ(-c),A.applyMatrix4(g.multiply(m)),g.makeTranslation(0,p-n,-n,0),m.makeRotationZ(c),R.applyMatrix4(g.multiply(m));let L=yt([A,R,k]),F=L.clone();g.makeTranslation(-d,0,0),m.makeRotationY(-c),L.applyMatrix4(g.multiply(m)),g.makeTranslation(d,0,0),m.makeRotationY(c),F.applyMatrix4(g.multiply(m)),k=new e.PlaneGeometry(t-u,s-u,r,a),Is(k,-y,w,b,S);let I=k.clone();g.makeTranslation(0,p,0),m.makeRotationX(-c),k.applyMatrix4(g.multiply(m)),g.makeTranslation(0,-p,0),m.makeRotationX(c),I.applyMatrix4(g.multiply(m));let D=xt(yt([E,Q,L,F,k,I]));Ds(D,"box"),this.copy(D)}}class Fs extends e.BufferGeometry{constructor(t=1,i=8,s=6,n=0,r=2*Math.PI,o=0,a=Math.PI){super(),this.type="SphereGeometryFix",this.parameters={radius:t,widthSegments:i,heightSegments:s,phiStart:n,phiLength:r,thetaStart:o,thetaLength:a},i=Math.floor(i),s=Math.floor(s);const l=Math.min(o+a,Math.PI);let h=0;const c=[],u=new e.Vector3,d=new e.Vector3,p=[],f=[],m=[],g=[];for(let e=0;e<=s;e++){const p=[],v=e/s;let y=0;0==e&&0==o?y=.5/i:e==s&&l==Math.PI&&(y=-.5/i);for(let e=0;e<=i;e++){const s=e/i;u.x=-t*Math.cos(n+s*r)*Math.sin(o+v*a),u.y=t*Math.cos(o+v*a),u.z=t*Math.sin(n+s*r)*Math.sin(o+v*a),f.push(u.x,u.y,u.z),d.copy(u).normalize(),m.push(d.x,d.y,d.z),g.push(s+y,1-v),p.push(h++)}c.push(p)}for(let t=0;t<s;t++)for(let e=0;e<i;e++){const i=c[t][e+1],n=c[t][e],r=c[t+1][e],a=c[t+1][e+1];(0!==t||o>0)&&p.push(i,n,a),(t!==s-1||l<Math.PI)&&p.push(n,r,a)}this.setIndex(p),this.setAttribute("position",new e.Float32BufferAttribute(f,3)),this.setAttribute("normal",new e.Float32BufferAttribute(m,3)),this.setAttribute("uv",new e.Float32BufferAttribute(g,2))}}function Is(t,e=0,i=0,s=1,n=1,r){let o=t.attributes.uv,a=o.array,l=o.count,h=0;for(;l--;)h=2*l,a[h]=a[h]*s-e,a[h+1]=a[h+1]*n+i,r&&(a[h]=1-a[h],a[h+1]=1-a[h+1])}function Ds(t,i="sphere",s,n=[0,0,0],r=[0,0,0,1],o){if(void 0===o&&(o=new e.Matrix4),o.compose({x:n[0],y:n[1],z:n[2]},{_x:r[0],_y:r[1],_z:r[2],_w:r[3]},{x:1,y:1,z:1}),void 0===s){t.boundingBox||t.computeBoundingBox();let e=t.boundingBox;s=Math.max(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z)}let a=new e.Box3(new e.Vector3(-s/2,-s/2,-s/2),new e.Vector3(s/2,s/2,s/2)),l=[];l.length=2*t.attributes.position.count,void 0===t.attributes.uv&&t.setAttribute("uv",new e.Float32BufferAttribute(l,2));let h,c,u,d,p,f=function(t,i,s){t.applyMatrix4(o),i.applyMatrix4(o),s.applyMatrix4(o);let n=1/(2*Math.PI),r=1/Math.PI;return t.normalize(),i.normalize(),s.normalize(),{uv0:new e.Vector2(.5-Math.atan(t.z,-t.x)*n,.5-Math.asin(t.y)*r),uv1:new e.Vector2(.5-Math.atan(i.z,-i.x)*n,.5-Math.asin(i.y)*r),uv2:new e.Vector2(.5-Math.atan(s.z,-s.x)*n,.5-Math.asin(s.y)*r)}},m=function(t,i,n){t.applyMatrix4(o),i.applyMatrix4(o),n.applyMatrix4(o);let r=new e.Vector3;r.crossVectors(i.clone().sub(t),i.clone().sub(n)).normalize(),r.x<0||r.y<0||r.z,r.x=Math.abs(r.x),r.y=Math.abs(r.y),r.z=Math.abs(r.z);let l=new e.Vector2,h=new e.Vector2,c=new e.Vector2,u=1/s;return r.y>r.x&&r.y>r.z?(l.set(t.x-a.min.x,a.max.z-t.z).multiplyScalar(u),h.set(i.x-a.min.x,a.max.z-i.z).multiplyScalar(u),c.set(n.x-a.min.x,a.max.z-n.z).multiplyScalar(u)):r.x>r.y&&r.x>r.z?(l.set(t.z-a.min.z,t.y-a.min.y).multiplyScalar(u),h.set(i.z-a.min.z,i.y-a.min.y).multiplyScalar(u),c.set(n.z-a.min.z,n.y-a.min.y).multiplyScalar(u)):r.z>r.y&&r.z>r.x&&(l.set(t.x-a.min.x,t.y-a.min.y).multiplyScalar(u),h.set(i.x-a.min.x,i.y-a.min.y).multiplyScalar(u),c.set(n.x-a.min.x,n.y-a.min.y).multiplyScalar(u)),{uv0:l,uv1:h,uv2:c}},g=new e.Vector3,v=new e.Vector3,y=new e.Vector3;new e.Vector3,new e.Vector3,new e.Vector3;const b=t.getAttribute("position");if(t.getAttribute("normal"),t.index)for(h=0;h<t.index.count;h+=3)c=t.index.getX(h+0),u=t.index.getX(h+1),d=t.index.getX(h+2),g.fromBufferAttribute(b,c),v.fromBufferAttribute(b,u),y.fromBufferAttribute(b,d),p="sphere"===i?f(g,v,y):m(g,v,y),l[2*c]=p.uv0.x,l[2*c+1]=p.uv0.y,l[2*u]=p.uv1.x,l[2*u+1]=p.uv1.y,l[2*d]=p.uv2.x,l[2*d+1]=p.uv2.y;else for(h=0;h<b.count;h+=3){g.fromBufferAttribute(b,h+0),v.fromBufferAttribute(b,h+1),y.fromBufferAttribute(b,h+2),p="sphere"===i?f(g,v,y):m(g,v,y);let t=h,e=h+1,s=h+2;l[2*t]=p.uv0.x,l[2*t+1]=p.uv0.y,l[2*e]=p.uv1.x,l[2*e+1]=p.uv1.y,l[2*s]=p.uv2.x,l[2*s+1]=p.uv2.y}t.attributes.uv.array=new Float32Array(l),t.attributes.uv.needsUpdate=!0}const Us=new e.Vector3,zs=new e.Line3,Ns=new e.Plane,Vs=new e.Vector3,Bs=new e.Triangle;class $s{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new Zs,this.unassigned=new Zs,this.vertices=[]}setFromPoints(t){if(t.length>=4){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.vertices.push(new Gs(t[e]));this.compute()}return this}setFromObject(t){const i=[];return t.updateMatrixWorld(!0),t.traverse((function(t){const s=t.geometry;if(void 0!==s){const n=s.attributes.position;if(void 0!==n)for(let s=0,r=n.count;s<r;s++){const r=new e.Vector3;r.fromBufferAttribute(n,s).applyMatrix4(t.matrixWorld),i.push(r)}}})),this.setFromPoints(i)}containsPoint(t){const e=this.faces;for(let i=0,s=e.length;i<s;i++){if(e[i].distanceToPoint(t)>this.tolerance)return!1}return!0}intersectRay(t,e){const i=this.faces;let s=-1/0,n=1/0;for(let e=0,r=i.length;e<r;e++){const r=i[e],o=r.distanceToPoint(t.origin),a=r.normal.dot(t.direction);if(o>0&&a>=0)return null;const l=0!==a?-o/a:0;if(!(l<=0)&&(a>0?n=Math.min(l,n):s=Math.max(l,s),s>n))return null}return s!==-1/0?t.at(s,e):t.at(n,e),e}intersectsRay(t){return null!==this.intersectRay(t,Us)}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(t,e){return t.face=e,null===e.outside?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this}removeVertexFromFace(t,e){return t===e.outside&&(null!==t.next&&t.next.face===e?e.outside=t.next:e.outside=null),this.assigned.remove(t),this}removeAllVerticesFromFace(t){if(null!==t.outside){const e=t.outside;let i=t.outside;for(;null!==i.next&&i.next.face===t;)i=i.next;return this.assigned.removeSubList(e,i),e.prev=i.next=null,t.outside=null,e}}deleteFaceVertices(t,e){const i=this.removeAllVerticesFromFace(t);if(void 0!==i)if(void 0===e)this.unassigned.appendChain(i);else{let t=i;do{const i=t.next;e.distanceToPoint(t.point)>this.tolerance?this.addVertexToFace(t,e):this.unassigned.append(t),t=i}while(null!==t)}return this}resolveUnassignedPoints(t){if(!1===this.unassigned.isEmpty()){let e=this.unassigned.first();do{const i=e.next;let s=this.tolerance,n=null;for(let i=0;i<t.length;i++){const r=t[i];if(0===r.mark){const t=r.distanceToPoint(e.point);if(t>s&&(s=t,n=r),s>1e3*this.tolerance)break}}null!==n&&this.addVertexToFace(e,n),e=i}while(null!==e)}return this}computeExtremes(){const t=new e.Vector3,i=new e.Vector3,s=[],n=[];for(let t=0;t<3;t++)s[t]=n[t]=this.vertices[0];t.copy(this.vertices[0].point),i.copy(this.vertices[0].point);for(let e=0,r=this.vertices.length;e<r;e++){const r=this.vertices[e],o=r.point;for(let e=0;e<3;e++)o.getComponent(e)<t.getComponent(e)&&(t.setComponent(e,o.getComponent(e)),s[e]=r);for(let t=0;t<3;t++)o.getComponent(t)>i.getComponent(t)&&(i.setComponent(t,o.getComponent(t)),n[t]=r)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(t.x),Math.abs(i.x))+Math.max(Math.abs(t.y),Math.abs(i.y))+Math.max(Math.abs(t.z),Math.abs(i.z))),{min:s,max:n}}computeInitialHull(){const t=this.vertices,e=this.computeExtremes(),i=e.min,s=e.max;let n=0,r=0;for(let t=0;t<3;t++){const e=s[t].point.getComponent(t)-i[t].point.getComponent(t);e>n&&(n=e,r=t)}const o=i[r],a=s[r];let l,h;n=0,zs.set(o.point,a.point);for(let e=0,i=this.vertices.length;e<i;e++){const i=t[e];if(i!==o&&i!==a){zs.closestPointToPoint(i.point,!0,Vs);const t=Vs.distanceToSquared(i.point);t>n&&(n=t,l=i)}}n=-1,Ns.setFromCoplanarPoints(o.point,a.point,l.point);for(let e=0,i=this.vertices.length;e<i;e++){const i=t[e];if(i!==o&&i!==a&&i!==l){const t=Math.abs(Ns.distanceToPoint(i.point));t>n&&(n=t,h=i)}}const c=[];if(Ns.distanceToPoint(h.point)<0){c.push(Xs.create(o,a,l),Xs.create(h,a,o),Xs.create(h,l,a),Xs.create(h,o,l));for(let t=0;t<3;t++){const e=(t+1)%3;c[t+1].getEdge(2).setTwin(c[0].getEdge(e)),c[t+1].getEdge(1).setTwin(c[e+1].getEdge(0))}}else{c.push(Xs.create(o,l,a),Xs.create(h,o,a),Xs.create(h,a,l),Xs.create(h,l,o));for(let t=0;t<3;t++){const e=(t+1)%3;c[t+1].getEdge(2).setTwin(c[0].getEdge((3-t)%3)),c[t+1].getEdge(0).setTwin(c[e+1].getEdge(1))}}for(let t=0;t<4;t++)this.faces.push(c[t]);for(let e=0,i=t.length;e<i;e++){const i=t[e];if(i!==o&&i!==a&&i!==l&&i!==h){n=this.tolerance;let t=null;for(let e=0;e<4;e++){const s=this.faces[e].distanceToPoint(i.point);s>n&&(n=s,t=this.faces[e])}null!==t&&this.addVertexToFace(i,t)}}return this}reindexFaces(){const t=[];for(let e=0;e<this.faces.length;e++){const i=this.faces[e];0===i.mark&&t.push(i)}return this.faces=t,this}nextVertexToAdd(){if(!1===this.assigned.isEmpty()){let t,e=0;const i=this.assigned.first().face;let s=i.outside;do{const n=i.distanceToPoint(s.point);n>e&&(e=n,t=s),s=s.next}while(null!==s&&s.face===i);return t}}computeHorizon(t,e,i,s){let n;this.deleteFaceVertices(i),i.mark=1,n=null===e?e=i.getEdge(0):e.next;do{const e=n.twin,i=e.face;0===i.mark&&(i.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,e,i,s):s.push(n)),n=n.next}while(n!==e);return this}addAdjoiningFace(t,e){const i=Xs.create(t,e.tail(),e.head());return this.faces.push(i),i.getEdge(-1).setTwin(e.twin),i.getEdge(0)}addNewFaces(t,e){this.newFaces=[];let i=null,s=null;for(let n=0;n<e.length;n++){const r=e[n],o=this.addAdjoiningFace(t,r);null===i?i=o:o.next.setTwin(s),this.newFaces.push(o.face),s=o}return i.next.setTwin(s),this}addVertexToHull(t){const e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let t;for(this.computeInitialHull();void 0!==(t=this.nextVertexToAdd());)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}class Xs{constructor(){this.normal=new e.Vector3,this.midpoint=new e.Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}static create(t,e,i){const s=new Xs,n=new js(t,s),r=new js(e,s),o=new js(i,s);return n.next=o.prev=r,r.next=n.prev=o,o.next=r.prev=n,s.edge=n,s.compute()}getEdge(t){let e=this.edge;for(;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e}compute(){const t=this.edge.tail(),e=this.edge.head(),i=this.edge.next.head();return Bs.set(t.point,e.point,i.point),Bs.getNormal(this.normal),Bs.getMidpoint(this.midpoint),this.area=Bs.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(t){return this.normal.dot(t)-this.constant}}class js{constructor(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const t=this.head(),e=this.tail();return null!==e?e.point.distanceTo(t.point):-1}lengthSquared(){const t=this.head(),e=this.tail();return null!==e?e.point.distanceToSquared(t.point):-1}setTwin(t){return this.twin=t,t.twin=this,this}}class Gs{constructor(t){this.point=t,this.prev=null,this.next=null,this.face=null}}class Zs{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(t,e){return e.prev=t.prev,e.next=t,null===e.prev?this.head=e:e.prev.next=e,t.prev=e,this}insertAfter(t,e){return e.prev=t,e.next=t.next,null===e.next?this.tail=e:e.next.prev=e,t.next=e,this}append(t){return null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this}appendChain(t){for(null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail;null!==t.next;)t=t.next;return this.tail=t,this}remove(t){return null===t.prev?this.head=t.next:t.prev.next=t.next,null===t.next?this.tail=t.prev:t.next.prev=t.prev,this}removeSubList(t,e){return null===t.prev?this.head=e.next:t.prev.next=e.next,null===e.next?this.tail=t.prev:e.next.prev=t.prev,this}isEmpty(){return null===this.head}}class qs extends e.BufferGeometry{constructor(t=[]){super();const i=[],s=[],n=(new $s).setFromPoints(t).faces;for(let t=0;t<n.length;t++){const e=n[t];let r=e.edge;do{const t=r.head().point;i.push(t.x,t.y,t.z),s.push(e.normal.x,e.normal.y,e.normal.z),r=r.next}while(r!==e.edge)}this.setAttribute("position",new e.Float32BufferAttribute(i,3)),this.setAttribute("normal",new e.Float32BufferAttribute(s,3))}}class Ws extends e.Object3D{constructor(t,i,s,n,r=[0,1,0],o=[0,.5,0],a=!1){super(),this.matrixAutoUpdate=!1,this.type="CapsuleHelper";const l=new e.BufferGeometry;let h=.5*i-t,c=32,u=.2*t,d=[];const p=[t,h,0,t,-h,0,-t,h,0,-t,-h,0,0,h,t-u,0,h,t+u];d.push(...r,...o,...r,...o,...o,...o),a&&(p.push(0,h,t,0,-h,t,0,h,-t,0,-h,-t),d.push(...r,...o,...r,...o));for(let e=0,i=1;e<c;e++,i++){const s=e/c*Math.PI*2,n=i/c*Math.PI*2;p.push(t*Math.cos(s),h,t*Math.sin(s),t*Math.cos(n),h,t*Math.sin(n),t*Math.cos(s),-h,t*Math.sin(s),t*Math.cos(n),-h,t*Math.sin(n)),d.push(...r,...r,...o,...o)}for(let e=0,i=1;e<c;e++,i++){const s=e/c*Math.PI*2,n=i/c*Math.PI*2;let l=i<=16?1:-1;p.push(t*Math.cos(s),h*l+t*Math.sin(s),0,t*Math.cos(n),h*l+t*Math.sin(n),0),1===l?d.push(...r,...r):d.push(...o,...o),a&&(p.push(0,h*l+t*Math.sin(s),t*Math.cos(s),0,h*l+t*Math.sin(n),t*Math.cos(n)),1===l?d.push(...r,...r):d.push(...o,...o))}if(l.setAttribute("position",new e.Float32BufferAttribute(p,3)),l.setAttribute("color",new e.Float32BufferAttribute(d,3)),this.cone=new e.LineSegments(l,n),this.cone.raycast=function(){},this.add(this.cone),!s)return;const f=new e.BufferGeometry,m=[.5*u,-h,t-u,.5*u,-h,t+u,.5*-u,-h,t-u,.5*-u,-h,t+u,.5*u,-h,t-u,.5*-u,-h,t-u,.5*-u,-h,t+u,-u,-h,t+u,.5*u,-h,t+u,u,-h,t+u,-u,-h,t+u,0,-h,t+2*u,u,-h,t+u,0,-h,t+2*u];d=[];let g=m.length/3;for(;g--;)d.push(1,0,0);f.setAttribute("position",new e.Float32BufferAttribute(m,3)),f.setAttribute("color",new e.Float32BufferAttribute(d,3)),this.direction=new e.LineSegments(f,n),this.direction.raycast=function(){},this.add(this.direction)}setDirection(t){this.direction&&(this.direction.rotation.y=t)}dispose(){this.cone.geometry.dispose(),this.direction&&this.direction.geometry.dispose()}raycast(){}update(){}}class Hs extends ds{constructor(){super(),this.Utils=Yi,this.type="body",this.num=qi[this.type],this.full=!1,this.extraConvex=!1,this.needMatrix="RAPIER"===Hi.engine||"HAVOK"===Hi.engine}setFull(t){this.num=qi[t?"bodyFull":"body"],this.full=t}step(){const t=Hi.Ar,e=Hi.ArPos[this.type],i=this.list;let s,n,r,o=i.length;for(;o--;)if(s=i[o],null!==s){if(n=e+o*this.num,!s.actif){if(r=t[n+0]+t[n+1]+t[n+2]+t[n+3]+t[n+4]+t[n+5]+t[n+6]+t[n+7],0===r)continue;s.actif=!0}s.sleep=!(t[n]>0),s.defMat&&(s.isInstance?s.instance.setColorAt(s.id,s.sleep?hs.sleep:hs.body):(s.sleep||"sleep"!==s.material.name||(s.material=cs.get("body")),s.sleep&&"body"===s.material.name&&(s.material=cs.get("sleep")))),s.sleep&&!s.isKinematic||(s.isInstance?(s.speedMat&&s.instance.setColorAt(s.id,[.5*Math.abs(t[n+8]),.5*Math.abs(t[n+9]),.5*Math.abs(t[n+10])]),s.instance.setTransformAt(s.id,[t[n+1],t[n+2],t[n+3]],[t[n+4],t[n+5],t[n+6],t[n+7]],s.noScale?[1,1,1]:s.size),s.position={x:t[n+1],y:t[n+2],z:t[n+3]},s.quaternion={_x:t[n+4],_y:t[n+5],_z:t[n+6],_w:t[n+7]},this.needMatrix&&s.matrixWorld.compose(s.position,s.quaternion,{x:1,y:1,z:1}),this.full&&(s.velocity={x:t[n+8],y:t[n+9],z:t[n+10]},s.angular={x:t[n+11],y:t[n+12],z:t[n+13]})):(s.position.fromArray(t,n+1),s.quaternion.fromArray(t,n+4),this.full&&(s.velocity.fromArray(t,n+8),s.angular.fromArray(t,n+11)),s.auto||s.updateMatrix()))}}geometry(t={},i=null,s=null){let n,r,o,a=t.size,l="",h=t.type,c=!1,u=!1,d=t.seg||16;if(t.instance&&"compound"===h&&(h=t.shapes[0].type,a=t.shapes[0].size,t.translate=t.shapes[0].pos),"mesh"!==h&&"convex"!==h||(t.shape?t.shape.isMesh&&(t.shape=t.shape.geometry):t.mesh&&!t.v&&(t.shape=t.mesh.geometry)),t.radius&&(t.breakable||("box"===h&&(h="ChamferBox"),"cylinder"===h&&(h="ChamferCyl"))),t.geometry&&("convex"===h?t.shape=t.geometry:h="direct"),"PHYSX"===Hi.engine&&("cylinder"===t.type||"cone"===t.type)){let i=new e.CylinderGeometry("cone"===t.type?0:t.size[0],t.size[0],t.size[1],d,1);t.isWheel&&i.rotateZ(-zi),t.v=Ni.getVertex(i),t.type="convex"}if("HAVOK"===Hi.engine&&"cone"===t.type){let i=new e.CylinderGeometry("cone"===t.type?0:t.size[0],t.size[0],t.size[1],d,1);t.v=Ni.getVertex(i),t.type="convex"}switch("stair"===t.type&&(t.type="box",h="box"),h){case"direct":n=t.geometry.clone(),t.size&&n.scale(t.size[0],t.size[1],t.size[2]),u=!0,c=!0;break;case"convex":if(t.v){if(t.nogeo)n=new e.BufferGeometry;else{let i=[];for(r=Math.floor(t.v.length/3);r--;)o=3*r,i.push(new e.Vector3(t.v[o],t.v[o+1],t.v[o+2]));n=new qs(i)}u=!0,c=!0}t.shape&&(n=t.shape.clone(),t.size&&n.scale(t.size[0],t.size[0],t.size[0]),t.shapeScale&&n.scale(t.shapeScale[0],t.shapeScale[1],t.shapeScale[2]),t.v=Ni.getVertex(n),t.index=Ni.getIndex(n),u=!0,c=!0),n.boundingBox||n.computeBoundingBox();let i=n.boundingBox;t.boxSize=[-i.min.x+i.max.x,-i.min.y+i.max.y,-i.min.z+i.max.z];break;case"mesh":n=t.shape.clone(),t.size&&n.scale(t.size[0],t.size[0],t.size[0]),t.v=Ni.getVertex(n,"OIMO"===Hi.engine),t.index="OIMO"===Hi.engine?null:Ni.getIndex(n),u=!0,c=!0;break;case"highSphere":l="highSphere_"+a[0],n=ss(l),n?l="":(n=new _s(a[0]),n.name=l),c=!0,t.type="sphere";break;case"capsule":l="capsule_"+a[0]+"_"+a[1]+"_"+d,n=ss(l),n?l="":(n=new Rs(a[0],a[1],d),n.name=l),c=!0;break;case"ChamferBox":l="ChamferBox_"+a[0]+"_"+a[1]+"_"+a[2]+"_"+t.radius,n=ss(l),n?l="":(n=new Ls(a[0],a[1],a[2],t.radius),n.name=l),c=!0;break;case"ChamferCyl":l="ChamferCyl_"+a[0]+"_"+a[1]+"_"+a[2]+"_"+t.radius+"_"+d,n=ss(l),n?l="":(n=new Qs(a[0],a[0],a[1],t.radius,d),n.name=l),c=!0;break;default:t.breakable?(n=ss(h).clone(),n.scale(a[0],a[1],a[2]),u=!0,c=!0):n=ss(h)}if(t.translate&&n.translate(t.translate[0],t.translate[1],t.translate[2]),t.shape&&delete t.shape,t.geometry&&delete t.geometry,(void 0===n.attributes.uv||t.autoUV)&&Ds(n,"box",5,t.pos,t.quat),""!==l&&is(n),t.isWheel&&(n=n.clone(),n.rotateZ(-zi),u=!0),u&&es(n),null===i&&null===s)return n.noScale=c,n;t.meshRemplace&&t.debug&&(s=cs.get("debug"));let p=new e.Mesh(n,s);t.button&&(p.isButton=!0),t.helper&&p.add(new Ws(a[0],a[1]+2*a[0],!1,cs.get("line"),[.3,.1,0],[.8,.2,0],!0)),t.localRot&&(t.localQuat=Ni.quatFromEuler(t.localRot)),t.localPos&&p.position.fromArray(t.localPos),t.localQuat&&p.quaternion.fromArray(t.localQuat),c||p.scale.fromArray(t.size),void 0!==t.ray&&(t.ray||(p.raycast=()=>{})),t.meshRemplace&&!t.debug||i.add(p)}add(t={}){let i,s,n;if(t.instance||(n=this.setName(t)),t.type=void 0===t.type?"box":t.type,"plane"!==t.type||t.visible||(t.visible=!1),"stair"===t.type){let i=new e.Vector3(0,0,t.size[2]),s=new e.Vector3(0,.5*t.size[1],.5*t.size[2]),n=i.angleTo(s),r=i.distanceTo(s);t.rot=[n*Di,0,0],t.size[1]*=t.div||.2,t.size[2]=2*r;let o=new e.Vector3(0,.5*-t.size[1],0);o.applyAxisAngle({x:1,y:0,z:0},n),t.pos[1]+=o.y,t.pos[2]+=o.z}if(t.massCenter&&"PHYSX"!==Hi.engine)if("compound"!==t.type)t.shapes=[{type:t.type,pos:t.massCenter,size:t.size}],t.seg&&(t.shapes[0].seg=t.seg),t.radius&&(t.shapes[0].radius=t.radius),delete t.size,t.type="compound";else for(i=0;i<t.shapes.length;i++)s=t.shapes[i],s.pos?s.pos=Yi.vecAdd(s.pos,t.massCenter):s.pos=t.massCenter,es(s);t.pos=void 0===t.pos?[0,0,0]:t.pos,t.quat=void 0===t.quat?[0,0,0,1]:t.quat,void 0!==t.rot&&(t.quat=Ni.quatFromEuler(t.rot),delete t.rot),void 0!==t.meshRot&&(t.meshQuat=Ni.quatFromEuler(t.meshRot),delete t.meshRot),t.size=Ni.autoSize(t.size,t.type),t.meshScale&&(t.meshScale=Ni.autoSize(t.meshScale));let r,o=!1;!1===t.visible&&(t.material="hide"),void 0!==t.material?r=t.material.constructor===String?cs.get(t.material):t.material:(o=!0,r=cs.get(this.type),t.instance&&(r=cs.get("base"))),t.unicMat&&(r=r.clone(),cs.addToTmp(r)),t.material&&delete t.material;let a=t.instance?{}:new Ps;if(t.mesh&&!t.instance){"terrain"===t.mesh.type&&(t.noClone=!0);let e=t.noClone?t.mesh:t.mesh.clone();e.position.fromArray(t.meshPos||[0,0,0]),t.meshRot&&(t.meshQuat=Ni.quatFromEuler(t.meshRot),delete t.meshRot),t.meshQuat&&e.quaternion.fromArray(t.meshQuat),t.meshSize&&e.scale.set(1,1,1).multiplyScalar(t.meshSize),t.meshScale&&e.scale.fromArray(t.meshScale),o||(e.material=r),Hi.tmpMesh.push(e),t.meshRemplace=!0,a.add(e)}switch(t.type){case"null":break;case"compound":for(i=0;i<t.shapes.length;i++)s=t.shapes[i],s.type=void 0===s.type?"box":s.type,s.size=Ni.autoSize(s.size,s.type),s.pos&&(s.localPos=s.pos),void 0!==s.rot&&(s.quat=Ni.quatFromEuler(s.rot),delete s.rot),s.quat&&(s.localQuat=s.quat),s.debug=t.debug||!1,s.meshRemplace=t.meshRemplace||!1,t.instance||this.geometry(s,a,r);break;default:t.instance||this.geometry(t,a,r)}if(a.type=this.type,a.size=t.size,a.shapetype=t.type,a.isKinematic=t.kinematic||!1,a.link=0,t.button&&(a.isButton=!0),a.isRay=!0,void 0!==t.ray&&(a.isRay=t.ray),t.instance||a.setRaycast(),o||(a.material=r),a.defMat=!1,a.material&&o&&(a.defMat="body"===a.material.name),t.instance){a.isInstance=!0,a.instance=Hi.instanceMesh[t.instance]||this.addInstance(t,r),a.instance.isRay=a.isRay,a.defMat="base"===a.instance.material.name,a.id=a.instance.count,a.mass=t.mass||0,a.name=a.instance.name+a.id,t.name=a.name,a.noScale=a.instance.noScale,t.sizeByInstance&&(a.noScale=!1);let i=t.color;a.defMat&&(i=t.sleep?hs.sleep:hs.body),a.instance.add(t.pos,t.quat,a.noScale?[1,1,1]:a.size,i),a.position={x:t.pos[0],y:t.pos[1],z:t.pos[2]},a.quaternion={_x:t.quat[0],_y:t.quat[1],_z:t.quat[2],_w:t.quat[3]},a.velocity={x:0,y:0,z:0},a.angular={x:0,y:0,z:0},a.link=0,this.needMatrix&&(a.matrixWorld=new e.Matrix4),a.instance.v&&(t.v=a.instance.v),a.instance.index&&(t.index=a.instance.index),t.type=a.instance.type}else a.name=n,t.renderOrder&&(a.renderOrder=t.renderOrder),void 0===t.visible&&(t.visible=!0),void 0===t.shadow&&(t.shadow=t.visible),a.visible=void 0===t.visible||t.visible,a.receiveShadow=t.shadow,a.castShadow=t.shadow,this.set(t,a);if(t.instance&&delete t.instance,t.mesh&&delete t.mesh,t.breakable){Hi.motor.addBreaker();let e=a.children[0];a.remove(e),a=e,a.name=n,a.type=this.type,a.density=t.density,a.breakable=!0,a.breakOption=void 0!==t.breakOption?t.breakOption:[250,1,2,1]}return this.addToWorld(a,t.id),t.onlyMakeMesh||(t.phySize&&(t.size=t.phySize),t.phyPos&&(t.pos=t.phyPos),t.parent&&delete t.parent,Hi.post({m:"add",o:t})),a}set(t={},e=null){null===e&&(e=this.byName(t.name)),null!==e&&(t.pos&&e.position.fromArray(t.pos),t.quat&&e.quaternion.fromArray(t.quat),e.auto=t.auto||!1,e.auto?e.matrixAutoUpdate=!0:(e.matrixAutoUpdate=!1,e.updateMatrix()))}addInstance(t,e){t.sizeByInstance&&(t.size=[1,1,1]);let i=this.geometry(t);t.mesh&&(i=t.mesh.isObject3D?t.mesh.geometry.clone():t.mesh.clone(),t.meshScale&&i.scale(t.meshScale[0],t.meshScale[1],t.meshScale[2]),i.noScale=!0);let s=new Cs(i,e,0);return s.type=t.type,s.noScale=i.noScale,"convex"===s.type&&(s.v=t.v),t.index&&(s.index=t.index),s.receiveShadow=void 0===t.shadow||t.shadow,s.castShadow=void 0===t.shadow||t.shadow,s.name=t.instance,Hi.scene.add(s),Hi.instanceMesh[t.instance]=s,s}}const Ys=e.SRGBColorSpace;class Ks extends e.Loader{constructor(t){super(t),this.defaultDPI=90,this.defaultUnit="px"}load(t,i,s,n){const r=this,o=new e.FileLoader(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(t,(function(e){try{i(r.parse(e))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),s,n)}parse(t){const i=this;function s(t,e,i,s,r,o,a,l){if(0==e||0==i)return void t.lineTo(l.x,l.y);s=s*Math.PI/180,e=Math.abs(e),i=Math.abs(i);const h=(a.x-l.x)/2,c=(a.y-l.y)/2,u=Math.cos(s)*h+Math.sin(s)*c,d=-Math.sin(s)*h+Math.cos(s)*c;let p=e*e,f=i*i;const m=u*u,g=d*d,v=m/p+g/f;if(v>1){const t=Math.sqrt(v);p=(e*=t)*e,f=(i*=t)*i}const y=p*g+f*m,b=(p*f-y)/y;let x=Math.sqrt(Math.max(0,b));r===o&&(x=-x);const O=x*e*d/i,w=-x*i*u/e,S=Math.cos(s)*O-Math.sin(s)*w+(a.x+l.x)/2,k=Math.sin(s)*O+Math.cos(s)*w+(a.y+l.y)/2,A=n(1,0,(u-O)/e,(d-w)/i),T=n((u-O)/e,(d-w)/i,(-u-O)/e,(-d-w)/i)%(2*Math.PI);t.currentPath.absellipse(S,k,e,i,A,A+T,0===o,s)}function n(t,e,i,s){const n=t*i+e*s,r=Math.sqrt(t*t+e*e)*Math.sqrt(i*i+s*s);let o=Math.acos(Math.max(-1,Math.min(1,n/r)));return t*s-e*i<0&&(o=-o),o}function r(t,e){e=Object.assign({},e);let i={};if(t.hasAttribute("class")){const e=t.getAttribute("class").split(/\s/).filter(Boolean).map((t=>t.trim()));for(let t=0;t<e.length;t++)i=Object.assign(i,g["."+e[t]])}function s(s,n,r){void 0===r&&(r=function(t){return t.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),t}),t.hasAttribute(s)&&(e[n]=r(t.getAttribute(s))),i[s]&&(e[n]=r(i[s])),t.style&&""!==t.style[s]&&(e[n]=r(t.style[s]))}function n(t){return Math.max(0,Math.min(1,c(t)))}function r(t){return Math.max(0,c(t))}return t.hasAttribute("id")&&(i=Object.assign(i,g["#"+t.getAttribute("id")])),s("fill","fill"),s("fill-opacity","fillOpacity",n),s("fill-rule","fillRule"),s("opacity","opacity",n),s("stroke","stroke"),s("stroke-opacity","strokeOpacity",n),s("stroke-width","strokeWidth",r),s("stroke-linejoin","strokeLineJoin"),s("stroke-linecap","strokeLineCap"),s("stroke-miterlimit","strokeMiterLimit",r),s("visibility","visibility"),e}function o(t,e){return t-(e-t)}function a(t,e,i){if("string"!=typeof t)throw new TypeError("Invalid input: "+typeof t);const s={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/};let n=0,r=!0,o="",a="";const l=[];function h(t,e,i){const s=new SyntaxError('Unexpected character "'+t+'" at index '+e+".");throw s.partial=i,s}function c(){""!==o&&(""===a?l.push(Number(o)):l.push(Number(o)*Math.pow(10,Number(a)))),o="",a=""}let u;const d=t.length;for(let p=0;p<d;p++)if(u=t[p],Array.isArray(e)&&e.includes(l.length%i)&&s.FLAGS.test(u))n=1,o=u,c();else{if(0===n){if(s.WHITESPACE.test(u))continue;if(s.DIGIT.test(u)||s.SIGN.test(u)){n=1,o=u;continue}if(s.POINT.test(u)){n=2,o=u;continue}s.COMMA.test(u)&&(r&&h(u,p,l),r=!0)}if(1===n){if(s.DIGIT.test(u)){o+=u;continue}if(s.POINT.test(u)){o+=u,n=2;continue}if(s.EXP.test(u)){n=3;continue}s.SIGN.test(u)&&1===o.length&&s.SIGN.test(o[0])&&h(u,p,l)}if(2===n){if(s.DIGIT.test(u)){o+=u;continue}if(s.EXP.test(u)){n=3;continue}s.POINT.test(u)&&"."===o[o.length-1]&&h(u,p,l)}if(3===n){if(s.DIGIT.test(u)){a+=u;continue}if(s.SIGN.test(u)){if(""===a){a+=u;continue}1===a.length&&s.SIGN.test(a)&&h(u,p,l)}}s.WHITESPACE.test(u)?(c(),n=0,r=!1):s.COMMA.test(u)?(c(),n=0,r=!0):s.SIGN.test(u)?(c(),n=1,o=u):s.POINT.test(u)?(c(),n=2,o=u):h(u,p,l)}return c(),l}const l=["mm","cm","in","pt","pc","px"],h={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function c(t){let e,s="px";if("string"==typeof t||t instanceof String)for(let e=0,i=l.length;e<i;e++){const i=l[e];if(t.endsWith(i)){s=i,t=t.substring(0,t.length-i.length);break}}return"px"===s&&"px"!==i.defaultUnit?e=h.in[i.defaultUnit]/i.defaultDPI:(e=h[s][i.defaultUnit],e<0&&(e=h[s].in*i.defaultDPI)),e*parseFloat(t)}function u(t){const e=t.elements;return e[0]*e[4]-e[1]*e[3]<0}function d(t){const e=t.elements,i=e[0]*e[3]+e[1]*e[4];if(0===i)return!1;const s=p(t),n=f(t);return Math.abs(i/(s*n))>Number.EPSILON}function p(t){const e=t.elements;return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function f(t){const e=t.elements;return Math.sqrt(e[3]*e[3]+e[4]*e[4])}const m=[],g={},v=[],y=new e.Matrix3,b=new e.Matrix3,x=new e.Matrix3,O=new e.Matrix3,w=new e.Vector2,S=new e.Vector3,k=new e.Matrix3,A=(new DOMParser).parseFromString(t,"image/svg+xml");!function t(i,n){if(1!==i.nodeType)return;const l=function(t){if(!(t.hasAttribute("transform")||"use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))))return null;const i=function(t){const i=new e.Matrix3,s=y;if("use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))){const e=c(t.getAttribute("x")),s=c(t.getAttribute("y"));i.translate(e,s)}if(t.hasAttribute("transform")){const e=t.getAttribute("transform").split(")");for(let t=e.length-1;t>=0;t--){const n=e[t].trim();if(""===n)continue;const r=n.indexOf("("),o=n.length;if(r>0&&r<o){const t=n.slice(0,r),e=a(n.slice(r+1));switch(s.identity(),t){case"translate":if(e.length>=1){const t=e[0];let i=0;e.length>=2&&(i=e[1]),s.translate(t,i)}break;case"rotate":if(e.length>=1){let t=0,i=0,n=0;t=e[0]*Math.PI/180,e.length>=3&&(i=e[1],n=e[2]),b.makeTranslation(-i,-n),x.makeRotation(t),O.multiplyMatrices(x,b),b.makeTranslation(i,n),s.multiplyMatrices(b,O)}break;case"scale":if(e.length>=1){const t=e[0];let i=t;e.length>=2&&(i=e[1]),s.scale(t,i)}break;case"skewX":1===e.length&&s.set(1,Math.tan(e[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===e.length&&s.set(1,0,0,Math.tan(e[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===e.length&&s.set(e[0],e[2],e[4],e[1],e[3],e[5],0,0,1)}}i.premultiply(s)}}return i}(t);v.length>0&&i.premultiply(v[v.length-1]);return k.copy(i),v.push(i),i}(i);let h=!1,A=null;switch(i.nodeName){case"svg":case"g":n=r(i,n);break;case"style":!function(t){if(!t.sheet||!t.sheet.cssRules||!t.sheet.cssRules.length)return;for(let e=0;e<t.sheet.cssRules.length;e++){const i=t.sheet.cssRules[e];if(1!==i.type)continue;const s=i.selectorText.split(/,/gm).filter(Boolean).map((t=>t.trim()));for(let t=0;t<s.length;t++){const e=Object.fromEntries(Object.entries(i.style).filter((([,t])=>""!==t)));g[s[t]]=Object.assign(g[s[t]]||{},e)}}}(i);break;case"path":n=r(i,n),i.hasAttribute("d")&&(A=function(t){const i=new e.ShapePath,n=new e.Vector2,r=new e.Vector2,l=new e.Vector2;let h=!0,c=!1;const u=t.getAttribute("d");if(""===u||"none"===u)return null;const d=u.match(/[a-df-z][^a-df-z]*/gi);for(let t=0,e=d.length;t<e;t++){const e=d[t],u=e.charAt(0),p=e.slice(1).trim();let f;switch(!0===h&&(c=!0,h=!1),u){case"M":f=a(p);for(let t=0,e=f.length;t<e;t+=2)n.x=f[t+0],n.y=f[t+1],r.x=n.x,r.y=n.y,0===t?i.moveTo(n.x,n.y):i.lineTo(n.x,n.y),0===t&&l.copy(n);break;case"H":f=a(p);for(let t=0,e=f.length;t<e;t++)n.x=f[t],r.x=n.x,r.y=n.y,i.lineTo(n.x,n.y),0===t&&!0===c&&l.copy(n);break;case"V":f=a(p);for(let t=0,e=f.length;t<e;t++)n.y=f[t],r.x=n.x,r.y=n.y,i.lineTo(n.x,n.y),0===t&&!0===c&&l.copy(n);break;case"L":f=a(p);for(let t=0,e=f.length;t<e;t+=2)n.x=f[t+0],n.y=f[t+1],r.x=n.x,r.y=n.y,i.lineTo(n.x,n.y),0===t&&!0===c&&l.copy(n);break;case"C":f=a(p);for(let t=0,e=f.length;t<e;t+=6)i.bezierCurveTo(f[t+0],f[t+1],f[t+2],f[t+3],f[t+4],f[t+5]),r.x=f[t+2],r.y=f[t+3],n.x=f[t+4],n.y=f[t+5],0===t&&!0===c&&l.copy(n);break;case"S":f=a(p);for(let t=0,e=f.length;t<e;t+=4)i.bezierCurveTo(o(n.x,r.x),o(n.y,r.y),f[t+0],f[t+1],f[t+2],f[t+3]),r.x=f[t+0],r.y=f[t+1],n.x=f[t+2],n.y=f[t+3],0===t&&!0===c&&l.copy(n);break;case"Q":f=a(p);for(let t=0,e=f.length;t<e;t+=4)i.quadraticCurveTo(f[t+0],f[t+1],f[t+2],f[t+3]),r.x=f[t+0],r.y=f[t+1],n.x=f[t+2],n.y=f[t+3],0===t&&!0===c&&l.copy(n);break;case"T":f=a(p);for(let t=0,e=f.length;t<e;t+=2){const e=o(n.x,r.x),s=o(n.y,r.y);i.quadraticCurveTo(e,s,f[t+0],f[t+1]),r.x=e,r.y=s,n.x=f[t+0],n.y=f[t+1],0===t&&!0===c&&l.copy(n)}break;case"A":f=a(p,[3,4],7);for(let t=0,e=f.length;t<e;t+=7){if(f[t+5]==n.x&&f[t+6]==n.y)continue;const e=n.clone();n.x=f[t+5],n.y=f[t+6],r.x=n.x,r.y=n.y,s(i,f[t],f[t+1],f[t+2],f[t+3],f[t+4],e,n),0===t&&!0===c&&l.copy(n)}break;case"m":f=a(p);for(let t=0,e=f.length;t<e;t+=2)n.x+=f[t+0],n.y+=f[t+1],r.x=n.x,r.y=n.y,0===t?i.moveTo(n.x,n.y):i.lineTo(n.x,n.y),0===t&&l.copy(n);break;case"h":f=a(p);for(let t=0,e=f.length;t<e;t++)n.x+=f[t],r.x=n.x,r.y=n.y,i.lineTo(n.x,n.y),0===t&&!0===c&&l.copy(n);break;case"v":f=a(p);for(let t=0,e=f.length;t<e;t++)n.y+=f[t],r.x=n.x,r.y=n.y,i.lineTo(n.x,n.y),0===t&&!0===c&&l.copy(n);break;case"l":f=a(p);for(let t=0,e=f.length;t<e;t+=2)n.x+=f[t+0],n.y+=f[t+1],r.x=n.x,r.y=n.y,i.lineTo(n.x,n.y),0===t&&!0===c&&l.copy(n);break;case"c":f=a(p);for(let t=0,e=f.length;t<e;t+=6)i.bezierCurveTo(n.x+f[t+0],n.y+f[t+1],n.x+f[t+2],n.y+f[t+3],n.x+f[t+4],n.y+f[t+5]),r.x=n.x+f[t+2],r.y=n.y+f[t+3],n.x+=f[t+4],n.y+=f[t+5],0===t&&!0===c&&l.copy(n);break;case"s":f=a(p);for(let t=0,e=f.length;t<e;t+=4)i.bezierCurveTo(o(n.x,r.x),o(n.y,r.y),n.x+f[t+0],n.y+f[t+1],n.x+f[t+2],n.y+f[t+3]),r.x=n.x+f[t+0],r.y=n.y+f[t+1],n.x+=f[t+2],n.y+=f[t+3],0===t&&!0===c&&l.copy(n);break;case"q":f=a(p);for(let t=0,e=f.length;t<e;t+=4)i.quadraticCurveTo(n.x+f[t+0],n.y+f[t+1],n.x+f[t+2],n.y+f[t+3]),r.x=n.x+f[t+0],r.y=n.y+f[t+1],n.x+=f[t+2],n.y+=f[t+3],0===t&&!0===c&&l.copy(n);break;case"t":f=a(p);for(let t=0,e=f.length;t<e;t+=2){const e=o(n.x,r.x),s=o(n.y,r.y);i.quadraticCurveTo(e,s,n.x+f[t+0],n.y+f[t+1]),r.x=e,r.y=s,n.x=n.x+f[t+0],n.y=n.y+f[t+1],0===t&&!0===c&&l.copy(n)}break;case"a":f=a(p,[3,4],7);for(let t=0,e=f.length;t<e;t+=7){if(0==f[t+5]&&0==f[t+6])continue;const e=n.clone();n.x+=f[t+5],n.y+=f[t+6],r.x=n.x,r.y=n.y,s(i,f[t],f[t+1],f[t+2],f[t+3],f[t+4],e,n),0===t&&!0===c&&l.copy(n)}break;case"Z":case"z":i.currentPath.autoClose=!0,i.currentPath.curves.length>0&&(n.copy(l),i.currentPath.currentPoint.copy(n),h=!0);break;default:console.warn(e)}c=!1}return i}(i));break;case"rect":n=r(i,n),A=function(t){const i=c(t.getAttribute("x")||0),s=c(t.getAttribute("y")||0),n=c(t.getAttribute("rx")||t.getAttribute("ry")||0),r=c(t.getAttribute("ry")||t.getAttribute("rx")||0),o=c(t.getAttribute("width")),a=c(t.getAttribute("height")),l=.448084975506,h=new e.ShapePath;h.moveTo(i+n,s),h.lineTo(i+o-n,s),(0!==n||0!==r)&&h.bezierCurveTo(i+o-n*l,s,i+o,s+r*l,i+o,s+r);h.lineTo(i+o,s+a-r),(0!==n||0!==r)&&h.bezierCurveTo(i+o,s+a-r*l,i+o-n*l,s+a,i+o-n,s+a);h.lineTo(i+n,s+a),(0!==n||0!==r)&&h.bezierCurveTo(i+n*l,s+a,i,s+a-r*l,i,s+a-r);h.lineTo(i,s+r),(0!==n||0!==r)&&h.bezierCurveTo(i,s+r*l,i+n*l,s,i+n,s);return h}(i);break;case"polygon":n=r(i,n),A=function(t){function i(t,e,i){const s=c(e),o=c(i);0===r?n.moveTo(s,o):n.lineTo(s,o),r++}const s=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,n=new e.ShapePath;let r=0;return t.getAttribute("points").replace(s,i),n.currentPath.autoClose=!0,n}(i);break;case"polyline":n=r(i,n),A=function(t){function i(t,e,i){const s=c(e),o=c(i);0===r?n.moveTo(s,o):n.lineTo(s,o),r++}const s=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,n=new e.ShapePath;let r=0;return t.getAttribute("points").replace(s,i),n.currentPath.autoClose=!1,n}(i);break;case"circle":n=r(i,n),A=function(t){const i=c(t.getAttribute("cx")||0),s=c(t.getAttribute("cy")||0),n=c(t.getAttribute("r")||0),r=new e.Path;r.absarc(i,s,n,0,2*Math.PI);const o=new e.ShapePath;return o.subPaths.push(r),o}(i);break;case"ellipse":n=r(i,n),A=function(t){const i=c(t.getAttribute("cx")||0),s=c(t.getAttribute("cy")||0),n=c(t.getAttribute("rx")||0),r=c(t.getAttribute("ry")||0),o=new e.Path;o.absellipse(i,s,n,r,0,2*Math.PI);const a=new e.ShapePath;return a.subPaths.push(o),a}(i);break;case"line":n=r(i,n),A=function(t){const i=c(t.getAttribute("x1")||0),s=c(t.getAttribute("y1")||0),n=c(t.getAttribute("x2")||0),r=c(t.getAttribute("y2")||0),o=new e.ShapePath;return o.moveTo(i,s),o.lineTo(n,r),o.currentPath.autoClose=!1,o}(i);break;case"defs":h=!0;break;case"use":n=r(i,n);const l=(i.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),u=i.viewportElement.getElementById(l);u?t(u,n):console.warn("SVGLoader: 'use node' references non-existent node id: "+l)}A&&(void 0!==n.fill&&"none"!==n.fill&&A.color.setStyle(n.fill,Ys),function(t,i){function s(t){S.set(t.x,t.y,1).applyMatrix3(i),t.set(S.x,S.y)}function n(t){const s=t.xRadius,n=t.yRadius,r=Math.cos(t.aRotation),o=Math.sin(t.aRotation),a=new e.Vector3(s*r,s*o,0),l=new e.Vector3(-n*o,n*r,0),h=a.applyMatrix3(i),c=l.applyMatrix3(i),d=y.set(h.x,c.x,0,h.y,c.y,0,0,0,1),p=b.copy(d).invert(),f=x.copy(p).transpose().multiply(p).elements,m=function(t,e,i){let s,n,r,o,a;const l=t+i,h=t-i,c=Math.sqrt(h*h+4*e*e);l>0?(s=.5*(l+c),a=1/s,n=t*a*i-e*a*e):l<0?n=.5*(l-c):(s=.5*c,n=-.5*c);r=h>0?h+c:h-c;Math.abs(r)>2*Math.abs(e)?(a=-2*e/r,o=1/Math.sqrt(1+a*a),r=a*o):0===Math.abs(e)?(r=1,o=0):(a=-.5*r/e,r=1/Math.sqrt(1+a*a),o=a*r);h>0&&(a=r,r=-o,o=a);return{rt1:s,rt2:n,cs:r,sn:o}}(f[0],f[1],f[4]),g=Math.sqrt(m.rt1),v=Math.sqrt(m.rt2);t.xRadius=1/g,t.yRadius=1/v,t.aRotation=Math.atan2(m.sn,m.cs);if(!((t.aEndAngle-t.aStartAngle)%(2*Math.PI)<Number.EPSILON)){const s=b.set(g,0,0,0,v,0,0,0,1),n=x.set(m.cs,m.sn,0,-m.sn,m.cs,0,0,0,1),r=s.multiply(n).multiply(d),o=t=>{const{x:i,y:s}=new e.Vector3(Math.cos(t),Math.sin(t),0).applyMatrix3(r);return Math.atan2(s,i)};t.aStartAngle=o(t.aStartAngle),t.aEndAngle=o(t.aEndAngle),u(i)&&(t.aClockwise=!t.aClockwise)}}function r(t){const e=p(i),s=f(i);t.xRadius*=e,t.yRadius*=s;const n=e>Number.EPSILON?Math.atan2(i.elements[1],i.elements[0]):Math.atan2(-i.elements[3],i.elements[4]);t.aRotation+=n,u(i)&&(t.aStartAngle*=-1,t.aEndAngle*=-1,t.aClockwise=!t.aClockwise)}const o=t.subPaths;for(let t=0,e=o.length;t<e;t++){const e=o[t].curves;for(let t=0;t<e.length;t++){const o=e[t];o.isLineCurve?(s(o.v1),s(o.v2)):o.isCubicBezierCurve?(s(o.v0),s(o.v1),s(o.v2),s(o.v3)):o.isQuadraticBezierCurve?(s(o.v0),s(o.v1),s(o.v2)):o.isEllipseCurve&&(w.set(o.aX,o.aY),s(w),o.aX=w.x,o.aY=w.y,d(i)?n(o):r(o))}}}(A,k),m.push(A),A.userData={node:i,style:n});const T=i.childNodes;for(let e=0;e<T.length;e++){const i=T[e];h&&"style"!==i.nodeName&&"defs"!==i.nodeName||t(i,n)}l&&(v.pop(),v.length>0?k.copy(v[v.length-1]):k.identity())}(A.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4});return{paths:m,xml:A.documentElement}}static createShapes(t){const i=999999999,s=0,n=1,r=2,o=3,a=4,l=5,h=6,c={loc:s,t:0};function u(t,e,i,n){const o=t.x,a=e.x,l=i.x,h=n.x,u=t.y,p=e.y,f=i.y,m=n.y,g=(h-l)*(u-f)-(m-f)*(o-l),v=(m-f)*(a-o)-(h-l)*(p-u),y=g/v,b=((a-o)*(u-f)-(p-u)*(o-l))/v;if(0===v&&0!==g||y<=0||y>=1||b<0||b>1)return null;if(0===g&&0===v){for(let l=0;l<2;l++){if(d(0===l?i:n,t,e),c.loc==s){const t=0===l?i:n;return{x:t.x,y:t.y,t:c.t}}if(c.loc==r){return{x:+(o+c.t*(a-o)).toPrecision(10),y:+(u+c.t*(p-u)).toPrecision(10),t:c.t}}}return null}for(let r=0;r<2;r++)if(d(0===r?i:n,t,e),c.loc==s){const t=0===r?i:n;return{x:t.x,y:t.y,t:c.t}}return{x:+(o+y*(a-o)).toPrecision(10),y:+(u+y*(p-u)).toPrecision(10),t:y}}function d(t,e,i){const u=i.x-e.x,d=i.y-e.y,p=t.x-e.x,f=t.y-e.y,m=u*f-p*d;if(t.x===e.x&&t.y===e.y)return c.loc=s,void(c.t=0);if(t.x===i.x&&t.y===i.y)return c.loc=n,void(c.t=1);if(m<-Number.EPSILON)return void(c.loc=o);if(m>Number.EPSILON)return void(c.loc=a);if(u*p<0||d*f<0)return void(c.loc=l);if(Math.sqrt(u*u+d*d)<Math.sqrt(p*p+f*f))return void(c.loc=h);let g;g=0!==u?p/u:f/d,c.loc=r,c.t=g}function p(t,i,s){const n=new e.Vector2;i.getCenter(n);const r=[];return s.forEach((i=>{if(i.boundingBox.containsPoint(n)){const s=function(t,i){const s=[],n=[];for(let r=1;r<t.length;r++){const o=t[r-1],a=t[r];for(let t=1;t<i.length;t++){const r=u(o,a,i[t-1],i[t]);null!==r&&void 0===s.find((t=>t.t<=r.t+Number.EPSILON&&t.t>=r.t-Number.EPSILON))&&(s.push(r),n.push(new e.Vector2(r.x,r.y)))}}return n}(t,i.points);s.forEach((t=>{r.push({identifier:i.identifier,isCW:i.isCW,point:t})}))}})),r.sort(((t,e)=>t.point.x-e.point.x)),r}let f=i,m=-999999999,g=t.subPaths.map((t=>{const s=t.getPoints();let n=-999999999,r=i,o=-999999999,a=i;for(let t=0;t<s.length;t++){const e=s[t];e.y>n&&(n=e.y),e.y<r&&(r=e.y),e.x>o&&(o=e.x),e.x<a&&(a=e.x)}return m<=o&&(m=o+1),f>=a&&(f=a-1),{curves:t.curves,points:s,isCW:e.ShapeUtils.isClockWise(s),identifier:-1,boundingBox:new e.Box2(new e.Vector2(a,r),new e.Vector2(o,n))}}));g=g.filter((t=>t.points.length>1));for(let t=0;t<g.length;t++)g[t].identifier=t;const v=g.map((i=>function(t,i,s,n,r){null!=r&&""!==r||(r="nonzero");const o=new e.Vector2;t.boundingBox.getCenter(o);const a=p([new e.Vector2(s,o.y),new e.Vector2(n,o.y)],t.boundingBox,i);a.sort(((t,e)=>t.point.x-e.point.x));const l=[],h=[];a.forEach((e=>{e.identifier===t.identifier?l.push(e):h.push(e)}));const c=l[0].point.x,u=[];let d=0;for(;d<h.length&&h[d].point.x<c;)u.length>0&&u[u.length-1]===h[d].identifier?u.pop():u.push(h[d].identifier),d++;if(u.push(t.identifier),"evenodd"===r){const e=u.length%2==0,i=u[u.length-2];return{identifier:t.identifier,isHole:e,for:i}}if("nonzero"===r){let e=!0,s=null,n=null;for(let t=0;t<u.length;t++){const r=u[t];e?(n=i[r].isCW,e=!1,s=r):n!==i[r].isCW&&(n=i[r].isCW,e=!0)}return{identifier:t.identifier,isHole:e,for:s}}console.warn('fill-rule: "'+r+'" is currently not implemented.')}(i,g,f,m,t.userData?t.userData.style.fillRule:void 0))),y=[];return g.forEach((t=>{if(!v[t.identifier].isHole){const i=new e.Shape;i.curves=t.curves;const s=v.filter((e=>e.isHole&&e.for===t.identifier));s.forEach((t=>{const s=g[t.identifier],n=new e.Path;n.curves=s.curves,i.holes.push(n)})),y.push(i)}})),y}static getStrokeStyle(t,e,i,s,n){return{strokeColor:e=void 0!==e?e:"#000",strokeWidth:t=void 0!==t?t:1,strokeLineJoin:i=void 0!==i?i:"miter",strokeLineCap:s=void 0!==s?s:"butt",strokeMiterLimit:n=void 0!==n?n:4}}static pointsToStroke(t,i,s,n){const r=[],o=[],a=[];if(0===Ks.pointsToStrokeWithBuffers(t,i,s,n,r,o,a))return null;const l=new e.BufferGeometry;return l.setAttribute("position",new e.Float32BufferAttribute(r,3)),l.setAttribute("normal",new e.Float32BufferAttribute(o,3)),l.setAttribute("uv",new e.Float32BufferAttribute(a,2)),l}static pointsToStrokeWithBuffers(t,i,s,n,r,o,a,l){const h=new e.Vector2,c=new e.Vector2,u=new e.Vector2,d=new e.Vector2,p=new e.Vector2,f=new e.Vector2,m=new e.Vector2,g=new e.Vector2,v=new e.Vector2,y=new e.Vector2,b=new e.Vector2,x=new e.Vector2,O=new e.Vector2,w=new e.Vector2,S=new e.Vector2,k=new e.Vector2,A=new e.Vector2;s=void 0!==s?s:12,n=void 0!==n?n:.001,l=void 0!==l?l:0,t=function(t){let e=!1;for(let i=1,s=t.length-1;i<s;i++)if(t[i].distanceTo(t[i+1])<n){e=!0;break}if(!e)return t;const i=[];i.push(t[0]);for(let e=1,s=t.length-1;e<s;e++)t[e].distanceTo(t[e+1])>=n&&i.push(t[e]);return i.push(t[t.length-1]),i}(t);const T=t.length;if(T<2)return 0;const M=t[0].equals(t[T-1]);let P,C,_=t[0];const R=i.strokeWidth/2,E=1/(T-1);let Q,L,F,I,D=0,U=!1,z=0,N=3*l,V=2*l;B(t[0],t[1],h).multiplyScalar(R),g.copy(t[0]).sub(h),v.copy(t[0]).add(h),y.copy(g),b.copy(v);for(let e=1;e<T;e++){P=t[e],C=e===T-1?M?t[1]:void 0:t[e+1];const s=h;if(B(_,P,s),u.copy(s).multiplyScalar(R),x.copy(P).sub(u),O.copy(P).add(u),Q=D+E,L=!1,void 0!==C){B(P,C,c),u.copy(c).multiplyScalar(R),w.copy(P).sub(u),S.copy(P).add(u),F=!0,u.subVectors(C,_),s.dot(u)<0&&(F=!1),1===e&&(U=F),u.subVectors(C,P),u.normalize();const t=Math.abs(s.dot(u));if(t>Number.EPSILON){const e=R/t;u.multiplyScalar(-e),d.subVectors(P,_),p.copy(d).setLength(e).add(u),k.copy(p).negate();const s=p.length(),n=d.length();d.divideScalar(n),f.subVectors(C,P);const r=f.length();switch(f.divideScalar(r),d.dot(k)<n&&f.dot(k)<r&&(L=!0),A.copy(p).add(P),k.add(P),I=!1,L?F?(S.copy(k),O.copy(k)):(w.copy(k),x.copy(k)):j(),i.strokeLineJoin){case"bevel":G(F,L,Q);break;case"round":Z(F,L),F?X(P,x,w,Q,0):X(P,S,O,Q,1);break;default:const t=R*i.strokeMiterLimit/s;if(t<1){if("miter-clip"!==i.strokeLineJoin){G(F,L,Q);break}Z(F,L),F?(f.subVectors(A,x).multiplyScalar(t).add(x),m.subVectors(A,w).multiplyScalar(t).add(w),$(x,Q,0),$(f,Q,0),$(P,Q,.5),$(P,Q,.5),$(f,Q,0),$(m,Q,0),$(P,Q,.5),$(m,Q,0),$(w,Q,0)):(f.subVectors(A,O).multiplyScalar(t).add(O),m.subVectors(A,S).multiplyScalar(t).add(S),$(O,Q,1),$(f,Q,1),$(P,Q,.5),$(P,Q,.5),$(f,Q,1),$(m,Q,1),$(P,Q,.5),$(m,Q,1),$(S,Q,1))}else L?(F?($(v,D,1),$(g,D,0),$(A,Q,0),$(v,D,1),$(A,Q,0),$(k,Q,1)):($(v,D,1),$(g,D,0),$(A,Q,1),$(g,D,0),$(k,Q,0),$(A,Q,1)),F?w.copy(A):S.copy(A)):F?($(x,Q,0),$(A,Q,0),$(P,Q,.5),$(P,Q,.5),$(A,Q,0),$(w,Q,0)):($(O,Q,1),$(A,Q,1),$(P,Q,.5),$(P,Q,.5),$(A,Q,1),$(S,Q,1)),I=!0}}else j()}else j();M||e!==T-1||q(t[0],y,b,F,!0,D),D=Q,_=P,g.copy(w),v.copy(S)}if(M){if(L&&r){let t=A,e=k;U!==F&&(t=k,e=A),F?(I||U)&&(e.toArray(r,0),e.toArray(r,9),I&&t.toArray(r,3)):!I&&U||(e.toArray(r,3),e.toArray(r,9),I&&t.toArray(r,0))}}else q(P,x,O,F,!1,Q);return z;function B(t,e,i){return i.subVectors(e,t),i.set(-i.y,i.x).normalize()}function $(t,e,i){r&&(r[N]=t.x,r[N+1]=t.y,r[N+2]=0,o&&(o[N]=0,o[N+1]=0,o[N+2]=1),N+=3,a&&(a[V]=e,a[V+1]=i,V+=2)),z+=3}function X(t,e,i,n,r){h.copy(e).sub(t).normalize(),c.copy(i).sub(t).normalize();let o=Math.PI;const a=h.dot(c);Math.abs(a)<1&&(o=Math.abs(Math.acos(a))),o/=s,u.copy(e);for(let e=0,i=s-1;e<i;e++)d.copy(u).rotateAround(t,o),$(u,n,r),$(d,n,r),$(t,n,.5),u.copy(d);$(d,n,r),$(i,n,r),$(t,n,.5)}function j(){$(v,D,1),$(g,D,0),$(x,Q,0),$(v,D,1),$(x,Q,1),$(O,Q,0)}function G(t,e,i){e?t?($(v,D,1),$(g,D,0),$(x,Q,0),$(v,D,1),$(x,Q,0),$(k,Q,1),$(x,i,0),$(w,i,0),$(k,i,.5)):($(v,D,1),$(g,D,0),$(O,Q,1),$(g,D,0),$(k,Q,0),$(O,Q,1),$(O,i,1),$(S,i,0),$(k,i,.5)):t?($(x,i,0),$(w,i,0),$(P,i,.5)):($(O,i,1),$(S,i,0),$(P,i,.5))}function Z(t,e){e&&(t?($(v,D,1),$(g,D,0),$(x,Q,0),$(v,D,1),$(x,Q,0),$(k,Q,1),$(x,D,0),$(P,Q,.5),$(k,Q,1),$(P,Q,.5),$(w,D,0),$(k,Q,1)):($(v,D,1),$(g,D,0),$(O,Q,1),$(g,D,0),$(k,Q,0),$(O,Q,1),$(O,D,1),$(k,Q,0),$(P,Q,.5),$(P,Q,.5),$(k,Q,0),$(S,D,1)))}function q(t,e,s,n,o,a){switch(i.strokeLineCap){case"round":o?X(t,s,e,a,.5):X(t,e,s,a,.5);break;case"square":if(o)h.subVectors(e,t),c.set(h.y,-h.x),u.addVectors(h,c).add(t),d.subVectors(c,h).add(t),n?(u.toArray(r,3),d.toArray(r,0),d.toArray(r,9)):(u.toArray(r,3),u.toArray(r,9),d.toArray(r,0));else{h.subVectors(s,t),c.set(h.y,-h.x),u.addVectors(h,c).add(t),d.subVectors(c,h).add(t);const e=r.length;n?(u.toArray(r,e-3),d.toArray(r,e-6),d.toArray(r,e-12)):(u.toArray(r,e-6),d.toArray(r,e-3),d.toArray(r,e-12))}}}}}class Js extends e.Mesh{constructor(t,i={},s=null){if(super(),this.model=t,this.material=s,this.outMaterial=!!s,this.XML=new XMLSerializer,this.color=new e.Color,this.opacity=1,this.svgLoader=new Ks,this.base="http://www.w3.org/2000/svg",this.svg=document.createElementNS(this.base,"svg"),this.layerUp=1e-4,this.fill=!0,this.stroke=!0,this.size=i.size||1,!this.model)return;let n={};switch(this.model){case"angle":n={radius:5,min:90,max:90,strokeSize:.25,...i},this.fill=void 0===n.fill||n.fill,this.stroke=void 0===n.stroke||n.stroke;let t=Math.abs(n.min);this.add("path",{d:this.circle(0,0,n.radius,180,180+n.max,!0),stroke:"none",fill:"#FF0000","fill-opacity":.1}),this.add("path",{d:this.circle(0,0,n.radius,180,180+n.max,!1,!1,.3),stroke:"#FF0000","stroke-opacity":1,"stroke-width":n.strokeSize,fill:"none","stroke-linecap":"round"}),this.add("path",{d:this.circle(0,0,n.radius,180-t,180,!0),stroke:"none",fill:"#0050FF","fill-opacity":.1}),this.add("path",{d:this.circle(0,0,n.radius,180-t,180,!1,!1,.3,!0),stroke:"#0050FF","stroke-opacity":1,"stroke-width":n.strokeSize,fill:"none","stroke-linecap":"round"});break;case"needle":n={radius:5,min:90,max:90,strokeSize:.25,...i},this.fill=void 0===n.fill||n.fill,this.stroke=void 0===n.stroke||n.stroke,this.add("path",{d:this.circle(0,0,.7,0,360,!1,!0,0),stroke:"#FFFFFF","stroke-opacity":1,"stroke-width":n.strokeSize,fill:"none","stroke-linecap":"butt"}),this.add("path",{d:this.segment({x:0,y:0},{x:0,y:4.4}),stroke:"#FFFFFF","stroke-opacity":1,"stroke-width":n.strokeSize,fill:"none","stroke-linecap":"round"})}this.toMesh()}raycast(){}update(t={}){let e={};if("angle"===this.model){e={radius:5,min:-90,max:90,...t};let i=Math.abs(e.min);this.change("d",this.circle(0,0,e.radius,180,180+e.max,!0),0),this.change("d",this.circle(0,0,e.radius,180,180+e.max,!1,!1,.3),1),this.change("d",this.circle(0,0,e.radius,180-i,180,!0),2),this.change("d",this.circle(0,0,e.radius,180-i,180,!1,!1,.3,!0),3)}void 0!==t.wireframe&&(this.material.wireframe=t.wireframe),this.fill=void 0===e.fill||e.fill,this.stroke=void 0===e.stroke||e.stroke,this.toMesh()}set(t={},e){for(let i in t)e?e.setAttributeNS(null,i,t[i]):this.svg.setAttributeNS(null,i,t[i])}add(t,e={}){let i=document.createElementNS(this.base,t);this.set(e,i),this.svg.appendChild(i)}change(t,e,i){this.svg.childNodes[i].setAttributeNS(null,t,e)}getString(){return this.XML.serializeToString(this.svg)}polarToCartesian(t,e,i,s){var n=(s-90)*Math.PI/180;return{x:t+i*Math.cos(n),y:e+i*Math.sin(n)}}circle(t,e,i,s=0,n=360,r=!1,o=!1,a=0,l=!1){0===s&&360===n&&(s=1e-4,o=!0);let h=this.polarToCartesian(t,e,i,n),c=this.polarToCartesian(t,e,i,s),u=n-s<=180?"0":"1",d=["M",h.x,h.y,"A",i,i,0,u,0,c.x,c.y];if(r&&d.push("L",t,e,"L",h.x,h.y),o&&d.push("Z"),0!==a){let r=this.polarToCartesian(t,e,i-a,l?s:n),o=this.polarToCartesian(t,e,i+a,l?s:n);d.push("M",r.x,r.y,"L",o.x,o.y)}return d.join(" ")}segment(t,e){return["M",t.x,t.y,"L",e.x,e.y].join(" ")}geomColor(t,i,s=1){let n=t.attributes.position.count,r=[];for(;n--;)r.push(i.r,i.g,i.b,s);t.setAttribute("color",new e.Float32BufferAttribute(r,4))}toGeometry(){if(!this.fill&&!this.stroke)return null;let t=[],i=0,s=1,n=this.svgLoader.parse(this.getString());for(const r of n.paths){const n=r.userData.style.fill;if(this.fill&&void 0!==n&&"none"!==n){this.color.setStyle(n),s=r.userData.style.fillOpacity,s<this.opacity&&(this.opacity=s);const o=Ks.createShapes(r);for(const n of o){const r=new e.ShapeGeometry(n);if(r){this.geomColor(r,this.color,s);let n=(new e.BufferGeometry).copy(r).toNonIndexed();n.translate(0,0,-i*this.layerUp),t.push(n),i++}}}const o=r.userData.style.stroke;if(this.stroke&&void 0!==o&&"none"!==o){this.color.setStyle(o),s=r.userData.style.strokeOpacity,s<this.opacity&&(this.opacity=s);for(const e of r.subPaths){const n=Ks.pointsToStroke(e.getPoints(),r.userData.style,6);n&&(this.geomColor(n,this.color,s),n.translate(0,0,-i*this.layerUp),t.push(n),i++)}}}return t}toMesh(){let t=this.size;this.geometry&&this.geometry.dispose();let i=this.toGeometry();i?(this.geometry=yt(i),this.geometry.scale(t,-t,t),this.geometry.rotateY(Math.PI),this.geometry.rotateZ(.5*-Math.PI),this.geometry.rotateY(.5*Math.PI),this.geometry.computeBoundingSphere()):this.geometry=new e.BufferGeometry,null===this.material&&(this.material=new e.MeshBasicMaterial({vertexColors:!0,transparent:1!==this.opacity,side:e.DoubleSide}),this.material.defines={USE_COLOR_ALPHA:""})}dispose(){this.material&&!this.outMaterial&&this.material.dispose(),this.geometry&&this.geometry.dispose()}}class tn extends Ps{constructor(t={}){super(),this.type="joint",this.mode=t.mode||"hinge",this.isJoint=!0,this.mtx=new e.Matrix4,this.size=t.helperSize||.1;let i=cs.get("line");switch(this.mode){case"hinge":case"slider":let s=cs.get("svg"),n={min:-180,max:180,fill:!1,stroke:!0,wireframe:!1,size:.05};t.lm&&(n.min=t.lm[0],n.max=t.lm[1]),t.lmr&&(n.min=t.lmr[0],n.max=t.lmr[1]),this.m1=new Js("angle",n,s),this.m2=new Js("needle",n,s),this.add(this.m1),this.add(this.m2);break;default:const r=ss("joint");let o=r.clone();o.scale(this.size,this.size,this.size),this.m1=new e.LineSegments(o,i),this.add(this.m1),o=r.clone(),o.scale(.8*this.size,.8*this.size,.8*this.size),this.m2=new e.LineSegments(o,i),this.add(this.m2)}this.m1.matrixAutoUpdate=!1,this.m2.matrixAutoUpdate=!1,this.body1=null,this.body2=null,this.mat1=new e.Matrix4,this.mat2=new e.Matrix4,this.end=new e.Vector3;let s=new e.Quaternion;t.quat1&&this.mat1.makeRotationFromQuaternion(s.fromArray(t.quat1)),t.quat2&&this.mat2.makeRotationFromQuaternion(s.fromArray(t.quat2)),this.mat1.setPosition(t.pos1[0],t.pos1[1],t.pos1[2]),this.mat2.setPosition(t.pos2[0],t.pos2[1],t.pos2[2]);const n=new e.BufferGeometry;n.setAttribute("position",new e.Float32BufferAttribute([0,0,0,0,0,0],3)),n.setAttribute("color",new e.Float32BufferAttribute([1,0,0,1,0,0],3)),n.computeBoundingSphere(),this.m3=new e.LineSegments(n,i),this.add(this.m3),this.m3.matrixAutoUpdate=!1,this.pp=this.m3.geometry.attributes.position}update(){this.visible&&(this.body1?this.matrix.copy(this.body1.matrixWorld).multiply(this.mat1):this.matrix.copy(this.mat1),this.body2?this.m2.matrix.copy(this.body2.matrixWorld).multiply(this.mat2):this.m2.matrix.copy(this.mat2),this.m2.matrix.premultiply(this.matrix.clone().invert()),this.end.setFromMatrixPosition(this.m2.matrix),this.pp.setXYZ(1,this.end.x,this.end.y,this.end.z),this.pp.needsUpdate=!0,"slider"===this.mode&&(this.m1.position.copy(this.end),this.m1.updateMatrix()),this.visible||(this.visible=!0))}updateFromPhy(t,e=0){this.visible&&(this.position.fromArray(t,e),this.quaternion.fromArray(t,e+3),this.updateMatrix(),this.m2.position.fromArray(t,e+7),this.m2.quaternion.fromArray(t,e+10),this.m2.matrix.compose(this.m2.position,this.m2.quaternion,{x:1,y:1,z:1}),this.mtx.copy(this.matrix).invert().multiply(this.m2.matrix),this.mtx.decompose(this.m2.position,this.m2.quaternion,{x:1,y:1,z:1}),this.m2.updateMatrix(),this.pp.setXYZ(1,this.m2.position.x,this.m2.position.y,this.m2.position.z),this.pp.needsUpdate=!0,"slider"===this.mode&&(this.m1.position.copy(this.m2.position),this.m1.updateMatrix()),this.visible||(this.visible=!0))}dispose(){this.body1&&this.body1.link--,this.body2&&this.body2.link--,this.m1.geometry.dispose(),this.m2.geometry.dispose(),this.m3.geometry.dispose(),this.children=[]}}class en extends ds{constructor(){super(),this.Utils=Yi,this.type="joint",this.v1=new e.Vector3,this.v2=new e.Vector3}step(){const t=Hi.Ar,e=Hi.ArPos[this.type];let i,s,n=this.list.length;for(;n--;)i=this.list[n],s=e+n*qi.joint,16===qi.joint?i.updateFromPhy(t,s):i.update()}add(t={}){let i,s=this.setName(t),n=null,r=null;t.limit?t.lm=t.limit:t.lm&&(t.limit=t.lm),t.b1&&(i="string"==typeof t.b1,n=i?Yi.byName(t.b1):t.b1,i||(t.b1=t.b1.name),n&&n.link++),t.b2&&(i="string"==typeof t.b2,r=i?Yi.byName(t.b2):t.b2,i||(t.b2=t.b2.name),r&&r.link++),t.worldPos&&(t.worldAnchor=t.worldPos),t.worldAnchor&&(this.v1.fromArray(t.worldAnchor),this.v2.fromArray(t.worldAnchor),t.pos1=n?Yi.toLocal(this.v1,n).toArray():t.worldAnchor,t.pos2=r?Yi.toLocal(this.v2,r).toArray():t.worldAnchor,delete t.worldAnchor),t.worldAxis&&(this.v1.fromArray(t.worldAxis),this.v2.fromArray(t.worldAxis),t.axis1=n?Yi.toLocal(this.v1,n,!0).toArray():t.worldAxis,t.axis2=r?Yi.toLocal(this.v2,r,!0).toArray():t.worldAxis,delete t.worldAxis),t.worldQuat&&(t.quat1=Yi.quatLocal(t.worldQuat,n),t.quat2=Yi.quatLocal(t.worldQuat,r),"OIMO"!==Hi.engine&&"HAVOK"!==Hi.engine||(t.axis1=Yi.axisLocal(Ni.quatToAxis(t.worldQuat),n),t.axis2=Yi.axisLocal(Ni.quatToAxis(t.worldQuat),r)),delete t.worldQuat),t.axis1||(t.axis1=[1,0,0]),t.axis2||(t.axis2=[1,0,0]),t.pos1||(t.pos1=[0,0,0]),t.pos2||(t.pos2=[0,0,0]),void 0!==t.rot1&&(t.quat1=Ni.quatFromEuler(t.rot1),delete t.rot1),void 0!==t.rot2&&(t.quat2=Ni.quatFromEuler(t.rot2),delete t.rot2),t.quat1||(t.quat1=(new e.Quaternion).setFromUnitVectors(new e.Vector3(1,0,0),(new e.Vector3).fromArray(t.axis1).normalize()).toArray()),t.quat2||(t.quat2=(new e.Quaternion).setFromUnitVectors(new e.Vector3(1,0,0),(new e.Vector3).fromArray(t.axis2).normalize()).toArray()),t.drivePosition&&void 0!==t.drivePosition.rot&&(t.drivePosition.quat=Ni.quatFromEuler(t.drivePosition.rot),delete t.drivePosition.rot);let o=new tn(t);return o.name=s,o.body1=n,o.body2=r,void 0===t.visible&&(t.visible=Hi.jointVisible||!1),this.set(t,o),this.addToWorld(o,t.id),Hi.post({m:"add",o:t}),o}set(t={},e=null){null===e&&(e=this.byName(t.name)),null!==e&&void 0!==t.visible&&(e.visible=t.visible)}}class sn extends ds{constructor(){super(),this.Utils=Yi,this.type="contact"}step(){const t=Hi.Ar,e=Hi.ArPos[this.type];let i,s,n=this.list.length;for(;n--;)i=this.list[n],s=e+n*qi.contact,i.update(t,s)}add(t={}){this.setName(t);let e=new nn(t);return t.callback&&delete t.callback,this.addToWorld(e,t.id),Hi.post({m:"add",o:t}),e}}class nn{constructor(t={}){this.type="contact",this.name=t.name,this.callback=t.callback||function(){},this.b1=t.b1||null,this.b2=t.b2||null,this.ignore=t.ignore||[],this.always=void 0===t.always||t.always,this.simple=t.simple||!1,this.data={hit:!1,point:[0,0,0],normal:[0,0,0]}}update(t,e=0){this.data.hit=t[e]>0,this.simple||(this.data.point=[t[e+1],t[e+2],t[e+3]],this.data.normal=[t[e+4],t[e+5],t[e+6]]),(this.data.hit||this.always)&&this.callback(this.data)}}class rn extends ds{constructor(){super(),this.Utils=Yi,this.type="vehicle",this.num=qi[this.type]}step(){const t=Hi.Ar,e=Hi.ArPos[this.type];let i,s,n=this.list.length;for(;n--;)s=this.list[n],i=e+n*this.num,s.step(t,i)}add(t={}){this.setName(t);const e=new on(t);return this.addToWorld(e,t.id),Hi.post({m:"add",o:e.o}),e}set(t={},e=null){null===e&&(e=this.byName(t.name))}}class on extends Ps{constructor(t){super(),t.extra&&(this.extra=t.extra,delete t.extra),this.type="vehicle",this.name=t.name||"car",this.isRay=t.ray||!1,this.actif=!1,this.steering=0,this.suspension=[],this.rolling=[],this.init(t)}drive(){}raycast(){}init(t){this.mass=t.mass||2e3,this.model=null,this.size=t.size||[1.7,1,5],this.massCenter=t.massCenter||[0,.55,1.594],this.chassisPos=t.chassisPos||[0,.83,0],this.maxSteering=t.maxSteering||24,this.incSteering=t.incSteering||2,this.s_travel=t.s_travel||.4,this.s_ratio=1/(.5*this.s_travel),this.decaly="PHYSX"===Hi.engine?.5*this.s_travel:0,this.numWheel=t.numWheel||4,this.radius=t.radius||.35,this.radiusBack=t.radiusBack||this.radius,this.deep=t.deep||.3,this.deepBack=t.deepBack||this.deep;let e=this.numWheel<4?1:2;if(t.wPos||(t.wPos=[.8,.1,1.4]),t.wPos){this.wPos=t.wPos;var i,s,n,r,o,a,l=t.wPos,h=[],c=1,u=0;l.length,l.length;for(let t=0;t<this.numWheel;t++)c=t%2==0?-1:1,s=Math.floor(.5*t),u=t>=e,0===(n=l[1])&&(n=u?this.radiusBack:this.radius),(r=l[0])instanceof Array&&(r=l[0][s]),o=u?-l[2]:l[2],l[2]instanceof Array&&(o=l[2][s]),i=[r*c,n,o],h.push(i);this.wheelsPosition=h,delete t.wPos}t.wheelsPosition&&(this.wheelsPosition=t.wheelsPosition);const d=t.meshScale||1,p=[];t.chassisShape?p.push({type:"convex",shape:t.chassisShape,size:[d],pos:this.chassisPos,filter:[1,-1,0,0],isExclusive:!0,ray:this.isRay}):p.push({type:"box",size:this.size,pos:this.chassisPos});for(let i=0;i<this.numWheel;i++)i<e?p.push({type:"cylinder",size:[this.radius,this.deep],isWheel:!0,radius:t.rad||.05,shadow:!1,ray:!1}):p.push({type:"cylinder",size:[this.radiusBack,this.deepBack],isWheel:!0,radius:t.rad||.05,shadow:!1,ray:!1});var f=cs.get(t.debug?"debug":void 0===t.chassisMesh?"body":"hide");let m,g;for(let t=0;t<p.length;t++)m=p[t],m.pos&&(m.localPos=m.pos),m.size=Ni.autoSize(m.size,m.type),Hi.items.body.geometry(m,this,f);if(t.chassisMesh&&(g=t.noClone?t.chassisMesh:t.chassisMesh.clone(),g.position.set(0,0,0),Yi.noRay(g),g.scale.set(d,d,d),this.children[0].add(g),this.model=g,delete t.chassisMesh),t.wheelMesh){for(let i=1;i<this.numWheel+1;i++)u=i>=e+1,g=t.wheelMeshBack&&u?t.wheelMeshBack.clone():t.wheelMesh.clone(),Yi.noRay(g),g.position.set(0,0,0),2==i||4==i?g.scale.set(-d,d,d):g.scale.set(d,d,d),this.children[i].add(g);delete t.wheelMesh}if(t.suspensionMesh){this.suspensionMesh=[];for(let e=1;e<this.numWheel+1;e++)g=t.suspensionMesh.clone(),Yi.noRay(g),g.position.set(0,0,0),g.position.fromArray(this.wheelsPosition[e-1]),g.position.x=0,2==e||4==e?g.scale.set(d,d,d):g.scale.set(-d,d,d),this.children[0].add(g),this.suspensionMesh.push(g);delete t.suspensionMesh}if(t.brakeMesh){this.brake=[];for(let e=1;e<this.numWheel+1;e++)u=e>2,g=t.brakeMeshBack&&u?t.brakeMeshBack.clone():t.brakeMesh.clone(),Yi.noRay(g),g.position.set(0,0,0),g.position.fromArray(this.wheelsPosition[e-1]),a=t.brakeMeshBack||u?d:-d,2==e||4==e?g.scale.set(-d,d,a):g.scale.set(d,d,a),this.children[0].add(g),this.brake.push(g);delete t.brakeMesh}t.mass=this.mass,t.size=t.chassisShape?p[0].boxSize:this.size,t.numWheel=this.numWheel,t.wheelsPosition=this.wheelsPosition,t.radius=this.radius,t.radiusBack=this.radiusBack,t.deep=this.deep,t.deepBack=this.deepBack,t.chassisShape=p[0],t.maxSteering=this.maxSteering,t.incSteering=this.incSteering,t.s_travel=this.s_travel,t.massCenter=this.massCenter,t.chassisPos=this.chassisPos,this.o=t}respawn(t){(t=t||{}).respawn=!0,t.name=this.name,t.keepRotation&&(t.quat=this.quaternion.toArray()),Hi.motor.change(t)}move(){}dispose(){}step(t,e){if(!this.actif){if(0===t[e+0]+t[e+1]+t[e+2]+t[e+3]+t[e+4]+t[e+5]+t[e+6]+t[e+7])return;this.actif=!0}this.position.fromArray(t,e+1),this.quaternion.fromArray(t,e+4),this.updateMatrix();let i,s=this.numWheel+1,n=0,r=0,o=[],a=0;for(let l=0;l<s;l++)a=8*l+e,0===l&&(t[a],this.circum),1===l&&(n=t[a]),2===l&&(r=t[a]),i=this.children[l],i&&l>0&&(o[l-1]=this.wheelsPosition[l-1][1]-this.decaly-t[a+2],i.position.fromArray(t,a+1),i.quaternion.fromArray(t,a+4),this.rolling[l-1]=i.rotation.x,this.brake&&(this.brake[l-1].position.copy(i.position),1!=l&&2!=l||(this.brake[l-1].rotation.y=t[a])));for(a=4;a--;)this.suspension[a]=Ni.clamp(o[a]*this.s_ratio,-1,1),this.suspensionMesh&&(this.suspension[a]>0?(Yi.morph(this.suspensionMesh[a].children[0],"low",this.suspension[a]),Yi.morph(this.suspensionMesh[a].children[0],"top",0)):(Yi.morph(this.suspensionMesh[a].children[0],"low",0),Yi.morph(this.suspensionMesh[a].children[0],"top",-this.suspension[a])));this.steering=Math.round(.5*(n+r)*Di)/this.maxSteering}}const an={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class ln{constructor(){this.pluginCallbacks=[],this.register((function(t){return new Bn(t)})),this.register((function(t){return new $n(t)})),this.register((function(t){return new Gn(t)})),this.register((function(t){return new Zn(t)})),this.register((function(t){return new qn(t)})),this.register((function(t){return new Wn(t)})),this.register((function(t){return new Xn(t)})),this.register((function(t){return new jn(t)})),this.register((function(t){return new Hn(t)})),this.register((function(t){return new Yn(t)}))}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,s){const n=new Vn,r=[];for(let t=0,e=this.pluginCallbacks.length;t<e;t++)r.push(this.pluginCallbacks[t](n));n.setPlugins(r),n.write(t,e,s).catch(i)}parseAsync(t,e){const i=this;return new Promise((function(s,n){i.parse(t,s,n,e)}))}}const hn=0,cn=1,un=2,dn=3,pn=4,fn=5120,mn=5121,gn=5122,vn=5123,yn=5124,bn=5125,xn=5126,On=34962,wn=34963,Sn=9728,kn=9729,An=9984,Tn=9985,Mn=9986,Pn=9987,Cn=33071,_n=33648,Rn=10497,En="KHR_mesh_quantization",Qn={};Qn[e.NearestFilter]=Sn,Qn[e.NearestMipmapNearestFilter]=An,Qn[e.NearestMipmapLinearFilter]=Mn,Qn[e.LinearFilter]=kn,Qn[e.LinearMipmapNearestFilter]=Tn,Qn[e.LinearMipmapLinearFilter]=Pn,Qn[e.ClampToEdgeWrapping]=Cn,Qn[e.RepeatWrapping]=Rn,Qn[e.MirroredRepeatWrapping]=_n;const Ln={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Fn=new e.Color;function In(t,e){return t.length===e.length&&t.every((function(t,i){return t===e[i]}))}function Dn(t){return 4*Math.ceil(t/4)}function Un(t,e=0){const i=Dn(t.byteLength);if(i!==t.byteLength){const s=new Uint8Array(i);if(s.set(new Uint8Array(t)),0!==e)for(let n=t.byteLength;n<i;n++)s[n]=e;return s.buffer}return t}function zn(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function Nn(t,e){if(void 0!==t.toBlob)return new Promise((i=>t.toBlob(i,e)));let i;return"image/jpeg"===e?i=.92:"image/webp"===e&&(i=.8),t.convertToBlob({type:e,quality:i})}class Vn{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(t){this.plugins=t}async write(t,e,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(t),await Promise.all(this.pending);const s=this,n=s.buffers,r=s.json;i=s.options;const o=s.extensionsUsed,a=s.extensionsRequired,l=new Blob(n,{type:"application/octet-stream"}),h=Object.keys(o),c=Object.keys(a);if(h.length>0&&(r.extensionsUsed=h),c.length>0&&(r.extensionsRequired=c),r.buffers&&r.buffers.length>0&&(r.buffers[0].byteLength=l.size),!0===i.binary){const t=new FileReader;t.readAsArrayBuffer(l),t.onloadend=function(){const i=Un(t.result),s=new DataView(new ArrayBuffer(8));s.setUint32(0,i.byteLength,!0),s.setUint32(4,5130562,!0);const n=Un((o=JSON.stringify(r),(new TextEncoder).encode(o).buffer),32);var o;const a=new DataView(new ArrayBuffer(8));a.setUint32(0,n.byteLength,!0),a.setUint32(4,1313821514,!0);const l=new ArrayBuffer(12),h=new DataView(l);h.setUint32(0,1179937895,!0),h.setUint32(4,2,!0);const c=12+a.byteLength+n.byteLength+s.byteLength+i.byteLength;h.setUint32(8,c,!0);const u=new Blob([l,a,n,s,i],{type:"application/octet-stream"}),d=new FileReader;d.readAsArrayBuffer(u),d.onloadend=function(){e(d.result)}}}else if(r.buffers&&r.buffers.length>0){const t=new FileReader;t.readAsDataURL(l),t.onloadend=function(){const i=t.result;r.buffers[0].uri=i,e(r)}}else e(r)}serializeUserData(t,e){if(0===Object.keys(t.userData).length)return;const i=this.options,s=this.extensionsUsed;try{const n=JSON.parse(JSON.stringify(t.userData));if(i.includeCustomExtensions&&n.gltfExtensions){void 0===e.extensions&&(e.extensions={});for(const t in n.gltfExtensions)e.extensions[t]=n.gltfExtensions[t],s[t]=!0;delete n.gltfExtensions}Object.keys(n).length>0&&(e.extras=n)}catch(e){console.warn("THREE.GLTFExporter: userData of '"+t.name+"' won't be serialized because of JSON.stringify error - "+e.message)}}getUID(t,e=!1){if(!1===this.uids.has(t)){const e=new Map;e.set(!0,this.uid++),e.set(!1,this.uid++),this.uids.set(t,e)}return this.uids.get(t).get(e)}isNormalizedNormalAttribute(t){if(this.cache.attributesNormalized.has(t))return!1;const i=new e.Vector3;for(let e=0,s=t.count;e<s;e++)if(Math.abs(i.fromBufferAttribute(t,e).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(t){const i=this.cache;if(i.attributesNormalized.has(t))return i.attributesNormalized.get(t);const s=t.clone(),n=new e.Vector3;for(let t=0,e=s.count;t<e;t++)n.fromBufferAttribute(s,t),0===n.x&&0===n.y&&0===n.z?n.setX(1):n.normalize(),s.setXYZ(t,n.x,n.y,n.z);return i.attributesNormalized.set(t,s),s}applyTextureTransform(t,e){let i=!1;const s={};0===e.offset.x&&0===e.offset.y||(s.offset=e.offset.toArray(),i=!0),0!==e.rotation&&(s.rotation=e.rotation,i=!0),1===e.repeat.x&&1===e.repeat.y||(s.scale=e.repeat.toArray(),i=!0),i&&(t.extensions=t.extensions||{},t.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(t,i){if(t===i)return t;function s(t){return t.encoding===e.sRGBEncoding?function(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}:function(t){return t}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const n=t?t.image:null,r=i?i.image:null,o=Math.max(n?n.width:0,r?r.width:0),a=Math.max(n?n.height:0,r?r.height:0),l=zn();l.width=o,l.height=a;const h=l.getContext("2d");h.fillStyle="#00ffff",h.fillRect(0,0,o,a);const c=h.getImageData(0,0,o,a);if(n){h.drawImage(n,0,0,o,a);const e=s(t),i=h.getImageData(0,0,o,a).data;for(let t=2;t<i.length;t+=4)c.data[t]=256*e(i[t]/256)}if(r){h.drawImage(r,0,0,o,a);const t=s(i),e=h.getImageData(0,0,o,a).data;for(let i=1;i<e.length;i+=4)c.data[i]=256*t(e[i]/256)}h.putImageData(c,0,0);const u=(t||i).clone();return u.source=new e.Source(l),u.encoding=e.LinearEncoding,u}processBuffer(t){const e=this.json,i=this.buffers;return e.buffers||(e.buffers=[{byteLength:0}]),i.push(t),0}processBufferView(t,i,s,n,r){const o=this.json;let a;switch(o.bufferViews||(o.bufferViews=[]),i){case fn:case mn:a=1;break;case gn:case vn:a=2;break;default:a=4}const l=Dn(n*t.itemSize*a),h=new DataView(new ArrayBuffer(l));let c=0;for(let r=s;r<s+n;r++)for(let s=0;s<t.itemSize;s++){let n;t.itemSize>4?n=t.array[r*t.itemSize+s]:(0===s?n=t.getX(r):1===s?n=t.getY(r):2===s?n=t.getZ(r):3===s&&(n=t.getW(r)),!0===t.normalized&&(n=e.MathUtils.normalize(n,t.array))),i===xn?h.setFloat32(c,n,!0):i===yn?h.setInt32(c,n,!0):i===bn?h.setUint32(c,n,!0):i===gn?h.setInt16(c,n,!0):i===vn?h.setUint16(c,n,!0):i===fn?h.setInt8(c,n):i===mn&&h.setUint8(c,n),c+=a}const u={buffer:this.processBuffer(h.buffer),byteOffset:this.byteOffset,byteLength:l};void 0!==r&&(u.target=r),r===On&&(u.byteStride=t.itemSize*a),this.byteOffset+=l,o.bufferViews.push(u);return{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(t){const e=this,i=e.json;return i.bufferViews||(i.bufferViews=[]),new Promise((function(s){const n=new FileReader;n.readAsArrayBuffer(t),n.onloadend=function(){const t=Un(n.result),r={buffer:e.processBuffer(t),byteOffset:e.byteOffset,byteLength:t.byteLength};e.byteOffset+=t.byteLength,s(i.bufferViews.push(r)-1)}}))}processAccessor(t,i,s,n){const r=this.json;let o;if(t.array.constructor===Float32Array)o=xn;else if(t.array.constructor===Int32Array)o=yn;else if(t.array.constructor===Uint32Array)o=bn;else if(t.array.constructor===Int16Array)o=gn;else if(t.array.constructor===Uint16Array)o=vn;else if(t.array.constructor===Int8Array)o=fn;else{if(t.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");o=mn}if(void 0===s&&(s=0),void 0===n&&(n=t.count),0===n)return null;const a=function(t,i,s){const n={min:new Array(t.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(t.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let r=i;r<i+s;r++)for(let i=0;i<t.itemSize;i++){let s;t.itemSize>4?s=t.array[r*t.itemSize+i]:(0===i?s=t.getX(r):1===i?s=t.getY(r):2===i?s=t.getZ(r):3===i&&(s=t.getW(r)),!0===t.normalized&&(s=e.MathUtils.normalize(s,t.array))),n.min[i]=Math.min(n.min[i],s),n.max[i]=Math.max(n.max[i],s)}return n}(t,s,n);let l;void 0!==i&&(l=t===i.index?wn:On);const h=this.processBufferView(t,o,s,n,l),c={bufferView:h.id,byteOffset:h.byteOffset,componentType:o,count:n,max:a.max,min:a.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[t.itemSize]};return!0===t.normalized&&(c.normalized=!0),r.accessors||(r.accessors=[]),r.accessors.push(c)-1}processImage(t,i,s,n="image/png"){if(null!==t){const r=this,o=r.cache,a=r.json,l=r.options,h=r.pending;o.images.has(t)||o.images.set(t,{});const c=o.images.get(t),u=n+":flipY/"+s.toString();if(void 0!==c[u])return c[u];a.images||(a.images=[]);const d={mimeType:n},p=zn();p.width=Math.min(t.width,l.maxTextureSize),p.height=Math.min(t.height,l.maxTextureSize);const f=p.getContext("2d");if(!0===s&&(f.translate(0,p.height),f.scale(1,-1)),void 0!==t.data){i!==e.RGBAFormat&&console.error("GLTFExporter: Only RGBAFormat is supported."),(t.width>l.maxTextureSize||t.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",t);const s=new Uint8ClampedArray(t.height*t.width*4);for(let e=0;e<s.length;e+=4)s[e+0]=t.data[e+0],s[e+1]=t.data[e+1],s[e+2]=t.data[e+2],s[e+3]=t.data[e+3];f.putImageData(new ImageData(s,t.width,t.height),0,0)}else f.drawImage(t,0,0,p.width,p.height);!0===l.binary?h.push(Nn(p,n).then((t=>r.processBufferViewImage(t))).then((t=>{d.bufferView=t}))):void 0!==p.toDataURL?d.uri=p.toDataURL(n):h.push(Nn(p,n).then((t=>(new FileReader).readAsDataURL(t))).then((t=>{d.uri=t})));const m=a.images.push(d)-1;return c[u]=m,m}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(t){const e=this.json;e.samplers||(e.samplers=[]);const i={magFilter:Qn[t.magFilter],minFilter:Qn[t.minFilter],wrapS:Qn[t.wrapS],wrapT:Qn[t.wrapT]};return e.samplers.push(i)-1}processTexture(t){const e=this.cache,i=this.json;if(e.textures.has(t))return e.textures.get(t);i.textures||(i.textures=[]);let s=t.userData.mimeType;"image/webp"===s&&(s="image/png");const n={sampler:this.processSampler(t),source:this.processImage(t.image,t.format,t.flipY,s)};t.name&&(n.name=t.name),this._invokeAll((function(e){e.writeTexture&&e.writeTexture(t,n)}));const r=i.textures.push(n)-1;return e.textures.set(t,r),r}processMaterial(t){const i=this.cache,s=this.json;if(i.materials.has(t))return i.materials.get(t);if(t.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);const n={pbrMetallicRoughness:{}};!0!==t.isMeshStandardMaterial&&!0!==t.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const r=t.color.toArray().concat([t.opacity]);if(In(r,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=r),t.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=t.metalness,n.pbrMetallicRoughness.roughnessFactor=t.roughness):(n.pbrMetallicRoughness.metallicFactor=.5,n.pbrMetallicRoughness.roughnessFactor=.5),t.metalnessMap||t.roughnessMap){const e=this.buildMetalRoughTexture(t.metalnessMap,t.roughnessMap),i={index:this.processTexture(e)};this.applyTextureTransform(i,e),n.pbrMetallicRoughness.metallicRoughnessTexture=i}if(t.map){const e={index:this.processTexture(t.map)};this.applyTextureTransform(e,t.map),n.pbrMetallicRoughness.baseColorTexture=e}if(t.emissive){const e=t.emissive;if(Math.max(e.r,e.g,e.b)>0&&(n.emissiveFactor=t.emissive.toArray()),t.emissiveMap){const e={index:this.processTexture(t.emissiveMap)};this.applyTextureTransform(e,t.emissiveMap),n.emissiveTexture=e}}if(t.normalMap){const e={index:this.processTexture(t.normalMap)};t.normalScale&&1!==t.normalScale.x&&(e.scale=t.normalScale.x),this.applyTextureTransform(e,t.normalMap),n.normalTexture=e}if(t.aoMap){const e={index:this.processTexture(t.aoMap),texCoord:1};1!==t.aoMapIntensity&&(e.strength=t.aoMapIntensity),this.applyTextureTransform(e,t.aoMap),n.occlusionTexture=e}t.transparent?n.alphaMode="BLEND":t.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=t.alphaTest),t.side===e.DoubleSide&&(n.doubleSided=!0),""!==t.name&&(n.name=t.name),this.serializeUserData(t,n),this._invokeAll((function(e){e.writeMaterial&&e.writeMaterial(t,n)}));const o=s.materials.push(n)-1;return i.materials.set(t,o),o}processMesh(t){const i=this.cache,s=this.json,n=[t.geometry.uuid];if(Array.isArray(t.material))for(let e=0,i=t.material.length;e<i;e++)n.push(t.material[e].uuid);else n.push(t.material.uuid);const r=n.join(":");if(i.meshes.has(r))return i.meshes.get(r);const o=t.geometry;let a;a=t.isLineSegments?cn:t.isLineLoop?un:t.isLine?dn:t.isPoints?hn:t.material.wireframe?cn:pn;const l={},h={},c=[],u=[],d={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},p=o.getAttribute("normal");void 0===p||this.isNormalizedNormalAttribute(p)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(p)));let f=null;for(let t in o.attributes){if("morph"===t.slice(0,5))continue;const s=o.attributes[t];t=d[t]||t.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(t)||(t="_"+t),i.attributes.has(this.getUID(s))){h[t]=i.attributes.get(this.getUID(s));continue}f=null;const n=s.array;"JOINTS_0"!==t||n instanceof Uint16Array||n instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),f=new e.BufferAttribute(new Uint16Array(n),s.itemSize,s.normalized));const r=this.processAccessor(f||s,o);null!==r&&(t.startsWith("_")||this.detectMeshQuantization(t,s),h[t]=r,i.attributes.set(this.getUID(s),r))}if(void 0!==p&&o.setAttribute("normal",p),0===Object.keys(h).length)return null;if(void 0!==t.morphTargetInfluences&&t.morphTargetInfluences.length>0){const e=[],s=[],n={};if(void 0!==t.morphTargetDictionary)for(const e in t.morphTargetDictionary)n[t.morphTargetDictionary[e]]=e;for(let r=0;r<t.morphTargetInfluences.length;++r){const a={};let l=!1;for(const t in o.morphAttributes){if("position"!==t&&"normal"!==t){l||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),l=!0);continue}const e=o.morphAttributes[t][r],s=t.toUpperCase(),n=o.attributes[t];if(i.attributes.has(this.getUID(e,!0))){a[s]=i.attributes.get(this.getUID(e,!0));continue}const h=e.clone();if(!o.morphTargetsRelative)for(let t=0,i=e.count;t<i;t++)for(let i=0;i<e.itemSize;i++)0===i&&h.setX(t,e.getX(t)-n.getX(t)),1===i&&h.setY(t,e.getY(t)-n.getY(t)),2===i&&h.setZ(t,e.getZ(t)-n.getZ(t)),3===i&&h.setW(t,e.getW(t)-n.getW(t));a[s]=this.processAccessor(h,o),i.attributes.set(this.getUID(n,!0),a[s])}u.push(a),e.push(t.morphTargetInfluences[r]),void 0!==t.morphTargetDictionary&&s.push(n[r])}l.weights=e,s.length>0&&(l.extras={},l.extras.targetNames=s)}const m=Array.isArray(t.material);if(m&&0===o.groups.length)return null;const g=m?t.material:[t.material],v=m?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let t=0,e=v.length;t<e;t++){const e={mode:a,attributes:h};if(this.serializeUserData(o,e),u.length>0&&(e.targets=u),null!==o.index){let s=this.getUID(o.index);void 0===v[t].start&&void 0===v[t].count||(s+=":"+v[t].start+":"+v[t].count),i.attributes.has(s)?e.indices=i.attributes.get(s):(e.indices=this.processAccessor(o.index,o,v[t].start,v[t].count),i.attributes.set(s,e.indices)),null===e.indices&&delete e.indices}const s=this.processMaterial(g[v[t].materialIndex]);null!==s&&(e.material=s),c.push(e)}l.primitives=c,s.meshes||(s.meshes=[]),this._invokeAll((function(e){e.writeMesh&&e.writeMesh(t,l)}));const y=s.meshes.push(l)-1;return i.meshes.set(r,y),y}detectMeshQuantization(t,e){if(this.extensionsUsed[En])return;let i;switch(e.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}e.normalized&&(i+=" normalized");const s=t.split("_",1)[0];an[s]&&an[s].includes(i)&&(this.extensionsUsed[En]=!0,this.extensionsRequired[En]=!0)}processCamera(t){const i=this.json;i.cameras||(i.cameras=[]);const s=t.isOrthographicCamera,n={type:s?"orthographic":"perspective"};return s?n.orthographic={xmag:2*t.right,ymag:2*t.top,zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near}:n.perspective={aspectRatio:t.aspect,yfov:e.MathUtils.degToRad(t.fov),zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near},""!==t.name&&(n.name=t.type),i.cameras.push(n)-1}processAnimation(t,i){const s=this.json,n=this.nodeMap;s.animations||(s.animations=[]);const r=(t=ln.Utils.mergeMorphTargetTracks(t.clone(),i)).tracks,o=[],a=[];for(let t=0;t<r.length;++t){const s=r[t],l=e.PropertyBinding.parseTrackName(s.name);let h=e.PropertyBinding.findNode(i,l.nodeName);const c=Ln[l.propertyName];if("bones"===l.objectName&&(h=!0===h.isSkinnedMesh?h.skeleton.getBoneByName(l.objectIndex):void 0),!h||!c)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',s.name),null;const u=1;let d,p=s.values.length/s.times.length;c===Ln.morphTargetInfluences&&(p/=h.morphTargetInfluences.length),!0===s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(d="CUBICSPLINE",p/=3):d=s.getInterpolation()===e.InterpolateDiscrete?"STEP":"LINEAR",a.push({input:this.processAccessor(new e.BufferAttribute(s.times,u)),output:this.processAccessor(new e.BufferAttribute(s.values,p)),interpolation:d}),o.push({sampler:a.length-1,target:{node:n.get(h),path:c}})}return s.animations.push({name:t.name||"clip_"+s.animations.length,samplers:a,channels:o}),s.animations.length-1}processSkin(t){const i=this.json,s=this.nodeMap,n=i.nodes[s.get(t)],r=t.skeleton;if(void 0===r)return null;const o=t.skeleton.bones[0];if(void 0===o)return null;const a=[],l=new Float32Array(16*r.bones.length),h=new e.Matrix4;for(let e=0;e<r.bones.length;++e)a.push(s.get(r.bones[e])),h.copy(r.boneInverses[e]),h.multiply(t.bindMatrix).toArray(l,16*e);void 0===i.skins&&(i.skins=[]),i.skins.push({inverseBindMatrices:this.processAccessor(new e.BufferAttribute(l,16)),joints:a,skeleton:s.get(o)});return n.skin=i.skins.length-1}processNode(t){const e=this.json,i=this.options,s=this.nodeMap;e.nodes||(e.nodes=[]);const n={};if(i.trs){const e=t.quaternion.toArray(),i=t.position.toArray(),s=t.scale.toArray();In(e,[0,0,0,1])||(n.rotation=e),In(i,[0,0,0])||(n.translation=i),In(s,[1,1,1])||(n.scale=s)}else t.matrixAutoUpdate&&t.updateMatrix(),!1===In(t.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(n.matrix=t.matrix.elements);if(""!==t.name&&(n.name=String(t.name)),this.serializeUserData(t,n),t.isMesh||t.isLine||t.isPoints){const e=this.processMesh(t);null!==e&&(n.mesh=e)}else t.isCamera&&(n.camera=this.processCamera(t));if(t.isSkinnedMesh&&this.skins.push(t),t.children.length>0){const e=[];for(let s=0,n=t.children.length;s<n;s++){const n=t.children[s];if(n.visible||!1===i.onlyVisible){const t=this.processNode(n);null!==t&&e.push(t)}}e.length>0&&(n.children=e)}this._invokeAll((function(e){e.writeNode&&e.writeNode(t,n)}));const r=e.nodes.push(n)-1;return s.set(t,r),r}processScene(t){const e=this.json,i=this.options;e.scenes||(e.scenes=[],e.scene=0);const s={};""!==t.name&&(s.name=t.name),e.scenes.push(s);const n=[];for(let e=0,s=t.children.length;e<s;e++){const s=t.children[e];if(s.visible||!1===i.onlyVisible){const t=this.processNode(s);null!==t&&n.push(t)}}n.length>0&&(s.nodes=n),this.serializeUserData(t,s)}processObjects(t){const i=new e.Scene;i.name="AuxScene";for(let e=0;e<t.length;e++)i.children.push(t[e]);this.processScene(i)}processInput(t){const i=this.options;t=t instanceof Array?t:[t],this._invokeAll((function(e){e.beforeParse&&e.beforeParse(t)}));const s=[];for(let i=0;i<t.length;i++)t[i]instanceof e.Scene?this.processScene(t[i]):s.push(t[i]);s.length>0&&this.processObjects(s);for(let t=0;t<this.skins.length;++t)this.processSkin(this.skins[t]);for(let e=0;e<i.animations.length;++e)this.processAnimation(i.animations[e],t[0]);this._invokeAll((function(e){e.afterParse&&e.afterParse(t)}))}_invokeAll(t){for(let e=0,i=this.plugins.length;e<i;e++)t(this.plugins[e])}}class Bn{constructor(t){this.writer=t,this.name="KHR_lights_punctual"}writeNode(t,e){if(!t.isLight)return;if(!t.isDirectionalLight&&!t.isPointLight&&!t.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",t);const i=this.writer,s=i.json,n=i.extensionsUsed,r={};t.name&&(r.name=t.name),r.color=t.color.toArray(),r.intensity=t.intensity,t.isDirectionalLight?r.type="directional":t.isPointLight?(r.type="point",t.distance>0&&(r.range=t.distance)):t.isSpotLight&&(r.type="spot",t.distance>0&&(r.range=t.distance),r.spot={},r.spot.innerConeAngle=(t.penumbra-1)*t.angle*-1,r.spot.outerConeAngle=t.angle),void 0!==t.decay&&2!==t.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!t.target||t.target.parent===t&&0===t.target.position.x&&0===t.target.position.y&&-1===t.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),n[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},n[this.name]=!0);const o=s.extensions[this.name].lights;o.push(r),e.extensions=e.extensions||{},e.extensions[this.name]={light:o.length-1}}}class $n{constructor(t){this.writer=t,this.name="KHR_materials_unlit"}writeMaterial(t,e){if(!t.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;e.extensions=e.extensions||{},e.extensions[this.name]={},i[this.name]=!0,e.pbrMetallicRoughness.metallicFactor=0,e.pbrMetallicRoughness.roughnessFactor=.9}}class Xn{constructor(t){this.writer=t,this.name="KHR_materials_clearcoat"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||0===t.clearcoat)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.clearcoatFactor=t.clearcoat,t.clearcoatMap){const e={index:i.processTexture(t.clearcoatMap)};i.applyTextureTransform(e,t.clearcoatMap),n.clearcoatTexture=e}if(n.clearcoatRoughnessFactor=t.clearcoatRoughness,t.clearcoatRoughnessMap){const e={index:i.processTexture(t.clearcoatRoughnessMap)};i.applyTextureTransform(e,t.clearcoatRoughnessMap),n.clearcoatRoughnessTexture=e}if(t.clearcoatNormalMap){const e={index:i.processTexture(t.clearcoatNormalMap)};i.applyTextureTransform(e,t.clearcoatNormalMap),n.clearcoatNormalTexture=e}e.extensions=e.extensions||{},e.extensions[this.name]=n,s[this.name]=!0}}class jn{constructor(t){this.writer=t,this.name="KHR_materials_iridescence"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||0===t.iridescence)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.iridescenceFactor=t.iridescence,t.iridescenceMap){const e={index:i.processTexture(t.iridescenceMap)};i.applyTextureTransform(e,t.iridescenceMap),n.iridescenceTexture=e}if(n.iridescenceIor=t.iridescenceIOR,n.iridescenceThicknessMinimum=t.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum=t.iridescenceThicknessRange[1],t.iridescenceThicknessMap){const e={index:i.processTexture(t.iridescenceThicknessMap)};i.applyTextureTransform(e,t.iridescenceThicknessMap),n.iridescenceThicknessTexture=e}e.extensions=e.extensions||{},e.extensions[this.name]=n,s[this.name]=!0}}class Gn{constructor(t){this.writer=t,this.name="KHR_materials_transmission"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||0===t.transmission)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.transmissionFactor=t.transmission,t.transmissionMap){const e={index:i.processTexture(t.transmissionMap)};i.applyTextureTransform(e,t.transmissionMap),n.transmissionTexture=e}e.extensions=e.extensions||{},e.extensions[this.name]=n,s[this.name]=!0}}class Zn{constructor(t){this.writer=t,this.name="KHR_materials_volume"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||0===t.transmission)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.thicknessFactor=t.thickness,t.thicknessMap){const e={index:i.processTexture(t.thicknessMap)};i.applyTextureTransform(e,t.thicknessMap),n.thicknessTexture=e}n.attenuationDistance=t.attenuationDistance,n.attenuationColor=t.attenuationColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=n,s[this.name]=!0}}class qn{constructor(t){this.writer=t,this.name="KHR_materials_ior"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||1.5===t.ior)return;const i=this.writer.extensionsUsed,s={};s.ior=t.ior,e.extensions=e.extensions||{},e.extensions[this.name]=s,i[this.name]=!0}}class Wn{constructor(t){this.writer=t,this.name="KHR_materials_specular"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||1===t.specularIntensity&&t.specularColor.equals(Fn)&&!t.specularIntensityMap&&!t.specularColorTexture)return;const i=this.writer,s=i.extensionsUsed,n={};if(t.specularIntensityMap){const e={index:i.processTexture(t.specularIntensityMap)};i.applyTextureTransform(e,t.specularIntensityMap),n.specularTexture=e}if(t.specularColorMap){const e={index:i.processTexture(t.specularColorMap)};i.applyTextureTransform(e,t.specularColorMap),n.specularColorTexture=e}n.specularFactor=t.specularIntensity,n.specularColorFactor=t.specularColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=n,s[this.name]=!0}}class Hn{constructor(t){this.writer=t,this.name="KHR_materials_sheen"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||0==t.sheen)return;const i=this.writer,s=i.extensionsUsed,n={};if(t.sheenRoughnessMap){const e={index:i.processTexture(t.sheenRoughnessMap)};i.applyTextureTransform(e,t.sheenRoughnessMap),n.sheenRoughnessTexture=e}if(t.sheenColorMap){const e={index:i.processTexture(t.sheenColorMap)};i.applyTextureTransform(e,t.sheenColorMap),n.sheenColorTexture=e}n.sheenRoughnessFactor=t.sheenRoughness,n.sheenColorFactor=t.sheenColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=n,s[this.name]=!0}}class Yn{constructor(t){this.writer=t,this.name="KHR_materials_emissive_strength"}writeMaterial(t,e){if(!t.isMeshStandardMaterial||1===t.emissiveIntensity)return;const i=this.writer.extensionsUsed,s={};s.emissiveStrength=t.emissiveIntensity,e.extensions=e.extensions||{},e.extensions[this.name]=s,i[this.name]=!0}}function Kn(t){const e=new Map,i=new Map,s=t.clone();return Jn(t,s,(function(t,s){e.set(s,t),i.set(t,s)})),s.traverse((function(t){if(!t.isSkinnedMesh)return;const s=t,n=e.get(t),r=n.skeleton.bones;s.skeleton=n.skeleton.clone(),s.bindMatrix.copy(n.bindMatrix),s.skeleton.bones=r.map((function(t){return i.get(t)})),s.bind(s.skeleton,s.bindMatrix)})),s}function Jn(t,e,i){i(t,e);for(let s=0;s<t.children.length;s++)Jn(t.children[s],e.children[s],i)}ln.Utils={insertKeyframe:function(t,e){const i=.001,s=t.getValueSize(),n=new t.TimeBufferType(t.times.length+1),r=new t.ValueBufferType(t.values.length+s),o=t.createInterpolant(new t.ValueBufferType(s));let a;if(0===t.times.length){n[0]=e;for(let t=0;t<s;t++)r[t]=0;a=0}else if(e<t.times[0]){if(Math.abs(t.times[0]-e)<i)return 0;n[0]=e,n.set(t.times,1),r.set(o.evaluate(e),0),r.set(t.values,s),a=0}else if(e>t.times[t.times.length-1]){if(Math.abs(t.times[t.times.length-1]-e)<i)return t.times.length-1;n[n.length-1]=e,n.set(t.times,0),r.set(t.values,0),r.set(o.evaluate(e),t.values.length),a=n.length-1}else for(let l=0;l<t.times.length;l++){if(Math.abs(t.times[l]-e)<i)return l;if(t.times[l]<e&&t.times[l+1]>e){n.set(t.times.slice(0,l+1),0),n[l+1]=e,n.set(t.times.slice(l+1),l+2),r.set(t.values.slice(0,(l+1)*s),0),r.set(o.evaluate(e),(l+1)*s),r.set(t.values.slice((l+1)*s),(l+2)*s),a=l+1;break}}return t.times=n,t.values=r,a},mergeMorphTargetTracks:function(t,i){const s=[],n={},r=t.tracks;for(let t=0;t<r.length;++t){let o=r[t];const a=e.PropertyBinding.parseTrackName(o.name),l=e.PropertyBinding.findNode(i,a.nodeName);if("morphTargetInfluences"!==a.propertyName||void 0===a.propertyIndex){s.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(e.InterpolateLinear)}const h=l.morphTargetInfluences.length,c=l.morphTargetDictionary[a.propertyIndex];if(void 0===c)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let u;if(void 0===n[l.uuid]){u=o.clone();const t=new u.ValueBufferType(h*u.times.length);for(let e=0;e<u.times.length;e++)t[e*h+c]=u.values[e];u.name=(a.nodeName||"")+".morphTargetInfluences",u.values=t,n[l.uuid]=u,s.push(u);continue}const d=o.createInterpolant(new o.ValueBufferType(1));u=n[l.uuid];for(let t=0;t<u.times.length;t++)u.values[t*h+c]=d.evaluate(u.times[t]);for(let t=0;t<o.times.length;t++){const e=this.insertKeyframe(u,o.times[t]);u.values[e*h+c]=o.values[t]}}return t.tracks=s,t}};class tr{constructor(t,i){this.target=i||t,this.baseGeometry=t.geometry,this.geometry=this.target.geometry,this.V=[new e.Vector3,new e.Vector3,new e.Vector3],this.X=[new e.Vector4,new e.Vector4,new e.Matrix4],this.M=[new e.Vector3,new e.Vector3,new e.Vector3],this.isMorph=!!this.target.morphTargetInfluences,this.isSkin=!!this.target.isSkinnedMesh,this.init()}init(){this.geometry.attributes.position.count===this.baseGeometry.attributes.position.count?(this.length=this.baseGeometry.attributes.position.count,this.indexLength=this.baseGeometry.index.count/3,this.originEdges=new Array(this.length).fill(0),this.targetEdges=new Array(this.length).fill(0),(this.isSkin||this.isMorph)&&(this.back=new Array(3*this.length).fill(0)),this.num=new Array(this.length).fill(0),this.getEdge(this.baseGeometry,this.originEdges),this.addColor(),setTimeout(this.start.bind(this),100)):console.log("object not have same number of vertices !!")}start(){this.ready=!0,this.update()}addColor(){const t=this.geometry;let i=t.attributes.position.array.length;t.setAttribute("color",new e.Float32BufferAttribute(new Array(i).fill(0),3))}resetEdge(t){let e=t.length;for(;e--;)t[e]=0}getEdge(t,e,i=!1,s=!1){let n=t.attributes.position.array;const r=t.index.array;let o,a,l,h,c,u,d,p=this.V[0],f=this.V[1],m=this.V[2],g=0;for(s&&(n=this.getMorph()),i&&(n=this.getSkinned(n)),(i||s)&&this.resetEdge(e),o=this.indexLength;o--;)a=r[g],l=r[g+1],h=r[g+2],p.fromArray(n,3*a),f.fromArray(n,3*l),m.fromArray(n,3*h),c=p.distanceTo(f),u=p.distanceTo(m),d=f.distanceTo(m),e[a]+=.5*(c+u),e[l]+=.5*(c+d),e[h]+=.5*(u+d),g+=3}isZero(t){return 0===t.x&&0===t.y&&0===t.z}getMorph(){const t=this.target.morphTargetInfluences,e=this.geometry.morphAttributes.position,i=t.length,s=this.geometry.attributes.position.array;let n,r,o,a,l=this.geometry.attributes.position.count,h=this.M[0],c=this.M[1],u=this.M[2],d=this.geometry.morphTargetsRelative;for(r=l;r--;){for(n=3*r,c.fromArray(s,n),h.set(0,0,0),o=i;o--;)0!=t[o]&&(a=e[o].data?e[o].data.array:e[o].array,d?h.addScaledVector(u.fromArray(a,n),t[o]):h.addScaledVector(u.fromArray(a,n).sub(c),t[o]));c.add(h),c.toArray(this.back,n)}return this.back}getSkinned(t){const e=this.target.skeleton;e.boneMatrices;const i=this.geometry,s=i.attributes.skinIndex.array,n=i.attributes.skinWeight.array,r=this.target.bindMatrix,o=this.target.bindMatrixInverse;let a,l,h,c,u,d=this.V[0],p=this.V[1],f=this.V[2],m=this.X[0],g=this.X[1],v=this.X[2];for(a=i.attributes.position.count;a--;){for(u=3*a,m.fromArray(s,4*a),g.fromArray(n,4*a),d.fromArray(t,u).applyMatrix4(r),p.set(0,0,0),l=4;l--;)c=g.getComponent(l),c>0&&(h=m.getComponent(l),v.multiplyMatrices(e.bones[h].matrixWorld,e.boneInverses[h]),p.addScaledVector(f.copy(d).applyMatrix4(v),c));p.applyMatrix4(o),p.toArray(this.back,u)}return this.back}update(){if(!this.ready)return;this.getEdge(this.geometry,this.targetEdges,this.isSkin,this.isMorph);const t=this.geometry.attributes.color.array;let e,i,s,n=this.length;for(;n--;)e=this.originEdges[n],i=(e-this.targetEdges[n])/e+.5,s=3*n,t[s]=i>.5?2*(i-.5):0,t[s+1]=0,t[s+2]=i<.5?1-2*i:0;this.geometry.attributes.color.needsUpdate=!0}}class er extends e.Object3D{constructor(t,i){super(),this.isReady=!1,this.skeleton=i,this.bones=this.skeleton.bones,this.root=t,this.box=new e.BoxGeometry,this.mtxr=new e.Matrix4,this.mtx0=new e.Matrix4,this.mtx1=new e.Matrix4,this.mtx=new e.Matrix4,this.mtx2=new e.Matrix4,this.p=new e.Vector3,this.s=new e.Vector3,this.q=new e.Quaternion,this.e=new e.Euler,this.mat=new e.MeshBasicMaterial({color:13421696,wireframe:!0,toneMapped:!1}),this.init(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){if(!this.isReady)return;let e,i,s=this.children,n=s.length;for(this.mtxr.copy(this.root.matrixWorld).invert();n--;)e=s[n],i=e.userData.bone,this.mtx0.multiplyMatrices(this.mtxr,i.matrixWorld),this.mtx.multiplyMatrices(this.mtx0,e.userData.decal),this.mtx.decompose(this.p,this.q,this.s),e.position.copy(this.p),e.quaternion.copy(this.q),e.updateMatrix();super.updateMatrixWorld(t)}init(){this.mtxr.copy(this.root.matrixWorld).invert();const t=this.bones;let i,s,n,r,o,a,l,h,c,u,d,p=new e.Vector3,f=new e.Vector3,m=t.length;for(i=0;i<m;i++)h=null,r=t[i],s=r.name,o=r.parent,o&&(n=o.name,p.setFromMatrixPosition(o.matrixWorld),f.setFromMatrixPosition(r.matrixWorld),l=p.distanceTo(f),c=[0,0,.5*l],a=[l,1,1],u=[0,0,0],d="_C","head"===n&&"End_head"===s&&(h="box",a=[.16,.2,l],c=[0,.025,.5*-l]),"chest"===n&&"neck"===s&&(h="box",a=[.3,.28,l],c=[0,0,.5*-l]),"abdomen"===n&&(h="box",a=[.28,.24,l+.14],u[2]=0,c=[0,0,.5*-l],c[2]+=.07),"rThigh"===n&&(h="box",a=[.15,.15,l]),"lThigh"===n&&(h="box",a=[.15,.15,l]),"rShin"===n&&(h="box",a=[.12,.12,l+.1],c[2]+=.05),"lShin"===n&&(h="box",a=[.12,.12,l+.1],c[2]+=.05),"rShldr"===n&&(h="box",a=[l+.06,.12,.12],c[0]=.03-c[2],c[2]=0),"lShldr"===n&&(h="box",a=[l+.06,.12,.12],c[0]=c[2]-.03,c[2]=0),"rForeArm"===n&&(h="box",a=[l+.1,.1,.1],c[0]=-c[2]-.05,c[2]=0),"lForeArm"===n&&(h="box",a=[l+.1,.1,.1],c[0]=c[2]+.05,c[2]=0),null!==h&&this.addMesh(o,h,a,c,u,"_C"));this.isReady=!0}addMesh(t,i,s,n,r,o){this.mtx.makeTranslation(n[0],n[1],n[2]);var a=new e.Mesh(this.box,this.mat);a.scale.fromArray(s),a.userData.decal=this.mtx.clone(),a.userData.bone=t,a.userData.size=s,this.add(a)}dispose(){this.children=[],this.box.dispose(),this.mat.dispose(),this.isReady=!1}}const ir={mixRatio:0,threshold:.1,normal:.25,hair:10761234,bow:1049602,sheen:1,sheenRoughness:1,metalness:.6,roughness:.4,vertexColors:!1,alphaTest:.3,h_metal:.4,h_rough:.6,clearcoat:1,wireframe:!1,transparent:!1,opacity:1},sr={isBreath:!1,isEyeMove:!1,haveMorph:!1,skeletonRef:"body",fullMorph:["MUSCLE","LOW","BIG","MONSTER"],haveQuality:!0,textureRef:"avatar_c",texturePath:"assets/textures/avatar_",textures:["avatar_c.jpg","avatar_n.jpg","avatar_m.jpg","avatar_r.jpg","avatar_u.jpg","mouth_c.jpg","mouth_a.jpg","mouth_n.jpg","eye_c.jpg","eye_n.jpg","hair.jpg","hair_a.jpg","eyelash_c.jpg","eyelash_a.jpg","eyelash_n.jpg","hair_man.jpg","hair_man_a.jpg"],modelPath:"assets/models/avatar/",forceModel:null,setting:ir,materialRef:"skin",materials:{skin:{type:"Physical",map:"avatar_c",normalMap:"avatar_n",roughness:1,metalness:1,metalnessMap:"avatar_m",roughnessMap:"avatar_r",normalScale:new e.Vector2(ir.normal,-ir.normal),sheen:ir.sheen,sheenRoughness:ir.sheenRoughness,sheenColor:16777215,sheenColorMap:"avatar_u",iridescence:1,wireframe:ir.wireframe},mouth:{type:"Standard",map:"mouth_c",roughness:.6,metalness:.6,alphaMap:"mouth_a",alphaTest:.5,normalMap:"mouth_n"},sub_eye:{type:"Physical",roughness:0,metalness:1,ior:1.376,opacity:1,blending:e.AdditiveBlending,clearcoat:1,transparent:!0,envMapIntensity:0},eye:{type:"Physical",map:"eye_c",roughness:.7,metalness:.15,normalMap:"eye_n",normalScale:new e.Vector2(2,-2),clearcoat:.25},hair:{type:"Standard",map:"hair",color:ir.hair,roughness:ir.h_rough,metalness:ir.h_metal,alphaMap:"hair_a",alphaTest:ir.alphaTest,side:e.DoubleSide,opacity:1,transparent:!0,blending:e.CustomBlending,blendDst:e.ZeroFactor,blendDstAlpha:e.SrcAlphaFactor,alphaToCoverage:!0},hair_man:{type:"Standard",map:"hair_man",color:ir.hair,roughness:ir.h_rough,metalness:ir.h_metal,alphaMap:"hair_man_a",alphaTest:ir.alphaTest,side:e.DoubleSide,opacity:1,transparent:!0,blending:e.CustomBlending,blendDst:e.ZeroFactor,blendDstAlpha:e.SrcAlphaFactor,alphaToCoverage:!0},eyelash:{type:"Standard",color:ir.hair,map:"eyelash_c",roughness:ir.h_rough,metalness:ir.h_metal,alphaMap:"eyelash_a",alphaTest:ir.alphaTest,transparent:!0,opacity:1,side:e.DoubleSide,alphaToCoverage:!0,polygonOffset:!0,polygonOffsetFactor:-4},tear:{type:"Physical",map:"eyelash_c",roughness:.5,metalness:.5,alphaMap:"eyelash_a",transparent:!0,alphaToCoverage:!0,opacity:1},low:{type:"Basic",color:0,wireframe:!0}},changeMaterial:(t={},e=!1)=>{if(!Li.getMaterial(sr.materialRef))return;const i=sr.setting,s=sr.materials;let n,r=!1;for(let e in t)void 0!==i[e]&&i[e]!==t[e]&&(i[e]=t[e],r=!0);if(r)for(let i in s){n=Li.getMaterial(i);for(let r in t)void 0!==n[r]&&(e&&s[i][r]?n[r]=s[i][r]:n[r]=t[r])}},applyMaterial:(t,e)=>{const i=Li.getMaterial("skin");t.traverse((t=>{if(t.isMesh)switch(t.name){case"body":case"Head":t.material=i,t.receiveShadow=!0,t.castShadow=!0;break;case"body_low":t.material=i,t.receiveShadow=!1,t.castShadow=!1,t.visible=!1;break;case"mouth":t.material=Li.getMaterial("mouth")||i,t.receiveShadow=!1,t.castShadow=!1;break;case"eyelash":case"eyebrow":t.material=Li.getMaterial("eyelash")||i,t.receiveShadow=!1,t.castShadow=!1;break;case"tear":t.material=Li.getMaterial("tear")||i,t.receiveShadow=!1,t.castShadow=!1;break;case"eye_l":case"eye_r":t.material=Li.getMaterial("eye")||i,t.receiveShadow=!1,t.castShadow=!1;break;case"eye_l_s":case"eye_r_s":t.material=Li.getMaterial("sub_eye")||i,t.receiveShadow=!1,t.castShadow=!1;break;case"hair":t.material=Li.getMaterial("hair")||i,t.receiveShadow=!1,t.castShadow=!0,t.matrixWorldAutoUpdate=!1;break;case"hair_man":t.material=Li.getMaterial("hair_man")||i,t.receiveShadow=!1,t.castShadow=!0,t.matrixWorldAutoUpdate=!1}}))}},nr={metalness:.6,roughness:.1,clearcoat:1,wireframe:!1},rr={decalY:.02,isBreath:!1,isEyeMove:!1,haveMorph:!1,skeletonRef:"eva_SKIN",fullMorph:[],haveQuality:!1,skinRef:"eva_00",texturePath:"assets/textures/eva/",textures:["eva00_c.jpg","eva01_c.jpg","eva02_c.jpg","eva_l.jpg"],modelPath:"assets/models/",forceModel:"eva",setting:nr,materialRef:"eva00",materials:{eva00:{type:"Physical",map:"eva00_c",emissiveMap:"eva_l",emissive:16777215,roughness:nr.roughness,metalness:nr.metalness,wireframe:nr.wireframe,clearcoat:nr.clearcoat,iridescence:.5},eva01:{type:"Physical",map:"eva01_c",emissiveMap:"eva_l",emissive:16777215,roughness:nr.roughness,metalness:nr.metalness,wireframe:nr.wireframe,clearcoat:nr.clearcoat,iridescence:.5},eva02:{type:"Physical",map:"eva02_c",emissiveMap:"eva_l",emissive:16777215,roughness:nr.roughness,metalness:nr.metalness,wireframe:nr.wireframe,clearcoat:nr.clearcoat,iridescence:.5}},changeMaterial:(t,e=!1)=>{if(!Li.getMaterial(rr.materialRef))return;const i=rr.materials;let s;for(let n in i){s=Li.getMaterial(n);for(let r in t)void 0!==s[r]&&(e&&i[n][r]?s[r]=i[n][r]:s[r]=t[r]);s.needsUpdate=!0}},applyMaterial:(t,e)=>{const i=Li.getMaterial(e);t.traverse((t=>{if(t.isMesh)switch(t.material=i,t.receiveShadow=!0,t.castShadow=!0,t.name){case"eva_2_head":case"eva_2_mach":t.visible="eva02"===e;break;case"eva_L_COLLAR":case"eva_R_COLLAR":t.visible="eva00"!==e;break;case"eva_HEAD":case"eva_MACHOIR":t.visible="eva01"===e;break;case"eva_0_R_COLLAR":case"eva_0_L_COLLAR":case"eva_0_head":case"eva_0_head2":t.visible="eva00"===e;break;case"eva_0_CHEST2":t.visible="eva01"!==e}}))}},or={metalness:.2,roughness:.8,wireframe:!1},ar={decalY:-.06,isBreath:!1,isEyeMove:!1,haveMorph:!1,skeletonRef:"leeSkin",fullMorph:[],haveQuality:!1,texturePath:"assets/textures/",textures:["lee_c.jpg","lee_ao.jpg"],modelPath:"assets/models/",forceModel:"lee",setting:or,materialRef:"lee_material",materials:{lee_material:{type:"Physical",map:"lee_c",roughness:.3,metalness:.08,wireframe:or.wireframe,sheen:2.2,sheenColorMap:"lee_c",sheenColor:16777215,sheenRoughness:.4,envMapIntensity:1}},changeMaterial:(t,e=!1)=>{if(!Li.getMaterial(ar.materialRef))return;const i=ar.materials;let s;for(let n in i){s=Li.getMaterial(n);for(let r in t)void 0!==s[r]&&(e&&i[n][r]?s[r]=i[n][r]:s[r]=t[r])}},applyMaterial:(t,e)=>{const i=Li.getMaterial("lee_material");t.traverse((t=>{t.isMesh&&(t.material=i,t.receiveShadow=!0,t.castShadow=!0)}))},adjustment:()=>[{name:"lHand",values:[-60,0,0]},{name:"rHand",values:[-60,0,0]}]},lr=1/30,hr=Math.PI/180,cr=180/Math.PI,ur=new e.Vector3;class dr extends e.Group{constructor(t={}){switch(super(),this.fixWeight=void 0===t.fixWeight||t.fixWeight,this.rootPath=t.path||"./",this.lzmaPath=this.rootPath+"src/libs/lzma_worker.js",Li.dracoPath=this.rootPath+"src/libs/draco/",this.callback=t.callback||function(){},this.matrixAutoUpdate=!1,this.isPause=!0,this.textureQuality=t.quality||1,this.model=t.type||"man",this.startAnimation=t.anim||"idle",this.ref=null,this.model){case"lee":this.ref=ar;break;case"man":case"woman":this.ref=sr;break;case"eva00":case"eva01":case"eva02":this.ref=rr}this.compact=void 0===t.compact||t.compact,this.haveMorph=void 0!==t.morph&&t.morph,this.fullMaterial=void 0===t.material||t.material,this.size=t.size||1,this.fullMorph=this.ref.fullMorph,this.skeleton=null,this.mixer=null,this.mesh={},this.bones={},this.done=!1,this.isClone=!1,this.isBreath=this.ref.isBreath||!1,this.isEyeMove=this.ref.isEyeMove||!1,this.decalY=this.ref.decalY||0,this.tensionTest=!1,this.tensionActive=!1,this.fixToe=!1,this.clipsToesFix=[],this.n=Math.round(1e3*Math.random()),this.actions=new Map,this.current=null,this.old=null,this.breath=0,this.breathSide=-1,this.q=(new e.Quaternion).setFromAxisAngle({x:0,y:1,z:0},.5*Math.PI),this.headBoneLook=new e.Vector3,this.eyeTarget=new e.Group,this.eyeTarget.position.set(0,1,0),this.tmpMtx=new e.Matrix4,this.tmpQ=new e.Quaternion,this.setting={},this.root=Li.get(this.ref.forceModel?this.ref.forceModel:this.model,"O"),this.root?(this.isClone=!0,this.tensionTest=!1,this.root=Kn(this.root),this.init()):this.fullMaterial?this.load():this.loadModels()}load(){if(this.skin=Li.getTexture(this.ref.textureRef),this.skin)this.loadModels();else{const t=this.rootPath+this.ref.texturePath+(this.ref.haveQuality?this.textureQuality+"k/":"");Li.load(this.ref.textures,this.loadModels.bind(this),t,"loading images...")}}loadModels(){const t=this.ref.forceModel?this.ref.forceModel:this.model,e=[t+".glb"],i=this.rootPath+this.ref.modelPath;this.ref.haveMorph&&this.haveMorph&&e.push(t+"_morph.glb"),Li.load(e,this.init.bind(this),i,"loading models...")}update(t){if(this.done&&this.mixer){this.mixer.update(t);const e=this.n;e<=20&&this.eyeControl(.05*e),e>10&&e<=40&&this.eyeControl(1-.05*(e-20)),this.n++,1e3===this.n&&(this.n=0),this.isClone||(this.look(10*t),this.breathing(),this.autoToes()),this.tensionActive&&(this.tension1.update(),this.tension2.update()),window.gui&&this.current&&window.gui.updateTimeBarre(Math.round(30*this.current.time),this.current.frameMax)}}look(t){if(!this.isEyeMove)return;if(this.isPause)return;const e=window.mouse||{x:0,y:0};t>1&&(t=1),this.headBoneLook.lerp({x:-20*e.y*hr,y:0,z:-20*e.x*hr},t),this.eyeTarget.position.lerp({x:.5*e.x,y:1,z:.25*-e.y},t);let i=this.headBoneLook;this.tmpQ.setFromEuler({_x:i.x,_y:i.y,_z:i.z,_order:"XYZ"},!1),this.bones.head.quaternion.multiply(this.tmpQ);let s=this.bones.ER,n=this.bones.EL,r={x:0,y:0,z:1};this.tmpMtx.lookAt(n.position,this.eyeTarget.position.clone().add({x:.03,y:0,z:-.074}),r),n.quaternion.setFromRotationMatrix(this.tmpMtx).multiply(this.q),this.tmpMtx.lookAt(s.position,this.eyeTarget.position.clone().add({x:-.03,y:0,z:-.074}),r),s.quaternion.setFromRotationMatrix(this.tmpMtx).multiply(this.q)}breathing(){if(!this.bones)return;if(!this.isBreath)return;if(!this.skeleton.setScalling)return;let t=.01*this.breath;this.breathSide>0?(this.skeleton.setScalling(this.bones.chest,this.lerp(1,1.02,t),this.lerp(1,1.04,t),1),this.skeleton.setScalling(this.bones.abdomen,1,this.lerp(1,.92,t),1)):(this.skeleton.setScalling(this.bones.chest,this.lerp(1.02,1,t),this.lerp(1.04,1,t),1),this.skeleton.setScalling(this.bones.abdomen,1,this.lerp(.92,1,t),1)),this.breath++,100===this.breath&&(this.breath=0,this.breathSide=this.breathSide>0?-1:1)}setPosition(t,e,i){this.position.set(t,e,i),this.updateMatrix()}setRotation(t,e,i,s){let n=this.lerp(this.rotation.y,e,s);this.rotation.set(t,n,i),this.updateMatrix()}lerp(t,e,i){return(1-i)*t+i*e}onReady(){}initMaterial(){if(Li.getMaterial(this.ref.materialRef))return;if(!this.fullMaterial)return void Li.set(this.ref.materialRef,new e.MeshStandardMaterial);let t,i,s;for(const n in this.ref.materials){s={...this.ref.materials[n]},i=s.type,delete s.type;for(const t in s)"envMapIntensity"!==t&&("map"!==t&&-1===t.search("Map")||(s[t]=Li.getTexture(s[t])));"Basic"===i?t=new e.MeshBasicMaterial(s):"Standard"===i?t=new e.MeshStandardMaterial(s):"Physical"===i&&(t=new e.MeshPhysicalMaterial(s)),t.name=n,Li.set(n,t)}this.setting=this.ref.setting}setMaterial(t,e){this.ref.changeMaterial(t,e)}getMaterial(t){return Li.getMaterial(t)}init(){this.initMaterial(),this.isClone||(this.root=Li.get(this.ref.forceModel?this.ref.forceModel:this.model,"O"),this.ref.applyMaterial(this.root,this.model)),this.ref.forceModel&&this.isClone&&this.ref.applyMaterial(this.root,this.model),this.root.traverse(function(t){t.raycast=function(){},t.isMesh&&(t.name===this.ref.skeletonRef&&(t.matrixAutoUpdate=!1,this.skeleton=t.skeleton,this.skeleton.resetScalling&&this.skeleton.resetScalling()),this.mesh[t.name]=t),t.isBone&&(this.bones[t.name]=t)}.bind(this)),this.ref.isEyeMove&&this.bones.neck.add(this.eyeTarget);for(let t in this.mesh)this.mesh[t].isSkinnedMesh&&t!==this.ref.skeletonRef&&(this.mesh[t].skeleton.dispose(),this.mesh[t].skeleton=this.skeleton);if(this.isClone||(this.haveMorph&&Li.applyMorph(this.model+"_morph",this.mesh,!0,!1),Li.set(this.model,this.root,"O")),1!==this.size&&this.root.scale.set(1,1,1).multiplyScalar(this.size),this.mixer=new e.AnimationMixer(this),0===Li.clip.length)this.compact?this.loadCompactAnimation(this.rootPath+"assets/animation/animations.bin"):this.loadAnimationJson(this.rootPath+"assets/animation/animations.json",this.start.bind(this));else{let t=Li.clip.length;for(;t--;)this.addAction(Li.clip[t]);this.start()}}addTensionMap(){this.tension1=new tr(this.mesh.body),this.tension2=new tr(this.mesh.Head)}setBounding(t){for(let e in this.mesh)this.mesh[e].isMesh&&(this.mesh[e].geometry.boundingSphere.radius=t)}eyeControl(t){this.setMorph("EyeBlink",t)}setMorph(t,e){this.haveMorph&&(this.morpher("eyelash",t,e),this.morpher("eyebrow",t,e),this.morpher("tear",t,e),this.morpher("mouth",t,e),this.morpher("body",t,e),this.morpher("Head",t,e),this.morpher("body_low",t,e))}morpher(t,e,i){this.mesh[t]&&this.mesh[t].morphTargetInfluences&&void 0!==this.mesh[t].morphTargetDictionary[e]&&(this.mesh[t].morphTargetInfluences[this.mesh[t].morphTargetDictionary[e]]=i)}lerp(t,e,i){return(1-i)*t+i*e}clone(t){return new this.constructor({type:t.type},this)}dispose(){this.exoskel&&this.addExo(),this.helper&&this.addHelper(),this.stop(),this.mixer.uncacheRoot(this),this.remove(this.root),this.skeleton.dispose(),this.parent.remove(this),this.isClone}start(){this.done||(this.done=!0,this.add(this.root),this.onReady(),this.playAll(),this.play(this.startAnimation),this.ref.adjustment&&this.makePoseTrack("adjustment",this.ref.adjustment()),setTimeout(this.callback,10))}addHelper(){this.helper?(this.helper.dispose(),this.remove(this.helper),this.helper=null):(this.helper=new e.SkeletonHelper(this.root),this.helper.raycast=function(){},this.helper.matrix=this.root.matrix,this.add(this.helper))}addExo(){return this.exoskel?(this.exoskel.dispose(),this.remove(this.exoskel),this.exoskel=null):(this.exoskel=new er(this.root,this.skeleton),this.exoskel.matrix=this.root.matrix,this.add(this.exoskel)),this.exoskel}attachToBone(t,e){t.matrix=e.matrixWorld,t.matrixAutoUpdate=!1}loadAnimationJson(t,e){const i=new XMLHttpRequest;i.open("GET",t,!0),i.onreadystatechange=function(){if(4===i.readyState&&(200===i.status||0===i.status)){let t=JSON.parse(i.responseText);this.urls=[];for(let e in t)"main"===e?this.urls.push(...t[e]):this.urls.push(...t[e].map((t=>e+"/"+t)));this.endCallback=e||function(){},this.loadOne()}}.bind(this),i.send()}loadOne(){let t=this.urls[0];this.loadAnimationFbx(this.rootPath+"assets/animation/fbx/"+t+".fbx",this.next.bind(this))}next(){this.urls.shift(),0===this.urls.length?this.endCallback():this.loadOne()}loadCompactAnimation(t="./assets/models/animations.bin"){this.lzma||(this.lzma=new wi(this.lzmaPath));var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer";const s={animations:[]},n=this;i.onload=function(){n.lzma.decompress(new Uint8Array(i.response),(function(t){const i=JSON.parse(t);for(let t in i)s.animations.push(e.AnimationClip.parse(i[t]));n.applydAnimation(s),n.start()}))},i.send()}loadAnimationGlb(t,e){let i=t.substring(t.lastIndexOf("/")+1,t.lastIndexOf("."));Li.loaderGLTF().load(t,function(t){this.applydAnimation(t,i),e&&e()}.bind(this),null,e)}directGlb(t,e){Li.loaderGLTF().parse(t,"",function(t){this.stop(),this.applydAnimation(t,e)}.bind(this))}loadAnimationFbx(t,e){let i=t.substring(t.lastIndexOf("/")+1,t.lastIndexOf("."));Li.loaderFBX().load(t,function(t){this.convertFbx(i,t.animations[0]),e&&e()}.bind(this),null,e)}directFbx(t,e){try{let i=Li.loaderFBX().parse(t,"");this.convertFbx(e,i.animations[0],!0)}catch(t){console.error("bug",t)}}applydAnimation(t,e){let i=t.animations.length,s=!1;for(1===i&&(e&&(t.animations[0].name=e),s=!0);i--;)this.addClip(t.animations[i]),this.addAction(t.animations[i],s)}addClip(t,i=!1){i&&e.AnimationUtils.makeClipAdditive(t);let s=Li.clip.length,n=-1;for(;s--;)Li.clip[s].name===t.name&&(n=s);-1!==n&&Li.clip.slice(n,1),Li.clip.push(t)}addAction(t,e){const i=this.mixer.clipAction(t);i.frameMax=Math.round(30*t.duration),i.play(),i.enabled=!0,-1!==t.name.search("idle")&&(i.enabled=!0),"Jumping Up"===t.name&&(i.loop=LoopPingPong),this.actions.set(t.name,i),-1!==t.name.search("walk")&&this.clipsToesFix.push(t.name),-1!==t.name.search("run")&&this.clipsToesFix.push(t.name),-1!==t.name.search("strafe")&&this.clipsToesFix.push(t.name),-1!==t.name.search("jog")&&this.clipsToesFix.push(t.name),-1!==t.name.search("RUN")&&this.clipsToesFix.push(t.name),window.gui&&window.gui.getAnimation()}getAnimation(t=!1,e=!1){let i=[],s=0;if(e){let e=Li.clip.length;for(;e--;)i[s]=t?Li.clip[s].toJSON():Li.clip[s],s++}else this.actions.forEach((function(e,n){i[s]=t?e._clip.toJSON():e._clip,s++}));return i}exportAnimationLzma(t){this.lzma||(this.lzma=new wi(this.lzmaPath));const e=this.getAnimation(!0);this.lzma.compress(JSON.stringify(e),2,(function(e){if(t)t({name:"animations",data:new Uint8Array(e),type:"bin"});else{let t=document.createElement("a");t.style.display="none",document.body.appendChild(t),t.href=URL.createObjectURL(new Blob([new Uint8Array(e)],{type:"application/octet-stream"})),t.download="animations.bin",t.click()}}))}exportGLB(t){this.exporter||(this.exporter=new ln);const e=this.getAnimation();this.exporter.parse(this.root,(function(e){if(t)t({name:"model",data:e,type:"glb"});else{let t=document.createElement("a");t.style.display="none",document.body.appendChild(t),t.href=URL.createObjectURL(new Blob([e],{type:"application/octet-stream"})),t.download="model.glb",t.click()}}),null,{animations:e,binary:!0,onlyVisible:!0})}armAngle(){}autoToes(){if(!this.fixToe)return;let t=this.getRot("rFoot"),e=this.getRot("lFoot"),i=this.getWorldPos("hip"),s=this.getWorldPos("rToes"),n=this.getWorldPos("lToes");t[0]>0&&s.z-i.z<0?this.setRot("rToes",1.5*-t[0],0,0):0!==t[0]&&this.setRot("rToes",0,0,0),e[0]>0&&n.z-i.z<0?this.setRot("lToes",1.5*-e[0],0,0):0!==e[0]&&this.setRot("lToes",0,0,0)}resetToes(){this.fixToe&&(this.fixToe=!1,this.setRot("rToes",0,0,0),this.setRot("lToes",0,0,0))}convertFbx(t,i,s){const n=Math.PI/180;let r=new e.Vector3,o=new e.Quaternion,a=(new e.Quaternion).setFromAxisAngle({x:1,y:0,z:0},90*n);const l=i.tracks,h=[];let c,u,d,p,f=l.length,m=0;for(;f--;){if(d=l[m],p=d.name.substring(0,d.name.lastIndexOf(".")),"hip.position"===d.name){let t=[];for(c=d.values.length/3;c--;)u=3*c,r.set(d.values[u],d.values[u+1],0).multiplyScalar(.01),r.toArray(t,u);h.push(new e.VectorKeyframeTrack(d.name,d.times,t))}else{let t=[];for(c=d.values.length/4;c--;)u=4*c,"hip"===p?o.set(d.values[u],d.values[u+1],d.values[u+2],d.values[u+3]).multiply(a):o.set(d.values[u],d.values[u+2],-d.values[u+1],d.values[u+3]),o.toArray(t,u);h.push(new e.QuaternionKeyframeTrack(d.name,d.times,t))}m++}let g=new e.AnimationClip(t,-1,h);g.duration=i.duration,this.stop(),this.addClip(g),this.addAction(g,s)}makePoseTrack(t,i){const s=Math.PI/180;let n=new e.Quaternion;const r=i,o=[];let a,l,h,c,u=r.length,d=0;for(;u--;){c=r[u],c.name;let t=[],i=[];for(d=0,a=3;a--;)l=0,h=4*d,i.push(.03333333507180214*d),n.setFromEuler({_x:c.values[0]*s,_y:c.values[1]*s,_z:c.values[2]*s,_order:"XYZ"}),n.toArray(t,h),d++;o.push(new e.QuaternionKeyframeTrack(c.name+".quaternion",i,t))}let p=new e.AnimationClip(t,-1,o);p.duration=.10000000521540642;const f=this.mixer.clipAction(p);f.enabled=!0,f.setEffectiveTimeScale(1),f.play()}prepareCrossFade(t,e,i){this.isPause=!1,this.unPause(),"idle"!==e._clip.name?this.executeCrossFade(t,e,i):this.synchronizeCrossFade(t,e,i)}synchronizeCrossFade(t,e,i){this.mixer.addEventListener("loop",(function n(r){r.action===t&&(s.mixer.removeEventListener("loop",n),s.executeCrossFade(t,e,i))}));const s=this}executeCrossFade(t,e,i,s=!0){this.setWeight(e,1),e.time=0,t.crossFadeTo(e,i,!0)}pause(){this.actions.forEach((function(t){t.paused=!0})),this.isPause=!0}unPause(){this.actions.forEach((function(t){t.paused=!1})),this.isPause=!1}playAll(){this.actions.forEach((function(t){t.play()}))}setTimescale(t){this.actions.forEach((function(e){e.setEffectiveTimeScale(t)}))}syncro(t){let e=this.getAction(t);if(!e)return;let i=e.time;this.actions.forEach((function(t){t.time=i}))}setWeight(t,e){t.enabled=!0,e<0&&(e=0),e>1&&(e=1),t.setEffectiveWeight(e)}getAnimInfo(t){let e=this.getAction(t);if(e)return{name:t,time:e.time,frame:Math.round(30*e.time),frameMax:e.frameMax,timeScale:e.timeScale}}getAction(t){return this.actions.get(t)}play(t,e=.5){let i=this.getAction(t);if(!i)return!1;if(this.current){if(this.current!==i){this.old=this.current,this.current=i;let s="idle"!==this.current.getClip().name;-1!==this.clipsToesFix.indexOf(t)?this.fixToe=!0:this.resetToes();const n=this.current.getClip().duration/this.old.getClip().duration;this.current.reset(),s||(this.current.time=this.old.time*n),this.fixWeight?(this.current.weight=1,this.current.stopFading(),this.old.stopFading(),this.old._scheduleFading(e,this.old.getEffectiveWeight(),0),this.current._scheduleFading(e,this.current.getEffectiveWeight(),1)):this.executeCrossFade(this.old,this.current,e)}}else this.stop(),this.current=i,i.setEffectiveWeight(1);return this.isPause=!1,!0}playFrame(t,e,i=1){let s=this.getAction(t);s&&(s.time=e*lr,s.setEffectiveWeight(i),s.play(),s.paused=!0,this.isPause=!0)}playOne(t,e=1){this.current&&(this.current.time=t*lr,this.current.setEffectiveWeight(e),this.current.play(),this.current.paused=!0,this.isPause=!0)}stop(){this.actions.forEach((function(t){t.setEffectiveWeight(0)}))}setRot(t,e,i,s){let n=this.bones[t];n&&(n.rotation.set(e*hr,i*hr,s*hr,"XYZ"),n.updateMatrix())}setRot2(t,i,s,n){let r=this.bones[t];if(!r)return;let o=(new e.Quaternion).setFromEuler({_x:i*cr,_y:s*cr,_z:n*cr,_order:"XYZ"}).invert();r.quaternion.premultiply(o),r.updateMatrix()}getRot(t){let e=this.bones[t];if(!e)return;let i=e.rotation.toArray();return[Math.round(i[0]*cr),Math.round(i[1]*cr),Math.round(i[2]*cr)]}getWorldPos(t){let e=this.bones[t];if(e)return ur.set(0,0,0),e.localToWorld(ur),{x:ur.x,y:ur.y,z:ur.z}}bodyMask(t={arm:!0,leg:!0,foot:!0,chest:!0}){let i=.25;this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=256);const s=this.canvas.getContext("2d");s.fillStyle="#FFFFFF",s.fillRect(0,0,256,256),s.fillStyle="black",t.arm&&s.fillRect(196,112,59,46.5),t.leg&&s.fillRect(128,183.5,71.75,72.5),t.foot&&s.fillRect(817*i,205.5,51.5,50),t.chest&&(s.fillRect(120,144,75,40),s.fillRect(553*i,116.5,57,27.5),s.fillRect(533*i,531*i,5,45*i));let n=new Image;n.src=this.canvas.toDataURL(),this.mask&&this.mask.dispose(),this.mask=new e.Texture(n),this.mask.flipY=!1,this.mask.needsUpdate=!0;const r=Li.getMaterial("skin");r.alphaTest=.9,r.alphaMap=this.mask}zeroColor(t){t.isMesh&&(t=t.geometry);let i=t.attributes.position.array.length;t.setAttribute("color",new e.Float32BufferAttribute(new Array(i).fill(0),3))}}const pr=new e.Matrix4,fr=new e.Vector3,mr=new e.Quaternion,gr=new e.Vector3;class vr extends e.Object3D{constructor(t){super(),this.prefix=t.name||"yoo_",this.mode="follow",this.withFinger=!1,this.nodes=[],this.bones=t.model.skeleton.bones,this.model=t.model.root,this.posRef={},this.quatRef={},this.useSolver=!1,"PHYSX"!==Hi.engine&&(this.useSolver=!1),this.nameList=[],this.jointList=[],this.breast=!1,this.ready=!1,this.init()}setMode(t){if(t===this.mode)return;this.mode=t;const e=[];let i,s="follow"===this.mode,n=this.nodes.length;for(;n--;)i=this.nodes[n],e.push({name:i.name,kinematic:s}),i.kinematic=s,i.bone.isPhysics=!s;Hi.motor.change(e)}freeBone(t){t.kinematic&&(t.cc++,20===t.cc&&(t.cc=0,t.kinematic=!1,t.bone.isPhysics=!0,Hi.motor.change({name:t.name,kinematic:!1})))}isVisible(t){let e=this.nameList.length;for(;e--;)Yi.byName(this.nameList[e]).visible=t;let i=[];for(e=this.jointList.length;e--;)i.push({name:this.jointList[e],visible:t});Hi.motor.change(i)}init(){this.useSolver&&(this.solver=Hi.motor.add({type:"solver",name:this.prefix+"_solver",iteration:32,fix:!0,needData:!0}));const t=[];let i,s,n,r,o,a,l,h,c,u,d,p,f,m=new e.Vector3,g=new e.Vector3,v=new e.Quaternion,y=new e.Euler,b=new e.Matrix4,x=new e.Matrix4,O=new e.Matrix4,w=new e.Vector3,S=new e.Vector3,k=this.bones.length;for(i=0;i<k;i++)if(c=null,r=this.bones[i],s=r.name,o=r.parent,o&&(n=o.name,w.setFromMatrixPosition(o.matrixWorld),S.setFromMatrixPosition(r.matrixWorld),l=w.distanceTo(S),d=[0,0,.5*l],a=[l,1,1],h=null,u=!0,f=!1,"hip"===n&&"abdomen"===s&&(c="capsule",a=[1.8*l,.08],d=[0,0,.5*-l],h=[0,0,90]),"abdomen"===n&&"chest"===s&&(c="capsule",a=[.7*l,.08],d=[0,0,.5*-l-.06],h=[90,0,0]),"chest"===n&&"neck"===s&&(c="capsule",a=[.4*l,.04],d=[0,0,.5*-l-.02],h=[0,0,90]),"neck"===n&&"head"===s&&(c="capsule",a=[.06,l],d=[0,0,.5*-l],h=[90,0,0]),"head"===n&&"End_head"===s&&(c="capsule",a=[.1,l-.17],d=[0,.02,.5*-l+.02],h=[90,0,0]),"chest"===n&&"rBreast"===s&&"HAVOK"!==Hi.engine&&(n="rBreast",o=r,c="sphere",a=[.065],d=[.065,0,0],this.breast=!0,f=!0),"chest"===n&&"lBreast"===s&&"HAVOK"!==Hi.engine&&(n="lBreast",o=r,c="sphere",a=[.065],d=[.065,0,0],this.breast=!0,f=!0),"lCollar"===n&&"lShldr"===s&&(c="capsule",a=[.05,.3*l],d=[.6*l,0,0],h=[0,0,90]),"lShldr"===n&&"lForeArm"===s&&(c="capsule",a=[.05,l],d=[.5*l,0,0],h=[0,0,90]),"lForeArm"===n&&"lHand"===s&&(c="capsule",a=[.04,l],d=[.5*l,0,0],h=[0,0,90]),"lHand"===n&&"lMid1"===s&&(c="box",a=[2*l,.09,.05],d=[l,0,0]),"rCollar"===n&&"rShldr"===s&&(c="capsule",a=[.05,.3*l],d=[.6*-l,0,0],h=[0,0,90]),"rShldr"===n&&"rForeArm"===s&&(c="capsule",a=[.05,l],d=[.5*-l,0,0],h=[0,0,90]),"rForeArm"===n&&"rHand"===s&&(c="capsule",a=[.04,l],d=[.5*-l,0,0],h=[0,0,90]),"rHand"===n&&"rMid1"===s&&(c="box",a=[2*l,.09,.05],d=[-l,0,0]),"lThigh"===n&&(c="capsule",a=[.08,l],h=[90,0,0]),"lShin"===n&&(c="capsule",a=[.065,l],h=[90,0,0]),"lFoot"===n&&(c="capsule",a=[.05,l],d=[0,.5*l-.025,.04]),"rThigh"===n&&(c="capsule",a=[.08,l],h=[90,0,0]),"rShin"===n&&(c="capsule",a=[.065,l],h=[90,0,0]),"rFoot"===n&&(c="capsule",a=[.05,l],d=[0,.5*l-.025,.04]),this.withFinger&&("lHand"===n&&"lMid1"===s&&(c="box",a=[l,.09,.05],d=[.5*l,0,0]),"rHand"===n&&"rMid1"===s&&(c="box",a=[l,.09,.05],d=[.5*-l,0,0]),"rThumb1"===n&&"rThumb2"===s&&(c="capsule",a=[.02,l],h=[0,0,90]),"rThumb2"===n&&"rThumb3"===s&&(c="capsule",a=[.02,l],h=[0,0,90]),"rHand"===n&&"rMid1"===s&&(c="capsule",a=[.02,l],h=[0,0,90],d=[.6*-l,0,0]),"rMid1"===n&&"rMid2"===s&&(c="capsule",a=[.02,l],h=[0,0,90],d=[.6*-l,0,0]),"rMid2"===n&&"rMid3"===s&&(c="capsule",a=[.02,l],h=[0,0,90],d=[.6*-l,0,0])),null!==c)){p=this.prefix+"_bone_"+n,x.makeTranslation(d[0],d[1],d[2]),h&&(O.makeRotationFromEuler(y.set(h[0]*Ii,h[1]*Ii,h[2]*Ii)),x.multiply(O)),b.copy(o.matrixWorld),b.decompose(m,v,g),this.posRef[p]=m.toArray(),"lForeArm"!==n&&"rForeArm"!==n||(mr.setFromAxisAngle({x:0,y:1,z:0},-90*Ii),v.multiply(mr)),this.quatRef[p]=v.toArray(),b.multiplyMatrices(o.matrixWorld,x),b.decompose(m,v,g);let e={name:p,density:1,type:c,size:Ni.scaleArray(a,1,3),pos:m.toArray(),quat:v.toArray(),kinematic:true,friction:.5,restitution:.1,group:1,mask:3,material:"bones2",shadow:!1,neverSleep:!0,helper:!0};t.push(e),this.nameList.push(p),this.nodes.push({name:p,kinematic:true,motion:f,bone:o,decal:x.clone(),decalinv:x.clone().invert(),quat:v.toArray(),pos:m.toArray(),cc:0})}Hi.motor.add(t),this.addLink(),this.ready=!0}addLink(){let t=[.05,1,0];"PHYSX"===Hi.engine&&(t=[50,10,0,.5]);let e=this.prefix+"_bone_",i=[],s={type:"joint",mode:"d6",visible:!1,lm:[["ry",-180,180,...t],["rz",-180,180,...t]],collision:!1,helperSize:.05,autoDrive:!0},n=[-.001,.001,100,.2,.5];i.push({...s,b1:e+"hip",b2:e+"abdomen",worldPos:this.posRef[e+"abdomen"],worldQuat:this.quatRef[e+"hip"],lm:[["rx",-20,20,...t],["ry",-20,20,...t],["rz",-20,20,...t]]}),i.push({...s,b1:e+"abdomen",b2:e+"chest",worldPos:this.posRef[e+"chest"],worldQuat:this.quatRef[e+"chest"],lm:[["rx",-20,20,...t],["ry",-20,20,...t],["rz",-20,20,...t]]}),i.push({...s,b1:e+"chest",b2:e+"neck",worldPos:this.posRef[e+"neck"],worldQuat:this.quatRef[e+"neck"],lm:[["rx",-60,60,...t],["ry",-1,1,...t],["rz",-30,30,...t]]}),i.push({...s,b1:e+"neck",b2:e+"head",worldPos:this.posRef[e+"head"],worldQuat:this.quatRef[e+"head"],lm:[["rx",-60,60,...t],["ry",-1,1,...t],["rz",-30,30,...t]]}),i.push({...s,b1:e+"chest",b2:e+"rCollar",worldPos:this.posRef[e+"rCollar"],worldQuat:this.quatRef[e+"rCollar"],lm:[["rx",-10,10,...t],["ry",-10,10,...t],["rz",-10,10,...t]]}),i.push({...s,b1:e+"chest",b2:e+"lCollar",worldPos:this.posRef[e+"lCollar"],worldQuat:this.quatRef[e+"lCollar"],lm:[["rx",-10,10,...t],["ry",-10,10,...t],["rz",-10,10,...t]]}),i.push({...s,b1:e+"rCollar",b2:e+"rShldr",worldPos:this.posRef[e+"rShldr"],worldQuat:this.quatRef[e+"rShldr"]}),i.push({...s,b1:e+"lCollar",b2:e+"lShldr",worldPos:this.posRef[e+"lShldr"],worldQuat:this.quatRef[e+"lShldr"]}),i.push({...s,b1:e+"rShldr",b2:e+"rForeArm",worldPos:this.posRef[e+"rForeArm"],worldQuat:this.quatRef[e+"rForeArm"],lm:[["rx",0,160,...t]]}),i.push({...s,b1:e+"lShldr",b2:e+"lForeArm",worldPos:this.posRef[e+"lForeArm"],worldQuat:this.quatRef[e+"lForeArm"],lm:[["rx",0,160,...t]]}),i.push({...s,b1:e+"rForeArm",b2:e+"rHand",worldPos:this.posRef[e+"rHand"],worldQuat:this.quatRef[e+"rHand"],lm:[["rx",0,160,...t],["ry",-10,10,...t]]}),i.push({...s,b1:e+"lForeArm",b2:e+"lHand",worldPos:this.posRef[e+"lHand"],worldQuat:this.quatRef[e+"lHand"],lm:[["rx",0,160,...t],["ry",-10,10,...t]]}),i.push({...s,b1:e+"hip",b2:e+"rThigh",worldPos:this.posRef[e+"rThigh"],worldQuat:this.quatRef[e+"rThigh"]}),i.push({...s,b1:e+"hip",b2:e+"lThigh",worldPos:this.posRef[e+"lThigh"],worldQuat:this.quatRef[e+"lThigh"]}),i.push({...s,b1:e+"rThigh",b2:e+"rShin",worldPos:this.posRef[e+"rShin"],lm:[["rx",0,160,...t]],worldQuat:this.quatRef[e+"rShin"]}),i.push({...s,b1:e+"lThigh",b2:e+"lShin",worldPos:this.posRef[e+"lShin"],lm:[["rx",0,160,...t]],worldQuat:this.quatRef[e+"lShin"]}),i.push({...s,b1:e+"rShin",b2:e+"rFoot",worldPos:this.posRef[e+"rFoot"],lm:[["rx",-10,30,...t],["rz",-10,10,...t]],worldQuat:this.quatRef[e+"rFoot"]}),i.push({...s,b1:e+"lShin",b2:e+"lFoot",worldPos:this.posRef[e+"lFoot"],lm:[["rx",-10,30,...t],["rz",-10,10,...t]],worldQuat:this.quatRef[e+"lFoot"]}),this.breast&&(i.push({...s,b1:e+"chest",b2:e+"rBreast",worldPos:this.posRef[e+"rBreast"],worldQuat:this.quatRef[e+"rBreast"],lm:[["x",...n],["y",...n],["z",...n]]}),i.push({...s,b1:e+"chest",b2:e+"lBreast",worldPos:this.posRef[e+"lBreast"],worldQuat:this.quatRef[e+"lBreast"],lm:[["x",...n],["y",...n],["z",...n]]}));let r=0;for(let t in i)i[t].name=this.prefix+"_joint_"+r,this.nameList.push(i[t].name),this.jointList.push(i[t].name),r++;Hi.motor.add(i)}updateMatrixWorld(t){if(!this.ready)return;let e=[];const i=this.nodes;let s,n,r,o=i.length;for(;o--;)s=i[o],n=s.bone,s.kinematic?(pr.multiplyMatrices(n.matrixWorld,s.decal),pr.decompose(fr,mr,gr),s.pos=fr.toArray(),s.quat=mr.toArray(),e.push({name:s.name,pos:s.pos,quat:s.quat}),s.motion&&this.freeBone(s)):(r=Yi.byName(s.name),r&&(pr.copy(r.matrixWorld).multiply(s.decalinv),n.phyMtx.copy(pr),n.isPhysics=!0));0!==e.length&&Hi.motor.change(e,!0)}dispose(){Hi.motor.remove(this.nameList),this.nodes=[],this.posRef={},this.quatRef={},this.parent.remove(this),this.nameList=[],this.jointList=[]}}class yr extends ds{constructor(){super(),this.Utils=Yi,this.type="character",this.num=qi[this.type]}step(){const t=Hi.Ar,e=Hi.ArPos[this.type];let i,s,n=this.list.length;for(;n--;)s=this.list[n],i=e+n*this.num,s.step(t,i)}add(t={}){this.setName(t);return new br(t)}set(t={},e=null){null===e&&(e=this.byName(t.name)),null!==e&&e.set(t)}}class br extends Ps{constructor(t={}){super(),this.fixWeight=void 0===t.fixWeight||t.fixWeight,this.type="character",this.name=t.name||"hero",t.name=this.name,this.isRay=!1,this.ray=null,this.model=null,this.static=!1,this.radius=t.radius||.3,this.height=t.height||1.8,t.radius&&delete t.radius,this.fall=!1,this.floor=!0,this.distance=0,this.rayAngle=0,this.rayStart=-.5*this.height+this.radius,this.rayEnd=this.rayStart-this.height,this.maxRayDistance=this.height,this.contact=!1,this.tmpV1=new e.Vector3,this.tmpV2=new e.Vector3,this.ease=new e.Vector3,this.tmpAcc=0,this.rs=0,this.ts=0,this.diagonal=1/Math.sqrt(2),this.jump=!1,this.crouch=!1,this.toggle=!0,this.oy=0,this.vy=0,this.timeScale=1.25,this.angle=(t.angle||0)*Ii,this.speed={idle:1,fight:1,walk:7.8,crouch:7,run:12},this.valheimStyle=!0,this.globalRay=t.ray||!1,this.callback=t.callback||function(){},t.callback&&delete t.callback,this.init(t)}init(t){t.size||(t.size=[this.radius,this.height-2*this.radius]),t.pos||(t.pos=[0,.5*this.height,0]),this.py=.5*-this.height,this.globalRay&&Hi.items.body.geometry({...t,type:"capsule",ray:!0},this,cs.get("hide")),t.density=t.density||1,t.friction=.5,t.angularFactor=[0,0,0],t.group=16,t.regular=!0,t.filter=[1,-1,[1,3,4,5,9],0],t.inertia=[0,0,0],t.noGravity=!0,t.volume=Ni.getVolume("capsule",t.size),Hi.items.character.addToWorld(this,t.id),Hi.post({m:"add",o:t}),this.ray=Hi.motor.add({type:"ray",name:this.name+"_ray",begin:[0,this.rayStart,0],end:[0,this.rayEnd,0],callback:this.selfRay.bind(this),visible:!1,parent:this.name}),t.gender?this.addModel(t):this.showHelper(!0)}selfRay(t){t.hit?(this.distance=Ni.toFixed(t.distance-this.radius),this.rayAngle=t.angle):(this.distance=this.maxRayDistance,this.rayAngle=0)}hit(t){this.contact=t}showHelper(t){t?this.helper||(this.helper=new Ws(this.radius,this.height,!0,cs.get("line")),this.add(this.helper)):this.helper&&(this.remove(this.helper),this.helper.dispose(),this.helper=null),this.ray&&(this.ray.visible=t)}addSkeleton(){this.skeletonBody||(this.skeletonBody=new vr(this),Hi.scene.add(this.skeletonBody),this.skeletonBody.isVisible(!1))}debugMode(t){this.skeletonBody&&this.skeletonBody.isVisible(t),this.model&&this.model.setMaterial({wireframe:t,transparent:t,opacity:t?.25:1},!t),this.showHelper(t)}setMode(t){this.skeletonBody&&this.skeletonBody.setMode(t)}addModel(t){this.model=new dr({type:t.gender,anim:void 0!==t.anim?t.anim:"idle",compact:!0,material:!t.noMat,morph:t.morph||!1,callback:this.callback,fixWeight:this.fixWeight}),this.add(this.model),this.model.setPosition(0,this.py+this.model.decalY,0),this.model.rotation.y=this.angle,this.model.updateMatrix()}raycast(){}step(t,e){this.position.fromArray(t,e+1),this.quaternion.fromArray(t,e+4),this.fall=this.position.y<this.oy,this.floor=Ni.nearEquals(this.position.y,this.oy,.1),this.oy=this.position.y,this.updateMatrix(),this.model&&this.model.update(Hi.delta)}set(t){t.morph&&this.model&&this.model.setMorph(t.morph,t.value)}dispose(){this.callback=null,this.skeletonBody&&this.skeletonBody.dispose(),this.model&&this.model.dispose(),this.helper&&this.showHelper(),console.log("model remove"),super.dispose()}move(){const t=Hi.motor.getKey(),e=Hi.motor.getAzimut(),i=Hi.delta;let s=0!==t[7]?"run":"walk";0===t[0]&&0===t[1]&&(s="idle");let n=0!==t[0]&&0!==t[1]?this.diagonal:1;t[5]&&this.toggle&&(this.crouch=!this.crouch,this.toggle=!1),0===t[5]&&(this.toggle=!0),"walk"!==s&&"run"!==s||!this.crouch||(s="crouch"),1===t[6]&&(s="fight"),!this.jump&&t[4]&&(this.vy=22,this.jump=!0),this.jump&&(this.vy-=1,this.vy<=0&&(this.vy=0,this.floor&&(this.jump=!1)));let r="idle";switch(s){case"idle":r=this.crouch?"Crouch Idle":"idle";break;case"walk":r="Jog Forward";break;case"run":r="Standard Run";break;case"crouch":r="Crouch Walk";break;case"fight":r="Attack"}let o=1*this.speed[s];0===t[0]&&0===t[1]||(this.tmpAcc+=4*i,this.rs=t[0]*o,this.ts=t[1]*o),0===t[0]&&0===t[1]&&(this.tmpAcc=0),this.tmpAcc>1&&(this.tmpAcc=1),this.ease.set(this.rs,0,this.ts).multiplyScalar(this.tmpAcc*n);let a=Ni.unwrapRad(Math.atan2(this.ease.x,this.ease.z)+e);this.ease.length(),this.static&&(this.ease.x=this.ease.z=0);let l=this.vy-9.81;if(this.ease.y=l,this.tmpV1.copy(this.ease).applyAxisAngle({x:0,y:1,z:0},e),this.tmpV2.set(0,0,0),Hi.motor.change({name:this.name,linearVelocity:this.tmpV1.toArray()}),this.helper&&(this.helper.cone.rotation.y=e,"idle"!==s&&this.helper.setDirection(a)),this.model&&(this.jump?this.model.play("Jump",0):this.model.play(r,.5),"idle"!==s)){let t=Ni.unwrapRad(this.model.rotation.y),i=Ni.nearAngle(a,t),n=Math.abs(Math.floor((t-i)*math.todeg)/180);this.model.rotation.y="fight"===s?e+Math.PI:Ni.lerp(t,i,.2-.1*n),this.model.updateMatrix()}}}class xr extends e.Mesh{constructor(t={}){super(),this.ready=!1,this.needUpdate=!1,this.type="terrain",this.name=t.name,this.folder=t.folder||"./assets/textures/terrain/",this.mapN=0,this.mapMax=7,this.ttype=t.terrainType||"terrain",this.callback=t.callback||function(){},this.physicsUpdate=()=>{},this.uvx=[t.uv||18,t.uv||18],this.sample=null==t.sample?[128,128]:t.sample,this.size=void 0===t.size?[100,30,100]:t.size;let i=this.sample[0]-1,s=this.sample[1]-1;this.rx=i/this.size[0],this.rz=s/this.size[2],this.zone=t.zone||1;let n=[this.size[0]/i,this.size[2]/s];this.sampleZ=[t.sample[0]*this.zone,t.sample[1]*this.zone],this.sizeZ=[(this.sampleZ[0]-1)*n[0],t.size[1],(this.sampleZ[1]-1)*n[1]],this.lng=this.sample[0]*this.sample[1],this.lngZ=this.sampleZ[0]*this.sampleZ[1],this.getZid(),this.data={level:t.level||[1,.2,.05],frequency:t.frequency||[.016,.05,.2],expo:t.expo||1},this.isWater=t.water||!1,this.isBorder=!1,this.wantBorder=t.border||!1,this.isBottom=!1,this.wantBottom=t.bottom||!1,this.wantBorder=t.border||!1,this.colorBase=this.isWater?{r:0,g:.7,b:1}:{r:.25,g:.25,b:.25},this.maxspeed=t.maxSpeed||.1,this.acc=null==t.acc?.01:t.acc,this.dec=null==t.dec?.01:t.dec,this.deep=null==t.deep?0:t.deep,this.ease=new e.Vector2,this.complexity=null==t.complexity?30:t.complexity,this.complexity2=null==t.complexity2?null:t.complexity2,this.local=new e.Vector3,t.local&&this.local.fromArray(t.local),this.pp=new e.Vector3,this.ratioZ=1/this.sampleZ[0],this.ratio=1/this.sample[0],this.ruvx=1/(this.size[0]/this.uvx[0]),this.ruvy=-1/(this.size[2]/this.uvx[1]),this.is64=t.is64||!1,this.isTurn=t.turn||!1,this.heightData=new Float32Array(this.lngZ),this.height=[],this.isAbsolute=t.isAbsolute||!1,this.isTurned=t.isTurned||!1,this.isReverse=t.isReverse||!1,this.changeId=this.isReverse||this.isTurned,this.changeId&&this.getReverseID(),this.colors=new Float32Array(3*this.lng),this.geometry=new e.PlaneGeometry(this.size[0],this.size[2],this.sample[0]-1,this.sample[1]-1),this.geometry.rotateX(-mt.PI90),this.geometry.setAttribute("color",new e.BufferAttribute(this.colors,3)),this.vertices=this.geometry.attributes.position.array;var r=new e.Quaternion(.5,.5,.1,.2);t.maplevels&&r.fromArray(t.maplevels);var o,a=Or,l=t.maps||["sand","grass3","rock"],h={};this.isWater&&(l=["water"]);for(let e in l)o=l[e],h[o+"_c"]=Li.texture({url:this.folder+o+"_c.jpg",flip:!1,repeat:this.uvx,encoding:t.encoding||!0,callback:this.mapcallback.bind(this)}),h[o+"_n"]=Li.texture({url:this.folder+o+"_n.jpg",flip:!1,repeat:this.uvx,callback:this.mapcallback.bind(this)});h.noise=Li.texture({url:this.folder+"noise.png",flip:!1,repeat:[1,1],encoding:!1,callback:this.mapcallback.bind(this)}),this.txt=h,this.material=new e.MeshPhysicalMaterial({name:"terrain",vertexColors:!0,color:16777215,map:h[l[0]+"_c"],normalMap:h[l[0]+"_n"]}),void 0!==t.envmap&&(this.material.envMap=t.envmap),this.isWater?(this.material.transparent=!0,this.material.opacity=t.opacity||.4,this.material.side=e.DoubleSide,this.material.alphaMap=h[l[0]+"_c"],this.material.map=null,this.material.metalness=.9,this.material.roughness=.1):(this.material.reflectivity=0,this.material.metalness=t.metalness||0,this.material.roughness=t.roughness||.77);var c=t.nScale||1;this.material.normalScale.set(c,c),this.isWater?this.material.onBeforeCompile=function(t){var e=t.fragmentShader;e=e.replace("#include <alphamap_fragment>",a.alphamap),t.fragmentShader=e}:(this.material.onBeforeCompile=function(t){let e=t.uniforms;e.clevels={value:r},e.map1={value:h[l[1]+"_c"]},e.map2={value:h[l[2]+"_c"]},e.randomUv={value:1},e.normalMap1={value:h[l[1]+"_n"]},e.normalMap2={value:h[l[2]+"_n"]},e.noiseMap={value:h.noise},e.useNoiseMap={value:1},t.uniforms=e,Pi.addParsFragment(t,Pi.getRandomUv()+a.fragmentAdd);let i=t.fragmentShader;i=i.replace("#include <map_fragment>",a.map),i=i.replace("#include <normal_fragment_maps>",a.normal),i=i.replace("#include <color_fragment>",""),t.fragmentShader=i,this.userData.shader=t,Pi.modify(t)},Object.defineProperty(this.material,"randomUv",{get(){return!!this.userData.shader.uniforms.randomUv.value},set(t){this.userData.shader.uniforms.randomUv.value=t?1:0}}),Object.defineProperty(this.material,"map1",{get(){return this.userData.shader.uniforms.map1.value},set(t){this.userData.shader.uniforms.map1.value=t}}),Object.defineProperty(this.material,"map2",{get(){return this.userData.shader.uniforms.map2.value},set(t){this.userData.shader.uniforms.map2.value=t}}),Object.defineProperty(this.material,"normalMap1",{get(){return this.userData.shader.uniforms.normalMap1.value},set(t){this.userData.shader.uniforms.normalMap1.value=t}}),Object.defineProperty(this.material,"normalMap2",{get(){return this.userData.shader.uniforms.normalMap2.value},set(t){this.userData.shader.uniforms.normalMap2.value=t}})),t.debug&&this.debugZone(t),this.wantBorder&&this.addBorder(t),this.wantBottom&&this.addBottom(t),t.pos&&this.position.fromArray(t.pos),t.quat=void 0===t.quat?[0,0,0,1]:t.quat,void 0!==t.rot&&(t.quat=mt.toQuatArray(t.rot),delete t.rot),this.quaternion.fromArray(t.quat),t.decal&&(this.position.y+=t.decal),this.castShadow=!0,this.receiveShadow=!0,Li.set("terrain"+this.name,this.material,"material",!0),this.update()}getZid(){this.zid={};let t=.5*(this.sample[0]-this.sampleZ[0]),e=.5*(this.sample[1]-this.sampleZ[1]),i=this.sample[0]*e+t,s=0;for(let e=0;e<this.lngZ;e++)s=Math.floor(e/this.sampleZ[0]),this.zid[i+e+s*(2*t)]=e}debugZone(t){this.geometryZ=new e.PlaneGeometry(this.sizeZ[0],this.sizeZ[2],this.sampleZ[0]-1,this.sampleZ[1]-1),this.geometryZ.rotateX(-mt.PI90),this.verticesZ=this.geometryZ.attributes.position.array;const i=new e.Mesh(this.geometryZ,new e.MeshBasicMaterial({color:16711680,wireframe:!0}));t.pos&&i.position.fromArray(t.pos),this.add(i)}mapcallback(){this.mapN++,this.mapN==this.mapMax&&this.callback()}addBottom(t){var i=new e.PlaneGeometry(this.size[0],this.size[2],1,1);i.rotateX(mt.PI90),this.bottomMesh=new e.Mesh(i,this.borderMaterial),this.add(this.bottomMesh),this.isBottom=!0}addBorder(t){this.borderMaterial=new e.MeshStandardMaterial({vertexColors:!0,metalness:this.isWater?.8:.4,roughness:this.isWater?.2:.6,normalScale:this.isWater?[.25,.25]:[2,2],transparent:!!this.isWater,opacity:this.isWater?t.opacity||.8:1,envMap:t.envmap||null});var i=new e.PlaneGeometry(this.size[0],2,this.sample[0]-1,1),s=new e.PlaneGeometry(this.size[0],2,this.sample[0]-1,1),n=new e.PlaneGeometry(this.size[2],2,this.sample[1]-1,1),r=new e.PlaneGeometry(this.size[2],2,this.sample[1]-1,1);i.translate(0,1,.5*this.size[2]),s.rotateY(-mt.Pi),s.translate(0,1,.5*-this.size[2]),n.rotateY(-mt.PI90),n.translate(.5*-this.size[0],1,0),r.rotateY(mt.PI90),r.translate(.5*this.size[0],1,0),this.borderGeometry=xt(function(t,e=!1){return console.warn("THREE.BufferGeometryUtils: mergeBufferGeometries() has been renamed to mergeGeometries()."),yt(t,e)}([i,s,n,r])),this.borderVertices=this.borderGeometry.attributes.position.array,this.lng2=this.borderVertices.length/3,this.list=new Array(this.lng2),this.borderColors=new Float32Array(3*this.lng),this.borderGeometry.setAttribute("color",new e.BufferAttribute(this.borderColors,3)),this.borderMesh=new e.Mesh(this.borderGeometry,this.borderMaterial);for(var o,a,l=this.lng2;l--;)o=3*l,a=this.borderVertices[o+1]>0?this.findPoint(this.borderVertices[o],this.borderVertices[o+2]):-1,this.list[l]=a;this.add(this.borderMesh),this.borderMesh.castShadow=!0,this.borderMesh.receiveShadow=!0,this.isBorder=!0}dispose(){this.isBottom&&(this.remove(this.bottomMesh),this.bottomMesh.geometry.dispose()),this.isBorder&&(this.remove(this.borderMesh),this.borderMesh.geometry.dispose(),this.borderMesh.material.dispose()),this.geometry.dispose(),this.material.dispose();for(let t in this.txt)this.txt[t].dispose()}easing(t,e,i){if(0!==t[0]||0!==t[1]){var s=e||0;t[7]?this.maxspeed=1.5:this.maxspeed=.25,this.ease.y+=t[1]*this.acc,this.ease.x+=t[0]*this.acc,this.ease.x=this.ease.x>this.maxspeed?this.maxspeed:this.ease.x,this.ease.x=this.ease.x<-this.maxspeed?-this.maxspeed:this.ease.x,this.ease.y=this.ease.y>this.maxspeed?this.maxspeed:this.ease.y,this.ease.y=this.ease.y<-this.maxspeed?-this.maxspeed:this.ease.y,t[1]||(this.ease.y>this.dec?this.ease.y-=this.dec:this.ease.y<-this.dec?this.ease.y+=this.dec:this.ease.y=0),t[0]||(this.ease.x>this.dec?this.ease.x-=this.dec:this.ease.x<-this.dec?this.ease.x+=this.dec:this.ease.x=0),(this.ease.x||this.ease.y)&&(this.local.z+=Math.sin(s)*this.ease.x+Math.cos(s)*this.ease.y,this.local.x+=Math.cos(s)*this.ease.x-Math.sin(s)*this.ease.y,this.update(i))}}getTri(){return this.geometry}getHeight(t,e){return t*=this.rx,e*=this.rz,t+=.5*this.sample[0],e+=.5*this.sample[1],t=Math.floor(t),e=Math.floor(e),(this.isTurn?this.height[this.findId2(t,e)]:this.height[this.findId(t,e)])*this.size[1]+this.position.y}findIdZ(t,e){return t+e*this.sampleZ[1]}findId(t,e){return t+e*this.sample[1]}findId2(t,e){return e+-t*this.sample[0]||1}findPoint(t,e){for(var i,s=this.lng;s--;)if(i=3*s,this.vertices[i]===t&&this.vertices[i+2]===e)return s;return-1}getReverseID(){this.invId=[];let t,e,i=this.lngZ;const s=this.sampleZ[1]-1;for(this.sampleZ[0];i--;)t=i%this.sampleZ[0],e=Math.floor(i*this.ratioZ),this.isReverse&&(e=s-e),this.invId[i]=this.isTurned?this.lngZ-1-this.findIdZ(e,t):this.findIdZ(t,e)}set(t){t.ease&&this.easing(t.key,t.azimut),t.decal&&this.decal(t.decal,!0)}decal(t,e){this.local.x+=t[0],this.local.y+=t[1],this.local.z+=t[2],this.update(e)}updateUv(){if(this.isWater)this.material.normalMap.offset.x+=.002,this.material.normalMap.offset.y+=.001;else{let t={x:this.local.x*this.ruvx,y:this.local.z*this.ruvy};this.material.map&&this.material.map.offset.copy(t),this.material.normalMap&&this.material.normalMap.offset.copy(t)}}update(t){let e,i,s,n,r,o,a,l,h,c,u,d=this.pp,p=[1,1,1],f=this.lng;for(;f--;)e=3*f,i=f%this.sample[0],s=Math.floor(f*this.ratio),d.set(i+this.local.x*this.rx,this.local.y,s+this.local.z*this.rz),n=mt.noise(d,this.data),n=Math.pow(n,this.data.expo),n=n>1?1:n,n=n<0?0:n,"road"===this.ttype&&(l===s?n=1===i||2===i||29===i||30===i?h+.1:h:(l=s,h=n)),this.height[f]=n,c=n*this.size[1]+this.deep,this.vertices[e+1]=c,o=this.isAbsolute?n:n*this.size[1],void 0!==this.zid[f]&&(a=this.zid[f],r=this.changeId?this.invId[a]:a,this.heightData[r]=o,this.verticesZ&&(this.verticesZ[3*a+1]=c)),p=this.isWater?[n*this.colorBase.r,n*this.colorBase.g,n*this.colorBase.b]:[n,0,0],u=p[0],this.colors[e]=u,this.colors[e+1]=u,this.colors[e+2]=u;if(this.isBorder){let t,i=this.lng2;for(;i--;)e=3*i,-1!==this.list[i]?(t=this.height[this.list[i]],this.borderVertices[e+1]=t*this.size[1]+this.deep,u=mt.clamp(t+.25,.25,1),this.borderColors[e]=u,this.borderColors[e+1]=u,this.borderColors[e+2]=u):(this.borderColors[e]=this.colorBase.r,this.borderColors[e+1]=this.colorBase.g,this.borderColors[e+2]=this.colorBase.b)}t?this.needUpdate=!0:this.updateGeometry(),this.ready&&this.physicsUpdate(this.name,this.heightData),this.ready=!0}step(t){this.needUpdate&&(this.updateGeometry(),this.needUpdate=!1)}updateGeometry(){this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0,this.geometry.computeVertexNormals(),this.updateUv(),this.geometryZ&&(this.geometryZ.attributes.position.needsUpdate=!0),this.isBorder&&(this.borderGeometry.attributes.position.needsUpdate=!0,this.borderGeometry.attributes.color.needsUpdate=!0)}}const Or={fragmentAdd:"\n        uniform vec4 clevels;\n        uniform float randomUv;\n\n        uniform sampler2D noise;\n\n        uniform sampler2D normalMap1;\n        uniform sampler2D normalMap2;\n\n        uniform sampler2D roughnessMap1;\n        uniform sampler2D roughnessMap2;\n\n        uniform float aoMapIntensity;\n        uniform sampler2D map1;\n        uniform sampler2D map2;\n\n        vec4 textureMAP( sampler2D mapper, in vec2 uv ){\n            if( randomUv == 1.0 ) return textureNoTile( mapper, uv );\n            else return texture2D( mapper, uv );\n        }\n\n        vec4 MappingMix( float slope, vec4 level, vec4 rocks, vec4 grasss, vec4 sands ){\n            vec4 cc = rocks;\n            if (slope < level.x) cc = grasss;\n            if (slope < level.z) cc = sands;\n            //if (( slope < level.x ) && (slope >= level.y)) cc = mix( grasss , rocks, (slope - level.y) * (1. / (level.x - level.y)));\n            //if (( slope < level.y ) && (slope >= level.z)) cc = mix( sands , grasss, (slope - level.z) * (1. / (level.y - level.z)));\n\n            float d = level.y;\n            float rx = 1.0/level.y;\n\n            if (( slope < level.x + d ) && (slope > level.x)) cc = mix( grasss , rocks, ( slope - (level.x) ) * rx );\n\n            d = level.w;\n            rx = 1.0/level.w;\n            if (( slope < level.z + d ) && (slope > level.z )) cc = mix( sands , grasss, ( slope - (level.z) ) * rx );\n\n            //cc = mix( grasss, cc, smoothstep(0.0,1.0, slope)*20.0 );\n            return cc;\n        }\n    ",rough:"\n        float roughnessFactor = roughness;\n        float metalnessFactor = metalness;\n        #ifdef USE_ROUGHNESSMAP\n\n            vec4 sandR = textureMAP( roughnessMap, vRoughnessMapUv );\n            vec4 grassR = textureMAP( roughnessMap1, vRoughnessMapUv );\n            vec4 rockR = textureMAP( roughnessMap2, vRoughnessMapUv );\n\n            vec4 baseColorR = MappingMix( vColor.r, clevels, rockR, grassR, sandR );\n            // reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n            float ambientOcclusion =( baseColorR.r - 1.0 ) * aoMapIntensity + 1.0;\n            roughnessFactor *= baseColorR.g;\n            metalnessFactor *= baseColorR.b;\n        #endif\n    ",ao:"\n        reflectedLight.indirectDiffuse *= ambientOcclusion;\n        #if defined( USE_ENVMAP ) && defined( STANDARD )\n            float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n            reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n        #endif\n    ",map:"\n        #ifdef USE_MAP\n\n            vec4 sand = textureMAP( map, vMapUv );\n            vec4 grass = textureMAP( map1, vMapUv );\n            vec4 rock = textureMAP( map2, vMapUv ); \n\n            vec4 baseColor = MappingMix(vColor.r, clevels, rock, grass, sand);\n            diffuseColor *= baseColor;\n\n        #endif\n    ",normal:"\n\n        #ifdef USE_NORMALMAP_OBJECTSPACE\n\n            normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n            #ifdef FLIP_SIDED\n\n                normal = - normal;\n\n            #endif\n\n            #ifdef DOUBLE_SIDED\n\n                normal = normal * faceDirection;\n\n            #endif\n\n            normal = normalize( normalMatrix * normal );\n\n        #elif defined( USE_NORMALMAP_TANGENTSPACE )\n\n            vec4 sandN = textureMAP( normalMap, vNormalMapUv );\n            vec4 grassN = textureMAP( normalMap1, vNormalMapUv );\n            vec4 rockN = textureMAP( normalMap2, vNormalMapUv );\n            vec3 mapN = MappingMix(vColor.r, clevels, rockN, grassN, sandN).xyz * 2.0 - 1.0;\n\n            ///vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\n            mapN.xy *= normalScale;\n            normal = normalize( tbn * mapN );\n\n        #elif defined( USE_BUMPMAP )\n\n            normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n\n        #endif\n    ",normal2:"\n\n        #ifdef OBJECTSPACE_NORMALMAP\n\n            normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n            #ifdef FLIP_SIDED\n\n                normal = - normal;\n\n            #endif\n\n            #ifdef DOUBLE_SIDED\n\n                normal = normal * faceDirection;\n\n            #endif\n\n            normal = normalize( normalMatrix * normal );\n\n        #elif defined( TANGENTSPACE_NORMALMAP )\n\n            vec4 sandN = textureMAP( normalMap, vNormalMapUv );\n            vec4 grassN = textureMAP( normalMap1, vNormalMapUv );\n            vec4 rockN = textureMAP( normalMap2, vNormalMapUv );\n\n            vec3 mapN = MappingMix(vColor.r, clevels, rockN, grassN, sandN).xyz * 2.0 - 1.0;\n\n            //vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n            mapN.xy *= normalScale;\n\n            normal = normalize( tbn * mapN );\n\n        #elif defined( USE_BUMPMAP )\n\n            normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n\n        #endif\n    ",alphamap:"\n        #ifdef USE_ALPHAMAP\n            diffuseColor.a = opacity +( texture2D( alphaMap, vAlphaMapUv ).g * opacity) * (1.0-opacity);\n        #endif\n    "};class wr extends ds{constructor(){super(),this.Utils=Yi,this.type="terrain",this.num=qi[this.type]}step(){Hi.Ar,Hi.ArPos[this.type];let t,e=this.list.length;for(;e--;)t=this.list[e],t.step()}add(t={}){this.setName(t),"PHYSX"===Hi.engine&&(t.isAbsolute=!0,t.isTurned=!0),"HAVOK"===Hi.engine&&(t.isAbsolute=!0,t.isTurned=!0,t.isReverse=!1),"OIMO"!==Hi.engine&&(t.zone=t.zone||.25);const e=new xr(t);return e.physicsUpdate=(t,e)=>{Hi.flow.tmp.push({name:t,heightData:e})},this.addToWorld(e,t.id),Hi.post({m:"add",o:Sr(e)}),e}set(t={},e=null){null===e&&(e=this.byName(t.name)),null!==e&&e.set(t)}}const Sr=function(t){const e={name:t.name,type:t.type,pos:t.position.toArray(),quat:"PHYSX"===Hi.engine?[0,0,0,1]:t.quaternion.toArray()};return"PHYSX"===Hi.engine||"AMMO"===Hi.engine||"HAVOK"===Hi.engine?(e.type="terrain",e.size=t.sizeZ,e.sample=t.sampleZ,e.zone=t.zone,e.heightData=t.heightData):(e.type="mesh",e.v=Ni.getVertex(t.geometry,"OIMO"===Hi.engine),e.index="OIMO"===Hi.engine?null:Ni.getIndex(t.geometry)),e};class kr extends ds{constructor(){super(),this.Utils=Yi,this.type="solver"}step(){const t=Hi.Ar,e=Hi.ArPos[this.type];let i,s=this.list.length;for(;s--;)i=e+s*qi[this.type],this.list[s].update(t,i)}add(t={}){this.setName(t);let e=new Ar(t);return this.addToWorld(e,t.id),Hi.post({m:"add",o:t}),e}set(t={}){}}class Ar{constructor(t){this.name=t.name,this.type="solver",this.needData=t.needData||!1,this.joints=[],this.jid=0,this.speed=1}update(t,e){if(!this.needData)return;let i,s,n=this.joints.length;for(;n--;)s=e+7*n,i=this.joints[n],i.data.target.x=t[s+0],i.data.target.y=t[s+1],i.data.target.z=t[s+2],i.data.target.rx=Math.round(t[s+3]),i.data.target.ry=Math.round(t[s+4]),i.data.target.rz=Math.round(t[s+5]),i.data.target.count=t[s+6]}start(){Hi.post({m:"startArticulation",o:{name:this.name}})}stop(){Hi.post({m:"stopArticulation",o:{name:this.name}})}commonInit(){Hi.post({m:"commonInitArticulation",o:{name:this.name}})}addJoint(t){this.jid=this.joints.length,t.name=t.name||this.name+"_Joint_"+this.jid,t.solver=this.name,void 0!==t.rot1&&(t.quat1=Ni.quatFromEuler(t.rot1),delete t.rot1),void 0!==t.rot2&&(t.quat2=Ni.quatFromEuler(t.rot2),delete t.rot2),"fixe"!==t.type&&this.joints.push(new Tr(t,this)),Hi.post({m:"addSolverJoint",o:t})}driveJoints(t){let e,i,s=!1,n=this.joints.length,r=[];for(;n--;)e=this.joints[n],e.update(t),i=e.isDrive,i&&r.push(e.nup),s=!!i||s;s?Hi.motor.change(r):this.resolve&&(this.resolve(),delete this.resolve)}setAngles(t,e){if(!t)return;let i=this.joints.length;for(;i--;)this.joints[i].pose(void 0!==t[i]?t[i]:0,void 0!==e?e:this.speed);return new Promise((t=>this.resolve=t))}}class Tr{constructor(t,e){if(this.name=t.name,this.solver=e,this.type="solverJoint",this.isDrive=!1,this.current=0,this.tmp=0,this.target=0,this.start=0,this.time=0,this.nup=null,this.data={target:{x:0,y:0,z:0,rx:0,ry:0,rz:0,count:0}},t.limits&&(this.driveType=t.limits[0][0],this.min=t.limits[0][1],this.max=t.limits[0][2]),t.position){let e,i=t.position.length;for(;i--;)e=t.position[i],this.data.target[e[0]]=e[1]}}start(){}pose(t,e){this.target=Ni.clamp(t,this.min,this.max),this.current=Ni.clamp(this.data.target[this.driveType],this.min,this.max),this.target!==this.current&&(this.start=this.current,this.tmp=0,this.time=e,this.isDrive=!0)}update(t){if(this.isDrive){this.tmp+=t;let e=this.tmp/this.time;e=e>1?1:e;let i=Ni.lerp(this.start,this.target,e);this.nup={name:this.name,drivesTarget:[[this.driveType,i]]},1===e&&(this.isDrive=!1)}}}class Mr extends e.Mesh{constructor(t={}){super(new e.PlaneGeometry,new e.MeshBasicMaterial({polygonOffset:!0,polygonOffsetFactor:-4})),this.name=t.nam||"text",this.canvas=null,this.w=t.w||0,this.h=t.h||0,this.weight=t.weight??700,this.font=t.font??"'Mulish', sans-serif",this.fontSize=t.fontSize??32,this.backgroundColor=t.backgroundColor??"#00000000",this.fontColor=t.fontColor??"#FFFFFF",this.material.alphaTest=.5,this.set(t.text),t.pos&&this.position.fromArray(t.pos),t.rot&&this.quaternion.fromArray(Ni.quatFromEuler(t.rot))}set(t){this.canvas||(this.canvas=document.createElement("canvas"));let i,s,n,r=this.canvas.getContext("2d");r.font=this.weight+" "+this.fontSize+"px "+this.font;let o=r.measureText(t);i=2**Math.ceil(Math.log2(o.width)),s=2**Math.ceil(Math.log2(r.measureText("M").width)),this.canvas.width=i,this.canvas.height=s,r.fillStyle=this.backgroundColor,r.fillRect(0,0,i,s),r.fillStyle=this.fontColor,r.font=this.weight+" "+this.fontSize+"px "+this.font,r.textAlign="center",r.textBaseline="middle",r.fillText(t,.5*i,.5*s),this.material.map=new e.CanvasTexture(this.canvas),0!==this.h?(n=this.h/s,this.scale.set(i*n,this.h,0)):0!==this.w?(n=this.w/s,this.scale.set(this.w,s*n,0)):this.scale.set(.025*i,.025*s,0)}dispose(){this.parent.remove(this),this.material.map.dispose(),this.material.dispose(),this.geometry.dispose()}}let Pr=0;class Cr{constructor(t={}){this.down=!1,this.time=t.time||250,this.p=t.pos||[0,0,0],this.type=t.type||"box",this.name=t.name||"button"+Pr++,this.pos=t.pos||[0,0,0],this.size=t.size||[1,1,1],this.radius=t.radius||0,this.axe=void 0!==t.axe?t.axe:1,this.fontSize=t.fontSize||.8,this.fontScale=t.fontScale||1,this.extraForce=!0,this.decal="sphere"===this.type?.5*this.size[1]:.5*this.size[1]-this.radius,"sphere"!==this.type&&(this.pos[this.axe]+=this.decal),this.origin=this.pos[this.axe];let e=this.size[this.axe]-2*this.radius;this.range=[this.origin-e,this.origin],this.value=this.origin,this.target=this.origin,this.speed=this.size[this.axe]/3/this.size[this.axe],this.callback=function(){console.log("action down")},t.callback&&(this.callback=t.callback,delete t.callback),t.button=!0,t.pos=this.pos,t.material||(t.material="button"),t.kinematic=!0,t.mask=1,this.timeout=null,this.b=Hi.motor.add(t),this.b.userData.action=this.action.bind(this),this.b.userData.out=this.out.bind(this),this.b.userData.direct=this.callback.bind(this),t.text&&this.addText(t.text)}addText(t,e){this.fontSize="box"===this.type?.8*this.size[this.axe]:.8*this.size[0],this.fontSize*=this.fontScale;let i={text:t,pos:[0,.5*this.size[1],0],rot:[-90,0,0],h:this.fontSize};2===this.axe&&(i={text:t,pos:[0,0,.5*this.size[2]],rot:[0,0,0],h:this.fontSize}),this.txt=new Mr(i),this.b.add(this.txt)}action(t){this.down||(this.down=!0,this.target=this.range[0],this.extraForce&&Hi.motor.explosion(t||this.p,2*this.size[0],.01),this.callback())}out(){this.down&&(this.down=!1,this.target=this.range[1],this.extraForce&&Hi.motor.explosion(this.p,2*this.size[0],.01))}update(){if(this.value!==this.target){this.value=Ni.lerp(this.value,this.target,this.speed),Ni.nearEquals(this.value,this.target,1e-4)?this.value=this.target:(this.pos[this.axe]=this.value,Hi.motor.change({name:this.b.name,pos:this.pos}))}}dispose(){this.txt&&this.txt.dispose()}}class _r{constructor(t={}){this.isCompound=!0,this.remplace=t.remplace||!1,this.init(t)}init(t={}){let i=t.size||[5,3,8],s=t.pos||[0,2,0],n=t.wall||.1,r=.5*n,o=2*n;t.face||(t.face={});let a={up:1,down:1,left:1,right:1,front:1,back:1,...t.face};delete t.face;const l=[];1===a.up&&l.push({pos:[0,.5*i[1]-r,0],size:[i[0],n,i[2]]}),1===a.down&&l.push({pos:[0,r-.5*i[1],0],size:[i[0],n,i[2]]}),1===a.left&&l.push({pos:[r-.5*i[0],0,0],size:[n,i[1]-o,i[2]]}),1===a.right&&l.push({pos:[.5*i[0]-r,0,0],size:[n,i[1]-o,i[2]]}),1===a.back&&l.push({pos:[0,0,r-.5*i[2]],size:[i[0]-o,i[1]-o,n]}),1===a.front&&l.push({pos:[0,0,.5*i[2]-r],size:[i[0]-o,i[1]-o,n]});const h=[];let c,u,d=l.length,p=0;for(;d--;)u=l[p],c=this.isCompound?u.pos:Ni.addArray(s,u.pos),h.push({type:"box",size:u.size,pos:c,material:t.material}),p++;if(this.isCompound){let s=null;this.remplace&&(s=new e.Mesh(new Ls(i[0],i[1],i[2],t.radius||r))),Hi.motor.add({...t,mesh:s,shapes:h,type:"compound"})}else Hi.motor.add(h)}}class Rr{constructor(t,i="drag"){this.needRay=!0,this.moveDirect=!1,this.moveDeep=!1,this.mode=i,this.option={},this.controler=t,this.dom=this.controler.domElement,this.selected=null,this.buttonRef=null,this.release=!1,this.numBullet=0,this.maxBullet=10,this.sticky=!1,this.pz=0,this.isActive=!1,this.raycastTest=!1,this.firstSelect=!1,this.mouseDown=!1,this.mouseDown2=!1,this.mouseMove=!1,this.decal=new e.Vector3,this.tmpPos=new e.Vector3,this.tmpD=new e.Vector3,this.mouse=new e.Vector2,this.oldMouse=new e.Vector2,this.raycast=new e.Raycaster,this.raycast.far=1e3,this.button=0,this.pos=new e.Vector3,this.velocity=new e.Vector3,this.angle=0,this.helper=null,this.dragPlane=null,this.activeDragMouse(!0)}addDrag(){this.dragPlane||(this.helper=new Er,this.dragPlane=new e.Mesh(new e.PlaneGeometry(1,1),cs.get("hide")),this.dragPlane.castShadow=!1,this.dragPlane.receiveShadow=!1,this.dragPlane.scale.set(1,1,1).multiplyScalar(200),Hi.scenePlus.add(this.helper),Hi.scenePlus.add(this.dragPlane))}clearDrag(){this.dragPlane&&(Hi.scenePlus.remove(this.dragPlane),Hi.scenePlus.remove(this.helper),this.dragPlane.geometry.dispose(),this.helper.geometry.dispose(),this.dragPlane=null,this.helper=null)}setMode(t,e={}){t!==this.mode&&(this.mode=t,this.option=e,"blast"===this.mode&&this.option.visible&&Hi.motor.initParticle())}activeDragMouse(t){t?this.isActive||(this.dom.addEventListener("pointermove",this.mousemove.bind(this),!1),this.dom.addEventListener("pointerdown",this.mousedown.bind(this),!1),document.addEventListener("pointerup",this.mouseup.bind(this),!1),document.addEventListener("contextmenu",this.contextmenu.bind(this),!1),this.controler.addEventListener("end",this.controleEnd.bind(this),!1),this.controler.addEventListener("change",this.controleChange.bind(this),!1),this.isActive=!0,this.raycastTest=!0):this.isActive&&(this.dom.removeEventListener("pointermove",this.mousemove.bind(this)),this.dom.removeEventListener("pointerdown",this.mousedown.bind(this)),document.removeEventListener("pointerup",this.mouseup.bind(this)),this.controler.removeEventListener("end",this.controleEnd.bind(this)),this.controler.removeEventListener("change",this.controleChange.bind(this)),this.isActive=!1)}controleEnd(t){this.raycastTest=!0,this.controler.getInfo&&this.controler.getInfo()}controleChange(t){-1!==this.controler.getState()&&(this.raycastTest=!1)}getMouse(t){Hi.viewSize?(this.mouse.x=t.offsetX/Hi.viewSize.w*2-1,this.mouse.y=-t.offsetY/Hi.viewSize.h*2+1):(this.mouse.x=t.offsetX/this.dom.clientWidth*2-1,this.mouse.y=-t.offsetY/this.dom.clientHeight*2+1),this.button="touch"!==t.pointerType?t.button:0}contextmenu(t){t.preventDefault()}mousedown(t){switch(this.sticky&&(this.unSelect(),console.log("unstick")),this.getMouse(t),this.mode){case"drag":this.drag();break;case"shoot":this.shoot();break;case"blast":this.blast()}}mouseup(t){this.release=!0,document.body.style.cursor="auto",this.mouseMove=!(this.oldMouse.distanceTo(this.mouse)<.01),this.mouseDown=!1,this.mouseDown2=!1,Hi.mouseDown=!1,this.sticky?this.controler.enabled=!0:(this.unSelect(),this.resetButton())}mousemove(t){if("drag"===this.mode)this.getMouse(t),this.needRay=!0}castray(){let t,e,i,s,n,r="auto";if(null!==this.selected)this.raycast.setFromCamera(this.mouse,this.controler.object),t=this.raycast.intersectObject(this.dragPlane),t.length&&this.mouseDown&&this.moveSelect(t[0].point);else{if(!this.raycastTest)return;this.controler.enableRotate=!1,this.controler.enablePan=!1,this.raycast.setFromCamera(this.mouse,this.controler.object),t=this.raycast.intersectObjects(Hi.scene.children,!0),this.tmpSelected=null,t.length>0?(i=t[0].object,n=t[0].instanceId,void 0!==n?e=Hi.motor.byName(i.name+n):i.parent!==Hi.scene?(s=i.parent,e=s.parent!==Hi.scene?s.parent:s):e=i,this.mouseDown2&&e.extra&&e.extra(e.name),r=e.isButton?this.actionButton(e,t[0]):this.select(e,t[0].point)):(this.controler.enableRotate=!0,this.controler.enablePan=!0),this.release&&(this.release=!1,this.controler.enableRotate=!0,this.controler.enablePan=!0,r="auto"),document.body.style.cursor=r}}drag(){this.mouseDown||(this.firstSelect&&(this.firstSelect=!1),this.oldMouse.copy(this.mouse)),2===this.button&&(this.mouseDown2=!0),this.mouseDown=!0,Hi.mouseDown=!0,this.needRay=!0}blast(){let t=null;this.raycast.setFromCamera(this.mouse,this.controler.object);let e=this.raycast.intersectObjects(Hi.scene.children,!0);e.length>0?e[0].object.isButton?e[0].object.parent.userData.direct():t=e[0]:(e=this.raycast.intersectObjects(Hi.scenePlus.children,!0),e.length>0&&(t=e[0]));const i=this.option;t&&(Hi.motor.explosion(t.point,i.radius||3,i.power||.1),i.visible&&Hi.motor.addParticle({name:"blast",type:"cube",position:t.point.toArray(),numParticles:60,radius:.2,radiusRange:.1,acceleration:[50,5,50],lifeTime:.5,endTime:.5,startTime:0,gravity:[0,.2,0],startSize:.5,endSize:.1,tween:"outQuad"}))}shoot(){this.raycast.setFromCamera(this.mouse,this.controler.object),this.pos.copy(this.raycast.ray.direction).add(this.raycast.ray.origin),this.velocity.copy(this.raycast.ray.direction).multiplyScalar(60),Hi.motor.add({name:"bullet_"+this.numBullet,type:"sphere",density:20,size:[.2],material:"chrome",pos:this.pos.toArray(),linearVelocity:this.velocity.toArray(),bullet:!0}),this.numBullet++,this.numBullet>this.maxBullet&&(this.numBullet=0)}resetButton(){this.buttonRef&&(this.buttonRef.userData.out&&this.buttonRef.userData.out(),this.buttonRef=null),this.raycastTest=!0,this.selected=null,this.firstSelect=!0,this.controler.enableRotate=!0,this.controler.enablePan=!0}actionButton(t,e){if(this.buttonRef?this.buttonRef.name!==t.name&&(this.buttonRef.userData.out&&this.buttonRef.userData.out(),this.buttonRef=t):this.mouseDown&&(this.buttonRef=t),this.mouseDown&&this.buttonRef.userData.action){let t=e.point;this.buttonRef.userData.action(t)}return"pointer"}select(t,e){if(!this.mouseDown||this.selected===t)return"grab";this.pz=0;let i=e,s=[0,0,0,1];this.selected=t,this.decal.copy(i).sub(this.selected.position),this.tmpPos.copy(i).sub(this.decal),this.angle=this.controler.getAzimuthalAngle();let n=this.selected.quaternion;s=[n._x,n._y,n._z,n._w],this.addDrag(),this.dragPlane.rotation.set(0,this.angle,0),this.dragPlane.position.copy(i),this.dragPlane.position.y=0,this.helper.position.copy(i);let r=i.toArray(),o=!1;if(Hi.motor.change({name:this.selected.name,neverSleep:!0,wake:!0}),this.moveDirect)Hi.motor.change({name:this.selected.name,kinematic:!1,gravity:!1,damping:[.9,.9]});else{let t=[-.1,.1,60,1],e=[-.1,.1,60,1],i="OIMO"===Hi.engine||"RAPIER"===Hi.engine,n=0===this.selected.link?"fixe":"d6",a=[["x",...t],["y",...t],["z",...t],["rx",...e],["ry",...e],["rz",...e]];"HAVOK"===Hi.engine&&(a=[["x",...t],["y",...t],["z",...t]]),"OIMO"===Hi.engine&&(o=!0,n=0===this.selected.link?"fixe":"spherical",a=[["x",...t],["y",...t],["z",...t]]),"HAVOK"===Hi.engine&&(o=!0,n=0===this.selected.link?"fixe":"spherical",a=[-180,180,.1,.1]),Hi.motor.add([{name:"mouse",type:"null",pos:r,quat:s,kinematic:!i},{name:"mouseJoint",type:"joint",mode:n,lm:a,sd:[4,1],autoDrive:!0,b1:o?this.selected.name:"mouse",b2:o?"mouse":this.selected.name,worldAnchor:r,visible:!1}])}return"grabbing"}moveSelect(t){if(null===this.selected)return;if(t&&this.tmpPos.copy(t).sub(this.decal),this.moveDeep){let t=this.selected.position.y,e=t-this.tmpPos.y;this.tmpPos.y=t,this.tmpD.set(0,0,e).applyAxisAngle({x:0,y:1,z:0},this.angle),this.tmpPos.add(this.tmpD)}this.helper.position.copy(this.tmpPos);let e=this.tmpPos.toArray();this.moveDirect?Hi.motor.change({name:this.selected.name,pos:e,reset:!0}):Hi.motor.change({name:"mouse",pos:t.toArray(),lockPos:!0},!0)}unSelect(){null!==this.selected&&(this.clearDrag(),this.moveDirect?Hi.motor.change({name:this.selected.name,kinematic:!1,wake:!0,gravity:!0,damping:[0,.1]}):(Hi.motor.remove(["mouseJoint","mouse"]),Hi.motor.change({name:this.selected.name,neverSleep:!1,wake:!0})),this.raycastTest=!0,this.selected=null,this.firstSelect=!0)}step(){if(this.needRay&&this.castray(),this.needRay=!1,null===this.selected)return;let t=Hi.flow.key;if(0!==t[1]){let e=.1*t[1];this.dragPlane.translateZ(e),this.needRay=!0}this.moveDirect&&this.moveSelect()}}class Er extends e.Line{constructor(t={}){super(new e.BufferGeometry,cs.get("line"));let i=.75;const s=[i,i,i,0,0,0];this.geometry.setAttribute("position",new e.Float32BufferAttribute([0,0,0,0,-100,0],3)),this.geometry.setAttribute("color",new e.Float32BufferAttribute(s,3)),this.vertices=this.geometry.attributes.position,this.colors=this.geometry.attributes.color,this.local=[0,0,0,0,0,0,0,0,0],this.frustumCulled=!1}}const Qr=new e.Vector3;class Lr{constructor(t=1.4,i=1e-4){this.minSizeForBreak=t,this.smallDelta=i,this.tempLine1=new e.Line3,this.tempPlane1=new e.Plane,this.tempPlane2=new e.Plane,this.tempPlane_Cut=new e.Plane,this.tempCM1=new e.Vector3,this.tempCM2=new e.Vector3,this.tempVector3=new e.Vector3,this.tempVector3_2=new e.Vector3,this.tempVector3_3=new e.Vector3,this.tempVector3_P0=new e.Vector3,this.tempVector3_P1=new e.Vector3,this.tempVector3_P2=new e.Vector3,this.tempVector3_N0=new e.Vector3,this.tempVector3_N1=new e.Vector3,this.tempVector3_AB=new e.Vector3,this.tempVector3_CB=new e.Vector3,this.tempResultObjects={object1:null,object2:null},this.box1=new e.Box3,this.box2=new e.Box3,this.sph1=new e.Sphere,this.sph2=new e.Sphere,this.tt=new e.Vector3,this.s1=new e.Vector3,this.s2=new e.Vector3,this.segments=[];for(let t=0;t<900;t++)this.segments[t]=!1}prepareBreakableObject(t,e,i,s,n){const r=t.userData;r.mass=e,r.velocity=i.clone(),r.angularVelocity=s.clone(),r.breakable=n}subdivideByImpact(t,e,i,s,n){const r=[],o=this.tempPlane1,a=this.tempPlane2;this.tempVector3.addVectors(e,i),o.setFromCoplanarPoints(e,t.position,this.tempVector3);const l=n+s,h=this;return function n(c,u,d,p){if(Math.random()<.05*p||p>l)return void r.push(c);let f=Math.PI;0===p?(a.normal.copy(o.normal),a.constant=o.constant):p<=s?(f=(d-u)*(.2+.6*Math.random())+u,h.tempVector3_2.copy(t.position).sub(e).applyAxisAngle(i,f).add(e),a.setFromCoplanarPoints(e,h.tempVector3,h.tempVector3_2)):(f=(.5*(1&p)+.2*(2-Math.random()))*Math.PI,h.tempVector3_2.copy(e).sub(c.position).applyAxisAngle(i,f).add(c.position),h.tempVector3_3.copy(i).add(c.position),a.setFromCoplanarPoints(c.position,h.tempVector3_3,h.tempVector3_2)),h.cutByPlane(c,a,h.tempResultObjects);const m=h.tempResultObjects.object1,g=h.tempResultObjects.object2;m&&n(m,u,f,p+1),g&&n(g,f,d,p+1)}(t,0,2*Math.PI,0),r}cutByPlane(t,i,s){let n;const r=t.geometry,o=r.attributes.position.array,a=r.attributes.normal.array,l=o.length/3;let h=l/3,c=r.getIndex();function u(t,e){const i=3*t+e;return c?c[i]:i}c&&(c=c.array,h=c.length/3);const d=[],p=[],f=this.smallDelta,m=l*l;for(let t=0;t<m;t++)this.segments[t]=!1;const g=this.tempVector3_P0,v=this.tempVector3_P1,y=this.tempVector3_N0,b=this.tempVector3_N1;for(let t=0;t<h-1;t++){const e=u(t,0),i=u(t,1),s=u(t,2);y.set(a[e],a[e]+1,a[e]+2);for(let n=t+1;n<h;n++){const t=u(n,0),r=u(n,1),o=u(n,2);b.set(a[t],a[t]+1,a[t]+2);1-y.dot(b)<f&&(e===t||e===r||e===o?i===t||i===r||i===o?(this.segments[e*l+i]=!0,this.segments[i*l+e]=!0):(this.segments[s*l+e]=!0,this.segments[e*l+s]=!0):i!==t&&i!==r&&i!==o||(this.segments[s*l+i]=!0,this.segments[i*l+s]=!0))}}const x=this.tempPlane_Cut;t.updateMatrix(),Lr.transformPlaneToLocalSpace(i,t.matrix,x);for(let t=0;t<h;t++){const i=u(t,0),n=u(t,1),r=u(t,2);for(let t=0;t<3;t++){const a=0===t?i:1===t?n:r,h=0===t?n:1===t?r:i;if(this.segments[a*l+h])continue;this.segments[a*l+h]=!0,this.segments[h*l+a]=!0,g.set(o[3*a],o[3*a+1],o[3*a+2]),v.set(o[3*h],o[3*h+1],o[3*h+2]);let c=0,u=x.distanceToPoint(g);u>f?(c=2,p.push(g.clone())):u<-f?(c=1,d.push(g.clone())):(c=3,d.push(g.clone()),p.push(g.clone()));let m=0;if(u=x.distanceToPoint(v),u>f?(m=2,p.push(v.clone())):u<-f?(m=1,d.push(v.clone())):(m=3,d.push(v.clone()),p.push(v.clone())),1===c&&2===m||2===c&&1===m){this.tempLine1.start.copy(g),this.tempLine1.end.copy(v);let t=new e.Vector3;if(t=x.intersectLine(this.tempLine1,t),null===t)return console.error("Internal error: segment does not intersect plane."),s.segmentedObject1=null,s.segmentedObject2=null,0;d.push(t),p.push(t.clone())}}}t.userData.mass;let O=this.box1,w=this.box2,S=d.length,k=p.length;for(O.makeEmpty(),w.makeEmpty(),n=S;n--;)O.expandByPoint(d[n]);for(n=k;n--;)w.expandByPoint(p[n]);for(O.getBoundingSphere(this.sph1),w.getBoundingSphere(this.sph2),this.tempCM1.copy(this.sph1.center),this.tempCM2.copy(this.sph2.center),n=S;n--;)d[n].sub(this.tempCM1);for(n=k;n--;)p[n].sub(this.tempCM2);this.tempCM1.add(t.position),this.tempCM2.add(t.position),O.getSize(this.s1),w.getSize(this.s2),2*this.sph1.radius<this.minSizeForBreak&&(S=0),2*this.sph2.radius<this.minSizeForBreak&&(k=0),this.testSize(this.s1)&&(S=0),this.testSize(this.s2)&&(k=0);let A=null,T=null,M=0;return S>4&&(A=new e.Mesh(new qs(d),t.material),A.position.copy(this.tempCM1),A.quaternion.copy(t.quaternion),M++),k>4&&(T=new e.Mesh(new qs(p),t.material),T.position.copy(this.tempCM2),T.quaternion.copy(t.quaternion),M++),s.object1=A,s.object2=T,M}testSize(t){let e=0;return t.x<.01&&e++,t.y<.01&&e++,t.z<.01&&e++,e>1}static transformFreeVector(t,e){const i=t.x,s=t.y,n=t.z,r=e.elements;return t.x=r[0]*i+r[4]*s+r[8]*n,t.y=r[1]*i+r[5]*s+r[9]*n,t.z=r[2]*i+r[6]*s+r[10]*n,t}static transformFreeVectorInverse(t,e){const i=t.x,s=t.y,n=t.z,r=e.elements;return t.x=r[0]*i+r[1]*s+r[2]*n,t.y=r[4]*i+r[5]*s+r[6]*n,t.z=r[8]*i+r[9]*s+r[10]*n,t}static transformTiedVectorInverse(t,e){const i=t.x,s=t.y,n=t.z,r=e.elements;return t.x=r[0]*i+r[1]*s+r[2]*n-r[12],t.y=r[4]*i+r[5]*s+r[6]*n-r[13],t.z=r[8]*i+r[9]*s+r[10]*n-r[14],t}static transformPlaneToLocalSpace(t,e,i){i.normal.copy(t.normal),i.constant=t.constant;const s=Lr.transformTiedVectorInverse(t.coplanarPoint(Qr),e);Lr.transformFreeVectorInverse(i.normal,e),i.constant=-s.dot(i.normal)}}class Fr{constructor(){this.convexBreaker=new Lr,this.tmpI=new THREE.Vector3,this.tpos=new THREE.Vector3,this.tnormal=new THREE.Vector3,this.nDebris=0,this.maxDebris=300,this.tt=null}step(){let t;for(let e in Hi.reflow.point)t=Hi.reflow.point[e],0!==t.distance&&(this.makeBreak(t.b1,t.pos,t.normal,t.impulse,t.v1),this.makeBreak(t.b2,t.pos,t.normal,t.impulse,t.v2))}makeBreak(t,e,i,s,n){let r=Yi.byName(t);if(!r)return;if(!r.breakable)return;let o=r.breakOption;if(s<o[0])return;let a=this.convexBreaker.subdivideByImpact(r,this.tpos.fromArray(e),this.tnormal.fromArray(i),o[1],o[2]);if(a.length<1)return;o[3]-=1;const l={material:r.material,linearVelocity:[n[0],n[1],n[2]],angularVelocity:[n[3],n[4],n[5]],density:r.density};let h=[],c=a.length,u=0;for(;c--;)h.push(this.addDebris(a[u],o,l)),u++;this.tt=setTimeout((()=>{Hi.motor.remove(t),Hi.motor.add(h)}),0)}addDebris(t,e,i){let s=e[3]>0,n={...i,name:"debris_"+this.nDebris++,type:"convex",shape:t.geometry,pos:t.position.toArray(),quat:t.quaternion.toArray(),breakable:s,breakOption:e};return this.nDebris>this.maxDebris&&(this.nDebris=0),n}}new e.Vector3;const Ir=new e.Vector3,Dr=new e.Vector3,Ur=new e.Vector3,zr=new e.Vector3,Nr=new e.Vector3;class Vr{constructor(t={}){this.name=t.name||"ppp",this.particles=[],this.density=.01,this.smoothingRadius=.2,this.speedOfSound=.1,this.viscosity=.03,this.eps=1e-6,this.group=256,this.pressures=[],this.densities=[],this.neighbors=[],this.tv=new e.Vector3,this.tv2=new e.Vector3}add(t){let i=Hi.motor.add({instance:this.name,type:"particle",flags:"noQuery",size:[.1],pSize:.03,pos:t,inertia:[0,0,0],mass:.001,restitution:0,friction:.5,damping:[.1,.1],material:"hide"});i.force=new e.Vector3,this.particles.push(i),this.neighbors.length<this.particles.length&&this.neighbors.push([])}connect(t){let e=t.length;console.log(e);let i,s,n,r=[],o=0;for(;e--;)i=t[e],this.name,i[0],this.name,i[1],s=this.particles[i[0]].position,n=this.particles[i[1]].position,o=this.tv.copy(s).distanceTo(n),this.tv.copy(n).sub(s),r.push({type:"distance",helperSize:.03,b1:this.name+i[0],b2:this.name+i[1],limit:[.5*o,o],spring:[20,1],friction:0});Hi.motor.add(r)}getPosition(){let t,e,i=[],s=this.particles.length;for(;s--;)e=3*s,t=this.particles[s],i[e]=t.position.x,i[e+1]=t.position.y,i[e+2]=t.position.z;return i}getNeighbors(t,e){const i=this.particles.length,s=t.id,n=this.smoothingRadius*this.smoothingRadius;let r=0;for(let o=0;o!==i;o++){const i=this.particles[o];r=this.distance(i,t),s!==i.id&&r<n&&e.push(i)}}distance(t,e){const i=t.position.x-e.position.x,s=t.position.y-e.position.y,n=t.position.z-e.position.z;return i*i+s*s+n*n}w(t){const e=this.smoothingRadius;return 315/(64*Math.PI*e**9)*(e*e-t*t)**3}gradw(t,e){const i=t.length(),s=this.smoothingRadius;e.copy(t).multiplyScalar(945/(32*Math.PI*s**9)*(s*s-i*i)**2)}nablaw(t){const e=this.smoothingRadius;return 945/(32*Math.PI*e**9)*(e*e-t*t)*(7*t*t-3*e*e)}update(){const t=[],e=this.particles.length,i=this.speedOfSound,s=this.eps;let n,r=e;for(;r--;){const t=this.particles[r];t.force.set(0,0,0);const e=this.neighbors[r];e.length=0,this.getNeighbors(t,e),e.push(this.particles[r]);let s=0;for(n=e.length;n--;){const i=this.w(this.distance(t,e[n]));s+=e[n].mass*i}this.densities[r]=s,this.pressures[r]=i*i*(this.densities[r]-this.density)}const o=Ir,a=Dr,l=Ur,h=zr,c=Nr;for(r=e;r--;){const e=this.particles[r];let i,u;o.set(0,0,0),a.set(0,0,0);const d=this.neighbors[r];for(n=d.length;n--;){const t=d[n];h.copy(e.position).sub(t.position);const p=h.length();i=-t.mass*(this.pressures[r]/(this.densities[r]*this.densities[r]+s)+this.pressures[n]/(this.densities[n]*this.densities[n]+s)),this.gradw(h,l),l.multiplyScalar(i),o.add(l),c.copy(t.velocity).sub(e.velocity),c.multiplyScalar(1/(1e-4+this.densities[r]*this.densities[n])*this.viscosity*t.mass),u=this.nablaw(p),c.multiplyScalar(u),a.add(c)}a.multiplyScalar(e.mass),o.multiplyScalar(e.mass),e.force.add(a),e.force.add(o),t.push({name:e.name,force:e.force.toArray()})}Hi.motor.change(t)}}const Br=new e.Matrix4,$r=new e.Matrix4;new e.Vector3;let Xr,jr=e.Skeleton.prototype;jr.byName=function(t){let e=this.bones.length;for(;e--;)if(this.bones[e].name===t)return this.bones[e];return null},jr.getId=function(t){let e=this.bones.length;for(;e--;)if(this.bones[e].name===t)return e;return null},jr.setExtraRotation=function(t,i,s,n){(t.isBone?t:this.byName(t))&&e.MathUtils.DEG2RAD},jr.setScalling=function(t,i,s,n){let r=t.isBone?t:this.byName(t);r&&(r.scalling=new e.Vector3(i,s,n))},jr.resetScalling=function(t){this.pose(),this.scalled=!0;for(let t=0,i=this.bones.length;t<i;t++)this.bones[t].isPhysics=!1,this.bones[t].phyMtx=new e.Matrix4;t||this.applyScalling()},jr.childScale=function(t,e){if(!this.scalled)return;t.scalling&&e.scale(t.scalling);let i,s=t.children.length;for(;s--;)i=t.children[s],i.isBone,i.matrixWorld.multiplyMatrices(e,i.matrix)},jr.applyScalling=function(t){let e,i,s,n=this.bones.length;for(i=0;i<n;i++)e=this.bones[i],s=e.parent||null,null!==s&&s.scalling&&"root"!==e.name&&(e.position.multiply(s.scalling),e.updateMatrixWorld(!0));this.calculateInverses()},jr.update=function(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;let n,r=t.length,o=0;for(;r--;){n=t[o];const s=n?n.isPhysics?n.phyMtx:n.matrixWorld:$r;n.isPhysics&&(this.scalled=!0),this.childScale(n,s),Br.multiplyMatrices(s,e[o]),Br.toArray(i,16*o),o++}null!==s&&(s.needsUpdate=!0)};let Gr=null,Zr=null,qr=null,Wr=!1,Hr=!1,Yr=!1,Kr=!0,Jr=!1,to=null,eo={t1:0,t2:0,t3:0,t4:0},io=null,so=!1,no=null,ro=null,oo=!0,ao=null,lo=null,ho=0,co=0;const uo=new class{constructor(){this.key=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.key2=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.gamepad=new us(this.key),this.useGamepad=!1,this.sameAxis=!0,document.addEventListener("keydown",function(t){this.keyDown(t)}.bind(this),!1),document.addEventListener("keyup",function(t){this.keyUp(t)}.bind(this),!1)}setKey(t,e){this.key[t]=e}update(){return this.gamepad.update(),this.gamepad.ready&&(this.useGamepad||(this.useGamepad=!0),this.gamepad.getValue(0)),this.sameAxis&&(this.key[2]=this.key[0],this.key[3]=this.key[1]),this.key}keyDown(t){var e=this.key,i=this.key2;if(t=t||window.event,this.sameAxis)switch(t.which){case 65:case 81:case 37:e[0]=-1,i[0]=1;break;case 68:case 39:e[0]=1,i[1]=1;break;case 87:case 90:case 38:e[1]=-1;break;case 83:case 40:e[1]=1;break;case 32:e[4]=1;break;case 17:case 67:e[5]=1;break;case 69:e[6]=1;break;case 16:e[7]=1}else switch(t.which){case 65:case 81:e[0]=-1,i[0]=1;break;case 68:e[0]=1,i[1]=1;break;case 87:case 90:e[1]=-1;break;case 83:e[1]=1;break;case 37:e[2]=-1,i[0]=1;break;case 39:e[2]=1,i[1]=1;break;case 38:e[3]=-1;break;case 40:e[3]=1;break;case 32:e[4]=1;break;case 17:case 67:e[5]=1;break;case 69:e[6]=1;break;case 16:e[7]=1}this.gamepad.reset()}keyUp(t){var e=this.key,i=this.key2;if(t=t||window.event,this.sameAxis)switch(t.which){case 65:case 81:case 37:e[0]=e[0]<0?0:e[0],i[0]=0;break;case 68:case 39:e[0]=e[0]>0?0:e[0],i[1]=0;break;case 87:case 90:case 38:e[1]=e[1]<0?0:e[1];break;case 83:case 40:e[1]=e[1]>0?0:e[1];break;case 32:e[4]=0;break;case 17:case 67:e[5]=0;break;case 69:e[6]=0;break;case 16:e[7]=0}else switch(t.which){case 65:case 81:e[0]=e[0]<0?0:e[0],i[0]=0;break;case 68:e[0]=e[0]>0?0:e[0],i[1]=0;break;case 87:case 90:e[1]=e[1]<0?0:e[1];break;case 83:e[1]=e[1]>0?0:e[1];break;case 37:e[2]=e[2]<0?0:e[2],i[0]=0;break;case 39:e[2]=e[2]>0?0:e[2],i[1]=0;break;case 38:e[3]=e[3]<0?0:e[3];break;case 40:e[3]=e[3]>0?0:e[3];break;case 32:e[4]=0;break;case 17:case 67:e[5]=0;break;case 69:e[6]=0;break;case 16:e[7]=0}}},po=new class{constructor(t=-1){this.time={now:0,delta:0,then:0,interval:0,tmp:0,n:0,dt:0},this.fps=0,this.delta=0,this.elapsedTime=0,this.unlimited=!1,this.setFramerate(t),this.force=!1}up(t=0){let e=this.time;return this.unlimited&&(this.force=!0),e.now=t,e.delta=e.now-e.then,this.force&&(e.delta=e.interval,this.force=!1),!!(e.delta>=e.interval||this.unlimited)&&(e.then=this.unlimited?e.now:e.now-e.delta%e.interval,this.delta=.001*e.interval,this.elapsedTime+=this.delta,!0)}setFramerate(t){this.elapsedTime=0,this.framerate=t,this.unlimited=this.framerate<0,this.time.interval=1e3/t,60===t&&(this.time.interval=16.67)}}(60);let fo=function(){return 0},mo=function(){},go=function(){},vo=function(){},yo=[],bo=[],xo=[];const Oo={fps:60,fixe:!0,full:!1,substep:2,gravity:[0,-9.81,0]};class wo{static getSetting(){return Oo}static setGravity(){Hi.post({m:"setGravity",o:{gravity:Oo.gravity}})}static set(t={}){Oo.fixe=void 0===t.fixe||t.fixe,Oo.full=void 0!==t.full&&t.full,Oo.gravity=t.gravity?t.gravity:[0,-9.81,0],Oo.substep=t.substep?t.substep:2,Oo.fps=t.fps?t.fps:60,t.key&&vo(),Xr.body.setFull(Oo.full),wo.initArray(Oo.full),co=0,Yr=Wr,Kr=!Yr,Hi.jointVisible=t.jointVisible||!1,Kr&&po.setFramerate(Oo.fps);const e={...Oo,ArPos:Hi.ArPos,isTimeout:Yr,outsideStep:Kr};Hi.post({m:"set",o:e})}static math=Ni;static activeMouse(t,e){io||(io=new Rr(t,e))}static mouseMode(t,e){io&&io.setMode(t,e)}static getTimeTest(){return eo}static setMaxFps(t){}static getMouse(){return io?io.mouse:null}static setMaxAnisotropy(t){Li.maxAnisotropy=t}static setAddControl(t){vo=t}static setPostUpdate(t){go=null!==t?t:function(){}}static setAzimut(t){fo=t}static setKey(t,e){return uo.setKey(t,e)}static getKey(){return uo.key}static getKey2(){return uo.key2}static getAzimut(){return fo()}static setContent(t){Hi.threeScene=t,t.add(Hi.scene),t.add(Hi.scenePlus)}static setControl(t){ro=t,fo=ro.getAzimuthalAngle}static message(t){let e=t.data;e.Ar&&(Hi.Ar=e.Ar),e.reflow&&(Hi.reflow=e.reflow,Hi.reflow.stat.delta&&(co+=Hi.reflow.stat.delta)),wo[e.m](e.o)}static post(t,e=null,i=!1){Wr?(t.o&&("solver"!==t.o.type&&void 0===t.o.solver||(i=!0)),i?qr.postMessage(t,e):"add"===t.m?Hi.flow.add.push(t.o):"remove"===t.m?Hi.flow.remove.push(t.o):qr.postMessage(t,e)):no({data:t})}static makeView(){}static getScene(){return Hi.scene}static resize(t){Hi.viewSize=t}static init(t={}){let i=document.location.href.replace(/\/[^/]*$/,"/");var s=i.split("/");i=s[0]+"//"+s[2]+"/","https://lo-th.github.io/"===i&&(i="https://lo-th.github.io/phy/");const n=t.path||"build/",r={Ammo:n+"ammo3.wasm.js",Physx:n+"physx-js-webidl.js",Havok:n+"HavokPhysics.js"};let o=t.type||"PHYSX",a=o.toLowerCase(),l=a.charAt(0).toUpperCase()+a.slice(1);if(navigator.userAgent.toLowerCase().indexOf("firefox"),Hi.engine=o,wo.initItems(),Li.materialRoot=cs.set,t.callback&&(Zr=t.callback,delete t.callback),Wr=t.worker||!1,Hi.scene=new e.Group,Hi.scene.name="phy_scene",Hi.scenePlus=new e.Group,Hi.scenePlus.name="phy_scenePlus",t.scene&&(wo.setContent(t.scene),delete t.scene),Hi.post=wo.post,Hi.motor=wo,Wr){r[l]&&(t.blob=i+r[l]),qr=new Worker(i+n+l+".min.js"),qr.postMessage=qr.webkitPostMessage||qr.postMessage,qr.onmessage=wo.message;let e=new ArrayBuffer(1);qr.postMessage({m:"test",ab:e},[e]),Hr=!e.byteLength,t.isBuffer=Hr,console.log(" Worker "+o+(t.isBuffer?" with Shared Buffer":"")),wo.initPhysics(t)}else r[l]?wo.loadWasmDirect(r[l],t,l,i):wo.preLoad(l,t,i)}static loadWasmDirect(t,e,i,s){let n=document.createElement("script");n.src=s+t,document.body.appendChild(n),n.onload=()=>{wo.preLoad(i,e,s)}}static async preLoad(t,e,i){let s=await import(e.devMode?i+"src/"+t+".js":i+"build/"+t+".module.js");no=s.engine.message,e.message=wo.message,wo.initPhysics(e)}static initPhysics(t){Hi.post({m:"init",o:t}),Jr=!0}static getPause(){return so}static pause(t){t!==so&&(so=t,so?wo.pausetimout():wo.playtimout(),Hi.post({m:"pause",o:{value:so}}))}static flowReset(){Hi.flow={stamp:0,current:"",key:[],tmp:[],add:[],remove:[]}}static reset(t){if(oo)return oo=!1,void t();yo=[],wo.clearText(),wo.clearParticleSolver(),wo.cleartimout(),Gr=null,ro&&ro.resetAll(),io&&io.unSelect(),mo=t,go=function(){},wo.flowReset(),wo.clearInstance(),wo.resetItems(),ns(),cs.dispose(),Hi.disposeTmp(),null!==to&&(to=null),Hi.tmpTex=[],Hi.scenePlus.children=[],Hi.scene.children=[],Hi.post({m:"reset"})}static resetCallback(){mo()}static ready(){console.log((Wr?"Worker ":"Direct ")+Hi.engine+" is ready !"),Zr&&Zr()}static start(t={}){Hi.post({m:"start",o:t})}static morph(t,e,i){Yi.morph(t,e,i)}static getFps(){return Hi.reflow.stat.fps}static getDelta2(){return Hi.reflow.stat.delta}static getElapsedTime2(){return co}static getDelta(){return po.delta}static getElapsedTime(){return po.elapsedTime}static doStep(t){Jr&&Kr&&po.up(t)&&Hi.post({m:"step",o:t})}static step(){Hi.delta=Hi.reflow.stat.delta,wo.stepItems(),Hi.flow.key=uo.update(),Hi.flow.current=null!==Gr?Gr.name:"",null!==to&&to.step(),null!==Gr&&Gr.move(),io&&io.step(),go(po.delta),wo.changes(Hi.flow.tmp),Hr?Hi.post({m:"poststep",flow:Hi.flow,Ar:Hi.Ar},[Hi.Ar.buffer]):Hi.post({m:"poststep",flow:Hi.flow}),wo.flowReset()}static initArray(t=!1){Hi.ArPos=function(t,e=!1){let i={},s={body:Vi*(e?qi.bodyFull:qi.body),joint:Bi*qi.joint,ray:Xi*qi.ray,contact:$i*qi.contact,character:ji*qi.character};"PHYSX"!==t&&"AMMO"!==t||(s.vehicle=Gi*qi.vehicle),"PHYSX"===t&&(s.solver=Zi*qi.solver),"HAVOK"!==t&&"RAPIER"!==t||(qi.joint=0);let n=0;for(let t in s)i[t]=n,n+=s[t];return i.total=n,i}(Hi.engine,t)}static upInstance(){for(let t in Hi.instanceMesh)Hi.instanceMesh[t].update()}static clearInstance(){for(let t in Hi.instanceMesh)Hi.instanceMesh[t].dispose();Hi.instanceMesh={}}static control(t){null!==Gr?t!==Gr.name&&(Gr=wo.byName(t)):Gr=wo.byName(t)}static byName(t){return Yi.byName(t)}static getAllBody(t){return Xr.body.list}static explosion(t=[0,0,0],i=10,s=1){let n=[],r=new e.Vector3;t&&(t.isVector3?r.copy(t):r.fromArray(t));let o,a,l=new e.Vector3,h=Xr.body.list.length;for(;h--;)o=Xr.body.list[h],l.copy(o.position).sub(r),a=1-l.length()/i,o.isKinematic||a<0||(l.setLength(a),l.multiplyScalar(s),n.push({name:o.name,impulse:l.toArray(),wake:!0}));wo.change(n)}static addButton(t){let e=new Cr(t);return yo.push(e),e}static upButton(t){for(const t in yo)yo[t].update()}static getBodyRef(){return Xr.body}static initItems(){Xr={body:new Hs,solid:new So,character:new yr,ray:new ps,joint:new en,contact:new sn,terrain:new wr},"PHYSX"!==Hi.engine&&"AMMO"!==Hi.engine||(Xr.vehicle=new rn),"PHYSX"===Hi.engine&&(Xr.solver=new kr),Hi.items=Xr}static clearBody(){Xr.body.reset()}static resetItems(){Object.values(Xr).forEach((t=>t.reset()))}static stepItems(){null!==Hi.Ar&&(wo.upButton(),Object.values(Xr).forEach((t=>t.step())),wo.upInstance())}static addDirect(t){Hi.scenePlus.add(t),Hi.tmpMesh.push(t)}static adds(t=[],e){let i=t.length,s=0;for(;i--;)wo.add(t[s],e),s++}static add(t={},e=!1){if(t.isObject3D)return wo.addDirect(t);if(t.constructor===Array)return wo.adds(t,e);if("container"===t.type)return new _r(t);void 0!==t.bounce&&(t.restitution=t.bounce),void 0===t.type&&(t.type="box"),void 0!==t.mode&&(t.type="joint");let i=function(t){switch(t.type){case"plane":case"box":case"sphere":case"highSphere":case"cylinder":case"stair":case"particle":case"cone":case"capsule":case"mesh":case"convex":case"compound":case"null":return t.mass||t.density||t.kinematic?"body":"solid";case"generic":case"hinge":case"slider":case"spherical":case"fixe":case"dof":case"d6":case"ragdoll":case"universal":case"cylindrical":case"distance":case"revolute":case"prismatic":return"joint";default:return t.type}}(t);return"joint"===i&&void 0===t.mode&&(t.mode=t.type,t.type="joint"),Xr[i].add(t)}static removes(t=[],e){for(let i in t)wo.remove(t[i],e)}static remove(t,e=!1){if(t.constructor===Array)return wo.removes(t,e);let i=wo.byName(t);null!==i&&(Xr[i.type].clear(i),Hi.post({m:"remove",o:{name:t,type:i.type}},null,e))}static up(t){console.log("up is old"),wo.change(t,!0)}static update(t){console.log("update is old"),wo.change(t)}static change(t,e=!1){e?t instanceof Array?wo.changes(t,!0):wo.changeOne(t,!0):t instanceof Array?Hi.flow.tmp.push(...t):Hi.flow.tmp.push(t)}static changes(t=[],e=!1){for(let i in t)wo.changeOne(t[i],e)}static changeOne(t={},e=!1){if(t.heightData)return;let i=wo.byName(t.name);if(null===i)return null;let s=i.type;switch(t.drivePosition&&void 0!==t.drivePosition.rot&&(t.drivePosition.quat=Ni.quatFromEuler(t.drivePosition.rot),delete t.drivePosition.rot),void 0!==t.rot&&(t.quat=Ni.quatFromEuler(t.rot),delete t.rot),void 0!==t.localRot&&(t.quat=Ni.toLocalQuatArray(t.localRot,i),delete t.localRot),s){case"terrain":i=Xr.terrain.set(t,i),e=!1;break;case"ray":i=Xr.ray.set(t,i),e=!1;break;case"character":i=Xr.character.set(t,i);break;case"solid":i=Xr.solid.set(t,i);break;case"joint":i=Xr.joint.set(t,i);break;case"body":i.isKinematic&&Xr.body.set(t,i)}e&&Hi.post({m:"change",o:t})}static setCamera(t={}){ro.moveCam(t)}static follow(t="",e={}){let i=null;"string"==typeof t||t instanceof String?i=""===t?null:wo.byName(t):t.isObject3D&&(i=t),null===i?ro.resetFollow():ro.startFollow(i,e)}static setTimeout(t,e=0){lo=t,ho=e,ao=setTimeout(lo,ho)}static playtimout(){null!==lo&&(ao=setTimeout(lo,ho))}static pausetimout(){null!==ao&&clearTimeout(ao)}static cleartimout(t,e){null!==ao&&(lo=null,ho=0,clearTimeout(ao),ao=null)}static addBreaker(){null===to&&(to=new Fr)}static texture(t={}){return Li.texture(t)}static material(t={}){return cs.create(t)}static setExtendShader(t){cs.extendShader=t}static getMaterialList(){return cs.getList()}static addMaterial(t,e){cs.set(t,e)}static setEnvmapIntensity(t){cs.setEnvmapIntensity(t)}static getMat(t){return cs.get(t)}static load(t,e,i="",s=""){Li.load(t,e,i,s)}static applyMorph(t,e=null,i=!0,s=!0){Li.applyMorph(t,null,!0,!0)}static getMesh(t,e){if(e){let e=Li.getMaterials(t);for(let t in e)wo.addMaterial(e[t])}return Li.getMesh(t,e)}static getGroup(t,e,i){return Li.getGroup(t,e,i)}static getScript(t){return Li.getScript(t)}static get(t,e){return Li.get(t,e)}static poolDispose(){return Li.dispose()}static setDracoPath(t){return Li.dracoPath=t}static initParticle(){}static addParticle(){}static getParticle(){}static addParticleSolver(t){let e=new Vr(t);return xo.push(e),e}static updateParticleSolver(){let t=xo.length;for(;t--;)xo[t].update()}static clearParticleSolver(){xo.length,xo=[]}static addText(t){let e=new Mr(t);return t.parent?t.parent.add(e):Hi.scenePlus.add(e),bo.push(e),e}static clearText(){let t=bo.length;for(;t--;)bo[t].dispose();bo=[]}}class So extends Hs{constructor(){super(),this.type="solid"}step(){}}let ko,Ao,To,Mo,Po,Co,_o,Ro,Eo,Qo,Lo,Fo,Io,Do,Uo,zo=null,No=u.dom,Vo=u.setSvg,Bo=u.makeGradiant,$o=null,Xo="-o-user-select:none; -ms-user-select:none; -khtml-user-select:none; -webkit-user-select:none; -moz-user-select: none; pointer-events:none; ",jo=null,Go=0,Zo=!1,qo="";const Wo={home:["Code","Worker","Github","Docs"],engine:[],demo:[],visited:[]};let Ho=!1,Yo=[1,0,0,1,0,1,-1,0,-1,0,0,-1,0,-1,1,0],Ko=null,Jo=null,ta=null,ea=null,ia=!1,sa="#001",na="#335",ra=4,oa="#020206",aa="M 0.5 1.5 L 9.5 1.5 M 0.5 5.5 L 9.5 5.5 M 0.5 9.5 L 9.5 9.5";class la{static setMain(t){zo=t}static colors(t){t?(sa="#001",na="#335"):(sa="#FFE",na="#DDC"),Ao.style.color=sa,document.querySelector("#svgLogo").setAttributeNS(null,"stroke",sa),document.querySelector("#guiPath").setAttributeNS(null,"stroke",sa),document.querySelector("#svgLoader").setAttributeNS(null,"fill",sa)}static reset(){la.log(),$o&&Ao.removeChild($o),$o=null,ea&&this.removeJoystick()}static resize(t){Ao.style.left=t.left+"px",Ao.style.width=0!==t.left?"calc(100% - "+t.left+"px)":"100%",null!==ea&&ea.rezone()}static init(t,e,i,s){Ho||(ko=s||document.body,Ao=document.createElement("div"),Ao.style.cssText=Xo+"position:absolute; margin:0; padding:0; top:0px; left:0px; width:100%; height:100%; display:block; color:"+sa+"; font-family: Mulish,sans-serif;",ko.appendChild(Ao),Mo=document.createElement("div"),Mo.style.cssText=" color: #fff; font-size:16px; text-align:center; position:absolute; margin:0; padding:0; top:50%; left:50%; width:512px; height:20px; margin-left:-256px; margin-top:-38px; display:block; pointer-events:none; text-shadow: 1px 1px #000000;",Mo.textContent=i||"load...",Ao.appendChild(Mo),Po=document.createElement("div"),Po.style.cssText="position:absolute; top:50%; left:50%; width:60px; height:60px; margin-left:-30px; margin-top:-30px; display:block; ",Po.innerHTML=this.miniLoader("#000"),Ao.appendChild(Po),Ho=!0)}static removeJoystick(){null!==ea&&(ea.dispose(),ea=null)}static addJoystick(){ea=I("Joystick",{w:120,mode:1,text:!1,precision:1,pos:{left:"10px",bottom:"10px"},target:Ao,simple:!0,joyOut:"rgba(255,255,255,0.25)",joyOver:"rgba(127,255,0,0.5)",joySelect:"#7fFF00"}).onChange((function(t){wo.setKey(0,t[0]),wo.setKey(1,t[1])}))}static snipperMode(t){}static log(t=""){null!==ta&&(ta.innerHTML=t)}static setFps(t){null!==Ko&&(Ko.innerHTML=t)}static showTimeTest(t){if(null===Jo)return;let e=JSON.stringify(t,null,2);e=e.replace(/[",*+?^${}()|[\]\\]/g,""),Jo.textContent=e}static setStats(t=""){Jo.textContent=t}static endLoading(){Po.style.top="38px",Po.style.left="90px",Ao.removeChild(Mo),Li.setLoadEvent((function(){Po.style.display="block"}),(function(){Po.style.display="none"}));Fo=document.createElement("div"),Fo.style.cssText="position:absolute; top:0px; background:none; left:60px; pointer-events:auto; ",Fo.id="zone",Ao.appendChild(Fo),Co=document.createElement("div"),Co.style.cssText="position:absolute; top:25px; background:none; left:80px; display:flex; align-self: stretch; justify-content: flex-start; gap: 10px 20px; align-items:baseline; ",Ao.appendChild(Co),Qo=document.createElement("div"),Qo.style.cssText="position:absolute; top:54px; left:80px; overflow:hidden; background:none; height:0px; width:0px;",Ao.appendChild(Qo),Lo=document.createElement("div"),Lo.style.cssText="position:absolute; top:0px; left:0px; top:0px; overflow:hidden; background:none; display:flex; flex-wrap:warp;",Qo.appendChild(Lo),Fo.addEventListener("pointerleave",(t=>{ia=!1,setTimeout((function(){ia||la.hideMenu()}),100)})),Fo.addEventListener("pointermove",la.moving),_o=document.createElement("div"),Co.appendChild(_o),_o.id="home",_o.innerHTML=la.miniIcon("logo",sa),Ro=document.createElement("div"),Ro.style.cssText="font-size:16px; font-weight:700; ",Ro.id="engine",Co.appendChild(Ro),Eo=document.createElement("div"),Eo.style.cssText="font-size:16px; font-weight:500;",Eo.id="demo",Co.appendChild(Eo),this.effect(_o),this.effect(Ro),this.effect(Eo),ta=document.createElement("div"),ta.style.cssText="position:absolute; width:300px; bottom:25px; left:80px; font-size:14px; font-weight:500; vertical-align:bottom; text-align:left;",Ao.appendChild(ta),Jo=document.createElement("div"),Jo.style.cssText="position:absolute; bottom:25px; left:10px; font-size:14px; font-weight:500; width:400px; white-space: pre; line-height:20px;",Ao.appendChild(Jo),jo=document.createElement("div"),jo.style.cssText=Xo+"position:absolute; top:0px; right:0px; width:260px; height:100%; background:rgba(0,0,0,0.4); display:none;",jo.style.backdropFilter="blur(4px)",Ao.appendChild(jo),Ko=document.createElement("div"),Ko.style.cssText="position:absolute; top:33px; right:100px; text-align:right; font-size:14px; font-weight:500; ",Ao.appendChild(Ko),Io=document.createElement("div"),Io.style.cssText="position:absolute; right:80px;  top:31px; pointer-events:auto; cursor: pointer;",Ao.appendChild(Io),Io.innerHTML=`<svg xmlns='http://www.w3.org/2000/svg' version='1.1' xmlns:xlink='http://www.w3.org/1999/xlink' style='pointer-events:none;' \n        preserveAspectRatio='xMinYMax meet' x='0px' y='0px' width='10px' height='10px' viewBox='0 0 10 10'>\n        <path stroke='${sa}' id='guiPath' stroke-width='1' fill='none' d='${aa}'/></svg>`,Io.addEventListener("pointerdown",zo.showGui)}static setTopColor(t="#000000"){jo&&(jo.style.background=t)}static harmony(t){let e="rgba(0,0,0,0.5)";t?Do||Uo||(Do=document.createElement("div"),Do.style.cssText="position:absolute; top:33.33%; width:100%; height:33.33%; border-top:1px dashed "+e+"; border-bottom:1px dashed "+e+";",Ao.appendChild(Do),Uo=document.createElement("div"),Uo.style.cssText="position:absolute; left:33.33%; height:100%; width:33.33%; border-left:1px dashed "+e+"; border-right:1px dashed "+e+";",Ao.appendChild(Uo)):Do&&Uo&&(Ao.removeChild(Do),Ao.removeChild(Uo),Do=null,Uo=null)}static miniLoader(t){return`\n        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n        viewBox="0 0 100 100" enable-background="new 0 0 0 0" xml:space="preserve">\n        <path id="svgLoader" fill="${t}" d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50">\n        <animateTransform attributeName="transform" attributeType="XML" type="rotate" dur="1s" from="0 50 50" to="360 50 50" repeatCount="indefinite" />\n        </path></svg>\n        `}static miniIcon(t,e){let i;switch(t){case"logo":i="M 11.2 7.3 Q 10.9 7.45 10.6 7.7 6.75 10.45 6.75 14.35 6.75 18.15 10.6 20.9 14.5 23.65 20 23.65 L 20 4.95 Q 25.5 4.95 29.4 7.7 33.25 10.45 33.25 14.35 33.25 18.15 29.4 20.9 25.5 23.65 20 23.65 L 20 35";break;case"drag":i="M 23.975 7.025 Q 21.93 5 19 5 L 5 5 M 12 19 L 5 19 M 19 12 L 19 35 35.15 28.9 19 12 Z";break;case"build":i="M 20 20 L 20 5 35 5 35 20 35 35 20 35 5 35 5 20 20 20 35 20 M 20 20 L 20 35";break;case"cible":i="M 27.05 12.95 Q 30 15.8 30 20 30 24.1 27.05 27.05 24.1 30 20 30 15.8 30 12.95 27.05 10 24.1 10 20 10 15.8 12.95 12.95 15.8 10 20 10 24.1 10 27.05 12.95 Z M 35 20 L 32 20 M 20 5 L 20 8 M 8 20 L 5 20 M 20 32 L 20 35"}return`<svg xmlns='http://www.w3.org/2000/svg' version='1.1' xmlns:xlink='http://www.w3.org/1999/xlink' style='pointer-events:none;' \n        preserveAspectRatio='xMinYMax meet' x='0px' y='0px' width='20px' height='20px' viewBox='0 0 40 40'>\n        <path id='svgLogo' stroke='${e}' stroke-width='4' transform='translate(0, 4)' stroke-linejoin='round' stroke-linecap='round' \n        fill='none' d='${i}''></svg>`}static switchGuiButton(t){document.querySelector("#guiPath").setAttributeNS(null,"d",t?"M 1.5 0.5 L 1.5 9.5 M 5.5 0.5 L 5.5 9.5 M 9.5 0.5 L 9.5 9.5":aa),Zo=t,jo.style.display=t?"block":"none";let e=t?"#FFE":"#001";document.querySelector("#guiPath").setAttributeNS(null,"stroke",e),Ko.style.color=e}static hideMenu(){Qo.style.height="0px",Lo.innerHTML="",Fo.style.width="0px",Fo.style.height="0px",qo=""}static showMenu(t){let e=t.id;if(qo===e)return;la.hideMenu(),qo=e,Qo.style.left=("engine"===e?120:80)+"px";let i,s,n=Wo[e],r=n.length,o=0,a=0;for(Lo.style.top="0px",Lo.style.width="auto",Lo.style.display="flex",Lo.style.flexDirection="column";r--;)s=n[o],i=document.createElement("div"),Lo.appendChild(i),i.classList.add("down"),i.style.cssText="demo"===e?"font-size:16px; font-weight:500;":"font-size:16px; font-weight:700;",i.id=s,i.textContent=s,-1!==Wo.visited.indexOf(s)&&(i.style.color=na),"Worker"===s&&(i.style.color=zo.isWorker?sa:na),"Code"===s&&(i.style.color=zo.isEditor?sa:na),0===o&&(a=i.offsetHeight),this.effect(i,!0),o++;let l=Lo.getBoundingClientRect(),h=10*a;if(Go=o*a>h?h:l.height,"demo"===e){Lo.style.display="grid",Lo.style.gridTemplateColumns="repeat(auto-fill, 120px)",Lo.style.justifyContent="space-between";let t=Zo?335:160;Qo.style.left="80px",Qo.style.width="calc(100% - "+t+"px)",Lo.style.width="100%",l=Lo.getBoundingClientRect(),Qo.style.height=l.height+"px"}else Qo.style.width=l.width+"px",Qo.style.height=Go+"px";Fo.style.left=l.left-20+"px",Fo.style.width=l.width+40+"px",Fo.style.height=l.height+70+"px"}static upMenu(){Ro.textContent=this.reformat(zo.engineType),Eo.textContent=this.reformat(zo.currentDemo),Wo.visited.push(Eo.textContent);let t=[...zo.demoList];t.splice(t.indexOf(zo.currentDemo),1),t.sort(),t=t.map((t=>la.reformat(t))),Wo.demo=t,t=[...zo.engineList],t.sort(),t.splice(t.indexOf(zo.engineType),1),t=t.map((t=>la.reformat(t))),Wo.engine=t}static reformat(t){return t.toUpperCase().substring(0,1)+t.substring(1).toLowerCase()}static effect(t,e){t.classList.add("menu"),zo.isMobile||t.addEventListener("pointermove",la.moving),t.addEventListener("pointerleave",(t=>{t.target.style.textDecoration="none"})),t.addEventListener("pointerdown",(t=>{t.target.style.textDecoration="underline "+sa,"home"===t.target.id||"engine"===t.target.id||"demo"===t.target.id?la.showMenu(t.target):la.onClick(t.target.id)}))}static onClick(t){ia=!1,la.hideMenu(),setTimeout((function(){-1!==Wo.engine.indexOf(t)?la.swapEngine(t):-1!==Wo.home.indexOf(t)?la.homeLink(t):zo.loadDemo(t.toLowerCase())}),100)}static homeLink(t){switch(t){case"Github":window.open("https://github.com/lo-th/phy","_blank");break;case"Docs":window.open("./docs/index.html#manual/Welcome","_blank");break;case"Worker":la.swapWorker();break;case"Code":la.swapCode()}}static swapWorker(){zo.isWorker=!zo.isWorker,la.swapEngine()}static swapCode(){zo.isEditor=!zo.isEditor,zo.showEditor(zo.isEditor)}static swapEngine(t){t||(t=zo.engineType);let e=t.toLowerCase(),i=location.hash,s="E=";zo.devMode&&(s+="dev_"),zo.isWorker&&(s+="w_"),s+=e,window.open("index.html?"+s+i,"_self")}static moving(t){ia=!0,"zone"!==t.target.id&&(t.target.style.textDecoration="underline "+sa,"home"!==t.target.id&&"engine"!==t.target.id&&"demo"!==t.target.id||la.showMenu(t.target))}static count(t,e){return e&&(t.n--,t.t--),undefined.textContent=t.n+" / "+t.t,0===t.n?"reload":0===t.t?"empty":"fire"}static dispose(){if(Ho){for(;Ao.firstChild;)Ao.removeChild(Ao.lastChild);ko.removeChild(Ao),Ho=!1}}static addBorder(){let t=[[68,oa,0],[75,oa,.08],[93,oa,.4],[100,oa,.6]];To=No("svg","position:absolute; margin:0; padding:0; top:0; left:0; width:100%; height:100%; display:block; pointer-events:none;",{viewBox:"0 0 512 512",width:512,height:512,preserveAspectRatio:"none"}),No("defs","",{},To),Bo("radialGradient",{id:"grad",cx:0,cy:0,r:338,fx:0,fy:0,gradientTransform:"matrix( 0, 1, -1, 0, 256, 256 )",gradientUnits:"userSpaceOnUse"},To,t),No("rect","",{x:0,y:0,width:512,height:512,fill:"url(#grad)"},To),Ao.appendChild(To)}static hideCross(t){$o.style.visibility=t?"hidden":"visible"}static addCross(){$o=No("svg","position:absolute; margin:0; padding:0; top:50%; left:50%; width:128px; height:128px; margin-left:-64px; margin-top:-64px; display:block;",{viewBox:"0 0 64 64",width:64,height:64,preserveAspectRatio:"none"}),No("defs","",{},$o),No("path","",{id:"cc",d:"M 0 1.5 L 0 -1.5",stroke:"#FFFFFF","stroke-width":2,fill:"none","stroke-linecap":"butt","vector-effect":"non-scaling-stroke"},$o,0),No("g","",{},$o);for(var t=$o.childNodes[1],e=0;e<4;e++)No("g","",{},t),No("use","",{link:"#cc"},t,e);this.setCrossSize(ra),Ao.appendChild($o)}static setCross(t,e){}static setCrossSize(t){let e,i,s,n=Yo,r=[32,32-t,32+t,32,32,32+t,32-t,32];for(e=0;e<4;e++)s=4*e,i=2*e,Vo($o,"transform","matrix( "+n[s]+" "+n[s+1]+" "+n[s+2]+" "+n[s+3]+" "+r[i]+" "+r[i+1]+" )",1,e)}}class ha{constructor(){this.isCapture=!1,this.ready=!1}update(){this.isCapture&&this.capturer.capture(Pi.renderer.domElement)}stop(){this.isCapture&&(this.capturer.stop(),this.capturer.save(),this.isCapture=!1)}start(){this.isCapture||(this.ready?(this.capturer=new CCapture({verbose:!1,display:!1,framerate:60,quality:50,format:"webm-mediarecorder",currentTime:0,timeLimit:60,frameLimit:0,autoSaveTime:0}),this.isCapture=!0,this.capturer.start()):this.loadCCapture())}loadCCapture(){var t=new XMLHttpRequest;t.open("GET","./src/libs/CCapture.all.min.js"),t.overrideMimeType("text/javascript"),t.onreadystatechange=function(){if(4===t.readyState)if(200===t.status||0===t.status){let e=document.createElement("script");e.type="text/javascript",e.async=!0,e.charset="utf-8",e.text=t.responseText,document.getElementsByTagName("head")[0].appendChild(e),this.ready=!0,this.start()}else console.error("Couldn't load [ccapture] ["+t.status+"]")}.bind(this),t.send()}}class ca extends e.Mesh{constructor(t,i={}){const s=[t.isCubeTexture?"#define ENVMAP_TYPE_CUBE":""].join("\n")+"\n\n        varying vec3 vWorldPosition;\n\n        uniform float radius;\n        uniform float height;\n        uniform float angle;\n\n        #ifdef ENVMAP_TYPE_CUBE\n\n            uniform samplerCube map;\n\n        #else\n\n            uniform sampler2D map;\n\n        #endif\n\n        // From: https://www.shadertoy.com/view/4tsBD7\n        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) \n        {\n\n            float d = dot ( rd, n );\n            \n            if( d > 0.0 ) { return 1e6; }\n            \n            vec3  o = ro - c;\n            float t = - dot( n, o ) / d;\n            vec3  q = o + rd * t;\n            \n            return ( dot( q, q ) < r * r ) ? t : 1e6;\n\n        }\n\n        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm\n        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) \n        {\n\n            vec3 oc = ro - ce;\n            float b = dot( oc, rd );\n            float c = dot( oc, oc ) - ra * ra;\n            float h = b * b - c;\n            \n            if( h < 0.0 ) { return -1.0; }\n            \n            h = sqrt( h );\n            \n            return - b + h;\n\n        }\n\n        vec3 project() \n        {\n\n            vec3 p = normalize( vWorldPosition );\n            vec3 camPos = cameraPosition;\n            camPos.y -= height;\n\n            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );\n            if( intersection > 0.0 ) {\n                \n                vec3 h = vec3( 0.0, - height, 0.0 );\n                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );\n                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;\n\n            } else {\n\n                p = vec3( 0.0, 1.0, 0.0 );\n\n            }\n\n            return p;\n\n        }\n\n        #include <common>\n\n        void main() \n        {\n\n            vec3 projectedWorldPosition = project();\n            \n            #ifdef ENVMAP_TYPE_CUBE\n\n                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;\n\n            #else\n\n                vec3 direction = normalize( projectedWorldPosition );\n                vec2 uv = equirectUv( direction );\n                vec3 outcolor = texture2D( map, uv ).rgb;\n\n            #endif\n\n            gl_FragColor = vec4( outcolor, 1.0 );\n\n            #include <tonemapping_fragment>\n            #include <encodings_fragment>\n\n        }\n        ",n={map:{value:t},height:{value:i.height||15},radius:{value:i.radius||100}};super(new e.IcosahedronGeometry(1,16),new e.ShaderMaterial({uniforms:n,fragmentShader:s,vertexShader:"\n        varying vec3 vWorldPosition;\n\n        void main() \n        {\n\n            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );\n            vWorldPosition = worldPosition.xyz;\n            \n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n        }\n        ",side:e.DoubleSide}))}set radius(t){this.material.uniforms.radius.value=t}get radius(){return this.material.uniforms.radius.value}set height(t){this.material.uniforms.height.value=t}get height(){return this.material.uniforms.height.value}}
/*! 
   * quantize.js Copyright 2008 Nick Rabinowitz.
   * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
   */
/*!
      * Block below copied from Protovis: http://mbostock.github.com/protovis/
      * Copyright 2010 Stanford Visualization Group
      * Licensed under the BSD License: http://www.opensource.org/licenses/bsd-license.php
      */const ua={map:function(t,e){var i={};return e?t.map((function(t,s){return i.index=s,e.call(i,t)})):t.slice()},naturalOrder:function(t,e){return t<e?-1:t>e?1:0},sum:function(t,e){var i={};return t.reduce(e?function(t,s,n){return i.index=n,t+e.call(i,s)}:function(t,e){return t+e},0)},max:function(t,e){return Math.max.apply(null,e?ua.map(t,e):t)}};var da=5,pa=8-da;function fa(t,e,i){return(t<<2*da)+(e<<da)+i}function ma(t){var e=[],i=!1;function s(){e.sort(t),i=!0}return{push:function(t){e.push(t),i=!1},peek:function(t){return i||s(),void 0===t&&(t=e.length-1),e[t]},pop:function(){return i||s(),e.pop()},size:function(){return e.length},map:function(t){return e.map(t)},debug:function(){return i||s(),e}}}function ga(t,e){if(e.count()){var i=e.r2-e.r1+1,s=e.g2-e.g1+1,n=e.b2-e.b1+1,r=ua.max([i,s,n]);if(1==e.count())return[e.copy()];var o,a,l,h,c=0,u=[],d=[];if(r==i)for(o=e.r1;o<=e.r2;o++){for(h=0,a=e.g1;a<=e.g2;a++)for(l=e.b1;l<=e.b2;l++)h+=t[fa(o,a,l)]||0;c+=h,u[o]=c}else if(r==s)for(o=e.g1;o<=e.g2;o++){for(h=0,a=e.r1;a<=e.r2;a++)for(l=e.b1;l<=e.b2;l++)h+=t[fa(a,o,l)]||0;c+=h,u[o]=c}else for(o=e.b1;o<=e.b2;o++){for(h=0,a=e.r1;a<=e.r2;a++)for(l=e.g1;l<=e.g2;l++)h+=t[fa(a,l,o)]||0;c+=h,u[o]=c}return u.forEach((function(t,e){d[e]=c-t})),p(r==i?"r":r==s?"g":"b")}function p(t){var i,s,n,r,a,l=t+"1",h=t+"2",p=0;for(o=e[l];o<=e[h];o++)if(u[o]>c/2){for(n=e.copy(),r=e.copy(),a=(i=o-e[l])<=(s=e[h]-o)?Math.min(e[h]-1,~~(o+s/2)):Math.max(e[l],~~(o-1-i/2));!u[a];)a++;for(p=d[a];!p&&u[a-1];)p=d[--a];return n[h]=a,r[l]=n[h]+1,[n,r]}}}function va(t,e){if(!t.length||e<2||e>256)return console.log("wrong number of maxcolors"),!1;var i=function(t){var e,i,s,n,r=new Array(1<<3*da);return t.forEach((function(t){i=t[0]>>pa,s=t[1]>>pa,n=t[2]>>pa,e=fa(i,s,n),r[e]=(r[e]||0)+1})),r}(t);i.forEach((function(){}));var s=function(t,e){var i,s,n,r=1e6,o=0,a=1e6,l=0,h=1e6,c=0;return t.forEach((function(t){i=t[0]>>pa,s=t[1]>>pa,n=t[2]>>pa,i<r?r=i:i>o&&(o=i),s<a?a=s:s>l&&(l=s),n<h?h=n:n>c&&(c=n)})),new Ga(r,o,a,l,h,c,e)}(t,i),n=new ma((function(t,e){return ua.naturalOrder(t.count(),e.count())}));function r(t,e){for(var s,n=1,r=0;r<1e3;)if((s=t.pop()).count()){var o=ga(i,s),a=o[0],l=o[1];if(!a)return void console.log("vbox1 not defined; shouldn't happen!");if(t.push(a),l&&(t.push(l),n++),n>=e)return;if(r++>1e3)return void console.log("infinite loop; perhaps too few pixels!")}else t.push(s),r++}n.push(s),r(n,.75*e);for(var o=new ma((function(t,e){return ua.naturalOrder(t.count()*t.volume(),e.count()*e.volume())}));n.size();)o.push(n.pop());r(o,e-o.size());for(var a=new Za;o.size();)a.push(o.pop());return a}var ya,ba,xa,Oa=window.URL||window.webkitURL,wa=null,Sa=[],ka=0,Aa="",Ta="",Ma="",Pa="",Ca=.26,_a=.45,Ra=.55,Ea=.74,Qa=.3,La=.5,Fa=.7,Ia=.3,Da=.4,Ua=3,za=6.5,Na=.5,Va={},Ba={},$a=[].slice;const Xa={format:"html",makeCanvasFromImage:function(t){null===wa&&(wa=document.createElement("canvas")),ya=wa.getContext("2d",{willReadFrequently:!0}),ba=wa.width=t.width,xa=wa.height=t.height,ya.drawImage(t,0,0,ba,xa)},makeCanvasFromData:function(t){null===wa&&(wa=document.createElement("canvas")),ya=wa.getContext("2d",{willReadFrequently:!0}),ba=wa.width=t.w,xa=wa.height=t.h;let e=ya.createImageData(ba,xa),i=e.data.length;for(;i--;)e.data[i]=t.data[i];ya.putImageData(e,0,0)},clear:function(){ya.clearRect(0,0,ba,xa)},getImageData:function(){return ya.getImageData(0,0,ba,xa)},getPalette:function(t,e,i){this.makeCanvasFromData(t),e=e||64;var s=Math.round(ba/256);void 0!==i&&(s=i);var n=this.getImageData(),r=ba*xa,o=va(this.createPixelArray(n.data,r,s),e);Sa=o.colors(),this.getRange();var a=Ba;return Va={vibrant:this.findColorVariation(a.lumTargetNormal,a.lumMinNormal,a.lumMaxNormal,a.satTargetVibrant,a.satMinVibrant,1),lightVibrant:this.findColorVariation(a.lumTargetLight,a.lumMinLight,1,a.satTargetVibrant,a.satMinVibrant,1),darkVibrant:this.findColorVariation(a.lumTargetDark,0,a.lumMaxDark,a.satTargetVibrant,a.satMinVibrant,1),muted:this.findColorVariation(a.lumTargetNormal,a.lumMinNormal,a.lumMaxNormal,a.satTargetMuted,0,a.satMaxMuted),lightMuted:this.findColorVariation(a.lumTargetLight,a.lumMinLight,1,a.satTargetMuted,0,a.satMaxMuted),darkMuted:this.findColorVariation(a.lumTargetDark,0,a.lumMaxDark,a.satTargetMuted,0,a.satMaxMuted,!0),highest:Aa,ambient:Ta,maxLuma:Ma,minLuma:Pa},this.clear(),Va},getHex:function(){let t={};for(var e in Va)void 0!==Va[e]&&(t[e]=ja.htmlToHex(Va[e]));return t},getRange:function(){for(var t=0,e=1,i=0,s=1,n=0,r=Sa.length,o=[0,0,0],a=0,l=0;r--;)l=Sa[r].count,t=Math.max(t,l),e=Math.min(e,Sa[r].hsl[2]),i=Math.max(i,Sa[r].hsl[2]),s=Math.min(s,Sa[r].hsl[1]),n=Math.max(n,Sa[r].hsl[1]),o[0]+=Sa[r].rgb[0]*l,o[1]+=Sa[r].rgb[1]*l,o[2]+=Sa[r].rgb[2]*l,a+=l;o[0]/=a,o[1]/=a,o[2]/=a,Ta=ja.getHtml(o);var h=i-e,c=n-s;Ba.lumTargetDark=0+Ca*h,Ba.lumMaxDark=0+_a*h,Ba.lumMinLight=0+Ra*h,Ba.lumTargetLight=0+Ea*h,Ba.lumMinNormal=0+Qa*h,Ba.lumTargetNormal=0+La*h,Ba.lumMaxNormal=0+Fa*h,Ba.lumWeight=0+za*h,Ba.satTargetMuted=0+Ia*c,Ba.satMaxMuted=0+Da*c,Ba.satTargetVibrant=n,Ba.satMinVibrant=s,Ba.satWeight=0+Ua*c,ka=t;for(r=Sa.length;r--;)Sa[r].count===ka&&(Aa=Sa[r].hex),Sa[r].hsl[2]===i&&(Ma=Sa[r].hex),Sa[r].hsl[2]===e&&(Pa=Sa[r].hex)},findColorVariation:function(t,e,i,s,n,r,o){let a,l,h,c,u,d,p,f=null;for(c=0,a=0,l=Sa.length;a<l;a++)d=Sa[a],u=d.hsl[1],h=d.hsl[2],u>=n&&u<=r&&h>=e&&h<=i&&!d.select&&(p=this.createComparisonValue(u,s,h,t,d.count),(null===f||p>c)&&(f=d,c=p));return null!==f?(f.select=!0,f.hex):"#000"},createComparisonValue:function(t,e,i,s,n){return this.weightedMean(this.invertDiff(t,e),Ba.satWeight,this.invertDiff(i,s),Ba.lumWeight,n/ka,Na)},invertDiff:function(t,e){return 1-Math.abs(t-e)},weightedMean:function(){var t,e,i,s,n;for(s=1<=arguments.length?$a.call(arguments,0):[],e=0,i=0,t=0;t<s.length;)e+=s[t]*(n=s[t+1]),i+=n,t+=2;return e/i},createPixelArray:function(t,e,i){for(var s,n,r,o,a,l=t,h=[],c=0;c<e;c+=i)n=l[(s=4*c)+0],r=l[s+1],o=l[s+2],(void 0===(a=l[s+3])||a>=125)&&(n>250&&r>250&&o>250||h.push([n,r,o]));return h},getColorFromUrl:function(t,e){var i=this,s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="blob",s.onload=function(){if(2===s.readyState);else if(3===s.readyState);else if(4===s.readyState)if(200===s.status||0===s.status){var t=new Image;t.onload=function(s){Oa.revokeObjectURL(t.src),e(i.getPalette(t),t)},t.src=Oa.createObjectURL(s.response)}else console.error("Couldn't load [image] ["+s.status+"]")},s.send()}},ja={getHtml:function(t){return"#"+((1<<24)+(t[0]<<16)+(t[1]<<8)+t[2]).toString(16).slice(1,7)},getHsl:function(t){var e,i,s,n,r,o,a=t[0]/255,l=t[1]/255,h=t[2]/255;if(i=0,o=0,s=((n=Math.max(a,l,h))+(r=Math.min(a,l,h)))/2,n===r)i=o=0;else{switch(e=n-r,o=s>.5?e/(2-n-r):e/(n+r),n){case a:i=(l-h)/e+(l<h?6:0);break;case l:i=(h-a)/e+2;break;case h:i=(a-l)/e+4}i/=6}return[i,o,s]},htmlToHex:function(t){return t.toUpperCase().replace("#","0x")},hexToHtml:function(t){return"#"+("000000"+(t=void 0===t?0:t).toString(16)).substr(-6)}};class Ga{constructor(t,e,i,s,n,r,o){var a=this;a.r1=t,a.r2=e,a.g1=i,a.g2=s,a.b1=n,a.b2=r,a.histo=o}volume(t){var e=this;return e._volume&&!t||(e._volume=(e.r2-e.r1+1)*(e.g2-e.g1+1)*(e.b2-e.b1+1)),e._volume}count(t){var e=this,i=e.histo;if(!e._count_set||t){var s,n,r,o=0;for(s=e.r1;s<=e.r2;s++)for(n=e.g1;n<=e.g2;n++)for(r=e.b1;r<=e.b2;r++)o+=i[fa(s,n,r)]||0;e._count=o,e._count_set=!0}return e._count}copy(){var t=this;return new Ga(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)}avg(t){var e=this,i=e.histo;if(!e._avg||t){var s,n,r,o,a=0,l=1<<8-da,h=0,c=0,u=0;for(n=e.r1;n<=e.r2;n++)for(r=e.g1;r<=e.g2;r++)for(o=e.b1;o<=e.b2;o++)a+=s=i[fa(n,r,o)]||0,h+=s*(n+.5)*l,c+=s*(r+.5)*l,u+=s*(o+.5)*l;e._avg=a?[~~(h/a),~~(c/a),~~(u/a)]:[~~(l*(e.r1+e.r2+1)/2),~~(l*(e.g1+e.g2+1)/2),~~(l*(e.b1+e.b2+1)/2)]}return e._avg}contains(t){var e=this,i=t[0]>>pa,s=t[1]>>pa,n=t[2]>>pa;return i>=e.r1&&i<=e.r2&&s>=e.g1&&i<=e.g2&&n>=e.b1&&i<=e.b2}}class Za{constructor(){this.vboxes=new ma((function(t,e){return ua.naturalOrder(t.vbox.count()*t.vbox.volume(),e.vbox.count()*e.vbox.volume())}))}push(t){this.vboxes.push({vbox:t,color:t.avg()})}palette(){return this.vboxes.map((function(t){return t.color}))}colors(){var t=[];return this.vboxes.map((function(e){var i=e.vbox.count()||0,s=e.color;i&&t.push({rgb:s,hsl:ja.getHsl(s),hex:ja.getHtml(s),count:i,select:!1})})),t}size(){return this.vboxes.size()}map(t){for(var e=this.vboxes,i=0;i<e.size();i++)if(e.peek(i).vbox.contains(t))return e.peek(i).color;return this.nearest(t)}nearest(t){for(var e,i,s,n=this.vboxes,r=0;r<n.size();r++)((i=Math.sqrt(Math.pow(t[0]-n.peek(r).color[0],2)+Math.pow(t[1]-n.peek(r).color[1],2)+Math.pow(t[1]-n.peek(r).color[1],2)))<e||void 0===e)&&(e=i,s=n.peek(r).color);return s}forcebw(){var t=this.vboxes;t.sort((function(t,e){return ua.naturalOrder(ua.sum(t.color),ua.sum(e.color))}));var e=t[0].color;e[0]<5&&e[1]<5&&e[2]<5&&(t[0].color=[0,0,0]);var i=t.length-1,s=t[i].color;s[0]>251&&s[1]>251&&s[2]>251&&(t[i].color=[255,255,255])}}class qa extends e.DirectionalLightHelper{constructor(t,i,s){super(t,i=i||1,s);let n=new e.PlaneGeometry(2*i,2*i),r=new e.MeshBasicMaterial({color:this.light.color,fog:!1,toneMapped:!1});this.m2=new e.Mesh(n,r),this.shadow=new e.CameraHelper(t.shadow.camera),this.shadow.setColors(t.color,new e.Color(2236962),new e.Color(2236962),t.color,new e.Color(6710886)),this.children[0].add(this.m2)}dispose(){super.dispose(),this.m2&&(this.m2.geometry.dispose(),this.m2.material.dispose())}update(){super.update(),this.m2&&this.m2.material.color.copy(this.light.color)}}let Wa=[],Ha={},Ya=[],Ka=!1;class Ja{static update(t={}){let e=!1;t.sunIntensity&&(Ha.sun&&(Ha.sun.intensity=.3*t.sunIntensity),Ha.sun2&&(Ha.sun2.intensity=.7*t.sunIntensity)),t.hemiIntensity&&Ha.hemi&&(Ha.hemi.intensity=.7*t.hemiIntensity),t.sunPos&&(Ha.sun&&(Ha.sun.position.fromArray(t.sunPos).multiplyScalar(Ha.sun.distance),Ha.sun.target.position.set(0,1,0),e=!0),Ha.sun2&&(Ha.sun2.position.fromArray(t.sunPos).multiplyScalar(Ha.sun2.distance),Ha.sun2.target.position.set(0,1,0),e=!0)),t.sunColor&&(Ha.sun&&Ja.setColor(Ha.sun.color,t.sunColor),Ha.sun2&&Ja.setColor(Ha.sun2.color,t.sunColor),e=!0),Ha.hemi&&(t.skyColor&&Ja.setColor(Ha.hemi.color,t.skyColor),t.groundColor&&Ja.setColor(Ha.hemi.groundColor,t.groundColor),e=!0),e&&Ja.updateHelper()}static setColor(t,e){e.isColor?t.copy(e):t.setHex(e)}static adds(t){let e=t.length,i=0;for(;e--;)Ja.add(t[i]),i++}static add(t={}){if(t.constructor===Array)return Ja.adds(t);let i=null;switch(t.color||(t.color=16777215),t.type){case"direct":i=new e.DirectionalLight(t.color,t.intensity),i.distance=void 0!==t.distance?t.distance:2;break;case"spot":i=new e.SpotLight(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"point":i=new e.PointLight(t.color,t.intensity,t.distance,t.decay);break;case"ambient":i=new e.AmbientLight(t.color,t.intensity);break;case"rec":i=new e.RectAreaLight(t.color,t.intensity,t.width=10,t.height);break;case"hemi":i=new e.HemisphereLight(t.skyColor||0,t.groundColor||0,t.intensity)}if(i){if(i.name=t.name||"light"+Wa.length,t.pos&&i.position.fromArray(t.pos),t.parent&&(i.target&&t.parent.add(i.target),t.parent.add(i)),i.shadow&&t.shadow){const e=i.shadow,s=t.shadow;e.mapSize.width=e.mapSize.height=s.quality;const n=e.camera;n.isOrthographicCamera&&(s.range&&(n.top=n.right=s.range,n.bottom=n.left=-s.range),s.near&&(n.near=s.near),s.far&&(n.far=s.far)),s.bias&&(e.bias=s.bias),s.radius&&(e.radius=s.radius),s.blurSamples&&(e.blurSamples=s.blurSamples),i.castShadow=!0}return Wa.push(i),Ha[i.name]=i,i}}static byName(t){return Ha[t]}static dispose(){Ja.disposeHelper();let t,e=Wa.length;for(;e--;)t=Wa[e],t.parent&&t.parent.remove(t),t.target&&t.target.parent&&t.target.parent.remove(t.target),t.dispose();Wa=[],Ha={}}static castShadow(t){let e,i=Wa.length;for(;i--;)e=Wa[i],void 0!==e.shadow&&(e.castShadow=t,t||e.shadow.dispose())}static addHelper(t,i){if(t&&!Ka){let t,s,n=Wa.length;for(;n--;){switch(t=Wa[n],t.type){case"DirectionalLight":s=new qa(t);break;case"PointLight":s=new e.PointLightHelper(t,.25,t.color);break;case"SpotLight":s=new e.SpotLightHelper(t,t.color);break;case"HemisphereLight":s=new e.HemisphereLightHelper(t,.25),s.material.wireframe=!1}s&&(Ya.push(s),i.add(s),s.shadow&&(Ya.push(s.shadow),i.add(s.shadow)))}Ka=!0}return t||Ja.disposeHelper(),Ka}static updateHelper(){if(!Ka)return;let t=Ya.length;for(;t--;)Ya[t].update()}static disposeHelper(){if(!Ka)return;let t,e=Ya.length;for(;e--;)t=Ya[e],t.parent.remove(t),t.dispose();Ya=[],Ka=!1}}const tl=.25;let el=2.2,il="",sl=!0,nl=!1,rl=!0,ol=new e.Color,al=new e.Color,ll=new e.Color,hl=new e.Color,cl=null,ul=null,dl=!1,pl=!1,fl=null,ml=null,gl=null,vl=null,yl=null,bl=null,xl={},Ol={},wl=new e.Color,Sl=null,kl=null;const Al=new e.Spherical;new e.Spherical;const Tl=new e.Vector3;new e.Color,new e.Color,new e.Color;let Ml=0;new e.Vector2;const Pl=new xi,Cl=new Oi;let _l,Rl,El,Ql=null,Ll=null,Fl=null,Il=null;class Dl{static setMain(t){Ql=t}static get(){return gl}static getData(){return xl}static dispose(){Sl.background&&Sl.background.dispose&&Sl.background.dispose(),Sl.environment&&Sl.environment.dispose&&Sl.environment.dispose(),Sl.background=null,Sl.environment=null,this.clearTargetRender(),gl&&gl.dispose(),vl&&vl.dispose(),ml&&ml.dispose(),gl=null,vl=null}static set(t,e=(()=>{})){Dl.dispose(),"string"==typeof t?"null"!==t?-1!==t.search("/")?this.load(t,e):(il=t,this.load("./assets/textures/equirectangular/"+t+".hdr",e)):(Sl.environment=null,Sl.background=null,e()):isNaN(t)||(this.setBackgroud(t),e())}static setFloorRadius(t){bl&&(bl.radius=t)}static setFloorHeight(t){bl&&(bl.height=t)}static setBlur(t){Sl&&(Sl.backgroundBlurriness=t)}static addFloor(t,e=2){console.log("addFloor",t),t?(bl=new ca(gl),bl.scale.setScalar(100),bl.radius=100,bl.height=10,Sl.add(bl)):bl&&Sl.remove(bl)}static setBackgroud(t){Sl.background=void 0!==t?wl.setHex(t):gl}static init(t,i,s=!0){t&&(kl=t,nl=kl.isWebGPURenderer||!1,sl=!nl&&sl),i&&(Sl=i),rl=void 0===s||s,nl&&(rl=!1),sl&&(yl=new e.PMREMGenerator(kl),yl.compileEquirectangularShader())}static async load(t,i,s="hdr"){xl={pos:new e.Vector3(0,1,0),sun:new e.Color(16777215),fog:new e.Color(0),envmap:null},"hdr"===s?vl=await Pl.loadAsync(t):"exr"===s&&(vl=await Cl.loadAsync(t)),el=2.2,"basic"===il&&(el=2.68),"alien"===il&&(el=1.88),Dl.process(),i&&i()}static process(){sl?(ml=yl.fromEquirectangular(vl),gl=ml.texture,yl.dispose()):(gl=vl,gl.mapping=e.EquirectangularReflectionMapping),Sl&&(Sl.environment=gl,bl?bl.map=gl:Sl.background=gl),Ml=0,rl&&Dl.up()}static initTargetRender(t,i){null===Ll&&(_l=new e.Mesh(new e.PlaneGeometry(4,2),new e.MeshBasicMaterial({toneMapped:!0})),_l.scale.y=-1,Rl=new e.Scene,Rl.add(_l),El=new e.OrthographicCamera(-2,2,1,-1,0,1),Ll=new e.WebGLRenderTarget(1,1,{format:e.RGBAFormat,type:e.HalfFloatType}),Ll.setSize(t,i),Fl=new Float32Array(t*i*4),Il=new Uint16Array(t*i*4))}static clearTargetRender(){null!==Ll&&(Ll.texture&&Ll.texture.dispose(),Ll.dispose(),Rl.remove(_l),_l.material.map.dispose(),_l.geometry.dispose(),_l.material.dispose(),_l=null,Rl=null,El=null,Ll=null,Fl=null,Il=null)}static renderTarget(t){let e=t.image.width*tl,i=t.image.height*tl;this.initTargetRender(e,i),_l.material.map=t,_l.material.needsUpdate=!0,kl.setRenderTarget(Ll),kl.render(Rl,El),kl.setRenderTarget(null),kl.readRenderTargetPixels(Ll,0,0,e,i,Il);{let t,e=Fl.length/4;for(;e--;)t=4*e,Fl[t]=255*this.float16ToNumber(Il[t]),Fl[t+1]=255*this.float16ToNumber(Il[t+1]),Fl[t+2]=255*this.float16ToNumber(Il[t+2]),Fl[t+3]=255*this.float16ToNumber(Il[t+3])}return Fl}static up(){0===Ml&&(Dl.autoSun(),Dl.upLight()),Ml++,Ml<6&&(Ml=0),Ml=0}static getCanvas(){const t=fl;null===cl&&(cl=document.createElement("canvas")),cl.style.cssText="position:absolute; left:10px; bottom:20px; width:"+t.w+"px; height:"+t.h+"px; border:1px solid #222;",cl.width=t.w,cl.height=t.h;let e=cl.getContext("2d"),i=e.createImageData(t.w,t.h),s=i.data.length;for(;s--;)i.data[s]=t.data[s];e.putImageData(i,0,0)}static getPalette(){return Ol}static preview(t){Dl.palettePreview(t);const e=fl;if(null!==e)if(t){null===cl&&(cl=document.createElement("canvas")),cl.style.cssText="position:absolute; left:10px; bottom:10px; width:"+e.w+"px; height:"+e.h+"px; border:1px solid #222;",cl.width=e.w,cl.height=e.h;let t=cl.getContext("2d"),i=t.createImageData(e.w,e.h),s=i.data.length;for(;s--;)i.data[s]=e.data[s];t.putImageData(i,0,0),t.lineWidth=2,t.strokeStyle="red",t.beginPath(),t.arc(e.x,e.y,5,0,2*Math.PI),t.stroke(),dl||(document.body.appendChild(cl),dl=!0)}else dl&&(document.body.removeChild(cl),dl=!1)}static palettePreview(t){let e=25.6,i=0,s=0,n=0,r=3*e+5;if(t){null===ul&&(ul=document.createElement("canvas")),ul.style.cssText="position:absolute; left:271px; bottom:10px; width:"+r+"px; height:128px; border:1px solid #222;",ul.width=r,ul.height=128;const t=ul.getContext("2d");t.fillStyle="#000",t.fillRect(0,0,r,128);for(let r in Ol)void 0!==Ol[r]&&(n=Math.floor(i/5),s=i-5*n,t.fillStyle=Ol[r],t.fillRect(n*e+(n>0?5:0),s*e,e,e)),i++;pl||(document.body.appendChild(ul),pl=!0)}else pl&&(document.body.removeChild(ul),pl=!1)}static autoSun(){const t=this.renderTarget(vl),i=vl.image,s=i.width*tl,n=i.height*tl,r=t.length/4,o=[],a=new Uint8ClampedArray(4),l=1/el;let h,c,u,d,p,f,m,g,v=r,y=1/255,b=0,x=0,O=0,w=0,S=0,k=0,A=0,T=0,M=0,P=0;for(;v--;)c=4*v,m=v%s,g=Math.floor((v-m)/s),u=255*Math.pow(t[c+0]/255,l),d=255*Math.pow(t[c+1]/255,l),p=255*Math.pow(t[c+2]/255,l),f=u+d+p,g===.5*n&&(b+=u,x+=d,O+=p),g===.25*n&&(A+=u,T+=d,M+=p),g===.75*n&&(w+=u,S+=d,k+=p),f>P&&(a[0]=u,a[1]=d,a[2]=p,a[3]=255,h=v,P=f),o[c]=u,o[c+1]=d,o[c+2]=p,o[c+3]=255;m=h%s,g=Math.floor((h-m)/s),ol.setRGB(a[0]*y,a[1]*y,a[1]*y,e.SRGBColorSpace),al.setRGB(b/s*y,x/s*y,O/s*y,e.SRGBColorSpace),ll.setRGB(A/s*y,T/s*y,M/s*y,e.SRGBColorSpace),hl.setRGB(w/s*y,S/s*y,k/s*y,e.SRGBColorSpace),Al.set(1,g/n*Math.PI,-m/s*(2*Math.PI)-.5*Math.PI),xl.sun=ol,xl.fog=al,xl.sky=ll,xl.ground=hl,fl={data:o,x:m,y:g,w:s,h:n},Ol=Xa.getPalette(fl);let C={sun:"#"+ol.getHexString(),m:void 0,fog:"#"+al.getHexString(),sky:"#"+ll.getHexString(),ground:"#"+hl.getHexString()};Ol={...C,...Ol},Ql&&Ql.setColors(Ol),Dl.preview(dl)}static getFogColor(){return al}static upLight(){Sl.fog&&Sl.fog.color.copy(xl.fog);const t={sunPos:Tl.setFromSpherical(Al).toArray(),sunColor:xl.sun,skyColor:xl.sky,groundColor:xl.ground};Ja.update(t)}static float16ToNumber(t){const e=new ArrayBuffer(4),i=new DataView(e);i.setUint16(2,t,!1);const s=i.getInt32(0,!1);let n=32767&s,r=32768&s;n<<=13,r<<=16,n+=939524096,n=0===(31744&s)?0:n,n|=r,i.setInt32(0,n,!1);return i.getFloat32(0,!1)}}const Ul=["ENV","PHY","CAM","POST","MAT","OBJ"];let zl=null;const Nl={tool:u,open:!1,isInit:!1,ui:null,gp:null,video:null,envui:null,CameraOptions:[],startMode:"ENV",mode:"",currentMat:"",matList:null,imageMap:["map","map1","map2","emissiveMap","sheenColorMap"],imageNormal:["normalMap","normalMap1","normalMap2","aoMap","metalnessMap","roughnessMap","alphaMap","anisotropyMap","specularIntensityMap","displacementMap","bumpMap"],MaterialMesh:["Basic","Physical","Standard","Toon","Lambert","Phong","Shader"],joy:null,p0:"M 0.5 1.5 L 9.5 1.5 M 0.5 5.5 L 9.5 5.5 M 0.5 9.5 L 9.5 9.5",p1:"M 1.5 0.5 L 1.5 9.5 M 5.5 0.5 L 5.5 9.5 M 9.5 0.5 L 9.5 9.5",bg:"rgba(0,0,8,0.5)",colors:{fontShadow:"#000",radius:0,showOver:0,background:"none",backgroundOver:"none",font:"Mulish, sans-serif",fontSize:12,weight:"500",text:"#fff",title:"#eee",borderSize:1,joyOut:"rgba(255,255,255,0.1)",joyOver:"rgba(127,255,0,0.2)",joySelect:"#7fFF00"},setMain:t=>{zl=t},setTextureConstrutor:t=>{u.texture=t},showHide:()=>{Nl.isInit||Nl.init(),Nl.open?Nl.open=!1:Nl.open=!0,Nl.ui.isOpen=Nl.open,la.switchGuiButton(Nl.open),Nl.menu.display(Nl.open),Nl.ui.calc(),Nl.ui.mode("def")},init:()=>{u.setStyle(Nl.colors),Nl.menu=I("button",{type:"button",values:Ul,value:Nl.startMode,selectable:!0,unselect:!1,p:0,h:30,w:250,radius:4,pos:{right:"5px",top:"60px"}}).onChange(Nl.setMode),Nl.menu.icon(Vl("env"),0,2),Nl.menu.icon(Vl("phy"),0,3),Nl.menu.icon(Vl("cam"),0,4),Nl.menu.icon(Vl("post"),0,5),Nl.menu.icon(Vl("mat"),0,6),Nl.menu.icon(Vl("asset"),0,7),Nl.ui=new U({w:250,h:25,open:!1,close:!1,css:"top:97px; right:5px;",colors:Nl.colors,transition:0}),Nl.setMode(Nl.startMode),Nl.isInit=!0},setMode(t){if(Nl.mode!==t){switch(Nl.mode=t,Nl.ui.clear(),Nl.mode){case"ENV":Nl.display();break;case"PHY":Nl.physics();break;case"CAM":Nl.camera();break;case"POST":Nl.postprocess();break;case"MAT":Nl.material()}Nl.ui.add("empty",{h:6})}},doReset:()=>{Nl.isInit&&Nl.open&&setTimeout(Nl.reset,0)},reset:()=>{if(!Nl.isInit)return;if(!Nl.open)return;let t=Nl.mode;Nl.mode="",Nl.currentMat="",t&&Nl.setMode(t)},display:()=>{if("ENV"!==Nl.mode)return;const t=Nl.ui,e=zl.getOption();zl.getSetting();const i=zl.getRenderer();zl.getScene();const s=zl.getToneMappingOptions();t.add(e,"mode",{type:"button",values:["LOW","HIGH"],selectable:!0,unselect:!1,p:0}).onChange(zl.changeMode),t.add(e,"harmony",{type:"bool"}).onChange(la.harmony),t.add(e,"show_light",{type:"bool"}).onChange(zl.showDebugLight),t.add(e,"show_stat",{type:"bool"}).onChange(zl.showStatistic),t.add(e,"fogMode",{type:"selector",values:[0,1],selectable:!0,unselect:!1,h:24}).onChange((function(t){Pi.up(e)})),t.add(e,"exposure",{min:0,max:4,mode:2}).onChange((function(t){i.toneMappingExposure=t,Dl.up()})),t.add(e,"tone",{type:"list",list:s,full:!0}).onChange((function(t){i.toneMapping=s[e.tone]})),t.add(e,"legacy",{type:"bool"}).onChange((function(t){i.useLegacyLights=t})),t.add(e,"shadow",{min:0,max:1,mode:2,color:"#8ff"}).onChange(zl.setShadow),t.add(e,"reflect",{min:0,max:1,mode:2,color:"#8ff"}).onChange(zl.setReflect),t.add(e,"light_1",{rename:"Light Direct",min:0,max:10,mode:2,color:"#ff0"}).onChange(zl.lightIntensity),t.add(e,"light_2",{rename:"Light Sphere",min:0,max:10,mode:2,color:"#ff0"}).onChange(zl.lightIntensity),t.add(e,"envPower",{min:0,max:3,mode:2,color:"#ff0"}).onChange(zl.envmapIntensity),t.add(e,"envBlur",{min:0,max:1,mode:2,color:"#ff0"}).onChange(zl.setBlur),Nl.envui=t.add("list",{name:"Envmap",list:zl.envList,value:e.envmap,path:"assets/textures/equirectangular/mini/",format:".jpg",m:0,imageSize:[128,64],h:40}).onChange(zl.setEnv);const n=zl.getHub3d();n&&(t.add(n,"offset",{min:0,max:2,mode:2,color:"#8ff"}),t.add(n,"darkness",{min:0,max:1,mode:2,color:"#8ff"}),t.add(n,"color",{type:"color"}).listen())},objects:()=>{Nl.mode},physics:()=>{if("PHY"!==Nl.mode)return;const t=Nl.ui,e=zl.motor.getSetting();t.add("button",{values:zl.engineList,selectable:!0,value:zl.engineType,h:30}).onChange(Nl.swapEngine),t.add("bool",{name:"WORKER OFF",onName:"WORKER ON",value:zl.isWorker,mode:1}).onChange(Nl.swapWorker);let i=t.add("button",{type:"button",values:["REPLAY","PAUSE"],p:0}).onChange((t=>{"PAUSE"===t&&(phy.pause(!0),i.switchValues(1,"PLAY")),"PLAY"===t&&(phy.pause(!1),i.switchValues(1,"PAUSE")),"REPLAY"===t&&zl.injectCode(zl.getCode())}));t.add("empty",{h:6}),t.add("button",{type:"button",values:["DRAG","SHOOT","BUILD"],value:"DRAG",selectable:!0,unselect:!1,p:0}).onChange((t=>{phy.mouseMode(t.toLowerCase())})),t.add(e,"gravity",{type:"number"}).onChange(zl.motor.setGravity)},camera:()=>{if("CAM"!==Nl.mode)return;const t=Nl.ui,e=zl.getControler();zl.getRenderer();const i=function(){zl.setCamera({...e.info})};let s=t.add("group",{name:"CAMERA",open:!0});s.add(e.info,"phi",{min:-90,max:90,precision:1,mode:2,color:"#ff0"}).onChange(i).listen(),s.add(e.info,"theta",{min:-180,max:180,precision:1,mode:2,color:"#ff0"}).onChange(i).listen(),s.add("empty",{h:6}),s.add(e.info,"fov",{min:1,max:180,precision:1,mode:2,color:"#8ff"}).onChange(i).listen(),s.add(e.info,"zoom",{min:.1,max:10,precision:1,mode:2,color:"#8ff"}).onChange(i).listen(),s.add("empty",{h:6}),s.add(e.info,"distance",{type:"number",min:0,max:100,mode:2}).onChange(i).listen(),s.add(e.info,"x",{type:"number",min:-50,max:50,precision:2,mode:2}).onChange(i).listen(),s.add(e.info,"y",{type:"number",min:-50,max:50,precision:2,mode:2}).onChange(i).listen(),s.add(e.info,"z",{type:"number",min:-50,max:50,precision:2,mode:2}).onChange(i).listen();let n=Pi.setting(),r=t.add("group",{name:"SHADOW",open:!0});r.add(n.shadowGamma,"value",{rename:"gamma",min:0,max:4,precision:3,mode:2,color:"#8ff"}),r.add(n.shadowLuma,"value",{rename:"lLuma",min:0,max:4,precision:3,mode:2,color:"#8ff"}),r.add(n.shadowContrast,"value",{rename:"contrast",min:0,max:4,precision:3,mode:2,color:"#8ff"}),r.add("empty",{h:6}),r.add(n.lightSizeUV,"value",{rename:"light size",min:1,max:10,precision:4,mode:2}),r.add(n.nearPlane,"value",{rename:"near plane",min:1,max:20,precision:2,mode:2}),r.add(n.rings,"value",{rename:"ring",min:1,max:30,precision:0,color:"#ff0",mode:2}),r.add(n.nSample,"value",{rename:"sample",min:2,max:32,precision:0,color:"#ff0",mode:2}),r.add(n.softness,"value",{rename:"softness",min:0,max:4,precision:3,mode:2})},postprocess:t=>{if("POST"!==Nl.mode)return;const e=Nl.ui,i=zl.getOption();t||(e.clear(),e.add(i,"renderMode",{type:"selector",values:[0,1,2,3],selectable:!0,unselect:!1,p:0,h:24}).onChange((function(t){0!==t&&(r.helper.visible=!1),1===t?Dl.setBackgroud(0):2===t?Dl.setBackgroud(7829503):3===t?Dl.setBackgroud(16777215):(Dl.setBackgroud(),r.helper.visible=!0),Pi.up(i)})),e.add(i,"composer",{type:"bool",rename:"POST PROCESS OFF",onName:"POST PROCESS ON",mode:1,h:40}).onChange(zl.setComposer),Nl.gp=e.add("group",{name:"OPTION"}));let s=Nl.gp;s.clear();const n=zl.getComposer(),r=zl.getScene();n&&(s.add(n.pass.focus,"enabled",{type:"bool",rename:"focus",onName:"focus"}),s.add(n.options,"focus",{min:0,max:100}).onChange((function(){n.update()})),s.add(n.options,"aperture",{min:0,max:5,precision:2}).onChange((function(){n.update()})),s.add(n.options,"maxblur",{min:0,max:.01,step:.001,precision:3}).onChange((function(){n.update()})),s.add("empty",{h:6}),s.add(n.pass.sao,"enabled",{type:"bool",rename:"sao"}),s.add(n.options,"saoBias",{min:-1,max:1,mode:0}).onChange((function(){n.update()})),s.add(n.options,"saoIntensity",{min:0,max:1,mode:0}).onChange((function(){n.update()})),s.add(n.options,"saoScale",{min:0,max:50,mode:0}).onChange((function(){n.update()})),s.add(n.options,"saoKernelRadius",{min:1,max:100,mode:0}).onChange((function(){n.update()})),s.add(n.options,"saoMinResolution",{min:0,max:1,mode:0}).onChange((function(){n.update()})),s.add("empty",{h:6}),s.add(n.pass.bloom,"enabled",{type:"bool",rename:"bloom"}),s.add(n.options,"threshold",{min:0,max:1,mode:0}).onChange((function(){n.update()})),s.add(n.options,"strength",{min:0,max:10,mode:0}).onChange((function(){n.update()})),s.add(n.options,"bloomRadius",{min:0,max:1,step:.01,mode:0}).onChange((function(){n.update()})),s.add("empty",{h:6}),s.add(n.pass.distortion,"enabled",{type:"bool",rename:"distortion"}),s.add(n.options,"distortion",{min:0,max:1,mode:0}).onChange((function(){n.update()})),s.add(n.options,"horizontal",{min:0,max:360,mode:0}).onChange((function(){n.update()})),s.add(n.options,"cylindrical",{min:0,max:5,step:.01,mode:0}).onChange((function(){n.update()})),s.add("empty",{h:6}),s.add(n.pass.lut,"enabled",{type:"bool",rename:"lut"}),s.add("button",{name:"LOAD",p:10}).onChange((function(t,e,i){d.load({callback:function(t,e,i){n.changeLut(t,e,i)},type:"lut"})})),s.add("empty",{h:6}),s.add(n.pass.sharpen,"enabled",{type:"bool",rename:"sharpen"}),s.add(n.options,"power",{min:0,max:1,mode:0}).onChange((function(){n.update()})),s.add("empty",{h:6}),s.open())},gotoGithub:()=>{window.open("https://github.com/lo-th/phy","_blank")},swapWorker:t=>{zl.isWorker=t,Nl.swapEngine()},swapEngine:t=>{t||(t=zl.engineType);let e=t.toLowerCase(),i=location.hash,s="E=";zl.devMode&&(s+="dev_"),zl.isWorker&&(s+="w_"),s+=e,window.open("index.html?"+s+i,"_self")},capture:t=>{!Nl.video&&t?Nl.video=new ha:t?Nl.video.start():(Nl.video.stop(),Nl.video=null)},update:()=>{Nl.video&&Nl.video.update()},material:()=>{if("MAT"!==Nl.mode)return;const t=Nl.ui;t.clear();let e=zl.motor.getMaterialList();const i=t.add("list",{name:"",list:e,p:0,value:Nl.currentMat,h:40}).onChange(Nl.materialEdit);if(!Nl.currentMat)return void i.text("Select Material");let s=e[Nl.currentMat],n=s.type;-1!==n.search("Mesh")&&(n=n.substring(4));let r=n.search("Material");n=n.substring(0,r),t.add("list",{name:"Type",list:Nl.MaterialMesh,value:n,h:30}).onChange(),void 0!==s.side&&t.add(s,"side",{type:"list",list:{front:0,back:1,double:2}}).onChange((function(t){s.side=this.list.indexOf(t)})),void 0!==s.shadowSide&&t.add(s,"shadowSide",{type:"list",list:{front:0,back:1,double:2}}).onChange((function(t){s.shadowSide=this.list.indexOf(t)}));let o=t.add("group",{name:"COLORS",color:"#FFaaaa",h:30});void 0!==s.color&&o.add(s,"color",{}),void 0!==s.specularColor&&o.add(s,"specularColor",{rename:"specular"}),void 0!==s.emissive&&o.add(s,"emissive",{}),void 0!==s.sheen&&o.add(s,"sheenColor",{rename:"sheen"});let a,l=t.add("group",{name:"IMAGES",color:"#FFFF88",h:30}),h=[...Nl.imageMap,...Nl.imageNormal];for(let t=0;t<h.length;t++)if(a=h[t],name="null",void 0!==s[a]){let t=a.substring(0,a.lastIndexOf("M")),e="";"displacement"===t&&(t="displace"),"map"!==a&&"emissive"!==t&&"sheen"!==t||(e="srgb"),l.add(s,a,{name:a,rename:t,colorSpace:e,type:"bitmap",h:30})}let c=t.add("group",{name:"OPTIONS",color:"#88FFFF",h:30});void 0!==s.randomUv&&c.add(s,"randomUv",{}),void 0!==s.wireframe&&c.add(s,"wireframe",{}),void 0!==s.vertexColors&&c.add(s,"vertexColors",{}),void 0!==s.forceSinglePass&&c.add(s,"forceSinglePass",{rename:"singlePass"}),void 0!==s.visible&&c.add(s,"visible",{}),void 0!==s.depthTest&&c.add(s,"depthTest",{}),void 0!==s.depthWrite&&c.add(s,"depthWrite",{}),void 0!==s.alphaToCoverage&&c.add(s,"alphaToCoverage",{}),void 0!==s.premultipliedAlpha&&c.add(s,"premultipliedAlpha",{}),void 0!==s.transparent&&c.add(s,"transparent",{});let u=t.add("group",{name:"VALUES",open:!0,h:30});void 0!==s.normalScale&&u.add(s,"normalScale",{rename:"normal",min:-10,max:10,precision:2}),void 0!==s.clearcoatNormalScale&&u.add(s,"clearcoatNormalScale",{rename:"clearcoat n",min:-10,max:10,precision:2});let d={min:0,max:1,mode:2};void 0!==s.metalness&&u.add(s,"metalness",{...d}),void 0!==s.roughness&&u.add(s,"roughness",{...d}),void 0!==s.envMapIntensity&&u.add(s,"envMapIntensity",{...d,rename:"envmap",max:3}),void 0!==s.opacity&&u.add(s,"opacity",{...d}),void 0!==s.reflectivity&&u.add(s,"reflectivity",{...d}),void 0!==s.specularIntensity&&u.add(s,"specularIntensity",{...d}),void 0!==s.aoMapIntensity&&u.add(s,"aoMapIntensity",{...d,rename:"ao"}),void 0!==s.emissiveIntensity&&u.add(s,"emissiveIntensity",{...d,rename:"emissive",max:3}),void 0!==s.bumpScale&&u.add(s,"bumpScale",{...d,rename:"bump",max:3}),void 0!==s.reflectif&&u.add(s,"reflectif",{...d}),void 0!==s.thickness&&u.add(s,"thickness",{...d,min:-4,max:4}),void 0!==s.clearcoat&&u.add(s,"clearcoat",{...d}),void 0!==s.clearcoatRoughness&&u.add(s,"clearcoatRoughness",{...d}),void 0!==s.sheen&&(u.add(s,"sheen",{...d,min:0,max:4}),u.add(s,"sheenRoughness",{...d})),void 0!==s.iridescence&&u.add(s,"iridescence",{...d}),void 0!==s.anisotropy&&u.add(s,"anisotropy",{...d}),void 0!==s.anisotropyRotation&&u.add(s,"anisotropyRotation",{...d}),void 0!==s.ior&&u.add(s,"ior",{...d,min:0,max:4}),void 0!==s.transmission&&u.add(s,"transmission",{...d})},setTexture:(t,e,i,s,n={})=>{if("displace"===i?i="displacementMap":"map"!==i&&(i+="Map"),null===t)return void(s[i]=null);let r=s[i];r&&(n.repeat=r.repeat.toArray()),n.encoding=-1!==Nl.imageMap.indexOf(i),n.flipY=!1;let o=t.substring(0,t.lastIndexOf("."));if("exr"===t.substring(t.lastIndexOf(".")+1))Li.load_EXR(t,o,(function(t){s[i]=t}));else{let t=new Image;t.src=e,t.onload=function(){Li.data.set("I_"+o,t),s[i]=Li.getTexture(o,n)}}},materialEdit:t=>{"MAT"===Nl.mode&&t!==Nl.currentMat&&(Nl.currentMat=t,setTimeout(Nl.material,0))},postprocessEdit:t=>{"POST"===Nl.mode&&Nl.postprocess(!0)}},Vl=function(t,e=!1){var i="",s=e?["#baabfb","#9e87fb","#7463b8","#221d36"]:["#E5E5E5","#D1D1D1","#999999","#383838"],n=["<svg xmlns='http://www.w3.org/2000/svg' version='1.1' xmlns:xlink='http://www.w3.org/1999/xlink' style='pointer-events:none; margin-top:0px;' preserveAspectRatio='none' x='0px' y='0px' width='30px' height='26px' viewBox='0 0 30 26'><g>"];switch(t){case"phy":i="M 22.2 11.35 Q 21.95 10.15 21.25 9.1 L 22.45 7.85 Q 21.95 7.2 21.4 6.65 20.8 6 20.1 5.55 L 18.95 6.75 Q 17.9 6.05 16.65 5.8 L 16.65 4.15 Q 15.9 4 15.05 4 14.2 4 13.4 4.2 L 13.4 5.8 Q 12.15 6.05 11.15 6.75 L 9.95 5.55 Q 9.25 6 8.65 6.65 8.1 7.2 7.65 7.9 L 8.8 9.05 Q 8.1 10.1 7.85 11.35 L 6.2 11.35 Q 6.1 12.15 6.1 13 6.1 13.85 6.2 14.65 L 7.85 14.65 Q 8.1 15.85 8.8 16.9 L 7.6 18.05 Q 8.1 18.7 8.7 19.3 9.25 19.9 9.95 20.4 L 11.1 19.25 Q 12.15 19.9 13.4 20.2 L 13.4 21.85 Q 14.2 21.95 15.05 21.95 15.9 21.95 16.65 21.85 L 16.65 20.2 Q 17.9 19.9 19 19.25 L 20.15 20.4 Q 20.8 19.95 21.4 19.35 22 18.75 22.45 18.05 L 21.25 16.85 Q 21.95 15.85 22.2 14.65 L 23.95 14.65 Q 24.05 13.85 24.05 13 24.05 12.15 23.95 11.35 L 22.2 11.35 M 13.25 11.3 Q 14 10.55 15.05 10.55 16 10.55 16.75 11.3 17.5 12 17.5 13 17.5 14.05 16.75 14.7 16 15.45 15.05 15.45 14 15.45 13.25 14.7 12.6 14.05 12.6 13 12.6 12 13.25 11.3 Z",n[1]="<path stroke="+s[3]+" stroke-width='2' stroke-linejoin='round' stroke-linecap='round' fill='none' d='"+i+"'/>",n[1]+="<path fill="+s[1]+" stroke='none' d='"+i+"'/>";break;case"env":i="M 7.95 18.65 L 9.35 20.05 10.75 18.65 9.35 17.25 7.95 18.65 M 9.35 5.95 L 7.95 7.35 9.35 8.75 10.75 7.35 9.35 5.95 M 20.65 20.05 L 22.05 18.65 20.65 17.25 19.25 18.65 20.65 20.05 M 20.65 8.75 L 22.05 7.35 20.65 5.95 19.25 7.35 20.65 8.75 M 14 22 L 16 22 16 20 14 20 14 22 M 16 6 L 16 4 14 4 14 6 16 6 M 24 12 L 22 12 22 14 24 14 24 12 M 8 12 L 6 12 6 14 8 14 8 12 M 19.3 17.3 Q 21.05 15.55 21.05 13.05 21.05 10.5 19.3 8.75 17.55 7.05 15.05 7.05 12.55 7.05 10.8 8.75 9.05 10.5 9.05 13.05 9.05 15.55 10.8 17.3 12.55 19.05 15.05 19.05 17.55 19.05 19.3 17.3 Z",n[1]="<path stroke="+s[3]+" stroke-width='2' stroke-linejoin='round' stroke-linecap='round' fill='none' d='"+i+"'/>",n[1]+="<path fill="+s[1]+" stroke='none' d='"+i+"'/>";break;case"post":i="M 24 22 L 24 8 20 8 20 4 6 4 6 18 10 18 10 22 24 22 Z",n[1]="<path stroke="+s[3]+" stroke-width='2' stroke-linejoin='round' stroke-linecap='round' fill='none' d='"+i+"'/>",n[1]+="<path fill="+s[1]+" stroke='none' d='"+i+"'/>",n[1]+="<path fill="+s[2]+" stroke='none' d='M 20 8 L 20 4 6 4 6 18 10 18 10 8 20 8 Z'/>";break;case"cam":i="M 23 20 L 24 20 24 6 23 6 19 10 18.05 10 18.05 6.05 6.05 6.05 6.05 20.3 18.05 20.3 18.05 16 19 16 23 20 Z",n[1]="<path stroke="+s[3]+" stroke-width='2' stroke-linejoin='round' stroke-linecap='round' fill='none' d='"+i+"'/>",n[1]+="<path fill="+s[2]+" stroke='none' d='"+i+"'/>",n[1]+="<path fill="+s[1]+" stroke='none' d='M 23 20 L 24 20 24 6 23 6 19 10 19 16 23 20 M 18 6.05 L 8 6.05 8 18.15 18 18.15 18 6.05 Z'/>";break;case"mat":i="M 24 4 L 6 4 6 22 24 22 24 4 Z",n[1]="<path stroke="+s[3]+" stroke-width='2' stroke-linejoin='round' stroke-linecap='round' fill='none' d='"+i+"'/>",n[1]+="<path fill="+s[2]+" stroke='none' d='"+i+"'/>",n[1]+="<path fill="+s[1]+" stroke='none' d='M 15 4 L 6 4 6 13 15 13 15 4 M 24 13 L 15 13 15 22 24 22 24 13 Z'/>";break;case"asset":i="M 24 19.8 L 24 14.2 19.5 11.95 19.5 6.3 15 4.05 10.5 6.3 10.5 11.95 6 14.2 6 19.8 10.5 22.05 15 19.8 19.5 22.05 24 19.8 Z",n[1]="<path stroke="+s[3]+" stroke-width='2' stroke-linejoin='round' stroke-linecap='round' fill='none' d='"+i+"'/>",n[1]+="<path fill="+s[2]+" stroke='none' d='"+i+"'/>",n[1]+="<path fill="+s[1]+" stroke='none' d='M 6 14.2 L 6 19.8 10.5 22.05 10.5 16.45 6 14.2 M 19.5 22.05 L 19.5 16.45 15 14.2 15 19.8 19.5 22.05 M 15 8.55 L 10.5 6.3 10.5 11.95 15 14.2 15 8.55 Z'/>",n[1]+="<path fill="+s[0]+" stroke='none' d='M 15 14.2 L 19.5 16.45 24 14.2 19.5 11.95 15 14.2 M 10.5 16.45 L 15 14.2 10.5 11.95 6 14.2 10.5 16.45 M 10.5 6.3 L 15 8.55 19.5 6.3 15 4.05 10.5 6.3 Z'/>"}return n[2]="</g></svg>",n.join("\n")};var Bl="#282923",$l="19px",Xl="15px",jl="\n.codeflask {\n  background: "+Bl+";\n  //color: rgba(0, 0, 0, 0);\n  color: #f8f8f2;\n  //border-radius: 12px;\n  //text-shadow: 1px 1px 1px black;\n  //resize: true;\n}\n\n.codeflask ::-webkit-scrollbar {\n  width: 15px;\n  height:15px;\n}\n\n.codeflask ::-webkit-scrollbar-track {\n  background:none;\n  /*background-clip: content-box;*/\n  \n}\n\n.codeflask ::-webkit-scrollbar-thumb {\n  background-color: #555652; \n  width: 7px;\n  //border-radius: 12px;\n  border: 4px solid "+Bl+";\n}\n\n.codeflask ::-webkit-scrollbar-corner {\n  background-color: rgba(0,0,0,0);\n}\n\n\n\n.codeflask ::selection {\n  color: transparent;\n  background-color: #47473d; //rgba(71, 71, 61, 0.5);\n}\n\n.codeflask ::-moz-selection{\n  color: transparent;\n  background-color: #47473d; //rgba(71, 71, 61, 0.5);\n}\n\n\n.codeflask .token.punctuation { color: #f8f8f2; /* white */ }\n\n.codeflask .token.function { color: #67d8ef; /* blue */ } \n.codeflask .token.keyword { color: #67d8ef; font-style: italic; /* blue */ }\n\n.codeflask .token.function-variable { color: #a6e22c; /* green */ }\n.codeflask .token.class-name { color: #a6e22c; /* green */ }\n.codeflask .token.function-extra { color: #a6e22c; /* green */ }\n\n.codeflask .token.keyword-variable { color: #f92672; font-style: normal; /* red */ }\n.codeflask .token.operator { color: #f92672; /* red */ }\n\n.codeflask .token.parameter { color: #fd9621;/* orange */}\n.codeflask .token.parameter-variable { color: #fd9621;/* orange */}\n\n.codeflask .token.string { color: #e7db75; /* yellow */ }\n\n.codeflask .token.comment { color: #75715e; /* grey */ }\n\n\n\n.codeflask .token.boolean { color: #ae81ff; /* purple */ }\n.codeflask .token.number { color: #ae81ff; /* purple */ }\n\n.codeflask .token-template-string { color: #000000; }\n.codeflask .token-class-name { color: #000000; }\n.codeflask .token-regex { color: #000000; }\n\n.codeflask .token.selector { color: #00FF00; }\n.codeflask .token.property { color: #ac80ff;}\n.codeflask .token.tag { color: #FFFF00; }\n.codeflask .token.attr-value { color: #0000FF;}\n\n";var Gl="Consolas, Menlo, Courier, monospace",Zl=function(t,e){return"undefined"!=typeof CSS?CSS.supports(t,e):"undefined"!=typeof document&&function(t){return(t=t.split("-").filter((function(t){return!!t})).map((function(t){return t[0].toUpperCase()+t.substr(1)})).join(""))[0].toLowerCase()+t.substr(1)}(t)in document.body.style}("caret-color","#F00")?Bl:"#ccc",ql="40px",Wl="\n  .codeflask {\n    -o-user-select:none; -ms-user-select:none; -khtml-user-select:none; -webkit-user-select:none; -moz-user-select: none;\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n  }\n\n  .codeflask, .codeflask * {\n    box-sizing: border-box;\n    border: none;\n    resize: none;\n    outline: none;\n  }\n\n  .codeflask__pre {\n    -o-user-select:none; -ms-user-select:none; -khtml-user-select:none; -webkit-user-select:none; -moz-user-select: none; pointer-events:none;\n    z-index: 3;\n    transform:translate3d(0, 0, 0);\n    box-sizing: border-box;\n    //white-space: pre;\n    padding:0px;\n    word-wrap: normal;\n    box-sizing: border-box;\n    border: none;\n    resize: none;\n    outline: none;\n    overflow: visible; !important;\n  }\n\n  .codeflask__textarea {\n\n    background: none;\n    //background:red;\n    border: none;\n    color: "+Zl+";\n    color: rgba(0, 0, 0, 0);\n    z-index: 1;\n    resize: none;\n    //font-family: "+Gl+";\n    //text-rendering: optimizeSpeed;\n    //text-rendering: inherit;\n    //-webkit-appearance: pre;\n    caret-color: #fff;\n    z-index: 2;\n    width: 100%;\n    height: 100%;\n    -moz-box-sizing: border-box;\n    box-sizing: border-box;\n\n    border: none;\n    outline: none;\n    spellcheck:false;\n    //overflow: hidden;\n    overflow: scroll !important;\n\n  }\n\n  .codeflask--has-line-numbers .codeflask__textarea {\n    width: calc(100% - "+ql+");\n  }\n\n  .codeflask__code {\n    //padding: 10px;\n    //background:black;\n    display:block;\n    font-size: "+Xl+";\n    line-height: "+$l+";\n    font-family: "+Gl+";\n    //overflow: hidden;\n    //overflow: scroll !important;\n    //left:3px;\n    //width: auto;\n    //position: absolute;\n    outline: none;\n    resize: none;\n    box-sizing: content-box;\n    display: inline-block;\n  }\n\n  .codeflask__flatten {\n\n    //background:grey;\n    padding: 10px;\n    font-size: "+Xl+";\n    line-height: "+$l+";\n    font-family: "+Gl+";\n    text-rendering: optimizeLegibility;\n    //letter-spacing: 1px;\n    white-space: pre;\n    word-wrap: normal;\n    box-sizing: border-box;\n    position: absolute;\n    top: 0;\n    left: 0;\n    margin: 0 !important;\n    outline: none;\n    text-align: left;\n    cursor:auto;\n    outline: none;\n    border-radius: 0;\n    border-width: 0;\n    background: transparent;\n    //-webkit-background-clip: padding-box;\n    background-clip: padding-box;\n    resize: none;\n\n  }\n\n  .codeflask--has-line-numbers .codeflask__flatten {\n    width: calc(100% - "+ql+");\n    left: "+ql+";\n    outline: none;\n  }\n\n  .codeflask__line-highlight {\n    position: absolute;\n    top: 10px;\n    left: 0;\n    width: 100%;\n    height: "+$l+";\n    background: rgba(0,0,0,0.1);\n\n    z-index: 1;\n    //visibility: hidden;\n    outline: none;\n  }\n\n  .codeflask__lines {\n    padding: 10px 4px;\n    font-size:  "+Xl+";\n    line-height: "+$l+";\n    font-family: "+Gl+";\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: "+ql+";\n    height: 100%;\n    text-align: right;\n    color: #90918b;\n    z-index: 2;\n    outline: none;\n  }\n\n  .codeflask__lines__line {\n    display: block;\n    outline: none;\n  }\n\n  .codeflask.codeflask--has-line-numbers {\n    padding-left: "+ql+";\n  }\n\n  .codeflask.codeflask--has-line-numbers:before {\n    content: '';\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: "+ql+";\n    height: 100%;\n    //background: "+Bl+";\n    z-index: 1;\n    outline: none;\n  }\n\n  .codeflask__error {\n    padding: 0px 0px;\n    padding-right:4px;\n    font-size:  "+Xl+";\n    font-family: "+Gl+";\n    position: absolute;\n    left: 0;\n    width: "+ql+";\n    height: "+$l+";\n    text-align: right;\n    color: #FF0000;\n    background:rgba(255,0,0,0.3);\n    outline: none;\n    z-index: 3;\n    display:none;\n  }\n";function Hl(t,e,i){var s=e||"codeflask-style",n=i||document.head;if(!t)return!1;if(document.getElementById(s))return!0;var r=document.createElement("style");return r.innerHTML=t,r.id=s,n.appendChild(r),!0}var Yl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Kl(t){return String(t).replace(/[&<>"'`=/]/g,(function(t){return Yl[t]}))}var Jl=function(t){var e=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,i=0,s={},n={manual:t.Prism&&t.Prism.manual,disableWorkerMessageHandler:t.Prism&&t.Prism.disableWorkerMessageHandler,util:{encode:function t(e){return e instanceof r?new r(e.type,t(e.content),e.alias):Array.isArray(e)?e.map(t):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(t){return Object.prototype.toString.call(t).slice(8,-1)},objId:function(t){return t.__id||Object.defineProperty(t,"__id",{value:++i}),t.__id},clone:function t(e,i){var s,r;switch(i=i||{},n.util.type(e)){case"Object":if(r=n.util.objId(e),i[r])return i[r];for(var o in s={},i[r]=s,e)e.hasOwnProperty(o)&&(s[o]=t(e[o],i));return s;case"Array":return r=n.util.objId(e),i[r]?i[r]:(s=[],i[r]=s,e.forEach((function(e,n){s[n]=t(e,i)})),s);default:return e}},getLanguage:function(t){for(;t;){var i=e.exec(t.className);if(i)return i[1].toLowerCase();t=t.parentElement}return"none"},setLanguage:function(t,i){t.className=t.className.replace(RegExp(e,"gi"),""),t.classList.add("language-"+i)},currentScript:function(){if("undefined"==typeof document)return null;if("currentScript"in document)return document.currentScript;try{throw new Error}catch(s){var t=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(s.stack)||[])[1];if(t){var e=document.getElementsByTagName("script");for(var i in e)if(e[i].src==t)return e[i]}return null}},isActive:function(t,e,i){for(var s="no-"+e;t;){var n=t.classList;if(n.contains(e))return!0;if(n.contains(s))return!1;t=t.parentElement}return!!i}},languages:{plain:s,plaintext:s,text:s,txt:s,extend:function(t,e){var i=n.util.clone(n.languages[t]);for(var s in e)i[s]=e[s];return i},insertBefore:function(t,e,i,s){var r=(s=s||n.languages)[t],o={};for(var a in r)if(r.hasOwnProperty(a)){if(a==e)for(var l in i)i.hasOwnProperty(l)&&(o[l]=i[l]);i.hasOwnProperty(a)||(o[a]=r[a])}var h=s[t];return s[t]=o,n.languages.DFS(n.languages,(function(e,i){i===h&&e!=t&&(this[e]=o)})),o},DFS:function t(e,i,s,r){r=r||{};var o=n.util.objId;for(var a in e)if(e.hasOwnProperty(a)){i.call(e,a,e[a],s||a);var l=e[a],h=n.util.type(l);"Object"!==h||r[o(l)]?"Array"!==h||r[o(l)]||(r[o(l)]=!0,t(l,i,a,r)):(r[o(l)]=!0,t(l,i,null,r))}}},plugins:{},highlightAll:function(t,e){n.highlightAllUnder(document,t,e)},highlightAllUnder:function(t,e,i){var s={callback:i,container:t,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};n.hooks.run("before-highlightall",s),s.elements=Array.prototype.slice.apply(s.container.querySelectorAll(s.selector)),n.hooks.run("before-all-elements-highlight",s);for(var r,o=0;r=s.elements[o++];)n.highlightElement(r,!0===e,s.callback)},highlightElement:function(e,i,s){var r=n.util.getLanguage(e),o=n.languages[r];n.util.setLanguage(e,r);var a=e.parentElement;a&&"pre"===a.nodeName.toLowerCase()&&n.util.setLanguage(a,r);var l={element:e,language:r,grammar:o,code:e.textContent};function h(t){l.highlightedCode=t,n.hooks.run("before-insert",l),l.element.innerHTML=l.highlightedCode,n.hooks.run("after-highlight",l),n.hooks.run("complete",l),s&&s.call(l.element)}if(n.hooks.run("before-sanity-check",l),(a=l.element.parentElement)&&"pre"===a.nodeName.toLowerCase()&&!a.hasAttribute("tabindex")&&a.setAttribute("tabindex","0"),!l.code)return n.hooks.run("complete",l),void(s&&s.call(l.element));if(n.hooks.run("before-highlight",l),l.grammar)if(i&&t.Worker){var c=new Worker(n.filename);c.onmessage=function(t){h(t.data)},c.postMessage(JSON.stringify({language:l.language,code:l.code,immediateClose:!0}))}else h(n.highlight(l.code,l.grammar,l.language));else h(n.util.encode(l.code))},highlight:function(t,e,i){var s={code:t,grammar:e,language:i};if(n.hooks.run("before-tokenize",s),!s.grammar)throw new Error('The language "'+s.language+'" has no grammar.');return s.tokens=n.tokenize(s.code,s.grammar),n.hooks.run("after-tokenize",s),r.stringify(n.util.encode(s.tokens),s.language)},tokenize:function(t,e){var i=e.rest;if(i){for(var s in i)e[s]=i[s];delete e.rest}var h=new function(){var t={value:null,prev:null,next:null},e={value:null,prev:t,next:null};t.next=e,this.head=t,this.tail=e,this.length=0};return a(h,h.head,t),function t(e,i,s,h,c,u){for(var d in s)if(s.hasOwnProperty(d)&&s[d]){var p=s[d];p=Array.isArray(p)?p:[p];for(var f=0;f<p.length;++f){if(u&&u.cause==d+","+f)return;var m=p[f],g=m.inside,v=!!m.lookbehind,y=!!m.greedy,b=m.alias;if(y&&!m.pattern.global){var x=m.pattern.toString().match(/[imsuy]*$/)[0];m.pattern=RegExp(m.pattern.source,x+"g")}for(var O=m.pattern||m,w=h.next,S=c;w!==i.tail&&!(u&&S>=u.reach);S+=w.value.length,w=w.next){var k=w.value;if(i.length>e.length)return;if(!(k instanceof r)){var A,T=1;if(y){if(!(A=o(O,S,e,v))||A.index>=e.length)break;var M=A.index,P=A.index+A[0].length,C=S;for(C+=w.value.length;M>=C;)C+=(w=w.next).value.length;if(S=C-=w.value.length,w.value instanceof r)continue;for(var _=w;_!==i.tail&&(C<P||"string"==typeof _.value);_=_.next)T++,C+=_.value.length;T--,k=e.slice(S,C),A.index-=S}else if(!(A=o(O,0,k,v)))continue;M=A.index;var R=A[0],E=k.slice(0,M),Q=k.slice(M+R.length),L=S+k.length;u&&L>u.reach&&(u.reach=L);var F=w.prev;if(E&&(F=a(i,F,E),S+=E.length),l(i,F,T),w=a(i,F,new r(d,g?n.tokenize(R,g):R,b,R)),Q&&a(i,w,Q),T>1){var I={cause:d+","+f,reach:L};t(e,i,s,w.prev,S,I),u&&I.reach>u.reach&&(u.reach=I.reach)}}}}}}(t,h,e,h.head,0),function(t){for(var e=[],i=t.head.next;i!==t.tail;)e.push(i.value),i=i.next;return e}(h)},hooks:{all:{},add:function(t,e){var i=n.hooks.all;i[t]=i[t]||[],i[t].push(e)},run:function(t,e){var i=n.hooks.all[t];if(i&&i.length)for(var s,r=0;s=i[r++];)s(e)}},Token:r};function r(t,e,i,s){this.type=t,this.content=e,this.alias=i,this.length=0|(s||"").length}function o(t,e,i,s){t.lastIndex=e;var n=t.exec(i);if(n&&s&&n[1]){var r=n[1].length;n.index+=r,n[0]=n[0].slice(r)}return n}function a(t,e,i){var s=e.next,n={value:i,prev:e,next:s};return e.next=n,s.prev=n,t.length++,n}function l(t,e,i){for(var s=e.next,n=0;n<i&&s!==t.tail;n++)s=s.next;e.next=s,s.prev=e,t.length-=n}if(t.Prism=n,r.stringify=function t(e,i){if("string"==typeof e)return e;if(Array.isArray(e)){var s="";return e.forEach((function(e){s+=t(e,i)})),s}var r={type:e.type,content:t(e.content,i),tag:"span",classes:["token",e.type],attributes:{},language:i},o=e.alias;o&&(Array.isArray(o)?Array.prototype.push.apply(r.classes,o):r.classes.push(o)),n.hooks.run("wrap",r);var a="";for(var l in r.attributes)a+=" "+l+'="'+(r.attributes[l]||"").replace(/"/g,"&quot;")+'"';return"<"+r.tag+' class="'+r.classes.join(" ")+'"'+a+">"+r.content+"</"+r.tag+">"},!t.document)return t.addEventListener?(n.disableWorkerMessageHandler||t.addEventListener("message",(function(e){var i=JSON.parse(e.data),s=i.language,r=i.code,o=i.immediateClose;t.postMessage(n.highlight(r,n.languages[s],s)),o&&t.close()}),!1),n):n;var h=n.util.currentScript();function c(){n.manual||n.highlightAll()}if(h&&(n.filename=h.src,h.hasAttribute("data-manual")&&(n.manual=!0)),!n.manual){var u=document.readyState;"loading"===u||"interactive"===u&&h&&h.defer?document.addEventListener("DOMContentLoaded",c):window.requestAnimationFrame?window.requestAnimationFrame(c):window.setTimeout(c,16)}return n}("undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{});"undefined"!=typeof module&&module.exports&&(module.exports=Jl),"undefined"!=typeof global&&(global.Prism=Jl),Jl.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},Jl.languages.markup.tag.inside["attr-value"].inside.entity=Jl.languages.markup.entity,Jl.languages.markup.doctype.inside["internal-subset"].inside=Jl.languages.markup,Jl.hooks.add("wrap",(function(t){"entity"===t.type&&(t.attributes.title=t.content.replace(/&amp;/,"&"))})),Object.defineProperty(Jl.languages.markup.tag,"addInlined",{value:function(t,e){var i={};i["language-"+e]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:Jl.languages[e]},i.cdata=/^<!\[CDATA\[|\]\]>$/i;var s={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:i}};s["language-"+e]={pattern:/[\s\S]+/,inside:Jl.languages[e]};var n={};n[t]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,(function(){return t})),"i"),lookbehind:!0,greedy:!0,inside:s},Jl.languages.insertBefore("markup","cdata",n)}}),Object.defineProperty(Jl.languages.markup.tag,"addAttribute",{value:function(t,e){Jl.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+t+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[e,"language-"+e],inside:Jl.languages[e]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),Jl.languages.html=Jl.languages.markup,Jl.languages.mathml=Jl.languages.markup,Jl.languages.svg=Jl.languages.markup,Jl.languages.xml=Jl.languages.extend("markup",{}),Jl.languages.ssml=Jl.languages.xml,Jl.languages.atom=Jl.languages.xml,Jl.languages.rss=Jl.languages.xml,function(t){var e=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;t.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+e.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+e.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+e.source+"$"),alias:"url"}}},selector:{pattern:RegExp("(^|[{}\\s])[^{}\\s](?:[^{};\"'\\s]|\\s+(?![\\s{])|"+e.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:e,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},t.languages.css.atrule.inside.rest=t.languages.css;var i=t.languages.markup;i&&(i.tag.addInlined("style","css"),i.tag.addAttribute("style","css"))}(Jl),Jl.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},Jl.languages.javascript=Jl.languages.extend("clike",{"class-name":[Jl.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|window|document|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|of|package|private|protected|public|return|static|super|switch|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+/NaN|Infinity|null/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?/}),Jl.languages.javascript["class-name"][0].pattern=/(\b(?:class|interface|extends|implements|instanceof|new|)\s+)[\w.\\]+/,Jl.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:Jl.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},"function-extra":{pattern:/(?:constructor)/,alias:"keyword"},"keyword-variable":{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|continue|debugger|default|delete|do|else|enum|export|default|extends|for|from|(?:get|set)(?=\s*[\[$\w\xA0-\uFFFF])|if|implements|import|in|instanceof|interface|new|of|package|private|protected|public|return|static|super|switch|throw|try|typeof|undefined|void|while|with|yield)\b/,alias:"keyword"},"parameter-variable":{pattern:/this/,alias:"keyword"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:Jl.languages.javascript},{pattern:/(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,inside:Jl.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:Jl.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:Jl.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),Jl.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:Jl.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),Jl.languages.markup&&(Jl.languages.markup.tag.addInlined("script","javascript"),Jl.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),Jl.languages.js=Jl.languages.javascript,Jl.languages.c=Jl.languages.extend("clike",{comment:{pattern:/\/\/(?:[^\r\n\\]|\\(?:\r\n?|\n|(?![\r\n])))*|\/\*[\s\S]*?(?:\*\/|$)/,greedy:!0},string:{pattern:/"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"/,greedy:!0},"class-name":{pattern:/(\b(?:enum|struct)\s+(?:__attribute__\s*\(\([\s\S]*?\)\)\s*)?)\w+|\b[a-z]\w*_t\b/,lookbehind:!0},keyword:/\b(?:_Alignas|_Alignof|_Atomic|_Bool|_Complex|_Generic|_Imaginary|_Noreturn|_Static_assert|_Thread_local|__attribute__|asm|auto|break|case|char|const|continue|default|do|double|else|enum|extern|float|for|goto|if|inline|int|long|register|return|short|signed|sizeof|static|struct|switch|typedef|typeof|union|unsigned|void|volatile|while)\b/,function:/\b[a-z_]\w*(?=\s*\()/i,number:/(?:\b0x(?:[\da-f]+(?:\.[\da-f]*)?|\.[\da-f]+)(?:p[+-]?\d+)?|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?)[ful]{0,4}/i,operator:/>>=?|<<=?|->|([-+&|:])\1|[?:~]|[-+*/%&|^!=<>]=?/}),Jl.languages.insertBefore("c","string",{char:{pattern:/'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n]){0,32}'/,greedy:!0}}),Jl.languages.insertBefore("c","string",{macro:{pattern:/(^[\t ]*)#\s*[a-z](?:[^\r\n\\/]|\/(?!\*)|\/\*(?:[^*]|\*(?!\/))*\*\/|\\(?:\r\n|[\s\S]))*/im,lookbehind:!0,greedy:!0,alias:"property",inside:{string:[{pattern:/^(#\s*include\s*)<[^>]+>/,lookbehind:!0},Jl.languages.c.string],char:Jl.languages.c.char,comment:Jl.languages.c.comment,"macro-name":[{pattern:/(^#\s*define\s+)\w+\b(?!\()/i,lookbehind:!0},{pattern:/(^#\s*define\s+)\w+\b(?=\()/i,lookbehind:!0,alias:"function"}],directive:{pattern:/^(#\s*)[a-z]+/,lookbehind:!0,alias:"keyword"},"directive-hash":/^#/,punctuation:/##|\\(?=[\r\n])/,expression:{pattern:/\S[\s\S]*/,inside:Jl.languages.c}}}}),Jl.languages.insertBefore("c","function",{constant:/\b(?:EOF|NULL|SEEK_CUR|SEEK_END|SEEK_SET|__DATE__|__FILE__|__LINE__|__TIMESTAMP__|__TIME__|__func__|stderr|stdin|stdout)\b/}),delete Jl.languages.c.boolean,Jl.languages.glsl=Jl.languages.extend("c",{keyword:/\b(?:active|asm|atomic_uint|attribute|[ibdu]?vec[234]|bool|break|buffer|case|cast|centroid|class|coherent|common|const|continue|d?mat[234](?:x[234])?|default|discard|do|double|else|enum|extern|external|false|filter|fixed|flat|float|for|fvec[234]|goto|half|highp|hvec[234]|[iu]?sampler2DMS(?:Array)?|[iu]?sampler2DRect|[iu]?samplerBuffer|[iu]?samplerCube|[iu]?samplerCubeArray|[iu]?sampler[123]D|[iu]?sampler[12]DArray|[iu]?image2DMS(?:Array)?|[iu]?image2DRect|[iu]?imageBuffer|[iu]?imageCube|[iu]?imageCubeArray|[iu]?image[123]D|[iu]?image[12]DArray|if|in|inline|inout|input|int|interface|invariant|layout|long|lowp|mediump|namespace|noinline|noperspective|out|output|partition|patch|precise|precision|public|readonly|resource|restrict|return|sample|sampler[12]DArrayShadow|sampler[12]DShadow|sampler2DRectShadow|sampler3DRect|samplerCubeArrayShadow|samplerCubeShadow|shared|short|sizeof|smooth|static|struct|subroutine|superp|switch|template|this|true|typedef|uint|uniform|union|unsigned|using|varying|void|volatile|while|writeonly)\b/});var th=function(t,e){if(!t)throw Error("CodeFlask expects a parameter which is Element or a String selector");if(!e)throw Error("CodeFlask expects an object containing options as second parameter");if(t.nodeType)this.editorRoot=t;else{var i=document.querySelector(t);i&&(this.editorRoot=i)}this.opts=e,this.startEditor()};th.prototype.clear=function(){this.elPre.removeChild(this.elCode),this.opts.lineNumbers&&this.elWrapper.removeChild(this.elLineNumbers),this.elWrapper.removeChild(this.elPre),this.elWrapper.removeChild(this.elTextarea),this.editorRoot.removeChild(this.elWrapper),this.code="",this.editorRoot.innerHTML=""},th.prototype.startEditor=function(){if(!Hl(Wl,null,this.opts.styleParent))throw Error("Failed to inject CodeFlask CSS.");this.isEdit=!1,this.createWrapper(),this.createTextarea(),this.createPre(),this.createCode(),this.runOptions(),this.listenTextarea(),this.populateDefault(),this.updateCode(this.code)},th.prototype.getDom=function(){return this.elWrapper},th.prototype.getText=function(){return this.elTextarea},th.prototype.createWrapper=function(){this.code=this.editorRoot.innerHTML,this.editorRoot.innerHTML="",this.elWrapper=this.createElement("div",this.editorRoot),this.elWrapper.classList.add("codeflask")},th.prototype.createTextarea=function(){this.elTextarea=this.createElement("textarea",this.elWrapper),this.elTextarea.classList.add("codeflask__textarea","codeflask__flatten")},th.prototype.createPre=function(){this.elPre=this.createElement("pre",this.elWrapper),this.elPre.classList.add("codeflask__pre","codeflask__flatten")},th.prototype.createCode=function(){this.elCode=this.createElement("code",this.elPre),this.elCode.classList.add("codeflask__code","language-"+(this.opts.language||"html"))},th.prototype.createLineNumbers=function(){this.elLineNumbers=this.createElement("div",this.elWrapper),this.elLineNumbers.classList.add("codeflask__lines"),this.setLineNumber()},th.prototype.createError=function(){this.elError=this.createElement("div",this.elWrapper),this.elError.classList.add("codeflask__error")},th.prototype.createElement=function(t,e){var i=document.createElement(t);return e.appendChild(i),i},th.prototype.runOptions=function(){this.opts.rtl=this.opts.rtl||!1,this.opts.tabSize=this.opts.tabSize||4,this.opts.enableAutocorrect=this.opts.enableAutocorrect||!1,this.opts.lineNumbers=this.opts.lineNumbers||!1,this.opts.defaultTheme=!1!==this.opts.defaultTheme,this.opts.areaId=this.opts.areaId||null,this.opts.ariaLabelledby=this.opts.ariaLabelledby||null,this.opts.readonly=this.opts.readonly||null,"boolean"!=typeof this.opts.handleTabs&&(this.opts.handleTabs=!0),"boolean"!=typeof this.opts.handleSelfClosingCharacters&&(this.opts.handleSelfClosingCharacters=!0),"boolean"!=typeof this.opts.handleNewLineIndentation&&(this.opts.handleNewLineIndentation=!0),!0===this.opts.rtl&&(this.elTextarea.setAttribute("dir","rtl"),this.elPre.setAttribute("dir","rtl")),!1===this.opts.enableAutocorrect&&(this.elTextarea.setAttribute("spellcheck","false"),this.elTextarea.setAttribute("autocapitalize","off"),this.elTextarea.setAttribute("autocomplete","off"),this.elTextarea.setAttribute("autocorrect","off")),this.opts.lineNumbers&&(this.elWrapper.classList.add("codeflask--has-line-numbers"),this.createLineNumbers(),this.createError()),this.opts.defaultTheme&&Hl(jl,"theme-default",this.opts.styleParent),this.opts.areaId&&this.elTextarea.setAttribute("id",this.opts.areaId),this.opts.ariaLabelledby&&this.elTextarea.setAttribute("aria-labelledby",this.opts.ariaLabelledby),this.opts.readonly&&this.enableReadonlyMode()},th.prototype.updateLineNumbersCount=function(){for(var t="",e=1;e<=this.lineNumber;e++)t=t+'<span class="codeflask__lines__line">'+e+"</span>";this.elLineNumbers.innerHTML=t},th.prototype.listenTextarea=function(){var t=this;this.elTextarea.addEventListener("input",(function(e){t.code=e.target.value,t.elCode.innerHTML=Kl(e.target.value),t.highlight(),setTimeout((function(){t.runUpdate(),t.setLineNumber()}),1)})),this.elTextarea.addEventListener("keydown",(function(e){t.opts.readonly||(t.handleTabs(e),t.handleSelfClosingCharacters(e),t.handleNewLineIndentation(e),t.isEdit=!0)})),this.elTextarea.addEventListener("scroll",(function(e){t.scroll(e)}))},th.prototype.wheel=function(t){var e=t.deltaY>0?1:-1;this.elTextarea.scrollTop+=100*e,this.elPre.style.transform="translate3d(0, -"+this.elTextarea.scrollTop+"px, 0)",this.elLineNumbers&&(this.elLineNumbers.style.transform="translate3d(0, -"+this.elTextarea.scrollTop+"px, 0)"),this.elError&&(this.elError.style.transform="translate3d(0, -"+this.elTextarea.scrollTop+"px, 0)")},th.prototype.scroll=function(t){this.elPre.style.transform="translate3d(-"+t.target.scrollLeft+"px, -"+t.target.scrollTop+"px, 0)",this.elLineNumbers&&(this.elLineNumbers.style.transform="translate3d(-"+this.elTextarea.scrollLeft+"px, -"+t.target.scrollTop+"px, 0)"),this.elError&&(this.elError.style.transform="translate3d(-"+this.elTextarea.scrollLeft+"px, -"+t.target.scrollTop+"px, 0)")},th.prototype.handleTabs=function(t){if(this.opts.handleTabs){if(9!==t.keyCode)return!1;t.preventDefault();var e=this.elTextarea,i=e.selectionDirection,s=e.selectionStart,n=e.selectionEnd,r=e.value,o=r.substr(0,s),a=r.substring(s,n),l=r.substring(n),h=" ".repeat(this.opts.tabSize);if(s!==n&&a.length>=h.length){var c=s-o.split("\n").pop().length,u=h.length,d=h.length;t.shiftKey?(r.substr(c,h.length)===h?(u=-u,c>s?(a=a.substring(0,c)+a.substring(c+h.length),d=0):c===s?(u=0,d=0,a=a.substring(h.length)):(d=-d,o=o.substring(0,c)+o.substring(c+h.length))):(u=0,d=0),a=a.replace(new RegExp("\n"+h.split("").join("\\"),"g"),"\n")):(o=o.substr(0,c)+h+o.substring(c,s),a=a.replace(/\n/g,"\n"+h)),e.value=o+a+l,e.selectionStart=s+u,e.selectionEnd=s+a.length+d,e.selectionDirection=i}else e.value=o+h+l,e.selectionStart=s+h.length,e.selectionEnd=s+h.length;var p=e.value;this.updateCode(p),this.elTextarea.selectionEnd=n+this.opts.tabSize}return!0},th.prototype.handleSelfClosingCharacters=function(t){if(this.opts.handleSelfClosingCharacters){var e=t.key;if(!["(","[","{","<","'",'"'].includes(e)&&![")","]","}",">","'",'"'].includes(e))return!1;switch(e){case"(":case")":case"[":case"]":case"{":case"}":case"<":case">":case"'":case'"':this.closeCharacter(e)}return!0}},th.prototype.setLineNumber=function(){this.lineNumber=this.code.split("\n").length,this.opts.lineNumbers&&this.updateLineNumbersCount()},th.prototype.handleNewLineIndentation=function(t){if(!this.opts.handleNewLineIndentation)return!1;if(13!==t.keyCode)return!1;t.preventDefault();var e=this.elTextarea,i=e.selectionStart,s=e.selectionEnd,n=e.value,r=n.substr(0,i),o=n.substring(s),a=n.lastIndexOf("\n",i-1),l=a+n.slice(a+1).search(/[^ ]|$/),h=l>a?l-a:0,c=r+"\n"+" ".repeat(h)+o;return e.value=c,e.selectionStart=i+h+1,e.selectionEnd=i+h+1,this.updateCode(e.value),!0},th.prototype.closeCharacter=function(t){var e=this.elTextarea.selectionStart,i=this.elTextarea.selectionEnd;if(this.skipCloseChar(t)){var s=this.code.substr(i,1)===t,n=s?i+1:i,r=!s&&["'",'"'].includes(t)?t:"",o=""+this.code.substring(0,e)+r+this.code.substring(n);this.updateCode(o),this.elTextarea.selectionEnd=++this.elTextarea.selectionStart}else{var a=t;switch(t){case"(":a=String.fromCharCode(t.charCodeAt()+1);break;case"<":case"{":case"[":a=String.fromCharCode(t.charCodeAt()+2)}var l=this.code.substring(e,i),h=""+this.code.substring(0,e)+l+a+this.code.substring(i);this.updateCode(h)}this.elTextarea.selectionEnd=e},th.prototype.skipCloseChar=function(t){var e=this.elTextarea.selectionStart,i=this.elTextarea.selectionEnd,s=Math.abs(i-e)>0;return[")","}","]",">"].includes(t)||["'",'"'].includes(t)&&!s},th.prototype.updateCode=function(t){this.isEdit=!1,this.code=t,this.elTextarea.value=t,this.elCode.innerHTML=Kl(t),this.highlight(),this.setLineNumber(),setTimeout(this.runUpdate.bind(this),1)},th.prototype.updateLanguage=function(t){var e=this.opts.language;this.elCode.classList.remove("language-"+e),this.elCode.classList.add("language-"+t),this.opts.language=t,this.highlight()},th.prototype.addLanguage=function(t,e){Jl.languages[t]=e},th.prototype.populateDefault=function(){this.updateCode(this.code)},th.prototype.highlight=function(){Jl.highlightElement(this.elCode,!1)},th.prototype.onUpdate=function(t){if(t&&"[object Function]"!=={}.toString.call(t))throw Error("CodeFlask expects callback of type Function");this.updateCallBack=t},th.prototype.getCode=function(){return this.code},th.prototype.runUpdate=function(){this.updateCallBack&&this.updateCallBack(this.code)},th.prototype.enableReadonlyMode=function(){this.elTextarea.setAttribute("readonly",!0)},th.prototype.disableReadonlyMode=function(){this.elTextarea.removeAttribute("readonly")},th.prototype.noError=function(){this.elError&&(this.elError.innerHTML="",this.elError.style.display="none")},th.prototype.addError=function(t,e,i){this.elError&&(this.elError.style.display="block",this.elError.innerHTML=e,this.elError.style.marginTop=19*e-9+"px")};class eh{constructor(){}lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){let s=[];return this.decompose(0,t,s,2),i.length&&i.decompose(0,i.length,s,3),this.decompose(e,this.length,s,1),sh.from(s,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){let i=[];return this.decompose(t,e,i,0),sh.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),s=new oh(this),n=new oh(t);for(let t=e,r=e;;){if(s.next(t),n.next(t),t=0,s.lineBreak!=n.lineBreak||s.done!=n.done||s.value!=n.value)return!1;if(r+=s.value.length,s.done||r>=i)return!0}}iter(t=1){return new oh(this,t)}iterRange(t,e=this.length){return new ah(this,t,e)}iterLines(t,e){let i;if(null==t)i=this.iter();else{null==e&&(e=this.lines+1);let s=this.line(t).from;i=this.iterRange(s,Math.max(s,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new lh(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}static of(t){if(0==t.length)throw new RangeError("A document must have at least one line");return 1!=t.length||t[0]?t.length<=32?new ih(t):sh.from(ih.split(t,[])):eh.empty}}class ih extends eh{constructor(t,e=function(t){let e=-1;for(let i of t)e+=i.length+1;return e}(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,s){for(let n=0;;n++){let r=this.text[n],o=s+r.length;if((e?i:o)>=t)return new hh(s,o,i,r);s=o+1,i++}}decompose(t,e,i,s){let n=t<=0&&e>=this.length?this:new ih(rh(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(1&s){let t=i.pop(),e=nh(n.text,t.text.slice(),0,n.length);if(e.length<=32)i.push(new ih(e,t.length+n.length));else{let t=e.length>>1;i.push(new ih(e.slice(0,t)),new ih(e.slice(t)))}}else i.push(n)}replace(t,e,i){if(!(i instanceof ih))return super.replace(t,e,i);let s=nh(this.text,nh(i.text,rh(this.text,0,t)),e),n=this.length+i.length-(e-t);return s.length<=32?new ih(s,n):sh.from(ih.split(s,[]),n)}sliceString(t,e=this.length,i="\n"){let s="";for(let n=0,r=0;n<=e&&r<this.text.length;r++){let o=this.text[r],a=n+o.length;n>t&&r&&(s+=i),t<a&&e>n&&(s+=o.slice(Math.max(0,t-n),e-n)),n=a+1}return s}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let i=[],s=-1;for(let n of t)i.push(n),s+=n.length+1,32==i.length&&(e.push(new ih(i,s)),i=[],s=-1);return s>-1&&e.push(new ih(i,s)),e}}class sh extends eh{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let e of t)this.lines+=e.lines}lineInner(t,e,i,s){for(let n=0;;n++){let r=this.children[n],o=s+r.length,a=i+r.lines-1;if((e?a:o)>=t)return r.lineInner(t,e,i,s);s=o+1,i=a+1}}decompose(t,e,i,s){for(let n=0,r=0;r<=e&&n<this.children.length;n++){let o=this.children[n],a=r+o.length;if(t<=a&&e>=r){let n=s&((r<=t?1:0)|(a>=e?2:0));r>=t&&a<=e&&!n?i.push(o):o.decompose(t-r,e-r,i,n)}r=a+1}}replace(t,e,i){if(i.lines<this.lines)for(let s=0,n=0;s<this.children.length;s++){let r=this.children[s],o=n+r.length;if(t>=n&&e<=o){let a=r.replace(t-n,e-n,i),l=this.lines-r.lines+a.lines;if(a.lines<l>>4&&a.lines>l>>6){let n=this.children.slice();return n[s]=a,new sh(n,this.length-(e-t)+i.length)}return super.replace(n,o,a)}n=o+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i="\n"){let s="";for(let n=0,r=0;n<this.children.length&&r<=e;n++){let o=this.children[n],a=r+o.length;r>t&&n&&(s+=i),t<a&&e>r&&(s+=o.sliceString(t-r,e-r,i)),r=a+1}return s}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof sh))return 0;let i=0,[s,n,r,o]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;s+=e,n+=e){if(s==r||n==o)return i;let a=this.children[s],l=t.children[n];if(a!=l)return i+a.scanIdentical(l,e);i+=a.length+1}}static from(t,e=t.reduce(((t,e)=>t+e.length+1),-1)){let i=0;for(let e of t)i+=e.lines;if(i<32){let i=[];for(let e of t)e.flatten(i);return new ih(i,e)}let s=Math.max(32,i>>5),n=s<<1,r=s>>1,o=[],a=0,l=-1,h=[];function c(t){let e;if(t.lines>n&&t instanceof sh)for(let e of t.children)c(e);else t.lines>r&&(a>r||!a)?(u(),o.push(t)):t instanceof ih&&a&&(e=h[h.length-1])instanceof ih&&t.lines+e.lines<=32?(a+=t.lines,l+=t.length+1,h[h.length-1]=new ih(e.text.concat(t.text),e.length+1+t.length)):(a+t.lines>s&&u(),a+=t.lines,l+=t.length+1,h.push(t))}function u(){0!=a&&(o.push(1==h.length?h[0]:sh.from(h,l)),l=-1,a=h.length=0)}for(let e of t)c(e);return u(),1==o.length?o[0]:new sh(o,e)}}function nh(t,e,i=0,s=1e9){for(let n=0,r=0,o=!0;r<t.length&&n<=s;r++){let a=t[r],l=n+a.length;l>=i&&(l>s&&(a=a.slice(0,s-n)),n<i&&(a=a.slice(i-n)),o?(e[e.length-1]+=a,o=!1):e.push(a)),n=l+1}return e}function rh(t,e,i){return nh(t,[""],e,i)}eh.empty=new ih([""],0);class oh{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof ih?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,s=this.nodes[i],n=this.offsets[i],r=n>>1,o=s instanceof ih?s.text.length:s.children.length;if(r==(e>0?o:0)){if(0==i)return this.done=!0,this.value="",this;e>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((1&n)==(e>0?0:1)){if(this.offsets[i]+=e,0==t)return this.lineBreak=!0,this.value="\n",this;t--}else if(s instanceof ih){let n=s.text[r+(e<0?-1:0)];if(this.offsets[i]+=e,n.length>Math.max(0,t))return this.value=0==t?n:e>0?n.slice(t):n.slice(0,n.length-t),this;t-=n.length}else{let n=s.children[r+(e<0?-1:0)];t>n.length?(t-=n.length,this.offsets[i]+=e):(e<0&&this.offsets[i]--,this.nodes.push(n),this.offsets.push(e>0?1:(n instanceof ih?n.text.length:n.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}}class ah{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new oh(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:s}=this.cursor.next(t);return this.pos+=(s.length+t)*e,this.value=s.length<=i?s:e<0?s.slice(s.length-i):s.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&""!=this.value}}class lh{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:s}=this.inner.next(t);return e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}}"undefined"!=typeof Symbol&&(eh.prototype[Symbol.iterator]=function(){return this.iter()},oh.prototype[Symbol.iterator]=ah.prototype[Symbol.iterator]=lh.prototype[Symbol.iterator]=function(){return this});class hh{constructor(t,e,i,s){this.from=t,this.to=e,this.number=i,this.text=s}get length(){return this.to-this.from}}let ch="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((t=>t?parseInt(t,36):1));for(let t=1;t<ch.length;t++)ch[t]+=ch[t-1];function uh(t){for(let e=1;e<ch.length;e+=2)if(ch[e]>t)return ch[e-1]<=t;return!1}function dh(t){return t>=127462&&t<=127487}const ph=8205;function fh(t,e,i=!0,s=!0){return(i?mh:gh)(t,e,s)}function mh(t,e,i){if(e==t.length)return e;e&&vh(t.charCodeAt(e))&&yh(t.charCodeAt(e-1))&&e--;let s=bh(t,e);for(e+=Oh(s);e<t.length;){let n=bh(t,e);if(s==ph||n==ph||i&&uh(n))e+=Oh(n),s=n;else{if(!dh(n))break;{let i=0,s=e-2;for(;s>=0&&dh(bh(t,s));)i++,s-=2;if(i%2==0)break;e+=2}}}return e}function gh(t,e,i){for(;e>0;){let s=mh(t,e-2,i);if(s<e)return s;e--}return 0}function vh(t){return t>=56320&&t<57344}function yh(t){return t>=55296&&t<56320}function bh(t,e){let i=t.charCodeAt(e);if(!yh(i)||e+1==t.length)return i;let s=t.charCodeAt(e+1);return vh(s)?s-56320+(i-55296<<10)+65536:i}function xh(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}function Oh(t){return t<65536?1:2}const wh=/\r\n?|\n/;var Sh=function(t){return t[t.Simple=0]="Simple",t[t.TrackDel=1]="TrackDel",t[t.TrackBefore=2]="TrackBefore",t[t.TrackAfter=3]="TrackAfter",t}(Sh||(Sh={}));class kh{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return 0==this.sections.length||2==this.sections.length&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,s=0;e<this.sections.length;){let n=this.sections[e++],r=this.sections[e++];r<0?(t(i,s,n),s+=n):s+=r,i+=n}}iterChangedRanges(t,e=!1){Ph(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];s<0?t.push(i,s):t.push(s,i)}return new kh(t)}composeDesc(t){return this.empty?t:t.empty?this:_h(this,t)}mapDesc(t,e=!1){return t.empty?this:Ch(this,t,e)}mapPos(t,e=-1,i=Sh.Simple){let s=0,n=0;for(let r=0;r<this.sections.length;){let o=this.sections[r++],a=this.sections[r++],l=s+o;if(a<0){if(l>t)return n+(t-s);n+=o}else{if(i!=Sh.Simple&&l>=t&&(i==Sh.TrackDel&&s<t&&l>t||i==Sh.TrackBefore&&s<t||i==Sh.TrackAfter&&l>t))return null;if(l>t||l==t&&e<0&&!o)return t==s||e<0?n:n+a;n+=a}s=l}if(t>s)throw new RangeError(`Position ${t} is out of range for changeset of length ${s}`);return n}touchesRange(t,e=t){for(let i=0,s=0;i<this.sections.length&&s<=e;){let n=s+this.sections[i++];if(this.sections[i++]>=0&&s<=e&&n>=t)return!(s<t&&n>e)||"cover";s=n}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];t+=(t?" ":"")+i+(s>=0?":"+s:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some((t=>"number"!=typeof t)))throw new RangeError("Invalid JSON representation of ChangeDesc");return new kh(t)}static create(t){return new kh(t)}}class Ah extends kh{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return Ph(this,((e,i,s,n,r)=>t=t.replace(s,s+(i-e),r)),!1),t}mapDesc(t,e=!1){return Ch(this,t,e,!0)}invert(t){let e=this.sections.slice(),i=[];for(let s=0,n=0;s<e.length;s+=2){let r=e[s],o=e[s+1];if(o>=0){e[s]=o,e[s+1]=r;let a=s>>1;for(;i.length<a;)i.push(eh.empty);i.push(r?t.slice(n,n+r):eh.empty)}n+=r}return new Ah(e,i)}compose(t){return this.empty?t:t.empty?this:_h(this,t,!0)}map(t,e=!1){return t.empty?this:Ch(this,t,e,!0)}iterChanges(t,e=!1){Ph(this,t,e)}get desc(){return kh.create(this.sections)}filter(t){let e=[],i=[],s=[],n=new Rh(this);t:for(let r=0,o=0;;){let a=r==t.length?1e9:t[r++];for(;o<a||o==a&&0==n.len;){if(n.done)break t;let t=Math.min(n.len,a-o);Th(s,t,-1);let r=-1==n.ins?-1:0==n.off?n.ins:0;Th(e,t,r),r>0&&Mh(i,e,n.text),n.forward(t),o+=t}let l=t[r++];for(;o<l;){if(n.done)break t;let t=Math.min(n.len,l-o);Th(e,t,-1),Th(s,t,-1==n.ins?-1:0==n.off?n.ins:0),n.forward(t),o+=t}}return{changes:new Ah(e,i),filtered:kh.create(s)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],s=this.sections[e+1];s<0?t.push(i):0==s?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,i){let s=[],n=[],r=0,o=null;function a(t=!1){if(!t&&!s.length)return;r<e&&Th(s,e-r,-1);let i=new Ah(s,n);o=o?o.compose(i.map(o)):i,s=[],n=[],r=0}return function t(l){if(Array.isArray(l))for(let e of l)t(e);else if(l instanceof Ah){if(l.length!=e)throw new RangeError(`Mismatched change set length (got ${l.length}, expected ${e})`);a(),o=o?o.compose(l.map(o)):l}else{let{from:t,to:o=t,insert:h}=l;if(t>o||t<0||o>e)throw new RangeError(`Invalid change range ${t} to ${o} (in doc of length ${e})`);let c=h?"string"==typeof h?eh.of(h.split(i||wh)):h:eh.empty,u=c.length;if(t==o&&0==u)return;t<r&&a(),t>r&&Th(s,t-r,-1),Th(s,o-t,u),Mh(n,s,c),r=o}}(t),a(!o),o}static empty(t){return new Ah(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],i=[];for(let s=0;s<t.length;s++){let n=t[s];if("number"==typeof n)e.push(n,-1);else{if(!Array.isArray(n)||"number"!=typeof n[0]||n.some(((t,e)=>e&&"string"!=typeof t)))throw new RangeError("Invalid JSON representation of ChangeSet");if(1==n.length)e.push(n[0],0);else{for(;i.length<s;)i.push(eh.empty);i[s]=eh.of(n.slice(1)),e.push(n[0],i[s].length)}}}return new Ah(e,i)}static createSet(t,e){return new Ah(t,e)}}function Th(t,e,i,s=!1){if(0==e&&i<=0)return;let n=t.length-2;n>=0&&i<=0&&i==t[n+1]?t[n]+=e:0==e&&0==t[n]?t[n+1]+=i:s?(t[n]+=e,t[n+1]+=i):t.push(e,i)}function Mh(t,e,i){if(0==i.length)return;let s=e.length-2>>1;if(s<t.length)t[t.length-1]=t[t.length-1].append(i);else{for(;t.length<s;)t.push(eh.empty);t.push(i)}}function Ph(t,e,i){let s=t.inserted;for(let n=0,r=0,o=0;o<t.sections.length;){let a=t.sections[o++],l=t.sections[o++];if(l<0)n+=a,r+=a;else{let h=n,c=r,u=eh.empty;for(;h+=a,c+=l,l&&s&&(u=u.append(s[o-2>>1])),!(i||o==t.sections.length||t.sections[o+1]<0);)a=t.sections[o++],l=t.sections[o++];e(n,h,r,c,u),n=h,r=c}}}function Ch(t,e,i,s=!1){let n=[],r=s?[]:null,o=new Rh(t),a=new Rh(e);for(let t=-1;;)if(-1==o.ins&&-1==a.ins){let t=Math.min(o.len,a.len);Th(n,t,-1),o.forward(t),a.forward(t)}else if(a.ins>=0&&(o.ins<0||t==o.i||0==o.off&&(a.len<o.len||a.len==o.len&&!i))){let e=a.len;for(Th(n,a.ins,-1);e;){let i=Math.min(o.len,e);o.ins>=0&&t<o.i&&o.len<=i&&(Th(n,0,o.ins),r&&Mh(r,n,o.text),t=o.i),o.forward(i),e-=i}a.next()}else{if(!(o.ins>=0)){if(o.done&&a.done)return r?Ah.createSet(n,r):kh.create(n);throw new Error("Mismatched change set lengths")}{let e=0,i=o.len;for(;i;)if(-1==a.ins){let t=Math.min(i,a.len);e+=t,i-=t,a.forward(t)}else{if(!(0==a.ins&&a.len<i))break;i-=a.len,a.next()}Th(n,e,t<o.i?o.ins:0),r&&t<o.i&&Mh(r,n,o.text),t=o.i,o.forward(o.len-i)}}}function _h(t,e,i=!1){let s=[],n=i?[]:null,r=new Rh(t),o=new Rh(e);for(let t=!1;;){if(r.done&&o.done)return n?Ah.createSet(s,n):kh.create(s);if(0==r.ins)Th(s,r.len,0,t),r.next();else if(0!=o.len||o.done){if(r.done||o.done)throw new Error("Mismatched change set lengths");{let e=Math.min(r.len2,o.len),i=s.length;if(-1==r.ins){let i=-1==o.ins?-1:o.off?0:o.ins;Th(s,e,i,t),n&&i&&Mh(n,s,o.text)}else-1==o.ins?(Th(s,r.off?0:r.len,e,t),n&&Mh(n,s,r.textBit(e))):(Th(s,r.off?0:r.len,o.off?0:o.ins,t),n&&!o.off&&Mh(n,s,o.text));t=(r.ins>e||o.ins>=0&&o.len>e)&&(t||s.length>i),r.forward2(e),o.forward(e)}}else Th(s,0,o.ins,t),n&&Mh(n,s,o.text),o.next()}}class Rh{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return-2==this.ins}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?eh.empty:t[e]}textBit(t){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length&&!t?eh.empty:e[i].slice(this.off,null==t?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){-1==this.ins?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}}class Eh{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return 16&this.flags?this.to:this.from}get head(){return 16&this.flags?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return 4&this.flags?-1:8&this.flags?1:0}get bidiLevel(){let t=3&this.flags;return 3==t?null:t}get goalColumn(){let t=this.flags>>5;return 33554431==t?void 0:t}map(t,e=-1){let i,s;return this.empty?i=s=t.mapPos(this.from,e):(i=t.mapPos(this.from,1),s=t.mapPos(this.to,-1)),i==this.from&&s==this.to?this:new Eh(i,s,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return Qh.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return Qh.range(this.anchor,i)}eq(t){return this.anchor==t.anchor&&this.head==t.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||"number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid JSON representation for SelectionRange");return Qh.range(t.anchor,t.head)}static create(t,e,i){return new Eh(t,e,i)}}class Qh{constructor(t,e){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:Qh.create(this.ranges.map((i=>i.map(t,e))),this.mainIndex)}eq(t){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let e=0;e<this.ranges.length;e++)if(!this.ranges[e].eq(t.ranges[e]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return 1==this.ranges.length?this:new Qh([this.main],0)}addRange(t,e=!0){return Qh.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,Qh.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map((t=>t.toJSON())),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||"number"!=typeof t.main||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new Qh(t.ranges.map((t=>Eh.fromJSON(t))),t.main)}static single(t,e=t){return new Qh([Qh.range(t,e)],0)}static create(t,e=0){if(0==t.length)throw new RangeError("A selection needs at least one range");for(let i=0,s=0;s<t.length;s++){let n=t[s];if(n.empty?n.from<=i:n.from<i)return Qh.normalized(t.slice(),e);i=n.to}return new Qh(t,e)}static cursor(t,e=0,i,s){return Eh.create(t,t,(0==e?0:e<0?4:8)|(null==i?3:Math.min(2,i))|(null!=s?s:33554431)<<5)}static range(t,e,i){let s=(null!=i?i:33554431)<<5;return e<t?Eh.create(e,t,24|s):Eh.create(t,e,s|(e>t?4:0))}static normalized(t,e=0){let i=t[e];t.sort(((t,e)=>t.from-e.from)),e=t.indexOf(i);for(let i=1;i<t.length;i++){let s=t[i],n=t[i-1];if(s.empty?s.from<=n.to:s.from<n.to){let r=n.from,o=Math.max(s.to,n.to);i<=e&&e--,t.splice(--i,2,s.anchor>s.head?Qh.range(o,r):Qh.range(r,o))}}return new Qh(t,e)}}function Lh(t,e){for(let i of t.ranges)if(i.to>e)throw new RangeError("Selection points outside of document")}let Fh=0;class Ih{constructor(t,e,i,s,n){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=s,this.id=Fh++,this.default=t([]),this.extensions="function"==typeof n?n(this):n}static define(t={}){return new Ih(t.combine||(t=>t),t.compareInput||((t,e)=>t===e),t.compare||(t.combine?(t,e)=>t===e:Dh),!!t.static,t.enables)}of(t){return new Uh([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new Uh(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new Uh(t,this,2,e)}from(t,e){return e||(e=t=>t),this.compute([t],(i=>e(i.field(t))))}}function Dh(t,e){return t==e||t.length==e.length&&t.every(((t,i)=>t===e[i]))}class Uh{constructor(t,e,i,s){this.dependencies=t,this.facet=e,this.type=i,this.value=s,this.id=Fh++}dynamicSlot(t){var e;let i=this.value,s=this.facet.compareInput,n=this.id,r=t[n]>>1,o=2==this.type,a=!1,l=!1,h=[];for(let i of this.dependencies)"doc"==i?a=!0:"selection"==i?l=!0:0==(1&(null!==(e=t[i.id])&&void 0!==e?e:1))&&h.push(t[i.id]);return{create:t=>(t.values[r]=i(t),1),update(t,e){if(a&&e.docChanged||l&&(e.docChanged||e.selection)||Nh(t,h)){let e=i(t);if(o?!zh(e,t.values[r],s):!s(e,t.values[r]))return t.values[r]=e,1}return 0},reconfigure:(t,e)=>{let a,l=e.config.address[n];if(null!=l){let n=ec(e,l);if(this.dependencies.every((i=>i instanceof Ih?e.facet(i)===t.facet(i):!(i instanceof $h)||e.field(i,!1)==t.field(i,!1)))||(o?zh(a=i(t),n,s):s(a=i(t),n)))return t.values[r]=n,0}else a=i(t);return t.values[r]=a,1}}}}function zh(t,e,i){if(t.length!=e.length)return!1;for(let s=0;s<t.length;s++)if(!i(t[s],e[s]))return!1;return!0}function Nh(t,e){let i=!1;for(let s of e)1&tc(t,s)&&(i=!0);return i}function Vh(t,e,i){let s=i.map((e=>t[e.id])),n=i.map((t=>t.type)),r=s.filter((t=>!(1&t))),o=t[e.id]>>1;function a(t){let i=[];for(let e=0;e<s.length;e++){let r=ec(t,s[e]);if(2==n[e])for(let t of r)i.push(t);else i.push(r)}return e.combine(i)}return{create(t){for(let e of s)tc(t,e);return t.values[o]=a(t),1},update(t,i){if(!Nh(t,r))return 0;let s=a(t);return e.compare(s,t.values[o])?0:(t.values[o]=s,1)},reconfigure(t,n){let r=Nh(t,s),l=n.config.facets[e.id],h=n.facet(e);if(l&&!r&&Dh(i,l))return t.values[o]=h,0;let c=a(t);return e.compare(c,h)?(t.values[o]=h,0):(t.values[o]=c,1)}}}const Bh=Ih.define({static:!0});class $h{constructor(t,e,i,s,n){this.id=t,this.createF=e,this.updateF=i,this.compareF=s,this.spec=n,this.provides=void 0}static define(t){let e=new $h(Fh++,t.create,t.update,t.compare||((t,e)=>t===e),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(Bh).find((t=>t.field==this));return((null==e?void 0:e.create)||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:t=>(t.values[e]=this.create(t),1),update:(t,i)=>{let s=t.values[e],n=this.updateF(s,i);return this.compareF(s,n)?0:(t.values[e]=n,1)},reconfigure:(t,i)=>null!=i.config.address[this.id]?(t.values[e]=i.field(this),0):(t.values[e]=this.create(t),1)}}init(t){return[this,Bh.of({field:this,create:t})]}get extension(){return this}}const Xh=4,jh=3,Gh=2,Zh=1;function qh(t){return e=>new Hh(e,t)}const Wh={highest:qh(0),high:qh(Zh),default:qh(Gh),low:qh(jh),lowest:qh(Xh)};class Hh{constructor(t,e){this.inner=t,this.prec=e}}class Yh{of(t){return new Kh(this,t)}reconfigure(t){return Yh.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}}class Kh{constructor(t,e){this.compartment=t,this.inner=e}}class Jh{constructor(t,e,i,s,n,r){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=s,this.staticValues=n,this.facets=r,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return null==e?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let s=[],n=Object.create(null),r=new Map;for(let i of function(t,e,i){let s=[[],[],[],[],[]],n=new Map;return function t(r,o){let a=n.get(r);if(null!=a){if(a<=o)return;let t=s[a].indexOf(r);t>-1&&s[a].splice(t,1),r instanceof Kh&&i.delete(r.compartment)}if(n.set(r,o),Array.isArray(r))for(let e of r)t(e,o);else if(r instanceof Kh){if(i.has(r.compartment))throw new RangeError("Duplicate use of compartment in extensions");let s=e.get(r.compartment)||r.inner;i.set(r.compartment,s),t(s,o)}else if(r instanceof Hh)t(r.inner,r.prec);else if(r instanceof $h)s[o].push(r),r.provides&&t(r.provides,o);else if(r instanceof Uh)s[o].push(r),r.facet.extensions&&t(r.facet.extensions,Gh);else{let e=r.extension;if(!e)throw new Error(`Unrecognized extension value in extension set (${r}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);t(e,o)}}(t,Gh),s.reduce(((t,e)=>t.concat(e)))}(t,e,r))i instanceof $h?s.push(i):(n[i.facet.id]||(n[i.facet.id]=[])).push(i);let o=Object.create(null),a=[],l=[];for(let t of s)o[t.id]=l.length<<1,l.push((e=>t.slot(e)));let h=null==i?void 0:i.config.facets;for(let t in n){let e=n[t],s=e[0].facet,r=h&&h[t]||[];if(e.every((t=>0==t.type)))if(o[s.id]=a.length<<1|1,Dh(r,e))a.push(i.facet(s));else{let t=s.combine(e.map((t=>t.value)));a.push(i&&s.compare(t,i.facet(s))?i.facet(s):t)}else{for(let t of e)0==t.type?(o[t.id]=a.length<<1|1,a.push(t.value)):(o[t.id]=l.length<<1,l.push((e=>t.dynamicSlot(e))));o[s.id]=l.length<<1,l.push((t=>Vh(t,s,e)))}}let c=l.map((t=>t(o)));return new Jh(t,r,c,o,a,n)}}function tc(t,e){if(1&e)return 2;let i=e>>1,s=t.status[i];if(4==s)throw new Error("Cyclic dependency between fields and/or facets");if(2&s)return s;t.status[i]=4;let n=t.computeSlot(t,t.config.dynamicSlots[i]);return t.status[i]=2|n}function ec(t,e){return 1&e?t.config.staticValues[e>>1]:t.values[e>>1]}const ic=Ih.define(),sc=Ih.define({combine:t=>t.some((t=>t)),static:!0}),nc=Ih.define({combine:t=>t.length?t[0]:void 0,static:!0}),rc=Ih.define(),oc=Ih.define(),ac=Ih.define(),lc=Ih.define({combine:t=>!!t.length&&t[0]});class hc{constructor(t,e){this.type=t,this.value=e}static define(){return new cc}}class cc{of(t){return new hc(this,t)}}class uc{constructor(t){this.map=t}of(t){return new dc(this,t)}}class dc{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return void 0===e?void 0:e==this.value?this:new dc(this.type,e)}is(t){return this.type==t}static define(t={}){return new uc(t.map||(t=>t))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let s of t){let t=s.map(e);t&&i.push(t)}return i}}dc.reconfigure=dc.define(),dc.appendConfig=dc.define();class pc{constructor(t,e,i,s,n,r){this.startState=t,this.changes=e,this.selection=i,this.effects=s,this.annotations=n,this.scrollIntoView=r,this._doc=null,this._state=null,i&&Lh(i,e.newLength),n.some((t=>t.type==pc.time))||(this.annotations=n.concat(pc.time.of(Date.now())))}static create(t,e,i,s,n,r){return new pc(t,e,i,s,n,r)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(pc.userEvent);return!(!e||!(e==t||e.length>t.length&&e.slice(0,t.length)==t&&"."==e[t.length]))}}function fc(t,e){let i=[];for(let s=0,n=0;;){let r,o;if(s<t.length&&(n==e.length||e[n]>=t[s]))r=t[s++],o=t[s++];else{if(!(n<e.length))return i;r=e[n++],o=e[n++]}!i.length||i[i.length-1]<r?i.push(r,o):i[i.length-1]<o&&(i[i.length-1]=o)}}function mc(t,e,i){var s;let n,r,o;return i?(n=e.changes,r=Ah.empty(e.changes.length),o=t.changes.compose(e.changes)):(n=e.changes.map(t.changes),r=t.changes.mapDesc(e.changes,!0),o=t.changes.compose(n)),{changes:o,selection:e.selection?e.selection.map(r):null===(s=t.selection)||void 0===s?void 0:s.map(n),effects:dc.mapEffects(t.effects,n).concat(dc.mapEffects(e.effects,r)),annotations:t.annotations.length?t.annotations.concat(e.annotations):e.annotations,scrollIntoView:t.scrollIntoView||e.scrollIntoView}}function gc(t,e,i){let s=e.selection,n=bc(e.annotations);return e.userEvent&&(n=n.concat(pc.userEvent.of(e.userEvent))),{changes:e.changes instanceof Ah?e.changes:Ah.of(e.changes||[],i,t.facet(nc)),selection:s&&(s instanceof Qh?s:Qh.single(s.anchor,s.head)),effects:bc(e.effects),annotations:n,scrollIntoView:!!e.scrollIntoView}}function vc(t,e,i){let s=gc(t,e.length?e[0]:{},t.doc.length);e.length&&!1===e[0].filter&&(i=!1);for(let n=1;n<e.length;n++){!1===e[n].filter&&(i=!1);let r=!!e[n].sequential;s=mc(s,gc(t,e[n],r?s.changes.newLength:t.doc.length),r)}let n=pc.create(t,s.changes,s.selection,s.effects,s.annotations,s.scrollIntoView);return function(t){let e=t.startState,i=e.facet(ac),s=t;for(let n=i.length-1;n>=0;n--){let r=i[n](t);r&&Object.keys(r).length&&(s=mc(s,gc(e,r,t.changes.newLength),!0))}return s==t?t:pc.create(e,t.changes,t.selection,s.effects,s.annotations,s.scrollIntoView)}(i?function(t){let e=t.startState,i=!0;for(let s of e.facet(rc)){let e=s(t);if(!1===e){i=!1;break}Array.isArray(e)&&(i=!0===i?e:fc(i,e))}if(!0!==i){let s,n;if(!1===i)n=t.changes.invertedDesc,s=Ah.empty(e.doc.length);else{let e=t.changes.filter(i);s=e.changes,n=e.filtered.mapDesc(e.changes).invertedDesc}t=pc.create(e,s,t.selection&&t.selection.map(n),dc.mapEffects(t.effects,n),t.annotations,t.scrollIntoView)}let s=e.facet(oc);for(let i=s.length-1;i>=0;i--){let n=s[i](t);t=n instanceof pc?n:Array.isArray(n)&&1==n.length&&n[0]instanceof pc?n[0]:vc(e,bc(n),!1)}return t}(n):n)}pc.time=hc.define(),pc.userEvent=hc.define(),pc.addToHistory=hc.define(),pc.remote=hc.define();const yc=[];function bc(t){return null==t?yc:Array.isArray(t)?t:[t]}var xc=function(t){return t[t.Word=0]="Word",t[t.Space=1]="Space",t[t.Other=2]="Other",t}(xc||(xc={}));const Oc=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let wc;try{wc=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(V){}function Sc(t){return e=>{if(!/\S/.test(e))return xc.Space;if(function(t){if(wc)return wc.test(t);for(let e=0;e<t.length;e++){let i=t[e];if(/\w/.test(i)||i>""&&(i.toUpperCase()!=i.toLowerCase()||Oc.test(i)))return!0}return!1}(e))return xc.Word;for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>-1)return xc.Word;return xc.Other}}class kc{constructor(t,e,i,s,n,r){this.config=t,this.doc=e,this.selection=i,this.values=s,this.status=t.statusTemplate.slice(),this.computeSlot=n,r&&(r._state=this);for(let t=0;t<this.config.dynamicSlots.length;t++)tc(this,t<<1);this.computeSlot=null}field(t,e=!0){let i=this.config.address[t.id];if(null!=i)return tc(this,i),ec(this,i);if(e)throw new RangeError("Field is not present in this state")}update(...t){return vc(this,t,!0)}applyTransaction(t){let e,i=this.config,{base:s,compartments:n}=i;for(let e of t.effects)e.is(Yh.reconfigure)?(i&&(n=new Map,i.compartments.forEach(((t,e)=>n.set(e,t))),i=null),n.set(e.value.compartment,e.value.extension)):e.is(dc.reconfigure)?(i=null,s=e.value):e.is(dc.appendConfig)&&(i=null,s=bc(s).concat(e.value));i?e=t.startState.values.slice():(i=Jh.resolve(s,n,this),e=new kc(i,this.doc,this.selection,i.dynamicSlots.map((()=>null)),((t,e)=>e.reconfigure(t,this)),null).values),new kc(i,t.newDoc,t.newSelection,e,((e,i)=>i.update(e,t)),t)}replaceSelection(t){return"string"==typeof t&&(t=this.toText(t)),this.changeByRange((e=>({changes:{from:e.from,to:e.to,insert:t},range:Qh.cursor(e.from+t.length)})))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),s=this.changes(i.changes),n=[i.range],r=bc(i.effects);for(let i=1;i<e.ranges.length;i++){let o=t(e.ranges[i]),a=this.changes(o.changes),l=a.map(s);for(let t=0;t<i;t++)n[t]=n[t].map(l);let h=s.mapDesc(a,!0);n.push(o.range.map(h)),s=s.compose(l),r=dc.mapEffects(r,l).concat(dc.mapEffects(bc(o.effects),h))}return{changes:s,selection:Qh.create(n,e.mainIndex),effects:r}}changes(t=[]){return t instanceof Ah?t:Ah.of(t,this.doc.length,this.facet(kc.lineSeparator))}toText(t){return eh.of(t.split(this.facet(kc.lineSeparator)||wh))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return null==e?t.default:(tc(this,e),ec(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let s=t[i];s instanceof $h&&null!=this.config.address[s.id]&&(e[i]=s.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||"string"!=typeof t.doc)throw new RangeError("Invalid JSON representation for EditorState");let s=[];if(i)for(let e in i)if(Object.prototype.hasOwnProperty.call(t,e)){let n=i[e],r=t[e];s.push(n.init((t=>n.spec.fromJSON(r,t))))}return kc.create({doc:t.doc,selection:Qh.fromJSON(t.selection),extensions:e.extensions?s.concat([e.extensions]):s})}static create(t={}){let e=Jh.resolve(t.extensions||[],new Map),i=t.doc instanceof eh?t.doc:eh.of((t.doc||"").split(e.staticFacet(kc.lineSeparator)||wh)),s=t.selection?t.selection instanceof Qh?t.selection:Qh.single(t.selection.anchor,t.selection.head):Qh.single(0);return Lh(s,i.length),e.staticFacet(sc)||(s=s.asSingle()),new kc(e,i,s,e.dynamicSlots.map((()=>null)),((t,e)=>e.create(t)),null)}get tabSize(){return this.facet(kc.tabSize)}get lineBreak(){return this.facet(kc.lineSeparator)||"\n"}get readOnly(){return this.facet(lc)}phrase(t,...e){for(let e of this.facet(kc.phrases))if(Object.prototype.hasOwnProperty.call(e,t)){t=e[t];break}return e.length&&(t=t.replace(/\$(\$|\d*)/g,((t,i)=>{if("$"==i)return"$";let s=+(i||1);return!s||s>e.length?t:e[s-1]}))),t}languageDataAt(t,e,i=-1){let s=[];for(let n of this.facet(ic))for(let r of n(this,e,i))Object.prototype.hasOwnProperty.call(r,t)&&s.push(r[t]);return s}charCategorizer(t){return Sc(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:e,from:i,length:s}=this.doc.lineAt(t),n=this.charCategorizer(t),r=t-i,o=t-i;for(;r>0;){let t=fh(e,r,!1);if(n(e.slice(t,r))!=xc.Word)break;r=t}for(;o<s;){let t=fh(e,o);if(n(e.slice(o,t))!=xc.Word)break;o=t}return r==o?null:Qh.range(r+i,o+i)}}function Ac(t,e,i={}){let s={};for(let e of t)for(let t of Object.keys(e)){let n=e[t],r=s[t];if(void 0===r)s[t]=n;else if(r===n||void 0===n);else{if(!Object.hasOwnProperty.call(i,t))throw new Error("Config merge conflict for field "+t);s[t]=i[t](r,n)}}for(let t in e)void 0===s[t]&&(s[t]=e[t]);return s}kc.allowMultipleSelections=sc,kc.tabSize=Ih.define({combine:t=>t.length?t[0]:4}),kc.lineSeparator=nc,kc.readOnly=lc,kc.phrases=Ih.define({compare(t,e){let i=Object.keys(t),s=Object.keys(e);return i.length==s.length&&i.every((i=>t[i]==e[i]))}}),kc.languageData=ic,kc.changeFilter=rc,kc.transactionFilter=oc,kc.transactionExtender=ac,Yh.reconfigure=dc.define();class Tc{eq(t){return this==t}range(t,e=t){return Mc.create(t,e,this)}}Tc.prototype.startSide=Tc.prototype.endSide=0,Tc.prototype.point=!1,Tc.prototype.mapMode=Sh.TrackDel;class Mc{constructor(t,e,i){this.from=t,this.to=e,this.value=i}static create(t,e,i){return new Mc(t,e,i)}}function Pc(t,e){return t.from-e.from||t.value.startSide-e.value.startSide}class Cc{constructor(t,e,i,s){this.from=t,this.to=e,this.value=i,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,s=0){let n=i?this.to:this.from;for(let r=s,o=n.length;;){if(r==o)return r;let s=r+o>>1,a=n[s]-t||(i?this.value[s].endSide:this.value[s].startSide)-e;if(s==r)return a>=0?r:o;a>=0?o=s:r=s+1}}between(t,e,i,s){for(let n=this.findIndex(e,-1e9,!0),r=this.findIndex(i,1e9,!1,n);n<r;n++)if(!1===s(this.from[n]+t,this.to[n]+t,this.value[n]))return!1}map(t,e){let i=[],s=[],n=[],r=-1,o=-1;for(let a=0;a<this.value.length;a++){let l,h,c=this.value[a],u=this.from[a]+t,d=this.to[a]+t;if(u==d){let t=e.mapPos(u,c.startSide,c.mapMode);if(null==t)continue;if(l=h=t,c.startSide!=c.endSide&&(h=e.mapPos(u,c.endSide))<l)continue}else if((l=e.mapPos(u,c.startSide))>(h=e.mapPos(d,c.endSide))||l==h&&c.startSide>0&&c.endSide<=0)continue;(h-l||c.endSide-c.startSide)<0||(r<0&&(r=l),c.point&&(o=Math.max(o,h-l)),i.push(c),s.push(l-r),n.push(h-r))}return{mapped:i.length?new Cc(s,n,i,o):null,pos:r}}}class _c{constructor(t,e,i,s){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=s}static create(t,e,i,s){return new _c(t,e,i,s)}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:s=0,filterTo:n=this.length}=t,r=t.filter;if(0==e.length&&!r)return this;if(i&&(e=e.slice().sort(Pc)),this.isEmpty)return e.length?_c.of(e):this;let o=new Qc(this,null,-1).goto(0),a=0,l=[],h=new Rc;for(;o.value||a<e.length;)if(a<e.length&&(o.from-e[a].from||o.startSide-e[a].value.startSide)>=0){let t=e[a++];h.addInner(t.from,t.to,t.value)||l.push(t)}else 1==o.rangeIndex&&o.chunkIndex<this.chunk.length&&(a==e.length||this.chunkEnd(o.chunkIndex)<e[a].from)&&(!r||s>this.chunkEnd(o.chunkIndex)||n<this.chunkPos[o.chunkIndex])&&h.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!r||s>o.to||n<o.from||r(o.from,o.to,o.value))&&(h.addInner(o.from,o.to,o.value)||l.push(Mc.create(o.from,o.to,o.value))),o.next());return h.finishInner(this.nextLayer.isEmpty&&!l.length?_c.empty:this.nextLayer.update({add:l,filter:r,filterFrom:s,filterTo:n}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],i=[],s=-1;for(let n=0;n<this.chunk.length;n++){let r=this.chunkPos[n],o=this.chunk[n],a=t.touchesRange(r,r+o.length);if(!1===a)s=Math.max(s,o.maxPoint),e.push(o),i.push(t.mapPos(r));else if(!0===a){let{mapped:n,pos:a}=o.map(r,t);n&&(s=Math.max(s,n.maxPoint),e.push(n),i.push(a))}}let n=this.nextLayer.map(t);return 0==e.length?n:new _c(i,e,n||_c.empty,s)}between(t,e,i){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let n=this.chunkPos[s],r=this.chunk[s];if(e>=n&&t<=n+r.length&&!1===r.between(n,t-n,e-n,i))return}this.nextLayer.between(t,e,i)}}iter(t=0){return Lc.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return Lc.from(t).goto(e)}static compare(t,e,i,s,n=-1){let r=t.filter((t=>t.maxPoint>0||!t.isEmpty&&t.maxPoint>=n)),o=e.filter((t=>t.maxPoint>0||!t.isEmpty&&t.maxPoint>=n)),a=Ec(r,o,i),l=new Ic(r,a,n),h=new Ic(o,a,n);i.iterGaps(((t,e,i)=>Dc(l,t,h,e,i,s))),i.empty&&0==i.length&&Dc(l,0,h,0,0,s)}static eq(t,e,i=0,s){null==s&&(s=999999999);let n=t.filter((t=>!t.isEmpty&&e.indexOf(t)<0)),r=e.filter((e=>!e.isEmpty&&t.indexOf(e)<0));if(n.length!=r.length)return!1;if(!n.length)return!0;let o=Ec(n,r),a=new Ic(n,o,0).goto(i),l=new Ic(r,o,0).goto(i);for(;;){if(a.to!=l.to||!Uc(a.active,l.active)||a.point&&(!l.point||!a.point.eq(l.point)))return!1;if(a.to>s)return!0;a.next(),l.next()}}static spans(t,e,i,s,n=-1){let r=new Ic(t,null,n).goto(e),o=e,a=r.openStart;for(;;){let t=Math.min(r.to,i);if(r.point){let i=r.activeForPoint(r.to),n=r.pointFrom<e?i.length+1:Math.min(i.length,a);s.point(o,t,r.point,i,n,r.pointRank),a=Math.min(r.openEnd(t),i.length)}else t>o&&(s.span(o,t,r.active,a),a=r.openEnd(t));if(r.to>i)return a+(r.point&&r.to>i?1:0);o=r.to,r.next()}}static of(t,e=!1){let i=new Rc;for(let s of t instanceof Mc?[t]:e?function(t){if(t.length>1)for(let e=t[0],i=1;i<t.length;i++){let s=t[i];if(Pc(e,s)>0)return t.slice().sort(Pc);e=s}return t}(t):t)i.add(s.from,s.to,s.value);return i.finish()}}_c.empty=new _c([],[],null,-1),_c.empty.nextLayer=_c.empty;class Rc{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(t){this.chunks.push(new Cc(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new Rc)).add(t,e,i)}addInner(t,e,i){let s=t-this.lastTo||i.startSide-this.last.endSide;if(s<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return!(s<0||(250==this.from.length&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),0))}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(_c.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),0==this.chunks.length)return t;let e=_c.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}}function Ec(t,e,i){let s=new Map;for(let e of t)for(let t=0;t<e.chunk.length;t++)e.chunk[t].maxPoint<=0&&s.set(e.chunk[t],e.chunkPos[t]);let n=new Set;for(let t of e)for(let e=0;e<t.chunk.length;e++){let r=s.get(t.chunk[e]);null==r||(i?i.mapPos(r):r)!=t.chunkPos[e]||(null==i?void 0:i.touchesRange(r,r+t.chunk[e].length))||n.add(t.chunk[e])}return n}class Qc{constructor(t,e,i,s=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let e=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(e)||this.layer.chunkEnd(this.chunkIndex)<t||e.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}}class Lc{constructor(t){this.heap=t}static from(t,e=null,i=-1){let s=[];for(let n=0;n<t.length;n++)for(let r=t[n];!r.isEmpty;r=r.nextLayer)r.maxPoint>=i&&s.push(new Qc(r,e,i,n));return 1==s.length?s[0]:new Lc(s)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let t=this.heap.length>>1;t>=0;t--)Fc(this.heap,t);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let t=this.heap.length>>1;t>=0;t--)Fc(this.heap,t);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(0==this.heap.length)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),Fc(this.heap,0)}}}function Fc(t,e){for(let i=t[e];;){let s=1+(e<<1);if(s>=t.length)break;let n=t[s];if(s+1<t.length&&n.compare(t[s+1])>=0&&(n=t[s+1],s++),i.compare(n)<0)break;t[s]=i,t[e]=n,e=s}}class Ic{constructor(t,e,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Lc.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){zc(this.active,t),zc(this.activeTo,t),zc(this.activeRank,t),this.minActive=Vc(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:s,rank:n}=this.cursor;for(;e<this.activeRank.length&&this.activeRank[e]<=n;)e++;Nc(this.active,e,i),Nc(this.activeTo,e,s),Nc(this.activeRank,e,n),t&&Nc(t,e,this.cursor.from),this.minActive=Vc(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>t){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),i&&zc(i,s)}else{if(!this.cursor.value){this.to=this.endSide=1e9;break}if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}{let t=this.cursor.value;if(t.point){if(!(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)){this.point=t,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=t.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}this.cursor.next()}else this.addActive(i),this.cursor.next()}}}if(i){this.openStart=0;for(let e=i.length-1;e>=0&&i[e]<t;e--)this.openStart++}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}}function Dc(t,e,i,s,n,r){t.goto(e),i.goto(s);let o=s+n,a=s,l=s-e;for(;;){let e=t.to+l-i.to||t.endSide-i.endSide,s=e<0?t.to+l:i.to,n=Math.min(s,o);if(t.point||i.point?t.point&&i.point&&(t.point==i.point||t.point.eq(i.point))&&Uc(t.activeForPoint(t.to+l),i.activeForPoint(i.to))||r.comparePoint(a,n,t.point,i.point):n>a&&!Uc(t.active,i.active)&&r.compareRange(a,n,t.active,i.active),s>o)break;a=s,e<=0&&t.next(),e>=0&&i.next()}}function Uc(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!=e[i]&&!t[i].eq(e[i]))return!1;return!0}function zc(t,e){for(let i=e,s=t.length-1;i<s;i++)t[i]=t[i+1];t.pop()}function Nc(t,e,i){for(let i=t.length-1;i>=e;i--)t[i+1]=t[i];t[e]=i}function Vc(t,e){let i=-1,s=1e9;for(let n=0;n<e.length;n++)(e[n]-s||t[n].endSide-t[i].endSide)<0&&(i=n,s=e[n]);return i}function Bc(t,e,i=t.length){let s=0;for(let n=0;n<i;)9==t.charCodeAt(n)?(s+=e-s%e,n++):(s++,n=fh(t,n));return s}const $c="undefined"==typeof Symbol?"__":Symbol.for(""),Xc="undefined"==typeof Symbol?"__styleSet"+Math.floor(1e8*Math.random()):Symbol("styleSet"),jc="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:{};class Gc{constructor(t,e){this.rules=[];let{finish:i}=e||{};function s(t){return/^@/.test(t)?[t]:t.split(/,\s*/)}function n(t,e,r,o){let a=[],l=/^@(\w+)\b/.exec(t[0]),h=l&&"keyframes"==l[1];if(l&&null==e)return r.push(t[0]+";");for(let i in e){let o=e[i];if(/&/.test(i))n(i.split(/,\s*/).map((e=>t.map((t=>e.replace(/&/,t))))).reduce(((t,e)=>t.concat(e))),o,r);else if(o&&"object"==typeof o){if(!l)throw new RangeError("The value of a property ("+i+") should be a primitive value.");n(s(i),o,a,h)}else null!=o&&a.push(i.replace(/_.*/,"").replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()))+": "+o+";")}(a.length||h)&&r.push((!i||l||o?t:t.map(i)).join(", ")+" {"+a.join(" ")+"}")}for(let e in t)n(s(e),t[e],this.rules)}getRules(){return this.rules.join("\n")}static newName(){let t=jc[$c]||1;return jc[$c]=t+1,""+t.toString(36)}static mount(t,e){(t[Xc]||new qc(t)).mount(Array.isArray(e)?e:[e])}}let Zc=null;class qc{constructor(t){if(!t.head&&t.adoptedStyleSheets&&"undefined"!=typeof CSSStyleSheet){if(Zc)return t.adoptedStyleSheets=[Zc.sheet].concat(t.adoptedStyleSheets),t[Xc]=Zc;this.sheet=new CSSStyleSheet,t.adoptedStyleSheets=[this.sheet].concat(t.adoptedStyleSheets),Zc=this}else{this.styleTag=(t.ownerDocument||t).createElement("style");let e=t.head||t;e.insertBefore(this.styleTag,e.firstChild)}this.modules=[],t[Xc]=this}mount(t){let e=this.sheet,i=0,s=0;for(let n=0;n<t.length;n++){let r=t[n],o=this.modules.indexOf(r);if(o<s&&o>-1&&(this.modules.splice(o,1),s--,o=-1),-1==o){if(this.modules.splice(s++,0,r),e)for(let t=0;t<r.rules.length;t++)e.insertRule(r.rules[t],i++)}else{for(;s<o;)i+=this.modules[s++].rules.length;i+=r.rules.length,s++}}if(!e){let t="";for(let e=0;e<this.modules.length;e++)t+=this.modules[e].getRules()+"\n";this.styleTag.textContent=t}}}for(var Wc={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Hc={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Yc="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),Kc=("undefined"!=typeof navigator&&/Gecko\/\d+/.test(navigator.userAgent),"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)),Jc="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),tu=Kc||Yc&&+Yc[1]<57,eu=0;eu<10;eu++)Wc[48+eu]=Wc[96+eu]=String(eu);for(eu=1;eu<=24;eu++)Wc[eu+111]="F"+eu;for(eu=65;eu<=90;eu++)Wc[eu]=String.fromCharCode(eu+32),Hc[eu]=String.fromCharCode(eu);for(var iu in Wc)Hc.hasOwnProperty(iu)||(Hc[iu]=Wc[iu]);function su(t){return(11==t.nodeType?t.getSelection?t:t.ownerDocument:t).getSelection()}function nu(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function ru(t,e){if(!e.anchorNode)return!1;try{return nu(t,e.anchorNode)}catch(t){return!1}}function ou(t){return 3==t.nodeType?yu(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function au(t,e,i,s){return!!i&&(hu(t,e,i,s,-1)||hu(t,e,i,s,1))}function lu(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function hu(t,e,i,s,n){for(;;){if(t==i&&e==s)return!0;if(e==(n<0?0:cu(t))){if("DIV"==t.nodeName)return!1;let i=t.parentNode;if(!i||1!=i.nodeType)return!1;e=lu(t)+(n<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(n<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=n<0?cu(t):0}}}function cu(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}const uu={left:0,right:0,top:0,bottom:0};function du(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function pu(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}class fu{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let mu,gu=null;function vu(t){if(t.setActive)return t.setActive();if(gu)return t.focus(gu);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(null==gu?{get preventScroll(){return gu={preventScroll:!0},!0}}:void 0),!gu){gu=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],n=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}function yu(t,e,i=e){let s=mu||(mu=document.createRange());return s.setEnd(t,i),s.setStart(t,e),s}function bu(t,e,i){let s={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",s);n.synthetic=!0,t.dispatchEvent(n);let r=new KeyboardEvent("keyup",s);return r.synthetic=!0,t.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function xu(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}class Ou{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new Ou(t.parentNode,lu(t),e)}static after(t,e){return new Ou(t.parentNode,lu(t)+1,e)}}const wu=[];class Su{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(2&this.dirty){let e,i=this.dom,s=null;for(let n of this.children){if(n.dirty){if(!n.dom&&(e=s?s.nextSibling:i.firstChild)){let t=Su.get(e);(!t||!t.parent&&t.canReuseDOM(n))&&n.reuseDOM(e)}n.sync(t),n.dirty=0}if(e=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&e!=n.dom&&(t.written=!0),n.dom.parentNode==i)for(;e&&e!=n.dom;)e=ku(e);else i.insertBefore(n.dom,e);s=n.dom}for((e=s?s.nextSibling:i.firstChild)&&t&&t.node==i&&(t.written=!0);e;)e=ku(e)}else if(1&this.dirty)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=0==cu(t)?0:0==e?-1:1;for(;;){let e=t.parentNode;if(e==this.dom)break;0==s&&e.firstChild!=e.lastChild&&(s=t==e.firstChild?-1:1),t=e}i=s<0?t:t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Su.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){let s=this.children[t];if(s.dom==i)return e;e+=s.length+s.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,n=-1,r=-1,o=-1;for(let a=0,l=i,h=i;a<this.children.length;a++){let i=this.children[a],c=l+i.length;if(l<t&&c>e)return i.domBoundsAround(t,e,l);if(c>=t&&-1==s&&(s=a,n=l),l>e&&i.dom.parentNode==this.dom){r=a,o=h;break}h=c,l=c+i.breakAfter}return{from:n,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),1&e.dirty)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=wu){this.markDirty();for(let i=t;i<e;i++){let t=this.children[i];t.parent==this&&t.destroy()}this.children.splice(t,e-t,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new Au(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,s,n,r){return!1}become(t){return!1}canReuseDOM(t){return t.constructor==this.constructor}getSide(){return 0}destroy(){this.parent=null}}function ku(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}Su.prototype.breakAfter=0;class Au{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function Tu(t,e,i,s,n,r,o,a,l){let{children:h}=t,c=h.length?h[e]:null,u=r.length?r[r.length-1]:null,d=u?u.breakAfter:o;if(!(e==s&&c&&!o&&!d&&r.length<2&&c.merge(i,n,r.length?u:null,0==i,a,l))){if(s<h.length){let t=h[s];t&&n<t.length?(e==s&&(t=t.split(n),n=0),!d&&u&&t.merge(0,n,u,!0,0,l)?r[r.length-1]=t:(n&&t.merge(0,n,null,!1,0,l),r.push(t))):(null==t?void 0:t.breakAfter)&&(u?u.breakAfter=1:o=1),s++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,a,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,a,0),e++));e<s&&r.length;)if(h[s-1].become(r[r.length-1]))s--,r.pop(),l=r.length?0:a;else{if(!h[e].become(r[0]))break;e++,r.shift(),a=r.length?0:l}!r.length&&e&&s<h.length&&!h[e-1].breakAfter&&h[s].merge(0,0,h[e-1],!1,a,l)&&e--,(e<s||r.length)&&t.replaceChildren(e,s,r)}}function Mu(t,e,i,s,n,r){let o=t.childCursor(),{i:a,off:l}=o.findPos(i,1),{i:h,off:c}=o.findPos(e,-1),u=e-i;for(let t of s)u+=t.length;t.length+=u,Tu(t,h,c,a,l,s,0,n,r)}let Pu="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},Cu="undefined"!=typeof document?document:{documentElement:{style:{}}};const _u=/Edge\/(\d+)/.exec(Pu.userAgent),Ru=/MSIE \d/.test(Pu.userAgent),Eu=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Pu.userAgent),Qu=!!(Ru||Eu||_u),Lu=!Qu&&/gecko\/(\d+)/i.test(Pu.userAgent),Fu=!Qu&&/Chrome\/(\d+)/.exec(Pu.userAgent),Iu="webkitFontSmoothing"in Cu.documentElement.style,Du=!Qu&&/Apple Computer/.test(Pu.vendor),Uu=Du&&(/Mobile\/\w+/.test(Pu.userAgent)||Pu.maxTouchPoints>2);var zu={mac:Uu||/Mac/.test(Pu.platform),windows:/Win/.test(Pu.platform),linux:/Linux|X11/.test(Pu.platform),ie:Qu,ie_version:Ru?Cu.documentMode||6:Eu?+Eu[1]:_u?+_u[1]:0,gecko:Lu,gecko_version:Lu?+(/Firefox\/(\d+)/.exec(Pu.userAgent)||[0,0])[1]:0,chrome:!!Fu,chrome_version:Fu?+Fu[1]:0,ios:Uu,android:/Android\b/.test(Pu.userAgent),webkit:Iu,safari:Du,webkit_version:Iu?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=Cu.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class Nu extends Su{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,i){return(!i||i instanceof Nu&&!(this.length-(e-t)+i.length>256))&&(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new Nu(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new Ou(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return Bu(this.dom,t,e)}}class Vu extends Su{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let t of e)t.setParent(this)}setAttrs(t){if(xu(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof Vu&&i.mark.eq(this.mark))||t&&n<=0||e<this.length&&r<=0)||(Mu(this,t,e,i?i.children:[],n-1,r-1),this.markDirty(),0))}split(t){let e=[],i=0,s=-1,n=0;for(let r of this.children){let o=i+r.length;o>t&&e.push(i<t?r.split(t-i):r),s<0&&i>=t&&(s=n),i=o,n++}let r=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new Vu(this.mark,e,r)}domAtPos(t){return qu(this,t)}coordsAt(t,e){return Hu(this,t,e)}}function Bu(t,e,i){let s=t.nodeValue.length;e>s&&(e=s);let n=e,r=e,o=0;0==e&&i<0||e==s&&i>=0?zu.chrome||zu.gecko||(e?(n--,o=1):r<s&&(r++,o=-1)):i<0?n--:r<s&&r++;let a=yu(t,n,r).getClientRects();if(!a.length)return uu;let l=a[(o?o<0:i>=0)?0:a.length-1];return zu.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(a,(t=>t.width))||l),o?du(l,o<0):l||null}class $u extends Su{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||$u)(t,e,i)}split(t){let e=$u.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof $u&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0)||(this.length=t+(i?i.length:0)+(this.length-e),0))}become(t){return t.length==this.length&&t instanceof $u&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return eh.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):eh.empty}domAtPos(t){return 0==t?Ou.before(this.dom):Ou.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),s=null;if(!i.length)return uu;for(let e=t>0?i.length-1:0;s=i[e],!(t>0?0==e:e==i.length-1||s.top<s.bottom);e+=t>0?-1:1);return this.length?s:du(s,this.side>0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Xu extends $u{domAtPos(t){let{topView:e,text:i}=this.widget;return e?ju(t,0,e,i,((t,e)=>t.domAtPos(e)),(t=>new Ou(i,Math.min(t,i.nodeValue.length)))):new Ou(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:s}=this.widget;return i?Gu(t,e,i,s):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:s}=this.widget;return i?ju(t,e,i,s,((t,e,i)=>t.coordsAt(e,i)),((t,e)=>Bu(s,t,e))):Bu(s,t,e)}destroy(){var t;super.destroy(),null===(t=this.widget.topView)||void 0===t||t.destroy()}get isEditable(){return!0}canReuseDOM(){return!0}}function ju(t,e,i,s,n,r){if(i instanceof Vu){for(let o=i.dom.firstChild;o;o=o.nextSibling){let i=Su.get(o);if(!i)return r(t,e);let a=nu(o,s),l=i.length+(a?s.nodeValue.length:0);if(t<l||t==l&&i.getSide()<=0)return a?ju(t,e,i,s,n,r):n(i,t,e);t-=l}return n(i,i.length,-1)}return i.dom==s?r(t,e):n(i,t,e)}function Gu(t,e,i,s){if(i instanceof Vu)for(let n of i.children){let i=0,r=nu(n.dom,s);if(nu(n.dom,t))return i+(r?Gu(t,e,n,s):n.localPosFromDOM(t,e));i+=r?s.nodeValue.length:n.length}else if(i.dom==s)return Math.min(e,s.nodeValue.length);return i.localPosFromDOM(t,e)}class Zu extends Su{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof Zu&&t.side==this.side}split(){return new Zu(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return Ou.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=function(t,e){let i=t.parent,s=i?i.children.indexOf(t):-1;for(;i&&s>=0;)if(e<0?s>0:s<i.children.length){let t=i.children[s+e];if(t instanceof Nu){let i=t.coordsAt(e<0?t.length:0,e);if(i)return i}s+=e}else{if(!(i instanceof Vu&&i.parent)){let t=i.dom.lastChild;if(t&&"BR"==t.nodeName)return t.getClientRects()[0];break}s=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent}}(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return eh.empty}}function qu(t,e){let i=t.dom,{children:s}=t,n=0;for(let t=0;n<s.length;n++){let r=s[n],o=t+r.length;if(!(o==t&&r.getSide()<=0)){if(e>t&&e<o&&r.dom.parentNode==i)return r.domAtPos(e-t);if(e<=t)break;t=o}}for(let t=n;t>0;t--){let e=s[t-1];if(e.dom.parentNode==i)return e.domAtPos(e.length)}for(let t=n;t<s.length;t++){let e=s[t];if(e.dom.parentNode==i)return e.domAtPos(0)}return new Ou(i,0)}function Wu(t,e,i){let s,{children:n}=t;i>0&&e instanceof Vu&&n.length&&(s=n[n.length-1])instanceof Vu&&s.mark.eq(e.mark)?Wu(s,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function Hu(t,e,i){let s=null,n=-1,r=null,o=-1;!function t(e,i){for(let a=0,l=0;a<e.children.length&&l<=i;a++){let h=e.children[a],c=l+h.length;c>=i&&(h.children.length?t(h,i-l):!r&&(c>i||l==c&&h.getSide()>0)?(r=h,o=i-l):(l<i||l==c&&h.getSide()<0)&&(s=h,n=i-l)),l=c}}(t,e);let a=(i<0?s:r)||s||r;return a?a.coordsAt(Math.max(0,a==s?n:o),i):function(t){let e=t.dom.lastChild;if(!e)return t.dom.getBoundingClientRect();let i=ou(e);return i[i.length-1]||null}(t)}function Yu(t,e){for(let i in t)"class"==i&&e.class?e.class+=" "+t.class:"style"==i&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function Ku(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),s=Object.keys(e);if(i.length!=s.length)return!1;for(let n of i)if(-1==s.indexOf(n)||t[n]!==e[n])return!1;return!0}function Ju(t,e,i){let s=null;if(e)for(let n in e)i&&n in i||t.removeAttribute(s=n);if(i)for(let n in i)e&&e[n]==i[n]||t.setAttribute(s=n,i[n]);return!!s}Nu.prototype.children=$u.prototype.children=Zu.prototype.children=wu;class td{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var ed=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(ed||(ed={}));class id extends Tc{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new sd(t)}static widget(t){let e=t.side||0,i=!!t.block;return new rd(t,e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,e,i,t.widget||null,!1)}static replace(t){let e,i,s=!!t.block;if(t.isBlockGap)e=-5e8,i=4e8;else{let{start:n,end:r}=od(t,s);e=(n?s?-3e8:-1:5e8)-1,i=1+(r?s?2e8:1:-6e8)}return new rd(t,e,i,s,t.widget||null,!0)}static line(t){return new nd(t)}static set(t,e=!1){return _c.of(t,e)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}id.none=_c.empty;class sd extends id{constructor(t){let{start:e,end:i}=od(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof sd&&this.tagName==t.tagName&&this.class==t.class&&Ku(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}sd.prototype.point=!1;class nd extends id{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof nd&&Ku(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}nd.prototype.mapMode=Sh.TrackBefore,nd.prototype.point=!0;class rd extends id{constructor(t,e,i,s,n,r){super(e,i,n,t),this.block=s,this.isReplace=r,this.mapMode=s?e<=0?Sh.TrackBefore:Sh.TrackAfter:Sh.TrackDel}get type(){return this.startSide<this.endSide?ed.WidgetRange:this.startSide<=0?ed.WidgetBefore:ed.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof rd&&function(t,e){return t==e||!!(t&&e&&t.compare(e))}(this.widget,t.widget)&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}function od(t,e=!1){let{inclusiveStart:i,inclusiveEnd:s}=t;return null==i&&(i=t.inclusive),null==s&&(s=t.inclusive),{start:null!=i?i:e,end:null!=s?s:e}}function ad(t,e,i,s=0){let n=i.length-1;n>=0&&i[n]+s>=t?i[n]=Math.max(i[n],e):i.push(t,e)}rd.prototype.point=!0;class ld extends Su{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,n,r){if(i){if(!(i instanceof ld))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),Mu(this,t,e,i?i.children:[],n,r),!0}split(t){let e=new ld;if(e.breakAfter=this.breakAfter,0==this.length)return e;let{i:i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let t=i;t<this.children.length;t++)e.append(this.children[t],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(this.markDirty(),t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){Ku(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){Wu(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=Yu(e,this.attrs||{})),i&&(this.attrs=Yu({class:i},this.attrs||{}))}domAtPos(t){return qu(this,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?4&this.dirty&&(xu(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(Ju(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&Su.get(i)instanceof Vu;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(e=Su.get(i))||void 0===e?void 0:e.isEditable)||zu.ios&&this.children.some((t=>t instanceof Nu))))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof Nu)||/[^ -~]/.test(e.text))return null;let i=ou(e.dom);if(1!=i.length)return null;t+=i[0].width}return t?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}:null}coordsAt(t,e){return Hu(this,t,e)}become(t){return!1}get type(){return ed.Text}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let n=t.children[i],r=s+n.length;if(r>=e){if(n instanceof ld)return n;if(r>e)break}s=r+n.breakAfter}return null}}class hd extends Su{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,n,r){return!(i&&(!(i instanceof hd&&this.widget.compare(i.widget))||t>0&&n<=0||e<this.length&&r<=0)||(this.length=t+(i?i.length:0)+(this.length-e),0))}domAtPos(t){return 0==t?Ou.before(this.dom):Ou.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new hd(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return wu}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):eh.empty}domBoundsAround(){return null}become(t){return t instanceof hd&&t.type==this.type&&t.widget.constructor==this.widget.constructor&&(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class cd{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsFor=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof hd&&t.type==ed.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new ld),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(ud(new Zu(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:e,lineBreak:i,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}this.text=e,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(e.length-i)),this.getLine().append(ud(new Nu(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,n,r){if(this.disallowBlockEffectsFor[r]&&i instanceof rd){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let o=e-t;if(i instanceof rd)if(i.block){let{type:t}=i;t!=ed.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new hd(i.widget||new dd("div"),o,t))}else{let r=$u.create(i.widget||new dd("span"),o,o?0:i.startSide),a=this.atCursorPos&&!r.isEditable&&n<=s.length&&(t<e||i.startSide>0),l=!r.isEditable&&(t<e||i.startSide<=0),h=this.getLine();2!=this.pendingBuffer||a||(this.pendingBuffer=0),this.flushBuffer(s),a&&(h.append(ud(new Zu(1),s),n),n=s.length+Math.max(0,n-s.length)),h.append(ud(r,s),n),this.atCursorPos=l,this.pendingBuffer=l?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);o&&(this.textOff+o<=this.text.length?this.textOff+=o:(this.skip+=o-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}static build(t,e,i,s,n){let r=new cd(t,e,i,n);return r.openEnd=_c.spans(s,e,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function ud(t,e){for(let i of e)t=new Vu(i,[t],t.length);return t}class dd extends td{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const pd=Ih.define(),fd=Ih.define(),md=Ih.define(),gd=Ih.define(),vd=Ih.define(),yd=Ih.define(),bd=Ih.define({combine:t=>t.some((t=>t))}),xd=Ih.define({combine:t=>t.some((t=>t))});class Od{constructor(t,e="nearest",i="nearest",s=5,n=5){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n}map(t){return t.empty?this:new Od(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const wd=dc.define({map:(t,e)=>t.map(e)});function Sd(t,e,i){let s=t.facet(gd);s.length?s[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const kd=Ih.define({combine:t=>!t.length||t[0]});let Ad=0;const Td=Ih.define();class Md{constructor(t,e,i,s){this.id=t,this.create=e,this.domEventHandlers=i,this.extension=s(this)}static define(t,e){const{eventHandlers:i,provide:s,decorations:n}=e||{};return new Md(Ad++,t,i,(t=>{let e=[Td.of(t)];return n&&e.push(Rd.of((e=>{let i=e.plugin(t);return i?n(i):id.none}))),s&&e.push(s(t)),e}))}static fromClass(t,e){return Md.define((e=>new t(e)),e)}}class Pd{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}update(t){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(i){if(Sd(e.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){Sd(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(null===(e=this.value)||void 0===e?void 0:e.destroy)try{this.value.destroy()}catch(e){Sd(t.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Cd=Ih.define(),_d=Ih.define(),Rd=Ih.define(),Ed=Ih.define(),Qd=Ih.define(),Ld=Ih.define();class Fd{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new Fd(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(0==e.length)return t;let i=[];for(let s=0,n=0,r=0,o=0;;s++){let a=s==t.length?null:t[s],l=r-o,h=a?a.fromB:1e9;for(;n<e.length&&e[n]<h;){let t=e[n],s=e[n+1],r=Math.max(o,t),a=Math.min(h,s);if(r<=a&&new Fd(r+l,a+l,r,a).addToSet(i),s>h)break;n+=2}if(!a)return i;new Fd(a.fromA,a.toA,a.fromB,a.toB).addToSet(i),r=a.toA,o=a.toB}}}class Id{constructor(t,e,i){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=Ah.empty(this.startState.doc.length);for(let t of i)this.changes=this.changes.compose(t.changes);let s=[];this.changes.iterChangedRanges(((t,e,i,n)=>s.push(new Fd(t,e,i,n)))),this.changedRanges=s;let n=t.hasFocus;n!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=n,this.flags|=1)}static create(t,e,i){return new Id(t,e,i)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((t=>t.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var Dd=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(Dd||(Dd={}));const Ud=Dd.LTR,zd=Dd.RTL;function Nd(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const Vd=Nd("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),Bd=Nd("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),$d=Object.create(null),Xd=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);$d[e]=i,$d[i]=-e}function jd(t){return t<=247?Vd[t]:1424<=t&&t<=1524?2:1536<=t&&t<=1785?Bd[t-1536]:1774<=t&&t<=2220?4:8192<=t&&t<=8203?256:64336<=t&&t<=65023?4:8204==t?256:1}const Gd=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class Zd{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?zd:Ud}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,s){let n=-1;for(let r=0;r<t.length;r++){let o=t[r];if(o.from<=e&&o.to>=e){if(o.level==i)return r;(n<0||(0!=s?s<0?o.from<e:o.to>e:t[n].level>o.level))&&(n=r)}}if(n<0)throw new RangeError("Index out of range");return n}}const qd=[];function Wd(t){return[new Zd(0,t,0)]}let Hd="";function Yd(t,e,i,s,n){var r;let o=s.head-t.from,a=-1;if(0==o){if(!n||!t.length)return null;e[0].level!=i&&(o=e[0].side(!1,i),a=0)}else if(o==t.length){if(n)return null;let t=e[e.length-1];t.level!=i&&(o=t.side(!0,i),a=e.length-1)}a<0&&(a=Zd.find(e,o,null!==(r=s.bidiLevel)&&void 0!==r?r:-1,s.assoc));let l=e[a];o==l.side(n,i)&&(o=(l=e[a+=n?1:-1]).side(!n,i));let h=n==(l.dir==i),c=fh(t.text,o,h);if(Hd=t.text.slice(Math.min(o,c),Math.max(o,c)),c!=l.side(n,i))return Qh.cursor(c+t.from,h?-1:1,l.level);let u=a==(n?e.length-1:0)?null:e[a+(n?1:-1)];return u||l.level==i?u&&u.level<l.level?Qh.cursor(u.side(!n,i)+t.from,n?1:-1,u.level):Qh.cursor(c+t.from,n?-1:1,l.level):Qh.cursor(n?t.to:t.from,n?-1:1,i)}const Kd="";class Jd{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(kc.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+=Kd}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s),this.readNode(s);let t=s.nextSibling;if(t==e)break;let n=Su.get(s),r=Su.get(t);(n&&r?n.breakAfter:(n?n.breakAfter:tp(s))||tp(t)&&("BR"!=s.nodeName||s.cmIgnore))&&this.lineBreak(),s=t}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n,r=-1,o=1;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(n=s.exec(e))&&(r=n.index,o=n[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let e of this.points)e.node==t&&e.pos>this.text.length&&(e.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=Su.get(t),i=e&&e.overrideDOMText;if(null!=i){this.findPointInside(t,i.length);for(let t=i.iter();!t.next().done;)t.lineBreak?this.lineBreak():this.append(t.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(3==t.nodeType?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function tp(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class ep{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class ip extends Su{constructor(t){super(),this.view=t,this.compositionDeco=id.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new ld],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Fd(0,0,0,t.state.doc.length)],0)}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every((({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo))?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=id.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=function(t,e){let i=np(t);if(!i)return id.none;let{from:s,to:n,node:r,text:o}=i,a=e.mapPos(s,1),l=Math.max(a,e.mapPos(n,-1)),{state:h}=t,c=3==r.nodeType?r.nodeValue:new Jd([],h).readRange(r.firstChild,null).text;if(l-a<c.length)if(h.doc.sliceString(a,Math.min(h.doc.length,a+c.length),Kd)==c)l=a+c.length;else{if(h.doc.sliceString(Math.max(0,l-c.length),l,Kd)!=c)return id.none;a=l-c.length}else if(h.doc.sliceString(a,l,Kd)!=c)return id.none;let u=Su.get(r);return u instanceof Xu?u=u.widget.topView:u&&(u.parent=null),id.set(id.replace({widget:new rp(r,o,u),inclusive:!0}).range(a,l))}(this.view,t.changes)),(zu.ie||zu.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=function(t,e,i){let s=new ap;return _c.compare(t,e,i,s),s.changes}(this.decorations,this.updateDeco(),t.changes);return e=Fd.extendWithRanges(e,i),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let t=zu.chrome||zu.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(t),this.dirty=0,t&&(t.written||i.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let t of this.children)t instanceof hd&&t.widget instanceof sp&&s.push(t.dom);i.updateGaps(s)}updateChildren(t,e){let i=this.childCursor(e);for(let e=t.length-1;;e--){let s=e>=0?t[e]:null;if(!s)break;let{fromA:n,toA:r,fromB:o,toB:a}=s,{content:l,breakAtStart:h,openStart:c,openEnd:u}=cd.build(this.view.state.doc,o,a,this.decorations,this.dynamicDecorationMap),{i:d,off:p}=i.findPos(r,1),{i:f,off:m}=i.findPos(n,-1);Tu(this,f,m,d,p,l,h,c,u)}}updateSelection(t=!1,e=!1){if(!t&&this.view.observer.selectionRange.focusNode||this.view.observer.readSelectionRange(),!e&&!this.mayControlSelection())return;let i=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,n=this.domAtPos(s.anchor),r=s.empty?n:this.domAtPos(s.head);if(zu.gecko&&s.empty&&function(t){return 1==t.node.nodeType&&t.node.firstChild&&(0==t.offset||"false"==t.node.childNodes[t.offset-1].contentEditable)&&(t.offset==t.node.childNodes.length||"false"==t.node.childNodes[t.offset].contentEditable)}(n)){let t=document.createTextNode("");this.view.observer.ignore((()=>n.node.insertBefore(t,n.node.childNodes[n.offset]||null))),n=r=new Ou(t,0),i=!0}let o=this.view.observer.selectionRange;!i&&o.focusNode&&au(n.node,n.offset,o.anchorNode,o.anchorOffset)&&au(r.node,r.offset,o.focusNode,o.focusOffset)||(this.view.observer.ignore((()=>{zu.android&&zu.chrome&&this.dom.contains(o.focusNode)&&function(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(o.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let t=su(this.view.root);if(t)if(s.empty){if(zu.gecko){let t=function(t,e){return 1!=t.nodeType?0:(e&&"false"==t.childNodes[e-1].contentEditable?1:0)|(e<t.childNodes.length&&"false"==t.childNodes[e].contentEditable?2:0)}(n.node,n.offset);if(t&&3!=t){let e=op(n.node,n.offset,1==t?1:-1);e&&(n=new Ou(e,1==t?0:e.nodeValue.length))}}t.collapse(n.node,n.offset),null!=s.bidiLevel&&null!=o.cursorBidiLevel&&(o.cursorBidiLevel=s.bidiLevel)}else if(t.extend){t.collapse(n.node,n.offset);try{t.extend(r.node,r.offset)}catch(t){}}else{let e=document.createRange();s.anchor>s.head&&([n,r]=[r,n]),e.setEnd(r.node,r.offset),e.setStart(n.node,n.offset),t.removeAllRanges(),t.addRange(e)}})),this.view.observer.setSelectionRange(n,r)),this.impreciseAnchor=n.precise?null:new Ou(o.anchorNode,o.anchorOffset),this.impreciseHead=r.precise?null:new Ou(o.focusNode,o.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let{view:t}=this,e=t.state.selection.main,i=su(t.root),{anchorNode:s,anchorOffset:n}=t.observer.selectionRange;if(!(i&&e.empty&&e.assoc&&i.modify))return;let r=ld.find(this,e.head);if(!r)return;let o=r.posAtStart;if(e.head==o||e.head==o+r.length)return;let a=this.coordsAt(e.head,-1),l=this.coordsAt(e.head,1);if(!a||!l||a.bottom>l.top)return;let h=this.domAtPos(e.head+e.assoc);i.collapse(h.node,h.offset),i.modify("move",e.assoc<0?"forward":"backward","lineboundary"),t.observer.readSelectionRange();let c=t.observer.selectionRange;t.docView.posFromDOM(c.anchorNode,c.anchorOffset)!=e.from&&i.collapse(s,n)}mayControlSelection(){let t=this.view.root.activeElement;return t==this.dom||ru(this.dom,this.view.observer.selectionRange)&&!(t&&this.dom.contains(t))}nearest(t){for(let e=t;e;){let t=Su.get(e);if(t&&t.rootView==this)return t;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let t=this.children[e];if(i<t.length||t instanceof ld)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,s=this.children.length-1;;s--){let n=this.children[s],r=i-n.breakAfter-n.length;if(t>r||t==r&&n.type!=ed.WidgetBefore&&n.type!=ed.WidgetAfter&&(!s||2==e||this.children[s-1].breakAfter||this.children[s-1].type==ed.WidgetBefore&&e>-2))return n.coordsAt(t-r,e);i=r}}measureVisibleLineHeights(t){let e=[],{from:i,to:s}=t,n=this.view.contentDOM.clientWidth,r=n>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1,a=this.view.textDirection==Dd.LTR;for(let t=0,l=0;l<this.children.length;l++){let h=this.children[l],c=t+h.length;if(c>s)break;if(t>=i){let i=h.dom.getBoundingClientRect();if(e.push(i.height),r){let e=h.dom.lastChild,s=e?ou(e):[];if(s.length){let e=s[s.length-1],r=a?e.right-i.left:i.right-e.left;r>o&&(o=r,this.minWidth=n,this.minWidthFrom=t,this.minWidthTo=c)}}}t=c+h.breakAfter}return e}textDirectionAt(t){let{i:e}=this.childPos(t,1);return"rtl"==getComputedStyle(this.children[e].dom).direction?Dd.RTL:Dd.LTR}measureTextSize(){for(let t of this.children)if(t instanceof ld){let e=t.measureTextSize();if(e)return e}let t,e,i=document.createElement("div");return i.className="cm-line",i.style.width="99999px",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let s=ou(i.firstChild)[0];t=i.getBoundingClientRect().height,e=s?s.width/27:7,i.remove()})),{lineHeight:t,charWidth:e}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new Au(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],r=n?n.from-1:this.length;if(r>i){let s=e.lineBlockAt(r).bottom-e.lineBlockAt(i).top;t.push(id.replace({widget:new sp(s),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!n)break;i=n.to+1}return id.set(t)}updateDeco(){let t=this.view.state.facet(Rd).map(((t,e)=>(this.dynamicDecorationMap[e]="function"==typeof t)?t(this.view):t));for(let e=t.length;e<t.length+3;e++)this.dynamicDecorationMap[e]=!1;return this.decorations=[...t,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let e,{range:i}=t,s=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!s)return;!i.empty&&(e=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(s={left:Math.min(s.left,e.left),top:Math.min(s.top,e.top),right:Math.max(s.right,e.right),bottom:Math.max(s.bottom,e.bottom)});let n=0,r=0,o=0,a=0;for(let t of this.view.state.facet(Qd).map((t=>t(this.view))))if(t){let{left:e,right:i,top:s,bottom:l}=t;null!=e&&(n=Math.max(n,e)),null!=i&&(r=Math.max(r,i)),null!=s&&(o=Math.max(o,s)),null!=l&&(a=Math.max(a,l))}let l={left:s.left-n,top:s.top-o,right:s.right+r,bottom:s.bottom+a};!function(t,e,i,s,n,r,o,a){let l=t.ownerDocument,h=l.defaultView||window;for(let c=t;c;)if(1==c.nodeType){let t,u=c==l.body;if(u)t=pu(h);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.assignedSlot||c.parentNode;continue}let e=c.getBoundingClientRect();t={left:e.left,right:e.left+c.clientWidth,top:e.top,bottom:e.top+c.clientHeight}}let d=0,p=0;if("nearest"==n)e.top<t.top?(p=-(t.top-e.top+o),i>0&&e.bottom>t.bottom+p&&(p=e.bottom-t.bottom+p+o)):e.bottom>t.bottom&&(p=e.bottom-t.bottom+o,i<0&&e.top-p<t.top&&(p=-(t.top+p-e.top+o)));else{let s=e.bottom-e.top,r=t.bottom-t.top;p=("center"==n&&s<=r?e.top+s/2-r/2:"start"==n||"center"==n&&i<0?e.top-o:e.bottom-r+o)-t.top}if("nearest"==s?e.left<t.left?(d=-(t.left-e.left+r),i>0&&e.right>t.right+d&&(d=e.right-t.right+d+r)):e.right>t.right&&(d=e.right-t.right+r,i<0&&e.left<t.left+d&&(d=-(t.left+d-e.left+r))):d=("center"==s?e.left+(e.right-e.left)/2-(t.right-t.left)/2:"start"==s==a?e.left-r:e.right-(t.right-t.left)+r)-t.left,d||p)if(u)h.scrollBy(d,p);else{let t=0,i=0;if(p){let t=c.scrollTop;c.scrollTop+=p,i=c.scrollTop-t}if(d){let e=c.scrollLeft;c.scrollLeft+=d,t=c.scrollLeft-e}e={left:e.left-t,top:e.top-i,right:e.right-t,bottom:e.bottom-i},t&&Math.abs(t-d)<1&&(s="nearest"),i&&Math.abs(i-p)<1&&(n="nearest")}if(u)break;c=c.assignedSlot||c.parentNode}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==Dd.LTR)}}class sp extends td{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function np(t){let e=t.observer.selectionRange,i=e.focusNode&&op(e.focusNode,e.focusOffset,0);if(!i)return null;let s=t.docView.nearest(i);if(!s)return null;if(s instanceof ld){let t=i;for(;t.parentNode!=s.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!Su.get(e);)e=e.previousSibling;let n=e?Su.get(e).posAtEnd:s.posAtStart;return{from:n,to:n,node:t,text:i}}{for(;;){let{parent:t}=s;if(!t)return null;if(t instanceof ld)break;s=t}let t=s.posAtStart;return{from:t,to:t+s.length,node:s.dom,text:i}}}class rp extends td{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return Xu}}function op(t,e,i){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0&&i<=0)e=cu(t=t.childNodes[e-1]);else{if(!(1==t.nodeType&&e<t.childNodes.length&&i>=0))return null;t=t.childNodes[e],e=0}}}class ap{constructor(){this.changes=[]}compareRange(t,e){ad(t,e,this.changes)}comparePoint(t,e){ad(t,e,this.changes)}}function lp(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function hp(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function cp(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function up(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function dp(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function pp(t,e,i){let s,n,r,o,a,l,h,c,u=!1;for(let d=t.firstChild;d;d=d.nextSibling){let t=ou(d);for(let p=0;p<t.length;p++){let f=t[p];n&&cp(n,f)&&(f=up(dp(f,n.bottom),n.top));let m=lp(e,f),g=hp(i,f);if(0==m&&0==g)return 3==d.nodeType?fp(d,e,i):pp(d,e,i);(!s||o>g||o==g&&r>m)&&(s=d,n=f,r=m,o=g,u=!m||(m>0?p<t.length-1:p>0)),0==m?i>f.bottom&&(!h||h.bottom<f.bottom)?(a=d,h=f):i<f.top&&(!c||c.top>f.top)&&(l=d,c=f):h&&cp(h,f)?h=dp(h,f.bottom):c&&cp(c,f)&&(c=up(c,f.top))}}if(h&&h.bottom>=i?(s=a,n=h):c&&c.top<=i&&(s=l,n=c),!s)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));return 3==s.nodeType?fp(s,d,i):u&&"false"!=s.contentEditable?pp(s,d,i):{node:t,offset:Array.prototype.indexOf.call(t.childNodes,s)+(e>=(n.left+n.right)/2?1:0)}}function fp(t,e,i){let s=t.nodeValue.length,n=-1,r=1e9,o=0;for(let a=0;a<s;a++){let s=yu(t,a,a+1).getClientRects();for(let l=0;l<s.length;l++){let h=s[l];if(h.top==h.bottom)continue;o||(o=e-h.left);let c=(h.top>i?h.top-i:i-h.bottom)-1;if(h.left-1<=e&&h.right+1>=e&&c<r){let i=e>=(h.left+h.right)/2,s=i;if((zu.chrome||zu.gecko)&&yu(t,a).getBoundingClientRect().left==h.right&&(s=!i),c<=0)return{node:t,offset:a+(s?1:0)};n=a+(s?1:0),r=c}}}return{node:t,offset:n>-1?n:o>0?t.nodeValue.length:0}}function mp(t,{x:e,y:i},s,n=-1){var r;let o,a=t.contentDOM.getBoundingClientRect(),l=a.top+t.viewState.paddingTop,{docHeight:h}=t.viewState,c=i-l;if(c<0)return 0;if(c>h)return t.state.doc.length;for(let e=t.defaultLineHeight/2,i=!1;(o=t.elementAtHeight(c)).type!=ed.Text;)for(;!((c=n>0?o.bottom+e:o.top-e)>=0&&c<=h);){if(i)return s?null:0;i=!0,n=-n}i=l+c;let u=o.from;if(u<t.viewport.from)return 0==t.viewport.from?0:s?null:gp(t,a,o,e,i);if(u>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:s?null:gp(t,a,o,e,i);let d=t.dom.ownerDocument,p=t.root.elementFromPoint?t.root:d,f=p.elementFromPoint(e,i);f&&!t.contentDOM.contains(f)&&(f=null),f||(e=Math.max(a.left+1,Math.min(a.right-1,e)),(f=p.elementFromPoint(e,i))&&!t.contentDOM.contains(f)&&(f=null));let m,g=-1;if(f&&0!=(null===(r=t.docView.nearest(f))||void 0===r?void 0:r.isEditable))if(d.caretPositionFromPoint){let t=d.caretPositionFromPoint(e,i);t&&({offsetNode:m,offset:g}=t)}else if(d.caretRangeFromPoint){let s=d.caretRangeFromPoint(e,i);s&&(({startContainer:m,startOffset:g}=s),(!t.contentDOM.contains(m)||zu.safari&&function(t,e,i){let s;if(3!=t.nodeType||e!=(s=t.nodeValue.length))return!1;for(let e=t.nextSibling;e;e=e.nextSibling)if(1!=e.nodeType||"BR"!=e.nodeName)return!1;return yu(t,s-1,s).getBoundingClientRect().left>i}(m,g,e)||zu.chrome&&function(t,e,i){if(0!=e)return!1;for(let e=t;;){let t=e.parentNode;if(!t||1!=t.nodeType||t.firstChild!=e)return!1;if(t.classList.contains("cm-line"))break;e=t}return i-(1==t.nodeType?t.getBoundingClientRect():yu(t,0,Math.max(t.nodeValue.length,1)).getBoundingClientRect()).left>5}(m,g,e))&&(m=void 0))}if(!m||!t.docView.dom.contains(m)){let s=ld.find(t.docView,u);if(!s)return c>o.top+o.height/2?o.to:o.from;({node:m,offset:g}=pp(s.dom,e,i))}return t.docView.posFromDOM(m,g)}function gp(t,e,i,s,n){let r=Math.round((s-e.left)*t.defaultCharacterWidth);t.lineWrapping&&i.height>1.5*t.defaultLineHeight&&(r+=Math.floor((n-i.top)/t.defaultLineHeight)*t.viewState.heightOracle.lineLength);let o=t.state.sliceDoc(i.from,i.to);return i.from+function(t,e,i,s){for(let s=0,n=0;;){if(n>=e)return s;if(s==t.length)break;n+=9==t.charCodeAt(s)?i-n%i:1,s=fh(t,s)}return!0===s?-1:t.length}(o,r,t.state.tabSize)}function vp(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=t.bidiSpans(n),o=t.textDirectionAt(n.from);for(let a=e,l=null;;){let e=Yd(n,r,o,a,i),h=Hd;if(!e){if(n.number==(i?t.state.doc.lines:1))return a;h="\n",n=t.state.doc.line(n.number+(i?1:-1)),r=t.bidiSpans(n),e=Qh.cursor(i?n.from:n.to)}if(l){if(!l(h))return a}else{if(!s)return e;l=s(h)}a=e}}function yp(t,e,i){let s=t.state.facet(Ed).map((e=>e(t)));for(;;){let t=!1;for(let n of s)n.between(i.from-1,i.from+1,((s,n,r)=>{i.from>s&&i.from<n&&(i=e.head>i.from?Qh.cursor(s,1):Qh.cursor(n,-1),t=!0)}));if(!t)return i}}class bp{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.mouseSelection=null;for(let e in Ap){let i=Ap[e];t.contentDOM.addEventListener(e,(s=>{kp(t,s)&&!this.ignoreDuringComposition(s)&&("keydown"==e&&this.keydown(t,s)||(this.mustFlushObserver(s)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,s)?s.preventDefault():i(t,s)))}),Tp[e]),this.registeredEvents.push(e)}zu.chrome&&102==zu.chrome_version&&t.scrollDOM.addEventListener("wheel",(()=>{this.chromeScrollHack<0?t.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout((()=>{this.chromeScrollHack=-1,t.contentDOM.style.pointerEvents=""}),100)}),{passive:!0}),this.notifiedFocused=t.hasFocus,zu.safari&&t.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t,e){var i;let s;this.customHandlers=[];for(let n of e)if(s=null===(i=n.update(t).spec)||void 0===i?void 0:i.domEventHandlers){this.customHandlers.push({plugin:n.value,handlers:s});for(let e in s)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),t.contentDOM.addEventListener(e,(i=>{kp(t,i)&&this.runCustomHandlers(e,t,i)&&i.preventDefault()})))}}runCustomHandlers(t,e,i){for(let s of this.customHandlers){let n=s.handlers[t];if(n)try{if(n.call(s.plugin,i,e)||i.defaultPrevented)return!0}catch(t){Sd(e.state,t)}}return!1}runScrollHandlers(t,e){this.lastScrollTop=t.scrollDOM.scrollTop,this.lastScrollLeft=t.scrollDOM.scrollLeft;for(let i of this.customHandlers){let s=i.handlers.scroll;if(s)try{s.call(i.plugin,e,t)}catch(e){Sd(t.state,e)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(zu.android&&zu.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return!(!zu.ios||e.synthetic||e.altKey||e.metaKey||!((i=xp.find((t=>t.keyCode==e.keyCode)))&&!e.ctrlKey||Op.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)||(this.pendingIOSKey=i||e,setTimeout((()=>this.flushIOSKey(t)),250),0))}flushIOSKey(t){let e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,bu(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(this.composing>0||!!(zu.safari&&!zu.ios&&Date.now()-this.compositionEndedAt<100)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const xp=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Op="dthko",wp=[16,17,18,20,91,92,224,225];class Sp{constructor(t,e,i,s){this.view=t,this.style=i,this.mustSelect=s,this.lastEvent=e;let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(kc.allowMultipleSelections)&&function(t,e){let i=t.state.facet(pd);return i.length?i[0](e):zu.mac?e.metaKey:e.ctrlKey}(t,e),this.dragMove=function(t,e){let i=t.state.facet(fd);return i.length?i[0](e):zu.mac?!e.altKey:!e.ctrlKey}(t,e),this.dragging=!(!function(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let s=su(t.root);if(!s||0==s.rangeCount)return!0;let n=s.getRangeAt(0).getClientRects();for(let t=0;t<n.length;t++){let i=n[t];if(i.left<=e.clientX&&i.right>=e.clientX&&i.top<=e.clientY&&i.bottom>=e.clientY)return!0}return!1}(t,e)||1!=Up(e))&&null,!1===this.dragging&&(e.preventDefault(),this.select(e))}move(t){if(0==t.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=t)}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);!this.mustSelect&&e.eq(this.view.state.selection)&&e.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function kp(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i,s=e.target;s!=t.contentDOM;s=s.parentNode)if(!s||11==s.nodeType||(i=Su.get(s))&&i.ignoreEvent(e))return!1;return!0}const Ap=Object.create(null),Tp=Object.create(null),Mp=zu.ie&&zu.ie_version<15||zu.ios&&zu.webkit_version<604;function Pp(t,e){let i,{state:s}=t,n=1,r=s.toText(e),o=r.lines==s.selection.ranges.length;if(null!=Np&&s.selection.ranges.every((t=>t.empty))&&Np==r.toString()){let t=-1;i=s.changeByRange((i=>{let a=s.doc.lineAt(i.from);if(a.from==t)return{range:i};t=a.from;let l=s.toText((o?r.line(n++).text:e)+s.lineBreak);return{changes:{from:a.from,insert:l},range:Qh.cursor(i.from+l.length)}}))}else i=o?s.changeByRange((t=>{let e=r.line(n++);return{changes:{from:t.from,to:t.to,insert:e.text},range:Qh.cursor(t.from+e.length)}})):s.replaceSelection(r);t.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}function Cp(t,e,i,s){if(1==s)return Qh.cursor(e,i);if(2==s)return function(t,e,i=1){let s=t.charCategorizer(e),n=t.doc.lineAt(e),r=e-n.from;if(0==n.length)return Qh.cursor(e);0==r?i=1:r==n.length&&(i=-1);let o=r,a=r;i<0?o=fh(n.text,r,!1):a=fh(n.text,r);let l=s(n.text.slice(o,a));for(;o>0;){let t=fh(n.text,o,!1);if(s(n.text.slice(t,o))!=l)break;o=t}for(;a<n.length;){let t=fh(n.text,a);if(s(n.text.slice(a,t))!=l)break;a=t}return Qh.range(o+n.from,a+n.from)}(t.state,e,i);{let i=ld.find(t.docView,e),s=t.state.doc.lineAt(i?i.posAtEnd:e),n=i?i.posAtStart:s.from,r=i?i.posAtEnd:s.to;return r<t.state.doc.length&&r==s.to&&r++,Qh.range(n,r)}}Ap.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),27==e.keyCode?t.inputState.lastEscPress=Date.now():wp.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)},Ap.touchstart=(t,e)=>{t.inputState.lastTouchTime=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},Ap.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},Tp.touchstart=Tp.touchmove={passive:!0},Ap.mousedown=(t,e)=>{if(t.observer.flush(),t.inputState.lastTouchTime>Date.now()-2e3)return;let i=null;for(let s of t.state.facet(md))if(i=s(t,e))break;if(i||0!=e.button||(i=function(t,e){let i=Qp(t,e),s=Up(e),n=t.state.selection,r=i,o=e;return{update(t){t.docChanged&&(i.pos=t.changes.mapPos(i.pos),n=n.map(t.changes),o=null)},get(e,a,l){let h;o&&e.clientX==o.clientX&&e.clientY==o.clientY?h=r:(h=r=Qp(t,e),o=e);let c=Cp(t,h.pos,h.bias,s);if(i.pos!=h.pos&&!a){let e=Cp(t,i.pos,i.bias,s),n=Math.min(e.from,c.from),r=Math.max(e.to,c.to);c=n<c.from?Qh.range(n,r):Qh.range(r,n)}return a?n.replaceRange(n.main.extend(c.from,c.to)):l&&n.ranges.length>1&&n.ranges.some((t=>t.eq(c)))?function(t,e){for(let i=0;;i++)if(t.ranges[i].eq(e))return Qh.create(t.ranges.slice(0,i).concat(t.ranges.slice(i+1)),t.mainIndex==i?0:t.mainIndex-(t.mainIndex>i?1:0))}(n,c):l?n.addRange(c):Qh.create([c])}}}(t,e)),i){let s=t.root.activeElement!=t.contentDOM;s&&t.observer.ignore((()=>vu(t.contentDOM))),t.inputState.startMouseSelection(new Sp(t,e,i,s))}};let _p=(t,e)=>t>=e.top&&t<=e.bottom,Rp=(t,e,i)=>_p(e,i)&&t>=i.left&&t<=i.right;function Ep(t,e,i,s){let n=ld.find(t.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(0==r)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&Rp(i,s,o))return-1;let a=n.coordsAt(r,1);return a&&Rp(i,s,a)?1:o&&_p(s,o)?-1:1}function Qp(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:Ep(t,i,e.clientX,e.clientY)}}const Lp=zu.ie&&zu.ie_version<=11;let Fp=null,Ip=0,Dp=0;function Up(t){if(!Lp)return t.detail;let e=Fp,i=Dp;return Fp=t,Dp=Date.now(),Ip=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(Ip+1)%3:1}function zp(t,e,i,s){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:r}=t.inputState,o=s&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,a={from:n,insert:i},l=t.state.changes(o?[o,a]:a);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(n,-1),head:l.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}Ap.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:s}=t.inputState;s&&(s.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")},Ap.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let s=Array(i.length),n=0,r=()=>{++n==i.length&&zp(t,e,s.filter((t=>null!=t)).join(t.state.lineBreak),!1)};for(let t=0;t<i.length;t++){let e=new FileReader;e.onerror=r,e.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(e.result)||(s[t]=e.result),r()},e.readAsText(i[t])}}else zp(t,e,e.dataTransfer.getData("Text"),!0)},Ap.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=Mp?null:e.clipboardData;i?(Pp(t,i.getData("text/plain")),e.preventDefault()):function(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{t.focus(),i.remove(),Pp(t,i.value)}),50)}(t)};let Np=null;function Vp(t){setTimeout((()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])}),10)}Ap.copy=Ap.cut=(t,e)=>{let{text:i,ranges:s,linewise:n}=function(t){let e=[],i=[],s=!1;for(let s of t.selection.ranges)s.empty||(e.push(t.sliceDoc(s.from,s.to)),i.push(s));if(!e.length){let n=-1;for(let{from:s}of t.selection.ranges){let r=t.doc.lineAt(s);r.number>n&&(e.push(r.text),i.push({from:r.from,to:Math.min(t.doc.length,r.to+1)})),n=r.number}s=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:s}}(t.state);if(!i&&!n)return;Np=n?i:null;let r=Mp?null:e.clipboardData;r?(e.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(t,e){let i=t.dom.parentNode;if(!i)return;let s=i.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout((()=>{s.remove(),t.focus()}),50)}(t,i),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})},Ap.focus=t=>{t.inputState.lastFocusTime=Date.now(),t.scrollDOM.scrollTop||!t.inputState.lastScrollTop&&!t.inputState.lastScrollLeft||(t.scrollDOM.scrollTop=t.inputState.lastScrollTop,t.scrollDOM.scrollLeft=t.inputState.lastScrollLeft),Vp(t)},Ap.blur=t=>{t.observer.clearSelectionRange(),Vp(t)},Ap.compositionstart=Ap.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0)},Ap.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,zu.chrome&&zu.android&&t.observer.flushSoon(),setTimeout((()=>{t.inputState.composing<0&&t.docView.compositionDeco.size&&t.update([])}),50)},Ap.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},Ap.beforeinput=(t,e)=>{var i;let s;if(zu.chrome&&zu.android&&(s=xp.find((t=>t.inputType==e.inputType)))&&(t.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let e=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>e+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())}),100)}};const Bp=["pre-wrap","normal","pre-line","break-spaces"];class $p{constructor(t){this.lineWrapping=t,this.doc=eh.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){return this.lineWrapping?(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForWrapping(t){return Bp.indexOf(t)>-1!=this.lineWrapping}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(10*s)]||(e=!0,this.heightSamples[Math.floor(10*s)]=!0)}return e}refresh(t,e,i,s,n){let r=Bp.indexOf(t)>-1,o=Math.round(e)!=Math.round(this.lineHeight)||this.lineWrapping!=r;if(this.lineWrapping=r,this.lineHeight=e,this.charWidth=i,this.lineLength=s,o){this.heightSamples={};for(let t=0;t<n.length;t++){let e=n[t];e<0?t++:this.heightSamples[Math.floor(10*e)]=!0}}return o}}class Xp{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class jp{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this.type=n}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new jp(this.from,this.length+t.length,this.top,this.height+t.height,e)}}var Gp=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(Gp||(Gp={}));const Zp=.001;class qp{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>Zp&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return qp.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this;for(let r=s.length-1;r>=0;r--){let{fromA:o,toA:a,fromB:l,toB:h}=s[r],c=n.lineAt(o,Gp.ByPosNoHeight,e,0,0),u=c.to>=a?c:n.lineAt(a,Gp.ByPosNoHeight,e,0,0);for(h+=u.to-a,a=u.to;r>0&&c.from<=s[r-1].toA;)o=s[r-1].fromA,l=s[r-1].fromB,r--,o<c.from&&(c=n.lineAt(o,Gp.ByPosNoHeight,e,0,0));l+=c.from-o,o=c.from;let d=tf.build(i,t,l,h);n=n.replace(o,a,d)}return n.updateHeight(i,0)}static empty(){return new Hp(0,0)}static of(t){if(1==t.length)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>2*n){let n=t[e-1];n.break?t.splice(--e,1,n.left,null,n.right):t.splice(--e,1,n.left,n.right),i+=1+n.break,s-=n.size}else{if(!(n>2*s))break;{let e=t[i];e.break?t.splice(i,1,e.left,null,e.right):t.splice(i,1,e.left,e.right),i+=2+e.break,n-=e.size}}else if(s<n){let i=t[e++];i&&(s+=i.size)}else{let e=t[--i];e&&(n+=e.size)}let r=0;return null==t[e-1]?(r=1,e--):null==t[e]&&(r=1,i++),new Kp(qp.of(t.slice(0,e)),r,qp.of(t.slice(i)))}}qp.prototype.size=1;class Wp extends qp{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,s){return new jp(s,this.length,i,this.height,this.type)}lineAt(t,e,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(t,e,i,s,n,r){t<=n+this.length&&e>=n&&r(this.blockAt(0,i,s,n))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Hp extends Wp{constructor(t,e){super(t,e,ed.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let s=i[0];return 1==i.length&&(s instanceof Hp||s instanceof Yp&&4&s.flags)&&Math.abs(this.length-s.length)<10?(s instanceof Yp?s=new Hp(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):qp.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class Yp extends qp{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,s=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:s,lineHeight:this.height/(s-i+1)}}blockAt(t,e,i,s){let{firstLine:n,lastLine:r,lineHeight:o}=this.lines(e,s),a=Math.max(0,Math.min(r-n,Math.floor((t-i)/o))),{from:l,length:h}=e.line(n+a);return new jp(l,h,i+o*a,o,ed.Text)}lineAt(t,e,i,s,n){if(e==Gp.ByHeight)return this.blockAt(t,i,s,n);if(e==Gp.ByPosNoHeight){let{from:e,to:s}=i.lineAt(t);return new jp(e,s-e,0,0,ed.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,n),{from:a,length:l,number:h}=i.lineAt(t);return new jp(a,l,s+o*(h-r),o,ed.Text)}forEachLine(t,e,i,s,n,r){let{firstLine:o,lineHeight:a}=this.lines(i,n);for(let l=Math.max(t,n),h=Math.min(n+this.length,e);l<=h;){let e=i.lineAt(l);l==t&&(s+=a*(e.number-o)),r(new jp(e.from,e.length,s,a,ed.Text)),s+=a,l=e.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let t=i[i.length-1];t instanceof Yp?i[i.length-1]=new Yp(t.length+s):i.push(null,new Yp(s-1))}if(t>0){let e=i[0];e instanceof Yp?i[0]=new Yp(t+e.length):i.unshift(new Yp(t-1),null)}return qp.of(i)}decomposeLeft(t,e){e.push(new Yp(t-1),null)}decomposeRight(t,e){e.push(null,new Yp(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let i=[],r=Math.max(e,s.from),o=-1,a=t.heightChanged;for(s.from>e&&i.push(new Yp(s.from-e-1).updateHeight(t,e));r<=n&&s.more;){let e=t.doc.lineAt(r).length;i.length&&i.push(null);let n=s.heights[s.index++];-1==o?o=n:Math.abs(n-o)>=Zp&&(o=-2);let a=new Hp(e,n);a.outdated=!1,i.push(a),r+=e+1}r<=n&&i.push(null,new Yp(n-r).updateHeight(t,r));let l=qp.of(i);return t.heightChanged=a||o<0||Math.abs(l.height-this.height)>=Zp||Math.abs(o-this.lines(t.doc,e).lineHeight)>=Zp,l}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class Kp extends qp{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return 1&this.flags}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let r=s+this.left.height,o=n+this.left.length+this.break,a=e==Gp.ByHeight?t<r:t<o,l=a?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,r,o);if(this.break||(a?l.to<o:l.from>o))return l;let h=e==Gp.ByPosNoHeight?Gp.ByPosNoHeight:Gp.ByPos;return a?l.join(this.right.lineAt(o,h,i,r,o)):this.left.lineAt(o,h,i,s,n).join(l)}forEachLine(t,e,i,s,n,r){let o=s+this.left.height,a=n+this.left.length+this.break;if(this.break)t<a&&this.left.forEachLine(t,e,i,s,n,r),e>=a&&this.right.forEachLine(t,e,i,o,a,r);else{let l=this.lineAt(a,Gp.ByPos,i,s,n);t<l.from&&this.left.forEachLine(t,l.from-1,i,s,n,r),l.to>=t&&l.from<=e&&r(l),e>l.to&&this.right.forEachLine(l.to+1,e,i,o,a,r)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let r=n.length;for(let t of i)n.push(t);if(t>0&&Jp(n,r-1),e<this.length){let t=n.length;this.decomposeRight(e,n),Jp(n,t)}return qp.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&t>=++i&&e.push(null),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?qp.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:r}=this,o=e+n.length+this.break,a=null;return s&&s.from<=e+n.length&&s.more?a=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=o+r.length&&s.more?a=r=r.updateHeight(t,o,i,s):r.updateHeight(t,o,i),a?this.balanced(n,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function Jp(t,e){let i,s;null==t[e]&&(i=t[e-1])instanceof Yp&&(s=t[e+1])instanceof Yp&&t.splice(e-1,3,new Yp(i.length+1+s.length))}class tf{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let t=Math.min(e,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof Hp?i.length+=t-this.pos:(t>this.pos||!this.isCovered)&&this.nodes.push(new Hp(t-this.pos,-1)),this.writtenTo=t,e>t&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let n=e-t;i.block?this.addBlock(new Wp(n,s,i.type)):(n||s>=5)&&this.addLineDeco(s,n)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new Hp(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new Yp(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof Hp)return t;let e=new Hp(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type!=ed.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=ed.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||e instanceof Hp||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new Hp(0,-1));let i=t;for(let t of this.nodes)t instanceof Hp&&t.updateHeight(this.oracle,i),i+=t?t.length:1;return this.nodes}static build(t,e,i,s){let n=new tf(i,t);return _c.spans(e,i,s,n,0),n.finish(i)}}class ef{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&ad(t,e,this.changes,5)}}function sf(t,e){let i=t.getBoundingClientRect(),s=t.ownerDocument,n=s.defaultView||window,r=Math.max(0,i.left),o=Math.min(n.innerWidth,i.right),a=Math.max(0,i.top),l=Math.min(n.innerHeight,i.bottom);for(let e=t.parentNode;e&&e!=s.body;)if(1==e.nodeType){let i=e,s=window.getComputedStyle(i);if((i.scrollHeight>i.clientHeight||i.scrollWidth>i.clientWidth)&&"visible"!=s.overflow){let s=i.getBoundingClientRect();r=Math.max(r,s.left),o=Math.min(o,s.right),a=Math.max(a,s.top),l=e==t.parentNode?s.bottom:Math.min(l,s.bottom)}e="absolute"==s.position||"fixed"==s.position?i.offsetParent:i.parentNode}else{if(11!=e.nodeType)break;e=e.host}return{left:r-i.left,right:Math.max(r,o)-i.left,top:a-(i.top+e),bottom:Math.max(a,l)-(i.top+e)}}function nf(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}class rf{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t){return id.replace({widget:new of(this.size,t)}).range(this.from,this.to)}}class of extends td{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class af{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scaler=df,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Dd.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let e=t.facet(_d).some((t=>"function"!=typeof t&&"cm-lineWrapping"==t.class));this.heightOracle=new $p(e),this.stateDeco=t.facet(Rd).filter((t=>"function"!=typeof t)),this.heightMap=qp.empty().applyChanges(this.stateDeco,eh.empty,this.heightOracle.setDoc(t.doc),[new Fd(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=id.set(this.lineGaps.map((t=>t.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some((({from:t,to:e})=>s>=t&&s<=e))){let{from:e,to:i}=this.lineBlockAt(s);t.push(new lf(e,i))}}this.viewports=t.sort(((t,e)=>t.from-e.from)),this.scaler=this.heightMap.height<=7e6?df:new pf(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(t=>{this.viewportLines.push(1==this.scaler.scale?t:ff(t,this.scaler))}))}update(t,e=null){this.state=t.state;let i=this.stateDeco;this.stateDeco=this.state.facet(Rd).filter((t=>"function"!=typeof t));let s=t.changedRanges,n=Fd.extendWithRanges(s,function(t,e,i){let s=new ef;return _c.compare(t,e,i,s,0),s.changes}(i,this.stateDeco,t?t.changes:Ah.empty(this.state.doc.length))),r=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,t.startState.doc,this.heightOracle.setDoc(this.state.doc),n),this.heightMap.height!=r&&(t.flags|=2);let o=n.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<o.from||e.range.head>o.to)||!this.viewportIsAppropriate(o))&&(o=this.getViewport(0,e));let a=!t.changes.empty||2&t.flags||o.from!=this.viewport.from||o.to!=this.viewport.to;this.viewport=o,this.updateForViewport(),a&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&!t.state.facet(xd)&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace;this.defaultTextDirection="rtl"==i.direction?Dd.RTL:Dd.LTR;let r=this.heightOracle.mustRefreshForWrapping(n),o=r||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight;this.contentDOMHeight=e.clientHeight,this.mustMeasureContent=!1;let a=0,l=0,h=parseInt(i.paddingTop)||0,c=parseInt(i.paddingBottom)||0;this.paddingTop==h&&this.paddingBottom==c||(this.paddingTop=h,this.paddingBottom=c,a|=10),this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(o=!0),this.editorWidth=t.scrollDOM.clientWidth,a|=8);let u=(this.printing?nf:sf)(e,this.paddingTop),d=u.top-this.pixelViewport.top,p=u.bottom-this.pixelViewport.bottom;this.pixelViewport=u;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(o=!0)),!this.inView&&!this.scrollTarget)return 0;let m=e.clientWidth;if(this.contentDOMWidth==m&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=m,this.editorHeight=t.scrollDOM.clientHeight,a|=8),o){let e=t.docView.measureVisibleLineHeights(this.viewport);if(s.mustRefreshForHeights(e)&&(r=!0),r||s.lineWrapping&&Math.abs(m-this.contentDOMWidth)>s.charWidth){let{lineHeight:i,charWidth:o}=t.docView.measureTextSize();(r=i>0&&s.refresh(n,i,o,m/o,e))&&(t.docView.minWidth=0,a|=8)}d>0&&p>0?l=Math.max(d,p):d<0&&p<0&&(l=Math.min(d,p)),s.heightChanged=!1;for(let i of this.viewports){let n=i.from==this.viewport.from?e:t.docView.measureVisibleLineHeights(i);this.heightMap=(r?qp.empty().applyChanges(this.stateDeco,eh.empty,this.heightOracle,[new Fd(0,0,0,t.state.doc.length)]):this.heightMap).updateHeight(s,0,r,new Xp(i.from,n))}s.heightChanged&&(a|=2)}let g=!this.viewportIsAppropriate(this.viewport,l)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(l,this.scrollTarget)),this.updateForViewport(),(2&a||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(r?[]:this.lineGaps,t)),a|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),a}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.state.doc,{visibleTop:r,visibleBottom:o}=this,a=new lf(s.lineAt(r-1e3*i,Gp.ByHeight,n,0,0).from,s.lineAt(o+1e3*(1-i),Gp.ByHeight,n,0,0).to);if(e){let{head:t}=e.range;if(t<a.from||t>a.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=s.lineAt(t,Gp.ByPos,n,0,0);i="center"==e.y?(o.top+o.bottom)/2-r/2:"start"==e.y||"nearest"==e.y&&t<a.from?o.top:o.bottom-r,a=new lf(s.lineAt(i-500,Gp.ByHeight,n,0,0).from,s.lineAt(i+r+500,Gp.ByHeight,n,0,0).to)}}return a}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new lf(this.heightMap.lineAt(i,Gp.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,Gp.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,Gp.ByPos,this.state.doc,0,0),{bottom:n}=this.heightMap.lineAt(e,Gp.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==t||s<=r-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=o+Math.max(10,Math.min(i,250)))&&s>r-2e3&&n<o+2e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new rf(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t,e){let i=this.heightOracle.lineWrapping,s=i?1e4:2e3,n=s>>1,r=s<<1;if(this.defaultTextDirection!=Dd.LTR&&!i)return[];let o=[],a=(s,r,l,h)=>{if(r-s<n)return;let c=this.state.selection.main,u=[c.from];c.empty||u.push(c.to);for(let t of u)if(t>s&&t<r)return a(s,t-10,l,h),void a(t+10,r,l,h);let d=function(t,e){for(let i of t)if(e(i))return i}(t,(t=>t.from>=l.from&&t.to<=l.to&&Math.abs(t.from-s)<n&&Math.abs(t.to-r)<n&&!u.some((e=>t.from<e&&t.to>e))));if(!d){if(r<l.to&&e&&i&&e.visibleRanges.some((t=>t.from<=r&&t.to>=r))){let t=e.moveToLineBoundary(Qh.cursor(r),!1,!0).head;t>s&&(r=t)}d=new rf(s,r,this.gapSize(l,s,r,h))}o.push(d)};for(let t of this.viewportLines){if(t.length<r)continue;let e=hf(t.from,t.to,this.stateDeco);if(e.total<r)continue;let n,o,l=this.scrollTarget?this.scrollTarget.range.head:null;if(i){let i,r,a=s/this.heightOracle.lineLength*this.heightOracle.lineHeight;if(null!=l){let s=uf(e,l),n=((this.visibleBottom-this.visibleTop)/2+a)/t.height;i=s-n,r=s+n}else i=(this.visibleTop-t.top-a)/t.height,r=(this.visibleBottom-t.top+a)/t.height;n=cf(e,i),o=cf(e,r)}else{let t,i,r=e.total*this.heightOracle.charWidth,a=s*this.heightOracle.charWidth;if(null!=l){let s=uf(e,l),n=((this.pixelViewport.right-this.pixelViewport.left)/2+a)/r;t=s-n,i=s+n}else t=(this.pixelViewport.left-a)/r,i=(this.pixelViewport.right+a)/r;n=cf(e,t),o=cf(e,i)}n>t.from&&a(t.from,n,t,e),o<t.to&&a(o,t.to,t,e)}return o}gapSize(t,e,i,s){let n=uf(s,i)-uf(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){rf.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=id.set(t.map((t=>t.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];_c.spans(t,this.viewport.from,this.viewport.to,{span(t,i){e.push({from:t,to:i})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some(((t,i)=>t.from!=e[i].from||t.to!=e[i].to));return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((e=>e.from<=t&&e.to>=t))||ff(this.heightMap.lineAt(t,Gp.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return ff(this.heightMap.lineAt(this.scaler.fromDOM(t),Gp.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return ff(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class lf{constructor(t,e){this.from=t,this.to=e}}function hf(t,e,i){let s=[],n=t,r=0;return _c.spans(i,t,e,{span(){},point(t,e){t>n&&(s.push({from:n,to:t}),r+=t-n),n=e}},20),n<e&&(s.push({from:n,to:e}),r+=e-n),{total:r,ranges:s}}function cf({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let s=Math.floor(t*i);for(let t=0;;t++){let{from:i,to:n}=e[t],r=n-i;if(s<=r)return i+s;s-=r}}function uf(t,e){let i=0;for(let{from:s,to:n}of t.ranges){if(e<=n){i+=e-s;break}i+=n-s}return i/t.total}const df={toDOM:t=>t,fromDOM:t=>t,scale:1};class pf{constructor(t,e,i){let s=0,n=0,r=0;this.viewports=i.map((({from:i,to:n})=>{let r=e.lineAt(i,Gp.ByPos,t,0,0).top,o=e.lineAt(n,Gp.ByPos,t,0,0).bottom;return s+=o-r,{from:i,to:n,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-s)/(e.height-s);for(let t of this.viewports)t.domTop=r+(t.top-n)*this.scale,r=t.domBottom=t.domTop+(t.bottom-t.top),n=t.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}}function ff(t,e){if(1==e.scale)return t;let i=e.toDOM(t.top),s=e.toDOM(t.bottom);return new jp(t.from,t.length,i,s-i,Array.isArray(t.type)?t.type.map((t=>ff(t,e))):t.type)}const mf=Ih.define({combine:t=>t.join(" ")}),gf=Ih.define({combine:t=>t.indexOf(!0)>-1}),vf=Gc.newName(),yf=Gc.newName(),bf=Gc.newName(),xf={"&light":"."+yf,"&dark":"."+bf};function Of(t,e,i){return new Gc(e,{finish:e=>/&/.test(e)?e.replace(/&\w*/,(e=>{if("&"==e)return t;if(!i||!i[e])throw new RangeError(`Unsupported selector: ${e}`);return i[e]})):t+" "+e})}const wf=Of("."+vf,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},xf);class Sf{constructor(t,e,i,s){this.typeOver=s,this.bounds=null,this.text="";let{impreciseHead:n,impreciseAnchor:r}=t.docView;if(t.state.readOnly&&e>-1)this.newSel=null;else if(e>-1&&(this.bounds=t.docView.domBoundsAround(e,i,0))){let e=n||r?[]:function(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=t.observer.selectionRange;return i&&(e.push(new ep(i,s)),n==i&&r==s||e.push(new ep(n,r))),e}(t),i=new Jd(e,t.state);i.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=i.text,this.newSel=function(t,e){if(0==t.length)return null;let i=t[0].pos,s=2==t.length?t[1].pos:i;return i>-1&&s>-1?Qh.single(i+e,s+e):null}(e,this.bounds.from)}else{let e=t.observer.selectionRange,i=n&&n.node==e.focusNode&&n.offset==e.focusOffset||!nu(t.contentDOM,e.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(e.focusNode,e.focusOffset),s=r&&r.node==e.anchorNode&&r.offset==e.anchorOffset||!nu(t.contentDOM,e.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(e.anchorNode,e.anchorOffset);this.newSel=Qh.single(s,i)}}}function kf(t,e){let i,{newSel:s}=e,n=t.state.selection.main;if(e.bounds){let{from:s,to:r}=e.bounds,o=n.from,a=null;(8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100||zu.android&&e.text.length<r-s)&&(o=n.to,a="end");let l=function(t,e,i,s){let n=Math.min(t.length,e.length),r=0;for(;r<n&&t.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&t.length==e.length)return null;let o=t.length,a=e.length;for(;o>0&&a>0&&t.charCodeAt(o-1)==e.charCodeAt(a-1);)o--,a--;"end"==s&&(i-=o+Math.max(0,r-Math.min(o,a))-r);o<r&&t.length<e.length?(a=(r-=i<=r&&i>=o?r-i:0)+(a-o),o=r):a<r&&(o=(r-=i<=r&&i>=a?r-i:0)+(o-a),a=r);return{from:r,toA:o,toB:a}}(t.state.doc.sliceString(s,r,Kd),e.text,o-s,a);l&&(zu.chrome&&13==t.inputState.lastKeyCode&&l.toB==l.from+2&&e.text.slice(l.from,l.toB)==Kd+Kd&&l.toB--,i={from:s+l.from,to:s+l.toA,insert:eh.of(e.text.slice(l.from,l.toB).split(Kd))})}else!s||t.hasFocus&&t.state.facet(kd)&&!s.main.eq(n)||(s=null);if(!i&&!s)return!1;if(!i&&e.typeOver&&!n.empty&&s&&s.main.empty?i={from:n.from,to:n.to,insert:t.state.doc.slice(n.from,n.to)}:i&&i.from>=n.from&&i.to<=n.to&&(i.from!=n.from||i.to!=n.to)&&n.to-n.from-(i.to-i.from)<=4?i={from:n.from,to:n.to,insert:t.state.doc.slice(n.from,i.from).append(i.insert).append(t.state.doc.slice(i.to,n.to))}:(zu.mac||zu.android)&&i&&i.from==i.to&&i.from==n.head-1&&/^\. ?$/.test(i.insert.toString())?(s&&2==i.insert.length&&(s=Qh.single(s.main.anchor-1,s.main.head-1)),i={from:n.from,to:n.to,insert:eh.of([" "])}):zu.chrome&&i&&i.from==i.to&&i.from==n.head&&"\n "==i.insert.toString()&&t.lineWrapping&&(s&&(s=Qh.single(s.main.anchor-1,s.main.head-1)),i={from:n.from,to:n.to,insert:eh.of([" "])}),i){let e=t.state;if(zu.ios&&t.inputState.flushIOSKey(t))return!0;if(zu.android&&(i.from==n.from&&i.to==n.to&&1==i.insert.length&&2==i.insert.lines&&bu(t.contentDOM,"Enter",13)||i.from==n.from-1&&i.to==n.to&&0==i.insert.length&&bu(t.contentDOM,"Backspace",8)||i.from==n.from&&i.to==n.to+1&&0==i.insert.length&&bu(t.contentDOM,"Delete",46)))return!0;let r,o=i.insert.toString();if(t.state.facet(yd).some((e=>e(t,i.from,i.to,o))))return!0;if(t.inputState.composing>=0&&t.inputState.composing++,i.from>=n.from&&i.to<=n.to&&i.to-i.from>=(n.to-n.from)/3&&(!s||s.main.empty&&s.main.from==i.from+i.insert.length)&&t.inputState.composing<0){let s=n.from<i.from?e.sliceDoc(n.from,i.from):"",o=n.to>i.to?e.sliceDoc(i.to,n.to):"";r=e.replaceSelection(t.state.toText(s+i.insert.sliceString(0,void 0,t.state.lineBreak)+o))}else{let o=e.changes(i),a=s&&!e.selection.main.eq(s.main)&&s.main.to<=o.newLength?s.main:void 0;if(e.selection.ranges.length>1&&t.inputState.composing>=0&&i.to<=n.to&&i.to>=n.to-10){let s=t.state.sliceDoc(i.from,i.to),l=np(t)||t.state.doc.lineAt(n.head),h=n.to-i.to,c=n.to-n.from;r=e.changeByRange((r=>{if(r.from==n.from&&r.to==n.to)return{changes:o,range:a||r.map(o)};let u=r.to-h,d=u-s.length;if(r.to-r.from!=c||t.state.sliceDoc(d,u)!=s||l&&r.to>=l.from&&r.from<=l.to)return{range:r};let p=e.changes({from:d,to:u,insert:i.insert}),f=r.to-n.to;return{changes:p,range:a?Qh.range(Math.max(0,a.anchor+f),Math.max(0,a.head+f)):r.map(p)}}))}else r={changes:o,selection:a&&e.selection.replaceRange(a)}}let a="input.type";return t.composing&&(a+=".compose",t.inputState.compositionFirstChange&&(a+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(r,{scrollIntoView:!0,userEvent:a}),!0}if(s&&!s.main.eq(n)){let e=!1,i="select";return t.inputState.lastSelectionTime>Date.now()-50&&("select"==t.inputState.lastSelectionOrigin&&(e=!0),i=t.inputState.lastSelectionOrigin),t.dispatch({selection:s,scrollIntoView:e,userEvent:i}),!0}return!1}const Af={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Tf=zu.ie&&zu.ie_version<=11;class Mf{constructor(t){this.view=t,this.active=!1,this.selectionRange=new fu,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver((e=>{for(let t of e)this.queue.push(t);(zu.ie&&zu.ie_version<=11||zu.ios&&t.composing)&&e.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),Tf&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{var t;(null===(t=this.view.docView)||void 0===t?void 0:t.lastUpdate)<Date.now()-75&&this.onResize()})),this.resize.observe(t.scrollDOM)),this.addWindowListeners(this.win=t.win),this.start(),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(t){this.view.inputState.runScrollHandlers(this.view,t),this.intersecting&&this.view.measure()}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some(((e,i)=>e!=t[i])))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){let e=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:i}=this,s=this.selectionRange;if(i.state.facet(kd)?i.root.activeElement!=this.dom:!ru(i.dom,s))return;let n=s.anchorNode&&i.docView.nearest(s.anchorNode);n&&n.ignoreEvent(t)?e||(this.selectionChanged=!1):(zu.ie&&zu.ie_version<=11||zu.android&&zu.chrome)&&!i.state.selection.main.empty&&s.focusNode&&au(s.focusNode,s.focusOffset,s.anchorNode,s.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:t}=this,e=zu.safari&&11==t.root.nodeType&&function(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}(this.dom.ownerDocument)==this.dom&&function(t){let e=null;function i(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),t.dom.ownerDocument.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let s=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,a=t.docView.domAtPos(t.state.selection.main.anchor);return au(a.node,a.offset,r,o)&&([s,n,r,o]=[r,o,s,n]),{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:o}}(this.view)||su(t.root);if(!e||this.selectionRange.eq(e))return!1;let i=ru(this.dom,e);return i&&!this.selectionChanged&&t.inputState.lastFocusTime>Date.now()-200&&t.inputState.lastTouchTime<Date.now()-300&&function(t,e){let i=e.focusNode,s=e.focusOffset;if(!i||e.anchorNode!=i||e.anchorOffset!=s)return!1;for(;;)if(s){if(1!=i.nodeType)return!1;let t=i.childNodes[s-1];"false"==t.contentEditable?s--:s=cu(i=t)}else{if(i==t)return!0;s=lu(i),i=i.parentNode}}(this.dom,e)?(this.view.inputState.lastFocusTime=0,t.docView.updateSelection(),!1):(this.selectionRange.setRange(e),i&&(this.selectionChanged=!0),!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(1==i.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(let t of this.scrollTargets=e)t.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Af),Tf&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Tf&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){var i;if(!this.delayedAndroidKey){let t=()=>{let t=this.delayedAndroidKey;t&&(this.clearDelayedAndroidKey(),!this.flush()&&t.force&&bu(this.dom,t.key,t.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(t)}this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e,force:this.lastChange<Date.now()-50||!!(null===(i=this.delayedAndroidKey)||void 0===i?void 0:i.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame((()=>{this.delayedFlush=-1,this.flush()})))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}processRecords(){let t=this.queue;for(let e of this.observer.takeRecords())t.push(e);t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let t=this.readMutation(n);t&&(t.typeOver&&(s=!0),-1==e?({from:e,to:i}=t):(e=Math.min(t.from,e),i=Math.max(t.to,i)))}return{from:e,to:i,typeOver:s}}readChange(){let{from:t,to:e,typeOver:i}=this.processRecords(),s=this.selectionChanged&&ru(this.dom,this.selectionRange);return t<0&&!s?null:(t>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1,new Sf(this.view,t,e,i))}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;t&&this.readSelectionRange();let e=this.readChange();if(!e)return!1;let i=this.view.state,s=kf(this.view,e);return this.view.state==i&&this.view.update([]),s}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type){let i=Pf(e,t.previousSibling||t.target.previousSibling,-1),s=Pf(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}return"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}setWindow(t){t!=this.win&&(this.removeWindowListeners(this.win),this.win=t,this.addWindowListeners(this.win))}addWindowListeners(t){t.addEventListener("resize",this.onResize),t.addEventListener("beforeprint",this.onPrint),t.addEventListener("scroll",this.onScroll),t.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(t){t.removeEventListener("scroll",this.onScroll),t.removeEventListener("resize",this.onResize),t.removeEventListener("beforeprint",this.onPrint),t.document.removeEventListener("selectionchange",this.onSelectionChange)}destroy(){var t,e,i;this.stop(),null===(t=this.intersection)||void 0===t||t.disconnect(),null===(e=this.gapIntersection)||void 0===e||e.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey)}}function Pf(t,e,i){for(;e;){let s=Su.get(e);if(s&&s.parent==t)return s;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}class Cf{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this._root=t.root||function(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}(t.parent)||document,this.viewState=new af(t.state||kc.create(t)),this.plugins=this.state.facet(Td).map((t=>new Pd(t)));for(let t of this.plugins)t.update(this);this.observer=new Mf(this),this.inputState=new bp(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new ip(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}dispatch(...t){this._dispatch(1==t.length&&t[0]instanceof pc?t[0]:this.state.update(...t))}update(t){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e,i=!1,s=!1,n=this.state;for(let e of t){if(e.startState!=n)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");n=e.state}if(this.destroyed)return void(this.viewState.state=n);let r=this.observer.delayedAndroidKey,o=null;if(r?(this.observer.clearDelayedAndroidKey(),((o=this.observer.readChange())&&!this.state.doc.eq(n.doc)||!this.state.selection.eq(n.selection))&&(o=null)):this.observer.clear(),n.facet(kc.phrases)!=this.state.facet(kc.phrases))return this.setState(n);e=Id.create(this,n,t);let a=this.viewState.scrollTarget;try{this.updateState=2;for(let e of t){if(a&&(a=a.map(e.changes)),e.scrollIntoView){let{main:t}=e.state.selection;a=new Od(t.empty?t:Qh.cursor(t.head,t.head>t.anchor?-1:1))}for(let t of e.effects)t.is(wd)&&(a=t.value)}this.viewState.update(e,a),this.bidiCache=Ef.update(this.bidiCache,e.changes),e.empty||(this.updatePlugins(e),this.inputState.update(e)),i=this.docView.update(e),this.state.facet(Ld)!=this.styleModules&&this.mountStyles(),s=this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(i,t.some((t=>t.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(e.startState.facet(mf)!=e.state.facet(mf)&&(this.viewState.mustMeasureContent=!0),(i||s||a||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!e.empty)for(let t of this.state.facet(vd))t(e);o&&!kf(this,o)&&r.force&&bu(this.contentDOM,r.key,r.keyCode)}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=t);this.updateState=2;let e=this.hasFocus;try{for(let t of this.plugins)t.destroy(this);this.viewState=new af(t),this.plugins=t.facet(Td).map((t=>new Pd(t))),this.pluginMap.clear();for(let t of this.plugins)t.update(this);this.docView=new ip(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(Td),i=t.state.facet(Td);if(e!=i){let s=[];for(let n of i){let i=e.indexOf(n);if(i<0)s.push(new Pd(n));else{let e=this.plugins[i];e.mustUpdate=t,s.push(e)}}for(let e of this.plugins)e.mustUpdate!=t&&e.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let e of this.plugins)e.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.forceFlush();let e=null,{scrollHeight:i,scrollTop:s,clientHeight:n}=this.scrollDOM,r=s>i-n-4?i:s;try{for(let i=0;;i++){this.updateState=1;let s=this.viewport,n=this.viewState.lineBlockAtHeight(r),o=this.viewState.measure(this);if(!o&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(i>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let a=[];4&o||([this.measureRequests,a]=[a,this.measureRequests]);let l=a.map((t=>{try{return t.read(this)}catch(t){return Sd(this.state,t),Rf}})),h=Id.create(this,this.state,[]),c=!1,u=!1;h.flags|=o,e?e.flags|=o:e=h,this.updateState=2,h.empty||(this.updatePlugins(h),this.inputState.update(h),this.updateAttrs(),c=this.docView.update(h));for(let e=0;e<a.length;e++)if(l[e]!=Rf)try{let t=a[e];t.write&&t.write(l[e],this)}catch(t){Sd(this.state,t)}if(this.viewState.editorHeight)if(this.viewState.scrollTarget)this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,u=!0;else{let t=this.viewState.lineBlockAt(n.from).top-n.top;(t>1||t<-1)&&(this.scrollDOM.scrollTop+=t,u=!0)}if(c&&this.docView.updateSelection(!0),this.viewport.from==s.from&&this.viewport.to==s.to&&!u&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let t of this.state.facet(vd))t(e)}get themeClasses(){return vf+" "+(this.state.facet(gf)?bf:yf)+" "+this.state.facet(mf)}updateAttrs(){let t=Qf(this,Cd,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(kd)?"true":"false",class:"cm-content",style:`${zu.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),Qf(this,_d,e);let i=this.observer.ignore((()=>{let i=Ju(this.contentDOM,this.contentAttrs,e),s=Ju(this.dom,this.editorAttrs,t);return i||s}));return this.editorAttrs=t,this.contentAttrs=e,i}showAnnouncements(t){let e=!0;for(let i of t)for(let t of i.effects)t.is(Cf.announce)&&(e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=t.value)}mountStyles(){this.styleModules=this.state.facet(Ld),Gc.mount(this.root,this.styleModules.concat(wf).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame((()=>this.measure()))),t){if(null!=t.key)for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key)return void(this.measureRequests[e]=t);this.measureRequests.push(t)}}plugin(t){let e=this.pluginMap.get(t);return(void 0===e||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find((e=>e.spec==t))||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return yp(this,t,vp(this,t,e,i))}moveByGroup(t,e){return yp(this,t,vp(this,t,e,(e=>function(t,e,i){let s=t.state.charCategorizer(e),n=s(i);return t=>{let e=s(t);return n==xc.Space&&(n=e),n==e}}(this,t.head,e))))}moveToLineBoundary(t,e,i=!0){return function(t,e,i,s){let n=t.state.doc.lineAt(e.head),r=s&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head):null;if(r){let e=t.dom.getBoundingClientRect(),s=t.textDirectionAt(n.from),o=t.posAtCoords({x:i==(s==Dd.LTR)?e.right-1:e.left+1,y:(r.top+r.bottom)/2});if(null!=o)return Qh.cursor(o,i?-1:1)}let o=ld.find(t.docView,e.head),a=o?i?o.posAtEnd:o.posAtStart:i?n.to:n.from;return Qh.cursor(a,i?-1:1)}(this,t,e,i)}moveVertically(t,e,i){return yp(this,t,function(t,e,i,s){let n=e.head,r=i?1:-1;if(n==(i?t.state.doc.length:0))return Qh.cursor(n,e.assoc);let o,a=e.goalColumn,l=t.contentDOM.getBoundingClientRect(),h=t.coordsAtPos(n),c=t.documentTop;if(h)null==a&&(a=h.left-l.left),o=r<0?h.top:h.bottom;else{let e=t.viewState.lineBlockAt(n);null==a&&(a=Math.min(l.right-l.left,t.defaultCharacterWidth*(n-e.from))),o=(r<0?e.top:e.bottom)+c}let u=l.left+a,d=null!=s?s:t.defaultLineHeight>>1;for(let i=0;;i+=10){let s=o+(d+i)*r,h=mp(t,{x:u,y:s},!1,r);if(s<l.top||s>l.bottom||(r<0?h<n:h>n))return Qh.cursor(h,e.assoc,void 0,a)}}(this,t,e,i))}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),mp(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s);return du(i,n[Zd.find(n,t-s.from,-1,e)].dir==Dd.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(t){return!this.state.facet(bd)||t<this.viewport.from||t>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(t))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>_f)return Wd(t.length);let e=this.textDirectionAt(t.from);for(let i of this.bidiCache)if(i.from==t.from&&i.dir==e)return i.order;let i=function(t,e){let i=t.length,s=e==Ud?1:2,n=e==Ud?2:1;if(!t||1==s&&!Gd.test(t))return Wd(i);for(let e=0,n=s,r=s;e<i;e++){let i=jd(t.charCodeAt(e));512==i?i=n:8==i&&4==r&&(i=16),qd[e]=4==i?2:i,7&i&&(r=i),n=i}for(let t=0,e=s,n=s;t<i;t++){let s=qd[t];if(128==s)t<i-1&&e==qd[t+1]&&24&e?s=qd[t]=e:qd[t]=256;else if(64==s){let s=t+1;for(;s<i&&64==qd[s];)s++;let r=t&&8==e||s<i&&8==qd[s]?1==n?1:8:256;for(let e=t;e<s;e++)qd[e]=r;t=s-1}else 8==s&&1==n&&(qd[t]=1);e=s,7&s&&(n=s)}for(let e,r,o,a=0,l=0,h=0;a<i;a++)if(r=$d[e=t.charCodeAt(a)])if(r<0){for(let t=l-3;t>=0;t-=3)if(Xd[t+1]==-r){let e=Xd[t+2],i=2&e?s:4&e?1&e?n:s:0;i&&(qd[a]=qd[Xd[t]]=i),l=t;break}}else{if(189==Xd.length)break;Xd[l++]=a,Xd[l++]=e,Xd[l++]=h}else if(2==(o=qd[a])||1==o){let t=o==s;h=t?0:1;for(let e=l-3;e>=0;e-=3){let i=Xd[e+2];if(2&i)break;if(t)Xd[e+2]|=2;else{if(4&i)break;Xd[e+2]|=4}}}for(let t=0;t<i;t++)if(256==qd[t]){let e=t+1;for(;e<i&&256==qd[e];)e++;let n=1==(t?qd[t-1]:s),r=n==(1==(e<i?qd[e]:s))?n?1:2:s;for(let i=t;i<e;i++)qd[i]=r;t=e-1}let r=[];if(1==s)for(let t=0;t<i;){let e=t,s=1!=qd[t++];for(;t<i&&s==(1!=qd[t]);)t++;if(s)for(let i=t;i>e;){let t=i,s=2!=qd[--i];for(;i>e&&s==(2!=qd[i-1]);)i--;r.push(new Zd(i,t,s?2:1))}else r.push(new Zd(e,t,0))}else for(let t=0;t<i;){let e=t,s=2==qd[t++];for(;t<i&&s==(2==qd[t]);)t++;r.push(new Zd(e,t,s?1:2))}return r}(t.text,e);return this.bidiCache.push(new Ef(t.from,t.to,e,i)),i}get hasFocus(){var t;return(this.dom.ownerDocument.hasFocus()||zu.safari&&(null===(t=this.inputState)||void 0===t?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{vu(this.contentDOM),this.docView.updateSelection()}))}setRoot(t){this._root!=t&&(this._root=t,this.observer.setWindow((9==t.nodeType?t:t.ownerDocument).defaultView||window),this.mountStyles())}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return wd.of(new Od("number"==typeof t?Qh.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return Md.define((()=>({})),{eventHandlers:t})}static theme(t,e){let i=Gc.newName(),s=[mf.of(i),Ld.of(Of(`.${i}`,t))];return e&&e.dark&&s.push(gf.of(!0)),s}static baseTheme(t){return Wh.lowest(Ld.of(Of("."+vf,t,xf)))}static findFromDOM(t){var e;let i=t.querySelector(".cm-content"),s=i&&Su.get(i)||Su.get(t);return(null===(e=null==s?void 0:s.rootView)||void 0===e?void 0:e.view)||null}}Cf.styleModule=Ld,Cf.inputHandler=yd,Cf.perLineTextDirection=bd,Cf.exceptionSink=gd,Cf.updateListener=vd,Cf.editable=kd,Cf.mouseSelectionStyle=md,Cf.dragMovesSelection=fd,Cf.clickAddsSelectionRange=pd,Cf.decorations=Rd,Cf.atomicRanges=Ed,Cf.scrollMargins=Qd,Cf.darkTheme=gf,Cf.contentAttributes=_d,Cf.editorAttributes=Cd,Cf.lineWrapping=Cf.contentAttributes.of({class:"cm-lineWrapping"}),Cf.announce=dc.define();const _f=4096,Rf={};class Ef{constructor(t,e,i,s){this.from=t,this.to=e,this.dir=i,this.order=s}static update(t,e){if(e.empty)return t;let i=[],s=t.length?t[t.length-1].dir:Dd.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let r=t[n];r.dir!=s||e.touchesRange(r.from,r.to)||i.push(new Ef(e.mapPos(r.from,1),e.mapPos(r.to,-1),r.dir,r.order))}return i}}function Qf(t,e,i){for(let s=t.state.facet(e),n=s.length-1;n>=0;n--){let e=s[n],r="function"==typeof e?e(t):e;r&&Yu(r,i)}return i}const Lf=zu.mac?"mac":zu.windows?"win":zu.linux?"linux":"key";function Ff(t,e,i){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),!1!==i&&e.shiftKey&&(t="Shift-"+t),t}const If=Wh.default(Cf.domEventHandlers({keydown:(t,e)=>function(t,e,i,s){let n=function(t){var e=!(tu&&(t.ctrlKey||t.altKey||t.metaKey)||Jc&&t.shiftKey&&t.key&&1==t.key.length||"Unidentified"==t.key)&&t.key||(t.shiftKey?Hc:Wc)[t.keyCode]||t.key||"Unidentified";return"Esc"==e&&(e="Escape"),"Del"==e&&(e="Delete"),"Left"==e&&(e="ArrowLeft"),"Up"==e&&(e="ArrowUp"),"Right"==e&&(e="ArrowRight"),"Down"==e&&(e="ArrowDown"),e}(e),r=Oh(bh(n,0))==n.length&&" "!=n,o="",a=!1;zf&&zf.view==i&&zf.scope==s&&(o=zf.prefix+" ",(a=wp.indexOf(e.keyCode)<0)&&(zf=null));let l,h,c=new Set,u=t=>{if(t){for(let s of t.run)if(!c.has(s)&&(c.add(s),s(i,e)))return!0;t.preventDefault&&(a=!0)}return!1},d=t[s];if(d){if(u(d[o+Ff(n,e,!r)]))return!0;if(r&&(e.altKey||e.metaKey||e.ctrlKey)&&(l=Wc[e.keyCode])&&l!=n){if(u(d[o+Ff(l,e,!0)]))return!0;if(e.shiftKey&&(h=Hc[e.keyCode])!=n&&h!=l&&u(d[o+Ff(h,e,!1)]))return!0}else if(r&&e.shiftKey&&u(d[o+Ff(n,e,!0)]))return!0;if(u(d._any))return!0}return a}(function(t){let e=t.facet(Df),i=Uf.get(e);return i||Uf.set(e,i=function(t,e=Lf){let i=Object.create(null),s=Object.create(null),n=(t,e)=>{let i=s[t];if(null==i)s[t]=e;else if(i!=e)throw new Error("Key binding "+t+" is used both as a regular binding and as a multi-stroke prefix")},r=(t,s,r,o)=>{var a,l;let h=i[t]||(i[t]=Object.create(null)),c=s.split(/ (?!$)/).map((t=>function(t,e){const i=t.split(/-(?!$)/);let s,n,r,o,a=i[i.length-1];"Space"==a&&(a=" ");for(let t=0;t<i.length-1;++t){const a=i[t];if(/^(cmd|meta|m)$/i.test(a))o=!0;else if(/^a(lt)?$/i.test(a))s=!0;else if(/^(c|ctrl|control)$/i.test(a))n=!0;else if(/^s(hift)?$/i.test(a))r=!0;else{if(!/^mod$/i.test(a))throw new Error("Unrecognized modifier name: "+a);"mac"==e?o=!0:n=!0}}return s&&(a="Alt-"+a),n&&(a="Ctrl-"+a),o&&(a="Meta-"+a),r&&(a="Shift-"+a),a}(t,e)));for(let e=1;e<c.length;e++){let i=c.slice(0,e).join(" ");n(i,!0),h[i]||(h[i]={preventDefault:!0,run:[e=>{let s=zf={view:e,prefix:i,scope:t};return setTimeout((()=>{zf==s&&(zf=null)}),Nf),!0}]})}let u=c.join(" ");n(u,!1);let d=h[u]||(h[u]={preventDefault:!1,run:(null===(l=null===(a=h._any)||void 0===a?void 0:a.run)||void 0===l?void 0:l.slice())||[]});r&&d.run.push(r),o&&(d.preventDefault=!0)};for(let s of t){let t=s.scope?s.scope.split(" "):["editor"];if(s.any)for(let e of t){let t=i[e]||(i[e]=Object.create(null));t._any||(t._any={preventDefault:!1,run:[]});for(let e in t)t[e].run.push(s.any)}let n=s[e]||s.key;if(n)for(let e of t)r(e,n,s.run,s.preventDefault),s.shift&&r(e,"Shift-"+n,s.shift,s.preventDefault)}return i}(e.reduce(((t,e)=>t.concat(e)),[]))),i}(e.state),t,e,"editor")})),Df=Ih.define({enables:If}),Uf=new WeakMap;let zf=null;const Nf=4e3;class Vf{constructor(t,e,i,s,n){this.className=t,this.left=e,this.top=i,this.width=s,this.height=n}draw(){let t=document.createElement("div");return t.className=this.className,this.adjust(t),t}update(t,e){return e.className==this.className&&(this.adjust(t),!0)}adjust(t){t.style.left=this.left+"px",t.style.top=this.top+"px",this.width>=0&&(t.style.width=this.width+"px"),t.style.height=this.height+"px"}eq(t){return this.left==t.left&&this.top==t.top&&this.width==t.width&&this.height==t.height&&this.className==t.className}}class Bf{constructor(t,e){this.view=t,this.layer=e,this.drawn=[],this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=t.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),e.above&&this.dom.classList.add("cm-layer-above"),e.class&&this.dom.classList.add(e.class),this.dom.setAttribute("aria-hidden","true"),this.setOrder(t.state),t.requestMeasure(this.measureReq),e.mount&&e.mount(this.dom,t)}update(t){t.startState.facet($f)!=t.state.facet($f)&&this.setOrder(t.state),(this.layer.update(t,this.dom)||t.geometryChanged)&&t.view.requestMeasure(this.measureReq)}setOrder(t){let e=0,i=t.facet($f);for(;e<i.length&&i[e]!=this.layer;)e++;this.dom.style.zIndex=String((this.layer.above?150:-1)-e)}measure(){return this.layer.markers(this.view)}draw(t){if(t.length!=this.drawn.length||t.some(((t,e)=>!function(t,e){return t.constructor==e.constructor&&t.eq(e)}(t,this.drawn[e])))){let e=this.dom.firstChild,i=0;for(let s of t)s.update&&e&&s.constructor&&this.drawn[i].constructor&&s.update(e,this.drawn[i])?(e=e.nextSibling,i++):this.dom.insertBefore(s.draw(),e);for(;e;){let t=e.nextSibling;e.remove(),e=t}this.drawn=t}}destroy(){this.dom.remove()}}const $f=Ih.define();function Xf(t){return[Md.define((e=>new Bf(e,t))),$f.of(t)]}const jf=!zu.ios,Gf=Ih.define({combine:t=>Ac(t,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(t,e)=>Math.min(t,e),drawRangeCursor:(t,e)=>t||e})});function Zf(t={}){return[Gf.of(t),Wf,Yf,Jf,xd.of(!0)]}function qf(t){return t.startState.facet(Gf)!=t.startState.facet(Gf)}const Wf=Xf({above:!0,markers(t){let{state:e}=t,i=e.facet(Gf),s=[];for(let n of e.selection.ranges){let r=n==e.selection.main;if(n.empty?!r||jf:i.drawRangeCursor){let e=sm(t,n,r);e&&s.push(e)}}return s},update(t,e){t.transactions.some((t=>t.scrollIntoView))&&(e.style.animationName="cm-blink"==e.style.animationName?"cm-blink2":"cm-blink");let i=qf(t);return i&&Hf(t.state,e),t.docChanged||t.selectionSet||i},mount(t,e){Hf(e.state,t)},class:"cm-cursorLayer"});function Hf(t,e){e.style.animationDuration=t.facet(Gf).cursorBlinkRate+"ms"}const Yf=Xf({above:!1,markers:t=>t.state.selection.ranges.map((e=>e.empty?[]:function(t,e){if(e.to<=t.viewport.from||e.from>=t.viewport.to)return[];let i=Math.max(e.from,t.viewport.from),s=Math.min(e.to,t.viewport.to),n=t.textDirection==Dd.LTR,r=t.contentDOM,o=r.getBoundingClientRect(),a=tm(t),l=window.getComputedStyle(r.firstChild),h=o.left+parseInt(l.paddingLeft)+Math.min(0,parseInt(l.textIndent)),c=o.right-parseInt(l.paddingRight),u=im(t,i),d=im(t,s),p=u.type==ed.Text?u:null,f=d.type==ed.Text?d:null;if(t.lineWrapping&&(p&&(p=em(t,i,p)),f&&(f=em(t,s,f))),p&&f&&p.from==f.from)return g(v(e.from,e.to,p));{let i=p?v(e.from,null,p):y(u,!1),s=f?v(null,e.to,f):y(d,!0),n=[];return(p||u).to<(f||d).from-1?n.push(m(h,i.bottom,c,s.top)):i.bottom<s.top&&t.elementAtHeight((i.bottom+s.top)/2).type==ed.Text&&(i.bottom=s.top=(i.bottom+s.top)/2),g(i).concat(n).concat(g(s))}function m(t,e,i,s){return new Vf("cm-selectionBackground",t-a.left,e-a.top-.01,i-t,s-e+.01)}function g({top:t,bottom:e,horizontal:i}){let s=[];for(let n=0;n<i.length;n+=2)s.push(m(i[n],t,i[n+1],e));return s}function v(e,i,s){let r=1e9,o=-1e9,a=[];function l(e,i,l,u,d){let p=t.coordsAtPos(e,e==s.to?-2:2),f=t.coordsAtPos(l,l==s.from?2:-2);r=Math.min(p.top,f.top,r),o=Math.max(p.bottom,f.bottom,o),d==Dd.LTR?a.push(n&&i?h:p.left,n&&u?c:f.right):a.push(!n&&u?h:f.left,!n&&i?c:p.right)}let u=null!=e?e:s.from,d=null!=i?i:s.to;for(let s of t.visibleRanges)if(s.to>u&&s.from<d)for(let n=Math.max(s.from,u),r=Math.min(s.to,d);;){let s=t.state.doc.lineAt(n);for(let o of t.bidiSpans(s)){let t=o.from+s.from,a=o.to+s.from;if(t>=r)break;a>n&&l(Math.max(t,n),null==e&&t<=u,Math.min(a,r),null==i&&a>=d,o.dir)}if((n=s.to+1)>=r)break}return 0==a.length&&l(u,null==e,d,null==i,t.textDirection),{top:r,bottom:o,horizontal:a}}function y(t,e){let i=o.top+(e?t.top:t.bottom);return{top:i,bottom:i,horizontal:[]}}}(t,e))).reduce(((t,e)=>t.concat(e))),update:(t,e)=>t.docChanged||t.selectionSet||t.viewportChanged||qf(t),class:"cm-selectionLayer"}),Kf={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};jf&&(Kf[".cm-line"].caretColor="transparent !important");const Jf=Wh.highest(Cf.theme(Kf));function tm(t){let e=t.scrollDOM.getBoundingClientRect();return{left:(t.textDirection==Dd.LTR?e.left:e.right-t.scrollDOM.clientWidth)-t.scrollDOM.scrollLeft,top:e.top-t.scrollDOM.scrollTop}}function em(t,e,i){let s=Qh.cursor(e);return{from:Math.max(i.from,t.moveToLineBoundary(s,!1,!0).from),to:Math.min(i.to,t.moveToLineBoundary(s,!0,!0).from),type:ed.Text}}function im(t,e){let i=t.lineBlockAt(e);if(Array.isArray(i.type))for(let t of i.type)if(t.to>e||t.to==e&&(t.to==i.to||t.type==ed.Text))return t;return i}function sm(t,e,i){let s=t.coordsAtPos(e.head,e.assoc||1);if(!s)return null;let n=tm(t);return new Vf(i?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",s.left-n.left,s.top-n.top,-1,s.bottom-s.top)}const nm=dc.define({map:(t,e)=>null==t?null:e.mapPos(t)}),rm=$h.define({create:()=>null,update:(t,e)=>(null!=t&&(t=e.changes.mapPos(t)),e.effects.reduce(((t,e)=>e.is(nm)?e.value:t),t))});function om(t,e,i,s,n){e.lastIndex=0;for(let r,o=t.iterRange(i,s),a=i;!o.next().done;a+=o.value.length)if(!o.lineBreak)for(;r=e.exec(o.value);)n(a+r.index,r)}Md.fromClass(class{constructor(t){this.view=t,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(t){var e;let i=t.state.field(rm);null==i?null!=this.cursor&&(null===(e=this.cursor)||void 0===e||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(t.startState.field(rm)!=i||t.docChanged||t.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let t=this.view.state.field(rm),e=null!=t&&this.view.coordsAtPos(t);if(!e)return null;let i=this.view.scrollDOM.getBoundingClientRect();return{left:e.left-i.left+this.view.scrollDOM.scrollLeft,top:e.top-i.top+this.view.scrollDOM.scrollTop,height:e.bottom-e.top}}drawCursor(t){this.cursor&&(t?(this.cursor.style.left=t.left+"px",this.cursor.style.top=t.top+"px",this.cursor.style.height=t.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(t){this.view.state.field(rm)!=t&&this.view.dispatch({effects:nm.of(t)})}},{eventHandlers:{dragover(t){this.setDropPos(this.view.posAtCoords({x:t.clientX,y:t.clientY}))},dragleave(t){t.target!=this.view.contentDOM&&this.view.contentDOM.contains(t.relatedTarget)||this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});class am{constructor(t){const{regexp:e,decoration:i,decorate:s,boundary:n,maxLength:r=1e3}=t;if(!e.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=e,s)this.addMatch=(t,e,i,n)=>s(n,i,i+t[0].length,t,e);else if("function"==typeof i)this.addMatch=(t,e,s,n)=>{let r=i(t,e,s);r&&n(s,s+t[0].length,r)};else{if(!i)throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.addMatch=(t,e,s,n)=>n(s,s+t[0].length,i)}this.boundary=n,this.maxLength=r}createDeco(t){let e=new Rc,i=e.add.bind(e);for(let{from:e,to:s}of function(t,e){let i=t.visibleRanges;if(1==i.length&&i[0].from==t.viewport.from&&i[0].to==t.viewport.to)return i;let s=[];for(let{from:n,to:r}of i)n=Math.max(t.state.doc.lineAt(n).from,n-e),r=Math.min(t.state.doc.lineAt(r).to,r+e),s.length&&s[s.length-1].to>=n?s[s.length-1].to=r:s.push({from:n,to:r});return s}(t,this.maxLength))om(t.state.doc,this.regexp,e,s,((e,s)=>this.addMatch(s,t,e,i)));return e.finish()}updateDeco(t,e){let i=1e9,s=-1;return t.docChanged&&t.changes.iterChanges(((e,n,r,o)=>{o>t.view.viewport.from&&r<t.view.viewport.to&&(i=Math.min(r,i),s=Math.max(o,s))})),t.viewportChanged||s-i>1e3?this.createDeco(t.view):s>-1?this.updateRange(t.view,e.map(t.changes),i,s):e}updateRange(t,e,i,s){for(let n of t.visibleRanges){let r=Math.max(n.from,i),o=Math.min(n.to,s);if(o>r){let i=t.state.doc.lineAt(r),s=i.to<o?t.state.doc.lineAt(o):i,a=Math.max(n.from,i.from),l=Math.min(n.to,s.to);if(this.boundary){for(;r>i.from;r--)if(this.boundary.test(i.text[r-1-i.from])){a=r;break}for(;o<s.to;o++)if(this.boundary.test(s.text[o-s.from])){l=o;break}}let h,c=[],u=(t,e,i)=>c.push(i.range(t,e));if(i==s)for(this.regexp.lastIndex=a-i.from;(h=this.regexp.exec(i.text))&&h.index<l-i.from;)this.addMatch(h,t,h.index+i.from,u);else om(t.state.doc,this.regexp,a,l,((e,i)=>this.addMatch(i,t,e,u)));e=e.update({filterFrom:a,filterTo:l,filter:(t,e)=>t<a||e>l,add:c})}}return e}}const lm=null!=/x/.unicode?"gu":"g",hm=new RegExp("[\0-\b\n--\u2028\u2029\ufeff-]",lm),cm={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let um=null;const dm=Ih.define({combine(t){let e=Ac(t,{render:null,specialChars:hm,addSpecialChars:null});return(e.replaceTabs=!function(){var t;if(null==um&&"undefined"!=typeof document&&document.body){let e=document.body.style;um=null!=(null!==(t=e.tabSize)&&void 0!==t?t:e.MozTabSize)}return um||!1}())&&(e.specialChars=new RegExp("\t|"+e.specialChars.source,lm)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,lm)),e}});function pm(t={}){return[dm.of(t),fm||(fm=Md.fromClass(class{constructor(t){this.view=t,this.decorations=id.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(t.state.facet(dm)),this.decorations=this.decorator.createDeco(t)}makeDecorator(t){return new am({regexp:t.specialChars,decoration:(e,i,s)=>{let{doc:n}=i.state,r=bh(e[0],0);if(9==r){let t=n.lineAt(s),e=i.state.tabSize,r=Bc(t.text,e,s-t.from);return id.replace({widget:new gm((e-r%e)*this.view.defaultCharacterWidth)})}return this.decorationCache[r]||(this.decorationCache[r]=id.replace({widget:new mm(t,r)}))},boundary:t.replaceTabs?void 0:/[^]/})}update(t){let e=t.state.facet(dm);t.startState.facet(dm)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(t.view)):this.decorations=this.decorator.updateDeco(t,this.decorations)}},{decorations:t=>t.decorations}))]}let fm=null;class mm extends td{constructor(t,e){super(),this.options=t,this.code=e}eq(t){return t.code==this.code}toDOM(t){let e=function(t){return t>=32?"":10==t?"":String.fromCharCode(9216+t)}(this.code),i=t.state.phrase("Control character")+" "+(cm[this.code]||"0x"+this.code.toString(16)),s=this.options.render&&this.options.render(this.code,i,e);if(s)return s;let n=document.createElement("span");return n.textContent=e,n.title=i,n.setAttribute("aria-label",i),n.className="cm-specialChar",n}ignoreEvent(){return!1}}class gm extends td{constructor(t){super(),this.width=t}eq(t){return t.width==this.width}toDOM(){let t=document.createElement("span");return t.textContent="\t",t.className="cm-tab",t.style.width=this.width+"px",t}ignoreEvent(){return!1}}Md.fromClass(class{constructor(){this.height=1e3,this.attrs={style:"padding-bottom: 1000px"}}update(t){let{view:e}=t,i=e.viewState.editorHeight-e.defaultLineHeight-e.documentPadding.top-.5;i!=this.height&&(this.height=i,this.attrs={style:`padding-bottom: ${i}px`})}});const vm=id.line({class:"cm-activeLine"});Md.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.docChanged||t.selectionSet)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=-1,i=[];for(let s of t.state.selection.ranges){let n=t.lineBlockAt(s.head);n.from>e&&(i.push(vm.range(n.from)),e=n.from)}return id.set(i)}},{decorations:t=>t.decorations});const ym="-10000px";class bm{constructor(t,e,i){this.facet=e,this.createTooltipView=i,this.input=t.state.facet(e),this.tooltips=this.input.filter((t=>t)),this.tooltipViews=this.tooltips.map(i)}update(t){var e;let i=t.state.facet(this.facet),s=i.filter((t=>t));if(i===this.input){for(let e of this.tooltipViews)e.update&&e.update(t);return!1}let n=[];for(let e=0;e<s.length;e++){let i=s[e],r=-1;if(i){for(let t=0;t<this.tooltips.length;t++){let e=this.tooltips[t];e&&e.create==i.create&&(r=t)}if(r<0)n[e]=this.createTooltipView(i);else{let i=n[e]=this.tooltipViews[r];i.update&&i.update(t)}}}for(let t of this.tooltipViews)n.indexOf(t)<0&&(t.dom.remove(),null===(e=t.destroy)||void 0===e||e.call(t));return this.input=i,this.tooltips=s,this.tooltipViews=n,!0}}function xm(t){let{win:e}=t;return{top:0,left:0,bottom:e.innerHeight,right:e.innerWidth}}const Om=Ih.define({combine:t=>{var e,i,s;return{position:zu.ios?"absolute":(null===(e=t.find((t=>t.position)))||void 0===e?void 0:e.position)||"fixed",parent:(null===(i=t.find((t=>t.parent)))||void 0===i?void 0:i.parent)||null,tooltipSpace:(null===(s=t.find((t=>t.tooltipSpace)))||void 0===s?void 0:s.tooltipSpace)||xm}}}),wm=Md.fromClass(class{constructor(t){this.view=t,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let e=t.state.facet(Om);this.position=e.position,this.parent=e.parent,this.classes=t.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new bm(t,Am,(t=>this.createTooltip(t))),this.intersectionObserver="function"==typeof IntersectionObserver?new IntersectionObserver((t=>{Date.now()>this.lastTransaction-50&&t.length>0&&t[t.length-1].intersectionRatio<1&&this.measureSoon()}),{threshold:[1]}):null,this.observeIntersection(),t.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let t of this.manager.tooltipViews)this.intersectionObserver.observe(t.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout((()=>{this.measureTimeout=-1,this.maybeMeasure()}),50))}update(t){t.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(t);e&&this.observeIntersection();let i=e||t.geometryChanged,s=t.state.facet(Om);if(s.position!=this.position){this.position=s.position;for(let t of this.manager.tooltipViews)t.dom.style.position=this.position;i=!0}if(s.parent!=this.parent){this.parent&&this.container.remove(),this.parent=s.parent,this.createContainer();for(let t of this.manager.tooltipViews)this.container.appendChild(t.dom);i=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);i&&this.maybeMeasure()}createTooltip(t){let e=t.create(this.view);if(e.dom.classList.add("cm-tooltip"),t.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let t=document.createElement("div");t.className="cm-tooltip-arrow",e.dom.appendChild(t)}return e.dom.style.position=this.position,e.dom.style.top=ym,this.container.appendChild(e.dom),e.mount&&e.mount(this.view),e}destroy(){var t,e;this.view.win.removeEventListener("resize",this.measureSoon);for(let e of this.manager.tooltipViews)e.dom.remove(),null===(t=e.destroy)||void 0===t||t.call(e);null===(e=this.intersectionObserver)||void 0===e||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let t=this.view.dom.getBoundingClientRect();return{editor:t,parent:this.parent?this.container.getBoundingClientRect():t,pos:this.manager.tooltips.map(((t,e)=>{let i=this.manager.tooltipViews[e];return i.getCoords?i.getCoords(t.pos):this.view.coordsAtPos(t.pos)})),size:this.manager.tooltipViews.map((({dom:t})=>t.getBoundingClientRect())),space:this.view.state.facet(Om).tooltipSpace(this.view)}}writeMeasure(t){let{editor:e,space:i}=t,s=[];for(let n=0;n<this.manager.tooltips.length;n++){let r=this.manager.tooltips[n],o=this.manager.tooltipViews[n],{dom:a}=o,l=t.pos[n],h=t.size[n];if(!l||l.bottom<=Math.max(e.top,i.top)||l.top>=Math.min(e.bottom,i.bottom)||l.right<Math.max(e.left,i.left)-.1||l.left>Math.min(e.right,i.right)+.1){a.style.top=ym;continue}let c=r.arrow?o.dom.querySelector(".cm-tooltip-arrow"):null,u=c?7:0,d=h.right-h.left,p=h.bottom-h.top,f=o.offset||km,m=this.view.textDirection==Dd.LTR,g=h.width>i.right-i.left?m?i.left:i.right-h.width:m?Math.min(l.left-(c?14:0)+f.x,i.right-d):Math.max(i.left,l.left-d+(c?14:0)-f.x),v=!!r.above;!r.strictSide&&(v?l.top-(h.bottom-h.top)-f.y<i.top:l.bottom+(h.bottom-h.top)+f.y>i.bottom)&&v==i.bottom-l.bottom>l.top-i.top&&(v=!v);let y=(v?l.top-i.top:i.bottom-l.bottom)-u;if(y<p&&!1!==o.resize){if(y<this.view.defaultLineHeight){a.style.top=ym;continue}a.style.height=(p=y)+"px"}else a.style.height&&(a.style.height="");let b=v?l.top-p-u-f.y:l.bottom+u+f.y,x=g+d;if(!0!==o.overlap)for(let t of s)t.left<x&&t.right>g&&t.top<b+p&&t.bottom>b&&(b=v?t.top-p-2-u:t.bottom+u+2);"absolute"==this.position?(a.style.top=b-t.parent.top+"px",a.style.left=g-t.parent.left+"px"):(a.style.top=b+"px",a.style.left=g+"px"),c&&(c.style.left=l.left+(m?f.x:-f.x)-(g+14-7)+"px"),!0!==o.overlap&&s.push({left:g,top:b,right:x,bottom:b+p}),a.classList.toggle("cm-tooltip-above",v),a.classList.toggle("cm-tooltip-below",!v),o.positioned&&o.positioned(t.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let t of this.manager.tooltipViews)t.dom.style.top=ym}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),Sm=Cf.baseTheme({".cm-tooltip":{zIndex:100,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),km={x:0,y:0},Am=Ih.define({enables:[wm,Sm]}),Tm=Ih.define();class Mm{constructor(t){this.view=t,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new bm(t,Tm,(t=>this.createHostedView(t)))}static create(t){return new Mm(t)}createHostedView(t){let e=t.create(this.view);return e.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(e.dom),this.mounted&&e.mount&&e.mount(this.view),e}mount(t){for(let e of this.manager.tooltipViews)e.mount&&e.mount(t);this.mounted=!0}positioned(t){for(let e of this.manager.tooltipViews)e.positioned&&e.positioned(t)}update(t){this.manager.update(t)}}const Pm=Am.compute([Tm],(t=>{let e=t.facet(Tm).filter((t=>t));return 0===e.length?null:{pos:Math.min(...e.map((t=>t.pos))),end:Math.max(...e.filter((t=>null!=t.end)).map((t=>t.end))),create:Mm.create,above:e[0].above,arrow:e.some((t=>t.arrow))}}));class Cm{constructor(t,e,i,s,n){this.view=t,this.source=e,this.field=i,this.setHover=s,this.hoverTime=n,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:t.dom,time:0},this.checkHover=this.checkHover.bind(this),t.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),t.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout((()=>this.startHover()),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let t=Date.now()-this.lastMove.time;t<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-t):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{lastMove:t}=this,e=this.view.contentDOM.contains(t.target)?this.view.posAtCoords(t):null;if(null==e)return;let i=this.view.coordsAtPos(e);if(null==i||t.y<i.top||t.y>i.bottom||t.x<i.left-this.view.defaultCharacterWidth||t.x>i.right+this.view.defaultCharacterWidth)return;let s=this.view.bidiSpans(this.view.state.doc.lineAt(e)).find((t=>t.from<=e&&t.to>=e)),n=s&&s.dir==Dd.RTL?-1:1,r=this.source(this.view,e,t.x<i.left?-n:n);if(null==r?void 0:r.then){let t=this.pending={pos:e};r.then((e=>{this.pending==t&&(this.pending=null,e&&this.view.dispatch({effects:this.setHover.of(e)}))}),(t=>Sd(this.view.state,t,"hover tooltip")))}else r&&this.view.dispatch({effects:this.setHover.of(r)})}mousemove(t){var e;this.lastMove={x:t.clientX,y:t.clientY,target:t.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let i=this.active;if(i&&!_m(this.lastMove.target)||this.pending){let{pos:s}=i||this.pending,n=null!==(e=null==i?void 0:i.end)&&void 0!==e?e:s;(s==n?this.view.posAtCoords(this.lastMove)==s:function(t,e,i,s,n,r){let o=document.createRange(),a=t.domAtPos(e),l=t.domAtPos(i);o.setEnd(l.node,l.offset),o.setStart(a.node,a.offset);let h=o.getClientRects();o.detach();for(let t=0;t<h.length;t++){let e=h[t];if(Math.max(e.top-n,n-e.bottom,e.left-s,s-e.right)<=r)return!0}return!1}(this.view,s,n,t.clientX,t.clientY,6))||(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(t){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&!_m(t.relatedTarget)&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}function _m(t){for(let e=t;e;e=e.parentNode)if(1==e.nodeType&&e.classList.contains("cm-tooltip"))return!0;return!1}function Rm(t,e={}){let i=dc.define(),s=$h.define({create:()=>null,update(t,s){if(t&&(e.hideOnChange&&(s.docChanged||s.selection)||e.hideOn&&e.hideOn(s,t)))return null;if(t&&s.docChanged){let e=s.changes.mapPos(t.pos,-1,Sh.TrackDel);if(null==e)return null;let i=Object.assign(Object.create(null),t);i.pos=e,null!=t.end&&(i.end=s.changes.mapPos(t.end)),t=i}for(let e of s.effects)e.is(i)&&(t=e.value),e.is(Em)&&(t=null);return t},provide:t=>Tm.from(t)});return[s,Md.define((n=>new Cm(n,t,s,i,e.hoverTime||300))),Pm]}const Em=dc.define();Em.of(null);const Qm=Ih.define({combine(t){let e,i;for(let s of t)e=e||s.topContainer,i=i||s.bottomContainer;return{topContainer:e,bottomContainer:i}}}),Lm=Md.fromClass(class{constructor(t){this.input=t.state.facet(Dm),this.specs=this.input.filter((t=>t)),this.panels=this.specs.map((e=>e(t)));let e=t.state.facet(Qm);this.top=new Fm(t,!0,e.topContainer),this.bottom=new Fm(t,!1,e.bottomContainer),this.top.sync(this.panels.filter((t=>t.top))),this.bottom.sync(this.panels.filter((t=>!t.top)));for(let t of this.panels)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}update(t){let e=t.state.facet(Qm);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new Fm(t.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new Fm(t.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let i=t.state.facet(Dm);if(i!=this.input){let e=i.filter((t=>t)),s=[],n=[],r=[],o=[];for(let i of e){let e,a=this.specs.indexOf(i);a<0?(e=i(t.view),o.push(e)):(e=this.panels[a]).update&&e.update(t),s.push(e),(e.top?n:r).push(e)}this.specs=e,this.panels=s,this.top.sync(n),this.bottom.sync(r);for(let t of o)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}else for(let e of this.panels)e.update&&e.update(t)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:t=>Cf.scrollMargins.of((e=>{let i=e.plugin(t);return i&&{top:i.top.scrollMargin(),bottom:i.bottom.scrollMargin()}}))});class Fm{constructor(t,e,i){this.view=t,this.top=e,this.container=i,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(t){for(let e of this.panels)e.destroy&&t.indexOf(e)<0&&e.destroy();this.panels=t,this.syncDOM()}syncDOM(){if(0==this.panels.length)return void(this.dom&&(this.dom.remove(),this.dom=void 0));if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let t=this.container||this.view.dom;t.insertBefore(this.dom,this.top?t.firstChild:null)}let t=this.dom.firstChild;for(let e of this.panels)if(e.dom.parentNode==this.dom){for(;t!=e.dom;)t=Im(t);t=t.nextSibling}else this.dom.insertBefore(e.dom,t);for(;t;)t=Im(t)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(this.container&&this.classes!=this.view.themeClasses){for(let t of this.classes.split(" "))t&&this.container.classList.remove(t);for(let t of(this.classes=this.view.themeClasses).split(" "))t&&this.container.classList.add(t)}}}function Im(t){let e=t.nextSibling;return t.remove(),e}const Dm=Ih.define({enables:Lm});class Um extends Tc{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}}Um.prototype.elementClass="",Um.prototype.toDOM=void 0,Um.prototype.mapMode=Sh.TrackBefore,Um.prototype.startSide=Um.prototype.endSide=-1,Um.prototype.point=!0;const zm=Ih.define(),Nm={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>_c.empty,lineMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},Vm=Ih.define();function Bm(t){return[Xm(),Vm.of(Object.assign(Object.assign({},Nm),t))]}const $m=Ih.define({combine:t=>t.some((t=>t))});function Xm(t){let e=[jm];return t&&!1===t.fixed&&e.push($m.of(!0)),e}const jm=Md.fromClass(class{constructor(t){this.view=t,this.prevViewport=t.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=t.state.facet(Vm).map((e=>new Wm(t,e)));for(let t of this.gutters)this.dom.appendChild(t.dom);this.fixed=!t.state.facet($m),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),t.scrollDOM.insertBefore(this.dom,t.contentDOM)}update(t){if(this.updateGutters(t)){let e=this.prevViewport,i=t.view.viewport,s=Math.min(e.to,i.to)-Math.max(e.from,i.from);this.syncGutters(s<.8*(i.to-i.from))}t.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet($m)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=t.view.viewport}syncGutters(t){let e=this.dom.nextSibling;t&&this.dom.remove();let i=_c.iter(this.view.state.facet(zm),this.view.viewport.from),s=[],n=this.gutters.map((t=>new qm(t,this.view.viewport,-this.view.documentPadding.top)));for(let t of this.view.viewportLineBlocks){let e;if(Array.isArray(t.type)){for(let i of t.type)if(i.type==ed.Text){e=i;break}}else e=t.type==ed.Text?t:void 0;if(e){s.length&&(s=[]),Zm(i,s,t.from);for(let t of n)t.line(this.view,e,s)}}for(let t of n)t.finish();t&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(t){let e=t.startState.facet(Vm),i=t.state.facet(Vm),s=t.docChanged||t.heightChanged||t.viewportChanged||!_c.eq(t.startState.facet(zm),t.state.facet(zm),t.view.viewport.from,t.view.viewport.to);if(e==i)for(let e of this.gutters)e.update(t)&&(s=!0);else{s=!0;let n=[];for(let s of i){let i=e.indexOf(s);i<0?n.push(new Wm(this.view,s)):(this.gutters[i].update(t),n.push(this.gutters[i]))}for(let t of this.gutters)t.dom.remove(),n.indexOf(t)<0&&t.destroy();for(let t of n)this.dom.appendChild(t.dom);this.gutters=n}return s}destroy(){for(let t of this.gutters)t.destroy();this.dom.remove()}},{provide:t=>Cf.scrollMargins.of((e=>{let i=e.plugin(t);return i&&0!=i.gutters.length&&i.fixed?e.textDirection==Dd.LTR?{left:i.dom.offsetWidth}:{right:i.dom.offsetWidth}:null}))});function Gm(t){return Array.isArray(t)?t:[t]}function Zm(t,e,i){for(;t.value&&t.from<=i;)t.from==i&&e.push(t.value),t.next()}class qm{constructor(t,e,i){this.gutter=t,this.height=i,this.localMarkers=[],this.i=0,this.cursor=_c.iter(t.markers,e.from)}line(t,e,i){this.localMarkers.length&&(this.localMarkers=[]),Zm(this.cursor,this.localMarkers,e.from);let s=i.length?this.localMarkers.concat(i):this.localMarkers,n=this.gutter.config.lineMarker(t,e,s);n&&s.unshift(n);let r=this.gutter;if(0==s.length&&!r.config.renderEmptyElements)return;let o=e.top-this.height;if(this.i==r.elements.length){let i=new Hm(t,e.height,o,s);r.elements.push(i),r.dom.appendChild(i.dom)}else r.elements[this.i].update(t,e.height,o,s);this.height=e.bottom,this.i++}finish(){let t=this.gutter;for(;t.elements.length>this.i;){let e=t.elements.pop();t.dom.removeChild(e.dom),e.destroy()}}}class Wm{constructor(t,e){this.view=t,this.config=e,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in e.domEventHandlers)this.dom.addEventListener(i,(s=>{let n=t.lineBlockAtHeight(s.clientY-t.documentTop);e.domEventHandlers[i](t,n,s)&&s.preventDefault()}));this.markers=Gm(e.markers(t)),e.initialSpacer&&(this.spacer=new Hm(t,0,0,[e.initialSpacer(t)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(t){let e=this.markers;if(this.markers=Gm(this.config.markers(t.view)),this.spacer&&this.config.updateSpacer){let e=this.config.updateSpacer(this.spacer.markers[0],t);e!=this.spacer.markers[0]&&this.spacer.update(t.view,0,0,[e])}let i=t.view.viewport;return!_c.eq(this.markers,e,i.from,i.to)||!!this.config.lineMarkerChange&&this.config.lineMarkerChange(t)}destroy(){for(let t of this.elements)t.destroy()}}class Hm{constructor(t,e,i,s){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(t,e,i,s)}update(t,e,i,s){this.height!=e&&(this.dom.style.height=(this.height=e)+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),function(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(!t[i].compare(e[i]))return!1;return!0}(this.markers,s)||this.setMarkers(t,s)}setMarkers(t,e){let i="cm-gutterElement",s=this.dom.firstChild;for(let n=0,r=0;;){let o=r,a=n<e.length?e[n++]:null,l=!1;if(a){let t=a.elementClass;t&&(i+=" "+t);for(let t=r;t<this.markers.length;t++)if(this.markers[t].compare(a)){o=t,l=!0;break}}else o=this.markers.length;for(;r<o;){let t=this.markers[r++];if(t.toDOM){t.destroy(s);let e=s.nextSibling;s.remove(),s=e}}if(!a)break;a.toDOM&&(l?s=s.nextSibling:this.dom.insertBefore(a.toDOM(t),s)),l&&r++}this.dom.className=i,this.markers=e}destroy(){this.setMarkers(null,[])}}const Ym=Ih.define(),Km=Ih.define({combine:t=>Ac(t,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(t,e){let i=Object.assign({},t);for(let t in e){let s=i[t],n=e[t];i[t]=s?(t,e,i)=>s(t,e,i)||n(t,e,i):n}return i}})});class Jm extends Um{constructor(t){super(),this.number=t}eq(t){return this.number==t.number}toDOM(){return document.createTextNode(this.number)}}function tg(t,e){return t.state.facet(Km).formatNumber(e,t.state)}const eg=Vm.compute([Km],(t=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers:t=>t.state.facet(Ym),lineMarker:(t,e,i)=>i.some((t=>t.toDOM))?null:new Jm(tg(t,t.state.doc.lineAt(e.from).number)),lineMarkerChange:t=>t.startState.facet(Km)!=t.state.facet(Km),initialSpacer:t=>new Jm(tg(t,sg(t.state.doc.lines))),updateSpacer(t,e){let i=tg(e.view,sg(e.view.state.doc.lines));return i==t.number?t:new Jm(i)},domEventHandlers:t.facet(Km).domEventHandlers})));function ig(t={}){return[Km.of(t),Xm(),eg]}function sg(t){let e=9;for(;e<t;)e=10*e+9;return e}const ng=new class extends Um{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},rg=zm.compute(["selection"],(t=>{let e=[],i=-1;for(let s of t.selection.ranges){let n=t.doc.lineAt(s.head).from;n>i&&(i=n,e.push(ng.range(n)))}return _c.of(e)}));const og=1024;let ag=0;class lg{constructor(t,e){this.from=t,this.to=e}}class hg{constructor(t={}){this.id=ag++,this.perNode=!!t.perNode,this.deserialize=t.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(t){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof t&&(t=ug.match(t)),e=>{let i=t(e);return void 0===i?null:[this,i]}}}hg.closedBy=new hg({deserialize:t=>t.split(" ")}),hg.openedBy=new hg({deserialize:t=>t.split(" ")}),hg.group=new hg({deserialize:t=>t.split(" ")}),hg.contextHash=new hg({perNode:!0}),hg.lookAhead=new hg({perNode:!0}),hg.mounted=new hg({perNode:!0});const cg=Object.create(null);class ug{constructor(t,e,i,s=0){this.name=t,this.props=e,this.id=i,this.flags=s}static define(t){let e=t.props&&t.props.length?Object.create(null):cg,i=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(null==t.name?8:0),s=new ug(t.name||"",e,t.id,i);if(t.props)for(let i of t.props)if(Array.isArray(i)||(i=i(s)),i){if(i[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");e[i[0].id]=i[1]}return s}prop(t){return this.props[t.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(t){if("string"==typeof t){if(this.name==t)return!0;let e=this.prop(hg.group);return!!e&&e.indexOf(t)>-1}return this.id==t}static match(t){let e=Object.create(null);for(let i in t)for(let s of i.split(" "))e[s]=t[i];return t=>{for(let i=t.prop(hg.group),s=-1;s<(i?i.length:0);s++){let n=e[s<0?t.name:i[s]];if(n)return n}}}}ug.none=new ug("",Object.create(null),0,8);class dg{constructor(t){this.types=t;for(let e=0;e<t.length;e++)if(t[e].id!=e)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...t){let e=[];for(let i of this.types){let s=null;for(let e of t){let t=e(i);t&&(s||(s=Object.assign({},i.props)),s[t[0].id]=t[1])}e.push(s?new ug(i.name,s,i.id,i.flags):i)}return new dg(e)}}const pg=new WeakMap,fg=new WeakMap;var mg;!function(t){t[t.ExcludeBuffers=1]="ExcludeBuffers",t[t.IncludeAnonymous=2]="IncludeAnonymous",t[t.IgnoreMounts=4]="IgnoreMounts",t[t.IgnoreOverlays=8]="IgnoreOverlays"}(mg||(mg={}));class gg{constructor(t,e,i,s,n){if(this.type=t,this.children=e,this.positions=i,this.length=s,this.props=null,n&&n.length){this.props=Object.create(null);for(let[t,e]of n)this.props["number"==typeof t?t:t.id]=e}}toString(){let t=this.prop(hg.mounted);if(t&&!t.overlay)return t.tree.toString();let e="";for(let t of this.children){let i=t.toString();i&&(e&&(e+=","),e+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(e.length?"("+e+")":""):e}cursor(t=0){return new Mg(this.topNode,t)}cursorAt(t,e=0,i=0){let s=pg.get(this)||this.topNode,n=new Mg(s);return n.moveTo(t,e),pg.set(this,n._tree),n}get topNode(){return new wg(this,0,0,null)}resolve(t,e=0){let i=Og(pg.get(this)||this.topNode,t,e,!1);return pg.set(this,i),i}resolveInner(t,e=0){let i=Og(fg.get(this)||this.topNode,t,e,!0);return fg.set(this,i),i}iterate(t){let{enter:e,leave:i,from:s=0,to:n=this.length}=t;for(let r=this.cursor((t.mode||0)|mg.IncludeAnonymous);;){let t=!1;if(r.from<=n&&r.to>=s&&(r.type.isAnonymous||!1!==e(r))){if(r.firstChild())continue;t=!0}for(;t&&i&&!r.type.isAnonymous&&i(r),!r.nextSibling();){if(!r.parent())return;t=!0}}}prop(t){return t.perNode?this.props?this.props[t.id]:void 0:this.type.prop(t)}get propValues(){let t=[];if(this.props)for(let e in this.props)t.push([+e,this.props[e]]);return t}balance(t={}){return this.children.length<=8?this:Rg(ug.none,this.children,this.positions,0,this.children.length,0,this.length,((t,e,i)=>new gg(this.type,t,e,i,this.propValues)),t.makeTree||((t,e,i)=>new gg(ug.none,t,e,i)))}static build(t){return function(t){var e;let{buffer:i,nodeSet:s,maxBufferLength:n=og,reused:r=[],minRepeatType:o=s.types.length}=t,a=Array.isArray(i)?new vg(i,i.length):i,l=s.types,h=0,c=0;function u(t,e,i,m,g){let{id:v,start:y,end:b,size:x}=a,O=c;for(;x<0;){if(a.next(),-1==x){let e=r[v];return i.push(e),void m.push(y-t)}if(-3==x)return void(h=v);if(-4==x)return void(c=v);throw new RangeError(`Unrecognized record size: ${x}`)}let w,S,k=l[v],A=y-t;if(b-y<=n&&(S=function(t,e){let i=a.fork(),s=0,r=0,l=0,h=i.end-n,c={size:0,start:0,skip:0};t:for(let n=i.pos-t;i.pos>n;){let t=i.size;if(i.id==e&&t>=0){c.size=s,c.start=r,c.skip=l,l+=4,s+=4,i.next();continue}let a=i.pos-t;if(t<0||a<n||i.start<h)break;let u=i.id>=o?4:0,d=i.start;for(i.next();i.pos>a;){if(i.size<0){if(-3!=i.size)break t;u+=4}else i.id>=o&&(u+=4);i.next()}r=d,s+=t,l+=u}return(e<0||s==t)&&(c.size=s,c.start=r,c.skip=l),c.size>4?c:void 0}(a.pos-e,g))){let e=new Uint16Array(S.size-S.skip),i=a.pos-S.size,n=e.length;for(;a.pos>i;)n=f(S.start,e,n);w=new yg(e,b-S.start,s),A=S.start-t}else{let t=a.pos-x;a.next();let e=[],i=[],s=v>=o?v:-1,r=0,l=b;for(;a.pos>t;)s>=0&&a.id==s&&a.size>=0?(a.end<=l-n&&(d(e,i,y,r,a.end,l,s,O),r=e.length,l=a.end),a.next()):u(y,t,e,i,s);if(s>=0&&r>0&&r<e.length&&d(e,i,y,r,y,l,s,O),e.reverse(),i.reverse(),s>-1&&r>0){let t=function(t){return(e,i,s)=>{let n,r,o=0,a=e.length-1;if(a>=0&&(n=e[a])instanceof gg){if(!a&&n.type==t&&n.length==s)return n;(r=n.prop(hg.lookAhead))&&(o=i[a]+n.length+r)}return p(t,e,i,s,o)}}(k);w=Rg(k,e,i,0,e.length,0,b-y,t,t)}else w=p(k,e,i,b-y,O-b)}i.push(w),m.push(A)}function d(t,e,i,n,r,o,a,l){let h=[],c=[];for(;t.length>n;)h.push(t.pop()),c.push(e.pop()+i-r);t.push(p(s.types[a],h,c,o-r,l-o)),e.push(r-i)}function p(t,e,i,s,n=0,r){if(h){let t=[hg.contextHash,h];r=r?[t].concat(r):[t]}if(n>25){let t=[hg.lookAhead,n];r=r?[t].concat(r):[t]}return new gg(t,e,i,s,r)}function f(t,e,i){let{id:s,start:n,end:r,size:l}=a;if(a.next(),l>=0&&s<o){let o=i;if(l>4){let s=a.pos-(l-4);for(;a.pos>s;)i=f(t,e,i)}e[--i]=o,e[--i]=r-t,e[--i]=n-t,e[--i]=s}else-3==l?h=s:-4==l&&(c=s);return i}let m=[],g=[];for(;a.pos>0;)u(t.start||0,t.bufferStart||0,m,g,-1);let v=null!==(e=t.length)&&void 0!==e?e:m.length?g[0]+m[0].length:0;return new gg(l[t.topID],m.reverse(),g.reverse(),v)}(t)}}gg.empty=new gg(ug.none,[],[],0);class vg{constructor(t,e){this.buffer=t,this.index=e}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new vg(this.buffer,this.index)}}class yg{constructor(t,e,i){this.buffer=t,this.length=e,this.set=i}get type(){return ug.none}toString(){let t=[];for(let e=0;e<this.buffer.length;)t.push(this.childString(e)),e=this.buffer[e+3];return t.join(",")}childString(t){let e=this.buffer[t],i=this.buffer[t+3],s=this.set.types[e],n=s.name;if(/\W/.test(n)&&!s.isError&&(n=JSON.stringify(n)),i==(t+=4))return n;let r=[];for(;t<i;)r.push(this.childString(t)),t=this.buffer[t+3];return n+"("+r.join(",")+")"}findChild(t,e,i,s,n){let{buffer:r}=this,o=-1;for(let a=t;a!=e&&!(bg(n,s,r[a+1],r[a+2])&&(o=a,i>0));a=r[a+3]);return o}slice(t,e,i){let s=this.buffer,n=new Uint16Array(e-t),r=0;for(let o=t,a=0;o<e;){n[a++]=s[o++],n[a++]=s[o++]-i;let e=n[a++]=s[o++]-i;n[a++]=s[o++]-t,r=Math.max(r,e)}return new yg(n,r,this.set)}}function bg(t,e,i,s){switch(t){case-2:return i<e;case-1:return s>=e&&i<e;case 0:return i<e&&s>e;case 1:return i<=e&&s>e;case 2:return s>e;case 4:return!0}}function xg(t,e){let i=t.childBefore(e);for(;i;){let e=i.lastChild;if(!e||e.to!=i.to)break;e.type.isError&&e.from==e.to?(t=i,i=e.prevSibling):i=e}return t}function Og(t,e,i,s){for(var n;t.from==t.to||(i<1?t.from>=e:t.from>e)||(i>-1?t.to<=e:t.to<e);){let e=!s&&t instanceof wg&&t.index<0?null:t.parent;if(!e)return t;t=e}let r=s?0:mg.IgnoreOverlays;if(s)for(let s=t,o=s.parent;o;o=(s=o).parent)s instanceof wg&&s.index<0&&(null===(n=o.enter(e,i,r))||void 0===n?void 0:n.from)!=s.from&&(t=o);for(;;){let s=t.enter(e,i,r);if(!s)return t;t=s}}class wg{constructor(t,e,i,s){this._tree=t,this.from=e,this.index=i,this._parent=s}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(t,e,i,s,n=0){for(let r=this;;){for(let{children:o,positions:a}=r._tree,l=e>0?o.length:-1;t!=l;t+=e){let l=o[t],h=a[t]+r.from;if(bg(s,i,h,h+l.length))if(l instanceof yg){if(n&mg.ExcludeBuffers)continue;let o=l.findChild(0,l.buffer.length,e,i-h,s);if(o>-1)return new Tg(new Ag(r,l,t,h),null,o)}else if(n&mg.IncludeAnonymous||!l.type.isAnonymous||Pg(l)){let o;if(!(n&mg.IgnoreMounts)&&l.props&&(o=l.prop(hg.mounted))&&!o.overlay)return new wg(o.tree,h,t,r);let a=new wg(l,h,t,r);return n&mg.IncludeAnonymous||!a.type.isAnonymous?a:a.nextChild(e<0?l.children.length-1:0,e,i,s)}}if(n&mg.IncludeAnonymous||!r.type.isAnonymous)return null;if(t=r.index>=0?r.index+e:e<0?-1:r._parent._tree.children.length,!(r=r._parent))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(t){return this.nextChild(0,1,t,2)}childBefore(t){return this.nextChild(this._tree.children.length-1,-1,t,-2)}enter(t,e,i=0){let s;if(!(i&mg.IgnoreOverlays)&&(s=this._tree.prop(hg.mounted))&&s.overlay){let i=t-this.from;for(let{from:t,to:n}of s.overlay)if((e>0?t<=i:t<i)&&(e<0?n>=i:n>i))return new wg(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,t,e,i)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t._parent;)t=t._parent;return t}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(t=0){return new Mg(this,t)}get tree(){return this._tree}toTree(){return this._tree}resolve(t,e=0){return Og(this,t,e,!1)}resolveInner(t,e=0){return Og(this,t,e,!0)}enterUnfinishedNodesBefore(t){return xg(this,t)}getChild(t,e=null,i=null){let s=Sg(this,t,e,i);return s.length?s[0]:null}getChildren(t,e=null,i=null){return Sg(this,t,e,i)}toString(){return this._tree.toString()}get node(){return this}matchContext(t){return kg(this,t)}}function Sg(t,e,i,s){let n=t.cursor(),r=[];if(!n.firstChild())return r;if(null!=i)for(;!n.type.is(i);)if(!n.nextSibling())return r;for(;;){if(null!=s&&n.type.is(s))return r;if(n.type.is(e)&&r.push(n.node),!n.nextSibling())return null==s?r:[]}}function kg(t,e,i=e.length-1){for(let s=t.parent;i>=0;s=s.parent){if(!s)return!1;if(!s.type.isAnonymous){if(e[i]&&e[i]!=s.name)return!1;i--}}return!0}class Ag{constructor(t,e,i,s){this.parent=t,this.buffer=e,this.index=i,this.start=s}}class Tg{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(t,e,i){this.context=t,this._parent=e,this.index=i,this.type=t.buffer.set.types[t.buffer.buffer[i]]}child(t,e,i){let{buffer:s}=this.context,n=s.findChild(this.index+4,s.buffer[this.index+3],t,e-this.context.start,i);return n<0?null:new Tg(this.context,this,n)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(t){return this.child(1,t,2)}childBefore(t){return this.child(-1,t,-2)}enter(t,e,i=0){if(i&mg.ExcludeBuffers)return null;let{buffer:s}=this.context,n=s.findChild(this.index+4,s.buffer[this.index+3],e>0?1:-1,t-this.context.start,e);return n<0?null:new Tg(this.context,this,n)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,0,4)}get nextSibling(){let{buffer:t}=this.context,e=t.buffer[this.index+3];return e<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length)?new Tg(this.context,this._parent,e):this.externalSibling(1)}get prevSibling(){let{buffer:t}=this.context,e=this._parent?this._parent.index+4:0;return this.index==e?this.externalSibling(-1):new Tg(this.context,this._parent,t.findChild(e,this.index,-1,0,4))}cursor(t=0){return new Mg(this,t)}get tree(){return null}toTree(){let t=[],e=[],{buffer:i}=this.context,s=this.index+4,n=i.buffer[this.index+3];if(n>s){let r=i.buffer[this.index+1];t.push(i.slice(s,n,r)),e.push(0)}return new gg(this.type,t,e,this.to-this.from)}resolve(t,e=0){return Og(this,t,e,!1)}resolveInner(t,e=0){return Og(this,t,e,!0)}enterUnfinishedNodesBefore(t){return xg(this,t)}toString(){return this.context.buffer.childString(this.index)}getChild(t,e=null,i=null){let s=Sg(this,t,e,i);return s.length?s[0]:null}getChildren(t,e=null,i=null){return Sg(this,t,e,i)}get node(){return this}matchContext(t){return kg(this,t)}}class Mg{get name(){return this.type.name}constructor(t,e=0){if(this.mode=e,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,t instanceof wg)this.yieldNode(t);else{this._tree=t.context.parent,this.buffer=t.context;for(let e=t._parent;e;e=e._parent)this.stack.unshift(e.index);this.bufferNode=t,this.yieldBuf(t.index)}}yieldNode(t){return!!t&&(this._tree=t,this.type=t.type,this.from=t.from,this.to=t.to,!0)}yieldBuf(t,e){this.index=t;let{start:i,buffer:s}=this.buffer;return this.type=e||s.set.types[s.buffer[t]],this.from=i+s.buffer[t+1],this.to=i+s.buffer[t+2],!0}yield(t){return!!t&&(t instanceof wg?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(t,e,i){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree._tree.children.length-1:0,t,e,i,this.mode));let{buffer:s}=this.buffer,n=s.findChild(this.index+4,s.buffer[this.index+3],t,e-this.buffer.start,i);return!(n<0)&&(this.stack.push(this.index),this.yieldBuf(n))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(t){return this.enterChild(1,t,2)}childBefore(t){return this.enterChild(-1,t,-2)}enter(t,e,i=this.mode){return this.buffer?!(i&mg.ExcludeBuffers)&&this.enterChild(1,t,e):this.yield(this._tree.enter(t,e,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&mg.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let t=this.mode&mg.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(t)}sibling(t){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+t,t,0,4,this.mode));let{buffer:e}=this.buffer,i=this.stack.length-1;if(t<0){let t=i<0?0:this.stack[i]+4;if(this.index!=t)return this.yieldBuf(e.findChild(t,this.index,-1,0,4))}else{let t=e.buffer[this.index+3];if(t<(i<0?e.buffer.length:e.buffer[this.stack[i]+3]))return this.yieldBuf(t)}return i<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(t){let e,i,{buffer:s}=this;if(s){if(t>0){if(this.index<s.buffer.buffer.length)return!1}else for(let t=0;t<this.index;t++)if(s.buffer.buffer[t+3]<this.index)return!1;({index:e,parent:i}=s)}else({index:e,_parent:i}=this._tree);for(;i;({index:e,_parent:i}=i))if(e>-1)for(let s=e+t,n=t<0?-1:i._tree.children.length;s!=n;s+=t){let t=i._tree.children[s];if(this.mode&mg.IncludeAnonymous||t instanceof yg||!t.type.isAnonymous||Pg(t))return!1}return!0}move(t,e){if(e&&this.enterChild(t,0,4))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(t=!0){return this.move(1,t)}prev(t=!0){return this.move(-1,t)}moveTo(t,e=0){for(;(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t))&&this.parent(););for(;this.enterChild(1,t,e););return this}get node(){if(!this.buffer)return this._tree;let t=this.bufferNode,e=null,i=0;if(t&&t.context==this.buffer)t:for(let s=this.index,n=this.stack.length;n>=0;){for(let r=t;r;r=r._parent)if(r.index==s){if(s==this.index)return r;e=r,i=n+1;break t}s=this.stack[--n]}for(let t=i;t<this.stack.length;t++)e=new Tg(this.buffer,e,this.stack[t]);return this.bufferNode=new Tg(this.buffer,e,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(t,e){for(let i=0;;){let s=!1;if(this.type.isAnonymous||!1!==t(this)){if(this.firstChild()){i++;continue}this.type.isAnonymous||(s=!0)}for(;s&&e&&e(this),s=this.type.isAnonymous,!this.nextSibling();){if(!i)return;this.parent(),i--,s=!0}}}matchContext(t){if(!this.buffer)return kg(this.node,t);let{buffer:e}=this.buffer,{types:i}=e.set;for(let s=t.length-1,n=this.stack.length-1;s>=0;n--){if(n<0)return kg(this.node,t,s);let r=i[e.buffer[this.stack[n]]];if(!r.isAnonymous){if(t[s]&&t[s]!=r.name)return!1;s--}}return!0}}function Pg(t){return t.children.some((t=>t instanceof yg||!t.type.isAnonymous||Pg(t)))}const Cg=new WeakMap;function _g(t,e){if(!t.isAnonymous||e instanceof yg||e.type!=t)return 1;let i=Cg.get(e);if(null==i){i=1;for(let s of e.children){if(s.type!=t||!(s instanceof gg)){i=1;break}i+=_g(t,s)}Cg.set(e,i)}return i}function Rg(t,e,i,s,n,r,o,a,l){let h=0;for(let i=s;i<n;i++)h+=_g(t,e[i]);let c=Math.ceil(1.5*h/8),u=[],d=[];return function e(i,s,n,o,a){for(let h=n;h<o;){let n=h,p=s[h],f=_g(t,i[h]);for(h++;h<o;h++){let e=_g(t,i[h]);if(f+e>=c)break;f+=e}if(h==n+1){if(f>c){let t=i[n];e(t.children,t.positions,0,t.children.length,s[n]+a);continue}u.push(i[n])}else{let e=s[h-1]+i[h-1].length-p;u.push(Rg(t,i,s,n,h,p,e,null,l))}d.push(p+a-r)}}(e,i,s,n,0),(a||l)(u,d,o)}class Eg{constructor(t,e,i,s,n=!1,r=!1){this.from=t,this.to=e,this.tree=i,this.offset=s,this.open=(n?1:0)|(r?2:0)}get openStart(){return(1&this.open)>0}get openEnd(){return(2&this.open)>0}static addTree(t,e=[],i=!1){let s=[new Eg(0,t.length,t,0,!1,i)];for(let i of e)i.to>t.length&&s.push(i);return s}static applyChanges(t,e,i=128){if(!e.length)return t;let s=[],n=1,r=t.length?t[0]:null;for(let o=0,a=0,l=0;;o++){let h=o<e.length?e[o]:null,c=h?h.fromA:1e9;if(c-a>=i)for(;r&&r.from<c;){let e=r;if(a>=e.from||c<=e.to||l){let t=Math.max(e.from,a)-l,i=Math.min(e.to,c)-l;e=t>=i?null:new Eg(t,i,e.tree,e.offset+l,o>0,!!h)}if(e&&s.push(e),r.to>c)break;r=n<t.length?t[n++]:null}if(!h)break;a=h.toA,l=h.toA-h.toB}return s}}class Qg{startParse(t,e,i){return"string"==typeof t&&(t=new Lg(t)),i=i?i.length?i.map((t=>new lg(t.from,t.to))):[new lg(0,0)]:[new lg(0,t.length)],this.createParse(t,e||[],i)}parse(t,e,i){let s=this.startParse(t,e,i);for(;;){let t=s.advance();if(t)return t}}}class Lg{constructor(t){this.string=t}get length(){return this.string.length}chunk(t){return this.string.slice(t)}get lineChunks(){return!1}read(t,e){return this.string.slice(t,e)}}new hg({perNode:!0});let Fg=0;class Ig{constructor(t,e,i){this.set=t,this.base=e,this.modified=i,this.id=Fg++}static define(t){if(null==t?void 0:t.base)throw new Error("Can not derive from a modified tag");let e=new Ig([],null,[]);if(e.set.push(e),t)for(let i of t.set)e.set.push(i);return e}static defineModifier(){let t=new Ug;return e=>e.modified.indexOf(t)>-1?e:Ug.get(e.base||e,e.modified.concat(t).sort(((t,e)=>t.id-e.id)))}}let Dg=0;class Ug{constructor(){this.instances=[],this.id=Dg++}static get(t,e){if(!e.length)return t;let i=e[0].instances.find((i=>i.base==t&&function(t,e){return t.length==e.length&&t.every(((t,i)=>t==e[i]))}(e,i.modified)));if(i)return i;let s=[],n=new Ig(s,t,e);for(let t of e)t.instances.push(n);let r=function(t){let e=[[]];for(let i=0;i<t.length;i++)for(let s=0,n=e.length;s<n;s++)e.push(e[s].concat(t[i]));return e.sort(((t,e)=>e.length-t.length))}(e);for(let e of t.set)if(!e.modified.length)for(let t of r)s.push(Ug.get(e,t));return n}}function zg(t){let e=Object.create(null);for(let i in t){let s=t[i];Array.isArray(s)||(s=[s]);for(let t of i.split(" "))if(t){let i=[],n=2,r=t;for(let e=0;;){if("..."==r&&e>0&&e+3==t.length){n=1;break}let s=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(r);if(!s)throw new RangeError("Invalid path: "+t);if(i.push("*"==s[0]?"":'"'==s[0][0]?JSON.parse(s[0]):s[0]),(e+=s[0].length)==t.length)break;let o=t[e++];if(e==t.length&&"!"==o){n=0;break}if("/"!=o)throw new RangeError("Invalid path: "+t);r=t.slice(e)}let o=i.length-1,a=i[o];if(!a)throw new RangeError("Invalid path: "+t);let l=new Vg(s,n,o>0?i.slice(0,o):null);e[a]=l.sort(e[a])}}return Ng.add(e)}const Ng=new hg;class Vg{constructor(t,e,i,s){this.tags=t,this.mode=e,this.context=i,this.next=s}get opaque(){return 0==this.mode}get inherit(){return 1==this.mode}sort(t){return!t||t.depth<this.depth?(this.next=t,this):(t.next=this.sort(t.next),t)}get depth(){return this.context?this.context.length:0}}function Bg(t,e){let i=Object.create(null);for(let e of t)if(Array.isArray(e.tag))for(let t of e.tag)i[t.id]=e.class;else i[e.tag.id]=e.class;let{scope:s,all:n=null}=e||{};return{style:t=>{let e=n;for(let s of t)for(let t of s.set){let s=i[t.id];if(s){e=e?e+" "+s:s;break}}return e},scope:s}}function $g(t,e,i,s=0,n=t.length){let r=new Xg(s,Array.isArray(e)?e:[e],i);r.highlightRange(t.cursor(),s,n,"",r.highlighters),r.flush(n)}Vg.empty=new Vg([],2,null);class Xg{constructor(t,e,i){this.at=t,this.highlighters=e,this.span=i,this.class=""}startSpan(t,e){e!=this.class&&(this.flush(t),t>this.at&&(this.at=t),this.class=e)}flush(t){t>this.at&&this.class&&this.span(this.at,t,this.class)}highlightRange(t,e,i,s,n){let{type:r,from:o,to:a}=t;if(o>=i||a<=e)return;r.isTop&&(n=this.highlighters.filter((t=>!t.scope||t.scope(r))));let l=s,h=function(t){let e=t.type.prop(Ng);for(;e&&e.context&&!t.matchContext(e.context);)e=e.next;return e||null}(t)||Vg.empty,c=function(t,e){let i=null;for(let s of t){let t=s.style(e);t&&(i=i?i+" "+t:t)}return i}(n,h.tags);if(c&&(l&&(l+=" "),l+=c,1==h.mode&&(s+=(s?" ":"")+c)),this.startSpan(t.from,l),h.opaque)return;let u=t.tree&&t.tree.prop(hg.mounted);if(u&&u.overlay){let r=t.node.enter(u.overlay[0].from+o,1),h=this.highlighters.filter((t=>!t.scope||t.scope(u.tree.type))),c=t.firstChild();for(let d=0,p=o;;d++){let f=d<u.overlay.length?u.overlay[d]:null,m=f?f.from+o:a,g=Math.max(e,p),v=Math.min(i,m);if(g<v&&c)for(;t.from<v&&(this.highlightRange(t,g,v,s,n),this.startSpan(Math.min(v,t.to),l),!(t.to>=m)&&t.nextSibling()););if(!f||m>i)break;(p=f.to+o)>e&&(this.highlightRange(r.cursor(),Math.max(e,f.from+o),Math.min(i,p),s,h),this.startSpan(p,l))}c&&t.parent()}else if(t.firstChild()){do{if(!(t.to<=e)){if(t.from>=i)break;this.highlightRange(t,e,i,s,n),this.startSpan(Math.min(i,t.to),l)}}while(t.nextSibling());t.parent()}}}const jg=Ig.define,Gg=jg(),Zg=jg(),qg=jg(Zg),Wg=jg(Zg),Hg=jg(),Yg=jg(Hg),Kg=jg(Hg),Jg=jg(),tv=jg(Jg),ev=jg(),iv=jg(),sv=jg(),nv=jg(sv),rv=jg(),ov={comment:Gg,lineComment:jg(Gg),blockComment:jg(Gg),docComment:jg(Gg),name:Zg,variableName:jg(Zg),typeName:qg,tagName:jg(qg),propertyName:Wg,attributeName:jg(Wg),className:jg(Zg),labelName:jg(Zg),namespace:jg(Zg),macroName:jg(Zg),literal:Hg,string:Yg,docString:jg(Yg),character:jg(Yg),attributeValue:jg(Yg),number:Kg,integer:jg(Kg),float:jg(Kg),bool:jg(Hg),regexp:jg(Hg),escape:jg(Hg),color:jg(Hg),url:jg(Hg),keyword:ev,self:jg(ev),null:jg(ev),atom:jg(ev),unit:jg(ev),modifier:jg(ev),operatorKeyword:jg(ev),controlKeyword:jg(ev),definitionKeyword:jg(ev),moduleKeyword:jg(ev),operator:iv,derefOperator:jg(iv),arithmeticOperator:jg(iv),logicOperator:jg(iv),bitwiseOperator:jg(iv),compareOperator:jg(iv),updateOperator:jg(iv),definitionOperator:jg(iv),typeOperator:jg(iv),controlOperator:jg(iv),punctuation:sv,separator:jg(sv),bracket:nv,angleBracket:jg(nv),squareBracket:jg(nv),paren:jg(nv),brace:jg(nv),content:Jg,heading:tv,heading1:jg(tv),heading2:jg(tv),heading3:jg(tv),heading4:jg(tv),heading5:jg(tv),heading6:jg(tv),contentSeparator:jg(Jg),list:jg(Jg),quote:jg(Jg),emphasis:jg(Jg),strong:jg(Jg),link:jg(Jg),monospace:jg(Jg),strikethrough:jg(Jg),inserted:jg(),deleted:jg(),changed:jg(),invalid:jg(),meta:rv,documentMeta:jg(rv),annotation:jg(rv),processingInstruction:jg(rv),definition:Ig.defineModifier(),constant:Ig.defineModifier(),function:Ig.defineModifier(),standard:Ig.defineModifier(),local:Ig.defineModifier(),special:Ig.defineModifier()};var av;Bg([{tag:ov.link,class:"tok-link"},{tag:ov.heading,class:"tok-heading"},{tag:ov.emphasis,class:"tok-emphasis"},{tag:ov.strong,class:"tok-strong"},{tag:ov.keyword,class:"tok-keyword"},{tag:ov.atom,class:"tok-atom"},{tag:ov.bool,class:"tok-bool"},{tag:ov.url,class:"tok-url"},{tag:ov.labelName,class:"tok-labelName"},{tag:ov.inserted,class:"tok-inserted"},{tag:ov.deleted,class:"tok-deleted"},{tag:ov.literal,class:"tok-literal"},{tag:ov.string,class:"tok-string"},{tag:ov.number,class:"tok-number"},{tag:[ov.regexp,ov.escape,ov.special(ov.string)],class:"tok-string2"},{tag:ov.variableName,class:"tok-variableName"},{tag:ov.local(ov.variableName),class:"tok-variableName tok-local"},{tag:ov.definition(ov.variableName),class:"tok-variableName tok-definition"},{tag:ov.special(ov.variableName),class:"tok-variableName2"},{tag:ov.definition(ov.propertyName),class:"tok-propertyName tok-definition"},{tag:ov.typeName,class:"tok-typeName"},{tag:ov.namespace,class:"tok-namespace"},{tag:ov.className,class:"tok-className"},{tag:ov.macroName,class:"tok-macroName"},{tag:ov.propertyName,class:"tok-propertyName"},{tag:ov.operator,class:"tok-operator"},{tag:ov.comment,class:"tok-comment"},{tag:ov.meta,class:"tok-meta"},{tag:ov.invalid,class:"tok-invalid"},{tag:ov.punctuation,class:"tok-punctuation"}]);const lv=new hg;class hv{constructor(t,e,i=[],s=""){this.data=t,this.name=s,kc.prototype.hasOwnProperty("tree")||Object.defineProperty(kc.prototype,"tree",{get(){return dv(this)}}),this.parser=e,this.extension=[Ov.of(this),kc.languageData.of(((t,e,i)=>t.facet(cv(t,e,i))))].concat(i)}isActiveAt(t,e,i=-1){return cv(t,e,i)==this.data}findRegions(t){let e=t.facet(Ov);if((null==e?void 0:e.data)==this.data)return[{from:0,to:t.doc.length}];if(!e||!e.allowsNesting)return[];let i=[],s=(t,e)=>{if(t.prop(lv)==this.data)return void i.push({from:e,to:e+t.length});let n=t.prop(hg.mounted);if(n){if(n.tree.prop(lv)==this.data){if(n.overlay)for(let t of n.overlay)i.push({from:t.from+e,to:t.to+e});else i.push({from:e,to:e+t.length});return}if(n.overlay){let t=i.length;if(s(n.tree,n.overlay[0].from+e),i.length>t)return}}for(let i=0;i<t.children.length;i++){let n=t.children[i];n instanceof gg&&s(n,t.positions[i]+e)}};return s(dv(t),0),i}get allowsNesting(){return!0}}function cv(t,e,i){let s=t.facet(Ov);if(!s)return null;let n=s.data;if(s.allowsNesting)for(let s=dv(t).topNode;s;s=s.enter(e,i,mg.ExcludeBuffers))n=s.type.prop(lv)||n;return n}hv.setState=dc.define();class uv extends hv{constructor(t,e,i){super(t,e,[],i),this.parser=e}static define(t){let e=function(t){return Ih.define({combine:t?e=>e.concat(t):void 0})}(t.languageData);return new uv(e,t.parser.configure({props:[lv.add((t=>t.isTop?e:void 0))]}),t.name)}configure(t,e){return new uv(this.data,this.parser.configure(t),e||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function dv(t){let e=t.field(hv.state,!1);return e?e.tree:gg.empty}class pv{constructor(t,e=t.length){this.doc=t,this.length=e,this.cursorPos=0,this.string="",this.cursor=t.iter()}syncTo(t){return this.string=this.cursor.next(t-this.cursorPos).value,this.cursorPos=t+this.string.length,this.cursorPos-this.string.length}chunk(t){return this.syncTo(t),this.string}get lineChunks(){return!0}read(t,e){let i=this.cursorPos-this.string.length;return t<i||e>=this.cursorPos?this.doc.sliceString(t,e):this.string.slice(t-i,e-i)}}let fv=null;class mv{constructor(t,e,i=[],s,n,r,o,a){this.parser=t,this.state=e,this.fragments=i,this.tree=s,this.treeLen=n,this.viewport=r,this.skipped=o,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(t,e,i){return new mv(t,e,[],gg.empty,0,i,[],null)}startParse(){return this.parser.startParse(new pv(this.state.doc),this.fragments)}work(t,e){return null!=e&&e>=this.state.doc.length&&(e=void 0),this.tree!=gg.empty&&this.isDone(null!=e?e:this.state.doc.length)?(this.takeTree(),!0):this.withContext((()=>{var i;if("number"==typeof t){let e=Date.now()+t;t=()=>Date.now()>e}for(this.parse||(this.parse=this.startParse()),null!=e&&(null==this.parse.stoppedAt||this.parse.stoppedAt>e)&&e<this.state.doc.length&&this.parse.stopAt(e);;){let s=this.parse.advance();if(s){if(this.fragments=this.withoutTempSkipped(Eg.addTree(s,this.fragments,null!=this.parse.stoppedAt)),this.treeLen=null!==(i=this.parse.stoppedAt)&&void 0!==i?i:this.state.doc.length,this.tree=s,this.parse=null,!(this.treeLen<(null!=e?e:this.state.doc.length)))return!0;this.parse=this.startParse()}if(t())return!1}}))}takeTree(){let t,e;this.parse&&(t=this.parse.parsedPos)>=this.treeLen&&((null==this.parse.stoppedAt||this.parse.stoppedAt>t)&&this.parse.stopAt(t),this.withContext((()=>{for(;!(e=this.parse.advance()););})),this.treeLen=t,this.tree=e,this.fragments=this.withoutTempSkipped(Eg.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(t){let e=fv;fv=this;try{return t()}finally{fv=e}}withoutTempSkipped(t){for(let e;e=this.tempSkipped.pop();)t=gv(t,e.from,e.to);return t}changes(t,e){let{fragments:i,tree:s,treeLen:n,viewport:r,skipped:o}=this;if(this.takeTree(),!t.empty){let e=[];if(t.iterChangedRanges(((t,i,s,n)=>e.push({fromA:t,toA:i,fromB:s,toB:n}))),i=Eg.applyChanges(i,e),s=gg.empty,n=0,r={from:t.mapPos(r.from,-1),to:t.mapPos(r.to,1)},this.skipped.length){o=[];for(let e of this.skipped){let i=t.mapPos(e.from,1),s=t.mapPos(e.to,-1);i<s&&o.push({from:i,to:s})}}}return new mv(this.parser,e,i,s,n,r,o,this.scheduleOn)}updateViewport(t){if(this.viewport.from==t.from&&this.viewport.to==t.to)return!1;this.viewport=t;let e=this.skipped.length;for(let e=0;e<this.skipped.length;e++){let{from:i,to:s}=this.skipped[e];i<t.to&&s>t.from&&(this.fragments=gv(this.fragments,i,s),this.skipped.splice(e--,1))}return!(this.skipped.length>=e||(this.reset(),0))}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(t,e){this.skipped.push({from:t,to:e})}static getSkippingParser(t){return new class extends Qg{createParse(e,i,s){let n=s[0].from,r=s[s.length-1].to;return{parsedPos:n,advance(){let e=fv;if(e){for(let t of s)e.tempSkipped.push(t);t&&(e.scheduleOn=e.scheduleOn?Promise.all([e.scheduleOn,t]):t)}return this.parsedPos=r,new gg(ug.none,[],[],r-n)},stoppedAt:null,stopAt(){}}}}}isDone(t){t=Math.min(t,this.state.doc.length);let e=this.fragments;return this.treeLen>=t&&e.length&&0==e[0].from&&e[0].to>=t}static get(){return fv}}function gv(t,e,i){return Eg.applyChanges(t,[{fromA:e,toA:i,fromB:e,toB:i}])}class vv{constructor(t){this.context=t,this.tree=t.tree}apply(t){if(!t.docChanged&&this.tree==this.context.tree)return this;let e=this.context.changes(t.changes,t.state),i=this.context.treeLen==t.startState.doc.length?void 0:Math.max(t.changes.mapPos(this.context.treeLen),e.viewport.to);return e.work(20,i)||e.takeTree(),new vv(e)}static init(t){let e=Math.min(3e3,t.doc.length),i=mv.create(t.facet(Ov).parser,t,{from:0,to:e});return i.work(20,e)||i.takeTree(),new vv(i)}}hv.state=$h.define({create:vv.init,update(t,e){for(let t of e.effects)if(t.is(hv.setState))return t.value;return e.startState.facet(Ov)!=e.state.facet(Ov)?vv.init(e.state):t.apply(e)}});let yv=t=>{let e=setTimeout((()=>t()),500);return()=>clearTimeout(e)};"undefined"!=typeof requestIdleCallback&&(yv=t=>{let e=-1,i=setTimeout((()=>{e=requestIdleCallback(t,{timeout:400})}),100);return()=>e<0?clearTimeout(i):cancelIdleCallback(e)});const bv="undefined"!=typeof navigator&&(null===(av=navigator.scheduling)||void 0===av?void 0:av.isInputPending)?()=>navigator.scheduling.isInputPending():null,xv=Md.fromClass(class{constructor(t){this.view=t,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(t){let e=this.view.state.field(hv.state).context;(e.updateViewport(t.view.viewport)||this.view.viewport.to>e.treeLen)&&this.scheduleWork(),t.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(e)}scheduleWork(){if(this.working)return;let{state:t}=this.view,e=t.field(hv.state);e.tree==e.context.tree&&e.context.isDone(t.doc.length)||(this.working=yv(this.work))}work(t){this.working=null;let e=Date.now();if(this.chunkEnd<e&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=e+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:s}}=this.view,n=i.field(hv.state);if(n.tree==n.context.tree&&n.context.isDone(s+1e5))return;let r=Date.now()+Math.min(this.chunkBudget,100,t&&!bv?Math.max(25,t.timeRemaining()-5):1e9),o=n.context.treeLen<s&&i.doc.length>s+1e3,a=n.context.work((()=>bv&&bv()||Date.now()>r),s+(o?0:1e5));this.chunkBudget-=Date.now()-e,(a||this.chunkBudget<=0)&&(n.context.takeTree(),this.view.dispatch({effects:hv.setState.of(new vv(n.context))})),this.chunkBudget>0&&(!a||o)&&this.scheduleWork(),this.checkAsyncSchedule(n.context)}checkAsyncSchedule(t){t.scheduleOn&&(this.workScheduled++,t.scheduleOn.then((()=>this.scheduleWork())).catch((t=>Sd(this.view.state,t))).then((()=>this.workScheduled--)),t.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Ov=Ih.define({combine:t=>t.length?t[0]:null,enables:t=>[hv.state,xv,Cf.contentAttributes.compute([t],(e=>{let i=e.facet(t);return i&&i.name?{"data-language":i.name}:{}}))]}),wv=Ih.define(),Sv=Ih.define({combine:t=>{if(!t.length)return"  ";if(!/^(?: +|\t+)$/.test(t[0]))throw new Error("Invalid indent unit: "+JSON.stringify(t[0]));return t[0]}});function kv(t){let e=t.facet(Sv);return 9==e.charCodeAt(0)?t.tabSize*e.length:e.length}function Av(t,e){let i="",s=t.tabSize;if(9==t.facet(Sv).charCodeAt(0))for(;e>=s;)i+="\t",e-=s;for(let t=0;t<e;t++)i+=" ";return i}function Tv(t,e){t instanceof kc&&(t=new Mv(t));for(let i of t.state.facet(wv)){let s=i(t,e);if(void 0!==s)return s}let i=dv(t.state);return i?function(t,e,i){return _v(e.resolveInner(i).enterUnfinishedNodesBefore(i),i,t)}(t,i,e):null}class Mv{constructor(t,e={}){this.state=t,this.options=e,this.unit=kv(t)}lineAt(t,e=1){let i=this.state.doc.lineAt(t),{simulateBreak:s,simulateDoubleBreak:n}=this.options;return null!=s&&s>=i.from&&s<=i.to?n&&s==t?{text:"",from:t}:(e<0?s<t:s<=t)?{text:i.text.slice(s-i.from),from:s}:{text:i.text.slice(0,s-i.from),from:i.from}:i}textAfterPos(t,e=1){if(this.options.simulateDoubleBreak&&t==this.options.simulateBreak)return"";let{text:i,from:s}=this.lineAt(t,e);return i.slice(t-s,Math.min(i.length,t+100-s))}column(t,e=1){let{text:i,from:s}=this.lineAt(t,e),n=this.countColumn(i,t-s),r=this.options.overrideIndentation?this.options.overrideIndentation(s):-1;return r>-1&&(n+=r-this.countColumn(i,i.search(/\S|$/))),n}countColumn(t,e=t.length){return Bc(t,this.state.tabSize,e)}lineIndent(t,e=1){let{text:i,from:s}=this.lineAt(t,e),n=this.options.overrideIndentation;if(n){let t=n(s);if(t>-1)return t}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const Pv=new hg;function Cv(t){let e=t.type.prop(Pv);if(e)return e;let i,s=t.firstChild;if(s&&(i=s.type.prop(hg.closedBy))){let e=t.lastChild,s=e&&i.indexOf(e.name)>-1;return t=>Lv(t,!0,1,void 0,s&&!function(t){return t.pos==t.options.simulateBreak&&t.options.simulateDoubleBreak}(t)?e.from:void 0)}return null==t.parent?Rv:null}function _v(t,e,i){for(;t;t=t.parent){let s=Cv(t);if(s)return s(Ev.create(i,e,t))}return null}function Rv(){return 0}class Ev extends Mv{constructor(t,e,i){super(t.state,t.options),this.base=t,this.pos=e,this.node=i}static create(t,e,i){return new Ev(t,e,i)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let t=this.state.doc.lineAt(this.node.from);for(;;){let e=this.node.resolve(t.from);for(;e.parent&&e.parent.from==e.from;)e=e.parent;if(Qv(e,this.node))break;t=this.state.doc.lineAt(e.from)}return this.lineIndent(t.from)}continue(){let t=this.node.parent;return t?_v(t,this.pos,this.base):0}}function Qv(t,e){for(let i=e;i;i=i.parent)if(t==i)return!0;return!1}function Lv(t,e,i,s,n){let r=t.textAfter,o=r.match(/^\s*/)[0].length,a=s&&r.slice(o,o+s.length)==s||n==t.pos+o,l=e?function(t){let e=t.node,i=e.childAfter(e.from),s=e.lastChild;if(!i)return null;let n=t.options.simulateBreak,r=t.state.doc.lineAt(i.from),o=null==n||n<=r.from?r.to:Math.min(r.to,n);for(let t=i.to;;){let n=e.childAfter(t);if(!n||n==s)return null;if(!n.type.isSkipped)return n.from<o?i:null;t=n.to}}(t):null;return l?a?t.column(l.from):t.column(l.to):t.baseIndent+(a?0:t.unit*i)}function Fv({except:t,units:e=1}={}){return i=>{let s=t&&t.test(i.textAfter);return i.baseIndent+(s?0:e*i.unit)}}const Iv=200;const Dv=Ih.define(),Uv=new hg;function zv(t){let e=t.lastChild;return e&&e.to==t.to&&e.type.isError}function Nv(t,e,i){for(let s of t.facet(Dv)){let n=s(t,e,i);if(n)return n}return function(t,e,i){let s=dv(t);if(s.length<i)return null;let n=null;for(let r=s.resolveInner(i,1);r;r=r.parent){if(r.to<=i||r.from>i)continue;if(n&&r.from<e)break;let o=r.type.prop(Uv);if(o&&(r.to<s.length-50||s.length==t.doc.length||!zv(r))){let s=o(r,t);s&&s.from<=i&&s.from>=e&&s.to>i&&(n=s)}}return n}(t,e,i)}function Vv(t,e){let i=e.mapPos(t.from,1),s=e.mapPos(t.to,-1);return i>=s?void 0:{from:i,to:s}}const Bv=dc.define({map:Vv}),$v=dc.define({map:Vv});function Xv(t){let e=[];for(let{head:i}of t.state.selection.ranges)e.some((t=>t.from<=i&&t.to>=i))||e.push(t.lineBlockAt(i));return e}const jv=$h.define({create:()=>id.none,update(t,e){t=t.map(e.changes);for(let i of e.effects)i.is(Bv)&&!Zv(t,i.value.from,i.value.to)?t=t.update({add:[ty.range(i.value.from,i.value.to)]}):i.is($v)&&(t=t.update({filter:(t,e)=>i.value.from!=t||i.value.to!=e,filterFrom:i.value.from,filterTo:i.value.to}));if(e.selection){let i=!1,{head:s}=e.selection.main;t.between(s,s,((t,e)=>{t<s&&e>s&&(i=!0)})),i&&(t=t.update({filterFrom:s,filterTo:s,filter:(t,e)=>e<=s||t>=s}))}return t},provide:t=>Cf.decorations.from(t),toJSON(t,e){let i=[];return t.between(0,e.doc.length,((t,e)=>{i.push(t,e)})),i},fromJSON(t){if(!Array.isArray(t)||t.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let i=0;i<t.length;){let s=t[i++],n=t[i++];if("number"!=typeof s||"number"!=typeof n)throw new RangeError("Invalid JSON for fold state");e.push(ty.range(s,n))}return id.set(e,!0)}});function Gv(t,e,i){var s;let n=null;return null===(s=t.field(jv,!1))||void 0===s||s.between(e,i,((t,e)=>{(!n||n.from>t)&&(n={from:t,to:e})})),n}function Zv(t,e,i){let s=!1;return t.between(e,e,((t,n)=>{t==e&&n==i&&(s=!0)})),s}function qv(t,e){return t.field(jv,!1)?e:e.concat(dc.appendConfig.of(Jv()))}function Wv(t,e,i=!0){let s=t.state.doc.lineAt(e.from).number,n=t.state.doc.lineAt(e.to).number;return Cf.announce.of(`${t.state.phrase(i?"Folded lines":"Unfolded lines")} ${s} ${t.state.phrase("to")} ${n}.`)}const Hv=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:t=>{for(let e of Xv(t)){let i=Nv(t.state,e.from,e.to);if(i)return t.dispatch({effects:qv(t.state,[Bv.of(i),Wv(t,i)])}),!0}return!1}},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:t=>{if(!t.state.field(jv,!1))return!1;let e=[];for(let i of Xv(t)){let s=Gv(t.state,i.from,i.to);s&&e.push($v.of(s),Wv(t,s,!1))}return e.length&&t.dispatch({effects:e}),e.length>0}},{key:"Ctrl-Alt-[",run:t=>{let{state:e}=t,i=[];for(let s=0;s<e.doc.length;){let n=t.lineBlockAt(s),r=Nv(e,n.from,n.to);r&&i.push(Bv.of(r)),s=(r?t.lineBlockAt(r.to):n).to+1}return i.length&&t.dispatch({effects:qv(t.state,i)}),!!i.length}},{key:"Ctrl-Alt-]",run:t=>{let e=t.state.field(jv,!1);if(!e||!e.size)return!1;let i=[];return e.between(0,t.state.doc.length,((t,e)=>{i.push($v.of({from:t,to:e}))})),t.dispatch({effects:i}),!0}}],Yv={placeholderDOM:null,placeholderText:""},Kv=Ih.define({combine:t=>Ac(t,Yv)});function Jv(t){let e=[jv,ny];return t&&e.push(Kv.of(t)),e}const ty=id.replace({widget:new class extends td{toDOM(t){let{state:e}=t,i=e.facet(Kv),s=e=>{let i=t.lineBlockAt(t.posAtDOM(e.target)),s=Gv(t.state,i.from,i.to);s&&t.dispatch({effects:$v.of(s)}),e.preventDefault()};if(i.placeholderDOM)return i.placeholderDOM(t,s);let n=document.createElement("span");return n.textContent=i.placeholderText,n.setAttribute("aria-label",e.phrase("folded code")),n.title=e.phrase("unfold"),n.className="cm-foldPlaceholder",n.onclick=s,n}}}),ey={openText:"",closedText:"",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class iy extends Um{constructor(t,e){super(),this.config=t,this.open=e}eq(t){return this.config==t.config&&this.open==t.open}toDOM(t){if(this.config.markerDOM)return this.config.markerDOM(this.open);let e=document.createElement("span");return e.textContent=this.open?this.config.openText:this.config.closedText,e.title=t.state.phrase(this.open?"Fold line":"Unfold line"),e}}function sy(t={}){let e=Object.assign(Object.assign({},ey),t),i=new iy(e,!0),s=new iy(e,!1),n=Md.fromClass(class{constructor(t){this.from=t.viewport.from,this.markers=this.buildMarkers(t)}update(t){(t.docChanged||t.viewportChanged||t.startState.facet(Ov)!=t.state.facet(Ov)||t.startState.field(jv,!1)!=t.state.field(jv,!1)||dv(t.startState)!=dv(t.state)||e.foldingChanged(t))&&(this.markers=this.buildMarkers(t.view))}buildMarkers(t){let e=new Rc;for(let n of t.viewportLineBlocks){let r=Gv(t.state,n.from,n.to)?s:Nv(t.state,n.from,n.to)?i:null;r&&e.add(n.from,n.from,r)}return e.finish()}}),{domEventHandlers:r}=e;return[n,Bm({class:"cm-foldGutter",markers(t){var e;return(null===(e=t.plugin(n))||void 0===e?void 0:e.markers)||_c.empty},initialSpacer:()=>new iy(e,!1),domEventHandlers:Object.assign(Object.assign({},r),{click:(t,e,i)=>{if(r.click&&r.click(t,e,i))return!0;let s=Gv(t.state,e.from,e.to);if(s)return t.dispatch({effects:$v.of(s)}),!0;let n=Nv(t.state,e.from,e.to);return!!n&&(t.dispatch({effects:Bv.of(n)}),!0)}})}),Jv()]}const ny=Cf.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class ry{constructor(t,e){let i;function s(t){let e=Gc.newName();return(i||(i=Object.create(null)))["."+e]=t,e}this.specs=t;const n="string"==typeof e.all?e.all:e.all?s(e.all):void 0,r=e.scope;this.scope=r instanceof hv?t=>t.prop(lv)==r.data:r?t=>t==r:void 0,this.style=Bg(t.map((t=>({tag:t.tag,class:t.class||s(Object.assign({},t,{tag:null}))}))),{all:n}).style,this.module=i?new Gc(i):null,this.themeType=e.themeType}static define(t,e){return new ry(t,e||{})}}const oy=Ih.define(),ay=Ih.define({combine:t=>t.length?[t[0]]:null});function ly(t){let e=t.facet(oy);return e.length?e:t.facet(ay)}function hy(t,e){let i,s=[cy];return t instanceof ry&&(t.module&&s.push(Cf.styleModule.of(t.module)),i=t.themeType),(null==e?void 0:e.fallback)?s.push(ay.of(t)):i?s.push(oy.computeN([Cf.darkTheme],(e=>e.facet(Cf.darkTheme)==("dark"==i)?[t]:[]))):s.push(oy.of(t)),s}const cy=Wh.high(Md.fromClass(class{constructor(t){this.markCache=Object.create(null),this.tree=dv(t.state),this.decorations=this.buildDeco(t,ly(t.state))}update(t){let e=dv(t.state),i=ly(t.state),s=i!=ly(t.startState);e.length<t.view.viewport.to&&!s&&e.type==this.tree.type?this.decorations=this.decorations.map(t.changes):(e!=this.tree||t.viewportChanged||s)&&(this.tree=e,this.decorations=this.buildDeco(t.view,i))}buildDeco(t,e){if(!e||!this.tree.length)return id.none;let i=new Rc;for(let{from:s,to:n}of t.visibleRanges)$g(this.tree,e,((t,e,s)=>{i.add(t,e,this.markCache[s]||(this.markCache[s]=id.mark({class:s})))}),s,n);return i.finish()}},{decorations:t=>t.decorations})),uy=ry.define([{tag:ov.meta,color:"#7a757a"},{tag:ov.link,textDecoration:"underline"},{tag:ov.heading,textDecoration:"underline",fontWeight:"bold"},{tag:ov.emphasis,fontStyle:"italic"},{tag:ov.strong,fontWeight:"bold"},{tag:ov.strikethrough,textDecoration:"line-through"},{tag:ov.keyword,color:"#708"},{tag:[ov.atom,ov.bool,ov.url,ov.contentSeparator,ov.labelName],color:"#219"},{tag:[ov.literal,ov.inserted],color:"#164"},{tag:[ov.string,ov.deleted],color:"#a11"},{tag:[ov.regexp,ov.escape,ov.special(ov.string)],color:"#e40"},{tag:ov.definition(ov.variableName),color:"#00f"},{tag:ov.local(ov.variableName),color:"#30a"},{tag:[ov.typeName,ov.namespace],color:"#085"},{tag:ov.className,color:"#167"},{tag:[ov.special(ov.variableName),ov.macroName],color:"#256"},{tag:ov.definition(ov.propertyName),color:"#00c"},{tag:ov.comment,color:"#940"},{tag:ov.invalid,color:"#f00"}]),dy=Cf.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),py=1e4,fy="()[]{}",my=Ih.define({combine:t=>Ac(t,{afterCursor:!0,brackets:fy,maxScanDistance:py,renderMatch:yy})}),gy=id.mark({class:"cm-matchingBracket"}),vy=id.mark({class:"cm-nonmatchingBracket"});function yy(t){let e=[],i=t.matched?gy:vy;return e.push(i.range(t.start.from,t.start.to)),t.end&&e.push(i.range(t.end.from,t.end.to)),e}const by=$h.define({create:()=>id.none,update(t,e){if(!e.docChanged&&!e.selection)return t;let i=[],s=e.state.facet(my);for(let t of e.state.selection.ranges){if(!t.empty)continue;let n=Sy(e.state,t.head,-1,s)||t.head>0&&Sy(e.state,t.head-1,1,s)||s.afterCursor&&(Sy(e.state,t.head,1,s)||t.head<e.state.doc.length&&Sy(e.state,t.head+1,-1,s));n&&(i=i.concat(s.renderMatch(n,e.state)))}return id.set(i,!0)},provide:t=>Cf.decorations.from(t)}),xy=[by,dy];function Oy(t={}){return[my.of(t),xy]}function wy(t,e,i){let s=t.prop(e<0?hg.openedBy:hg.closedBy);if(s)return s;if(1==t.name.length){let s=i.indexOf(t.name);if(s>-1&&s%2==(e<0?1:0))return[i[s+e]]}return null}function Sy(t,e,i,s={}){let n=s.maxScanDistance||py,r=s.brackets||fy,o=dv(t),a=o.resolveInner(e,i);for(let s=a;s;s=s.parent){let n=wy(s.type,i,r);if(n&&s.from<s.to)return ky(t,e,i,s,n,r)}return function(t,e,i,s,n,r,o){let a=i<0?t.sliceDoc(e-1,e):t.sliceDoc(e,e+1),l=o.indexOf(a);if(l<0||l%2==0!=i>0)return null;let h={from:i<0?e-1:e,to:i>0?e+1:e},c=t.doc.iterRange(e,i>0?t.doc.length:0),u=0;for(let t=0;!c.next().done&&t<=r;){let r=c.value;i<0&&(t+=r.length);let a=e+t*i;for(let t=i>0?0:r.length-1,e=i>0?r.length:-1;t!=e;t+=i){let e=o.indexOf(r[t]);if(!(e<0||s.resolveInner(a+t,1).type!=n))if(e%2==0==i>0)u++;else{if(1==u)return{start:h,end:{from:a+t,to:a+t+1},matched:e>>1==l>>1};u--}}i>0&&(t+=r.length)}return c.done?{start:h,matched:!1}:null}(t,e,i,o,a.type,n,r)}function ky(t,e,i,s,n,r){let o=s.parent,a={from:s.from,to:s.to},l=0,h=null==o?void 0:o.cursor();if(h&&(i<0?h.childBefore(s.from):h.childAfter(s.to)))do{if(i<0?h.to<=s.from:h.from>=s.to){if(0==l&&n.indexOf(h.type.name)>-1&&h.from<h.to)return{start:a,end:{from:h.from,to:h.to},matched:!0};if(wy(h.type,i,r))l++;else if(wy(h.type,-i,r)){if(0==l)return{start:a,end:h.from==h.to?void 0:{from:h.from,to:h.to},matched:!1};l--}}}while(i<0?h.prevSibling():h.nextSibling());return{start:a,matched:!1}}const Ay=Object.create(null),Ty=[ug.none];new dg(Ty);const My=[],Py=Object.create(null);for(let[t,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])Py[t]=_y(Ay,e);function Cy(t,e){My.indexOf(t)>-1||(My.push(t),console.warn(e))}function _y(t,e){let i=null;for(let s of e.split(".")){let e=t[s]||ov[s];e?"function"==typeof e?i?i=e(i):Cy(s,`Modifier ${s} used at start of tag`):i?Cy(s,`Tag ${s} used as modifier`):i=e:Cy(s,`Unknown highlighting tag ${s}`)}if(!i)return 0;let s=e.replace(/ /g,"_"),n=ug.define({id:Ty.length,name:s,props:[zg({[s]:i})]});return Ty.push(n),n.id}new class{constructor(t){this.extra=t,this.table=Object.assign(Object.create(null),Py)}resolve(t){return t?this.table[t]||(this.table[t]=_y(this.extra,t)):0}}(Ay);function Ry(t,e){return({state:i,dispatch:s})=>{if(i.readOnly)return!1;let n=t(e,i);return!!n&&(s(i.update(n)),!0)}}const Ey=Ry((function(t,e,i=e.selection.ranges){let s=[],n=-1;for(let{from:t,to:r}of i){let i=s.length,o=1e9;for(let i=t;i<=r;){let a=e.doc.lineAt(i);if(a.from>n&&(t==r||r>a.from)){n=a.from;let t=Fy(e,i).line;if(!t)continue;let r=/^\s*/.exec(a.text)[0].length,l=r==a.length,h=a.text.slice(r,r+t.length)==t?r:-1;r<a.text.length&&r<o&&(o=r),s.push({line:a,comment:h,token:t,indent:r,empty:l,single:!1})}i=a.to+1}if(o<1e9)for(let t=i;t<s.length;t++)s[t].indent<s[t].line.text.length&&(s[t].indent=o);s.length==i+1&&(s[i].single=!0)}if(2!=t&&s.some((t=>t.comment<0&&(!t.empty||t.single)))){let t=[];for(let{line:e,token:i,indent:n,empty:r,single:o}of s)!o&&r||t.push({from:e.from+n,insert:i+" "});let i=e.changes(t);return{changes:i,selection:e.selection.map(i,1)}}if(1!=t&&s.some((t=>t.comment>=0))){let t=[];for(let{line:e,comment:i,token:n}of s)if(i>=0){let s=e.from+i,r=s+n.length;" "==e.text[r-e.from]&&r++,t.push({from:s,to:r})}return{changes:t}}return null}),0),Qy=Ry(Dy,0),Ly=Ry(((t,e)=>Dy(t,e,function(t){let e=[];for(let i of t.selection.ranges){let s=t.doc.lineAt(i.from),n=i.to<=s.to?s:t.doc.lineAt(i.to),r=e.length-1;r>=0&&e[r].to>s.from?e[r].to=n.to:e.push({from:s.from,to:n.to})}return e}(e))),0);function Fy(t,e=t.selection.main.head){let i=t.languageDataAt("commentTokens",e);return i.length?i[0]:{}}const Iy=50;function Dy(t,e,i=e.selection.ranges){let s=i.map((t=>Fy(e,t.from).block));if(!s.every((t=>t)))return null;let n=i.map(((t,i)=>function(t,{open:e,close:i},s,n){let r,o,a=t.sliceDoc(s-Iy,s),l=t.sliceDoc(n,n+Iy),h=/\s*$/.exec(a)[0].length,c=/^\s*/.exec(l)[0].length,u=a.length-h;if(a.slice(u-e.length,u)==e&&l.slice(c,c+i.length)==i)return{open:{pos:s-h,margin:h&&1},close:{pos:n+c,margin:c&&1}};n-s<=2*Iy?r=o=t.sliceDoc(s,n):(r=t.sliceDoc(s,s+Iy),o=t.sliceDoc(n-Iy,n));let d=/^\s*/.exec(r)[0].length,p=/\s*$/.exec(o)[0].length,f=o.length-p-i.length;return r.slice(d,d+e.length)==e&&o.slice(f,f+i.length)==i?{open:{pos:s+d+e.length,margin:/\s/.test(r.charAt(d+e.length))?1:0},close:{pos:n-p-i.length,margin:/\s/.test(o.charAt(f-1))?1:0}}:null}(e,s[i],t.from,t.to)));if(2!=t&&!n.every((t=>t)))return{changes:e.changes(i.map(((t,e)=>n[e]?[]:[{from:t.from,insert:s[e].open+" "},{from:t.to,insert:" "+s[e].close}])))};if(1!=t&&n.some((t=>t))){let t=[];for(let e,i=0;i<n.length;i++)if(e=n[i]){let n=s[i],{open:r,close:o}=e;t.push({from:r.pos-n.open.length,to:r.pos+r.margin},{from:o.pos-o.margin,to:o.pos+n.close.length})}return{changes:t}}return null}const Uy=hc.define(),zy=hc.define(),Ny=Ih.define(),Vy=Ih.define({combine:t=>Ac(t,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})});const By=$h.define({create:()=>rb.empty,update(t,e){let i=e.state.facet(Vy),s=e.annotation(Uy);if(s){let n=e.docChanged?Qh.single(function(t){let e=0;return t.iterChangedRanges(((t,i)=>e=i)),e}(e.changes)):void 0,r=Wy.fromTransaction(e,n),o=s.side,a=0==o?t.undone:t.done;return a=r?Hy(a,a.length,i.minDepth,r):tb(a,e.startState.selection),new rb(0==o?s.rest:a,0==o?a:s.rest)}let n=e.annotation(zy);if("full"!=n&&"before"!=n||(t=t.isolate()),!1===e.annotation(pc.addToHistory))return e.changes.empty?t:t.addMapping(e.changes.desc);let r=Wy.fromTransaction(e),o=e.annotation(pc.time),a=e.annotation(pc.userEvent);return r?t=t.addChanges(r,o,a,i.newGroupDelay,i.minDepth):e.selection&&(t=t.addSelection(e.startState.selection,o,a,i.newGroupDelay)),"full"!=n&&"after"!=n||(t=t.isolate()),t},toJSON:t=>({done:t.done.map((t=>t.toJSON())),undone:t.undone.map((t=>t.toJSON()))}),fromJSON:t=>new rb(t.done.map(Wy.fromJSON),t.undone.map(Wy.fromJSON))});function $y(t={}){return[By,Vy.of(t),Cf.domEventHandlers({beforeinput(t,e){let i="historyUndo"==t.inputType?jy:"historyRedo"==t.inputType?Gy:null;return!!i&&(t.preventDefault(),i(e))}})]}function Xy(t,e){return function({state:i,dispatch:s}){if(!e&&i.readOnly)return!1;let n=i.field(By,!1);if(!n)return!1;let r=n.pop(t,i,e);return!!r&&(s(r),!0)}}const jy=Xy(0,!1),Gy=Xy(1,!1),Zy=Xy(0,!0),qy=Xy(1,!0);class Wy{constructor(t,e,i,s,n){this.changes=t,this.effects=e,this.mapped=i,this.startSelection=s,this.selectionsAfter=n}setSelAfter(t){return new Wy(this.changes,this.effects,this.mapped,this.startSelection,t)}toJSON(){var t,e,i;return{changes:null===(t=this.changes)||void 0===t?void 0:t.toJSON(),mapped:null===(e=this.mapped)||void 0===e?void 0:e.toJSON(),startSelection:null===(i=this.startSelection)||void 0===i?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map((t=>t.toJSON()))}}static fromJSON(t){return new Wy(t.changes&&Ah.fromJSON(t.changes),[],t.mapped&&kh.fromJSON(t.mapped),t.startSelection&&Qh.fromJSON(t.startSelection),t.selectionsAfter.map(Qh.fromJSON))}static fromTransaction(t,e){let i=Ky;for(let e of t.startState.facet(Ny)){let s=e(t);s.length&&(i=i.concat(s))}return!i.length&&t.changes.empty?null:new Wy(t.changes.invert(t.startState.doc),i,void 0,e||t.startState.selection,Ky)}static selection(t){return new Wy(void 0,Ky,void 0,void 0,t)}}function Hy(t,e,i,s){let n=e+1>i+20?e-i-1:0,r=t.slice(n,e);return r.push(s),r}function Yy(t,e){return t.length?e.length?t.concat(e):t:e}const Ky=[],Jy=200;function tb(t,e){if(t.length){let i=t[t.length-1],s=i.selectionsAfter.slice(Math.max(0,i.selectionsAfter.length-Jy));return s.length&&s[s.length-1].eq(e)?t:(s.push(e),Hy(t,t.length-1,1e9,i.setSelAfter(s)))}return[Wy.selection([e])]}function eb(t){let e=t[t.length-1],i=t.slice();return i[t.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),i}function ib(t,e){if(!t.length)return t;let i=t.length,s=Ky;for(;i;){let n=sb(t[i-1],e,s);if(n.changes&&!n.changes.empty||n.effects.length){let e=t.slice(0,i);return e[i-1]=n,e}e=n.mapped,i--,s=n.selectionsAfter}return s.length?[Wy.selection(s)]:Ky}function sb(t,e,i){let s=Yy(t.selectionsAfter.length?t.selectionsAfter.map((t=>t.map(e))):Ky,i);if(!t.changes)return Wy.selection(s);let n=t.changes.map(e),r=e.mapDesc(t.changes,!0),o=t.mapped?t.mapped.composeDesc(r):r;return new Wy(n,dc.mapEffects(t.effects,e),o,t.startSelection.map(r),s)}const nb=/^(input\.type|delete)($|\.)/;class rb{constructor(t,e,i=0,s){this.done=t,this.undone=e,this.prevTime=i,this.prevUserEvent=s}isolate(){return this.prevTime?new rb(this.done,this.undone):this}addChanges(t,e,i,s,n){let r=this.done,o=r[r.length-1];return r=o&&o.changes&&!o.changes.empty&&t.changes&&(!i||nb.test(i))&&(!o.selectionsAfter.length&&e-this.prevTime<s&&function(t,e){let i=[],s=!1;return t.iterChangedRanges(((t,e)=>i.push(t,e))),e.iterChangedRanges(((t,e,n,r)=>{for(let t=0;t<i.length;){let e=i[t++],o=i[t++];r>=e&&n<=o&&(s=!0)}})),s}(o.changes,t.changes)||"input.type.compose"==i)?Hy(r,r.length-1,n,new Wy(t.changes.compose(o.changes),Yy(t.effects,o.effects),o.mapped,o.startSelection,Ky)):Hy(r,r.length,n,t),new rb(r,Ky,e,i)}addSelection(t,e,i,s){let n=this.done.length?this.done[this.done.length-1].selectionsAfter:Ky;return n.length>0&&e-this.prevTime<s&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&function(t,e){return t.ranges.length==e.ranges.length&&0===t.ranges.filter(((t,i)=>t.empty!=e.ranges[i].empty)).length}(n[n.length-1],t)?this:new rb(tb(this.done,t),this.undone,e,i)}addMapping(t){return new rb(ib(this.done,t),ib(this.undone,t),this.prevTime,this.prevUserEvent)}pop(t,e,i){let s=0==t?this.done:this.undone;if(0==s.length)return null;let n=s[s.length-1];if(i&&n.selectionsAfter.length)return e.update({selection:n.selectionsAfter[n.selectionsAfter.length-1],annotations:Uy.of({side:t,rest:eb(s)}),userEvent:0==t?"select.undo":"select.redo",scrollIntoView:!0});if(n.changes){let i=1==s.length?Ky:s.slice(0,s.length-1);return n.mapped&&(i=ib(i,n.mapped)),e.update({changes:n.changes,selection:n.startSelection,effects:n.effects,annotations:Uy.of({side:t,rest:i}),filter:!1,userEvent:0==t?"undo":"redo",scrollIntoView:!0})}return null}}rb.empty=new rb(Ky,Ky);const ob=[{key:"Mod-z",run:jy,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Gy,preventDefault:!0},{linux:"Ctrl-Shift-z",run:Gy,preventDefault:!0},{key:"Mod-u",run:Zy,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:qy,preventDefault:!0}];function ab(t,e){return Qh.create(t.ranges.map(e),t.mainIndex)}function lb(t,e){return t.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function hb({state:t,dispatch:e},i){let s=ab(t.selection,i);return!s.eq(t.selection)&&(e(lb(t,s)),!0)}function cb(t,e){return Qh.cursor(e?t.to:t.from)}function ub(t,e){return hb(t,(i=>i.empty?t.moveByChar(i,e):cb(i,e)))}function db(t){return t.textDirectionAt(t.state.selection.main.head)==Dd.LTR}const pb=t=>ub(t,!db(t)),fb=t=>ub(t,db(t));function mb(t,e){return hb(t,(i=>i.empty?t.moveByGroup(i,e):cb(i,e)))}function gb(t,e,i){if(e.type.prop(i))return!0;let s=e.to-e.from;return s&&(s>2||/[^\s,.;:]/.test(t.sliceDoc(e.from,e.to)))||e.firstChild}function vb(t,e,i){let s,n,r=dv(t).resolveInner(e.head),o=i?hg.closedBy:hg.openedBy;for(let s=e.head;;){let e=i?r.childAfter(s):r.childBefore(s);if(!e)break;gb(t,e,o)?r=e:s=i?e.to:e.from}return n=r.type.prop(o)&&(s=i?Sy(t,r.from,1):Sy(t,r.to,-1))&&s.matched?i?s.end.to:s.end.from:i?r.to:r.from,Qh.cursor(n,i?-1:1)}function yb(t,e){return hb(t,(i=>{if(!i.empty)return cb(i,e);let s=t.moveVertically(i,e);return s.head!=i.head?s:t.moveToLineBoundary(i,e)}))}const bb=t=>yb(t,!1),xb=t=>yb(t,!0);function Ob(t){return Math.max(t.defaultLineHeight,Math.min(t.dom.clientHeight,innerHeight)-5)}function wb(t,e){let{state:i}=t,s=ab(i.selection,(i=>i.empty?t.moveVertically(i,e,Ob(t)):cb(i,e)));if(s.eq(i.selection))return!1;let n,r=t.coordsAtPos(i.selection.main.head),o=t.scrollDOM.getBoundingClientRect();return r&&r.top>o.top&&r.bottom<o.bottom&&r.top-o.top<=t.scrollDOM.scrollHeight-t.scrollDOM.scrollTop-t.scrollDOM.clientHeight&&(n=Cf.scrollIntoView(s.main.head,{y:"start",yMargin:r.top-o.top})),t.dispatch(lb(i,s),{effects:n}),!0}const Sb=t=>wb(t,!1),kb=t=>wb(t,!0);function Ab(t,e,i){let s=t.lineBlockAt(e.head),n=t.moveToLineBoundary(e,i);if(n.head==e.head&&n.head!=(i?s.to:s.from)&&(n=t.moveToLineBoundary(e,i,!1)),!i&&n.head==s.from&&s.length){let i=/^\s*/.exec(t.state.sliceDoc(s.from,Math.min(s.from+100,s.to)))[0].length;i&&e.head!=s.from+i&&(n=Qh.cursor(s.from+i))}return n}function Tb(t,e){let i=ab(t.state.selection,(t=>{let i=e(t);return Qh.range(t.anchor,i.head,i.goalColumn)}));return!i.eq(t.state.selection)&&(t.dispatch(lb(t.state,i)),!0)}function Mb(t,e){return Tb(t,(i=>t.moveByChar(i,e)))}const Pb=t=>Mb(t,!db(t)),Cb=t=>Mb(t,db(t));function _b(t,e){return Tb(t,(i=>t.moveByGroup(i,e)))}function Rb(t,e){return Tb(t,(i=>t.moveVertically(i,e)))}const Eb=t=>Rb(t,!1),Qb=t=>Rb(t,!0);function Lb(t,e){return Tb(t,(i=>t.moveVertically(i,e,Ob(t))))}const Fb=t=>Lb(t,!1),Ib=t=>Lb(t,!0),Db=({state:t,dispatch:e})=>(e(lb(t,{anchor:0})),!0),Ub=({state:t,dispatch:e})=>(e(lb(t,{anchor:t.doc.length})),!0),zb=({state:t,dispatch:e})=>(e(lb(t,{anchor:t.selection.main.anchor,head:0})),!0),Nb=({state:t,dispatch:e})=>(e(lb(t,{anchor:t.selection.main.anchor,head:t.doc.length})),!0);function Vb(t,e){if(t.state.readOnly)return!1;let i="delete.selection",{state:s}=t,n=s.changeByRange((s=>{let{from:n,to:r}=s;if(n==r){let s=e(n);s<n?(i="delete.backward",s=Bb(t,s,!1)):s>n&&(i="delete.forward",s=Bb(t,s,!0)),n=Math.min(n,s),r=Math.max(r,s)}else n=Bb(t,n,!1),r=Bb(t,r,!0);return n==r?{range:s}:{changes:{from:n,to:r},range:Qh.cursor(n)}}));return!n.changes.empty&&(t.dispatch(s.update(n,{scrollIntoView:!0,userEvent:i,effects:"delete.selection"==i?Cf.announce.of(s.phrase("Selection deleted")):void 0})),!0)}function Bb(t,e,i){if(t instanceof Cf)for(let s of t.state.facet(Cf.atomicRanges).map((e=>e(t))))s.between(e,e,((t,s)=>{t<e&&s>e&&(e=i?s:t)}));return e}const $b=(t,e)=>Vb(t,(i=>{let s,n,{state:r}=t,o=r.doc.lineAt(i);if(!e&&i>o.from&&i<o.from+200&&!/[^ \t]/.test(s=o.text.slice(0,i-o.from))){if("\t"==s[s.length-1])return i-1;let t=Bc(s,r.tabSize)%kv(r)||kv(r);for(let e=0;e<t&&" "==s[s.length-1-e];e++)i--;n=i}else(n=fh(o.text,i-o.from,e,e)+o.from)==i&&o.number!=(e?r.doc.lines:1)&&(n+=e?1:-1);return n})),Xb=t=>$b(t,!1),jb=t=>$b(t,!0),Gb=(t,e)=>Vb(t,(i=>{let s=i,{state:n}=t,r=n.doc.lineAt(s),o=n.charCategorizer(s);for(let t=null;;){if(s==(e?r.to:r.from)){s==i&&r.number!=(e?n.doc.lines:1)&&(s+=e?1:-1);break}let a=fh(r.text,s-r.from,e)+r.from,l=r.text.slice(Math.min(s,a)-r.from,Math.max(s,a)-r.from),h=o(l);if(null!=t&&h!=t)break;" "==l&&s==i||(t=h),s=a}return s})),Zb=t=>Gb(t,!1),qb=t=>Vb(t,(e=>{let i=t.lineBlockAt(e).to;return e<i?i:Math.min(t.state.doc.length,e+1)}));function Wb(t){let e=[],i=-1;for(let s of t.selection.ranges){let n=t.doc.lineAt(s.from),r=t.doc.lineAt(s.to);if(s.empty||s.to!=r.from||(r=t.doc.lineAt(s.to-1)),i>=n.number){let t=e[e.length-1];t.to=r.to,t.ranges.push(s)}else e.push({from:n.from,to:r.to,ranges:[s]});i=r.number+1}return e}function Hb(t,e,i){if(t.readOnly)return!1;let s=[],n=[];for(let e of Wb(t)){if(i?e.to==t.doc.length:0==e.from)continue;let r=t.doc.lineAt(i?e.to+1:e.from-1),o=r.length+1;if(i){s.push({from:e.to,to:r.to},{from:e.from,insert:r.text+t.lineBreak});for(let i of e.ranges)n.push(Qh.range(Math.min(t.doc.length,i.anchor+o),Math.min(t.doc.length,i.head+o)))}else{s.push({from:r.from,to:e.from},{from:e.to,insert:t.lineBreak+r.text});for(let t of e.ranges)n.push(Qh.range(t.anchor-o,t.head-o))}}return!!s.length&&(e(t.update({changes:s,scrollIntoView:!0,selection:Qh.create(n,t.selection.mainIndex),userEvent:"move.line"})),!0)}function Yb(t,e,i){if(t.readOnly)return!1;let s=[];for(let e of Wb(t))i?s.push({from:e.from,insert:t.doc.slice(e.from,e.to)+t.lineBreak}):s.push({from:e.to,insert:t.lineBreak+t.doc.slice(e.from,e.to)});return e(t.update({changes:s,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const Kb=tx(!1),Jb=tx(!0);function tx(t){return({state:e,dispatch:i})=>{if(e.readOnly)return!1;let s=e.changeByRange((i=>{let{from:s,to:n}=i,r=e.doc.lineAt(s),o=!t&&s==n&&function(t,e){if(/\(\)|\[\]|\{\}/.test(t.sliceDoc(e-1,e+1)))return{from:e,to:e};let i,s=dv(t).resolveInner(e),n=s.childBefore(e),r=s.childAfter(e);return n&&r&&n.to<=e&&r.from>=e&&(i=n.type.prop(hg.closedBy))&&i.indexOf(r.name)>-1&&t.doc.lineAt(n.to).from==t.doc.lineAt(r.from).from?{from:n.to,to:r.from}:null}(e,s);t&&(s=n=(n<=r.to?r:e.doc.lineAt(n)).to);let a=new Mv(e,{simulateBreak:s,simulateDoubleBreak:!!o}),l=Tv(a,s);for(null==l&&(l=/^\s*/.exec(e.doc.lineAt(s).text)[0].length);n<r.to&&/\s/.test(r.text[n-r.from]);)n++;o?({from:s,to:n}=o):s>r.from&&s<r.from+100&&!/\S/.test(r.text.slice(0,s))&&(s=r.from);let h=["",Av(e,l)];return o&&h.push(Av(e,a.lineIndent(r.from,-1))),{changes:{from:s,to:n,insert:eh.of(h)},range:Qh.cursor(s+1+h[1].length)}}));return i(e.update(s,{scrollIntoView:!0,userEvent:"input"})),!0}}function ex(t,e){let i=-1;return t.changeByRange((s=>{let n=[];for(let r=s.from;r<=s.to;){let o=t.doc.lineAt(r);o.number>i&&(s.empty||s.to>o.from)&&(e(o,n,s),i=o.number),r=o.to+1}let r=t.changes(n);return{changes:n,range:Qh.range(r.mapPos(s.anchor,1),r.mapPos(s.head,1))}}))}const ix=({state:t,dispatch:e})=>!t.readOnly&&(e(t.update(ex(t,((e,i)=>{i.push({from:e.from,insert:t.facet(Sv)})})),{userEvent:"input.indent"})),!0),sx=({state:t,dispatch:e})=>!t.readOnly&&(e(t.update(ex(t,((e,i)=>{let s=/^\s*/.exec(e.text)[0];if(!s)return;let n=Bc(s,t.tabSize),r=0,o=Av(t,Math.max(0,n-kv(t)));for(;r<s.length&&r<o.length&&s.charCodeAt(r)==o.charCodeAt(r);)r++;i.push({from:e.from+r,to:e.from+s.length,insert:o.slice(r)})})),{userEvent:"delete.dedent"})),!0),nx=[{key:"Ctrl-b",run:pb,shift:Pb,preventDefault:!0},{key:"Ctrl-f",run:fb,shift:Cb},{key:"Ctrl-p",run:bb,shift:Eb},{key:"Ctrl-n",run:xb,shift:Qb},{key:"Ctrl-a",run:t=>hb(t,(e=>Qh.cursor(t.lineBlockAt(e.head).from,1))),shift:t=>Tb(t,(e=>Qh.cursor(t.lineBlockAt(e.head).from)))},{key:"Ctrl-e",run:t=>hb(t,(e=>Qh.cursor(t.lineBlockAt(e.head).to,-1))),shift:t=>Tb(t,(e=>Qh.cursor(t.lineBlockAt(e.head).to)))},{key:"Ctrl-d",run:jb},{key:"Ctrl-h",run:Xb},{key:"Ctrl-k",run:qb},{key:"Ctrl-Alt-h",run:Zb},{key:"Ctrl-o",run:({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=t.changeByRange((t=>({changes:{from:t.from,to:t.to,insert:eh.of(["",""])},range:Qh.cursor(t.from)})));return e(t.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}},{key:"Ctrl-t",run:({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=t.changeByRange((e=>{if(!e.empty||0==e.from||e.from==t.doc.length)return{range:e};let i=e.from,s=t.doc.lineAt(i),n=i==s.from?i-1:fh(s.text,i-s.from,!1)+s.from,r=i==s.to?i+1:fh(s.text,i-s.from,!0)+s.from;return{changes:{from:n,to:r,insert:t.doc.slice(i,r).append(t.doc.slice(n,i))},range:Qh.cursor(r)}}));return!i.changes.empty&&(e(t.update(i,{scrollIntoView:!0,userEvent:"move.character"})),!0)}},{key:"Ctrl-v",run:kb}],rx=[{key:"ArrowLeft",run:pb,shift:Pb,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:t=>mb(t,!db(t)),shift:t=>_b(t,!db(t)),preventDefault:!0},{mac:"Cmd-ArrowLeft",run:t=>hb(t,(e=>Ab(t,e,!db(t)))),shift:t=>Tb(t,(e=>Ab(t,e,!db(t)))),preventDefault:!0},{key:"ArrowRight",run:fb,shift:Cb,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:t=>mb(t,db(t)),shift:t=>_b(t,db(t)),preventDefault:!0},{mac:"Cmd-ArrowRight",run:t=>hb(t,(e=>Ab(t,e,db(t)))),shift:t=>Tb(t,(e=>Ab(t,e,db(t)))),preventDefault:!0},{key:"ArrowUp",run:bb,shift:Eb,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Db,shift:zb},{mac:"Ctrl-ArrowUp",run:Sb,shift:Fb},{key:"ArrowDown",run:xb,shift:Qb,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Ub,shift:Nb},{mac:"Ctrl-ArrowDown",run:kb,shift:Ib},{key:"PageUp",run:Sb,shift:Fb},{key:"PageDown",run:kb,shift:Ib},{key:"Home",run:t=>hb(t,(e=>Ab(t,e,!1))),shift:t=>Tb(t,(e=>Ab(t,e,!1))),preventDefault:!0},{key:"Mod-Home",run:Db,shift:zb},{key:"End",run:t=>hb(t,(e=>Ab(t,e,!0))),shift:t=>Tb(t,(e=>Ab(t,e,!0))),preventDefault:!0},{key:"Mod-End",run:Ub,shift:Nb},{key:"Enter",run:Kb},{key:"Mod-a",run:({state:t,dispatch:e})=>(e(t.update({selection:{anchor:0,head:t.doc.length},userEvent:"select"})),!0)},{key:"Backspace",run:Xb,shift:Xb},{key:"Delete",run:jb},{key:"Mod-Backspace",mac:"Alt-Backspace",run:Zb},{key:"Mod-Delete",mac:"Alt-Delete",run:t=>Gb(t,!0)},{mac:"Mod-Backspace",run:t=>Vb(t,(e=>{let i=t.lineBlockAt(e).from;return e>i?i:Math.max(0,e-1)}))},{mac:"Mod-Delete",run:qb}].concat(nx.map((t=>({mac:t.key,run:t.run,shift:t.shift})))),ox=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:t=>hb(t,(e=>vb(t.state,e,!db(t)))),shift:t=>Tb(t,(e=>vb(t.state,e,!db(t))))},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:t=>hb(t,(e=>vb(t.state,e,db(t)))),shift:t=>Tb(t,(e=>vb(t.state,e,db(t))))},{key:"Alt-ArrowUp",run:({state:t,dispatch:e})=>Hb(t,e,!1)},{key:"Shift-Alt-ArrowUp",run:({state:t,dispatch:e})=>Yb(t,e,!1)},{key:"Alt-ArrowDown",run:({state:t,dispatch:e})=>Hb(t,e,!0)},{key:"Shift-Alt-ArrowDown",run:({state:t,dispatch:e})=>Yb(t,e,!0)},{key:"Escape",run:({state:t,dispatch:e})=>{let i=t.selection,s=null;return i.ranges.length>1?s=Qh.create([i.main]):i.main.empty||(s=Qh.create([Qh.cursor(i.main.head)])),!!s&&(e(lb(t,s)),!0)}},{key:"Mod-Enter",run:Jb},{key:"Alt-l",mac:"Ctrl-l",run:({state:t,dispatch:e})=>{let i=Wb(t).map((({from:e,to:i})=>Qh.range(e,Math.min(i+1,t.doc.length))));return e(t.update({selection:Qh.create(i),userEvent:"select"})),!0}},{key:"Mod-i",run:({state:t,dispatch:e})=>{let i=ab(t.selection,(e=>{var i;let s=dv(t).resolveInner(e.head,1);for(;!(s.from<e.from&&s.to>=e.to||s.to>e.to&&s.from<=e.from)&&(null===(i=s.parent)||void 0===i?void 0:i.parent);)s=s.parent;return Qh.range(s.to,s.from)}));return e(lb(t,i)),!0},preventDefault:!0},{key:"Mod-[",run:sx},{key:"Mod-]",run:ix},{key:"Mod-Alt-\\",run:({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=Object.create(null),s=new Mv(t,{overrideIndentation:t=>{let e=i[t];return null==e?-1:e}}),n=ex(t,((e,n,r)=>{let o=Tv(s,e.from);if(null==o)return;/\S/.test(e.text)||(o=0);let a=/^\s*/.exec(e.text)[0],l=Av(t,o);(a!=l||r.from<e.from+a.length)&&(i[e.from]=o,n.push({from:e.from,to:e.from+a.length,insert:l}))}));return n.changes.empty||e(t.update(n,{userEvent:"indent"})),!0}},{key:"Shift-Mod-k",run:t=>{if(t.state.readOnly)return!1;let{state:e}=t,i=e.changes(Wb(e).map((({from:t,to:i})=>(t>0?t--:i<e.doc.length&&i++,{from:t,to:i})))),s=ab(e.selection,(e=>t.moveVertically(e,!0))).map(i);return t.dispatch({changes:i,selection:s,scrollIntoView:!0,userEvent:"delete.line"}),!0}},{key:"Shift-Mod-\\",run:({state:t,dispatch:e})=>function(t,e,i){let s=!1,n=ab(t.selection,(e=>{let n=Sy(t,e.head,-1)||Sy(t,e.head,1)||e.head>0&&Sy(t,e.head-1,1)||e.head<t.doc.length&&Sy(t,e.head+1,-1);if(!n||!n.end)return e;s=!0;let r=n.start.from==e.head?n.end.to:n.end.from;return i?Qh.range(e.anchor,r):Qh.cursor(r)}));return!!s&&(e(lb(t,n)),!0)}(t,e,!1)},{key:"Mod-/",run:t=>{let e=Fy(t.state);return e.line?Ey(t):!!e.block&&Ly(t)}},{key:"Alt-A",run:Qy}].concat(rx),ax={key:"Tab",run:ix,shift:sx};class lx{constructor(t,e,i){this.state=t,this.pos=e,this.explicit=i,this.abortListeners=[]}tokenBefore(t){let e=dv(this.state).resolveInner(this.pos,-1);for(;e&&t.indexOf(e.name)<0;)e=e.parent;return e?{from:e.from,to:this.pos,text:this.state.sliceDoc(e.from,this.pos),type:e.type}:null}matchBefore(t){let e=this.state.doc.lineAt(this.pos),i=Math.max(e.from,this.pos-250),s=e.text.slice(i-e.from,this.pos-e.from),n=s.search(px(t,!1));return n<0?null:{from:i+n,to:this.pos,text:s.slice(n)}}get aborted(){return null==this.abortListeners}addEventListener(t,e){"abort"==t&&this.abortListeners&&this.abortListeners.push(e)}}function hx(t){let e=Object.keys(t).join(""),i=/\w/.test(e);return i&&(e=e.replace(/\w/g,"")),`[${i?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function cx(t){let e=t.map((t=>"string"==typeof t?{label:t}:t)),[i,s]=e.every((t=>/^\w+$/.test(t.label)))?[/\w*$/,/\w+$/]:function(t){let e=Object.create(null),i=Object.create(null);for(let{label:s}of t){e[s[0]]=!0;for(let t=1;t<s.length;t++)i[s[t]]=!0}let s=hx(e)+hx(i)+"*$";return[new RegExp("^"+s),new RegExp(s)]}(e);return t=>{let n=t.matchBefore(s);return n||t.explicit?{from:n?n.from:t.pos,options:e,validFor:i}:null}}class ux{constructor(t,e,i){this.completion=t,this.source=e,this.match=i}}function dx(t){return t.selection.main.head}function px(t,e){var i;let{source:s}=t,n=e&&"^"!=s[0],r="$"!=s[s.length-1];return n||r?new RegExp(`${n?"^":""}(?:${s})${r?"$":""}`,null!==(i=t.flags)&&void 0!==i?i:t.ignoreCase?"i":""):t}const fx=hc.define();function mx(t,e){const i=e.completion.apply||e.completion.label;let s=e.source;"string"==typeof i?t.dispatch(Object.assign(Object.assign({},function(t,e,i,s){return Object.assign(Object.assign({},t.changeByRange((n=>{if(n==t.selection.main)return{changes:{from:i,to:s,insert:e},range:Qh.cursor(i+e.length)};let r=s-i;return!n.empty||r&&t.sliceDoc(n.from-r,n.from)!=t.sliceDoc(i,s)?{range:n}:{changes:{from:n.from-r,to:n.from,insert:e},range:Qh.cursor(n.from-r+e.length)}}))),{userEvent:"input.complete"})}(t.state,i,s.from,s.to)),{annotations:fx.of(e.completion)})):i(t,e.completion,s.from,s.to)}const gx=new WeakMap;function vx(t){if(!Array.isArray(t))return t;let e=gx.get(t);return e||gx.set(t,e=cx(t)),e}class yx{constructor(t){this.pattern=t,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[];for(let e=0;e<t.length;){let i=bh(t,e),s=Oh(i);this.chars.push(i);let n=t.slice(e,e+s),r=n.toUpperCase();this.folded.push(bh(r==n?n.toLowerCase():r,0)),e+=s}this.astral=t.length!=this.chars.length}match(t){if(0==this.pattern.length)return[0];if(t.length<this.pattern.length)return null;let{chars:e,folded:i,any:s,precise:n,byWord:r}=this;if(1==e.length){let s=bh(t,0);return s==e[0]?[0,0,Oh(s)]:s==i[0]?[-200,0,Oh(s)]:null}let o=t.indexOf(this.pattern);if(0==o)return[0,0,this.pattern.length];let a=e.length,l=0;if(o<0){for(let n=0,r=Math.min(t.length,200);n<r&&l<a;){let r=bh(t,n);r!=e[l]&&r!=i[l]||(s[l++]=n),n+=Oh(r)}if(l<a)return null}let h=0,c=0,u=!1,d=0,p=-1,f=-1,m=/[a-z]/.test(t),g=!0;for(let s=0,l=Math.min(t.length,200),v=0;s<l&&c<a;){let l=bh(t,s);o<0&&(h<a&&l==e[h]&&(n[h++]=s),d<a&&(l==e[d]||l==i[d]?(0==d&&(p=s),f=s+1,d++):d=0));let y,b=l<255?l>=48&&l<=57||l>=97&&l<=122?2:l>=65&&l<=90?1:0:(y=xh(l))!=y.toLowerCase()?1:y!=y.toUpperCase()?2:0;(!s||1==b&&m||0==v&&0!=b)&&(e[c]==l||i[c]==l&&(u=!0)?r[c++]=s:r.length&&(g=!1)),v=b,s+=Oh(l)}return c==a&&0==r[0]&&g?this.result((u?-200:0)-100,r,t):d==a&&0==p?[-200-t.length,0,f]:o>-1?[-700-t.length,o,o+this.pattern.length]:d==a?[-900-t.length,p,f]:c==a?this.result((u?-200:0)-100-700+(g?0:-1100),r,t):2==e.length?null:this.result((s[0]?-700:0)-200-1100,s,t)}result(t,e,i){let s=[t-i.length],n=1;for(let t of e){let e=t+(this.astral?Oh(bh(i,t)):1);n>1&&s[n-1]==t?s[n-1]=e:(s[n++]=t,s[n++]=e)}return s}}const bx=Ih.define({combine:t=>Ac(t,{activateOnTyping:!0,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],compareCompletions:(t,e)=>t.label.localeCompare(e.label),interactionDelay:75},{defaultKeymap:(t,e)=>t&&e,closeOnBlur:(t,e)=>t&&e,icons:(t,e)=>t&&e,optionClass:(t,e)=>i=>function(t,e){return t?e?t+" "+e:t:e}(t(i),e(i)),addToOptions:(t,e)=>t.concat(e)})});function xx(t,e,i){if(t<=i)return{from:0,to:t};if(e<0&&(e=0),e<=t>>1){let t=Math.floor(e/i);return{from:t*i,to:(t+1)*i}}let s=Math.floor((t-e)/i);return{from:t-(s+1)*i,to:t-s*i}}class Ox{constructor(t,e){this.view=t,this.stateField=e,this.info=null,this.placeInfo={read:()=>this.measureInfo(),write:t=>this.positionInfo(t),key:this},this.space=null;let i=t.state.field(e),{options:s,selected:n}=i.open,r=t.state.facet(bx);this.optionContent=function(t){let e=t.addToOptions.slice();return t.icons&&e.push({render(t){let e=document.createElement("div");return e.classList.add("cm-completionIcon"),t.type&&e.classList.add(...t.type.split(/\s+/g).map((t=>"cm-completionIcon-"+t))),e.setAttribute("aria-hidden","true"),e},position:20}),e.push({render(t,e,i){let s=document.createElement("span");s.className="cm-completionLabel";let{label:n}=t,r=0;for(let t=1;t<i.length;){let e=i[t++],o=i[t++];e>r&&s.appendChild(document.createTextNode(n.slice(r,e)));let a=s.appendChild(document.createElement("span"));a.appendChild(document.createTextNode(n.slice(e,o))),a.className="cm-completionMatchedText",r=o}return r<n.length&&s.appendChild(document.createTextNode(n.slice(r))),s},position:50},{render(t){if(!t.detail)return null;let e=document.createElement("span");return e.className="cm-completionDetail",e.textContent=t.detail,e},position:80}),e.sort(((t,e)=>t.position-e.position)).map((t=>t.render))}(r),this.optionClass=r.optionClass,this.range=xx(s.length,n,r.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.dom.addEventListener("mousedown",(e=>{for(let i,n=e.target;n&&n!=this.dom;n=n.parentNode)if("LI"==n.nodeName&&(i=/-(\d+)$/.exec(n.id))&&+i[1]<s.length)return mx(t,s[+i[1]]),void e.preventDefault()})),this.list=this.dom.appendChild(this.createListBox(s,i.id,this.range)),this.list.addEventListener("scroll",(()=>{this.info&&this.view.requestMeasure(this.placeInfo)}))}mount(){this.updateSel()}update(t){var e,i,s;let n=t.state.field(this.stateField),r=t.startState.field(this.stateField);n!=r&&(this.updateSel(),(null===(e=n.open)||void 0===e?void 0:e.disabled)!=(null===(i=r.open)||void 0===i?void 0:i.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!(null===(s=n.open)||void 0===s?void 0:s.disabled)))}positioned(t){this.space=t,this.info&&this.view.requestMeasure(this.placeInfo)}updateSel(){let t=this.view.state.field(this.stateField),e=t.open;if((e.selected>-1&&e.selected<this.range.from||e.selected>=this.range.to)&&(this.range=xx(e.options.length,e.selected,this.view.state.facet(bx).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e.options,t.id,this.range)),this.list.addEventListener("scroll",(()=>{this.info&&this.view.requestMeasure(this.placeInfo)}))),this.updateSelectedOption(e.selected)){this.info&&(this.info.remove(),this.info=null);let{completion:i}=e.options[e.selected],{info:s}=i;if(!s)return;let n="string"==typeof s?document.createTextNode(s):s(i);if(!n)return;"then"in n?n.then((e=>{e&&this.view.state.field(this.stateField,!1)==t&&this.addInfoPane(e)})).catch((t=>Sd(this.view.state,t,"completion info"))):this.addInfoPane(n)}}addInfoPane(t){let e=this.info=document.createElement("div");e.className="cm-tooltip cm-completionInfo",e.appendChild(t),this.dom.appendChild(e),this.view.requestMeasure(this.placeInfo)}updateSelectedOption(t){let e=null;for(let i=this.list.firstChild,s=this.range.from;i;i=i.nextSibling,s++)s==t?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),e=i):i.hasAttribute("aria-selected")&&i.removeAttribute("aria-selected");return e&&function(t,e){let i=t.getBoundingClientRect(),s=e.getBoundingClientRect();s.top<i.top?t.scrollTop-=i.top-s.top:s.bottom>i.bottom&&(t.scrollTop+=s.bottom-i.bottom)}(this.list,e),e}measureInfo(){let t=this.dom.querySelector("[aria-selected]");if(!t||!this.info)return null;let e=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),s=t.getBoundingClientRect(),n=this.space;if(!n){let t=this.dom.ownerDocument.defaultView||window;n={left:0,top:0,right:t.innerWidth,bottom:t.innerHeight}}if(s.top>Math.min(n.bottom,e.bottom)-10||s.bottom<Math.max(n.top,e.top)+10)return null;let r,o=this.view.textDirection==Dd.RTL,a=o,l=!1,h="",c="",u=e.left-n.left,d=n.right-e.right;if(a&&u<Math.min(i.width,d)?a=!1:!a&&d<Math.min(i.width,u)&&(a=!0),i.width<=(a?u:d))h=Math.max(n.top,Math.min(s.top,n.bottom-i.height))-e.top+"px",r=Math.min(400,a?u:d)+"px";else{l=!0,r=Math.min(400,(o?e.right:n.right-e.left)-30)+"px";let t=n.bottom-e.bottom;t>=i.height||t>e.top?h=s.bottom-e.top+"px":c=e.bottom-s.top+"px"}return{top:h,bottom:c,maxWidth:r,class:l?o?"left-narrow":"right-narrow":a?"left":"right"}}positionInfo(t){this.info&&(t?(this.info.style.top=t.top,this.info.style.bottom=t.bottom,this.info.style.maxWidth=t.maxWidth,this.info.className="cm-tooltip cm-completionInfo cm-completionInfo-"+t.class):this.info.style.top="-1e6px")}createListBox(t,e,i){const s=document.createElement("ul");s.id=e,s.setAttribute("role","listbox"),s.setAttribute("aria-expanded","true"),s.setAttribute("aria-label",this.view.state.phrase("Completions"));for(let n=i.from;n<i.to;n++){let{completion:i,match:r}=t[n];const o=s.appendChild(document.createElement("li"));o.id=e+"-"+n,o.setAttribute("role","option");let a=this.optionClass(i);a&&(o.className=a);for(let t of this.optionContent){let e=t(i,this.view.state,r);e&&o.appendChild(e)}}return i.from&&s.classList.add("cm-completionListIncompleteTop"),i.to<t.length&&s.classList.add("cm-completionListIncompleteBottom"),s}}function wx(t){return e=>new Ox(e,t)}function Sx(t){return 100*(t.boost||0)+(t.apply?10:0)+(t.info?5:0)+(t.type?1:0)}class kx{constructor(t,e,i,s,n,r){this.options=t,this.attrs=e,this.tooltip=i,this.timestamp=s,this.selected=n,this.disabled=r}setSelected(t,e){return t==this.selected||t>=this.options.length?this:new kx(this.options,Mx(e,t),this.tooltip,this.timestamp,t,this.disabled)}static build(t,e,i,s,n){let r=function(t,e){let i=[],s=0;for(let n of t)if(n.hasResult())if(!1===n.result.filter){let t=n.result.getMatch;for(let e of n.result.options){let r=[1e9-s++];if(t)for(let i of t(e))r.push(i);i.push(new ux(e,n,r))}}else{let t,s=new yx(e.sliceDoc(n.from,n.to));for(let e of n.result.options)(t=s.match(e.label))&&(null!=e.boost&&(t[0]+=e.boost),i.push(new ux(e,n,t)))}let n=[],r=null,o=e.facet(bx).compareCompletions;for(let t of i.sort(((t,e)=>e.match[0]-t.match[0]||o(t.completion,e.completion))))!r||r.label!=t.completion.label||r.detail!=t.completion.detail||null!=r.type&&null!=t.completion.type&&r.type!=t.completion.type||r.apply!=t.completion.apply?n.push(t):Sx(t.completion)>Sx(r)&&(n[n.length-1]=t),r=t.completion;return n}(t,e);if(!r.length)return s&&t.some((t=>1==t.state))?new kx(s.options,s.attrs,s.tooltip,s.timestamp,s.selected,!0):null;let o=e.facet(bx).selectOnOpen?0:-1;if(s&&s.selected!=o&&-1!=s.selected){let t=s.options[s.selected].completion;for(let e=0;e<r.length;e++)if(r[e].completion==t){o=e;break}}return new kx(r,Mx(i,o),{pos:t.reduce(((t,e)=>e.hasResult()?Math.min(t,e.from):t),1e8),create:wx(Ix),above:n.aboveCursor},s?s.timestamp:Date.now(),o,!1)}map(t){return new kx(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:t.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}}class Ax{constructor(t,e,i){this.active=t,this.id=e,this.open=i}static start(){return new Ax(Px,"cm-ac-"+Math.floor(2e6*Math.random()).toString(36),null)}update(t){let{state:e}=t,i=e.facet(bx),s=(i.override||e.languageDataAt("autocomplete",dx(e)).map(vx)).map((e=>(this.active.find((t=>t.source==e))||new _x(e,this.active.some((t=>0!=t.state))?1:0)).update(t,i)));s.length==this.active.length&&s.every(((t,e)=>t==this.active[e]))&&(s=this.active);let n=this.open;t.selection||s.some((e=>e.hasResult()&&t.changes.touchesRange(e.from,e.to)))||!function(t,e){if(t==e)return!0;for(let i=0,s=0;;){for(;i<t.length&&!t[i].hasResult;)i++;for(;s<e.length&&!e[s].hasResult;)s++;let n=i==t.length,r=s==e.length;if(n||r)return n==r;if(t[i++].result!=e[s++].result)return!1}}(s,this.active)?n=kx.build(s,e,this.id,this.open,i):n&&n.disabled&&!s.some((t=>1==t.state))?n=null:n&&t.docChanged&&(n=n.map(t.changes)),!n&&s.every((t=>1!=t.state))&&s.some((t=>t.hasResult()))&&(s=s.map((t=>t.hasResult()?new _x(t.source,0):t)));for(let e of t.effects)e.is(Fx)&&(n=n&&n.setSelected(e.value,this.id));return s==this.active&&n==this.open?this:new Ax(s,this.id,n)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:Tx}}const Tx={"aria-autocomplete":"list"};function Mx(t,e){let i={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":t};return e>-1&&(i["aria-activedescendant"]=t+"-"+e),i}const Px=[];function Cx(t){return t.isUserEvent("input.type")?"input":t.isUserEvent("delete.backward")?"delete":null}class _x{constructor(t,e,i=-1){this.source=t,this.state=e,this.explicitPos=i}hasResult(){return!1}update(t,e){let i=Cx(t),s=this;i?s=s.handleUserEvent(t,i,e):t.docChanged?s=s.handleChange(t):t.selection&&0!=s.state&&(s=new _x(s.source,0));for(let e of t.effects)if(e.is(Ex))s=new _x(s.source,1,e.value?dx(t.state):-1);else if(e.is(Qx))s=new _x(s.source,0);else if(e.is(Lx))for(let t of e.value)t.source==s.source&&(s=t);return s}handleUserEvent(t,e,i){return"delete"!=e&&i.activateOnTyping?new _x(this.source,1):this.map(t.changes)}handleChange(t){return t.changes.touchesRange(dx(t.startState))?new _x(this.source,0):this.map(t.changes)}map(t){return t.empty||this.explicitPos<0?this:new _x(this.source,this.state,t.mapPos(this.explicitPos))}}class Rx extends _x{constructor(t,e,i,s,n){super(t,2,e),this.result=i,this.from=s,this.to=n}hasResult(){return!0}handleUserEvent(t,e,i){var s;let n=t.changes.mapPos(this.from),r=t.changes.mapPos(this.to,1),o=dx(t.state);if((this.explicitPos<0?o<=n:o<this.from)||o>r||"delete"==e&&dx(t.startState)==this.from)return new _x(this.source,"input"==e&&i.activateOnTyping?1:0);let a,l=this.explicitPos<0?-1:t.changes.mapPos(this.explicitPos);return function(t,e,i,s){if(!t)return!1;let n=e.sliceDoc(i,s);return"function"==typeof t?t(n,i,s,e):px(t,!0).test(n)}(this.result.validFor,t.state,n,r)?new Rx(this.source,l,this.result,n,r):this.result.update&&(a=this.result.update(this.result,n,r,new lx(t.state,o,l>=0)))?new Rx(this.source,l,a,a.from,null!==(s=a.to)&&void 0!==s?s:dx(t.state)):new _x(this.source,1,l)}handleChange(t){return t.changes.touchesRange(this.from,this.to)?new _x(this.source,0):this.map(t.changes)}map(t){return t.empty?this:new Rx(this.source,this.explicitPos<0?-1:t.mapPos(this.explicitPos),this.result,t.mapPos(this.from),t.mapPos(this.to,1))}}const Ex=dc.define(),Qx=dc.define(),Lx=dc.define({map:(t,e)=>t.map((t=>t.map(e)))}),Fx=dc.define(),Ix=$h.define({create:()=>Ax.start(),update:(t,e)=>t.update(e),provide:t=>[Am.from(t,(t=>t.tooltip)),Cf.contentAttributes.from(t,(t=>t.attrs))]});function Dx(t,e="option"){return i=>{let s=i.state.field(Ix,!1);if(!s||!s.open||s.open.disabled||Date.now()-s.open.timestamp<i.state.facet(bx).interactionDelay)return!1;let n,r=1;"page"==e&&(n=function(t,e){let i=t.plugin(wm);if(!i)return null;let s=i.manager.tooltips.indexOf(e);return s<0?null:i.manager.tooltipViews[s]}(i,s.open.tooltip))&&(r=Math.max(2,Math.floor(n.dom.offsetHeight/n.dom.querySelector("li").offsetHeight)-1));let{length:o}=s.open.options,a=s.open.selected>-1?s.open.selected+r*(t?1:-1):t?0:o-1;return a<0?a="page"==e?0:o-1:a>=o&&(a="page"==e?o-1:0),i.dispatch({effects:Fx.of(a)}),!0}}class Ux{constructor(t,e){this.active=t,this.context=e,this.time=Date.now(),this.updates=[],this.done=void 0}}Md.fromClass(class{constructor(t){this.view=t,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let e of t.state.field(Ix).active)1==e.state&&this.startQuery(e)}update(t){let e=t.state.field(Ix);if(!t.selectionSet&&!t.docChanged&&t.startState.field(Ix)==e)return;let i=t.transactions.some((t=>(t.selection||t.docChanged)&&!Cx(t)));for(let e=0;e<this.running.length;e++){let s=this.running[e];if(i||s.updates.length+t.transactions.length>50&&Date.now()-s.time>1e3){for(let e of s.context.abortListeners)try{e()}catch(t){Sd(this.view.state,t)}s.context.abortListeners=null,this.running.splice(e--,1)}else s.updates.push(...t.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=e.active.some((t=>1==t.state&&!this.running.some((e=>e.active.source==t.source))))?setTimeout((()=>this.startUpdate()),50):-1,0!=this.composing)for(let e of t.transactions)"input"==Cx(e)?this.composing=2:2==this.composing&&e.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:t}=this.view,e=t.field(Ix);for(let t of e.active)1!=t.state||this.running.some((e=>e.active.source==t.source))||this.startQuery(t)}startQuery(t){let{state:e}=this.view,i=dx(e),s=new lx(e,i,t.explicitPos==i),n=new Ux(t,s);this.running.push(n),Promise.resolve(t.source(s)).then((t=>{n.context.aborted||(n.done=t||null,this.scheduleAccept())}),(t=>{this.view.dispatch({effects:Qx.of(null)}),Sd(this.view.state,t)}))}scheduleAccept(){this.running.every((t=>void 0!==t.done))?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout((()=>this.accept()),50))}accept(){var t;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],i=this.view.state.facet(bx);for(let s=0;s<this.running.length;s++){let n=this.running[s];if(void 0===n.done)continue;if(this.running.splice(s--,1),n.done){let s=new Rx(n.active.source,n.active.explicitPos,n.done,n.done.from,null!==(t=n.done.to)&&void 0!==t?t:dx(n.updates.length?n.updates[0].startState:this.view.state));for(let t of n.updates)s=s.update(t,i);if(s.hasResult()){e.push(s);continue}}let r=this.view.state.field(Ix).active.find((t=>t.source==n.active.source));if(r&&1==r.state)if(null==n.done){let t=new _x(n.active.source,0);for(let e of n.updates)t=t.update(e,i);1!=t.state&&e.push(t)}else this.startQuery(r)}e.length&&this.view.dispatch({effects:Lx.of(e)})}},{eventHandlers:{blur(){let t=this.view.state.field(Ix,!1);t&&t.tooltip&&this.view.state.facet(bx).closeOnBlur&&this.view.dispatch({effects:Qx.of(null)})},compositionstart(){this.composing=1},compositionend(){3==this.composing&&setTimeout((()=>this.view.dispatch({effects:Ex.of(!1)})),20),this.composing=0}}});const zx=Cf.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'""',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"''"}},".cm-completionIcon-class":{"&:after":{content:"''"}},".cm-completionIcon-interface":{"&:after":{content:"''"}},".cm-completionIcon-variable":{"&:after":{content:"''"}},".cm-completionIcon-constant":{"&:after":{content:"''"}},".cm-completionIcon-type":{"&:after":{content:"''"}},".cm-completionIcon-enum":{"&:after":{content:"''"}},".cm-completionIcon-property":{"&:after":{content:"''"}},".cm-completionIcon-keyword":{"&:after":{content:"''"}},".cm-completionIcon-namespace":{"&:after":{content:"''"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class Nx{constructor(t,e,i,s){this.field=t,this.line=e,this.from=i,this.to=s}}class Vx{constructor(t,e,i){this.field=t,this.from=e,this.to=i}map(t){let e=t.mapPos(this.from,-1,Sh.TrackDel),i=t.mapPos(this.to,1,Sh.TrackDel);return null==e||null==i?null:new Vx(this.field,e,i)}}class Bx{constructor(t,e){this.lines=t,this.fieldPositions=e}instantiate(t,e){let i=[],s=[e],n=t.doc.lineAt(e),r=/^\s*/.exec(n.text)[0];for(let n of this.lines){if(i.length){let i=r,o=/^\t*/.exec(n)[0].length;for(let e=0;e<o;e++)i+=t.facet(Sv);s.push(e+i.length-o),n=i+n.slice(o)}i.push(n),e+=n.length+1}return{text:i,ranges:this.fieldPositions.map((t=>new Vx(t.field,s[t.line]+t.from,s[t.line]+t.to)))}}static parse(t){let e,i=[],s=[],n=[];for(let r of t.split(/\r\n?|\n/)){for(;e=/[#$]\{(?:(\d+)(?::([^}]*))?|([^}]*))\}/.exec(r);){let t=e[1]?+e[1]:null,o=e[2]||e[3]||"",a=-1;for(let e=0;e<i.length;e++)(null!=t?i[e].seq==t:o&&i[e].name==o)&&(a=e);if(a<0){let e=0;for(;e<i.length&&(null==t||null!=i[e].seq&&i[e].seq<t);)e++;i.splice(e,0,{seq:t,name:o}),a=e;for(let t of n)t.field>=a&&t.field++}n.push(new Nx(a,s.length,e.index,e.index+o.length)),r=r.slice(0,e.index)+o+r.slice(e.index+e[0].length)}for(let t;t=/\\([{}])/.exec(r);){r=r.slice(0,t.index)+t[1]+r.slice(t.index+t[0].length);for(let e of n)e.line==s.length&&e.from>t.index&&(e.from--,e.to--)}s.push(r)}return new Bx(s,n)}}let $x=id.widget({widget:new class extends td{toDOM(){let t=document.createElement("span");return t.className="cm-snippetFieldPosition",t}ignoreEvent(){return!1}}}),Xx=id.mark({class:"cm-snippetField"});class jx{constructor(t,e){this.ranges=t,this.active=e,this.deco=id.set(t.map((t=>(t.from==t.to?$x:Xx).range(t.from,t.to))))}map(t){let e=[];for(let i of this.ranges){let s=i.map(t);if(!s)return null;e.push(s)}return new jx(e,this.active)}selectionInsideField(t){return t.ranges.every((t=>this.ranges.some((e=>e.field==this.active&&e.from<=t.from&&e.to>=t.to))))}}const Gx=dc.define({map:(t,e)=>t&&t.map(e)}),Zx=dc.define(),qx=$h.define({create:()=>null,update(t,e){for(let i of e.effects){if(i.is(Gx))return i.value;if(i.is(Zx)&&t)return new jx(t.ranges,i.value)}return t&&e.docChanged&&(t=t.map(e.changes)),t&&e.selection&&!t.selectionInsideField(e.selection)&&(t=null),t},provide:t=>Cf.decorations.from(t,(t=>t?t.deco:id.none))});function Wx(t,e){return Qh.create(t.filter((t=>t.field==e)).map((t=>Qh.range(t.from,t.to))))}function Hx(t){let e=Bx.parse(t);return(t,i,s,n)=>{let{text:r,ranges:o}=e.instantiate(t.state,s),a={changes:{from:s,to:n,insert:eh.of(r)},scrollIntoView:!0};if(o.length&&(a.selection=Wx(o,0)),o.length>1){let e=new jx(o,0),i=a.effects=[Gx.of(e)];void 0===t.state.field(qx,!1)&&i.push(dc.appendConfig.of([qx,tO,iO,zx]))}t.dispatch(t.state.update(a))}}function Yx(t){return({state:e,dispatch:i})=>{let s=e.field(qx,!1);if(!s||t<0&&0==s.active)return!1;let n=s.active+t,r=t>0&&!s.ranges.some((e=>e.field==n+t));return i(e.update({selection:Wx(s.ranges,n),effects:Gx.of(r?null:new jx(s.ranges,n))})),!0}}const Kx=[{key:"Tab",run:Yx(1),shift:Yx(-1)},{key:"Escape",run:({state:t,dispatch:e})=>!!t.field(qx,!1)&&(e(t.update({effects:Gx.of(null)})),!0)}],Jx=Ih.define({combine:t=>t.length?t[0]:Kx}),tO=Wh.highest(Df.compute([Jx],(t=>t.facet(Jx))));function eO(t,e){return Object.assign(Object.assign({},e),{apply:Hx(t)})}const iO=Cf.domEventHandlers({mousedown(t,e){let i,s=e.state.field(qx,!1);if(!s||null==(i=e.posAtCoords({x:t.clientX,y:t.clientY})))return!1;let n=s.ranges.find((t=>t.from<=i&&t.to>=i));return!(!n||n.field==s.active||(e.dispatch({selection:Wx(s.ranges,n.field),effects:Gx.of(s.ranges.some((t=>t.field>n.field))?new jx(s.ranges,n.field):null)}),0))}}),sO={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},nO=dc.define({map(t,e){let i=e.mapPos(t,-1,Sh.TrackAfter);return null==i?void 0:i}}),rO=dc.define({map:(t,e)=>e.mapPos(t)}),oO=new class extends Tc{};oO.startSide=1,oO.endSide=-1;const aO=$h.define({create:()=>_c.empty,update(t,e){if(e.selection){let i=e.state.doc.lineAt(e.selection.main.head).from,s=e.startState.doc.lineAt(e.startState.selection.main.head).from;i!=e.changes.mapPos(s,-1)&&(t=_c.empty)}t=t.map(e.changes);for(let i of e.effects)i.is(nO)?t=t.update({add:[oO.range(i.value,i.value+1)]}):i.is(rO)&&(t=t.update({filter:t=>t!=i.value}));return t}});const lO="()[]{}<>";function hO(t){for(let e=0;e<lO.length;e+=2)if(lO.charCodeAt(e)==t)return lO.charAt(e+1);return xh(t<128?t:t+1)}function cO(t,e){return t.languageDataAt("closeBrackets",e)[0]||sO}const uO="object"==typeof navigator&&/Android\b/.test(navigator.userAgent),dO=Cf.inputHandler.of(((t,e,i,s)=>{if((uO?t.composing:t.compositionStarted)||t.state.readOnly)return!1;let n=t.state.selection.main;if(s.length>2||2==s.length&&1==Oh(bh(s,0))||e!=n.from||i!=n.to)return!1;let r=function(t,e){let i=cO(t,t.selection.main.head),s=i.brackets||sO.brackets;for(let n of s){let r=hO(bh(n,0));if(e==n)return r==n?yO(t,n,s.indexOf(n+n+n)>-1,i):gO(t,n,r,i.before||sO.before);if(e==r&&fO(t,t.selection.main.from))return vO(t,n,r)}return null}(t.state,s);return!!r&&(t.dispatch(r),!0)})),pO=[{key:"Backspace",run:({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=cO(t,t.selection.main.head).brackets||sO.brackets,s=null,n=t.changeByRange((e=>{if(e.empty){let s=function(t,e){let i=t.sliceString(e-2,e);return Oh(bh(i,0))==i.length?i:i.slice(1)}(t.doc,e.head);for(let n of i)if(n==s&&mO(t.doc,e.head)==hO(bh(n,0)))return{changes:{from:e.head-n.length,to:e.head+n.length},range:Qh.cursor(e.head-n.length)}}return{range:s=e}}));return s||e(t.update(n,{scrollIntoView:!0,userEvent:"delete.backward"})),!s}}];function fO(t,e){let i=!1;return t.field(aO).between(0,t.doc.length,(t=>{t==e&&(i=!0)})),i}function mO(t,e){let i=t.sliceString(e,e+2);return i.slice(0,Oh(bh(i,0)))}function gO(t,e,i,s){let n=null,r=t.changeByRange((r=>{if(!r.empty)return{changes:[{insert:e,from:r.from},{insert:i,from:r.to}],effects:nO.of(r.to+e.length),range:Qh.range(r.anchor+e.length,r.head+e.length)};let o=mO(t.doc,r.head);return!o||/\s/.test(o)||s.indexOf(o)>-1?{changes:{insert:e+i,from:r.head},effects:nO.of(r.head+e.length),range:Qh.cursor(r.head+e.length)}:{range:n=r}}));return n?null:t.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function vO(t,e,i){let s=null,n=t.selection.ranges.map((e=>e.empty&&mO(t.doc,e.head)==i?Qh.cursor(e.head+i.length):s=e));return s?null:t.update({selection:Qh.create(n,t.selection.mainIndex),scrollIntoView:!0,effects:t.selection.ranges.map((({from:t})=>rO.of(t)))})}function yO(t,e,i,s){let n=s.stringPrefixes||sO.stringPrefixes,r=null,o=t.changeByRange((s=>{if(!s.empty)return{changes:[{insert:e,from:s.from},{insert:e,from:s.to}],effects:nO.of(s.to+e.length),range:Qh.range(s.anchor+e.length,s.head+e.length)};let o,a=s.head,l=mO(t.doc,a);if(l==e){if(bO(t,a))return{changes:{insert:e+e,from:a},effects:nO.of(a+e.length),range:Qh.cursor(a+e.length)};if(fO(t,a)){let s=i&&t.sliceDoc(a,a+3*e.length)==e+e+e;return{range:Qh.cursor(a+e.length*(s?3:1)),effects:rO.of(a)}}}else{if(i&&t.sliceDoc(a-2*e.length,a)==e+e&&(o=xO(t,a-2*e.length,n))>-1&&bO(t,o))return{changes:{insert:e+e+e+e,from:a},effects:nO.of(a+e.length),range:Qh.cursor(a+e.length)};if(t.charCategorizer(a)(l)!=xc.Word&&xO(t,a,n)>-1&&!function(t,e,i,s){let n=dv(t).resolveInner(e,-1),r=s.reduce(((t,e)=>Math.max(t,e.length)),0);for(let o=0;o<5;o++){let o=t.sliceDoc(n.from,Math.min(n.to,n.from+i.length+r)),a=o.indexOf(i);if(!a||a>-1&&s.indexOf(o.slice(0,a))>-1){let e=n.firstChild;for(;e&&e.from==n.from&&e.to-e.from>i.length+a;){if(t.sliceDoc(e.to-i.length,e.to)==i)return!1;e=e.firstChild}return!0}let l=n.to==e&&n.parent;if(!l)break;n=l}return!1}(t,a,e,n))return{changes:{insert:e+e,from:a},effects:nO.of(a+e.length),range:Qh.cursor(a+e.length)}}return{range:r=s}}));return r?null:t.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function bO(t,e){let i=dv(t).resolveInner(e+1);return i.parent&&i.from==e}function xO(t,e,i){let s=t.charCategorizer(e);if(s(t.sliceDoc(e-1,e))!=xc.Word)return e;for(let n of i){let i=e-n.length;if(t.sliceDoc(i,e)==n&&s(t.sliceDoc(i-1,i))!=xc.Word)return i}return-1}const OO=[{key:"Ctrl-Space",run:t=>!!t.state.field(Ix,!1)&&(t.dispatch({effects:Ex.of(!0)}),!0)},{key:"Escape",run:t=>{let e=t.state.field(Ix,!1);return!(!e||!e.active.some((t=>0!=t.state))||(t.dispatch({effects:Qx.of(null)}),0))}},{key:"ArrowDown",run:Dx(!0)},{key:"ArrowUp",run:Dx(!1)},{key:"PageDown",run:Dx(!0,"page")},{key:"PageUp",run:Dx(!1,"page")},{key:"Enter",run:t=>{let e=t.state.field(Ix,!1);return!(t.state.readOnly||!e||!e.open||e.open.selected<0||Date.now()-e.open.timestamp<t.state.facet(bx).interactionDelay||(e.open.disabled||mx(t,e.open.options[e.open.selected]),0))}}];function wO(){var t=arguments[0];"string"==typeof t&&(t=document.createElement(t));var e=1,i=arguments[1];if(i&&"object"==typeof i&&null==i.nodeType&&!Array.isArray(i)){for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){var n=i[s];"string"==typeof n?t.setAttribute(s,n):null!=n&&(t[s]=n)}e++}for(;e<arguments.length;e++)SO(t,arguments[e]);return t}function SO(t,e){if("string"==typeof e)t.appendChild(document.createTextNode(e));else if(null==e);else if(null!=e.nodeType)t.appendChild(e);else{if(!Array.isArray(e))throw new RangeError("Unsupported child node: "+e);for(var i=0;i<e.length;i++)SO(t,e[i])}}Wh.highest(Df.computeN([bx],(t=>t.facet(bx).defaultKeymap?[OO]:[])));class kO{constructor(t,e,i){this.from=t,this.to=e,this.diagnostic=i}}class AO{constructor(t,e,i){this.diagnostics=t,this.panel=e,this.selected=i}static init(t,e,i){let s=t,n=i.facet(UO).markerFilter;n&&(s=n(s));let r=id.set(s.map((t=>t.from==t.to||t.from==t.to-1&&i.doc.lineAt(t.from).to==t.from?id.widget({widget:new VO(t),diagnostic:t}).range(t.from):id.mark({attributes:{class:"cm-lintRange cm-lintRange-"+t.severity},diagnostic:t}).range(t.from,t.to))),!0);return new AO(r,e,TO(r))}}function TO(t,e=null,i=0){let s=null;return t.between(i,1e9,((t,i,{spec:n})=>{if(!e||n.diagnostic==e)return s=new kO(t,i,n.diagnostic),!1})),s}function MO(t,e){return!(!t.effects.some((t=>t.is(CO)))&&!t.changes.touchesRange(e.pos))}function PO(t,e){return t.field(EO,!1)?e:e.concat(dc.appendConfig.of([EO,Cf.decorations.compute([EO],(t=>{let{selected:e,panel:i}=t.field(EO);return e&&i&&e.from!=e.to?id.set([QO.range(e.from,e.to)]):id.none})),Rm(LO,{hideOn:MO}),GO]))}const CO=dc.define(),_O=dc.define(),RO=dc.define(),EO=$h.define({create:()=>new AO(id.none,null,null),update(t,e){if(e.docChanged){let i=t.diagnostics.map(e.changes),s=null;if(t.selected){let n=e.changes.mapPos(t.selected.from,1);s=TO(i,t.selected.diagnostic,n)||TO(i,null,n)}t=new AO(i,t.panel,s)}for(let i of e.effects)i.is(CO)?t=AO.init(i.value,t.panel,e.state):i.is(_O)?t=new AO(t.diagnostics,i.value?$O.open:null,t.selected):i.is(RO)&&(t=new AO(t.diagnostics,t.panel,i.value));return t},provide:t=>[Dm.from(t,(t=>t.panel)),Cf.decorations.from(t,(t=>t.diagnostics))]}),QO=id.mark({class:"cm-lintRange cm-lintRange-active"});function LO(t,e,i){let{diagnostics:s}=t.state.field(EO),n=[],r=2e8,o=0;s.between(e-(i<0?1:0),e+(i>0?1:0),((t,s,{spec:a})=>{e>=t&&e<=s&&(t==s||(e>t||i>0)&&(e<s||i<0))&&(n.push(a.diagnostic),r=Math.min(t,r),o=Math.max(s,o))}));let a=t.state.facet(UO).tooltipFilter;return a&&(n=a(n)),n.length?{pos:r,end:o,above:t.state.doc.lineAt(r).to<o,create:()=>({dom:FO(t,n)})}:null}function FO(t,e){return wO("ul",{class:"cm-tooltip-lint"},e.map((e=>NO(t,e,!1))))}const IO=t=>{let e=t.state.field(EO,!1);return!(!e||!e.panel||(t.dispatch({effects:_O.of(!1)}),0))},DO=Md.fromClass(class{constructor(t){this.view=t,this.timeout=-1,this.set=!0;let{delay:e}=t.state.facet(UO);this.lintTime=Date.now()+e,this.run=this.run.bind(this),this.timeout=setTimeout(this.run,e)}run(){let t=Date.now();if(t<this.lintTime-10)setTimeout(this.run,this.lintTime-t);else{this.set=!1;let{state:t}=this.view,{sources:e}=t.facet(UO);Promise.all(e.map((t=>Promise.resolve(t(this.view))))).then((e=>{let i=e.reduce(((t,e)=>t.concat(e)));this.view.state.doc==t.doc&&this.view.dispatch(function(t,e){return{effects:PO(t,[CO.of(e)])}}(this.view.state,i))}),(t=>{Sd(this.view.state,t)}))}}update(t){let e=t.state.facet(UO);(t.docChanged||e!=t.startState.facet(UO))&&(this.lintTime=Date.now()+e.delay,this.set||(this.set=!0,this.timeout=setTimeout(this.run,e.delay)))}force(){this.set&&(this.lintTime=Date.now(),this.run())}destroy(){clearTimeout(this.timeout)}}),UO=Ih.define({combine:t=>Object.assign({sources:t.map((t=>t.source))},Ac(t.map((t=>t.config)),{delay:750,markerFilter:null,tooltipFilter:null})),enables:DO});function zO(t){let e=[];if(t)t:for(let{name:i}of t){for(let t=0;t<i.length;t++){let s=i[t];if(/[a-zA-Z]/.test(s)&&!e.some((t=>t.toLowerCase()==s.toLowerCase()))){e.push(s);continue t}}e.push("")}return e}function NO(t,e,i){var s;let n=i?zO(e.actions):[];return wO("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},wO("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage():e.message),null===(s=e.actions)||void 0===s?void 0:s.map(((i,s)=>{let r=s=>{s.preventDefault();let n=TO(t.state.field(EO).diagnostics,e);n&&i.apply(t,n.from,n.to)},{name:o}=i,a=n[s]?o.indexOf(n[s]):-1,l=a<0?o:[o.slice(0,a),wO("u",o.slice(a,a+1)),o.slice(a+1)];return wO("button",{type:"button",class:"cm-diagnosticAction",onclick:r,onmousedown:r,"aria-label":` Action: ${o}${a<0?"":` (access key "${n[s]})"`}.`},l)})),e.source&&wO("div",{class:"cm-diagnosticSource"},e.source))}class VO extends td{constructor(t){super(),this.diagnostic=t}eq(t){return t.diagnostic==this.diagnostic}toDOM(){return wO("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class BO{constructor(t,e){this.diagnostic=e,this.id="item_"+Math.floor(4294967295*Math.random()).toString(16),this.dom=NO(t,e,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class $O{constructor(t){this.view=t,this.items=[],this.list=wO("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:e=>{if(27==e.keyCode)IO(this.view),this.view.focus();else if(38==e.keyCode||33==e.keyCode)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(40==e.keyCode||34==e.keyCode)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(36==e.keyCode)this.moveSelection(0);else if(35==e.keyCode)this.moveSelection(this.items.length-1);else if(13==e.keyCode)this.view.focus();else{if(!(e.keyCode>=65&&e.keyCode<=90&&this.selectedIndex>=0))return;{let{diagnostic:i}=this.items[this.selectedIndex],s=zO(i.actions);for(let n=0;n<s.length;n++)if(s[n].toUpperCase().charCodeAt(0)==e.keyCode){let e=TO(this.view.state.field(EO).diagnostics,i);e&&i.actions[n].apply(t,e.from,e.to)}}}e.preventDefault()},onclick:t=>{for(let e=0;e<this.items.length;e++)this.items[e].dom.contains(t.target)&&this.moveSelection(e)}}),this.dom=wO("div",{class:"cm-panel-lint"},this.list,wO("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>IO(this.view)},"")),this.update()}get selectedIndex(){let t=this.view.state.field(EO).selected;if(!t)return-1;for(let e=0;e<this.items.length;e++)if(this.items[e].diagnostic==t.diagnostic)return e;return-1}update(){let{diagnostics:t,selected:e}=this.view.state.field(EO),i=0,s=!1,n=null;for(t.between(0,this.view.state.doc.length,((t,r,{spec:o})=>{let a,l=-1;for(let t=i;t<this.items.length;t++)if(this.items[t].diagnostic==o.diagnostic){l=t;break}l<0?(a=new BO(this.view,o.diagnostic),this.items.splice(i,0,a),s=!0):(a=this.items[l],l>i&&(this.items.splice(i,l-i),s=!0)),e&&a.diagnostic==e.diagnostic?a.dom.hasAttribute("aria-selected")||(a.dom.setAttribute("aria-selected","true"),n=a):a.dom.hasAttribute("aria-selected")&&a.dom.removeAttribute("aria-selected"),i++}));i<this.items.length&&!(1==this.items.length&&this.items[0].diagnostic.from<0);)s=!0,this.items.pop();0==this.items.length&&(this.items.push(new BO(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),s=!0),n?(this.list.setAttribute("aria-activedescendant",n.id),this.view.requestMeasure({key:this,read:()=>({sel:n.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:t,panel:e})=>{t.top<e.top?this.list.scrollTop-=e.top-t.top:t.bottom>e.bottom&&(this.list.scrollTop+=t.bottom-e.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),s&&this.sync()}sync(){let t=this.list.firstChild;function e(){let e=t;t=e.nextSibling,e.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;t!=i.dom;)e();t=i.dom.nextSibling}else this.list.insertBefore(i.dom,t);for(;t;)e()}moveSelection(t){if(this.selectedIndex<0)return;let e=TO(this.view.state.field(EO).diagnostics,this.items[t].diagnostic);e&&this.view.dispatch({selection:{anchor:e.from,head:e.to},scrollIntoView:!0,effects:RO.of(e)})}static open(t){return new $O(t)}}function XO(t,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(t)}</svg>')`}function jO(t){return XO(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${t}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const GO=Cf.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:jO("#d11")},".cm-lintRange-warning":{backgroundImage:jO("orange")},".cm-lintRange-info":{backgroundImage:jO("#999")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});class ZO extends Um{constructor(t){super(),this.diagnostics=t,this.severity=t.reduce(((t,e)=>{let i=e.severity;return"error"==i||"warning"==i&&"info"==t?i:t}),"info")}toDOM(t){let e=document.createElement("div");e.className="cm-lint-marker cm-lint-marker-"+this.severity;let i=this.diagnostics,s=t.state.facet(tw).tooltipFilter;return s&&(i=s(i)),i.length&&(e.onmouseover=()=>function(t,e,i){function s(){let s=t.elementAtHeight(e.getBoundingClientRect().top+5-t.documentTop);t.coordsAtPos(s.from)&&t.dispatch({effects:YO.of({pos:s.from,above:!1,create:()=>({dom:FO(t,i),getCoords:()=>e.getBoundingClientRect()})})}),e.onmouseout=e.onmousemove=null,function(t,e){let i=s=>{let n=e.getBoundingClientRect();if(!(s.clientX>n.left-10&&s.clientX<n.right+10&&s.clientY>n.top-10&&s.clientY<n.bottom+10)){for(let t=s.target;t;t=t.parentNode)if(1==t.nodeType&&t.classList.contains("cm-tooltip-lint"))return;window.removeEventListener("mousemove",i),t.state.field(KO)&&t.dispatch({effects:YO.of(null)})}};window.addEventListener("mousemove",i)}(t,e)}let{hoverTime:n}=t.state.facet(tw),r=setTimeout(s,n);e.onmouseout=()=>{clearTimeout(r),e.onmouseout=e.onmousemove=null},e.onmousemove=()=>{clearTimeout(r),r=setTimeout(s,n)}}(t,e,i)),e}}function qO(t,e){let i=Object.create(null);for(let s of e){let e=t.lineAt(s.from);(i[e.from]||(i[e.from]=[])).push(s)}let s=[];for(let t in i)s.push(new ZO(i[t]).range(+t));return _c.of(s,!0)}const WO=Bm({class:"cm-gutter-lint",markers:t=>t.state.field(HO)}),HO=$h.define({create:()=>_c.empty,update(t,e){t=t.map(e.changes);let i=e.state.facet(tw).markerFilter;for(let s of e.effects)if(s.is(CO)){let n=s.value;i&&(n=i(n||[])),t=qO(e.state.doc,n.slice(0))}return t}}),YO=dc.define(),KO=$h.define({create:()=>null,update:(t,e)=>(t&&e.docChanged&&(t=MO(e,t)?null:Object.assign(Object.assign({},t),{pos:e.changes.mapPos(t.pos)})),e.effects.reduce(((t,e)=>e.is(YO)?e.value:t),t)),provide:t=>Am.from(t)}),JO=Cf.baseTheme({".cm-gutter-lint":{width:"1.4em","& .cm-gutterElement":{padding:".2em"}},".cm-lint-marker":{width:"1em",height:"1em"},".cm-lint-marker-info":{content:XO('<path fill="#aaf" stroke="#77e" stroke-width="6" stroke-linejoin="round" d="M5 5L35 5L35 35L5 35Z"/>')},".cm-lint-marker-warning":{content:XO('<path fill="#fe8" stroke="#fd7" stroke-width="6" stroke-linejoin="round" d="M20 6L37 35L3 35Z"/>')},".cm-lint-marker-error":{content:XO('<circle cx="20" cy="20" r="15" fill="#f87" stroke="#f43" stroke-width="6"/>')}}),tw=Ih.define({combine:t=>Ac(t,{hoverTime:300,markerFilter:null,tooltipFilter:null})});function ew(t={}){return[tw.of(t),HO,WO,JO,KO]}const iw="#a6e22c",sw="#67d8ef",nw="#f8f8f2",rw="#75715e",ow="#ae81ff",aw="#FFFFFF",lw=[Cf.theme({"&":{color:nw,backgroundColor:"#282923",fontSize:"15px",lineHeight:"16px",fontFamily:"Consolas, Menlo, Courier, monospace"},"& ::-webkit-scrollbar":{width:"15px",height:"15px"},"& ::-webkit-scrollbar-track":{background:"none"},"& ::-webkit-scrollbar-thumb":{backgroundColor:"#555652",width:"7px",border:"4px solid #282923"},"& ::-webkit-scrollbar-corner":{backgroundColor:"rgba(0,0,0,0)"},".cm-content":{caretColor:aw},"&.cm-editor":{height:"100%",width:"100%",fontSize:"15px",fontFamily:"Consolas, Menlo, Courier, monospace"},".cm-scroller":{lineHeight:"19px"},".cm-cursor, .cm-dropCursor":{borderLeftColor:aw},"&.cm-focused .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:"#3b3b32"},".cm-panels":{backgroundColor:"#21252b",color:nw},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:"#282923",color:"#90918b",border:"none"},".cm-activeLineGutter":{color:"#dadad3",backgroundColor:"#3e3d32"},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:"#353a42"},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:"#353a42",borderBottomColor:"#353a42"},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:"#3e3d32",color:nw}}},{dark:!0}),hy(ry.define([{tag:ov.keyword,color:sw},{tag:[ov.name,ov.deleted,ov.character,ov.macroName],color:iw},{tag:[ov.propertyName,ov.punctuation],color:nw},{tag:[ov.function(ov.variableName),ov.labelName],color:sw},{tag:[ov.color,ov.constant(ov.name),ov.standard(ov.name)],color:"#d19a66"},{tag:[ov.definition(ov.name),ov.separator],color:nw},{tag:[ov.typeName,ov.className,ov.number,ov.changed,ov.annotation,ov.modifier,ov.self,ov.namespace],color:ow},{tag:[ov.logicOperator,ov.arithmeticOperator,ov.bitwiseOperator,ov.typeOperator],color:"#f92472"},{tag:[ov.meta,ov.comment],color:rw},{tag:ov.strong,fontWeight:"bold"},{tag:ov.emphasis,fontStyle:"italic"},{tag:ov.strikethrough,textDecoration:"line-through"},{tag:ov.link,color:rw,textDecoration:"underline"},{tag:ov.heading,fontWeight:"bold",color:iw},{tag:[ov.atom,ov.bool,ov.special(ov.variableName)],color:ow},{tag:[ov.processingInstruction,ov.string,ov.inserted],color:"#e7db75"},{tag:ov.invalid,color:"#ff0000"}]))];class hw{constructor(t,e,i,s,n,r,o,a,l,h=0,c){this.p=t,this.stack=e,this.state=i,this.reducePos=s,this.pos=n,this.score=r,this.buffer=o,this.bufferBase=a,this.curContext=l,this.lookAhead=h,this.parent=c}toString(){return`[${this.stack.filter(((t,e)=>e%3==0)).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(t,e,i=0){let s=t.parser.context;return new hw(t,[],e,i,i,0,[],0,s?new cw(s,s.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(t,e){this.stack.push(this.state,e,this.bufferBase+this.buffer.length),this.state=t}reduce(t){let e=t>>19,i=65535&t,{parser:s}=this.p,n=s.dynamicPrecedence(i);if(n&&(this.score+=n),0==e)return this.pushState(s.getGoto(this.state,i,!0),this.reducePos),i<s.minRepeatTerm&&this.storeNode(i,this.reducePos,this.reducePos,4,!0),void this.reduceContext(i,this.reducePos);let r=this.stack.length-3*(e-1)-(262144&t?6:0),o=this.stack[r-2],a=this.stack[r-1],l=this.bufferBase+this.buffer.length-a;if(i<s.minRepeatTerm||131072&t){let t=s.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(i,o,t,l+4,!0)}if(262144&t)this.state=this.stack[r];else{let t=this.stack[r-3];this.state=s.getGoto(t,i,!0)}for(;this.stack.length>r;)this.stack.pop();this.reduceContext(i,o)}storeNode(t,e,i,s=4,n=!1){if(0==t&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let t=this,s=this.buffer.length;if(0==s&&t.parent&&(s=t.bufferBase-t.parent.bufferBase,t=t.parent),s>0&&0==t.buffer[s-4]&&t.buffer[s-1]>-1){if(e==i)return;if(t.buffer[s-2]>=e)return void(t.buffer[s-2]=i)}}if(n&&this.pos!=i){let n=this.buffer.length;if(n>0&&0!=this.buffer[n-4])for(;n>0&&this.buffer[n-2]>i;)this.buffer[n]=this.buffer[n-4],this.buffer[n+1]=this.buffer[n-3],this.buffer[n+2]=this.buffer[n-2],this.buffer[n+3]=this.buffer[n-1],n-=4,s>4&&(s-=4);this.buffer[n]=t,this.buffer[n+1]=e,this.buffer[n+2]=i,this.buffer[n+3]=s}else this.buffer.push(t,e,i,s)}shift(t,e,i){let s=this.pos;if(131072&t)this.pushState(65535&t,this.pos);else if(0==(262144&t)){let n=t,{parser:r}=this.p;(i>this.pos||e<=r.maxNode)&&(this.pos=i,r.stateFlag(n,1)||(this.reducePos=i)),this.pushState(n,s),this.shiftContext(e,s),e<=r.maxNode&&this.buffer.push(e,s,i,4)}else this.pos=i,this.shiftContext(e,s),e<=this.p.parser.maxNode&&this.buffer.push(e,s,i,4)}apply(t,e,i){65536&t?this.reduce(t):this.shift(t,e,i)}useNode(t,e){let i=this.p.reused.length-1;(i<0||this.p.reused[i]!=t)&&(this.p.reused.push(t),i++);let s=this.pos;this.reducePos=this.pos=s+t.length,this.pushState(e,s),this.buffer.push(i,s,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,t,this,this.p.stream.reset(this.pos-t.length)))}split(){let t=this,e=t.buffer.length;for(;e>0&&t.buffer[e-2]>t.reducePos;)e-=4;let i=t.buffer.slice(e),s=t.bufferBase+e;for(;t&&s==t.bufferBase;)t=t.parent;return new hw(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,i,s,this.curContext,this.lookAhead,t)}recoverByDelete(t,e){let i=t<=this.p.parser.maxNode;i&&this.storeNode(t,this.pos,e,4),this.storeNode(0,this.pos,e,i?8:4),this.pos=this.reducePos=e,this.score-=190}canShift(t){for(let e=new dw(this);;){let i=this.p.parser.stateSlot(e.state,4)||this.p.parser.hasAction(e.state,t);if(0==i)return!1;if(0==(65536&i))return!0;e.reduce(i)}}recoverByInsert(t){if(this.stack.length>=300)return[];let e=this.p.parser.nextStates(this.state);if(e.length>8||this.stack.length>=120){let i=[];for(let s,n=0;n<e.length;n+=2)(s=e[n+1])!=this.state&&this.p.parser.hasAction(s,t)&&i.push(e[n],s);if(this.stack.length<120)for(let t=0;i.length<8&&t<e.length;t+=2){let s=e[t+1];i.some(((t,e)=>1&e&&t==s))||i.push(e[t],s)}e=i}let i=[];for(let t=0;t<e.length&&i.length<4;t+=2){let s=e[t+1];if(s==this.state)continue;let n=this.split();n.pushState(s,this.pos),n.storeNode(0,n.pos,n.pos,4,!0),n.shiftContext(e[t],this.pos),n.score-=200,i.push(n)}return i}forceReduce(){let t=this.p.parser.stateSlot(this.state,5);if(0==(65536&t))return!1;let{parser:e}=this.p;if(!e.validAction(this.state,t)){let i=t>>19,s=65535&t,n=this.stack.length-3*i;if(n<0||e.getGoto(this.stack[n],s,!1)<0)return!1;this.storeNode(0,this.reducePos,this.reducePos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(t),!0}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(3!=this.stack.length)return!1;let{parser:t}=this.p;return 65535==t.data[t.stateSlot(this.state,1)]&&!t.stateSlot(this.state,4)}restart(){this.state=this.stack[0],this.stack.length=0}sameState(t){if(this.state!=t.state||this.stack.length!=t.stack.length)return!1;for(let e=0;e<this.stack.length;e+=3)if(this.stack[e]!=t.stack[e])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(t){return this.p.parser.dialect.flags[t]}shiftContext(t,e){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,t,this,this.p.stream.reset(e)))}reduceContext(t,e){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,t,this,this.p.stream.reset(e)))}emitContext(){let t=this.buffer.length-1;(t<0||-3!=this.buffer[t])&&this.buffer.push(this.curContext.hash,this.reducePos,this.reducePos,-3)}emitLookAhead(){let t=this.buffer.length-1;(t<0||-4!=this.buffer[t])&&this.buffer.push(this.lookAhead,this.reducePos,this.reducePos,-4)}updateContext(t){if(t!=this.curContext.context){let e=new cw(this.curContext.tracker,t);e.hash!=this.curContext.hash&&this.emitContext(),this.curContext=e}}setLookAhead(t){t>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=t)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class cw{constructor(t,e){this.tracker=t,this.context=e,this.hash=t.strict?t.hash(e):0}}var uw;!function(t){t[t.Insert=200]="Insert",t[t.Delete=190]="Delete",t[t.Reduce=100]="Reduce",t[t.MaxNext=4]="MaxNext",t[t.MaxInsertStackDepth=300]="MaxInsertStackDepth",t[t.DampenInsertStackDepth=120]="DampenInsertStackDepth"}(uw||(uw={}));class dw{constructor(t){this.start=t,this.state=t.state,this.stack=t.stack,this.base=this.stack.length}reduce(t){let e=65535&t,i=t>>19;0==i?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=3*(i-1);let s=this.start.p.parser.getGoto(this.stack[this.base-3],e,!0);this.state=s}}class pw{constructor(t,e,i){this.stack=t,this.pos=e,this.index=i,this.buffer=t.buffer,0==this.index&&this.maybeNext()}static create(t,e=t.bufferBase+t.buffer.length){return new pw(t,e,e-t.bufferBase)}maybeNext(){let t=this.stack.parent;null!=t&&(this.index=this.stack.bufferBase-t.bufferBase,this.stack=t,this.buffer=t.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,0==this.index&&this.maybeNext()}fork(){return new pw(this.stack,this.pos,this.index)}}class fw{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const mw=new fw;class gw{constructor(t,e){this.input=t,this.ranges=e,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=mw,this.rangeIndex=0,this.pos=this.chunkPos=e[0].from,this.range=e[0],this.end=e[e.length-1].to,this.readNext()}resolveOffset(t,e){let i=this.range,s=this.rangeIndex,n=this.pos+t;for(;n<i.from;){if(!s)return null;let t=this.ranges[--s];n-=i.from-t.to,i=t}for(;e<0?n>i.to:n>=i.to;){if(s==this.ranges.length-1)return null;let t=this.ranges[++s];n+=t.from-i.to,i=t}return n}clipPos(t){if(t>=this.range.from&&t<this.range.to)return t;for(let e of this.ranges)if(e.to>t)return Math.max(t,e.from);return this.end}peek(t){let e,i,s=this.chunkOff+t;if(s>=0&&s<this.chunk.length)e=this.pos+t,i=this.chunk.charCodeAt(s);else{let s=this.resolveOffset(t,1);if(null==s)return-1;if((e=s)>=this.chunk2Pos&&e<this.chunk2Pos+this.chunk2.length)i=this.chunk2.charCodeAt(e-this.chunk2Pos);else{let t=this.rangeIndex,s=this.range;for(;s.to<=e;)s=this.ranges[++t];this.chunk2=this.input.chunk(this.chunk2Pos=e),e+this.chunk2.length>s.to&&(this.chunk2=this.chunk2.slice(0,s.to-e)),i=this.chunk2.charCodeAt(0)}}return e>=this.token.lookAhead&&(this.token.lookAhead=e+1),i}acceptToken(t,e=0){let i=e?this.resolveOffset(e,-1):this.pos;if(null==i||i<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=t,this.token.end=i}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:t,chunkPos:e}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=t,this.chunk2Pos=e,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let t=this.input.chunk(this.pos),e=this.pos+t.length;this.chunk=e>this.range.to?t.slice(0,this.range.to-this.pos):t,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(t=1){for(this.chunkOff+=t;this.pos+t>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();t-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=t,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(t,e){if(e?(this.token=e,e.start=t,e.lookAhead=t+1,e.value=e.extended=-1):this.token=mw,this.pos!=t){if(this.pos=t,t==this.end)return this.setDone(),this;for(;t<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;t>=this.range.to;)this.range=this.ranges[++this.rangeIndex];t>=this.chunkPos&&t<this.chunkPos+this.chunk.length?this.chunkOff=t-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(t,e){if(t>=this.chunkPos&&e<=this.chunkPos+this.chunk.length)return this.chunk.slice(t-this.chunkPos,e-this.chunkPos);if(t>=this.chunk2Pos&&e<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(t-this.chunk2Pos,e-this.chunk2Pos);if(t>=this.range.from&&e<=this.range.to)return this.input.read(t,e);let i="";for(let s of this.ranges){if(s.from>=e)break;s.to>t&&(i+=this.input.read(Math.max(s.from,t),Math.min(s.to,e)))}return i}}class vw{constructor(t,e){this.data=t,this.id=e}token(t,e){!function(t,e,i,s){let n=0,r=1<<s,{parser:o}=i.p,{dialect:a}=o;t:for(;0!=(r&t[n]);){let i=t[n+1];for(let s=n+3;s<i;s+=2)if((t[s+1]&r)>0){let i=t[s];if(a.allows(i)&&(-1==e.token.value||e.token.value==i||o.overrides(i,e.token.value))){e.acceptToken(i);break}}let s=e.next,l=0,h=t[n+2];if(!(e.next<0&&h>l&&65535==t[i+3*h-3]&&65535==t[i+3*h-3])){for(;l<h;){let r=l+h>>1,o=i+r+(r<<1),a=t[o],c=t[o+1]||65536;if(s<a)h=r;else{if(!(s>=c)){n=t[o+2],e.advance();continue t}l=r+1}}break}n=t[i+3*h-1]}}(this.data,t,e,this.id)}}vw.prototype.contextual=vw.prototype.fallback=vw.prototype.extend=!1;class yw{constructor(t,e={}){this.token=t,this.contextual=!!e.contextual,this.fallback=!!e.fallback,this.extend=!!e.extend}}function bw(t,e=Uint16Array){if("string"!=typeof t)return t;let i=null;for(let s=0,n=0;s<t.length;){let r=0;for(;;){let e=t.charCodeAt(s++),i=!1;if(126==e){r=65535;break}e>=92&&e--,e>=34&&e--;let n=e-32;if(n>=46&&(n-=46,i=!0),r+=n,i)break;r*=46}i?i[n++]=r:i=new e(r)}return i}const xw="undefined"!=typeof process&&process.env&&/\bparse\b/.test(process.env.LOG);let Ow=null;var ww,Sw;function kw(t,e,i){let s=t.cursor(mg.IncludeAnonymous);for(s.moveTo(e);;)if(!(i<0?s.childBefore(e):s.childAfter(e)))for(;;){if((i<0?s.to<e:s.from>e)&&!s.type.isError)return i<0?Math.max(0,Math.min(s.to-1,e-25)):Math.min(t.length,Math.max(s.from+1,e+25));if(i<0?s.prevSibling():s.nextSibling())break;if(!s.parent())return i<0?0:t.length}}!function(t){t[t.Margin=25]="Margin"}(ww||(ww={}));class Aw{constructor(t,e){this.fragments=t,this.nodeSet=e,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let t=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(t){for(this.safeFrom=t.openStart?kw(t.tree,t.from+t.offset,1)-t.offset:t.from,this.safeTo=t.openEnd?kw(t.tree,t.to+t.offset,-1)-t.offset:t.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(t.tree),this.start.push(-t.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(t){if(t<this.nextStart)return null;for(;this.fragment&&this.safeTo<=t;)this.nextFragment();if(!this.fragment)return null;for(;;){let e=this.trees.length-1;if(e<0)return this.nextFragment(),null;let i=this.trees[e],s=this.index[e];if(s==i.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let n=i.children[s],r=this.start[e]+i.positions[s];if(r>t)return this.nextStart=r,null;if(n instanceof gg){if(r==t){if(r<this.safeFrom)return null;let t=r+n.length;if(t<=this.safeTo){let e=n.prop(hg.lookAhead);if(!e||t+e<this.fragment.to)return n}}this.index[e]++,r+n.length>=Math.max(this.safeFrom,t)&&(this.trees.push(n),this.start.push(r),this.index.push(0))}else this.index[e]++,this.nextStart=r+n.length}}}class Tw{constructor(t,e){this.stream=e,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=t.tokenizers.map((t=>new fw))}getActions(t){let e=0,i=null,{parser:s}=t.p,{tokenizers:n}=s,r=s.stateSlot(t.state,3),o=t.curContext?t.curContext.hash:0,a=0;for(let s=0;s<n.length;s++){if(0==(1<<s&r))continue;let l=n[s],h=this.tokens[s];if((!i||l.fallback)&&((l.contextual||h.start!=t.pos||h.mask!=r||h.context!=o)&&(this.updateCachedToken(h,l,t),h.mask=r,h.context=o),h.lookAhead>h.end+25&&(a=Math.max(h.lookAhead,a)),0!=h.value)){let s=e;if(h.extended>-1&&(e=this.addActions(t,h.extended,h.end,e)),e=this.addActions(t,h.value,h.end,e),!l.extend&&(i=h,e>s))break}}for(;this.actions.length>e;)this.actions.pop();return a&&t.setLookAhead(a),i||t.pos!=this.stream.end||((i=new fw).value=t.p.parser.eofTerm,i.start=i.end=t.pos,e=this.addActions(t,i.value,i.end,e)),this.mainToken=i,this.actions}getMainToken(t){if(this.mainToken)return this.mainToken;let e=new fw,{pos:i,p:s}=t;return e.start=i,e.end=Math.min(i+1,s.stream.end),e.value=i==s.stream.end?s.parser.eofTerm:0,e}updateCachedToken(t,e,i){let s=this.stream.clipPos(i.pos);if(e.token(this.stream.reset(s,t),i),t.value>-1){let{parser:e}=i.p;for(let s=0;s<e.specialized.length;s++)if(e.specialized[s]==t.value){let n=e.specializers[s](this.stream.read(t.start,t.end),i);if(n>=0&&i.p.parser.dialect.allows(n>>1)){0==(1&n)?t.value=n>>1:t.extended=n>>1;break}}}else t.value=0,t.end=this.stream.clipPos(s+1)}putAction(t,e,i,s){for(let e=0;e<s;e+=3)if(this.actions[e]==t)return s;return this.actions[s++]=t,this.actions[s++]=e,this.actions[s++]=i,s}addActions(t,e,i,s){let{state:n}=t,{parser:r}=t.p,{data:o}=r;for(let t=0;t<2;t++)for(let a=r.stateSlot(n,t?2:1);;a+=3){if(65535==o[a]){if(1!=o[a+1]){0==s&&2==o[a+1]&&(s=this.putAction(Ew(o,a+2),e,i,s));break}a=Ew(o,a+2)}o[a]==e&&(s=this.putAction(Ew(o,a+1),e,i,s))}return s}}!function(t){t[t.Distance=5]="Distance",t[t.MaxRemainingPerStep=3]="MaxRemainingPerStep",t[t.MinBufferLengthPrune=500]="MinBufferLengthPrune",t[t.ForceReduceLimit=10]="ForceReduceLimit",t[t.CutDepth=15e3]="CutDepth",t[t.CutTo=9e3]="CutTo"}(Sw||(Sw={}));class Mw{constructor(t,e,i,s){this.parser=t,this.input=e,this.ranges=s,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.stream=new gw(e,s),this.tokens=new Tw(t,this.stream),this.topTerm=t.top[1];let{from:n}=s[0];this.stacks=[hw.start(this,t.top[0],n)],this.fragments=i.length&&this.stream.end-n>4*t.bufferLength?new Aw(i,t.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let t,e,i=this.stacks,s=this.minStackPos,n=this.stacks=[];for(let r=0;r<i.length;r++){let o=i[r];for(;;){if(this.tokens.mainToken=null,o.pos>s)n.push(o);else{if(this.advanceStack(o,n,i))continue;{t||(t=[],e=[]),t.push(o);let i=this.tokens.getMainToken(o);e.push(i.value,i.end)}}break}}if(!n.length){let e=t&&function(t){let e=null;for(let i of t){let t=i.p.stoppedAt;(i.pos==i.p.stream.end||null!=t&&i.pos>t)&&i.p.parser.stateFlag(i.state,2)&&(!e||e.score<i.score)&&(e=i)}return e}(t);if(e)return this.stackToTree(e);if(this.parser.strict)throw xw&&t&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+s);this.recovering||(this.recovering=5)}if(this.recovering&&t){let i=null!=this.stoppedAt&&t[0].pos>this.stoppedAt?t[0]:this.runRecovery(t,e,n);if(i)return this.stackToTree(i.forceAll())}if(this.recovering){let t=1==this.recovering?1:3*this.recovering;if(n.length>t)for(n.sort(((t,e)=>e.score-t.score));n.length>t;)n.pop();n.some((t=>t.reducePos>s))&&this.recovering--}else if(n.length>1)t:for(let t=0;t<n.length-1;t++){let e=n[t];for(let i=t+1;i<n.length;i++){let s=n[i];if(e.sameState(s)||e.buffer.length>500&&s.buffer.length>500){if(!((e.score-s.score||e.buffer.length-s.buffer.length)>0)){n.splice(t--,1);continue t}n.splice(i--,1)}}}this.minStackPos=n[0].pos;for(let t=1;t<n.length;t++)n[t].pos<this.minStackPos&&(this.minStackPos=n[t].pos);return null}stopAt(t){if(null!=this.stoppedAt&&this.stoppedAt<t)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=t}advanceStack(t,e,i){let s=t.pos,{parser:n}=this,r=xw?this.stackID(t)+" -> ":"";if(null!=this.stoppedAt&&s>this.stoppedAt)return t.forceReduce()?t:null;if(this.fragments){let e=t.curContext&&t.curContext.tracker.strict,i=e?t.curContext.hash:0;for(let o=this.fragments.nodeAt(s);o;){let s=this.parser.nodeSet.types[o.type.id]==o.type?n.getGoto(t.state,o.type.id):-1;if(s>-1&&o.length&&(!e||(o.prop(hg.contextHash)||0)==i))return t.useNode(o,s),xw&&console.log(r+this.stackID(t)+` (via reuse of ${n.getName(o.type.id)})`),!0;if(!(o instanceof gg)||0==o.children.length||o.positions[0]>0)break;let a=o.children[0];if(!(a instanceof gg&&0==o.positions[0]))break;o=a}}let o=n.stateSlot(t.state,4);if(o>0)return t.reduce(o),xw&&console.log(r+this.stackID(t)+` (via always-reduce ${n.getName(65535&o)})`),!0;if(t.stack.length>=15e3)for(;t.stack.length>9e3&&t.forceReduce(););let a=this.tokens.getActions(t);for(let o=0;o<a.length;){let l=a[o++],h=a[o++],c=a[o++],u=o==a.length||!i,d=u?t:t.split();if(d.apply(l,h,c),xw&&console.log(r+this.stackID(d)+` (via ${0==(65536&l)?"shift":`reduce of ${n.getName(65535&l)}`} for ${n.getName(h)} @ ${s}${d==t?"":", split"})`),u)return!0;d.pos>s?e.push(d):i.push(d)}return!1}advanceFully(t,e){let i=t.pos;for(;;){if(!this.advanceStack(t,null,null))return!1;if(t.pos>i)return Pw(t,e),!0}}runRecovery(t,e,i){let s=null,n=!1;for(let r=0;r<t.length;r++){let o=t[r],a=e[r<<1],l=e[1+(r<<1)],h=xw?this.stackID(o)+" -> ":"";if(o.deadEnd){if(n)continue;if(n=!0,o.restart(),xw&&console.log(h+this.stackID(o)+" (restarted)"),this.advanceFully(o,i))continue}let c=o.split(),u=h;for(let t=0;c.forceReduce()&&t<10&&(xw&&console.log(u+this.stackID(c)+" (via force-reduce)"),!this.advanceFully(c,i));t++)xw&&(u=this.stackID(c)+" -> ");for(let t of o.recoverByInsert(a))xw&&console.log(h+this.stackID(t)+" (via recover-insert)"),this.advanceFully(t,i);this.stream.end>o.pos?(l==o.pos&&(l++,a=0),o.recoverByDelete(a,l),xw&&console.log(h+this.stackID(o)+` (via recover-delete ${this.parser.getName(a)})`),Pw(o,i)):(!s||s.score<o.score)&&(s=o)}return s}stackToTree(t){return t.close(),gg.build({buffer:pw.create(t),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:t.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(t){let e=(Ow||(Ow=new WeakMap)).get(t);return e||Ow.set(t,e=String.fromCodePoint(this.nextStackID++)),e+t}}function Pw(t,e){for(let i=0;i<e.length;i++){let s=e[i];if(s.pos==t.pos&&s.sameState(t))return void(e[i].score<t.score&&(e[i]=t))}e.push(t)}class Cw{constructor(t,e,i){this.source=t,this.flags=e,this.disabled=i}allows(t){return!this.disabled||0==this.disabled[t]}}const _w=t=>t;class Rw extends Qg{constructor(t){if(super(),this.wrappers=[],14!=t.version)throw new RangeError(`Parser version (${t.version}) doesn't match runtime version (14)`);let e=t.nodeNames.split(" ");this.minRepeatTerm=e.length;for(let i=0;i<t.repeatNodeCount;i++)e.push("");let i=Object.keys(t.topRules).map((e=>t.topRules[e][1])),s=[];for(let t=0;t<e.length;t++)s.push([]);function n(t,e,i){s[t].push([e,e.deserialize(String(i))])}if(t.nodeProps)for(let e of t.nodeProps){let t=e[0];"string"==typeof t&&(t=hg[t]);for(let i=1;i<e.length;){let s=e[i++];if(s>=0)n(s,t,e[i++]);else{let r=e[i+-s];for(let o=-s;o>0;o--)n(e[i++],t,r);i++}}}this.nodeSet=new dg(e.map(((e,n)=>ug.define({name:n>=this.minRepeatTerm?void 0:e,id:n,props:s[n],top:i.indexOf(n)>-1,error:0==n,skipped:t.skippedNodes&&t.skippedNodes.indexOf(n)>-1})))),t.propSources&&(this.nodeSet=this.nodeSet.extend(...t.propSources)),this.strict=!1,this.bufferLength=og;let r=bw(t.tokenData);this.context=t.context,this.specializerSpecs=t.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let t=0;t<this.specializerSpecs.length;t++)this.specialized[t]=this.specializerSpecs[t].term;this.specializers=this.specializerSpecs.map(Lw),this.states=bw(t.states,Uint32Array),this.data=bw(t.stateData),this.goto=bw(t.goto),this.maxTerm=t.maxTerm,this.tokenizers=t.tokenizers.map((t=>"number"==typeof t?new vw(r,t):t)),this.topRules=t.topRules,this.dialects=t.dialects||{},this.dynamicPrecedences=t.dynamicPrecedences||null,this.tokenPrecTable=t.tokenPrec,this.termNames=t.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(t,e,i){let s=new Mw(this,t,e,i);for(let n of this.wrappers)s=n(s,t,e,i);return s}getGoto(t,e,i=!1){let s=this.goto;if(e>=s[0])return-1;for(let n=s[e+1];;){let e=s[n++],r=1&e,o=s[n++];if(r&&i)return o;for(let i=n+(e>>1);n<i;n++)if(s[n]==t)return o;if(r)return-1}}hasAction(t,e){let i=this.data;for(let s=0;s<2;s++)for(let n,r=this.stateSlot(t,s?2:1);;r+=3){if(65535==(n=i[r])){if(1!=i[r+1]){if(2==i[r+1])return Ew(i,r+2);break}n=i[r=Ew(i,r+2)]}if(n==e||0==n)return Ew(i,r+1)}return 0}stateSlot(t,e){return this.states[6*t+e]}stateFlag(t,e){return(this.stateSlot(t,0)&e)>0}validAction(t,e){if(e==this.stateSlot(t,4))return!0;for(let i=this.stateSlot(t,1);;i+=3){if(65535==this.data[i]){if(1!=this.data[i+1])return!1;i=Ew(this.data,i+2)}if(e==Ew(this.data,i+1))return!0}}nextStates(t){let e=[];for(let i=this.stateSlot(t,1);;i+=3){if(65535==this.data[i]){if(1!=this.data[i+1])break;i=Ew(this.data,i+2)}if(0==(1&this.data[i+2])){let t=this.data[i+1];e.some(((e,i)=>1&i&&e==t))||e.push(this.data[i],t)}}return e}overrides(t,e){let i=Qw(this.data,this.tokenPrecTable,e);return i<0||Qw(this.data,this.tokenPrecTable,t)<i}configure(t){let e=Object.assign(Object.create(Rw.prototype),this);if(t.props&&(e.nodeSet=this.nodeSet.extend(...t.props)),t.top){let i=this.topRules[t.top];if(!i)throw new RangeError(`Invalid top rule name ${t.top}`);e.top=i}return t.tokenizers&&(e.tokenizers=this.tokenizers.map((e=>{let i=t.tokenizers.find((t=>t.from==e));return i?i.to:e}))),t.specializers&&(e.specializers=this.specializers.slice(),e.specializerSpecs=this.specializerSpecs.map(((i,s)=>{let n=t.specializers.find((t=>t.from==i.external));if(!n)return i;let r=Object.assign(Object.assign({},i),{external:n.to});return e.specializers[s]=Lw(r),r}))),t.contextTracker&&(e.context=t.contextTracker),t.dialect&&(e.dialect=this.parseDialect(t.dialect)),null!=t.strict&&(e.strict=t.strict),t.wrap&&(e.wrappers=e.wrappers.concat(t.wrap)),null!=t.bufferLength&&(e.bufferLength=t.bufferLength),e}hasWrappers(){return this.wrappers.length>0}getName(t){return this.termNames?this.termNames[t]:String(t<=this.maxNode&&this.nodeSet.types[t].name||t)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(t){let e=this.dynamicPrecedences;return null==e?0:e[t]||0}parseDialect(t){let e=Object.keys(this.dialects),i=e.map((()=>!1));if(t)for(let s of t.split(" ")){let t=e.indexOf(s);t>=0&&(i[t]=!0)}let s=null;for(let t=0;t<e.length;t++)if(!i[t])for(let i,n=this.dialects[e[t]];65535!=(i=this.data[n++]);)(s||(s=new Uint8Array(this.maxTerm+1)))[i]=1;return new Cw(t,i,s)}static deserialize(t){return new Rw(t)}}function Ew(t,e){return t[e]|t[e+1]<<16}function Qw(t,e,i){for(let s,n=e;65535!=(s=t[n]);n++)if(s==i)return n-e;return-1}function Lw(t){if(t.external){let e=t.extend?1:0;return(i,s)=>t.external(i,s)<<1|e}return t.get}const Fw=[9,10,11,12,13,32,133,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288],Iw=new class{constructor(t){this.start=t.start,this.shift=t.shift||_w,this.reduce=t.reduce||_w,this.reuse=t.reuse||_w,this.hash=t.hash||(()=>0),this.strict=!1!==t.strict}}({start:!1,shift:(t,e)=>5==e||6==e||299==e?t:300==e,strict:!1}),Dw=new yw(((t,e)=>{let{next:i}=t;(125==i||-1==i||e.context)&&e.canShift(297)&&t.acceptToken(297)}),{contextual:!0,fallback:!0}),Uw=new yw(((t,e)=>{let i,{next:s}=t;Fw.indexOf(s)>-1||(47!=s||47!=(i=t.peek(1))&&42!=i)&&125!=s&&59!=s&&-1!=s&&!e.context&&e.canShift(294)&&t.acceptToken(294)}),{contextual:!0}),zw=new yw(((t,e)=>{let{next:i}=t;if((43==i||45==i)&&(t.advance(),i==t.next)){t.advance();let i=!e.context&&e.canShift(2);t.acceptToken(i?2:3)}}),{contextual:!0}),Nw=new yw((t=>{for(let e=!1,i=0;;i++){let{next:s}=t;if(s<0){i&&t.acceptToken(295);break}if(96==s){i?t.acceptToken(295):t.acceptToken(296,1);break}if(123==s&&e){1==i?t.acceptToken(4,1):t.acceptToken(295,-1);break}if(10==s&&i){t.advance(),t.acceptToken(295);break}92==s&&t.advance(),e=36==s,t.advance()}})),Vw=new yw(((t,e)=>{if(101==t.next&&e.dialectEnabled(1)){t.advance();for(let e=0;e<6;e++){if(t.next!="xtends".charCodeAt(e))return;t.advance()}t.next>=57&&t.next<=65||t.next>=48&&t.next<=90||95==t.next||t.next>=97&&t.next<=122||t.next>160||t.acceptToken(1)}})),Bw=zg({"get set async static":ov.modifier,"for while do if else switch try catch finally return throw break continue default case":ov.controlKeyword,"in of await yield void typeof delete instanceof":ov.operatorKeyword,"let var const function class extends":ov.definitionKeyword,"import export from":ov.moduleKeyword,"with debugger as new":ov.keyword,TemplateString:ov.special(ov.string),super:ov.atom,BooleanLiteral:ov.bool,this:ov.self,null:ov.null,Star:ov.modifier,VariableName:ov.variableName,"CallExpression/VariableName TaggedTemplateExpression/VariableName":ov.function(ov.variableName),VariableDefinition:ov.definition(ov.variableName),Label:ov.labelName,PropertyName:ov.propertyName,PrivatePropertyName:ov.special(ov.propertyName),"CallExpression/MemberExpression/PropertyName":ov.function(ov.propertyName),"FunctionDeclaration/VariableDefinition":ov.function(ov.definition(ov.variableName)),"ClassDeclaration/VariableDefinition":ov.definition(ov.className),PropertyDefinition:ov.definition(ov.propertyName),PrivatePropertyDefinition:ov.definition(ov.special(ov.propertyName)),UpdateOp:ov.updateOperator,LineComment:ov.lineComment,BlockComment:ov.blockComment,Number:ov.number,String:ov.string,ArithOp:ov.arithmeticOperator,LogicOp:ov.logicOperator,BitOp:ov.bitwiseOperator,CompareOp:ov.compareOperator,RegExp:ov.regexp,Equals:ov.definitionOperator,Arrow:ov.function(ov.punctuation),": Spread":ov.punctuation,"( )":ov.paren,"[ ]":ov.squareBracket,"{ }":ov.brace,"InterpolationStart InterpolationEnd":ov.special(ov.brace),".":ov.derefOperator,", ;":ov.separator,"@":ov.meta,TypeName:ov.typeName,TypeDefinition:ov.definition(ov.typeName),"type enum interface implements namespace module declare":ov.definitionKeyword,"abstract global Privacy readonly override":ov.modifier,"is keyof unique infer":ov.operatorKeyword,JSXAttributeValue:ov.attributeValue,JSXText:ov.content,"JSXStartTag JSXStartCloseTag JSXSelfCloseEndTag JSXEndTag":ov.angleBracket,"JSXIdentifier JSXNameSpacedName":ov.tagName,"JSXAttribute/JSXIdentifier JSXAttribute/JSXNameSpacedName":ov.attributeName,"JSXBuiltin/JSXIdentifier":ov.standard(ov.tagName)}),$w={__proto__:null,export:18,as:23,from:29,default:32,async:37,function:38,this:50,true:58,false:58,null:68,void:72,typeof:76,super:92,new:126,await:143,yield:145,delete:146,class:156,extends:158,public:213,private:213,protected:213,readonly:215,instanceof:234,satisfies:237,in:238,const:240,import:272,keyof:327,unique:331,infer:337,is:373,abstract:393,implements:395,type:397,let:400,var:402,interface:409,enum:413,namespace:419,module:421,declare:425,global:429,for:450,of:459,while:462,with:466,do:470,if:474,else:476,switch:480,case:486,try:492,catch:496,finally:500,return:504,throw:508,break:512,continue:516,debugger:520},Xw={__proto__:null,async:113,get:115,set:117,public:175,private:175,protected:175,static:177,abstract:179,override:181,readonly:187,accessor:189,new:377},jw={__proto__:null,"<":133},Gw=Rw.deserialize({version:14,states:"$CWO`QdOOO$}QdOOO)WQ(C|O'#ChO)_OWO'#DYO+jQdO'#D_O+zQdO'#DjO$}QdO'#DtO.OQdO'#DzOOQ(C['#ET'#ETO.fQ`O'#EQOOQO'#IW'#IWO.nQ`O'#GgOOQO'#Ee'#EeO.yQ`O'#EdO/OQ`O'#EdO1QQ(C|O'#JQO3nQ(C|O'#JRO4_Q`O'#FSO4dQ!bO'#FkOOQ(C['#F['#F[O4oO#tO'#F[O4}Q&jO'#FrO6bQ`O'#FqOOQ(C['#JR'#JROOQ(CW'#JQ'#JQOOQS'#Jk'#JkO6gQ`O'#H{O6lQ(ChO'#H|OOQS'#Iu'#IuOOQS'#IO'#IOQ`QdOOO$}QdO'#DlO6tQ`O'#GgO6yQ&jO'#CmO7XQ`O'#EcO7dQ`O'#EnO7iQ&jO'#FZO8TQ`O'#GgO8YQ`O'#GkO8eQ`O'#GkO8sQ`O'#GnO8sQ`O'#GoO8sQ`O'#GqO6tQ`O'#GtO9dQ`O'#GwO:uQ`O'#CdO;VQ`O'#HUO;_Q`O'#H[O;_Q`O'#H^O`QdO'#H`O;_Q`O'#HbO;_Q`O'#HeO;dQ`O'#HkO;iQ(CjO'#HqO$}QdO'#HsO;tQ(CjO'#HuO<PQ(CjO'#HwO6lQ(ChO'#HyO<[Q(C|O'#ChO<xQ,UO'#DdQOQ`OOO=mQaO'#D{O6yQ&jO'#EcO={Q`O'#EcO>WQpO'#FZO$}QdO'#DZOOOW'#IQ'#IQO>`OWO,59tOOQ(C[,59t,59tO>kQdO'#IRO?OQ`O'#JSOAQQtO'#JSO)jQdO'#JSOAXQ`O,59yOAoQ`O'#EeOA|Q`O'#J`OBXQ`O'#J_OBXQ`O'#J_OBaQ`O,5;ROBfQ`O'#J^OOQ(C[,5:U,5:UOBmQdO,5:UODnQ(C|O,5:`OE_Q`O,5:fOEdQ`O'#J[OF^Q(ChO'#J]O8YQ`O'#J[OFeQ`O'#J[OFmQ`O,5;QOFrQ`O'#J[OOQ(C]'#Ch'#ChO$}QdO'#DzOGfQpO,5:lOOQO'#JX'#JXOOQO-E<U-E<UO6tQ`O,5=ROG|Q`O,5=ROHRQdO,5;OOJRQ&jO'#E`OKcQ`O,5;OOLxQ&jO'#DnOMPQdO'#DsOMZQ,UO,5;XOMcQ,UO,5;XO$}QdO,5;XOOQS'#Ez'#EzOOQS'#E|'#E|O$}QdO,5;YO$}QdO,5;YO$}QdO,5;YO$}QdO,5;YO$}QdO,5;YO$}QdO,5;YO$}QdO,5;YO$}QdO,5;YO$}QdO,5;YO$}QdO,5;YO$}QdO,5;YOOQS'#FQ'#FQOMqQdO,5;kOOQ(C[,5;p,5;pOOQ(C[,5;q,5;qO! qQ`O,5;qOOQ(C[,5;r,5;rO$}QdO'#I^O! yQ(ChO,5<_OJRQ&jO,5;YO!!hQ&jO,5;YO$}QdO,5;nO!!oQ!bO'#FaO!#lQ!bO'#JdO!#WQ!bO'#JdO!#sQ!bO'#JdOOQO'#Jd'#JdO!$XQ!bO,5;yOOOO,5<V,5<VO!$jQdO'#FmOOOO'#I]'#I]O4oO#tO,5;vO!$qQ!bO'#FoOOQ(C[,5;v,5;vO!%bQ7]O'#CsOOQ(C]'#Cv'#CvO!%uQ`O'#CvO!%zOWO'#CzO!&hQ&kO,5<[O!&oQ`O,5<^O!(RQMhO'#F|O!(`Q`O'#F}O!(eQ`O'#F}O!(jQMhO'#GRO!)iQ,UO'#GVO!*_Q7]O'#I}OOQ(C]'#I}'#I}O!+eQaO'#I|O!+sQ`O'#I{O!+{Q`O'#CrOOQ(C]'#Ct'#CtOOQ(C]'#C}'#C}OOQ(C]'#DP'#DPO.iQ`O'#DROKhQ&jO'#FtOKhQ&jO'#FvO!,TQ`O'#FxO!,YQ`O'#FyO!(eQ`O'#GPOKhQ&jO'#GUO!,_Q`O'#EfO!,yQ`O,5<]O`QdO,5>gOOQS'#Ix'#IxOOQS,5>h,5>hOOQS-E;|-E;|O!.xQ(C|O,5:WOOQ(CX'#Cp'#CpO!/lQ&kO,5=ROOQO'#Cf'#CfO!/}Q(ChO'#IyO6bQ`O'#IyO;dQ`O,59XO!0`Q!bO,59XO!0hQ&jO,59XO6yQ&jO,59XO!0sQ`O,5;OO!0{Q`O'#HTO!1ZQ`O'#JoO$}QdO,5;sO!1cQ,UO,5;uO!1hQ`O,5=nO!1mQ`O,5=nO!1rQ`O,5=nO6lQ(ChO,5=nO!2QQ`O'#EgO!2wQ,UO'#EhOOQ(CW'#J^'#J^O!3OQ(ChO'#JlO6lQ(ChO,5=VO8sQ`O,5=]OOQP'#Cs'#CsO!3ZQ!bO,5=YO!3cQ!cO,5=ZO!3nQ`O,5=]O!3sQpO,5=`O;dQ`O'#GyO6tQ`O'#G{O!3{Q`O'#G{O6yQ&jO'#HOO!4QQ`O'#HOOOQS,5=c,5=cO!4VQ`O'#HPO!4_Q`O'#CmO!4dQ`O,59OO!4nQ`O,59OO!6sQdO,59OOOQS,59O,59OO!7QQ(ChO,59OO$}QdO,59OO!7]QdO'#HWOOQS'#HX'#HXOOQS'#HY'#HYO`QdO,5=pO!7mQ`O,5=pO`QdO,5=vO`QdO,5=xO!7rQ`O,5=zO`QdO,5=|O!7wQ`O,5>PO!7|QdO,5>VOOQS,5>],5>]O$}QdO,5>]O6lQ(ChO,5>_OOQS,5>a,5>aO!<QQ`O,5>aOOQS,5>c,5>cO!<QQ`O,5>cOOQS,5>e,5>eO!<VQ!bO'#DWOOQ(CW'#JU'#JUO$}QdO'#JUO!<tQ!bO'#JUO!=cQ!bO'#DeO!=tQ,UO'#DeO!@PQdO'#DeO!@WQ`O'#JTO!@`Q`O,5:OO!@eQ`O'#EiO!@sQ`O'#JaO!@{Q`O,5;SO!AcQ,UO'#DeO!AmQ,UO'#EOOOQ(C[,5:g,5:gO$}QdO,5:gOJRQ&jO,5:gO!BjQaO,5:gO;dQ`O,5:}O!0`Q!bO,5:}O!0hQ&jO,5:}O6yQ&jO,5:}O!BuQpO,59uOOOW-E<O-E<OOOQ(C[1G/`1G/`O!BzQtO,5>mO)jQdO,5>mOOQO,5>s,5>sO!CUQdO'#IROOQO-E<P-E<PO!CcQ`O,5?nO!CkQtO,5?nO!CrQ`O,5?yOOQ(C[1G/e1G/eO$}QdO,5?zO!CzQ`O'#IXOOQO-E<V-E<VO!CrQ`O,5?yOOQ(CW1G0m1G0mOOQ(C[1G/p1G/pOOQ(C[1G0Q1G0QO!D`Q`O,5?vO8YQ`O,5?vO!DhQ`O,5?vOOQ(CW'#E_'#E_O$}QdO,5?wO!DvQ(ChO,5?wO!EXQ(ChO,5?wO!E`Q`O'#IZO!D`Q`O,5?vOOQ(CW1G0l1G0lOMZQ,UO,5:nOMfQ,UO,5:nOOQO,5:p,5:pO!E}Q`O,5:pO!FVQ&kO1G2mO6tQ`O1G2mOOQ(C[1G0j1G0jO!FhQ(C|O1G0jO!GmQ(CyO,5:zOOQ(C]'#F{'#F{O!JWQ(C}O'#I}OHRQdO1G0jO!J}Q&kO'#JVO!KXQ`O,5:YO!K^QtO'#JWO$}QdO'#JWO!KhQ`O,5:_OOQ(C]'#DW'#DWOOQ(C[1G0s1G0sO$}QdO1G0sOOQ(C[1G1]1G1]O!KmQ`O1G0sO!NUQ(C|O1G0tO!N]Q(C|O1G0tO#!vQ(C|O1G0tO#!}Q(C|O1G0tO#%XQ(C|O1G0tO#%oQ(C|O1G0tO#(iQ(C|O1G0tO#(pQ(C|O1G0tO#+ZQ(C|O1G0tO#+bQ(C|O1G0tO#-YQ(C|O1G0tO#0YQ!LUO'#ChO#2WQ!LUO1G1VO#4UQ!LUO'#JRO! tQ`O1G1]O#4iQ(C|O,5>xOOQ(CW-E<[-E<[O#5]Q(C}O1G0tOOQ(C[1G0t1G0tO#7hQ(C|O1G1YO#8[Q!bO,5;}O#8dQ!bO,5<OO#8lQ!bO'#FfO#9TQ`O'#FeOOQO'#Je'#JeOOQO'#I['#I[O#9YQ!bO1G1eOOQ(C[1G1e1G1eOOOO1G1p1G1pO#9kQ!LUO'#JQO#9uQ`O,5<XOMqQdO,5<XOOOO-E<Z-E<ZOOQ(C[1G1b1G1bOOQ(C[,5<Z,5<ZO#9zQ!bO,5<ZOOQ(C],59b,59bOJRQ&jO'#C|OOOW'#IP'#IPO#:POWO,59fOOQ(C],59f,59fO$}QdO1G1vO!,YQ`O'#I`O#:[Q`O,5<oOOQ(C],5<l,5<lOOQO'#Gb'#GbOKhQ&jO,5<{OOQO'#Gd'#GdOKhQ&jO,5<}OJRQ&jO,5=POOQO1G1x1G1xO#:gQqO'#CpO#:zQqO,5<hO#;RQ`O'#JhO6tQ`O'#JhO#;aQ`O,5<jOKhQ&jO,5<iO#;fQ`O'#GOO#;qQ`O,5<iO#;vQqO'#F{O#<TQqO'#JiO#<_Q`O'#JiOJRQ&jO'#JiO#<dQ`O,5<mOOQ(CW'#Di'#DiO#<iQ!bO'#GWO!)dQ,UO'#GWO#<zQ`O'#GYO#=PQ`O'#G[O!(eQ`O'#G_O#=UQ(ChO'#IbO#=aQ,UO,5<qOOQ(C],5<q,5<qO#=hQ,UO'#GWO#=vQ,UO'#GXO#>OQ,UO'#GXOOQ(C],5=Q,5=QOKhQ&jO,5?hOKhQ&jO,5?hO#>TQ`O'#IcO#>`Q`O,5?gO#>hQ`O,59^O#?XQ&kO,59mOOQ(C],59m,59mO#?zQ&kO,5<`O#@mQ&kO,5<bO#@wQ`O,5<dOOQ(C],5<e,5<eO#@|Q`O,5<kO#ARQ&kO,5<pOHRQdO1G1wO#AcQ`O1G1wOOQS1G4R1G4ROOQ(C[1G/r1G/rO! qQ`O1G/rOOQS1G2m1G2mOJRQ&jO1G2mO$}QdO1G2mOJRQ&jO1G2mO#AhQaO1G2mO#CQQ&jO'#E`OOQ(CW,5?e,5?eO#C[Q(ChO,5?eOOQS1G.s1G.sO;dQ`O1G.sO!0`Q!bO1G.sO!0hQ&jO1G.sO#CmQ`O1G0jO#CrQ`O'#ChO#C}Q`O'#JpO#DVQ`O,5=oO#D[Q`O'#JpO#DaQ`O'#JpO#DiQ`O'#IkO#DwQ`O,5@ZO#EPQtO1G1_OOQ(C[1G1a1G1aO6tQ`O1G3YO#EWQ`O1G3YO#E]Q`O1G3YO#EbQ`O1G3YOOQS1G3Y1G3YO8YQ`O'#J_O8YQ`O'#EiO$}QdO'#EiO8YQ`O'#IeO#EgQ(ChO,5@WOOQS1G2q1G2qO!3nQ`O1G2wOJRQ&jO1G2tO#ErQ`O1G2tOOQS1G2u1G2uOJRQ&jO1G2uO#EwQaO1G2uO#FPQ,UO'#GsOOQS1G2w1G2wO!)dQ,UO'#IgO!3sQpO1G2zOOQS1G2z1G2zOOQS,5=e,5=eO#FXQ&kO,5=gO6tQ`O,5=gO#=PQ`O,5=jO6bQ`O,5=jO!0`Q!bO,5=jO!0hQ&jO,5=jO6yQ&jO,5=jO#FjQ`O'#JnO#FuQ`O,5=kOOQS1G.j1G.jO#FzQ(ChO1G.jO#GVQ`O1G.jO#G[Q`O1G.jO6lQ(ChO1G.jO#GdQtO,5@]O#GnQ`O,5@]O#GyQdO,5=rO#HQQ`O,5=rO8YQ`O,5@]OOQS1G3[1G3[O`QdO1G3[OOQS1G3b1G3bOOQS1G3d1G3dO;_Q`O1G3fO#HVQdO1G3hO#LTQdO'#HgOOQS1G3k1G3kO#LbQ`O'#HmO;dQ`O'#HoOOQS1G3q1G3qO#LjQdO1G3qO6lQ(ChO1G3wOOQS1G3y1G3yOOQ(CW'#GS'#GSO6lQ(ChO1G3{O6lQ(ChO1G3}O$!kQ`O,5?pOMqQdO,5;TO8YQ`O,5;TO;dQ`O,5:POMqQdO,5:PO$}QdO'#JUO!0`Q!bO,5:PO$!pQ!LUO,5:POOQO,5;T,5;TO$!zQ,UO'#ISO$#bQ`O,5?oOOQ(C[1G/j1G/jO$#jQ,UO'#IYO$#tQ`O,5?{OOQ(CW1G0n1G0nO!=tQ,UO,5:PO$#|Q,UO'#E[OOQ(CW'#EZ'#EZO$$sQ(DjO'#E[O$%_Q,UO'#EPOOQO'#IV'#IVO$%pQ,UO,5:jOOQ(C[,5:j,5:jO$&mQ,UO'#EPO$&zQ,UO'#EPO$'[Q,UO'#EbO$'_Q,UO'#E[O$'xQ,UO'#E[O$%_Q,UO'#E[O$(iQ`O1G0RO$(nQqO1G0ROOQ(C[1G0R1G0RO$}QdO1G0ROJRQ&jO1G0ROOQ(C[1G0i1G0iO;dQ`O1G0iO!0`Q!bO1G0iO!0hQ&jO1G0iOOOW1G/a1G/aO$(uQpO,5<_O$(}QtO1G4XOOQO1G4_1G4_O$}QdO,5>mO$)XQ`O1G5YO$)aQ`O1G5eO$)iQtO1G5fO8YQ`O,5>sO$)sQ`O1G5bO$)sQ`O1G5bO8YQ`O1G5bO$){Q(C|O1G5cO$}QdO1G5cO$*]Q(ChO1G5cO$*nQ`O,5>uO8YQ`O,5>uOOQO,5>u,5>uO$+SQ`O,5>uOOQO-E<X-E<XOOQO1G0Y1G0YOOQO1G0[1G0[O! tQ`O1G0[OOQS7+(X7+(XOJRQ&jO7+(XO$}QdO7+(XOJRQ&jO7+(XO$+bQaO7+(XO$+pQ&kO7+(XO$,RQ(C}O,59mO$.ZQ(C}O,5<`O$0fQ(C}O,5<bO$2qQ(C}O,5<pOOQ(C[7+&U7+&UO$5SQ(C|O7+&UO$5vQ&jO'#ITO$6QQ`O,5?qOOQ(C]1G/t1G/tO$6YQdO'#IUO$6gQ`O,5?rO$6oQtO,5?rOOQ(C[1G/y1G/yO$6yQ`O7+&_OOQ(C[7+&_7+&_O$7OQ!LUO,5:`O$}QdO7+&qO$7YQ!LUO,5:WOOQ(C[7+&w7+&wOOQO1G1i1G1iOOQO1G1j1G1jO$7gQ$ISO,5<QOMqQdO,5<POOQO-E<Y-E<YOOQ(C[7+'P7+'POOOO7+'[7+'[OOOO1G1s1G1sO$7rQ`O1G1sOOQ(C[1G1u1G1uO$7wQqO,59hOOOW-E;}-E;}OOQ(C]1G/Q1G/QO$8OQ(C|O7+'bOOQ(C],5>z,5>zO$8rQ`O,5>zOOQ(C]1G2Z1G2ZP$8wQ`O'#I`POQ(C]-E<^-E<^O$9hQ&kO1G2gO$:ZQ&kO1G2iO$:eQqO1G2kOOQ(C]1G2S1G2SO$:lQ`O'#I_O$:zQ`O,5@SO$:zQ`O,5@SO$;SQ`O,5@SO$;_Q`O,5@SOOQO1G2U1G2UO$;mQ&kO1G2TOKhQ&jO1G2TO$;}QMhO'#IaO$<_Q`O,5@TOJRQ&jO,5@TO$<gQqO,5@TOOQ(C]1G2X1G2XOOQ(CW,5<r,5<rOOQ(CW,5<s,5<sO$<qQ`O,5<sO#<uQ`O,5<sO!0`Q!bO,5<rOOQO'#GZ'#GZO$<vQ`O,5<tOOQ(CW,5<v,5<vO$<qQ`O,5<yOOQO,5>|,5>|OOQO-E<`-E<`OOQ(C]1G2]1G2]O!)dQ,UO,5<rO$=OQ`O,5<sO#<zQ`O,5<tO!)dQ,UO,5<sO$=ZQ&kO1G5SO$=eQ&kO1G5SOOQO,5>},5>}OOQO-E<a-E<aOOQP1G.x1G.xO!1cQ,UO,59oO$}QdO,59oO$=rQ`O1G2OOKhQ&jO1G2VO$=wQ(C|O7+'cOOQ(C[7+'c7+'cOHRQdO7+'cOOQ(C[7+%^7+%^O$>kQqO'#JjO$(iQ`O7+(XO$>uQ`O7+(XO$>}QqO7+(XO$?XQ(CyO'#ChO$?lQ(CyO,5<wO$@^Q`O,5<wOOQ(CW1G5P1G5POOQS7+$_7+$_O;dQ`O7+$_O!0`Q!bO7+$_OHRQdO7+&UO$@cQ`O'#IjO$@tQ`O,5@[OOQO1G3Z1G3ZO6tQ`O,5@[O$@tQ`O,5@[O$@|Q`O,5@[OOQO,5?V,5?VOOQO-E<i-E<iOOQ(C[7+&y7+&yO$ARQ`O7+(tO6lQ(ChO7+(tO6tQ`O7+(tO$AWQ`O7+(tO$A]Q`O,5;TOOQ(CW,5?P,5?POOQ(CW-E<c-E<cOOQS7+(c7+(cO$AbQ(CyO7+(`OJRQ&jO7+(`O$AlQqO7+(aOOQS7+(a7+(aOJRQ&jO7+(aO$AsQ`O'#JmO$BOQ`O,5=_OOQO,5?R,5?ROOQO-E<e-E<eOOQS7+(f7+(fO$CUQ,UO'#G|OOQS1G3R1G3ROJRQ&jO1G3RO$}QdO1G3ROJRQ&jO1G3RO$C]QaO1G3RO$CkQ&kO1G3RO6lQ(ChO1G3UO#=PQ`O1G3UO6bQ`O1G3UO!0`Q!bO1G3UO!0hQ&jO1G3UO$C|Q`O'#IiO$DXQ`O,5@YO$DaQ,UO,5@YOOQ(CW1G3V1G3VOOQS7+$U7+$UO$DiQ`O7+$UO6lQ(ChO7+$UO$DnQ`O7+$UO$}QdO1G5wO$}QdO1G5xO$DsQdO1G3^O$DzQ`O1G3^O$EPQdO1G3^O$EWQ(ChO1G5wOOQS7+(v7+(vO6lQ(ChO7+)QO`QdO7+)SOOQS'#Js'#JsOOQS'#Il'#IlO$EbQdO,5>ROOQS,5>R,5>RO$}QdO'#HhO$EoQ`O'#HjOOQS,5>X,5>XO8YQ`O,5>XOOQS,5>Z,5>ZOOQS7+)]7+)]OOQS7+)c7+)cOOQS7+)g7+)gOOQS7+)i7+)iO$EtQ!bO1G5[O$FYQ!LUO1G0oO$FdQ`O1G0oOOQO1G/k1G/kO$FoQ!LUO1G/kO$FyQ`O,5?pO;dQ`O1G/kOMqQdO'#DeOOQO,5>n,5>nOOQO-E<Q-E<QOOQO,5>t,5>tOOQO-E<W-E<WO!0`Q!bO1G/kO$GOQ7[O,5:lO$HOQ(DjO,5:vO$%_Q,UO,5:kO$HjQ,UO,5:kO$HwQ,UO,5:kO$IXQ,UO,5:vO$IrQ,UO,5:vO$%_Q,UO,5:vO;dQ`O,5:kOOQO,5:v,5:vO$}QdO,5:vO$JcQ(ChO,5:vO$JnQ(ChO,5:vO!0`Q!bO,5:kOOQO-E<T-E<TOOQ(C[1G0U1G0UOOQO,5:|,5:|O$J|Q(ChO,5:vOOQ(C[7+%m7+%mO$(iQ`O7+%mO$(nQqO7+%mOOQ(C[7+&T7+&TO;dQ`O7+&TO!0`Q!bO7+&TO$KbQ`O7+*|O$KbQ`O7+*|O$KjQ(C|O7+*}O$}QdO7+*}OOQO1G4a1G4aO8YQ`O1G4aO$KzQ`O1G4aOOQO7+%v7+%vO$(iQ`O<<KsO$LYQ`O<<KsO$LbQqO<<KsOOQS<<Ks<<KsOJRQ&jO<<KsO$}QdO<<KsOJRQ&jO<<KsO$LlQaO<<KsO$LzQ(C}O1G2gO% VQ(C}O1G2iO%#bQ(C}O1G2TO%%sQ&kO,5>oOOQO-E<R-E<RO%%}QtO,5>pO$}QdO,5>pOOQO-E<S-E<SO%&XQ`O1G5^OOQ(C[<<Iy<<IyO%&aQ!LUO1G0jO%(kQ!LUO1G0tO%(rQ!LUO1G0tO%*vQ!LUO1G0tO%*}Q!LUO1G0tO%,rQ!LUO1G0tO%-YQ!LUO1G0tO%/mQ!LUO1G0tO%/tQ!LUO1G0tO%1xQ!LUO1G0tO%2PQ!LUO1G0tO%3wQ!LUO1G0tO%4[Q(C|O<<J]O%5aQ!LVO1G0tO%7VQ!LVO'#I}O%7aQ!LUO1G1YOMqQdO'#FhOOQO'#Jf'#JfOOQO1G1l1G1lO%7nQ`O1G1kO%7sQ!LUO,5>xOOOO7+'_7+'_OOOW1G/S1G/SOOQ(C]1G4f1G4fOKhQ&jO7+(VO%7}Q`O,5>yO6tQ`O,5>yOOQO-E<]-E<]O%8]Q`O1G5nO%8]Q`O1G5nO%8eQ`O1G5nO%8pQ&kO7+'oO%9QQqO,5>{O%9[Q`O,5>{OJRQ&jO,5>{OOQO-E<_-E<_O%9aQqO1G5oO%9kQ`O1G5oOOQ(CW1G2_1G2_O$<qQ`O1G2_OOQ(CW1G2^1G2^O%9sQ`O1G2`OJRQ&jO1G2`OOQ(CW1G2e1G2eO!0`Q!bO1G2^O#<uQ`O1G2_O%9xQ`O1G2`O%:QQ`O1G2_OKhQ&jO7+*nOOQ(C]1G/Z1G/ZO%:]Q`O1G/ZOOQ(C]7+'j7+'jO%:bQ&kO7+'qO%:rQ(C|O<<J}OOQ(C[<<J}<<J}OJRQ&jO'#IdO%;fQ`O,5@UOJRQ&jO1G2cOOQS<<Gy<<GyO;dQ`O<<GyO%;nQ(C|O<<IpOOQ(C[<<Ip<<IpOOQO,5?U,5?UO%<bQ`O,5?UO%<gQ`O,5?UOOQO-E<h-E<hO%<oQ`O1G5vO%<oQ`O1G5vO6tQ`O1G5vO%<wQ`O<<L`OOQS<<L`<<L`O%<|Q`O<<L`O6lQ(ChO<<L`O%=RQ`O1G0oOOQS<<Kz<<KzO$AbQ(CyO<<KzOOQS<<K{<<K{O$AlQqO<<K{O%=WQ,UO'#IfO%=cQ`O,5@XOMqQdO,5@XOOQS1G2y1G2yO%=kQ(DjO'#JUO%>VQdO'#JUO%>^Q,UO'#E[O%>tQ(ChO'#E[O$$sQ(DjO'#E[O$%hQ,UO'#G}OOQO'#Ih'#IhO%?YQ,UO,5=hOOQS,5=h,5=hO%?aQ,UO'#E[O%?rQ,UO'#E[O%@YQ,UO'#E[O%@vQ,UO'#G}O%AXQ`O7+(mO%A^Q`O7+(mO%AfQqO7+(mOOQS7+(m7+(mOJRQ&jO7+(mO$}QdO7+(mOJRQ&jO7+(mO%ApQaO7+(mOOQS7+(p7+(pO6lQ(ChO7+(pO#=PQ`O7+(pO6bQ`O7+(pO!0`Q!bO7+(pO%BOQ`O,5?TOOQO-E<g-E<gOOQO'#HQ'#HQO%BZQ`O1G5tO6lQ(ChO<<GpOOQS<<Gp<<GpO%BcQ`O<<GpO%BhQ`O7++cO%BmQ`O7++dOOQS7+(x7+(xO%BrQ`O7+(xO%BwQdO7+(xO%COQ`O7+(xO$}QdO7++cO$}QdO7++dOOQS<<Ll<<LlOOQS<<Ln<<LnOOQS-E<j-E<jOOQS1G3m1G3mO%CTQ`O,5>SOOQS,5>U,5>UO%CYQ`O1G3sO8YQ`O7+&ZOMqQdO7+&ZOOQ(CW1G5[1G5[OOQO7+%V7+%VO%C_Q!LUO1G5fO;dQ`O7+%VO;dQ`O1G0VOOQO1G0b1G0bO$}QdO1G0bO%CiQ(ChO1G0bO%CtQ(ChO1G0bO!0`Q!bO1G0VO$%_Q,UO1G0VO%DSQ,UO1G0VO%DaQ(DjO1G0bO%D{Q,UO1G0VO$%_Q,UO1G0bO%E]Q,UO1G0bO%EvQ(ChO1G0bOOQO1G0V1G0VO%F[Q(C|O1G0bOOQ(C[<<IX<<IXOOQ(C[<<Io<<IoO;dQ`O<<IoO%FfQ`O<<NhO%FnQ(C|O<<NiOOQO7+){7+){O8YQ`O7+){OOQSANA_ANA_OJRQ&jOANA_O$(iQ`OANA_O%GOQ`OANA_O%GWQqOANA_O$}QdOANA_OJRQ&jOANA_O%GbQ(C}O7+'oO%IsQ(C}O7+'qO%LUQtO1G4[O%L`Q!LUO7+&UO%MUQ!LVO,59mO& YQ!LVO,5<`O&#aQ!LVO,5<bO&%SQ!LVO,5<pO&&xQ!LUO7+'bO&'VQ!LUO7+'cO&'dQ`O,5<SOOQO7+'V7+'VO&'iQ&kO<<KqOOQO1G4e1G4eO&'pQ`O1G4eO&'{Q`O1G4eO&(ZQ`O7++YO&(ZQ`O7++YOJRQ&jO1G4gO&(cQqO1G4gO&(mQ`O7++ZOOQ(CW7+'y7+'yO$<qQ`O7+'zO&(uQqO7+'zOOQ(CW7+'x7+'xO$<qQ`O7+'yO&(|Q`O7+'zOJRQ&jO7+'zO#<uQ`O7+'yO&)RQ&kO<<NYOOQ(C]7+$u7+$uO&)]QqO,5?OOOQO-E<b-E<bO&)gQ(CyO7+'}OOQSAN=eAN=eO6tQ`O1G4pOOQO1G4p1G4pO&)wQ`O1G4pO&)|Q`O7++bO&)|Q`O7++bO6lQ(ChOANAzO&*UQ`OANAzOOQSANAzANAzOOQSANAfANAfOOQSANAgANAgO&*ZQ`O,5?QOOQO-E<d-E<dO&*fQ!LUO1G5sO#=PQ`O,5=iO6bQ`O,5=iO&,vQtO'#ChO&-QQ,UO,5:vO&-[Q,UO,5:vO!0`Q!bO,5=iOOQO-E<f-E<fOOQS1G3S1G3SO%>VQdO,5<tO%=kQ(DjO,5=iO$HOQ(DjO,5:vO$%hQ,UO,5=iO&-lQ,UO,5=iO&-}Q,UO,5:vOOQS<<LX<<LXOJRQ&jO<<LXO%AXQ`O<<LXO&.eQ`O<<LXO&.mQqO<<LXO$}QdO<<LXOJRQ&jO<<LXOOQS<<L[<<L[O6lQ(ChO<<L[O#=PQ`O<<L[O6bQ`O<<L[O&.wQ,UO1G4oO&/PQ`O7++`OOQSAN=[AN=[O6lQ(ChOAN=[OOQS<<N}<<N}OOQS<= O<= OOOQS<<Ld<<LdO&/XQ`O<<LdO&/^QdO<<LdO&/eQ`O<<N}O&/jQ`O<= OOOQS1G3n1G3nO;dQ`O7+)_O&/oQ`O<<IuO&/zQ!LUO<<IuOOQO<<Hq<<HqOOQO7+%q7+%qO%F[Q(C|O7+%|OOQO7+%|7+%|O$}QdO7+%|O&0UQ(ChO7+%|O;dQ`O7+%qO!0`Q!bO7+%qO$%_Q,UO7+%qO&0aQ(ChO7+%|O&0oQ,UO7+%qO&0|Q(ChO7+%|O&1bQ(DjO7+%|O&1lQ,UO7+%qO$%_Q,UO7+%|OOQ(C[AN?ZAN?ZOOQO<<Mg<<MgO$(iQ`OG26yOOQSG26yG26yOJRQ&jOG26yO&1|Q`OG26yO&2UQqOG26yO&2`Q!LUO<<J]O&2mQ!LVO1G2TO&4wQ!LVO1G2gO&7OQ!LVO1G2iO&8qQ!LUO<<J}O&9OQ!LUO<<IpOOQO1G1n1G1nOKhQ&jOANA]OOQO7+*P7+*PO&9]Q`O7+*PO&9hQ`O<<NtO&9pQqO7+*ROOQ(CW<<Kf<<KfO$<qQ`O<<KfOOQ(CW<<Ke<<KeO&9zQqO<<KfO$<qQ`O<<KeOOQO7+*[7+*[O6tQ`O7+*[O&:RQ`O<<N|OOQSG27fG27fO6lQ(ChOG27fOMqQdO1G4lO&:ZQ`O7++_O6lQ(ChO1G3TO#=PQ`O1G3TO&:cQ,UO1G0bO6bQ`O1G3TO!0`Q!bO1G3TO$%hQ,UO1G3TO%=kQ(DjO1G3TO%DaQ(DjO1G0bO&:mQ,UO1G3TO%AXQ`OANAsOOQSANAsANAsOJRQ&jOANAsO&;OQ`OANAsO&;WQqOANAsOOQSANAvANAvO6lQ(ChOANAvO#=PQ`OANAvOOQO'#HR'#HROOQO7+*Z7+*ZOOQSG22vG22vOOQSANBOANBOO&;bQ`OANBOOOQSANDiANDiOOQSANDjANDjOOQS<<Ly<<LyOMqQdOAN?aOOQO<<Ih<<IhO%F[Q(C|O<<IhO$}QdO<<IhOOQO<<I]<<I]O;dQ`O<<I]O!0`Q!bO<<I]O&;gQ(ChO<<IhO$%_Q,UO<<I]O&;rQ(ChO<<IhO&<QQ,UO<<I]O&<_Q(ChO<<IhOOQSLD,eLD,eO$(iQ`OLD,eOJRQ&jOLD,eO&<sQ!LVO7+'oO&>iQ!LVO7+'qO&@_Q&kOG26wOOQO<<Mk<<MkOOQ(CWANAQANAQO$<qQ`OANAQOOQ(CWANAPANAPOOQO<<Mv<<MvOOQSLD-QLD-QO&@oQ!LUO7+*WOOQO7+(o7+(oO6lQ(ChO7+(oO#=PQ`O7+(oO6bQ`O7+(oO!0`Q!bO7+(oO$%hQ,UO7+(oOOQSG27_G27_O%AXQ`OG27_OJRQ&jOG27_OOQSG27bG27bO6lQ(ChOG27bOOQSG27jG27jO&@yQ!LUOG24{OOQOAN?SAN?SO%F[Q(C|OAN?SOOQOAN>wAN>wO;dQ`OAN>wO$}QdOAN?SO!0`Q!bOAN>wO&ATQ(ChOAN?SO$%_Q,UOAN>wO&A`Q(ChOAN?SOOQS!$(!P!$(!PO$(iQ`O!$(!PO&AnQ(C}OG26wOOQ(CWG26lG26lOOQO<<LZ<<LZO6lQ(ChO<<LZO#=PQ`O<<LZO6bQ`O<<LZO!0`Q!bO<<LZOOQSLD,yLD,yO%AXQ`OLD,yOOQSLD,|LD,|OOQOG24nG24nOOQOG24cG24cO%F[Q(C|OG24nO;dQ`OG24cO$}QdOG24nO!0`Q!bOG24cO&DPQ(ChOG24nOOQS!)9Ek!)9EkO&DmQ7]O,5:zOOQOANAuANAuO6lQ(ChOANAuO#=PQ`OANAuO6bQ`OANAuOOQS!$(!e!$(!eOOQOLD*YLD*YOOQOLD)}LD)}O%F[Q(C|OLD*YO;dQ`OLD)}O$}QdOLD*YO&EpQ!LVOG26wO&GfQ7]O,59mO&HfQ7]O,5<`O&IfQ7]O,5<bO&JfQ7]O,5<pOOQOG27aG27aO6lQ(ChOG27aO#=PQ`OG27aOOQO!$'Mt!$'MtOOQO!$'Mi!$'MiO%F[Q(C|O!$'MtO&KiQ7]O1G2gO&LiQ7]O1G2iO&MiQ7]O1G2TOOQOLD,{LD,{O6lQ(ChOLD,{OOQO!)9C`!)9C`O&NlQ7]O7+'oO' oQ7]O7+'qOOQO!$(!g!$(!gO'!rQ7]OG26wOMqQdO'#DtO.fQ`O'#EQO'#uQtO'#JQOMqQdO'#DlO'#|QtO'#ChO'&dQtO'#ChO'&tQdO,5;OO'(tQ&jO'#E`OMqQdO,5;YOMqQdO,5;YOMqQdO,5;YOMqQdO,5;YOMqQdO,5;YOMqQdO,5;YOMqQdO,5;YOMqQdO,5;YOMqQdO,5;YOMqQdO,5;YOMqQdO,5;YOMqQdO'#I^O'*UQ`O,5<_O'*^Q&jO,5;YO'+nQ&jO,5;YOMqQdO,5;nO.iQ`O'#DRO.iQ`O'#DRO.iQ`O'#DROJRQ&jO'#FtO'(tQ&jO'#FtO'*^Q&jO'#FtOJRQ&jO'#FvO'(tQ&jO'#FvO'*^Q&jO'#FvOJRQ&jO'#GUO'(tQ&jO'#GUO'*^Q&jO'#GUOMqQdO,5?zO'&tQdO1G0jO'+uQ!LUO'#ChOMqQdO1G1vOJRQ&jO,5<{O'(tQ&jO,5<{O'*^Q&jO,5<{OJRQ&jO,5<}O'(tQ&jO,5<}O'*^Q&jO,5<}OJRQ&jO,5<iO'(tQ&jO,5<iO'*^Q&jO,5<iO'&tQdO1G1wOMqQdO7+&qOJRQ&jO1G2TO'(tQ&jO1G2TO'*^Q&jO1G2TOJRQ&jO1G2VO'(tQ&jO1G2VO'*^Q&jO1G2VO'&tQdO7+'cO'&tQdO7+&UO',PQ`O7+'zOJRQ&jOANA]O'(tQ&jOANA]O'*^Q&jOANA]O',PQ`O<<KfO',PQ`OANAQO',UQ`O'#EdO',ZQ`O'#EdO',cQ`O'#FSO',hQ`O'#EnO',mQ`O'#J`O',xQ`O'#J^O'-TQ`O,5;OO'-YQ&kO,5<[O'-aQ`O'#F}O'-fQ`O'#F}O'-kQ`O'#F}O'-pQ`O,5<]O'-xQ`O,5;OO'.QQ!LUO1G1VO'.XQ`O,5<iO'.^Q`O,5<iO'.cQ`O,5<iO'.hQ`O,5<kO'.mQ`O,5<kO'.rQ`O,5<kO'.wQ`O1G1wO'.|Q`O1G0jO'/RQ`O1G2`O'/WQ&kO<<KqO'/_Q&kO<<KqO'/fQ&kO<<KqO'/mQqO7+'zO'/tQ`O7+'zO'/yQqO<<KfO4}Q&jO'#FrO6bQ`O'#FqO={Q`O'#EcOMqQdO,5;kO!(eQ`O'#F}O!(eQ`O'#F}O!(eQ`O'#F}O!(eQ`O'#GPO!(eQ`O'#GPO!(eQ`O'#GPO'0QQ`O,5<tOKhQ&jO7+(VOKhQ&jO7+(VOKhQ&jO7+(VOJRQ&jO1G2`O'0YQ`O1G2`OJRQ&jO7+'zO$:eQqO1G2kO$:eQqO1G2kO$:eQqO1G2kOJRQ&jO,5=POJRQ&jO,5=POJRQ&jO,5=P",stateData:"'1c~O'gOS'hOSTOSUOS~OQUORUOX}O]gO_lObrOcqOigOkUOlgOmgOrgOtUOvUO{SO!OgO!PgO!VTO!aoO!fVO!iUO!jUO!kUO!lUO!mUO!ppO!uXO#lwO#|tO$QbO%[uO%^xO%`vO%avO%dyO%fzO%i{O%j{O%l|O%y!OO&P!PO&R!QO&T!RO&V!SO&Y!TO&`!UO&f!VO&h!WO&j!XO&l!YO&n!ZO'jQO'rRO'|WO(ZeO~OQUORUO]gOb!aOc!`OigOkUOlgOmgOrgOtUOvUO{SO!OgO!PgO!V!]O!aoO!fVO!iUO!jUO!kUO!lUO!mUO!p!_O#|!bO$QbO'j![O'rRO'|WO(ZeO~OQ[XZ[X_[Xk[Xx[Xy[X{[X!T[X!c[X!d[X!f[X!l[X#T[X#`dX#c[X#d[X#e[X#f[X#g[X#h[X#i[X#j[X#k[X#m[X#o[X#q[X#r[X#w[X'e[X'r[X'}[X(U[X(V[X~O!_$vX~P&}OS!cO'c!dO'd!fO~OQUORUO]gOb!aOc!`OigOkUOlgOmgOrgOtUOvUO{SO!OgO!PgO!V!]O!aoO!fVO!iUO!jUO!kUO!lUO!mUO!p!_O#|!bO$QbO'j;ZO'rRO'|WO(ZeO~O!S!jO!T!gO!Q'vP!Q(RP~P)jO!U!rO~P`OQUORUO]gOb!aOc!`OigOkUOlgOmgOrgOtUOvUO{SO!OgO!PgO!V!]O!aoO!fVO!iUO!jUO!kUO!lUO!mUO!p!_O#|!bO$QbO'rRO'|WO(ZeO~O!S!xO!uXO#^!{O#_!xO'j;[O!e(OP~P,RO!f!}O'j!|O~O!p#RO!uXO%[#SO~O#`#TO~O!_#UO#`#TO~OQ#lOZ#sOk#aOx#YOy#ZO{#[O!T#pO!c#cO!d#WO!f#XO!l#lO#c#_O#d#`O#e#`O#f#`O#g#bO#h#cO#i#cO#j#rO#k#cO#m#dO#o#fO#q#hO#r#iO'rRO'}#jO(U#]O(V#^O~O_'tX'e'tX'a'tX!e'tX!Q'tX!V'tX%]'tX!_'tX~P/WO#T#tO#w#tOQ'uXZ'uX_'uXk'uXx'uXy'uX{'uX!T'uX!c'uX!d'uX!f'uX!l'uX#c'uX#d'uX#e'uX#f'uX#g'uX#h'uX#i'uX#j'uX#m'uX#o'uX#q'uX#r'uX'r'uX'}'uX(U'uX(V'uX~O#k'uX'e'uX'a'uX!Q'uX!e'uXo'uX!V'uX%]'uX!_'uX~P1nO#T#tO~O$S#vO$U#uO$]#{O~O!V#|O$QbO$`#}O$b$PO~O]$SOi$cOk$TOl$SOm$SOr$dOt$eOv$fO{$[O!V$]O!a$kO!f$XO#_$lO#|$iO$i$gO$k$hO$n$jO'j$RO'n$bO'r$UOe'oP~O!f$mO~O!_$oO~O_$pO'e$pO~O'j$tO~O!f$mO'j$tO'k$vO'n$bO~Oc$|O!f$mO'j$tO~O#k#cO~O]%VOx%RO!V%OO!f%QO%^%UO'j$tO'k$vO^(cP~O!p#RO~O{%WO!V%XO'j$tO~O{%WO!V%XO%f%]O'j$tO~O'j%^O~O#lwO%^xO%`vO%avO%dyO%fzO%i{O%j{O~Ob%gOc%fO!p%dO%[%eO%n%cO~P8xOb%jOcqO!V%iO!ppO!uXO#lwO%[uO%`vO%avO%dyO%fzO%i{O%j{O%l|O~O`%mO#T%pO%^%kO'k$vO~P9wO!f%qO!i%uO~O!f!}O~O!VTO~O_$pO'b%}O'e$pO~O_$pO'b&QO'e$pO~O_$pO'b&SO'e$pO~O'a[Xo[X!Q[X!e[X%}[X!V[X%][X!_[X~P&}O]&XOl&XO{&WO!S&[O!Y&bO!Z&ZO![&ZO'k$vO's&UO!U'wP!U(TP~OP&fO!V&cO!q&eO'j$tO~Oc&kO!f$mO'j$tO~Ox%RO!f%QO~OS!cO'c!dO'd&nO~O!S&pO!Q&uX!Q&{X!T&uX!T&{X~P)jO!T&rO!Q'vX~OQ#lOZ#sOk#aOx#YOy#ZO{#[O!T&rO!c#cO!d#WO!f#XO!l#lO#c#_O#d#`O#e#`O#f#`O#g#bO#h#cO#i#cO#j#rO#k#cO#m#dO#o#fO#q#hO#r#iO'rRO'}#jO(U#]O(V#^O~O!Q'vX~P?WO!Q&wO~O!Q(QX!T(QX!_(QX!e(QX'}(QX~O#T(QX#`#XX!U(QX~PA^O#T&xO!Q(SX!T(SX~O!T&yO!Q(RX~O!Q&|O~O#T#tO~PA^O!U&}O~P`Ox#YOy#ZO{#[O!d#WO!f#XO'rROQ!haZ!hak!ha!T!ha!c!ha!l!ha#c!ha#d!ha#e!ha#f!ha#g!ha#h!ha#i!ha#j!ha#k!ha#m!ha#o!ha#q!ha#r!ha'}!ha(U!ha(V!ha~O_!ha'e!ha'a!ha!Q!ha!e!hao!ha!V!ha%]!ha!_!ha~PBtO!e'OO~O{%WO!V%XO!uXO#^'RO#_'QO'j$tO~O!_#UO#T'TO'}'SO!T(PX_(PX'e(PX~O!e(PX~PExO!T'WO!e(OX~O!e'YO~O{%WO!V%XO#_'QO'j$tO~Ox'ZOy'[O!d#WO!f#XO!u!ta{!ta~O!p!ta%[!ta!V!ta#^!ta#_!ta'j!ta~PGQO!p'`O~OQUORUO]gOb!aOc!`OigOkUOlgOmgOrgOtUOvUO{SO!OgO!PgO!VTO!aoO!fVO!iUO!jUO!kUO!lUO!mUO!p!_O#|!bO$QbO'j![O'rRO'|WO(ZeO~O]$SOi$cOk$TOl$SOm$SOr$dOt$eOv;oO{$[O!V$]O!a=`O!f$XO#_;xO#|$iO$i;rO$k;uO$n$jO'j'dO'n$bO'r$UO~O#`'fO~O]$SOi$cOk$TOl$SOm$SOr$dOt$eOv$fO{$[O!V$]O!a$kO!f$XO#_$lO#|$iO$i$gO$k$hO$n$jO'j'dO'n$bO'r$UO~Oe'yP~PKhO!S'jO!e'zP~P$}O's'lO'|WO~O{'nO!f#XO's'lO'|WO~OQ;VOR;VO]gOb=ZOc!`OigOk;VOlgOmgOrgOt;VOv;VO{SO!OgO!PgO!V!]O!a;YO!fVO!i;VO!j;VO!k;VO!l;VO!m;VO!p!_O#|!bO$QbO'j'|O'rRO'|WO(Z=XO~Oy(PO!f#XO~O!T#pO_$ga'e$ga'a$ga!e$ga!Q$ga!V$ga%]$ga!_$ga~O#l(TO~PJROx(WO!_(VO!V$TX$P$TX$S$TX$U$TX$]$TX~O!_(VO!V(WX$P(WX$S(WX$U(WX$](WX~Ox(WO~P!#WOx(WO!V(WX$P(WX$S(WX$U(WX$](WX~O!V(YO$P(^O$S(XO$U(XO$](_O~O!S(bO~PMqO$S#vO$U#uO$](eO~OP$oXx$oX{$oX!d$oX(U$oX(V$oX~OPgXegXe$oX!TgX#TgX~P!$|Ol(gO~OS(hO'c(iO'd(kO~OP(tOx(mO{(nO(U(pO(V(rO~Oe(lO~P!&VOe(uO~O]$SOi$cOk$TOl$SOm$SOr$dOt$eOv;oO{$[O!V$]O!a=`O!f$XO#_;xO#|$iO$i;rO$k;uO$n$jO'n$bO'r$UO~O!S(yO'j(vO!e([P~P!&tO#`({O~O!f(|O~O!S)RO'j)OO!Q(]P~P!&tOk)`O{)WO!Y)^O!Z)VO![)VO!f(|O#P)_O%S)YO'k$vO's)TO~O!U)]O~P!(wO!d#WOP'qXx'qX{'qX(U'qX(V'qX!T'qX#u'qX!U'qX~Oe'qX#T'qX]'qXl'qX!Y'qX!Z'qX!['qX!u'qX!y'qX!z'qX!{'qX#P'qX#Q'qX'k'qX's'qX'|'qX~P!)pOP)cO#T)bOe'pX!T'pX~O!T)dOe'oX~O'j%^Oe'oP~O!f)kO~O'j'dO~O{%WO!S!xO!V%XO!uXO#^!{O#_!xO'j$tO!e(OP~O!_#UO#`)oO~OQ#lOZ#sOk#aOx#YOy#ZO{#[O!c#cO!d#WO!f#XO!l#lO#c#_O#d#`O#e#`O#f#`O#g#bO#h#cO#i#cO#j#rO#k#cO#m#dO#o#fO#q#hO#r#iO'rRO'}#jO(U#]O(V#^O~O_!`a!T!`a'e!`a'a!`a!Q!`a!e!`ao!`a!V!`a%]!`a!_!`a~P!-ROP)wO!V&cO!q)vO%])uO'n$bO~O!_)yO!V'mX_'mX!T'mX'e'mX~O!f$mO'n$bO~O!f$mO'j$tO'n$bO~O!_#UO#`'fO~O]*UO%^*VO'j*RO!U(dP~O!T*WO^(cX~O's'lO~OZ*[O~O^*]O~O!V%OO'j$tO'k$vO^(cP~O{%WO!S*aO!T&yO!V%XO'j$tO!Q(RP~O]&_Ol&_O{*cO!S*bO's'lO~O!U(TP~P!2fO!T*dO_(`X'e(`X~O#T*hO'n$bO~OP*kO!V$]O'n$bO~O!V*mO~Ox*oO!VTO~O!p*tO~Oc*yO~O'j!|O!U(bP~Oc$|O~O%^xO'j%^O~P9wOZ+PO^+OO~OQUORUO]gObrOcqOigOkUOlgOmgOrgOtUOvUO{SO!OgO!PgO!aoO!fVO!iUO!jUO!kUO!lUO!mUO!ppO!uXO$QbO%[uO'rRO'|WO(ZeO~O!V!]O#|!bO'j![O~P!4vO^+OO_$pO'e$pO~O_+TO#l+VO%`+VO%a+VO~P$}O!f%qO~O&P+[O~O!V+^O~O&b+`O&d+aOQ&_aR&_aX&_a]&_a_&_ab&_ac&_ai&_ak&_al&_am&_ar&_at&_av&_a{&_a!O&_a!P&_a!V&_a!a&_a!f&_a!i&_a!j&_a!k&_a!l&_a!m&_a!p&_a!u&_a#l&_a#|&_a$Q&_a%[&_a%^&_a%`&_a%a&_a%d&_a%f&_a%i&_a%j&_a%l&_a%y&_a&P&_a&R&_a&T&_a&V&_a&Y&_a&`&_a&f&_a&h&_a&j&_a&l&_a&n&_a'a&_a'j&_a'r&_a'|&_a(Z&_a!U&_a&W&_a`&_a&]&_a~O'j+fO~O!TzX!T!]X!UzX!U!]X!_zX!_!]X!f!]X#TzX'n!]X~O!_+kO#T+jO!T#]X!T'xX!U#]X!U'xX!_'xX!f'xX'n'xX~O!_+mO!f$mO'n$bO!T!XX!U!XX~O]&VOl&VO{+nO's)TO~OQ;VOR;VO]gOb=ZOc!`OigOk;VOlgOmgOrgOt;VOv;VO{SO!OgO!PgO!V!]O!a;YO!fVO!i;VO!j;VO!k;VO!l;VO!m;VO!p!_O#|!bO$QbO'rRO'|WO(Z=XO~O'j;}O~P!>SO!T+rO!U'wX~O!U+tO~O!_+kO#T+jO!T#]X!U#]X~O!T+uO!U(TX~O!U+wO~O]&VOl&VO{+nO'k$vO's)TO~O!Z+xO![+xO~P!AQO_+}O!U,PO!Y,QO!Z+|O![+|O!u;WO!y,UO!z,SO!{,TO!|,RO#P,VO#Q,VO'|+zO~P!AQOP,[O!V&cO!q,ZO~Oo,aO~O!Q&ua!T&ua~P!-RO!S,eO!Q&uX!T&uX~P$}O!T&rO!Q'va~O!Q'va~P?WO!T&yO!Q(Ra~O{%WO!S,iO!V%XO'j$tO!Q&{X!T&{X~O!T'WO!e(Oa~O{%WO!V%XO#_,lO'j$tO~O#T,nO!T(Pa!e(Pa_(Pa'e(Pa~O!_#UO~P!DvO{%WO!S,qO!V%XO!uXO#^,sO#_,qO'j$tO!T&}X!e&}X~Oy,wO!f#XO~OP,{O!V&cO!q,zO%],yO'n$bO~O_#Wi!T#Wi'e#Wi'a#Wi!Q#Wi!e#Wio#Wi!V#Wi%]#Wi!_#Wi~P!-ROP=mOx(mO{(nO(U(pO(V(rO~O#`#Sa!T#Sa!e#Sa#T#Sa!V#Sa_#Sa'e#Sa!Q#Sa~P!G[O!d#WOP'qXx'qX{'qX(U'qX(V'qXQ'qXZ'qXk'qXy'qX!T'qX!c'qX!f'qX!l'qX#c'qX#d'qX#e'qX#f'qX#g'qX#h'qX#i'qX#j'qX#k'qX#m'qX#o'qX#q'qX#r'qX'r'qX'}'qX~O#`'qX_'qX'e'qX!e'qX!Q'qX'a'qX!V'qX#T'qXo'qX%]'qX!_'qX~P!HZO!T-UOe'yX~P!&VOe-WO~O!T-XO!e'zX~P!-RO!e-[O~O!Q-^O~OQ#lOx#YOy#ZO{#[O!d#WO!f#XO!l#lO'rROZ#bi_#bik#bi!T#bi!c#bi#d#bi#e#bi#f#bi#g#bi#h#bi#i#bi#j#bi#k#bi#m#bi#o#bi#q#bi#r#bi'e#bi'}#bi(U#bi(V#bi'a#bi!Q#bi!e#bio#bi!V#bi%]#bi!_#bi~O#c#bi~P!KrO#c#_O~P!KrOQ#lOx#YOy#ZO{#[O!d#WO!f#XO!l#lO#c#_O#d#`O#e#`O#f#`O'rROZ#bi_#bi!T#bi!c#bi#g#bi#h#bi#i#bi#j#bi#k#bi#m#bi#o#bi#q#bi#r#bi'e#bi'}#bi(U#bi(V#bi'a#bi!Q#bi!e#bio#bi!V#bi%]#bi!_#bi~Ok#bi~P!NdOk#aO~P!NdOQ#lOk#aOx#YOy#ZO{#[O!d#WO!f#XO!l#lO#c#_O#d#`O#e#`O#f#`O#g#bO'rRO_#bi!T#bi#m#bi#o#bi#q#bi#r#bi'e#bi'}#bi(U#bi(V#bi'a#bi!Q#bi!e#bio#bi!V#bi%]#bi!_#bi~OZ#bi!c#bi#h#bi#i#bi#j#bi#k#bi~P##UOZ#sO!c#cO#h#cO#i#cO#j#rO#k#cO~P##UOQ#lOZ#sOk#aOx#YOy#ZO{#[O!c#cO!d#WO!f#XO!l#lO#c#_O#d#`O#e#`O#f#`O#g#bO#h#cO#i#cO#j#rO#k#cO#m#dO'rRO_#bi!T#bi#o#bi#q#bi#r#bi'e#bi'}#bi(V#bi'a#bi!Q#bi!e#bio#bi!V#bi%]#bi!_#bi~O(U#bi~P#&VO(U#]O~P#&VOQ#lOZ#sOk#aOx#YOy#ZO{#[O!c#cO!d#WO!f#XO!l#lO#c#_O#d#`O#e#`O#f#`O#g#bO#h#cO#i#cO#j#rO#k#cO#m#dO#o#fO'rRO(U#]O_#bi!T#bi#q#bi#r#bi'e#bi'}#bi'a#bi!Q#bi!e#bio#bi!V#bi%]#bi!_#bi~O(V#bi~P#(wO(V#^O~P#(wOQ#lOZ#sOk#aOx#YOy#ZO{#[O!c#cO!d#WO!f#XO!l#lO#c#_O#d#`O#e#`O#f#`O#g#bO#h#cO#i#cO#j#rO#k#cO#m#dO#o#fO#q#hO'rRO(U#]O(V#^O~O_#bi!T#bi#r#bi'e#bi'}#bi'a#bi!Q#bi!e#bio#bi!V#bi%]#bi!_#bi~P#+iOQ[XZ[Xk[Xx[Xy[X{[X!c[X!d[X!f[X!l[X#T[X#`dX#c[X#d[X#e[X#f[X#g[X#h[X#i[X#j[X#k[X#m[X#o[X#q[X#r[X#w[X'r[X'}[X(U[X(V[X!T[X!U[X~O#u[X~P#.SOQ#lOZ;mOk;aOx#YOy#ZO{#[O!c;cO!d#WO!f#XO!l#lO#c;_O#d;`O#e;`O#f;`O#g;bO#h;cO#i;cO#j;lO#k;cO#m;dO#o;fO#q;hO#r;iO'rRO'}#jO(U#]O(V#^O~O#u-`O~P#0aOQ'uXZ'uXk'uXx'uXy'uX{'uX!c'uX!d'uX!f'uX!l'uX#c'uX#d'uX#e'uX#f'uX#g'uX#h'uX#i'uX#j'uX#m'uX#o'uX#q'uX#r'uX'r'uX'}'uX(U'uX(V'uX!T'uX~O#T;nO#w;nO#k'uX#u'uX!U'uX~P#2_O_'Qa!T'Qa'e'Qa'a'Qa!e'Qao'Qa!Q'Qa!V'Qa%]'Qa!_'Qa~P!-ROQ#biZ#bi_#bik#biy#bi!T#bi!c#bi!d#bi!f#bi!l#bi#c#bi#d#bi#e#bi#f#bi#g#bi#h#bi#i#bi#j#bi#k#bi#m#bi#o#bi#q#bi#r#bi'e#bi'r#bi'}#bi'a#bi!Q#bi!e#bio#bi!V#bi%]#bi!_#bi~P!G[O_#vi!T#vi'e#vi'a#vi!Q#vi!e#vio#vi!V#vi%]#vi!_#vi~P!-RO$S-cO$U-cO~O$S-dO$U-dO~O!_(VO#T-eO!V$YX$P$YX$S$YX$U$YX$]$YX~O!S-fO~O!V(YO$P-hO$S(XO$U(XO$]-iO~O!T;jO!U'tX~P#0aO!U-jO~O$]-lO~OS(hO'c(iO'd-oO~O]-rOl-rO!Q-sO~O!TdX!_dX!edX!e$oX'}dX~P!$|O!e-yO~P!G[O!T-zO!_#UO'}'SO!e([X~O!e.PO~O!S(yO'j$tO!e([P~O#`.RO~O!Q$oX!T$oX!_$vX~P!$|O!T.SO!Q(]X~P!G[O!_.UO~O!Q.WO~Ok.[O!_#UO!f$mO'n$bO'}'SO~O'j.^O~O!_)yO~O_$pO!T.bO'e$pO~O!U.dO~P!(wO!Z.eO![.eO'k$vO's)TO~O{.gO's)TO~O#P.hO~O'j%^Oe'VX!T'VX~O!T)dOe'oa~Oe.mO~Ox.nOy.nO{.oOPua(Uua(Vua!Tua#Tua~Oeua#uua~P#>mOx(mO{(nOP$ha(U$ha(V$ha!T$ha#T$ha~Oe$ha#u$ha~P#?cOx(mO{(nOP$ja(U$ja(V$ja!T$ja#T$ja~Oe$ja#u$ja~P#@UO].pO~O#`.qO~Oe$xa!T$xa#T$xa#u$xa~P!&VO#`.tO~OP,{O!V&cO!q,zO%],yO~O]$SOk$TOl$SOm$SOr$dOt$eOv;oO{$[O!V$]O!a=`O!f$XO#_;xO#|$iO$i;rO$k;uO$n$jO'n$bO'r$UO~Oi.{O'j.zO~P#AvO!_)yO!V'ma_'ma!T'ma'e'ma~O#`/RO~OZ[X!TdX!UdX~O!T/SO!U(dX~O!U/UO~OZ/VO~O]/XO'j*RO~O!V%OO'j$tO^'_X!T'_X~O!T*WO^(ca~O!e/[O~P!-RO]/^O~OZ/_O~O^/`O~O!T*dO_(`a'e(`a~O#T/fO~OP/iO!V$]O~O's'lO!U(aP~OP/sO!V/oO!q/rO%]/qO'n$bO~OZ/}O!T/{O!U(bX~O!U0OO~O^0QO_$pO'e$pO~O]0RO~O]0SO'j!|O~O#k0TO%}0UO~P1nO#T#tO#k0TO%}0UO~O_0VO~P$}O_0XO~O&W0]OQ&UiR&UiX&Ui]&Ui_&Uib&Uic&Uii&Uik&Uil&Uim&Uir&Uit&Uiv&Ui{&Ui!O&Ui!P&Ui!V&Ui!a&Ui!f&Ui!i&Ui!j&Ui!k&Ui!l&Ui!m&Ui!p&Ui!u&Ui#l&Ui#|&Ui$Q&Ui%[&Ui%^&Ui%`&Ui%a&Ui%d&Ui%f&Ui%i&Ui%j&Ui%l&Ui%y&Ui&P&Ui&R&Ui&T&Ui&V&Ui&Y&Ui&`&Ui&f&Ui&h&Ui&j&Ui&l&Ui&n&Ui'a&Ui'j&Ui'r&Ui'|&Ui(Z&Ui!U&Ui`&Ui&]&Ui~O`0cO!U0aO&]0bO~P`O!VTO!f0eO~O&d+aOQ&_iR&_iX&_i]&_i_&_ib&_ic&_ii&_ik&_il&_im&_ir&_it&_iv&_i{&_i!O&_i!P&_i!V&_i!a&_i!f&_i!i&_i!j&_i!k&_i!l&_i!m&_i!p&_i!u&_i#l&_i#|&_i$Q&_i%[&_i%^&_i%`&_i%a&_i%d&_i%f&_i%i&_i%j&_i%l&_i%y&_i&P&_i&R&_i&T&_i&V&_i&Y&_i&`&_i&f&_i&h&_i&j&_i&l&_i&n&_i'a&_i'j&_i'r&_i'|&_i(Z&_i!U&_i&W&_i`&_i&]&_i~O!Q0kO~O!T!Xa!U!Xa~P#0aO!S0rO!Y&bO!Z&ZO![&ZO!T&vX!U&vX~P!AQO!T+rO!U'wa~O!T&|X!U&|X~P!2fO!T+uO!U(Ta~O!Y0{O!Z0zO![0zO!u;WO!y1OO!z0}O!{0}O!|0|O#P1PO#Q1PO'|+zO~P!AQO_$pO!_#UO!f$mO!l1UO#T1SO'e$pO'n$bO'}'SO~O]&VOl&VO{+nO's)TO'|+zO~O_+}O!U1XO!Y,QO!Z+|O![+|O!u;WO!y,UO!z,SO!{,TO!|,RO#P,VO#Q,VO'|+zO~P!AQO!Z0zO![0zO'|+zO~P!AQO!Y0{O!Z0zO![0zO'|+zO~P!AQO!VTO!Y0{O!Z0zO![0zO!|0|O#P1PO#Q1PO'|+zO~P!AQO!Y0{O!Z0zO![0zO!z0}O!{0}O!|0|O#P1PO#Q1PO'|+zO~P!AQO!V&cO~O!V&cO~P!G[O!T#pOo$ga~O!Q&ui!T&ui~P!-RO!T&rO!Q'vi~O!T&yO!Q(Ri~O!Q(Si!T(Si~P!-RO!T'WO!e(Oi~O!T(Pi!e(Pi_(Pi'e(Pi~P!-RO#T1eO!T(Pi!e(Pi_(Pi'e(Pi~O{%WO!V%XO!uXO#^1hO#_1gO'j$tO~O{%WO!V%XO#_1gO'j$tO~OP1pO!V&cO!q1oO%]1nO~OP1pO!V&cO!q1oO%]1nO'n$bO~O#`uaQuaZua_uakua!cua!dua!fua!lua#cua#dua#eua#fua#gua#hua#iua#jua#kua#mua#oua#qua#rua'eua'rua'}ua!eua!Qua'aua!Vuaoua%]ua!_ua~P#>mO#`$haQ$haZ$ha_$hak$hay$ha!c$ha!d$ha!f$ha!l$ha#c$ha#d$ha#e$ha#f$ha#g$ha#h$ha#i$ha#j$ha#k$ha#m$ha#o$ha#q$ha#r$ha'e$ha'r$ha'}$ha!e$ha!Q$ha'a$ha!V$hao$ha%]$ha!_$ha~P#?cO#`$jaQ$jaZ$ja_$jak$jay$ja!c$ja!d$ja!f$ja!l$ja#c$ja#d$ja#e$ja#f$ja#g$ja#h$ja#i$ja#j$ja#k$ja#m$ja#o$ja#q$ja#r$ja'e$ja'r$ja'}$ja!e$ja!Q$ja'a$ja!V$jao$ja%]$ja!_$ja~P#@UO#`$xaQ$xaZ$xa_$xak$xay$xa!T$xa!c$xa!d$xa!f$xa!l$xa#c$xa#d$xa#e$xa#f$xa#g$xa#h$xa#i$xa#j$xa#k$xa#m$xa#o$xa#q$xa#r$xa'e$xa'r$xa'}$xa!e$xa!Q$xa'a$xa!V$xa#T$xao$xa%]$xa!_$xa~P!G[O_#Wq!T#Wq'e#Wq'a#Wq!Q#Wq!e#Wqo#Wq!V#Wq%]#Wq!_#Wq~P!-ROe&wX!T&wX~PKhO!T-UOe'ya~O!S1xO!T&xX!e&xX~P$}O!T-XO!e'za~O!T-XO!e'za~P!-RO!Q1{O~O#u!ha!U!ha~PBtO#u!`a!T!`a!U!`a~P#0aO!V2^O$QbO$Z2_O~O!U2cO~Oo2dO~P!G[O_$dq!T$dq'e$dq'a$dq!Q$dq!e$dqo$dq!V$dq%]$dq!_$dq~P!-RO!Q2eO~O]-rOl-rO~Ox(mO{(nO(V(rOP%Ti(U%Ti!T%Ti#T%Ti~Oe%Ti#u%Ti~P$9POx(mO{(nOP%Vi(U%Vi(V%Vi!T%Vi#T%Vi~Oe%Vi#u%Vi~P$9rO'}#jO~P!G[O!S2hO'j$tO!T'RX!e'RX~O!T-zO!e([a~O!T-zO!_#UO!e([a~O!T-zO!_#UO'}'SO!e([a~Oe$qi!T$qi#T$qi#u$qi~P!&VO!S2pO'j)OO!Q'TX!T'TX~P!&tO!T.SO!Q(]a~O!T.SO!Q(]a~P!G[O!_#UO~O!_#UO#k2xO~Ok2{O!_#UO'}'SO~Oe'pi!T'pi~P!&VO#T3OOe'pi!T'pi~P!&VO!e3RO~O_$eq!T$eq'e$eq'a$eq!Q$eq!e$eqo$eq!V$eq%]$eq!_$eq~P!-RO!T3VO!V(^X~P!G[O!V&cO%]1nO~O!V&cO%]1nO~P!G[O!V$oX%Q[X_$oX!T$oX'e$oX~P!$|O%Q3XOPhXxhX{hX!VhX(UhX(VhX_hX!ThX'ehX~O%Q3XO~O]3_O%^3`O'j*RO!T'^X!U'^X~O!T/SO!U(da~OZ3dO~O^3eO~O]3hO~O!Q3iO~O_$pO'e$pO~P!G[O!V$]O~P!G[O!T3nO#T3pO!U(aX~O!U3qO~O]&VOl&VO{3sO!Y4OO!Z3wO![3wO!u;WO!y3}O!z3|O!{3|O#P3{O#Q,VO'k$vO's)TO'|+zO~O!U3zO~P$BTOP4VO!V/oO!q4UO%]4TO~OP4VO!V/oO!q4UO%]4TO'n$bO~O'j!|O!T']X!U']X~O!T/{O!U(ba~O]4aO's4`O~O]4bO~O^4dO~O!e4gO~P$}O_4iO~O_4iO~P$}O#k4kO%}4lO~PExO`0cO!U4pO&]0bO~P`O!_4rO~O!_4tO!T'xi!U'xi!_'xi!f'xi'n'xi~O!T#]i!U#]i~P#0aO#T4uO!T#]i!U#]i~O!T!Xi!U!Xi~P#0aO!Q4vO~O]!tal!ta!Y!ta!Z!ta![!ta!y!ta!z!ta!{!ta!|!ta#P!ta#Q!ta'k!ta's!ta'|!ta~PGQO_$pO!_#UO!f$mO!l5OO#T4|O'e$pO'n$bO'}'SO~O!Z5QO![5QO'|+zO~P!AQO!Y5RO!Z5QO![5QO'|+zO~P!AQO!Y5RO!Z5QO![5QO!|5TO#P5UO#Q5UO'|+zO~P!AQO!Y5RO!Z5QO![5QO!z5VO!{5VO!|5TO#P5UO#Q5UO'|+zO~P!AQO_$pO#T4|O'e$pO~O_$pO!_#UO#T4|O'e$pO~O_$pO!_#UO!l5OO#T4|O'e$pO'}'SO~O!T'WO!e(Oq~O!T(Pq!e(Pq_(Pq'e(Pq~P!-RO{%WO!V%XO#_5aO'j$tO~O!V&cO%]5cO~O!V&cO%]5cO~P!G[OP5hO!V&cO!q5gO%]5cO~O#`%TiQ%TiZ%Ti_%Tik%Tiy%Ti!c%Ti!d%Ti!f%Ti!l%Ti#c%Ti#d%Ti#e%Ti#f%Ti#g%Ti#h%Ti#i%Ti#j%Ti#k%Ti#m%Ti#o%Ti#q%Ti#r%Ti'e%Ti'r%Ti'}%Ti!e%Ti!Q%Ti'a%Ti!V%Tio%Ti%]%Ti!_%Ti~P$9PO#`%ViQ%ViZ%Vi_%Vik%Viy%Vi!c%Vi!d%Vi!f%Vi!l%Vi#c%Vi#d%Vi#e%Vi#f%Vi#g%Vi#h%Vi#i%Vi#j%Vi#k%Vi#m%Vi#o%Vi#q%Vi#r%Vi'e%Vi'r%Vi'}%Vi!e%Vi!Q%Vi'a%Vi!V%Vio%Vi%]%Vi!_%Vi~P$9rO#`$qiQ$qiZ$qi_$qik$qiy$qi!T$qi!c$qi!d$qi!f$qi!l$qi#c$qi#d$qi#e$qi#f$qi#g$qi#h$qi#i$qi#j$qi#k$qi#m$qi#o$qi#q$qi#r$qi'e$qi'r$qi'}$qi!e$qi!Q$qi'a$qi!V$qi#T$qio$qi%]$qi!_$qi~P!G[Oe&wa!T&wa~P!&VO!T&xa!e&xa~P!-RO!T-XO!e'zi~O#u#Wi!T#Wi!U#Wi~P#0aOQ#lOx#YOy#ZO{#[O!d#WO!f#XO!l#lO'rROZ#bik#bi!c#bi#d#bi#e#bi#f#bi#g#bi#h#bi#i#bi#j#bi#k#bi#m#bi#o#bi#q#bi#r#bi#u#bi'}#bi(U#bi(V#bi!T#bi!U#bi~O#c#bi~P%&nO#c;_O~P%&nOQ#lOx#YOy#ZO{#[O!d#WO!f#XO!l#lO#c;_O#d;`O#e;`O#f;`O'rROZ#bi!c#bi#g#bi#h#bi#i#bi#j#bi#k#bi#m#bi#o#bi#q#bi#r#bi#u#bi'}#bi(U#bi(V#bi!T#bi!U#bi~Ok#bi~P%(yOk;aO~P%(yOQ#lOk;aOx#YOy#ZO{#[O!d#WO!f#XO!l#lO#c;_O#d;`O#e;`O#f;`O#g;bO'rRO#m#bi#o#bi#q#bi#r#bi#u#bi'}#bi(U#bi(V#bi!T#bi!U#bi~OZ#bi!c#bi#h#bi#i#bi#j#bi#k#bi~P%+UOZ;mO!c;cO#h;cO#i;cO#j;lO#k;cO~P%+UOQ#lOZ;mOk;aOx#YOy#ZO{#[O!c;cO!d#WO!f#XO!l#lO#c;_O#d;`O#e;`O#f;`O#g;bO#h;cO#i;cO#j;lO#k;cO#m;dO'rRO#o#bi#q#bi#r#bi#u#bi'}#bi(V#bi!T#bi!U#bi~O(U#bi~P%-pO(U#]O~P%-pOQ#lOZ;mOk;aOx#YOy#ZO{#[O!c;cO!d#WO!f#XO!l#lO#c;_O#d;`O#e;`O#f;`O#g;bO#h;cO#i;cO#j;lO#k;cO#m;dO#o;fO'rRO(U#]O#q#bi#r#bi#u#bi'}#bi!T#bi!U#bi~O(V#bi~P%/{O(V#^O~P%/{OQ#lOZ;mOk;aOx#YOy#ZO{#[O!c;cO!d#WO!f#XO!l#lO#c;_O#d;`O#e;`O#f;`O#g;bO#h;cO#i;cO#j;lO#k;cO#m;dO#o;fO#q;hO'rRO(U#]O(V#^O~O#r#bi#u#bi'}#bi!T#bi!U#bi~P%2WO_#sy!T#sy'e#sy'a#sy!Q#sy!e#syo#sy!V#sy%]#sy!_#sy~P!-ROP=oOx(mO{(nO(U(pO(V(rO~OQ#biZ#bik#biy#bi!c#bi!d#bi!f#bi!l#bi#c#bi#d#bi#e#bi#f#bi#g#bi#h#bi#i#bi#j#bi#k#bi#m#bi#o#bi#q#bi#r#bi#u#bi'r#bi'}#bi!T#bi!U#bi~P%5OO#u'qX!U'qX~P!HZO#u#vi!T#vi!U#vi~P#0aO!U5tO~O!T'Qa!U'Qa~P#0aO!_#UO'}'SO!T'Ra!e'Ra~O!T-zO!e([i~O!T-zO!_#UO!e([i~Oe$qq!T$qq#T$qq#u$qq~P!&VO!Q'Ta!T'Ta~P!G[O!_5{O~O!T.SO!Q(]i~P!G[O!T.SO!Q(]i~O!Q6PO~O!_#UO#k6UO~Ok6VO!_#UO'}'SO~O!Q6XO~Oe$sq!T$sq#T$sq#u$sq~P!&VO_$ey!T$ey'e$ey'a$ey!Q$ey!e$eyo$ey!V$ey%]$ey!_$ey~P!-RO!T3VO!V(^a~O_#Wy!T#Wy'e#Wy'a#Wy!Q#Wy!e#Wyo#Wy!V#Wy%]#Wy!_#Wy~P!-ROZ6^O~O]6`O'j*RO~O!T/SO!U(di~O]6cO~O^6dO~O!_4tO~O's'lO!T'YX!U'YX~O!T3nO!U(aa~O!f$mO'n$bO_'xX!_'xX!l'xX#T'xX'e'xX'}'xX~O'j6mO~P,RO!u;WO!y6oO!z6nO!{6nO#P1PO#Q1PO~P$%_O_$pO!_#UO!l1UO#T1SO'e$pO'}'SO~O!U6rO~P$BTO]&VOl&VO{6sO's)TO'|+zO~O!Y6wO!Z6vO![6vO#P1PO#Q1PO'|+zO~P!AQO!Y6wO!Z6vO![6vO!z6xO!{6xO#P1PO#Q1PO'|+zO~P!AQO!Z6vO![6vO'k$vO's)TO'|+zO~O!V/oO~O!V/oO%]6zO~O!V/oO%]6zO~P!G[OP7PO!V/oO!q7OO%]6zO~OZ7UO!T']a!U']a~O!T/{O!U(bi~O]7XO~O!e7YO~O!e7ZO~O!e7[O~O!e7[O~P$}O_7^O~O!_7aO~O!e7bO~O!T(Si!U(Si~P#0aO_$pO#T7iO'e$pO~O_$pO!_#UO#T7iO'e$pO~O!Z7mO![7mO'|+zO~P!AQO_$pO!_#UO!f$mO!l7nO#T7iO'e$pO'n$bO'}'SO~O!Y7oO!Z7mO![7mO'|+zO~P!AQO!Y7oO!Z7mO![7mO!|7rO#P7sO#Q7sO'|+zO~P!AQO_$pO!_#UO!l7nO#T7iO'e$pO'}'SO~O_$pO'e$pO~P!-RO!T'WO!e(Oy~O!T(Py!e(Py_(Py'e(Py~P!-RO!V&cO%]7xO~O!V&cO%]7xO~P!G[O#`$qqQ$qqZ$qq_$qqk$qqy$qq!T$qq!c$qq!d$qq!f$qq!l$qq#c$qq#d$qq#e$qq#f$qq#g$qq#h$qq#i$qq#j$qq#k$qq#m$qq#o$qq#q$qq#r$qq'e$qq'r$qq'}$qq!e$qq!Q$qq'a$qq!V$qq#T$qqo$qq%]$qq!_$qq~P!G[O#`$sqQ$sqZ$sq_$sqk$sqy$sq!T$sq!c$sq!d$sq!f$sq!l$sq#c$sq#d$sq#e$sq#f$sq#g$sq#h$sq#i$sq#j$sq#k$sq#m$sq#o$sq#q$sq#r$sq'e$sq'r$sq'}$sq!e$sq!Q$sq'a$sq!V$sq#T$sqo$sq%]$sq!_$sq~P!G[O!T&xi!e&xi~P!-RO#u#Wq!T#Wq!U#Wq~P#0aOx.nOy.nO{.oOPua(Uua(Vua!Uua~OQuaZuakua!cua!dua!fua!lua#cua#dua#eua#fua#gua#hua#iua#jua#kua#mua#oua#qua#rua#uua'rua'}ua!Tua~P%LmOx(mO{(nOP$ha(U$ha(V$ha!U$ha~OQ$haZ$hak$hay$ha!c$ha!d$ha!f$ha!l$ha#c$ha#d$ha#e$ha#f$ha#g$ha#h$ha#i$ha#j$ha#k$ha#m$ha#o$ha#q$ha#r$ha#u$ha'r$ha'}$ha!T$ha~P%NtOx(mO{(nOP$ja(U$ja(V$ja!U$ja~OQ$jaZ$jak$jay$ja!c$ja!d$ja!f$ja!l$ja#c$ja#d$ja#e$ja#f$ja#g$ja#h$ja#i$ja#j$ja#k$ja#m$ja#o$ja#q$ja#r$ja#u$ja'r$ja'}$ja!T$ja~P&!{OQ$xaZ$xak$xay$xa!c$xa!d$xa!f$xa!l$xa#c$xa#d$xa#e$xa#f$xa#g$xa#h$xa#i$xa#j$xa#k$xa#m$xa#o$xa#q$xa#r$xa#u$xa'r$xa'}$xa!T$xa!U$xa~P%5OO#u$dq!T$dq!U$dq~P#0aO#u$eq!T$eq!U$eq~P#0aO!U8RO~O#u8SO~P!&VO!_#UO!T'Ri!e'Ri~O!_#UO'}'SO!T'Ri!e'Ri~O!T-zO!e([q~O!Q'Ti!T'Ti~P!G[O!T.SO!Q(]q~O!Q8YO~P!G[O!Q8YO~Oe'py!T'py~P!&VO!T'Wa!V'Wa~P!G[O!V%Pq_%Pq!T%Pq'e%Pq~P!G[OZ8_O~O!T/SO!U(dq~O]8bO~O#T8cO!T'Ya!U'Ya~O!T3nO!U(ai~P#0aOQ[XZ[Xk[Xx[Xy[X{[X!Q[X!T[X!c[X!d[X!f[X!l[X#T[X#`dX#c[X#d[X#e[X#f[X#g[X#h[X#i[X#j[X#k[X#m[X#o[X#q[X#r[X#w[X'r[X'}[X(U[X(V[X~O!_$}X#k$}X~P&*pO#P5UO#Q5UO~P$%_O!z8gO!{8gO#P5UO#Q5UO~P$%_O!Z8jO![8jO'k$vO's)TO'|+zO~O!Y8mO!Z8jO![8jO#P5UO#Q5UO'|+zO~P!AQO!V/oO%]8pO~O!V/oO%]8pO~P!G[O]8wO's8vO~O!T/{O!U(bq~O!e8yO~O!e8yO~P$}O!e8{O~O!e8|O~O#T9OO!T#]y!U#]y~O!T#]y!U#]y~P#0aO_$pO#T9RO'e$pO~O_$pO!_#UO#T9RO'e$pO~O!Z9WO![9WO'|+zO~P!AQO_$pO!_#UO!l9XO#T9RO'e$pO'}'SO~O!f$mO'n$bO~P&0|O!Y9YO!Z9WO![9WO'|+zO~P!AQO!V&cO%]9^O~O!V&cO%]9^O~P!G[O#u#sy!T#sy!U#sy~P#0aOQ$qiZ$qik$qiy$qi!c$qi!d$qi!f$qi!l$qi#c$qi#d$qi#e$qi#f$qi#g$qi#h$qi#i$qi#j$qi#k$qi#m$qi#o$qi#q$qi#r$qi#u$qi'r$qi'}$qi!T$qi!U$qi~P%5OOx(mO{(nO(V(rOP%Ti(U%Ti!U%Ti~OQ%TiZ%Tik%Tiy%Ti!c%Ti!d%Ti!f%Ti!l%Ti#c%Ti#d%Ti#e%Ti#f%Ti#g%Ti#h%Ti#i%Ti#j%Ti#k%Ti#m%Ti#o%Ti#q%Ti#r%Ti#u%Ti'r%Ti'}%Ti!T%Ti~P&4cOx(mO{(nOP%Vi(U%Vi(V%Vi!U%Vi~OQ%ViZ%Vik%Viy%Vi!c%Vi!d%Vi!f%Vi!l%Vi#c%Vi#d%Vi#e%Vi#f%Vi#g%Vi#h%Vi#i%Vi#j%Vi#k%Vi#m%Vi#o%Vi#q%Vi#r%Vi#u%Vi'r%Vi'}%Vi!T%Vi~P&6jO#u$ey!T$ey!U$ey~P#0aO#u#Wy!T#Wy!U#Wy~P#0aO!_#UO!T'Rq!e'Rq~O!T-zO!e([y~O!Q'Tq!T'Tq~P!G[O!Q9dO~P!G[O!T/SO!U(dy~O!T3nO!U(aq~O#P7sO#Q7sO~P$%_O!Z9nO![9nO'k$vO's)TO'|+zO~O!V/oO%]9qO~O!V/oO%]9qO~P!G[O!e9tO~O_$pO#T9zO'e$pO~O_$pO!_#UO#T9zO'e$pO~O!Z9}O![9}O'|+zO~P!AQO_$pO!_#UO!l:OO#T9zO'e$pO'}'SO~OQ$qqZ$qqk$qqy$qq!c$qq!d$qq!f$qq!l$qq#c$qq#d$qq#e$qq#f$qq#g$qq#h$qq#i$qq#j$qq#k$qq#m$qq#o$qq#q$qq#r$qq#u$qq'r$qq'}$qq!T$qq!U$qq~P%5OOQ$sqZ$sqk$sqy$sq!c$sq!d$sq!f$sq!l$sq#c$sq#d$sq#e$sq#f$sq#g$sq#h$sq#i$sq#j$sq#k$sq#m$sq#o$sq#q$sq#r$sq#u$sq'r$sq'}$sq!T$sq!U$sq~P%5OOe%X!Z!T%X!Z#T%X!Z#u%X!Z~P!&VO!T'Yq!U'Yq~P#0aO!T#]!Z!U#]!Z~P#0aO_$pO#T:aO'e$pO~O_$pO!_#UO#T:aO'e$pO~O#`%X!ZQ%X!ZZ%X!Z_%X!Zk%X!Zy%X!Z!T%X!Z!c%X!Z!d%X!Z!f%X!Z!l%X!Z#c%X!Z#d%X!Z#e%X!Z#f%X!Z#g%X!Z#h%X!Z#i%X!Z#j%X!Z#k%X!Z#m%X!Z#o%X!Z#q%X!Z#r%X!Z'e%X!Z'r%X!Z'}%X!Z!e%X!Z!Q%X!Z'a%X!Z!V%X!Z#T%X!Zo%X!Z%]%X!Z!_%X!Z~P!G[O_$pO#T:oO'e$pO~OP=nOx(mO{(nO(U(pO(V(rO~O]#Sal#Sa!U#Sa!Y#Sa!Z#Sa![#Sa!u#Sa!y#Sa!z#Sa!{#Sa#P#Sa#Q#Sa'k#Sa's#Sa'|#Sa~P&D[OQ%X!ZZ%X!Zk%X!Zy%X!Z!c%X!Z!d%X!Z!f%X!Z!l%X!Z#c%X!Z#d%X!Z#e%X!Z#f%X!Z#g%X!Z#h%X!Z#i%X!Z#j%X!Z#k%X!Z#m%X!Z#o%X!Z#q%X!Z#r%X!Z#u%X!Z'r%X!Z'}%X!Z!T%X!Z!U%X!Z~P%5OO]ualua!Yua!Zua![ua!uua!yua!zua!{ua#Pua#Qua'kua'sua'|ua~P%LmO]$hal$ha!Y$ha!Z$ha![$ha!u$ha!y$ha!z$ha!{$ha#P$ha#Q$ha'k$ha's$ha'|$ha~P%NtO]$jal$ja!Y$ja!Z$ja![$ja!u$ja!y$ja!z$ja!{$ja#P$ja#Q$ja'k$ja's$ja'|$ja~P&!{O]$xal$xa!U$xa!Y$xa!Z$xa![$xa!u$xa!y$xa!z$xa!{$xa#P$xa#Q$xa'k$xa's$xa'|$xa~P&D[O]%Til%Ti!Y%Ti!Z%Ti![%Ti!u%Ti!y%Ti!z%Ti!{%Ti#P%Ti#Q%Ti'k%Ti's%Ti'|%Ti~P&4cO]%Vil%Vi!Y%Vi!Z%Vi![%Vi!u%Vi!y%Vi!z%Vi!{%Vi#P%Vi#Q%Vi'k%Vi's%Vi'|%Vi~P&6jO]$qil$qi!U$qi!Y$qi!Z$qi![$qi!u$qi!y$qi!z$qi!{$qi#P$qi#Q$qi'k$qi's$qi'|$qi~P&D[O]$qql$qq!U$qq!Y$qq!Z$qq![$qq!u$qq!y$qq!z$qq!{$qq#P$qq#Q$qq'k$qq's$qq'|$qq~P&D[O]$sql$sq!U$sq!Y$sq!Z$sq![$sq!u$sq!y$sq!z$sq!{$sq#P$sq#Q$sq'k$sq's$sq'|$sq~P&D[O]%X!Zl%X!Z!U%X!Z!Y%X!Z!Z%X!Z![%X!Z!u%X!Z!y%X!Z!z%X!Z!{%X!Z#P%X!Z#Q%X!Z'k%X!Z's%X!Z'|%X!Z~P&D[Oo'tX~P/WO!QdX!TdX#TdX~P&*pOQ[XZ[Xk[Xx[Xy[X{[X!T[X!TdX!c[X!d[X!f[X!l[X#T[X#TdX#`dX#c[X#d[X#e[X#f[X#g[X#h[X#i[X#j[X#k[X#m[X#o[X#q[X#r[X#w[X'r[X'}[X(U[X(V[X~O!_dX!e[X!edX'}dX~P'$ZOQ;VOR;VO]gOb=ZOc!`OigOk;VOlgOmgOrgOt;VOv;VO{SO!OgO!PgO!VTO!a;YO!fVO!i;VO!j;VO!k;VO!l;VO!m;VO!p!_O#|!bO$QbO'j'|O'rRO'|WO(Z=XO~O]$SOi$cOk$TOl$SOm$SOr$dOt$eOv;pO{$[O!V$]O!a=aO!f$XO#_;yO#|$iO$i;sO$k;vO$n$jO'j'dO'n$bO'r$UO~O!T;jO!U$ga~O]$SOi$cOk$TOl$SOm$SOr$dOt$eOv;qO{$[O!V$]O!a=bO!f$XO#_;zO#|$iO$i;tO$k;wO$n$jO'j'dO'n$bO'r$UO~O#l(TO~P'*^O!U[X!UdX~P'$ZO!_;^O~O#`;]O~O!_#UO#`;]O~O#T;nO~O#k;cO~O#T;{O!T(SX!U(SX~O#T;nO!T(QX!U(QX~O#`;|O~Oe<OO~P!&VO#`<VO~O#`<WO~O#`<XO~O!_#UO#`<YO~O!_#UO#`;|O~O#u<ZO~P#0aO#`<[O~O#`<]O~O#`<^O~O#`<_O~O#`<`O~O#`<aO~O#`<bO~O#`<cO~O!Q<dO~O#u<eO~P!&VO#u<fO~P!&VO#u<gO~P!&VO!Q<hO~P!G[O!Q<hO~O!Q<iO~P!G[O!_#UO#k=gO~O!_#UO#k=iO~O$Q~!d!y!{!|#P#^#_#j(Z$i$k$n%Q%[%]%^%d%f%i%j%l%n~UT$Q(Z#d!P'g'k#el#c#fkx'h's'h'j$S$U$S~",goto:"$(n(hPPPPPPPP(iP(yP*tPPPP.mPP/SP4y9R9fP9fPPP9fP;l9fP9fP9fP;pPP;vP<a@}PPPARPPPPARC|PPPDSE|PARPHdPPPPJbARPPPPPLlARPP! z!#O!#SP!#s!#w!#sPPPP!&|!(wPP!)P!*VP!#OARAR!-m!0q!5r!5r!9cPPP!9jARPPPPPPPPPPP!<iP!=|PPAR!?]PARPARARARARPAR!@tPP!CvP!FtP!Fx!GQ!GU!GUP!CsP!GY!GYP!JWP!J[ARAR!Jb!M_9fP9fP9f9fP!Ni9f9f#!y9f#%v9f#(Q9f9f#(n#+Q#+Q#+U#+^#+Q#+jP#+QP9f#,f9f#.T9f9f.mPPP#/vPP#0`#0`P#0`P#0u#0`PP#0{P#0rP#0r#1_!({#0r#1|#2S#2V(i#2Y(iP#2a#2a#2aP(iP(iP(iP(iPP(iP#2g#2jP#2j(iP#2nP#2qP(iP(iP(iP(iP(iP(i(iP#2w#3R#3X#3_#3m#3s#3y#4T#4Z#5U#5e#5k#5}#6T#6Z#6i#7O#8w#9V#9]#9c#9i#9o#9y#:P#:V#:a#:s#:yPPPPPPPP#;PPP#;s#?TP#@o#@v#AOPP#Fp#If$ o$ r$ u$#h$#k$#nPP$#t$#x$$q$%q$%u$&ZPP$&_$&e$&iP$&l$&p$&s$'f$'|$(R$(U$(X$(_$(b$(f$(jmlOTn!R!s$o%t%v%w%y+X+^0]0`Q${qQ%StQ%l}S&Z!]+rQ&j!`S)V$])[Q*P$|Q*^%UQ*x%fQ+x&bS+|&c,OQ,`&kQ.e)^Q/z*y[0z+y,Q,R,S,T,US3w/o3yW5Q0{0|0}1OU6v3|3}4OU7m5R5T5VS8j6w6xS9W7o7rQ9n8mR9}9Y%Q`OPSTUVno!R!W!c!g!j!s!}#T#X#[#_#`#a#b#c#d#e#f#g#h#i#p#t$o%Q%m%p%t%v%w%y%}&W&e&p&r&x'T'f'j'n(l)o)v*c+T+X+^+n,Z,e,n,z-X-`.o.t/R/r0T0U0V0X0]0`0b1S1e1o1x3s4U4i4k4l4|5g6s7O7^7i9R9z:a:oS#PX;W!l(O#k#|&[(b+j+m-f0r2^3p4u8c9O;V;Y;];_;`;a;b;c;d;e;f;g;h;i;j;n;{;|<O<Y<Z<b<c=[Q)g$fQ*U%OQ*z%iQ+R%qQ-O;oQ.|)yQ/X*VQ0S+PQ3_/SQ4^/{Q5m;qQ6`3`R:q;ppiOTn}!R!s$o%k%t%v%w%y+X+^0]0`R*|%m&j[OPTUnor!R!W!a!c!s!}#T#X#[#_#`#a#b#c#d#e#f#g#h#i#k#p#t#|$o%Q%m%p%q%t%v%w%y%}&W&e&r&x'T'f'j'n(b(l)o)v*c+T+X+^+j+m+n,Z,e,n,z-X-`-f.o.t/R/r0T0U0V0X0]0`0b0r1S1e1o1x2^3p3s4U4i4k4l4u4|5g6s7O7^7i8c9O9R9z:a:o;V;Y;];_;`;a;b;c;d;e;f;g;h;i;j;n;{;|<O<Y<Z<b<c=Z=[[!lSV!g!j&[&pQ$upQ$zqS%Pt%U!U%Yvw!v!x!{$m%W&y'Q'R'W*a*b*d+V+k,i,l,p,q,s0e1g1h4t5aQ%b{Q&g!_Q&i!`Q'_#RS(x$X(|S*O${$|Q*S%OQ*s%dQ*w%fS,_&j&kQ,}'`Q.O(yQ/Q*PQ/W*VQ/Y*WQ/]*[Q/u*tS/y*x*yQ1a,`Q2g-zQ3^/SQ3b/VQ3g/_Q4]/zQ5x2hQ6_3`Q6b3dQ8^6^R9f8_x$Ze#W$g$h$l(q(s({)b)c-U.R.q2f3O8S=X=d=e=f!^$xq!`$z${$|&Y&i&j&k)U*O*P+o+{,_,`.]/Q0w0y1V1a2z5P5S7l7q9U9{:bQ)x$uQ*i%_Q*l%`Q*v%fQ,|'_Q/t*sU/x*w*x*yQ1q,}Q4W/uS4[/y/zS6l3r3vQ7T4]U8h6p6t6uU9l8i8k8lQ:W9mQ:i:X#b=]#U#r#s$X$[&f(h(t)R)u)w)y*h*k,[,y,{.S.U/f/i/q/s1n1p2p2x3V3X4T4V5c5h5{6U6z7P7x8p9^9q;r;u;x<P<S<V<[<_<e=g=i=m=n=od=^;^;s;v;y<Q<T<W<]<`<fg=_;l;m;t;w;z<R<U<X<^<a<gW$`e$b)d=XS%_x%kQ%`yQ%azR*g%]%X$_e#U#W#r#s$X$[$g$h$l&f(h(q(s(t({)R)b)c)u)w)y*h*k,[,y,{-U.R.S.U.q/f/i/q/s1n1p2f2p2x3O3V3X4T4V5c5h5{6U6z7P7x8S8p9^9q;^;l;m;r;s;t;u;v;w;x;y;z<P<Q<R<S<T<U<V<W<X<[<]<^<_<`<a<e<f<g=X=d=e=f=g=i=m=n=oT(i$U(jX)h$f;o;p;qU&_!]%X+uS'm#Y#ZQ*Z%RS,u'Z'[Q/j*mQ3P.nR6h3n&pgOPSTUVno!R!W!c!g!j!s!}#T#X#[#_#`#a#b#c#d#e#f#g#h#i#k#p#t#|$o%Q%m%p%q%t%v%w%y%}&W&[&e&p&r&x'T'f'j'n(b(l)o)v*c+T+X+^+j+m+n,Z,e,n,z-X-`-f.o.t/R/r0T0U0V0X0]0`0b0r1S1e1o1x2^3p3s4U4i4k4l4u4|5g6s7O7^7i8c9O9R9z:a:o;V;Y;];_;`;a;b;c;d;e;f;g;h;i;j;n;{;|<O<Y<Z<b<c=[$a#o_!i!t$s&o&u'b'i'q'r's't'u'v'w'x'y'z'{'}(Q(U(`*Y+p,c,h,m-T-Z-_-a-p.r0l0o1d1w1|1}2O2P2Q2R2S2T2U2V2W2X2Y2]2b3T3[4x5Y5_5k5l5q5r6j7d7g7{8P8Q9Q9h9u9w:_:m:z;X<wT!dR!e&qgOPSTUVno!R!W!c!g!j!s!}#T#X#[#_#`#a#b#c#d#e#f#g#h#i#k#p#t#|$o%Q%m%p%q%t%v%w%y%}&W&[&e&p&r&x'T'f'j'n(b(l)o)v*c+T+X+^+j+m+n,Z,e,n,z-X-`-f.o.t/R/r0T0U0V0X0]0`0b0r1S1e1o1x2^3p3s4U4i4k4l4u4|5g6s7O7^7i8c9O9R9z:a:o;V;Y;];_;`;a;b;c;d;e;f;g;h;i;j;n;{;|<O<Y<Z<b<c=[Q&]!]R0s+r!n&V!]&Z&b&c+r+x+y+|,O,Q,R,S,T,U,V0z0{0|0}1O1P3t3{5Q5R5T5U5V6n6o7m7o7r7s8g9W9Y9}S)U$])[S.])V)^Q.f)_Q/l*oQ2z.eQ2}.hS3r/o3yS6p3w4OS6t3|3}S8i6v6wQ8k6xS9m8j8mR:X9nllOTn!R!s$o%t%v%w%y+X+^0]0`Q%{!US'a#T;]Q)|$yQ*q%bQ*r%cQ,]&hS-S'f;|S.s)o<YQ/O)}Q/n*pQ0d+`Q0f+aQ0n+lQ1Y,SQ1_,^S3U.t<bQ3Y/PS3]/R<cQ4w0qQ5X1QQ5[1`Q6]3ZQ7e4yQ7f4zQ7t5]Q8}7bQ9S7kQ9x9TQ:^9yQ:l:`R:y:n$[#n_!i!t&o&u'b'i'q'r's't'u'v'w'x'y'z'{'}(Q(U(`*Y+p,c,h,m-T-Z-_-p.r0l0o1d1w1|1}2O2P2Q2R2S2T2U2V2W2X2Y2]2b3T3[4x5Y5_5k5l5q5r6j7d7g7{8P8Q9Q9h9u9w:_:m:z;X<wS'^#O0xU)a$^'e2[T)s$s-a$[#m_!i!t&o&u'b'i'q'r's't'u'v'w'x'y'z'{'}(Q(U(`*Y+p,c,h,m-T-Z-_-p.r0l0o1d1w1|1}2O2P2Q2R2S2T2U2V2W2X2Y2]2b3T3[4x5Y5_5k5l5q5r6j7d7g7{8P8Q9Q9h9u9w:_:m:z;X<wS']#O0xS'o#Z#nS)r$s-aS,v'['^Q-b(PQ.u)sR1i,w&pgOPSTUVno!R!W!c!g!j!s!}#T#X#[#_#`#a#b#c#d#e#f#g#h#i#k#p#t#|$o%Q%m%p%q%t%v%w%y%}&W&[&e&p&r&x'T'f'j'n(b(l)o)v*c+T+X+^+j+m+n,Z,e,n,z-X-`-f.o.t/R/r0T0U0V0X0]0`0b0r1S1e1o1x2^3p3s4U4i4k4l4u4|5g6s7O7^7i8c9O9R9z:a:o;V;Y;];_;`;a;b;c;d;e;f;g;h;i;j;n;{;|<O<Y<Z<b<c=[S#PX;WQ%v!PQ%w!QQ%y!SQ%z!TR0[+[Q&d!_Q)t$uQ,Y&gS,x'_)xS1[,W,XY1m,|,}.w.x.yS5Z1]1^W5b1j1k1l1qU7w5d5e5fU9[7v7y7zQ:P9]R:d:QT+}&c,O!]YOTVZn}!R!s!v$m$o%k%m%t%v%w%y&c'W+X+^+y,O,p/o0]0`3t3yT#PX;W%SsOPSTUVno!R!W!c!g!j!s!}#T#X#[#_#`#a#b#c#d#e#f#g#h#i#p#t$o%Q%m%p%q%t%v%w%y%}&W&e&p&r&x'T'f'j'n(l)o)v*c+T+X+^+n,Z,e,n,z-X-`.o.t/R/r0T0U0V0X0]0`0b1S1e1o1x3s4U4i4k4l4|5g6s7O7^7i9R9z:a:oS'm#Y#ZS,u'Z'[!m<m#k#|&[(b+j+m-f0r2^3p4u8c9O;V;Y;];_;`;a;b;c;d;e;f;g;h;i;j;n;{;|<O<Y<Z<b<c=[S+{&c,OW0y+y,S,T,UU1V+|,Q,RU1Z,V3t3{S3v/o3yU5P0z0{0|S5S0}1OU5W1P6n6oS6p3w4OS6u3|3}U7l5Q5R5TS7p5U8gQ7q5VS8i6v6wQ8l6xU9U7m7o7rQ9Z7sS9m8j8mS9{9W9YQ:X9nR:b9}S+}&c,OT3x/o3yS'V!w0YQ-}(xQ.Z)UU1U+{3u3vQ2l.OS2u.[.fU5O0y1Z6uQ5w2gS6S2{2}U7n5S5W8lQ8U5xQ8]6VS9X7p7qR:O9ZQ#V^S'U!w0YQ)p$nQ)z$wQ*Q$}Q,o'VQ-|(xQ.Y)UQ.`)XQ.}){Q/v*uU1T+{3u3vS2k-}.OS2t.Z.fQ2w._Q2y.aQ4Y/wW4}0y1U1Z6uQ5v2gQ5z2lS6O2u2}Q6T2|Q7R4ZW7j5O5S5W8lS8T5w5xS8X6P<dQ8Z6SQ8e6kQ8t7SU9V7n7p7qQ9b8US9c8Y<hQ9e8]Q9j8fQ9s8uS9|9X9ZS:S9d<iQ:U9kQ:c:OQ:g:VQ:v:hQ;P:wQ<p<kQ=O<uQ=P<vQ=Q=cR=V=h%S]OPSTUVno!R!W!c!g!j!s!}#T#X#[#_#`#a#b#c#d#e#f#g#h#i#p#t$o%Q%m%p%q%t%v%w%y%}&W&e&p&r&x'T'f'j'n(l)o)v*c+T+X+^+n,Z,e,n,z-X-`.o.t/R/r0T0U0V0X0]0`0b1S1e1o1x3s4U4i4k4l4|5g6s7O7^7i9R9z:a:oS#Vr!a!l<j#k#|&[(b+j+m-f0r2^3p4u8c9O;V;Y;];_;`;a;b;c;d;e;f;g;h;i;j;n;{;|<O<Y<Z<b<c=[R<p=Z%S^OPSTUVno!R!W!c!g!j!s!}#T#X#[#_#`#a#b#c#d#e#f#g#h#i#p#t$o%Q%m%p%q%t%v%w%y%}&W&e&p&r&x'T'f'j'n(l)o)v*c+T+X+^+n,Z,e,n,z-X-`.o.t/R/r0T0U0V0X0]0`0b1S1e1o1x3s4U4i4k4l4|5g6s7O7^7i9R9z:a:oQ$nf!^$wq!`$z${$|&Y&i&j&k)U*O*P+o+{,_,`.]/Q0w0y1V1a2z5P5S7l7q9U9{:bS$}r!aQ){$xQ*u%fW/w*v*w*x*yU4Z/x/y/zS6k3r3vS7S4[4]W8f6l6p6t6uQ8u7TW9k8h8i8k8lS:V9l9mS:h:W:XQ:w:i!l<k#k#|&[(b+j+m-f0r2^3p4u8c9O;V;Y;];_;`;a;b;c;d;e;f;g;h;i;j;n;{;|<O<Y<Z<b<c=[Q<u=YR<v=Z$vaOPTUno!R!W!c!s!}#T#X#[#_#`#a#b#c#d#e#f#g#h#i#p#t$o%Q%m%p%t%v%w%y%}&W&e&r&x'T'f'j'n(l)o)v*c+T+X+^+n,Z,e,n,z-X-`.o.t/R/r0T0U0V0X0]0`0b1S1e1o1x3s4U4i4k4l4|5g6s7O7^7i9R9z:a:oY!qSV!g!j&p!U%Yvw!v!x!{$m%W&y'Q'R'W*a*b*d+V+k,i,l,p,q,s0e1g1h4t5aQ+S%q!j<l#k#|(b+j+m-f0r2^3p4u8c9O;V;Y;];_;`;a;b;c;d;e;f;g;h;i;j;n;{;|<O<Y<Z<b<c=[R<o&[S&`!]%XR0u+u%Q`OPSTUVno!R!W!c!g!j!s!}#T#X#[#_#`#a#b#c#d#e#f#g#h#i#p#t$o%Q%m%p%t%v%w%y%}&W&e&p&r&x'T'f'j'n(l)o)v*c+T+X+^+n,Z,e,n,z-X-`.o.t/R/r0T0U0V0X0]0`0b1S1e1o1x3s4U4i4k4l4|5g6s7O7^7i9R9z:a:o!l(O#k#|&[(b+j+m-f0r2^3p4u8c9O;V;Y;];_;`;a;b;c;d;e;f;g;h;i;j;n;{;|<O<Y<Z<b<c=[R+R%q!j#e_!i$s&o&u'b'i'x'y'z'{(Q(U*Y,c,h,m-T-Z-p.r1d1w2Y3T3[5Y5_5k7g9Q9w:_:m:z;X!T;e'}(`+p-a0l0o1|2U2V2W2X2]2b4x5l5q5r6j7d7{8P8Q9h9u<w!f#g_!i$s&o&u'b'i'z'{(Q(U*Y,c,h,m-T-Z-p.r1d1w2Y3T3[5Y5_5k7g9Q9w:_:m:z;X!P;g'}(`+p-a0l0o1|2W2X2]2b4x5l5q5r6j7d7{8P8Q9h9u<w!b#k_!i$s&o&u'b'i(Q(U*Y,c,h,m-T-Z-p.r1d1w2Y3T3[5Y5_5k7g9Q9w:_:m:z;XQ2f-xz=['}(`+p-a0l0o1|2]2b4x5l5q5r6j7d7{8P8Q9h9u<wQ=d=jQ=e=kR=f=l&pgOPSTUVno!R!W!c!g!j!s!}#T#X#[#_#`#a#b#c#d#e#f#g#h#i#k#p#t#|$o%Q%m%p%q%t%v%w%y%}&W&[&e&p&r&x'T'f'j'n(b(l)o)v*c+T+X+^+j+m+n,Z,e,n,z-X-`-f.o.t/R/r0T0U0V0X0]0`0b0r1S1e1o1x2^3p3s4U4i4k4l4u4|5g6s7O7^7i8c9O9R9z:a:o;V;Y;];_;`;a;b;c;d;e;f;g;h;i;j;n;{;|<O<Y<Z<b<c=[S#}d$OR2_-e&wcOPSTUVdno!R!W!c!g!j!s!}#T#X#[#_#`#a#b#c#d#e#f#g#h#i#k#p#t#|$O$o%Q%m%p%q%t%v%w%y%}&W&[&e&p&r&x'T'f'j'n(b(l)o)v*c+T+X+^+j+m+n,Z,e,n,z-X-`-e-f.o.t/R/r0T0U0V0X0]0`0b0r1S1e1o1x2^3p3s4U4i4k4l4u4|5g6s7O7^7i8c9O9R9z:a:o;V;Y;];_;`;a;b;c;d;e;f;g;h;i;j;n;{;|<O<Y<Z<b<c=[T#yb$PS#wb$PT(X#z(]T#xb$PT(Z#z(]&wdOPSTUVdno!R!W!c!g!j!s!}#T#X#[#_#`#a#b#c#d#e#f#g#h#i#k#p#t#|$O$o%Q%m%p%q%t%v%w%y%}&W&[&e&p&r&x'T'f'j'n(b(l)o)v*c+T+X+^+j+m+n,Z,e,n,z-X-`-e-f.o.t/R/r0T0U0V0X0]0`0b0r1S1e1o1x2^3p3s4U4i4k4l4u4|5g6s7O7^7i8c9O9R9z:a:o;V;Y;];_;`;a;b;c;d;e;f;g;h;i;j;n;{;|<O<Y<Z<b<c=[T#}d$OQ$QdR(d$O%SfOPSTUVno!R!W!c!g!j!s!}#T#X#[#_#`#a#b#c#d#e#f#g#h#i#p#t$o%Q%m%p%q%t%v%w%y%}&W&e&p&r&x'T'f'j'n(l)o)v*c+T+X+^+n,Z,e,n,z-X-`.o.t/R/r0T0U0V0X0]0`0b1S1e1o1x3s4U4i4k4l4|5g6s7O7^7i9R9z:a:o!m=Y#k#|&[(b+j+m-f0r2^3p4u8c9O;V;Y;];_;`;a;b;c;d;e;f;g;h;i;j;n;{;|<O<Y<Z<b<c=[#ahOPTVn!R!W!c!s!}#[#|$o%m%p%q%t%v%w%y%}&W&e'n(b)v*c+T+X+^+n,Z,z-f.o/r0T0U0V0X0]0`0b1o2^3s4U4i4k4l5g6s7O7^!^$^e#W$g$h$l(q(s({)b)c-U.R.q2f3O8S;^;s;v;y<Q<T<W<]<`<f=X=d=e=f#b'e#U#r#s$X$[&f(h(t)R)u)w)y*h*k,[,y,{.S.U/f/i/q/s1n1p2p2x3V3X4T4V5c5h5{6U6z7P7x8p9^9q;r;u;x<P<S<V<[<_<e=g=i=m=n=oQ)l$jQ-q(mg2[;l;m;t;w;z<R<U<X<^<a<gx$Ye#W$g$h$l(q(s({)b)c-U.R.q2f3O8S=X=d=e=fQ(}$ZS)X$])[Q)m$kQ.a)Y#b<r#U#r#s$X$[&f(h(t)R)u)w)y*h*k,[,y,{.S.U/f/i/q/s1n1p2p2x3V3X4T4V5c5h5{6U6z7P7x8p9^9q;r;u;x<P<S<V<[<_<e=g=i=m=n=od<s;^;s;v;y<Q<T<W<]<`<ff<t;l;m;t;w;z<R<U<X<^<a<gQ<x=]Q<y=^Q<z=_Q<{=`Q<|=aR<}=b!^$^e#W$g$h$l(q(s({)b)c-U.R.q2f3O8S;^;s;v;y<Q<T<W<]<`<f=X=d=e=f#b'e#U#r#s$X$[&f(h(t)R)u)w)y*h*k,[,y,{.S.U/f/i/q/s1n1p2p2x3V3X4T4V5c5h5{6U6z7P7x8p9^9q;r;u;x<P<S<V<[<_<e=g=i=m=n=og2[;l;m;t;w;z<R<U<X<^<a<gljOTn!R!s$o%t%v%w%y+X+^0]0`Q)Q$[Q+g&QQ+h&SR2o.S%W$_e#U#W#r#s$X$[$g$h$l&f(h(q(s(t({)R)b)c)u)w)y*h*k,[,y,{-U.R.S.U.q/f/i/q/s1n1p2f2p2x3O3V3X4T4V5c5h5{6U6z7P7x8S8p9^9q;^;l;m;r;s;t;u;v;w;x;y;z<P<Q<R<S<T<U<V<W<X<[<]<^<_<`<a<e<f<g=X=d=e=f=g=i=m=n=oQ*j%`Q/h*lQ3l/gR6g3mT)Z$])[S)Z$])[T3x/o3yQ._)WQ2|.gQ=c3sR=h6sQ)z$wQ.`)XQ.}){Q/v*uQ4Y/wQ7R4ZQ8e6kQ8t7SQ9j8fQ9s8uQ:U9kQ:g:VQ:v:hR;P:wp(q$V'g)n.Q.i.j1u2m3S5u6W9a<q=R=S=T!p<P'c(S(w)P,X-R-m-x.V.v.y/e/g1^1l1t2n2r3k3m4R5f5i5j5|6Q6Y6[6}7z8W8[8r:R=U=W=j=k=l[<Q:e:t:};R;S;U]<R2Z5p7|9_9`:pr(s$V'g)n-v.Q.i.j1u2m3S5u6W9a<q=R=S=T!r<S'c(S(w)P,X-R-m-x.V.v.y/e/g1^1l1r1t2n2r3k3m4R5f5i5j5|6Q6Y6[6}7z8W8[8r:R=U=W=j=k=l^<T:e:t:{:};R;S;U_<U2Z5p7|7}9_9`:ppiOTn}!R!s$o%k%t%v%w%y+X+^0]0`Q%h|R+T%qpiOTn}!R!s$o%k%t%v%w%y+X+^0]0`R%h|Q*n%aR/d*gqiOTn}!R!s$o%k%t%v%w%y+X+^0]0`Q/p*sS4S/t/uW6y4P4Q4R4WU8o6{6|6}U9o8n8q8rQ:Y9pR:j:ZQ%o}R*}%kR4a/}R8w7US%Pt%UR/Y*WQ%t!OR+X%uR+_%zT0^+^0`R+c%{Q+b%{R0g+cQnOQ!sTT$rn!sQ(j$UR-n(jQ!eRR&m!eQ!hSU&s!h&t,fQ&t!iR,f&uQ+s&]R0t+sQ-V'gR1v-VQ-Y'iS1y-Y1zR1z-ZQ,O&cR1W,OrZOTn}!R!s$o%k%m%t%v%w%y+X+^0]0`S!vV$mY#QZ!v+y,p3tS+y&c,OQ,p'WT3t/o3yS!nS%WU&z!n&{,gQ&{!oR,g&vQ+v&`R0v+vQ'X!yQ,j'PW,t'X,j1b5^Q1b,kR5^1cQ(]#zR-g(]Q$OdR(c$OQ#q_U(R#q,b;kQ,b;XR;k(`Q-{(xW2i-{2j5y8VU2j-|-}.OS5y2k2lR8V5z$m(o$V'c'g(S(w)P)i)j)n,X-P-Q-R-m-v-w-x.Q.V.i.j.v.y/e/g1^1l1r1s1t1u2Z2m2n2r3S3k3m4R5f5i5j5n5o5p5u5|6Q6W6Y6[6}7z7|7}8O8W8[8r9_9`9a:R:e:p:r:s:t:{:|:};R;S;U<q=R=S=T=U=W=j=k=lQ.T)PU2q.T2s5}Q2s.VR5}2rQ)[$]R.c)[Q)e$aR.l)eQ3W.vR6Z3WQ*e%ZR/c*eQ3o/jS6i3o8dR8d6jQ*p%bR/m*pQ3y/oR6q3yQ/|*zS4_/|7VR7V4aQ/T*SW3a/T3c6a8`Q3c/WQ6a3bR8`6bQ*X%PR/Z*XQ0`+^R4o0`WmOTn!sQ%x!RQ)q$oQ+W%tQ+Y%vQ+Z%wQ+]%yQ0Z+XS0^+^0`R4n0]Q$qkQ%|!VQ&P!XQ&R!YQ&T!ZQ*`%VQ*f%[Q*|%oQ+e&OQ.b)ZS0P*}+QQ0h+dQ0i+gQ0j+hU1R+{3u3vQ3f/^Q3j/eQ4X/vQ4c0RQ4m0[Y4{0y1T1U1Z6uQ6e3hQ6f3kQ7Q4YQ7W4b[7h4}5O5S5W5Y8lQ8a6cQ8s7RQ8x7XY9P7g7j7n7p7qQ9g8bQ9i8eQ9r8tW9v9Q9V9X9ZQ:T9jQ:[9sU:]9w9|:OQ:f:US:k:_:cQ:u:gQ:x:mQ;O:vQ;Q:zR;T;PQ$yqQ&h!`U)}$z${$|Q+l&YU,^&i&j&kQ.X)US/P*O*PQ0q+oQ1Q+{S1`,_,`Q2v.]Q3Z/QQ4y0wS4z0y1VQ5]1aQ6R2zS7k5P5SS9T7l7qQ9y9UQ:`9{R:n:bS$We=XR)f$bU$ae$b=XR.k)dQ$VeS'c#U)yQ'g#WS(S#r#sQ(w$XQ)P$[Q)i$gQ)j$hQ)n$lQ,X&fQ-P;rQ-Q;uQ-R;xQ-m(hQ-v(qQ-w(sQ-x(tQ.Q({Q.V)RQ.i)bQ.j)cf.v)u,y/q1n4T5c6z7x8p9^9qQ.y)wQ/e*hQ/g*kQ1^,[Q1l,{Q1r<PQ1s<SQ1t<VQ1u-US2Z;l;mQ2m.RQ2n.SQ2r.UQ3S.qQ3k/fQ3m/iQ4R/sQ5f1pQ5i<[Q5j<_Q5n;tQ5o;wQ5p;zQ5u2fQ5|2pQ6Q2xQ6W3OQ6Y3VQ6[3XQ6}4VQ7z5hQ7|<XQ7}<RQ8O<UQ8W5{Q8[6UQ8r7PQ9_<^Q9`<aQ9a8SQ:R<eQ:e;^Q:p<gQ:r;sQ:s;vQ:t;yQ:{<QQ:|<TQ:}<WQ;R<]Q;S<`Q;U<fQ<q=XQ=R=dQ=S=eQ=T=fQ=U=gQ=W=iQ=j=mQ=k=nR=l=olkOTn!R!s$o%t%v%w%y+X+^0]0`Q!^PS!uV!}Q&O!WQ&l!cQ'p#[Q(a#|S+Q%m%pQ+U%qQ+d%}Q+i&WQ,W&eQ-]'nQ-k(bQ.x)vQ/a*cQ0W+TU0p+n3s6sQ1],ZQ1k,zQ2a-fQ3Q.oQ4Q/rQ4e0TQ4f0UQ4h0VQ4j0XQ4q0bQ5e1oQ5s2^Q6|4UQ7]4iQ7_4kQ7`4lQ7y5gQ8q7OR8z7^#U_OPTVn!R!W!s!}#[$o%m%p%q%t%v%w%y%}&W&e'n)v*c+T+X+^+n,Z,z.o/r0T0U0V0X0]0`0b1o3s4U4i4k4l5g6s7O7^Q!iSQ!tUQ$soS&o!g&rQ&u!jQ'b#TQ'i#XQ'q#_Q'r#`Q's#aQ't#bQ'u#cQ'v#dQ'w#eQ'x#fQ'y#gQ'z#hQ'{#iQ'}#kQ(Q#pQ(U#tW(`#|(b-f2^Q*Y%QS+p&[0rS,c&p,eQ,h&xQ,m'TQ-T'fQ-Z'jQ-_;VQ-a;YQ-p(lQ.r)oQ0l+jQ0o+mQ1d,nQ1w-XQ1|;]Q1};_Q2O;`Q2P;aQ2Q;bQ2R;cQ2S;dQ2T;eQ2U;fQ2V;gQ2W;hQ2X;iQ2Y-`Q2];nQ2b;jQ3T.tQ3[/RQ4x;{Q5Y1SQ5_1eQ5k1xQ5l;|Q5q<OQ5r<YQ6j3pQ7d4uQ7g4|Q7{<ZQ8P<bQ8Q<cQ9Q7iQ9h8cQ9u9OQ9w9RQ:_9zQ:m:aQ:z:oQ;X!cR<w=[R!kSR&^!]S&Y!]+rS+o&Z&bS+{&c,OQ0w+xW0y+y,S,T,UU1V+|,Q,RY1Z,V3t3{3|3}S3u/o3yU5P0z0{0|S5S0}1OW5W1P6n6o6xU7l5Q5R5TS7p5U8gQ7q5VU9U7m7o7rQ9Z7sS9{9W9YR:b9}R'h#WR'k#XQ#OXR0x;WT!zV$mS!yV$mU%Zvw+VU'P!v!x!{S,k'Q'RQ,r'WQ/b*dQ1c,lU1f,p,q,sS5`1g1hR7u5a`!mS!g!j%W&p&y*a,it!wVvw!v!x!{$m'Q'R'W*d,l,p,q,s1g1h5aQ0Y+VQ0m+kQ4s0eQ7c4tT<n&[*bT!pS%WS!oS%WS&q!g&yS&v!j*aS+q&[*bT,d&p,iT&a!]%XQ#zbR(f$PT([#z(]R2`-eT(z$X(|R)S$[Q.w)uQ1j,yQ4P/qQ5d1nQ6{4TQ7v5cQ8n6zQ9]7xQ9p8pQ:Q9^R:Z9qllOTn!R!s$o%t%v%w%y+X+^0]0`Q%n}R*|%kV%[vw+VR/k*mR*{%iQ%TtR*_%UR*T%OT%r!O%uT%s!O%uT0_+^0`",nodeNames:" extends ArithOp ArithOp InterpolationStart LineComment BlockComment Script ExportDeclaration export Star as VariableName String from ; default FunctionDeclaration async function VariableDefinition > TypeParamList TypeDefinition ThisType this LiteralType ArithOp Number BooleanLiteral TemplateType InterpolationEnd Interpolation NullType null VoidType void TypeofType typeof MemberExpression . ?. PropertyName [ TemplateString Interpolation super RegExp ] ArrayExpression Spread , } { ObjectExpression Property async get set PropertyDefinition Block : NewExpression new TypeArgList CompareOp < ) ( ArgList UnaryExpression await yield delete LogicOp BitOp ParenthesizedExpression ClassExpression class extends ClassBody MethodDeclaration Decorator @ MemberExpression PrivatePropertyName CallExpression Privacy static abstract override PrivatePropertyDefinition PropertyDeclaration readonly accessor Optional TypeAnnotation Equals StaticBlock FunctionExpression ArrowFunction ParamList ParamList ArrayPattern ObjectPattern PatternProperty Privacy readonly Arrow MemberExpression BinaryExpression ArithOp ArithOp ArithOp ArithOp BitOp CompareOp instanceof satisfies in const CompareOp BitOp BitOp BitOp LogicOp LogicOp ConditionalExpression LogicOp LogicOp AssignmentExpression UpdateOp PostfixExpression CallExpression TaggedTemplateExpression DynamicImport import ImportMeta JSXElement JSXSelfCloseEndTag JSXStartTag JSXSelfClosingTag JSXIdentifier JSXBuiltin JSXIdentifier JSXNamespacedName JSXMemberExpression JSXSpreadAttribute JSXAttribute JSXAttributeValue JSXEscape JSXEndTag JSXOpenTag JSXFragmentTag JSXText JSXEscape JSXStartCloseTag JSXCloseTag PrefixCast ArrowFunction TypeParamList SequenceExpression KeyofType keyof UniqueType unique ImportType InferredType infer TypeName ParenthesizedType FunctionSignature ParamList NewSignature IndexedType TupleType Label ArrayType ReadonlyType ObjectType MethodType PropertyType IndexSignature PropertyDefinition CallSignature TypePredicate is NewSignature new UnionType LogicOp IntersectionType LogicOp ConditionalType ParameterizedType ClassDeclaration abstract implements type VariableDeclaration let var TypeAliasDeclaration InterfaceDeclaration interface EnumDeclaration enum EnumBody NamespaceDeclaration namespace module AmbientDeclaration declare GlobalDeclaration global ClassDeclaration ClassBody MethodDeclaration AmbientFunctionDeclaration ExportGroup VariableName VariableName ImportDeclaration ImportGroup ForStatement for ForSpec ForInSpec ForOfSpec of WhileStatement while WithStatement with DoStatement do IfStatement if else SwitchStatement switch SwitchBody CaseLabel case DefaultLabel TryStatement try CatchClause catch FinallyClause finally ReturnStatement return ThrowStatement throw BreakStatement break ContinueStatement continue DebuggerStatement debugger LabeledStatement ExpressionStatement SingleExpression",maxTerm:345,context:Iw,nodeProps:[["closedBy",4,"InterpolationEnd",43,"]",53,"}",68,")",140,"JSXSelfCloseEndTag JSXEndTag",156,"JSXEndTag"],["group",-26,8,15,17,60,195,199,202,203,205,208,211,222,224,230,232,234,236,239,245,251,253,255,257,259,261,262,"Statement",-30,12,13,25,28,29,34,44,46,47,49,54,62,70,76,77,99,100,109,110,127,130,132,133,134,135,137,138,158,159,161,"Expression",-23,24,26,30,33,35,37,162,164,166,167,169,170,171,173,174,175,177,178,179,189,191,193,194,"Type",-3,81,92,98,"ClassItem"],["openedBy",31,"InterpolationStart",48,"[",52,"{",67,"(",139,"JSXStartTag",151,"JSXStartTag JSXStartCloseTag"]],propSources:[Bw],skippedNodes:[0,5,6],repeatNodeCount:29,tokenData:"#2k~R!bOX%ZXY%uYZ'kZ[%u[]%Z]^'k^p%Zpq%uqr(Rrs)mst7]tu9guv<avw=bwx>lxyJcyzJyz{Ka{|Lm|}MW}!OLm!O!PMn!P!Q!$v!Q!R!Er!R![!G_![!]!Nc!]!^!N{!^!_# c!_!`#!`!`!a##d!a!b#%s!b!c#'h!c!}9g!}#O#(O#O#P%Z#P#Q#(f#Q#R#(|#R#S9g#S#T#)g#T#o#)}#o#p#,w#p#q#,|#q#r#-j#r#s#.S#s$f%Z$f$g%u$g#BY9g#BY#BZ#.j#BZ$IS9g$IS$I_#.j$I_$I|9g$I|$I}#1X$I}$JO#1X$JO$JT9g$JT$JU#.j$JU$KV9g$KV$KW#.j$KW&FU9g&FU&FV#.j&FV;'S9g;'S;=`<Z<%l?HT9g?HT?HU#.j?HUO9gW%`T$`WO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%ZW%rP;=`<%l%Z7Z%|i$`W'g7ROX%ZXY%uYZ%ZZ[%u[p%Zpq%uq!^%Z!_#o%Z#p$f%Z$f$g%u$g#BY%Z#BY#BZ%u#BZ$IS%Z$IS$I_%u$I_$JT%Z$JT$JU%u$JU$KV%Z$KV$KW%u$KW&FU%Z&FU&FV%u&FV;'S%Z;'S;=`%o<%l?HT%Z?HT?HU%u?HUO%Z7Z'rT$`W'h7RO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z&y(YU$`W!l&qO!^%Z!_!`(l!`#o%Z#p;'S%Z;'S;=`%o<%lO%Z&t(sU#m&l$`WO!^%Z!_!`)V!`#o%Z#p;'S%Z;'S;=`%o<%lO%Z&t)^T#m&l$`WO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z1i)t]$`W]&ZOY)mYZ*mZr)mrs,js!^)m!^!_-S!_#O)m#O#P1q#P#o)m#o#p-S#p;'S)m;'S;=`7V<%lO)m,^*rX$`WOr*mrs+_s!^*m!^!_+u!_#o*m#o#p+u#p;'S*m;'S;=`,d<%lO*m,^+fT$Z,U$`WO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z,U+xTOr+urs,Xs;'S+u;'S;=`,^<%lO+u,U,^O$Z,U,U,aP;=`<%l+u,^,gP;=`<%l*m1i,sT$Z,U$`W]&ZO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z1a-XX]&ZOY-SYZ+uZr-Srs-ts#O-S#O#P-{#P;'S-S;'S;=`1k<%lO-S1a-{O$Z,U]&Z1a.OUOr-Srs.bs;'S-S;'S;=`0y;=`<%l/R<%lO-S1a.iW$Z,U]&ZOY/RZr/Rrs/ps#O/R#O#P/u#P;'S/R;'S;=`0s<%lO/R&Z/WW]&ZOY/RZr/Rrs/ps#O/R#O#P/u#P;'S/R;'S;=`0s<%lO/R&Z/uO]&Z&Z/xRO;'S/R;'S;=`0R;=`O/R&Z0WX]&ZOY/RZr/Rrs/ps#O/R#O#P/u#P;'S/R;'S;=`0s;=`<%l/R<%lO/R&Z0vP;=`<%l/R1a1OX]&ZOY/RZr/Rrs/ps#O/R#O#P/u#P;'S/R;'S;=`0s;=`<%l-S<%lO/R1a1nP;=`<%l-S1i1vY$`WOr)mrs2fs!^)m!^!_-S!_#o)m#o#p-S#p;'S)m;'S;=`6e;=`<%l/R<%lO)m1i2o]$Z,U$`W]&ZOY3hYZ%ZZr3hrs4hs!^3h!^!_/R!_#O3h#O#P5O#P#o3h#o#p/R#p;'S3h;'S;=`6_<%lO3h&c3o]$`W]&ZOY3hYZ%ZZr3hrs4hs!^3h!^!_/R!_#O3h#O#P5O#P#o3h#o#p/R#p;'S3h;'S;=`6_<%lO3h&c4oT$`W]&ZO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z&c5TW$`WO!^3h!^!_/R!_#o3h#o#p/R#p;'S3h;'S;=`5m;=`<%l/R<%lO3h&c5rX]&ZOY/RZr/Rrs/ps#O/R#O#P/u#P;'S/R;'S;=`0s;=`<%l3h<%lO/R&c6bP;=`<%l3h1i6jX]&ZOY/RZr/Rrs/ps#O/R#O#P/u#P;'S/R;'S;=`0s;=`<%l)m<%lO/R1i7YP;=`<%l)m#]7b]$`WOt%Ztu8Zu!^%Z!_!c%Z!c!}8Z!}#R%Z#R#S8Z#S#T%Z#T#o8Z#p$g%Z$g;'S8Z;'S;=`9a<%lO8Z#]8b_$`W'|#TOt%Ztu8Zu!Q%Z!Q![8Z![!^%Z!_!c%Z!c!}8Z!}#R%Z#R#S8Z#S#T%Z#T#o8Z#p$g%Z$g;'S8Z;'S;=`9a<%lO8Z#]9dP;=`<%l8Z,T9ra$`W's#S'j)s$SSOt%Ztu9gu}%Z}!O:w!O!Q%Z!Q![9g![!^%Z!_!c%Z!c!}9g!}#R%Z#R#S9g#S#T%Z#T#o9g#p$g%Z$g;'S9g;'S;=`<Z<%lO9g[;Oa$`W$SSOt%Ztu:wu}%Z}!O:w!O!Q%Z!Q![:w![!^%Z!_!c%Z!c!}:w!}#R%Z#R#S:w#S#T%Z#T#o:w#p$g%Z$g;'S:w;'S;=`<T<%lO:w[<WP;=`<%l:w,T<^P;=`<%l9g&t<hU$`W#e&lO!^%Z!_!`<z!`#o%Z#p;'S%Z;'S;=`%o<%lO%Z&t=RT$`W#w&lO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z(h=iW(V(`$`WOv%Zvw>Rw!^%Z!_!`<z!`#o%Z#p;'S%Z;'S;=`%o<%lO%Z&t>YU$`W#q&lO!^%Z!_!`<z!`#o%Z#p;'S%Z;'S;=`%o<%lO%Z1i>s]$`W]&ZOY>lYZ?lZw>lwx,jx!^>l!^!_@|!_#O>l#O#PE_#P#o>l#o#p@|#p;'S>l;'S;=`J]<%lO>l,^?qX$`WOw?lwx+_x!^?l!^!_@^!_#o?l#o#p@^#p;'S?l;'S;=`@v<%lO?l,U@aTOw@^wx,Xx;'S@^;'S;=`@p<%lO@^,U@sP;=`<%l@^,^@yP;=`<%l?l1aARX]&ZOY@|YZ@^Zw@|wx-tx#O@|#O#PAn#P;'S@|;'S;=`EX<%lO@|1aAqUOw@|wxBTx;'S@|;'S;=`Dg;=`<%lBt<%lO@|1aB[W$Z,U]&ZOYBtZwBtwx/px#OBt#O#PCc#P;'SBt;'S;=`Da<%lOBt&ZByW]&ZOYBtZwBtwx/px#OBt#O#PCc#P;'SBt;'S;=`Da<%lOBt&ZCfRO;'SBt;'S;=`Co;=`OBt&ZCtX]&ZOYBtZwBtwx/px#OBt#O#PCc#P;'SBt;'S;=`Da;=`<%lBt<%lOBt&ZDdP;=`<%lBt1aDlX]&ZOYBtZwBtwx/px#OBt#O#PCc#P;'SBt;'S;=`Da;=`<%l@|<%lOBt1aE[P;=`<%l@|1iEdY$`WOw>lwxFSx!^>l!^!_@|!_#o>l#o#p@|#p;'S>l;'S;=`Ik;=`<%lBt<%lO>l1iF]]$Z,U$`W]&ZOYGUYZ%ZZwGUwx4hx!^GU!^!_Bt!_#OGU#O#PHU#P#oGU#o#pBt#p;'SGU;'S;=`Ie<%lOGU&cG]]$`W]&ZOYGUYZ%ZZwGUwx4hx!^GU!^!_Bt!_#OGU#O#PHU#P#oGU#o#pBt#p;'SGU;'S;=`Ie<%lOGU&cHZW$`WO!^GU!^!_Bt!_#oGU#o#pBt#p;'SGU;'S;=`Hs;=`<%lBt<%lOGU&cHxX]&ZOYBtZwBtwx/px#OBt#O#PCc#P;'SBt;'S;=`Da;=`<%lGU<%lOBt&cIhP;=`<%lGU1iIpX]&ZOYBtZwBtwx/px#OBt#O#PCc#P;'SBt;'S;=`Da;=`<%l>l<%lOBt1iJ`P;=`<%l>l,TJjT!f+{$`WO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z$PKQT!e#w$`WO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z)ZKjW$`W'k#e#f&lOz%Zz{LS{!^%Z!_!`<z!`#o%Z#p;'S%Z;'S;=`%o<%lO%Z&tLZU$`W#c&lO!^%Z!_!`<z!`#o%Z#p;'S%Z;'S;=`%o<%lO%Z*qLtU$`Wk*iO!^%Z!_!`<z!`#o%Z#p;'S%Z;'S;=`%o<%lO%Z,TM_T!T+{$`WO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z,TMuX$`Wx(dO!O%Z!O!PNb!P!Q%Z!Q![! d![!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z$oNgV$`WO!O%Z!O!PN|!P!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z$o! TT!S$g$`WO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z&c! k]$`Wl&ZO!Q%Z!Q![! d![!^%Z!_!g%Z!g!h!!d!h#R%Z#R#S! d#S#X%Z#X#Y!!d#Y#o%Z#p;'S%Z;'S;=`%o<%lO%Z&c!!i]$`WO{%Z{|!#b|}%Z}!O!#b!O!Q%Z!Q![!$S![!^%Z!_#R%Z#R#S!$S#S#o%Z#p;'S%Z;'S;=`%o<%lO%Z&c!#gX$`WO!Q%Z!Q![!$S![!^%Z!_#R%Z#R#S!$S#S#o%Z#p;'S%Z;'S;=`%o<%lO%Z&c!$ZX$`Wl&ZO!Q%Z!Q![!$S![!^%Z!_#R%Z#R#S!$S#S#o%Z#p;'S%Z;'S;=`%o<%lO%Z7Z!$}b$`W#d&lOY!&VYZ%ZZz!&Vz{!-n{!P!&V!P!Q!BV!Q!^!&V!^!_!(f!_!`!Ch!`!a!Dm!a!}!&V!}#O!+T#O#P!,v#P#o!&V#o#p!(f#p;'S!&V;'S;=`!-h<%lO!&VX!&^^$`W!PPOY!&VYZ%ZZ!P!&V!P!Q!'Y!Q!^!&V!^!_!(f!_!}!&V!}#O!+T#O#P!,v#P#o!&V#o#p!(f#p;'S!&V;'S;=`!-h<%lO!&VX!'aa$`W!PPO!^%Z!_#Z%Z#Z#[!'Y#[#]%Z#]#^!'Y#^#a%Z#a#b!'Y#b#g%Z#g#h!'Y#h#i%Z#i#j!'Y#j#m%Z#m#n!'Y#n#o%Z#p;'S%Z;'S;=`%o<%lO%ZP!(kX!PPOY!(fZ!P!(f!P!Q!)W!Q!}!(f!}#O!)o#O#P!*n#P;'S!(f;'S;=`!*}<%lO!(fP!)]U!PP#Z#[!)W#]#^!)W#a#b!)W#g#h!)W#i#j!)W#m#n!)WP!)rVOY!)oZ#O!)o#O#P!*X#P#Q!(f#Q;'S!)o;'S;=`!*h<%lO!)oP!*[SOY!)oZ;'S!)o;'S;=`!*h<%lO!)oP!*kP;=`<%l!)oP!*qSOY!(fZ;'S!(f;'S;=`!*}<%lO!(fP!+QP;=`<%l!(fX!+Y[$`WOY!+TYZ%ZZ!^!+T!^!_!)o!_#O!+T#O#P!,O#P#Q!&V#Q#o!+T#o#p!)o#p;'S!+T;'S;=`!,p<%lO!+TX!,TX$`WOY!+TYZ%ZZ!^!+T!^!_!)o!_#o!+T#o#p!)o#p;'S!+T;'S;=`!,p<%lO!+TX!,sP;=`<%l!+TX!,{X$`WOY!&VYZ%ZZ!^!&V!^!_!(f!_#o!&V#o#p!(f#p;'S!&V;'S;=`!-h<%lO!&VX!-kP;=`<%l!&V7Z!-u`$`W!PPOY!-nYZ!.wZz!-nz{!2U{!P!-n!P!Q!@m!Q!^!-n!^!_!4m!_!}!-n!}#O!;l#O#P!?o#P#o!-n#o#p!4m#p;'S!-n;'S;=`!@g<%lO!-n7Z!.|X$`WOz!.wz{!/i{!^!.w!^!_!0w!_#o!.w#o#p!0w#p;'S!.w;'S;=`!2O<%lO!.w7Z!/nZ$`WOz!.wz{!/i{!P!.w!P!Q!0a!Q!^!.w!^!_!0w!_#o!.w#o#p!0w#p;'S!.w;'S;=`!2O<%lO!.w7Z!0hT$`WU7RO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z7R!0zTOz!0wz{!1Z{;'S!0w;'S;=`!1x<%lO!0w7R!1^VOz!0wz{!1Z{!P!0w!P!Q!1s!Q;'S!0w;'S;=`!1x<%lO!0w7R!1xOU7R7R!1{P;=`<%l!0w7Z!2RP;=`<%l!.w7Z!2]`$`W!PPOY!-nYZ!.wZz!-nz{!2U{!P!-n!P!Q!3_!Q!^!-n!^!_!4m!_!}!-n!}#O!;l#O#P!?o#P#o!-n#o#p!4m#p;'S!-n;'S;=`!@g<%lO!-n7Z!3ha$`WU7R!PPO!^%Z!_#Z%Z#Z#[!'Y#[#]%Z#]#^!'Y#^#a%Z#a#b!'Y#b#g%Z#g#h!'Y#h#i%Z#i#j!'Y#j#m%Z#m#n!'Y#n#o%Z#p;'S%Z;'S;=`%o<%lO%Z7R!4r[!PPOY!4mYZ!0wZz!4mz{!5h{!P!4m!P!Q!:b!Q!}!4m!}#O!6|#O#P!9r#P;'S!4m;'S;=`!:[<%lO!4m7R!5m[!PPOY!4mYZ!0wZz!4mz{!5h{!P!4m!P!Q!6c!Q!}!4m!}#O!6|#O#P!9r#P;'S!4m;'S;=`!:[<%lO!4m7R!6jUU7R!PP#Z#[!)W#]#^!)W#a#b!)W#g#h!)W#i#j!)W#m#n!)W7R!7PYOY!6|YZ!0wZz!6|z{!7o{#O!6|#O#P!9S#P#Q!4m#Q;'S!6|;'S;=`!9l<%lO!6|7R!7r[OY!6|YZ!0wZz!6|z{!7o{!P!6|!P!Q!8h!Q#O!6|#O#P!9S#P#Q!4m#Q;'S!6|;'S;=`!9l<%lO!6|7R!8mVU7ROY!)oZ#O!)o#O#P!*X#P#Q!(f#Q;'S!)o;'S;=`!*h<%lO!)o7R!9VVOY!6|YZ!0wZz!6|z{!7o{;'S!6|;'S;=`!9l<%lO!6|7R!9oP;=`<%l!6|7R!9uVOY!4mYZ!0wZz!4mz{!5h{;'S!4m;'S;=`!:[<%lO!4m7R!:_P;=`<%l!4m7R!:ga!PPOz!0wz{!1Z{#Z!0w#Z#[!:b#[#]!0w#]#^!:b#^#a!0w#a#b!:b#b#g!0w#g#h!:b#h#i!0w#i#j!:b#j#m!0w#m#n!:b#n;'S!0w;'S;=`!1x<%lO!0w7Z!;q^$`WOY!;lYZ!.wZz!;lz{!<m{!^!;l!^!_!6|!_#O!;l#O#P!>q#P#Q!-n#Q#o!;l#o#p!6|#p;'S!;l;'S;=`!?i<%lO!;l7Z!<r`$`WOY!;lYZ!.wZz!;lz{!<m{!P!;l!P!Q!=t!Q!^!;l!^!_!6|!_#O!;l#O#P!>q#P#Q!-n#Q#o!;l#o#p!6|#p;'S!;l;'S;=`!?i<%lO!;l7Z!={[$`WU7ROY!+TYZ%ZZ!^!+T!^!_!)o!_#O!+T#O#P!,O#P#Q!&V#Q#o!+T#o#p!)o#p;'S!+T;'S;=`!,p<%lO!+T7Z!>vZ$`WOY!;lYZ!.wZz!;lz{!<m{!^!;l!^!_!6|!_#o!;l#o#p!6|#p;'S!;l;'S;=`!?i<%lO!;l7Z!?lP;=`<%l!;l7Z!?tZ$`WOY!-nYZ!.wZz!-nz{!2U{!^!-n!^!_!4m!_#o!-n#o#p!4m#p;'S!-n;'S;=`!@g<%lO!-n7Z!@jP;=`<%l!-n7Z!@te$`W!PPOz!.wz{!/i{!^!.w!^!_!0w!_#Z!.w#Z#[!@m#[#]!.w#]#^!@m#^#a!.w#a#b!@m#b#g!.w#g#h!@m#h#i!.w#i#j!@m#j#m!.w#m#n!@m#n#o!.w#o#p!0w#p;'S!.w;'S;=`!2O<%lO!.w7Z!B^X$`WT7ROY!BVYZ%ZZ!^!BV!^!_!By!_#o!BV#o#p!By#p;'S!BV;'S;=`!Cb<%lO!BV7R!COST7ROY!ByZ;'S!By;'S;=`!C[<%lO!By7R!C_P;=`<%l!By7Z!CeP;=`<%l!BV&u!Cq^$`W#w&l!PPOY!&VYZ%ZZ!P!&V!P!Q!'Y!Q!^!&V!^!_!(f!_!}!&V!}#O!+T#O#P!,v#P#o!&V#o#p!(f#p;'S!&V;'S;=`!-h<%lO!&V]!Dv^$PS$`W!PPOY!&VYZ%ZZ!P!&V!P!Q!'Y!Q!^!&V!^!_!(f!_!}!&V!}#O!+T#O#P!,v#P#o!&V#o#p!(f#p;'S!&V;'S;=`!-h<%lO!&V&c!Eyf$`Wl&ZO!O%Z!O!P! d!P!Q%Z!Q![!G_![!^%Z!_!g%Z!g!h!!d!h#R%Z#R#S!G_#S#U%Z#U#V!IR#V#X%Z#X#Y!!d#Y#b%Z#b#c!Hk#c#d!Js#d#l%Z#l#m!L_#m#o%Z#p;'S%Z;'S;=`%o<%lO%Z&c!Gfa$`Wl&ZO!O%Z!O!P! d!P!Q%Z!Q![!G_![!^%Z!_!g%Z!g!h!!d!h#R%Z#R#S!G_#S#X%Z#X#Y!!d#Y#b%Z#b#c!Hk#c#o%Z#p;'S%Z;'S;=`%o<%lO%Z&c!HrT$`Wl&ZO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z&c!IWY$`WO!Q%Z!Q!R!Iv!R!S!Iv!S!^%Z!_#R%Z#R#S!Iv#S#o%Z#p;'S%Z;'S;=`%o<%lO%Z&c!I}[$`Wl&ZO!Q%Z!Q!R!Iv!R!S!Iv!S!^%Z!_#R%Z#R#S!Iv#S#b%Z#b#c!Hk#c#o%Z#p;'S%Z;'S;=`%o<%lO%Z&c!JxX$`WO!Q%Z!Q!Y!Ke!Y!^%Z!_#R%Z#R#S!Ke#S#o%Z#p;'S%Z;'S;=`%o<%lO%Z&c!KlZ$`Wl&ZO!Q%Z!Q!Y!Ke!Y!^%Z!_#R%Z#R#S!Ke#S#b%Z#b#c!Hk#c#o%Z#p;'S%Z;'S;=`%o<%lO%Z&c!Ld]$`WO!Q%Z!Q![!M]![!^%Z!_!c%Z!c!i!M]!i#R%Z#R#S!M]#S#T%Z#T#Z!M]#Z#o%Z#p;'S%Z;'S;=`%o<%lO%Z&c!Md_$`Wl&ZO!Q%Z!Q![!M]![!^%Z!_!c%Z!c!i!M]!i#R%Z#R#S!M]#S#T%Z#T#Z!M]#Z#b%Z#b#c!Hk#c#o%Z#p;'S%Z;'S;=`%o<%lO%Z(m!NlT!_V$`W#u(^O!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z!P# ST_w$`WO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z6i# nR'n$Y!c(O$Q,_(ZP!P!Q# w!^!_# |!_!`#!ZW# |O$bW&l#!RP#g&l!_!`#!U&l#!ZO#w&l&l#!`O#h&l(m#!gV#T(e$`WO!^%Z!_!`(l!`!a#!|!a#o%Z#p;'S%Z;'S;=`%o<%lO%Z&u##TT#`&m$`WO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z(m##oVe!s#h&l$]S$`WO!^%Z!_!`#$U!`!a#$l!a#o%Z#p;'S%Z;'S;=`%o<%lO%Z&t#$]T#h&l$`WO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z&t#$sV#g&l$`WO!^%Z!_!`<z!`!a#%Y!a#o%Z#p;'S%Z;'S;=`%o<%lO%Z&t#%aU#g&l$`WO!^%Z!_!`<z!`#o%Z#p;'S%Z;'S;=`%o<%lO%Z(m#%zX'}&q$`WO!O%Z!O!P#&g!P!^%Z!_!a%Z!a!b#&}!b#o%Z#p;'S%Z;'S;=`%o<%lO%Z(i#&nTy(a$`WO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z&t#'UU$`W#r&lO!^%Z!_!`<z!`#o%Z#p;'S%Z;'S;=`%o<%lO%Z#_#'oT!u#V$`WO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z,P#(VT{+w$`WO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z$P#(mT!Q#w$`WO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z&t#)TU#o&l$`WO!^%Z!_!`<z!`#o%Z#p;'S%Z;'S;=`%o<%lO%Z){#)nT$`W'r)sO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z,T#*Ya$`W's#S'j)s$USOt%Ztu#)}u}%Z}!O#+_!O!Q%Z!Q![#)}![!^%Z!_!c%Z!c!}#)}!}#R%Z#R#S#)}#S#T%Z#T#o#)}#p$g%Z$g;'S#)};'S;=`#,q<%lO#)}[#+fa$`W$USOt%Ztu#+_u}%Z}!O#+_!O!Q%Z!Q![#+_![!^%Z!_!c%Z!c!}#+_!}#R%Z#R#S#+_#S#T%Z#T#o#+_#p$g%Z$g;'S#+_;'S;=`#,k<%lO#+_[#,nP;=`<%l#+_,T#,tP;=`<%l#)}~#,|O!V~(h#-TV(U(`$`WO!^%Z!_!`<z!`#o%Z#p#q#&}#q;'S%Z;'S;=`%o<%lO%Z(}#-sT!U(soQ$`WO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%ZX#.ZT!mP$`WO!^%Z!_#o%Z#p;'S%Z;'S;=`%o<%lO%Z7Z#.wt$`W'g7R's#S'j)s$SSOX%ZXY%uYZ%ZZ[%u[p%Zpq%uqt%Ztu9gu}%Z}!O:w!O!Q%Z!Q![9g![!^%Z!_!c%Z!c!}9g!}#R%Z#R#S9g#S#T%Z#T#o9g#p$f%Z$f$g%u$g#BY9g#BY#BZ#.j#BZ$IS9g$IS$I_#.j$I_$JT9g$JT$JU#.j$JU$KV9g$KV$KW#.j$KW&FU9g&FU&FV#.j&FV;'S9g;'S;=`<Z<%l?HT9g?HT?HU#.j?HUO9g7Z#1fa$`W'h7R's#S'j)s$SSOt%Ztu9gu}%Z}!O:w!O!Q%Z!Q![9g![!^%Z!_!c%Z!c!}9g!}#R%Z#R#S9g#S#T%Z#T#o9g#p$g%Z$g;'S9g;'S;=`<Z<%lO9g",tokenizers:[Vw,Uw,zw,Nw,0,1,2,3,4,5,6,7,8,9,Dw],topRules:{Script:[0,7],SingleExpression:[1,263]},dialects:{jsx:13404,ts:13406},dynamicPrecedences:{159:1,187:1},specialized:[{term:302,get:t=>$w[t]||-1},{term:311,get:t=>Xw[t]||-1},{term:65,get:t=>jw[t]||-1}],tokenPrec:13429});eO("function ${name}(${params}) {\n\t${}\n}",{label:"function",detail:"definition",type:"keyword"}),eO("for (let ${index} = 0; ${index} < ${bound}; ${index}++) {\n\t${}\n}",{label:"for",detail:"loop",type:"keyword"}),eO("for (let ${name} of ${collection}) {\n\t${}\n}",{label:"for",detail:"of loop",type:"keyword"}),eO("do {\n\t${}\n} while (${})",{label:"do",detail:"loop",type:"keyword"}),eO("while (${}) {\n\t${}\n}",{label:"while",detail:"loop",type:"keyword"}),eO("try {\n\t${}\n} catch (${error}) {\n\t${}\n}",{label:"try",detail:"/ catch block",type:"keyword"}),eO("if (${}) {\n\t${}\n}",{label:"if",detail:"block",type:"keyword"}),eO("if (${}) {\n\t${}\n} else {\n\t${}\n}",{label:"if",detail:"/ else block",type:"keyword"}),eO("class ${name} {\n\tconstructor(${params}) {\n\t\t${}\n\t}\n}",{label:"class",detail:"definition",type:"keyword"}),eO('import {${names}} from "${module}"\n${}',{label:"import",detail:"named",type:"keyword"}),eO('import ${name} from "${module}"\n${}',{label:"import",detail:"default",type:"keyword"});const Zw=uv.define({name:"javascript",parser:Gw.configure({props:[Pv.add({IfStatement:Fv({except:/^\s*({|else\b)/}),TryStatement:Fv({except:/^\s*({|catch\b|finally\b)/}),LabeledStatement:t=>t.baseIndent,SwitchBody:t=>{let e=t.textAfter,i=/^\s*\}/.test(e),s=/^\s*(case|default)\b/.test(e);return t.baseIndent+(i?0:s?1:2)*t.unit},Block:function({closing:t,align:e=!0,units:i=1}){return s=>Lv(s,e,i,t)}({closing:"}"}),ArrowFunction:t=>t.baseIndent+t.unit,"TemplateString BlockComment":()=>null,"Statement Property":Fv({except:/^{/}),JSXElement(t){let e=/^\s*<\//.test(t.textAfter);return t.lineIndent(t.node.from)+(e?0:t.unit)},JSXEscape(t){let e=/\s*\}/.test(t.textAfter);return t.lineIndent(t.node.from)+(e?0:t.unit)},"JSXOpenTag JSXSelfClosingTag":t=>t.column(t.node.from)+t.unit}),Uv.add({"Block ClassBody SwitchBody EnumBody ObjectExpression ArrayExpression":function(t){let e=t.firstChild,i=t.lastChild;return e&&e.to<i.from?{from:e.to,to:i.type.isError?t.to:i.from}:null},BlockComment:t=>({from:t.from+2,to:t.to-2})})]}),languageData:{closeBrackets:{brackets:["(","[","{","'",'"',"`"]},commentTokens:{line:"//",block:{open:"/*",close:"*/"}},indentOnInput:/^\s*(?:case |default:|\{|\}|<\/)$/,wordChars:"$"}});function qw(t,e,i=t.length){if(!e)return"";let s=e.getChild("JSXIdentifier");return s?t.sliceString(s.from,Math.min(s.to,i)):""}Zw.configure({dialect:"ts"},"typescript"),Zw.configure({dialect:"jsx"}),Zw.configure({dialect:"jsx ts"},"typescript");const Ww="object"==typeof navigator&&/Android\b/.test(navigator.userAgent);Cf.inputHandler.of(((t,e,i,s)=>{if((Ww?t.composing:t.compositionStarted)||t.state.readOnly||e!=i||">"!=s&&"/"!=s||!Zw.isActiveAt(t.state,e,-1))return!1;let{state:n}=t,r=n.changeByRange((t=>{var e,i,r;let o,{head:a}=t,l=dv(n).resolveInner(a,-1);if("JSXStartTag"==l.name&&(l=l.parent),">"==s&&"JSXFragmentTag"==l.name)return{range:Qh.cursor(a+1),changes:{from:a,insert:"><>"}};if(">"==s&&"JSXIdentifier"==l.name){if("JSXEndTag"!=(null===(i=null===(e=l.parent)||void 0===e?void 0:e.lastChild)||void 0===i?void 0:i.name)&&(o=qw(n.doc,l.parent,a)))return{range:Qh.cursor(a+1),changes:{from:a,insert:`></${o}>`}}}else if("/"==s&&"JSXFragmentTag"==l.name){let t=l.parent,e=null==t?void 0:t.parent;if(t.from==a-1&&"JSXEndTag"!=(null===(r=e.lastChild)||void 0===r?void 0:r.name)&&(o=qw(n.doc,null==e?void 0:e.firstChild,a))){let t=`/${o}>`;return{range:Qh.cursor(a+t.length),changes:{from:a,insert:t}}}}return{range:t}}));return!r.changes.empty&&(t.dispatch(r,{userEvent:"input.type",scrollIntoView:!0}),!0)}));let Hw=function(){},Yw=function(){};const Kw=$h.define({create:()=>null,update:(t,e)=>(e.docChanged&&Yw(e.newDoc.toString()),null)}),Jw=function(t,e={}){return UO.of({source:t,config:e})}((t=>{let e=[],i=t.errorLines.length;if(0===i)return e;for(;i--;)e.push({from:t.state.doc.line(t.errorLines[i].lineNumber).from,to:t.state.doc.line(t.errorLines[i].lineNumber).from+2,message:t.errorLines[i].description,severity:"error"});return e}));function tS(t="",e={}){let i=[ig(),rg,pm(),$y(),sy(),Zf(),Sv.of("    "),kc.allowMultipleSelections.of(!0),kc.transactionFilter.of((t=>{if(!t.docChanged||!t.isUserEvent("input.type")&&!t.isUserEvent("input.complete"))return t;let e=t.startState.languageDataAt("indentOnInput",t.startState.selection.main.head);if(!e.length)return t;let i=t.newDoc,{head:s}=t.newSelection.main,n=i.lineAt(s);if(s>n.from+Iv)return t;let r=i.sliceString(n.from,s);if(!e.some((t=>t.test(r))))return t;let{state:o}=t,a=-1,l=[];for(let{head:t}of o.selection.ranges){let e=o.doc.lineAt(t);if(e.from==a)continue;a=e.from;let i=Tv(o,e.from);if(null==i)continue;let s=/^\s*/.exec(e.text)[0],n=Av(o,i);s!=n&&l.push({from:e.from,to:e.from+s.length,insert:n})}return l.length?[t,{changes:l,sequential:!0}]:t})),Oy(),[dO,aO],Df.of([ax,...pO,...ox,...ob,...Hv,...OO]),Zw,hy(uy,{fallback:!0}),Kw,Jw,ew(),lw];return kc.create({doc:t,extensions:i})}class eS extends Cf{constructor(t,e){super({state:tS(),parent:t}),this.isEdit=!1,this.errorLines=[],Hw=e,Yw=this.onChange.bind(this)}addError(t){this.errorLines=t}noError(){this.errorLines=[]}setValue(t){this.isEdit=!1,this.dispatch({changes:{from:0,to:this.state.doc.length,insert:t}})}clear(){this.setValue("")}getValue(){return this.state.doc.toString()}onChange(t){const e=this.getValue();""!==e&&(this.isEdit=t!==e),Hw(t)}}class iS{constructor(t=!1){this.esprimaReady=!1,this.loadEsprima(),this.isSolo=t,this.isOpen=!1,this.source=null,this.left=0,this.refresh=!1,this.old="",this.extraCode=[],this.useCodeMirror=!0,this.errorLines=[],this.widgets=[],this.isSolo&&this.open()}message(t){switch(t.data.type){case"connect":this.source=t.source,this.send({type:"connect",msg:"Editor connected !!"});break;case"set":this.set(t.data.code,t.data.name)}}send(t){this.source&&this.source.postMessage(t)}detach(){this.isSolo?this.send({type:"close"}):Main.externEditor()}reset(){let t=this.extraCode.length;for(;t--;)this.extraCode[t].remove();this.extraCode=[]}loadSrcipt(t){const e=t.substring(t.lastIndexOf("/")+1,t.lastIndexOf("."));var i=new XMLHttpRequest;i.open("GET",t),i.overrideMimeType("text/javascript"),i.onreadystatechange=function(){4===i.readyState&&(200===i.status||0===i.status?this.set(i.responseText,e):console.error("Couldn't load ["+e+"] ["+i.status+"]"))}.bind(this),i.send()}loadExtra(t,e){const i=t.substring(t.lastIndexOf("/")+1,t.lastIndexOf("."));var s=new XMLHttpRequest;s.open("GET",t),s.overrideMimeType("text/javascript"),s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status||0===s.status){let t=document.createElement("script");t.language="javascript",t.type="text/javascript",t.charset="utf-8",t.async=!1,t.innerHTML="{"+s.responseText+"}",this.extraCode.push(t),document.getElementsByTagName("head")[0].appendChild(t),e()}else console.error("Couldn't load ["+i+"] ["+s.status+"]")}.bind(this),s.send()}loadEsprima(){var t=new XMLHttpRequest;t.open("GET","./src/libs/esprima.js"),t.overrideMimeType("text/javascript"),t.onreadystatechange=function(){if(4===t.readyState)if(200===t.status||0===t.status){let e=document.createElement("script");e.type="text/javascript",e.async=!0,e.charset="utf-8",e.text=t.responseText,document.getElementsByTagName("head")[0].appendChild(e),this.esprimaReady=!0}else console.error("Couldn't load [esprima] ["+t.status+"]")}.bind(this),t.send()}show(t){this.isOpen&&!t?this.close():this.open(),Main&&Main.setLeft(this.left)}open(){this.left=this.isSolo?window.innerWidth:.5*window.innerWidth-200,this.isOpen=!0;let t="-o-user-select:none; -ms-user-select:none; -khtml-user-select:none; -webkit-user-select:none; -moz-user-select: none; pointer-events:none; ";if(this.content=document.createElement("div"),this.isSolo?this.content.style.cssText="position:absolute; margin:0; padding:0; top:0px; left:0px; width:100%;  height:100%; ":this.content.style.cssText="position:absolute; margin:0; padding:0; top:0px; left:0px; width:"+this.left+"px;  height:100%; ",this.content.style.cssText+="font-size:18px; font-family:'Roboto Mono', 'Source Code Pro', Consolas, monospace; color:#f8f8f2; background:#181915;",document.body.appendChild(this.content),this.codeContent=document.createElement("div"),this.codeContent.style.cssText="font-smooth: antialiased; -webkit-font-smoothing : antialiased; -moz-osx-font-smoothing: grayscale;position:absolute; margin:0; padding:0; top:30px; left:3px; width:calc( 100% - 6px); height:calc( 100% - 60px); border-top: 1px solid #3e4036; border-bottom: 1px solid #3e4036;",this.useCodeMirror?this.code=new eS(this.codeContent,this.onUpdate.bind(this)):(this.code=new th(this.codeContent,{language:"js",handleTabs:!0,lineNumbers:!0}),this.code.onUpdate(this.onUpdate.bind(this))),this.content.appendChild(this.codeContent),this.title=document.createElement("div"),this.title.style.cssText=t+"position:absolute; top:3px; left:10px; width:calc( 100% - 20px); color:#7c806c; text-shadow: 1px 1px 1px #000;",this.content.appendChild(this.title),this.solo=document.createElement("div"),this.solo.style.cssText=t+"position:absolute; top:0px; right:0px; width:30px; height:30px; pointer-events:auto; cursor: pointer;",this.solo.appendChild(u.dom("path","position:absolute; width:14px; height:14px; left:8px; top:8px; pointer-events:none;",{d:u.svgs.extern,fill:"#DDD",stroke:"none"})),this.content.appendChild(this.solo),this.solo.name="detach",this.saver=document.createElement("div"),this.saver.style.cssText=t+"position:absolute; top:0px; right:30px; width:30px; height:30px; pointer-events:auto; cursor: pointer;",this.saver.appendChild(u.dom("path","position:absolute; width:14px; height:14px; left:8px; top:8px; pointer-events:none;",{d:u.svgs.save,fill:"#DDD",stroke:"none"})),this.content.appendChild(this.saver),this.saver.name="save",this.loader=document.createElement("div"),this.loader.style.cssText=t+"position:absolute; top:0px; right:60px; width:30px; height:30px; pointer-events:auto; cursor: pointer;",this.loader.appendChild(u.dom("path","position:absolute; width:14px; height:14px; left:8px; top:8px; pointer-events:none;",{d:u.svgs.load,fill:"#DDD",stroke:"none"})),this.content.appendChild(this.loader),this.loader.name="load",this.help=document.createElement("div"),this.help.style.cssText=t+"position:absolute; top:3px; right:100px; width:60px; height:30px; pointer-events:none; color:#7c806c; text-shadow: 1px 1px 1px #000; text-align:right",this.content.appendChild(this.help),this.info=document.createElement("div"),this.info.style.cssText=t+"position:absolute; bottom:2px; left:10px; width:calc( 100% - 20px); text-shadow: 1px 1px 1px #000;",this.content.appendChild(this.info),this.separator=document.createElement("div"),this.separator.style.cssText=t+"background:none; position:absolute; top:0px; right:0px; width:3px; height:100%; cursor: e-resize; pointer-events:auto; z-index: 5; display:block; ",this.content.appendChild(this.separator),this.midDown=function(t){this.isDown=!0}.bind(this),this.midUp=function(t){this.isDown=!1,document.body.style.cursor="auto",this.codeContent.style.pointerEvents="auto"}.bind(this),this.midMove=function(t){t.target.name?this.help.innerHTML=t.target.name:this.help.innerHTML="",this.isDown&&(this.codeContent.style.pointerEvents="none",document.body.style.cursor="e-resize",this.left=t.clientX+2,this.content.style.width=this.left+"px",Main&&Main.setLeft(this.left))}.bind(this),this.helpers=function(t){console.log(t.target.name)}.bind(this),this.isSolo||(this.separator.addEventListener("pointerdown",this.midDown,!1),document.addEventListener("pointermove",this.midMove,!1),document.addEventListener("pointerup",this.midUp,!1)),this.saver.addEventListener("pointerdown",this.save.bind(this),!1),this.loader.addEventListener("pointerdown",this.load.bind(this),!1),this.solo.addEventListener("pointerdown",this.detach.bind(this),!1),Main&&(this.setInternCode(Main.getCode()),this.setTitle(Main.getCodeName())),this.isSolo){var e=location.hash.substr(1);""!==e&&this.loadSrcipt("./demos/"+e+".js")}else this.useCodeMirror||this.content.addEventListener("wheel",function(t){this.code.wheel(t)}.bind(this));this.content.addEventListener("dragover",(function(t){t.preventDefault()}),!1),this.content.addEventListener("dragend",(function(t){t.preventDefault()}),!1),this.content.addEventListener("dragleave",(function(t){t.preventDefault()}),!1),this.content.addEventListener("drop",this.drop.bind(this),!1)}setTitle(t){this.codeName=t,this.title.innerHTML="&#x2022;&#160;"+this.codeName}close(){this.left=0,this.isOpen=!1,document.removeEventListener("pointerdown",this.midDown),document.removeEventListener("pointerup",this.midUp),document.removeEventListener("pointermove",this.midMove),this.code.clear(),this.content.innerHTML="",document.body.removeChild(this.content)}onUpdate(t){let e=this.validate(t);this.refresh||(this.refresh=this.code.isEdit),e&&this.refresh&&(Main&&Main.injectCode(t),this.source&&this.send({type:"inject",code:t}),this.refresh=!1)}set(t,e,i){this.isOpen&&(this.setTitle(e),this.isSolo&&(location.hash=e),i&&(this.refresh=i),this.setInternCode(t))}setInternCode(t){this.useCodeMirror?this.code.setValue(t):this.code.updateCode(t),this.code.isEdit=!1}get(){return this.useCodeMirror?this.code.getValue():this.code.getCode()}save(t){d.save({name:this.codeName,data:this.get(),type:"js"})}load(t){d.load({callback:this.onLoad.bind(this),type:"js"})}onLoad(t,e){const i=e.substring(0,e.lastIndexOf("."));this.set(t,i)}setInfo(t,e=0){this.info.style.color=e?"#ff0000":"#7c806c",this.info.innerHTML=t}validate(t){if(!t)return;if(!this.esprimaReady)return!0;let e=[];try{e=esprima.parseModule(t,{tolerant:!0,loc:!0,range:!0,jsx:!0}).errors}catch(t){e.push(t)}let i=e.length;return 0===i?this.setInfo("&#2039;"):this.setInfo("Invalid code. Total issues: "+i,1),this.code.addError(e),0===i}drop(t){if(t.preventDefault(),!t.dataTransfer.items)return;const e=t.dataTransfer.files[0],i=new FileReader,s=e.name,n=s.substring(s.lastIndexOf(".")+1,s.length),r=s.substring(s.lastIndexOf("/")+1,s.lastIndexOf("."));"js"===n&&(i.readAsText(e),i.onload=function(t){this.set(t.target.result,r,!0)}.bind(this))}}var sS={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\t\t}"};class nS{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const rS=new e.OrthographicCamera(-1,1,1,-1,0,1),oS=new e.BufferGeometry;oS.setAttribute("position",new e.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),oS.setAttribute("uv",new e.Float32BufferAttribute([0,2,0,0,2,0],2));class aS{constructor(t){this._mesh=new e.Mesh(oS,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,rS)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class lS extends nS{constructor(t,i){super(),this.textureID=void 0!==i?i:"tDiffuse",t instanceof e.ShaderMaterial?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=e.UniformsUtils.clone(t.uniforms),this.material=new e.ShaderMaterial({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new aS(this.material)}render(t,e,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}}class hS extends nS{constructor(t,e){super(),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,e,i){const s=t.getContext(),n=t.state;let r,o;n.buffers.color.setMask(!1),n.buffers.depth.setMask(!1),n.buffers.color.setLocked(!0),n.buffers.depth.setLocked(!0),this.inverse?(r=0,o=1):(r=1,o=0),n.buffers.stencil.setTest(!0),n.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),n.buffers.stencil.setFunc(s.ALWAYS,r,4294967295),n.buffers.stencil.setClear(o),n.buffers.stencil.setLocked(!0),t.setRenderTarget(i),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),n.buffers.color.setLocked(!1),n.buffers.depth.setLocked(!1),n.buffers.stencil.setLocked(!1),n.buffers.stencil.setFunc(s.EQUAL,1,4294967295),n.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),n.buffers.stencil.setLocked(!0)}}class cS extends nS{constructor(){super(),this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}class uS{constructor(t,i){if(this.renderer=t,void 0===i){const s={minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBAFormat},n=t.getSize(new e.Vector2);this._pixelRatio=t.getPixelRatio(),this._width=n.width,this._height=n.height,(i=new e.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,s)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new lS(sS),this.clock=new e.Clock}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(t){void 0===t&&(t=this.clock.getDelta());const e=this.renderer.getRenderTarget();let i=!1;for(let e=0,s=this.passes.length;e<s;e++){const s=this.passes[e];if(!1!==s.enabled){if(s.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(e),s.render(this.renderer,this.writeBuffer,this.readBuffer,t,i),s.needsSwap){if(i){const e=this.renderer.getContext(),i=this.renderer.state.buffers.stencil;i.setFunc(e.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),i.setFunc(e.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==hS&&(s instanceof hS?i=!0:s instanceof cS&&(i=!1))}}this.renderer.setRenderTarget(e)}reset(t){if(void 0===t){const i=this.renderer.getSize(new e.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,e){this._width=t,this._height=e;const i=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(i,s),this.renderTarget2.setSize(i,s);for(let t=0;t<this.passes.length;t++)this.passes[t].setSize(i,s)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}}new e.OrthographicCamera(-1,1,1,-1,0,1);const dS=new e.BufferGeometry;dS.setAttribute("position",new e.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),dS.setAttribute("uv",new e.Float32BufferAttribute([0,2,0,0,2,0],2));class pS extends nS{constructor(t,i,s,n,r){super(),this.scene=t,this.camera=i,this.overrideMaterial=s,this.clearColor=n,this.clearAlpha=void 0!==r?r:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new e.Color}render(t,e,i){const s=t.autoClear;let n,r;t.autoClear=!1,void 0!==this.overrideMaterial&&(r=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(t.getClearColor(this._oldClearColor),n=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:i),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(this._oldClearColor,n),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=r),t.autoClear=s}}const fS={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new e.Color(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tvec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n\t\t\tfloat v = dot( texel.xyz, luma );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};class mS extends nS{constructor(t,i,s,n,r){super(),this.strength=void 0!==i?i:1,this.radius=s,this.threshold=n,this.resolution=void 0!==t?new e.Vector2(t.x,t.y):new e.Vector2(256,256),this.noBackground=r||!1,this.clearColor=new e.Color(0,0,0);const o={minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let a=Math.round(this.resolution.x/2),l=Math.round(this.resolution.y/2);this.renderTargetBright=new e.WebGLRenderTarget(a,l,o),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let t=0;t<this.nMips;t++){const i=new e.WebGLRenderTarget(a,l,o);i.texture.name="UnrealBloomPass.h"+t,i.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(i);const s=new e.WebGLRenderTarget(a,l,o);s.texture.name="UnrealBloomPass.v"+t,s.texture.generateMipmaps=!1,this.renderTargetsVertical.push(s),a=Math.round(a/2),l=Math.round(l/2)}void 0===fS&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");const h=fS;this.highPassUniforms=e.UniformsUtils.clone(h.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new e.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,defines:{}}),this.separableBlurMaterials=[];const c=[3,5,7,9,11];a=Math.round(this.resolution.x/2),l=Math.round(this.resolution.y/2);for(let t=0;t<this.nMips;t++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(c[t])),this.separableBlurMaterials[t].uniforms.texSize.value=new e.Vector2(a,l),a=Math.round(a/2),l=Math.round(l/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=i,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new e.Vector3(1,1,1),new e.Vector3(1,1,1),new e.Vector3(1,1,1),new e.Vector3(1,1,1),new e.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===sS&&console.error("THREE.UnrealBloomPass relies on CopyShader");const u=sS;this.copyUniforms=e.UniformsUtils.clone(u.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new e.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:e.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new e.Color,this.oldClearAlpha=1,this.basic=new e.MeshBasicMaterial,this.fsQuad=new aS(null),this.applyValue()}dispose(){for(let t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(let t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose()}setSize(t,i){let s=Math.round(t/2),n=Math.round(i/2);this.renderTargetBright.setSize(s,n);for(let t=0;t<this.nMips;t++)this.renderTargetsHorizontal[t].setSize(s,n),this.renderTargetsVertical[t].setSize(s,n),this.separableBlurMaterials[t].uniforms.texSize.value=new e.Vector2(s,n),s=Math.round(s/2),n=Math.round(n/2)}applyValue(){this.highPassUniforms.luminosityThreshold.value=this.threshold,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors}render(t,e,i,s,n){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const r=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),n&&t.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=i.texture,t.setRenderTarget(null),t.clear(),this.fsQuad.render(t)),this.highPassUniforms.tDiffuse.value=i.texture,this.fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this.fsQuad.render(t);let o=this.renderTargetBright;for(let e=0;e<this.nMips;e++)this.fsQuad.material=this.separableBlurMaterials[e],this.separableBlurMaterials[e].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[e].uniforms.direction.value=mS.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[e]),t.clear(),this.fsQuad.render(t),this.separableBlurMaterials[e].uniforms.colorTexture.value=this.renderTargetsHorizontal[e].texture,this.separableBlurMaterials[e].uniforms.direction.value=mS.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[e]),t.clear(),this.fsQuad.render(t),o=this.renderTargetsVertical[e];this.fsQuad.material=this.compositeMaterial,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,n&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(i),this.fsQuad.render(t)),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=r}getSeperableBlurMaterial(t){return new e.ShaderMaterial({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new e.Vector2(.5,.5)},direction:{value:new e.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec2 direction;\n\n\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tfloat fSigma = float(SIGMA);\n\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(t){return new e.ShaderMaterial({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform sampler2D dirtTexture;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}mS.BlurDirectionX=new e.Vector2(1,0),mS.BlurDirectionY=new e.Vector2(0,1);const gS={defines:{USE_3DTEXTURE:1},uniforms:{lut3d:{value:null},lut:{value:null},lutSize:{value:0},tDiffuse:{value:null},intensity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}\n\n\t",fragmentShader:"\n\n\t\tuniform float lutSize;\n\t\t#if USE_3DTEXTURE\n\t\tprecision highp sampler3D;\n\t\tuniform sampler3D lut3d;\n\t\t#else\n\t\tuniform sampler2D lut;\n\n\t\tvec3 lutLookup( sampler2D tex, float size, vec3 rgb ) {\n\n\t\t\tfloat sliceHeight = 1.0 / size;\n\t\t\tfloat yPixelHeight = 1.0 / ( size * size );\n\n\t\t\t// Get the slices on either side of the sample\n\t\t\tfloat slice = rgb.b * size;\n\t\t\tfloat interp = fract( slice );\n\t\t\tfloat slice0 = slice - interp;\n\t\t\tfloat centeredInterp = interp - 0.5;\n\n\t\t\tfloat slice1 = slice0 + sign( centeredInterp );\n\n\t\t\t// Pull y sample in by half a pixel in each direction to avoid color\n\t\t\t// bleeding from adjacent slices.\n\t\t\tfloat greenOffset = clamp( rgb.g * sliceHeight, yPixelHeight * 0.5, sliceHeight - yPixelHeight * 0.5 );\n\n\t\t\tvec2 uv0 = vec2(\n\t\t\t\trgb.r,\n\t\t\t\tslice0 * sliceHeight + greenOffset\n\t\t\t);\n\t\t\tvec2 uv1 = vec2(\n\t\t\t\trgb.r,\n\t\t\t\tslice1 * sliceHeight + greenOffset\n\t\t\t);\n\n\t\t\tvec3 sample0 = texture2D( tex, uv0 ).rgb;\n\t\t\tvec3 sample1 = texture2D( tex, uv1 ).rgb;\n\n\t\t\treturn mix( sample0, sample1, abs( centeredInterp ) );\n\n\t\t}\n\t\t#endif\n\n\t\tvarying vec2 vUv;\n\t\tuniform float intensity;\n\t\tuniform sampler2D tDiffuse;\n\t\tvoid main() {\n\n\t\t\tvec4 val = texture2D( tDiffuse, vUv );\n\t\t\tvec4 lutVal;\n\n\t\t\t// pull the sample in by half a pixel so the sample begins\n\t\t\t// at the center of the edge pixels.\n\t\t\tfloat pixelWidth = 1.0 / lutSize;\n\t\t\tfloat halfPixelWidth = 0.5 / lutSize;\n\t\t\tvec3 uvw = vec3( halfPixelWidth ) + val.rgb * ( 1.0 - pixelWidth );\n\n\t\t\t#if USE_3DTEXTURE\n\n\t\t\tlutVal = vec4( texture( lut3d, uvw ).rgb, val.a );\n\n\t\t\t#else\n\n\t\t\tlutVal = vec4( lutLookup( lut, lutSize, uvw ), val.a );\n\n\t\t\t#endif\n\n\t\t\tgl_FragColor = vec4( mix( val, lutVal, intensity ) );\n\n\t\t}\n\n\t"};class vS extends lS{set lut(t){const e=this.material;if(t!==this.lut&&(e.uniforms.lut3d.value=null,e.uniforms.lut.value=null,t)){const i=t.isDataTexture3D?1:0;i!==e.defines.USE_3DTEXTURE&&(e.defines.USE_3DTEXTURE=i,e.needsUpdate=!0),e.uniforms.lutSize.value=t.image.width,t.isDataTexture3D?e.uniforms.lut3d.value=t:e.uniforms.lut.value=t}}get lut(){return this.material.uniforms.lut.value||this.material.uniforms.lut3d.value}set intensity(t){this.material.uniforms.intensity.value=t}get intensity(){return this.material.uniforms.intensity.value}constructor(t={}){super(gS),this.lut=t.lut||null,this.intensity="intensity"in t?t.intensity:1}}const yS={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:.01},nearClip:{value:1},farClip:{value:1e3}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\n\t\tvarying vec2 vUv;\n\n\t\tuniform sampler2D tColor;\n\t\tuniform sampler2D tDepth;\n\n\t\tuniform float maxblur; // max blur amount\n\t\tuniform float aperture; // aperture - bigger values for shallower depth of field\n\n\t\tuniform float nearClip;\n\t\tuniform float farClip;\n\n\t\tuniform float focus;\n\t\tuniform float aspect;\n\n\t\t#include <packing>\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\t\t\t#if DEPTH_PACKING == 1\n\t\t\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\n\t\t\t#else\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\t\t\t#endif\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\t\t\treturn perspectiveDepthToViewZ( depth, nearClip, farClip );\n\t\t\t#else\n\t\t\treturn orthographicDepthToViewZ( depth, nearClip, farClip );\n\t\t\t#endif\n\t\t}\n\n\n\t\tvoid main() {\n\n\t\t\tvec2 aspectcorrect = vec2( 1.0, aspect );\n\n\t\t\tfloat viewZ = getViewZ( getDepth( vUv ) );\n\n\t\t\tfloat factor = ( focus + viewZ ); // viewZ is <= 0, so this is a difference equation\n\n\t\t\tvec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );\n\n\t\t\tvec2 dofblur9 = dofblur * 0.9;\n\t\t\tvec2 dofblur7 = dofblur * 0.7;\n\t\t\tvec2 dofblur4 = dofblur * 0.4;\n\n\t\t\tvec4 col = vec4( 0.0 );\n\n\t\t\tcol += texture2D( tColor, vUv.xy );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );\n\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\n\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );\n\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );\n\n\t\t\tgl_FragColor = col / 41.0;\n\t\t\tgl_FragColor.a = 1.0;\n\n\t\t}"};class bS extends nS{constructor(t,i,s){super(),this.scene=t,this.camera=i;const n=void 0!==s.focus?s.focus:1,r=void 0!==s.aspect?s.aspect:i.aspect,o=void 0!==s.aperture?s.aperture:.025,a=void 0!==s.maxblur?s.maxblur:1,l=s.width||window.innerWidth||1,h=s.height||window.innerHeight||1;this.renderTargetDepth=new e.WebGLRenderTarget(l,h,{minFilter:e.NearestFilter,magFilter:e.NearestFilter}),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new e.MeshDepthMaterial,this.materialDepth.depthPacking=e.RGBADepthPacking,this.materialDepth.blending=e.NoBlending,void 0===yS&&console.error("THREE.BokehPass relies on BokehShader");const c=yS,u=e.UniformsUtils.clone(c.uniforms);u.tDepth.value=this.renderTargetDepth.texture,u.focus.value=n,u.aspect.value=r,u.aperture.value=o,u.maxblur.value=a,u.nearClip.value=i.near,u.farClip.value=i.far,this.materialBokeh=new e.ShaderMaterial({defines:Object.assign({},c.defines),uniforms:u,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}),this.uniforms=u,this.needsSwap=!1,this.fsQuad=new aS(this.materialBokeh),this._oldClearColor=new e.Color}render(t,e,i){this.scene.overrideMaterial=this.materialDepth,t.getClearColor(this._oldClearColor);const s=t.getClearAlpha(),n=t.autoClear;t.autoClear=!1,t.setClearColor(16777215),t.setClearAlpha(1),t.setRenderTarget(this.renderTargetDepth),t.clear(),t.render(this.scene,this.camera),this.uniforms.tColor.value=i.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),t.clear(),this.fsQuad.render(t)),this.scene.overrideMaterial=null,t.setClearColor(this._oldClearColor),t.setClearAlpha(s),t.autoClear=n}}class xS{constructor(t=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let e=0;e<256;e++)this.p[e]=Math.floor(256*t.random());this.perm=[];for(let t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(t,e,i){return t[0]*e+t[1]*i}dot3(t,e,i,s){return t[0]*e+t[1]*i+t[2]*s}dot4(t,e,i,s,n){return t[0]*e+t[1]*i+t[2]*s+t[3]*n}noise(t,e){let i,s,n;const r=(t+e)*(.5*(Math.sqrt(3)-1)),o=Math.floor(t+r),a=Math.floor(e+r),l=(3-Math.sqrt(3))/6,h=(o+a)*l,c=t-(o-h),u=e-(a-h);let d,p;c>u?(d=1,p=0):(d=0,p=1);const f=c-d+l,m=u-p+l,g=c-1+2*l,v=u-1+2*l,y=255&o,b=255&a,x=this.perm[y+this.perm[b]]%12,O=this.perm[y+d+this.perm[b+p]]%12,w=this.perm[y+1+this.perm[b+1]]%12;let S=.5-c*c-u*u;S<0?i=0:(S*=S,i=S*S*this.dot(this.grad3[x],c,u));let k=.5-f*f-m*m;k<0?s=0:(k*=k,s=k*k*this.dot(this.grad3[O],f,m));let A=.5-g*g-v*v;return A<0?n=0:(A*=A,n=A*A*this.dot(this.grad3[w],g,v)),70*(i+s+n)}noise3d(t,e,i){let s,n,r,o;const a=(t+e+i)*(1/3),l=Math.floor(t+a),h=Math.floor(e+a),c=Math.floor(i+a),u=1/6,d=(l+h+c)*u,p=t-(l-d),f=e-(h-d),m=i-(c-d);let g,v,y,b,x,O;p>=f?f>=m?(g=1,v=0,y=0,b=1,x=1,O=0):p>=m?(g=1,v=0,y=0,b=1,x=0,O=1):(g=0,v=0,y=1,b=1,x=0,O=1):f<m?(g=0,v=0,y=1,b=0,x=1,O=1):p<m?(g=0,v=1,y=0,b=0,x=1,O=1):(g=0,v=1,y=0,b=1,x=1,O=0);const w=p-g+u,S=f-v+u,k=m-y+u,A=p-b+2*u,T=f-x+2*u,M=m-O+2*u,P=p-1+.5,C=f-1+.5,_=m-1+.5,R=255&l,E=255&h,Q=255&c,L=this.perm[R+this.perm[E+this.perm[Q]]]%12,F=this.perm[R+g+this.perm[E+v+this.perm[Q+y]]]%12,I=this.perm[R+b+this.perm[E+x+this.perm[Q+O]]]%12,D=this.perm[R+1+this.perm[E+1+this.perm[Q+1]]]%12;let U=.6-p*p-f*f-m*m;U<0?s=0:(U*=U,s=U*U*this.dot3(this.grad3[L],p,f,m));let z=.6-w*w-S*S-k*k;z<0?n=0:(z*=z,n=z*z*this.dot3(this.grad3[F],w,S,k));let N=.6-A*A-T*T-M*M;N<0?r=0:(N*=N,r=N*N*this.dot3(this.grad3[I],A,T,M));let V=.6-P*P-C*C-_*_;return V<0?o=0:(V*=V,o=V*V*this.dot3(this.grad3[D],P,C,_)),32*(s+n+r+o)}noise4d(t,e,i,s){const n=this.grad4,r=this.simplex,o=this.perm,a=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;let h,c,u,d,p;const f=(t+e+i+s)*a,m=Math.floor(t+f),g=Math.floor(e+f),v=Math.floor(i+f),y=Math.floor(s+f),b=(m+g+v+y)*l,x=t-(m-b),O=e-(g-b),w=i-(v-b),S=s-(y-b),k=(x>O?32:0)+(x>w?16:0)+(O>w?8:0)+(x>S?4:0)+(O>S?2:0)+(w>S?1:0),A=r[k][0]>=3?1:0,T=r[k][1]>=3?1:0,M=r[k][2]>=3?1:0,P=r[k][3]>=3?1:0,C=r[k][0]>=2?1:0,_=r[k][1]>=2?1:0,R=r[k][2]>=2?1:0,E=r[k][3]>=2?1:0,Q=r[k][0]>=1?1:0,L=r[k][1]>=1?1:0,F=r[k][2]>=1?1:0,I=r[k][3]>=1?1:0,D=x-A+l,U=O-T+l,z=w-M+l,N=S-P+l,V=x-C+2*l,B=O-_+2*l,$=w-R+2*l,X=S-E+2*l,j=x-Q+3*l,G=O-L+3*l,Z=w-F+3*l,q=S-I+3*l,W=x-1+4*l,H=O-1+4*l,Y=w-1+4*l,K=S-1+4*l,J=255&m,tt=255&g,et=255&v,it=255&y,st=o[J+o[tt+o[et+o[it]]]]%32,nt=o[J+A+o[tt+T+o[et+M+o[it+P]]]]%32,rt=o[J+C+o[tt+_+o[et+R+o[it+E]]]]%32,ot=o[J+Q+o[tt+L+o[et+F+o[it+I]]]]%32,at=o[J+1+o[tt+1+o[et+1+o[it+1]]]]%32;let lt=.6-x*x-O*O-w*w-S*S;lt<0?h=0:(lt*=lt,h=lt*lt*this.dot4(n[st],x,O,w,S));let ht=.6-D*D-U*U-z*z-N*N;ht<0?c=0:(ht*=ht,c=ht*ht*this.dot4(n[nt],D,U,z,N));let ct=.6-V*V-B*B-$*$-X*X;ct<0?u=0:(ct*=ct,u=ct*ct*this.dot4(n[rt],V,B,$,X));let ut=.6-j*j-G*G-Z*Z-q*q;ut<0?d=0:(ut*=ut,d=ut*ut*this.dot4(n[ot],j,G,Z,q));let dt=.6-W*W-H*H-Y*Y-K*K;return dt<0?p=0:(dt*=dt,p=dt*dt*this.dot4(n[at],W,H,Y,K)),27*(h+c+u+d+p)}}const OS={defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new e.Vector2},cameraProjectionMatrix:{value:new e.Matrix4},cameraInverseProjectionMatrix:{value:new e.Matrix4},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tNormal;\n\t\tuniform sampler2D tDepth;\n\t\tuniform sampler2D tNoise;\n\n\t\tuniform vec3 kernel[ KERNEL_SIZE ];\n\n\t\tuniform vec2 resolution;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform mat4 cameraProjectionMatrix;\n\t\tuniform mat4 cameraInverseProjectionMatrix;\n\n\t\tuniform float kernelRadius;\n\t\tuniform float minDistance; // avoid artifacts caused by neighbour fragments with minimal depth difference\n\t\tuniform float maxDistance; // avoid the influence of fragments which are too far away\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t}\n\n\t\tfloat getLinearDepth( const in vec2 screenPosition ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tvec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {\n\n\t\t\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\n\n\t\t\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );\n\n\t\t\tclipPosition *= clipW; // unprojection.\n\n\t\t\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;\n\n\t\t}\n\n\t\tvec3 getViewNormal( const in vec2 screenPosition ) {\n\n\t\t\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = getDepth( vUv );\n\t\t\tfloat viewZ = getViewZ( depth );\n\n\t\t\tvec3 viewPosition = getViewPosition( vUv, depth, viewZ );\n\t\t\tvec3 viewNormal = getViewNormal( vUv );\n\n\t\t\tvec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );\n\t\t\tvec3 random = texture2D( tNoise, vUv * noiseScale ).xyz;\n\n\t\t\t// compute matrix used to reorient a kernel vector\n\n\t\t\tvec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );\n\t\t\tvec3 bitangent = cross( viewNormal, tangent );\n\t\t\tmat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );\n\n\t\t float occlusion = 0.0;\n\n\t\t for ( int i = 0; i < KERNEL_SIZE; i ++ ) {\n\n\t\t\t\tvec3 sampleVector = kernelMatrix * kernel[ i ]; // reorient sample vector in view space\n\t\t\t\tvec3 samplePoint = viewPosition + ( sampleVector * kernelRadius ); // calculate sample point\n\n\t\t\t\tvec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 ); // project point and calculate NDC\n\t\t\t\tsamplePointNDC /= samplePointNDC.w;\n\n\t\t\t\tvec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5; // compute uv coordinates\n\n\t\t\t\tfloat realDepth = getLinearDepth( samplePointUv ); // get linear depth from depth texture\n\t\t\t\tfloat sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar ); // compute linear depth of the sample view Z value\n\t\t\t\tfloat delta = sampleDepth - realDepth;\n\n\t\t\t\tif ( delta > minDistance && delta < maxDistance ) { // if fragment is before sample point, increase occlusion\n\n\t\t\t\t\tocclusion += 1.0;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tocclusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );\n\n\t\t\tgl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );\n\n\t\t}"},wS={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:"varying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"uniform sampler2D tDepth;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tfloat getLinearDepth( const in vec2 screenPosition ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = getLinearDepth( vUv );\n\t\t\tgl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );\n\n\t\t}"},SS={uniforms:{tDiffuse:{value:null},resolution:{value:new e.Vector2}},vertexShader:"varying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"uniform sampler2D tDiffuse;\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec2 texelSize = ( 1.0 / resolution );\n\t\t\tfloat result = 0.0;\n\n\t\t\tfor ( int i = - 2; i <= 2; i ++ ) {\n\n\t\t\t\tfor ( int j = - 2; j <= 2; j ++ ) {\n\n\t\t\t\t\tvec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;\n\t\t\t\t\tresult += texture2D( tDiffuse, vUv + offset ).r;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tgl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );\n\n\t\t}"};class kS extends nS{constructor(t,i,s,n,r){super(),this.width=void 0!==s?s:512,this.height=void 0!==n?n:512,this.clear=!0,this.camera=i,this.scene=t,this.kernelRadius=8,this.kernelSize=32,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this._visibilityCache=new Map,this.isSharedTarget=r||!1,this.generateSampleKernel(),this.generateRandomKernelRotations();const o=new e.DepthTexture;o.type=e.UnsignedShortType,this.beautyRenderTarget=new e.WebGLRenderTarget(this.width,this.height,{minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBAFormat}),this.normalRenderTarget=new e.WebGLRenderTarget(this.width,this.height,{minFilter:e.NearestFilter,magFilter:e.NearestFilter,format:e.RGBAFormat,depthTexture:o}),this.depthRenderTarget=this.normalRenderTarget.clone(),this.ssaoRenderTarget=new e.WebGLRenderTarget(this.width,this.height,{minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBAFormat}),this.blurRenderTarget=this.ssaoRenderTarget.clone(),void 0===OS&&console.error("THREE.SSAOPass: The pass relies on SSAOShader."),this.ssaoMaterial=new e.ShaderMaterial({defines:Object.assign({},OS.defines),uniforms:e.UniformsUtils.clone(OS.uniforms),vertexShader:OS.vertexShader,fragmentShader:OS.fragmentShader,blending:e.NoBlending}),this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.isSharedTarget?this.depthRenderTarget.texture:this.normalRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new e.MeshNormalMaterial,this.normalMaterial.blending=e.NoBlending,this.blurMaterial=new e.ShaderMaterial({defines:Object.assign({},SS.defines),uniforms:e.UniformsUtils.clone(SS.uniforms),vertexShader:SS.vertexShader,fragmentShader:SS.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new e.ShaderMaterial({defines:Object.assign({},wS.defines),uniforms:e.UniformsUtils.clone(wS.uniforms),vertexShader:wS.vertexShader,fragmentShader:wS.fragmentShader,blending:e.NoBlending}),this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new e.ShaderMaterial({uniforms:e.UniformsUtils.clone(sS.uniforms),vertexShader:sS.vertexShader,fragmentShader:sS.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:e.DstColorFactor,blendDst:e.ZeroFactor,blendEquation:e.AddEquation,blendSrcAlpha:e.DstAlphaFactor,blendDstAlpha:e.ZeroFactor,blendEquationAlpha:e.AddEquation}),this.fsQuad=new aS(null),this.originalClearColor=new e.Color}dispose(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(t,i){switch(this.isSharedTarget?(this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.depthRenderTarget.texture):(t.setRenderTarget(this.beautyRenderTarget),t.clear(),t.render(this.scene,this.camera),this.overrideVisibility(),this.renderOverride(t,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility()),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(t,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(t,this.blurMaterial,this.blurRenderTarget),this.output){case kS.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=e.NoBlending,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:i);break;case kS.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=e.NoBlending,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:i);break;case kS.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=e.NoBlending,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:i);break;case kS.OUTPUT.Depth:this.renderPass(t,this.depthRenderMaterial,this.renderToScreen?null:i);break;case kS.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=e.NoBlending,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:i);break;case kS.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=e.NoBlending,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:i),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=e.CustomBlending,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:i);break;default:console.warn("THREE.SSAOPass: Unknown output type.")}}renderPass(t,e,i,s,n){t.getClearColor(this.originalClearColor);const r=t.getClearAlpha(),o=t.autoClear;t.setRenderTarget(i),t.autoClear=!1,null!=s&&(t.setClearColor(s),t.setClearAlpha(n||0),t.clear()),this.fsQuad.material=e,this.fsQuad.render(t),t.autoClear=o,t.setClearColor(this.originalClearColor),t.setClearAlpha(r)}renderOverride(t,e,i,s,n){t.getClearColor(this.originalClearColor);const r=t.getClearAlpha(),o=t.autoClear;t.setRenderTarget(i),t.autoClear=!1,s=e.clearColor||s,n=e.clearAlpha||n,null!=s&&(t.setClearColor(s),t.setClearAlpha(n||0),t.clear()),this.scene.overrideMaterial=e,t.render(this.scene,this.camera),this.scene.overrideMaterial=null,t.autoClear=o,t.setClearColor(this.originalClearColor),t.setClearAlpha(r)}setSize(t,e){this.width=t,this.height=e,this.beautyRenderTarget.setSize(t,e),this.ssaoRenderTarget.setSize(t,e),this.normalRenderTarget.setSize(t,e),this.blurRenderTarget.setSize(t,e),this.ssaoMaterial.uniforms.resolution.value.set(t,e),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(t,e)}generateSampleKernel(){const t=this.kernelSize,i=this.kernel;for(let s=0;s<t;s++){const n=new e.Vector3;n.x=2*Math.random()-1,n.y=2*Math.random()-1,n.z=Math.random(),n.normalize();let r=s/t;r=e.MathUtils.lerp(.1,1,r*r),n.multiplyScalar(r),i.push(n)}}generateRandomKernelRotations(){void 0===xS&&console.error("THREE.SSAOPass: The pass relies on SimplexNoise.");const t=new xS,i=new Float32Array(64);for(let e=0;e<16;e++){const s=4*e,n=2*Math.random()-1,r=2*Math.random()-1,o=0,a=t.noise3d(n,r,o);i[s]=a,i[s+1]=a,i[s+2]=a,i[s+3]=1}this.noiseTexture=new e.DataTexture(i,4,4,e.RGBAFormat,e.FloatType),this.noiseTexture.wrapS=e.RepeatWrapping,this.noiseTexture.wrapT=e.RepeatWrapping}overrideVisibility(){const t=this.scene,e=this._visibilityCache;t.traverse((function(t){e.set(t,t.visible),(t.isPoints||t.isLine)&&(t.visible=!1)}))}restoreVisibility(){const t=this.scene,e=this._visibilityCache;t.traverse((function(t){const i=e.get(t);t.visible=i})),e.clear()}setBeautyTarget(t){this.beautyRenderTarget=t}setNormalTarget(t){this.normalRenderTarget=t}setDepthTarget(t){this.depthRenderTarget=t}}kS.OUTPUT={Default:0,SSAO:1,Blur:2,Beauty:3,Depth:4,Normal:5};const AS={defines:{NUM_SAMPLES:7,NUM_RINGS:4,NORMAL_TEXTURE:0,DIFFUSE_TEXTURE:0,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new e.Vector2(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new e.Matrix4},cameraInverseProjectionMatrix:{value:new e.Matrix4},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\n\t\tvarying vec2 vUv;\n\n\t\t#if DIFFUSE_TEXTURE == 1\n\t\tuniform sampler2D tDiffuse;\n\t\t#endif\n\n\t\tuniform sampler2D tDepth;\n\n\t\t#if NORMAL_TEXTURE == 1\n\t\tuniform sampler2D tNormal;\n\t\t#endif\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform mat4 cameraProjectionMatrix;\n\t\tuniform mat4 cameraInverseProjectionMatrix;\n\n\t\tuniform float scale;\n\t\tuniform float intensity;\n\t\tuniform float bias;\n\t\tuniform float kernelRadius;\n\t\tuniform float minResolution;\n\t\tuniform vec2 size;\n\t\tuniform float randomSeed;\n\n\t\t// RGBA depth\n\n\t\t#include <packing>\n\n\t\tvec4 getDefaultColor( const in vec2 screenPosition ) {\n\t\t\t#if DIFFUSE_TEXTURE == 1\n\t\t\treturn texture2D( tDiffuse, vUv );\n\t\t\t#else\n\t\t\treturn vec4( 1.0 );\n\t\t\t#endif\n\t\t}\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\t\t\t#if DEPTH_PACKING == 1\n\t\t\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\n\t\t\t#else\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\t\t\t#endif\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#else\n\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#endif\n\t\t}\n\n\t\tvec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {\n\t\t\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\n\t\t\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );\n\t\t\tclipPosition *= clipW; // unprojection.\n\n\t\t\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;\n\t\t}\n\n\t\tvec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {\n\t\t\t#if NORMAL_TEXTURE == 1\n\t\t\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );\n\t\t\t#else\n\t\t\treturn normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );\n\t\t\t#endif\n\t\t}\n\n\t\tfloat scaleDividedByCameraFar;\n\t\tfloat minResolutionMultipliedByCameraFar;\n\n\t\tfloat getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {\n\t\t\tvec3 viewDelta = sampleViewPosition - centerViewPosition;\n\t\t\tfloat viewDistance = length( viewDelta );\n\t\t\tfloat scaledScreenDistance = scaleDividedByCameraFar * viewDistance;\n\n\t\t\treturn max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );\n\t\t}\n\n\t\t// moving costly divides into consts\n\t\tconst float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );\n\t\tconst float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );\n\n\t\tfloat getAmbientOcclusion( const in vec3 centerViewPosition ) {\n\t\t\t// precompute some variables require in getOcclusion.\n\t\t\tscaleDividedByCameraFar = scale / cameraFar;\n\t\t\tminResolutionMultipliedByCameraFar = minResolution * cameraFar;\n\t\t\tvec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );\n\n\t\t\t// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/\n\t\t\tfloat angle = rand( vUv + randomSeed ) * PI2;\n\t\t\tvec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;\n\t\t\tvec2 radiusStep = radius;\n\n\t\t\tfloat occlusionSum = 0.0;\n\t\t\tfloat weightSum = 0.0;\n\n\t\t\tfor( int i = 0; i < NUM_SAMPLES; i ++ ) {\n\t\t\t\tvec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;\n\t\t\t\tradius += radiusStep;\n\t\t\t\tangle += ANGLE_STEP;\n\n\t\t\t\tfloat sampleDepth = getDepth( sampleUv );\n\t\t\t\tif( sampleDepth >= ( 1.0 - EPSILON ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfloat sampleViewZ = getViewZ( sampleDepth );\n\t\t\t\tvec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );\n\t\t\t\tocclusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );\n\t\t\t\tweightSum += 1.0;\n\t\t\t}\n\n\t\t\tif( weightSum == 0.0 ) discard;\n\n\t\t\treturn occlusionSum * ( intensity / weightSum );\n\t\t}\n\n\t\tvoid main() {\n\t\t\tfloat centerDepth = getDepth( vUv );\n\t\t\tif( centerDepth >= ( 1.0 - EPSILON ) ) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat centerViewZ = getViewZ( centerDepth );\n\t\t\tvec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );\n\n\t\t\tfloat ambientOcclusion = getAmbientOcclusion( viewPosition );\n\n\t\t\tgl_FragColor = getDefaultColor( vUv );\n\t\t\tgl_FragColor.xyz *=  1.0 - ambientOcclusion;\n\t\t}"},TS={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new e.Vector2(512,512)},sampleUvOffsets:{value:[new e.Vector2(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:"\n\n\t\t#include <common>\n\n\t\tuniform vec2 size;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec2 vInvSize;\n\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tvInvSize = 1.0 / size;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\t\t#include <packing>\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tDepth;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform float depthCutoff;\n\n\t\tuniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];\n\t\tuniform float sampleWeights[ KERNEL_RADIUS + 1 ];\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec2 vInvSize;\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\t\t\t#if DEPTH_PACKING == 1\n\t\t\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\n\t\t\t#else\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\t\t\t#endif\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#else\n\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#endif\n\t\t}\n\n\t\tvoid main() {\n\t\t\tfloat depth = getDepth( vUv );\n\t\t\tif( depth >= ( 1.0 - EPSILON ) ) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat centerViewZ = -getViewZ( depth );\n\t\t\tbool rBreak = false, lBreak = false;\n\n\t\t\tfloat weightSum = sampleWeights[0];\n\t\t\tvec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;\n\n\t\t\tfor( int i = 1; i <= KERNEL_RADIUS; i ++ ) {\n\n\t\t\t\tfloat sampleWeight = sampleWeights[i];\n\t\t\t\tvec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;\n\n\t\t\t\tvec2 sampleUv = vUv + sampleUvOffset;\n\t\t\t\tfloat viewZ = -getViewZ( getDepth( sampleUv ) );\n\n\t\t\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;\n\n\t\t\t\tif( ! rBreak ) {\n\t\t\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;\n\t\t\t\t\tweightSum += sampleWeight;\n\t\t\t\t}\n\n\t\t\t\tsampleUv = vUv - sampleUvOffset;\n\t\t\t\tviewZ = -getViewZ( getDepth( sampleUv ) );\n\n\t\t\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;\n\n\t\t\t\tif( ! lBreak ) {\n\t\t\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;\n\t\t\t\t\tweightSum += sampleWeight;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tgl_FragColor = diffuseSum / weightSum;\n\t\t}"},MS={createSampleWeights:function(t,e){const i=[];for(let s=0;s<=t;s++)i.push(PS(s,e));return i},createSampleOffsets:function(t,e){const i=[];for(let s=0;s<=t;s++)i.push(e.clone().multiplyScalar(s));return i},configure:function(t,e,i,s){t.defines.KERNEL_RADIUS=e,t.uniforms.sampleUvOffsets.value=MS.createSampleOffsets(e,s),t.uniforms.sampleWeights.value=MS.createSampleWeights(e,i),t.needsUpdate=!0}};function PS(t,e){return Math.exp(-t*t/(e*e*2))/(Math.sqrt(2*Math.PI)*e)}const CS={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );\n\t\t\tgl_FragColor = vec4( vec3( depth ), opacity );\n\n\t\t}"};class _S extends nS{constructor(t,i,s=!1,n=!1,r=new e.Vector2(256,256)){let o;super(),this.scene=t,this.camera=i,this.clear=!0,this.needsSwap=!1,this.isDirectDepth=!1,this.isDirectNormal=!1,this.supportsDepthTextureExtension=s,this.supportsNormalTexture=n,this.originalClearColor=new e.Color,this._oldClearColor=new e.Color,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=new e.Vector2(r.x,r.y),this.saoRenderTarget=new e.WebGLRenderTarget(this.resolution.x,this.resolution.y,{minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBAFormat}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone(),this.beautyRenderTarget=this.saoRenderTarget.clone(),this.normalRenderTarget=new e.WebGLRenderTarget(this.resolution.x,this.resolution.y,{minFilter:e.NearestFilter,magFilter:e.NearestFilter,format:e.RGBAFormat}),this.depthRenderTarget=this.normalRenderTarget.clone(),this.supportsDepthTextureExtension&&(o=new e.DepthTexture,o.type=e.UnsignedShortType,this.beautyRenderTarget.depthTexture=o,this.beautyRenderTarget.depthBuffer=!0),this.depthMaterial=new e.MeshDepthMaterial,this.depthMaterial.depthPacking=e.RGBADepthPacking,this.depthMaterial.blending=e.NoBlending,this.normalMaterial=new e.MeshNormalMaterial,this.normalMaterial.blending=e.NoBlending,void 0===AS&&console.error("THREE.SAOPass relies on SAOShader"),this.saoMaterial=new e.ShaderMaterial({defines:Object.assign({},AS.defines),fragmentShader:AS.fragmentShader,vertexShader:AS.vertexShader,uniforms:e.UniformsUtils.clone(AS.uniforms)}),this.saoMaterial.extensions.derivatives=!0,this.saoMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.saoMaterial.defines.NORMAL_TEXTURE=this.supportsNormalTexture?1:0,this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?o:this.depthRenderTarget.texture,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=e.NoBlending,void 0===TS&&console.error("THREE.SAOPass relies on DepthLimitedBlurShader"),this.vBlurMaterial=new e.ShaderMaterial({uniforms:e.UniformsUtils.clone(TS.uniforms),defines:Object.assign({},TS.defines),vertexShader:TS.vertexShader,fragmentShader:TS.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?o:this.depthRenderTarget.texture,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=e.NoBlending,this.hBlurMaterial=new e.ShaderMaterial({uniforms:e.UniformsUtils.clone(TS.uniforms),defines:Object.assign({},TS.defines),vertexShader:TS.vertexShader,fragmentShader:TS.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?o:this.depthRenderTarget.texture,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=e.NoBlending,void 0===sS&&console.error("THREE.SAOPass relies on CopyShader"),this.materialCopy=new e.ShaderMaterial({uniforms:e.UniformsUtils.clone(sS.uniforms),vertexShader:sS.vertexShader,fragmentShader:sS.fragmentShader,blending:e.NoBlending}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=e.CustomBlending,this.materialCopy.blendSrc=e.DstColorFactor,this.materialCopy.blendDst=e.ZeroFactor,this.materialCopy.blendEquation=e.AddEquation,this.materialCopy.blendSrcAlpha=e.DstAlphaFactor,this.materialCopy.blendDstAlpha=e.ZeroFactor,this.materialCopy.blendEquationAlpha=e.AddEquation,void 0===CS&&console.error("THREE.SAOPass relies on UnpackDepthRGBAShader"),this.depthCopy=new e.ShaderMaterial({uniforms:e.UniformsUtils.clone(CS.uniforms),vertexShader:CS.vertexShader,fragmentShader:CS.fragmentShader,blending:e.NoBlending}),this.fsQuad=new aS(null),this.applyValue()}applyValue(){let t=this.saoMaterial.uniforms;t.bias.value=this.params.saoBias,t.intensity.value=this.params.saoIntensity,t.scale.value=this.params.saoScale,t.kernelRadius.value=this.params.saoKernelRadius,t.minResolution.value=this.params.saoMinResolution,t.cameraNear.value=this.camera.near,t.cameraFar.value=this.camera.far;const i=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);t=this.vBlurMaterial.uniforms,t.depthCutoff.value=i,t.cameraNear.value=this.camera.near,t.cameraFar.value=this.camera.far,t=this.hBlurMaterial.uniforms,t.depthCutoff.value=i,t.cameraNear.value=this.camera.near,t.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),this.prevStdDev===this.params.saoBlurStdDev&&this.prevNumSamples===this.params.saoBlurRadius||(MS.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new e.Vector2(0,1)),MS.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new e.Vector2(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius)}render(t,i,s){if(this.renderToScreen&&(this.materialCopy.blending=e.NoBlending,this.materialCopy.uniforms.tDiffuse.value=s.texture,this.materialCopy.needsUpdate=!0,this.renderPass(t,this.materialCopy,null)),1===this.params.output)return;t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const n=t.autoClear;t.autoClear=!1,t.setRenderTarget(this.depthRenderTarget),t.clear(),this.isDirectDepth||(t.setClearColor(0),t.setRenderTarget(this.beautyRenderTarget),t.clear(),t.render(this.scene,this.camera),this.supportsDepthTextureExtension||this.renderOverride(t,this.depthMaterial,this.depthRenderTarget,0,1)),this.supportsNormalTexture&&(this.isDirectNormal||this.renderOverride(t,this.normalMaterial,this.normalRenderTarget,7829503,1)),this.renderPass(t,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(t,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(t,this.hBlurMaterial,this.saoRenderTarget,16777215,1));let r=this.materialCopy;3===this.params.output?this.supportsDepthTextureExtension?(this.materialCopy.uniforms.tDiffuse.value=this.beautyRenderTarget.depthTexture,this.materialCopy.needsUpdate=!0):(this.depthCopy.uniforms.tDiffuse.value=this.depthRenderTarget.texture,this.depthCopy.needsUpdate=!0,r=this.depthCopy):4===this.params.output?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),0===this.params.output?r.blending=e.CustomBlending:r.blending=e.NoBlending,this.renderPass(t,r,this.renderToScreen?null:s),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=n}renderPass(t,e,i,s,n){t.getClearColor(this.originalClearColor);const r=t.getClearAlpha(),o=t.autoClear;t.setRenderTarget(i),t.autoClear=!1,null!=s&&(t.setClearColor(s),t.setClearAlpha(n||0),t.clear()),this.fsQuad.material=e,this.fsQuad.render(t),t.autoClear=o,t.setClearColor(this.originalClearColor),t.setClearAlpha(r)}renderOverride(t,e,i,s,n){t.getClearColor(this.originalClearColor);const r=t.getClearAlpha(),o=t.autoClear;t.setRenderTarget(i),t.autoClear=!1,s=e.clearColor||s,n=e.clearAlpha||n,null!=s&&(t.setClearColor(s),t.setClearAlpha(n||0),t.clear()),this.scene.overrideMaterial=e,t.render(this.scene,this.camera),this.scene.overrideMaterial=null,t.autoClear=o,t.setClearColor(this.originalClearColor),t.setClearAlpha(r)}setSize(t,e){this.beautyRenderTarget.setSize(t,e),this.saoRenderTarget.setSize(t,e),this.blurIntermediateRenderTarget.setSize(t,e),this.normalRenderTarget.setSize(t,e),this.depthRenderTarget.setSize(t,e),this.saoMaterial.uniforms.size.value.set(t,e),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(t,e),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(t,e),this.hBlurMaterial.needsUpdate=!0}setNormalTarget(t){this.isDirectNormal=!0,this.normalRenderTarget=t,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture}setDepthTarget(t){this.supportsDepthTextureExtension||(this.isDirectDepth=!0,this.depthRenderTarget=t,this.saoMaterial.uniforms.tDepth.value=this.depthRenderTarget.texture)}}_S.OUTPUT={Beauty:1,Default:0,SAO:2,Depth:3,Normal:4};const RS={uniforms:{tDiffuse:{value:null},resolution:{value:new e.Vector2(1/1024,1/512)}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:'\n\n\t\tprecision highp float;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\n\t\t#define FXAA_PC 1\n\t\t#define FXAA_GLSL_100 1\n\t\t#define FXAA_QUALITY_PRESET 12\n\n\t\t#define FXAA_GREEN_AS_LUMA 1\n\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_PC_CONSOLE\n\t\t\t\t//\n\t\t\t\t// The console algorithm for PC is included\n\t\t\t\t// for developers targeting really low spec machines.\n\t\t\t\t// Likely better to just run FXAA_PC, and use a really low preset.\n\t\t\t\t//\n\t\t\t\t#define FXAA_PC_CONSOLE 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GLSL_120\n\t\t\t\t#define FXAA_GLSL_120 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GLSL_130\n\t\t\t\t#define FXAA_GLSL_130 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_3\n\t\t\t\t#define FXAA_HLSL_3 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_4\n\t\t\t\t#define FXAA_HLSL_4 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_5\n\t\t\t\t#define FXAA_HLSL_5 0\n\t\t#endif\n\t\t/*==========================================================================*/\n\t\t#ifndef FXAA_GREEN_AS_LUMA\n\t\t\t\t//\n\t\t\t\t// For those using non-linear color,\n\t\t\t\t// and either not able to get luma in alpha, or not wanting to,\n\t\t\t\t// this enables FXAA to run using green as a proxy for luma.\n\t\t\t\t// So with this enabled, no need to pack luma in alpha.\n\t\t\t\t//\n\t\t\t\t// This will turn off AA on anything which lacks some amount of green.\n\t\t\t\t// Pure red and blue or combination of only R and B, will get no AA.\n\t\t\t\t//\n\t\t\t\t// Might want to lower the settings for both,\n\t\t\t\t//\t\tfxaaConsoleEdgeThresholdMin\n\t\t\t\t//\t\tfxaaQualityEdgeThresholdMin\n\t\t\t\t// In order to insure AA does not get turned off on colors\n\t\t\t\t// which contain a minor amount of green.\n\t\t\t\t//\n\t\t\t\t// 1 = On.\n\t\t\t\t// 0 = Off.\n\t\t\t\t//\n\t\t\t\t#define FXAA_GREEN_AS_LUMA 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_EARLY_EXIT\n\t\t\t\t//\n\t\t\t\t// Controls algorithm\'s early exit path.\n\t\t\t\t// On PS3 turning this ON adds 2 cycles to the shader.\n\t\t\t\t// On 360 turning this OFF adds 10ths of a millisecond to the shader.\n\t\t\t\t// Turning this off on console will result in a more blurry image.\n\t\t\t\t// So this defaults to on.\n\t\t\t\t//\n\t\t\t\t// 1 = On.\n\t\t\t\t// 0 = Off.\n\t\t\t\t//\n\t\t\t\t#define FXAA_EARLY_EXIT 1\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_DISCARD\n\t\t\t\t//\n\t\t\t\t// Only valid for PC OpenGL currently.\n\t\t\t\t// Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n\t\t\t\t//\n\t\t\t\t// 1 = Use discard on pixels which don\'t need AA.\n\t\t\t\t//\t\t For APIs which enable concurrent TEX+ROP from same surface.\n\t\t\t\t// 0 = Return unchanged color on pixels which don\'t need AA.\n\t\t\t\t//\n\t\t\t\t#define FXAA_DISCARD 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_FAST_PIXEL_OFFSET\n\t\t\t\t//\n\t\t\t\t// Used for GLSL 120 only.\n\t\t\t\t//\n\t\t\t\t// 1 = GL API supports fast pixel offsets\n\t\t\t\t// 0 = do not use fast pixel offsets\n\t\t\t\t//\n\t\t\t\t#ifdef GL_EXT_gpu_shader4\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_NV_gpu_shader5\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_ARB_gpu_shader5\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifndef FXAA_FAST_PIXEL_OFFSET\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 0\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GATHER4_ALPHA\n\t\t\t\t//\n\t\t\t\t// 1 = API supports gather4 on alpha channel.\n\t\t\t\t// 0 = API does not support gather4 on alpha channel.\n\t\t\t\t//\n\t\t\t\t#if (FXAA_HLSL_5 == 1)\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_ARB_gpu_shader5\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_NV_gpu_shader5\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifndef FXAA_GATHER4_ALPHA\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 0\n\t\t\t\t#endif\n\t\t#endif\n\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tFXAA QUALITY - TUNING KNOBS\n\t\t------------------------------------------------------------------------------\n\t\tNOTE the other tuning knobs are now in the shader function inputs!\n\t\t============================================================================*/\n\t\t#ifndef FXAA_QUALITY_PRESET\n\t\t\t\t//\n\t\t\t\t// Choose the quality preset.\n\t\t\t\t// This needs to be compiled into the shader as it effects code.\n\t\t\t\t// Best option to include multiple presets is to\n\t\t\t\t// in each shader define the preset, then include this file.\n\t\t\t\t//\n\t\t\t\t// OPTIONS\n\t\t\t\t// -----------------------------------------------------------------------\n\t\t\t\t// 10 to 15 - default medium dither (10=fastest, 15=highest quality)\n\t\t\t\t// 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\n\t\t\t\t// 39\t\t\t - no dither, very expensive\n\t\t\t\t//\n\t\t\t\t// NOTES\n\t\t\t\t// -----------------------------------------------------------------------\n\t\t\t\t// 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\n\t\t\t\t// 13 = about same speed as FXAA 3.9 and better than 12\n\t\t\t\t// 23 = closest to FXAA 3.9 visually and performance wise\n\t\t\t\t//\t_ = the lowest digit is directly related to performance\n\t\t\t\t// _\t= the highest digit is directly related to style\n\t\t\t\t//\n\t\t\t\t#define FXAA_QUALITY_PRESET 12\n\t\t#endif\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - PRESETS\n\n\t\t============================================================================*/\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - MEDIUM DITHER PRESETS\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 10)\n\t\t\t\t#define FXAA_QUALITY_PS 3\n\t\t\t\t#define FXAA_QUALITY_P0 1.5\n\t\t\t\t#define FXAA_QUALITY_P1 3.0\n\t\t\t\t#define FXAA_QUALITY_P2 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 11)\n\t\t\t\t#define FXAA_QUALITY_PS 4\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 3.0\n\t\t\t\t#define FXAA_QUALITY_P3 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 12)\n\t\t\t\t#define FXAA_QUALITY_PS 5\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 4.0\n\t\t\t\t#define FXAA_QUALITY_P4 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 13)\n\t\t\t\t#define FXAA_QUALITY_PS 6\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 4.0\n\t\t\t\t#define FXAA_QUALITY_P5 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 14)\n\t\t\t\t#define FXAA_QUALITY_PS 7\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 4.0\n\t\t\t\t#define FXAA_QUALITY_P6 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 15)\n\t\t\t\t#define FXAA_QUALITY_PS 8\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 4.0\n\t\t\t\t#define FXAA_QUALITY_P7 12.0\n\t\t#endif\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - LOW DITHER PRESETS\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 20)\n\t\t\t\t#define FXAA_QUALITY_PS 3\n\t\t\t\t#define FXAA_QUALITY_P0 1.5\n\t\t\t\t#define FXAA_QUALITY_P1 2.0\n\t\t\t\t#define FXAA_QUALITY_P2 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 21)\n\t\t\t\t#define FXAA_QUALITY_PS 4\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 22)\n\t\t\t\t#define FXAA_QUALITY_PS 5\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 23)\n\t\t\t\t#define FXAA_QUALITY_PS 6\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 24)\n\t\t\t\t#define FXAA_QUALITY_PS 7\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 3.0\n\t\t\t\t#define FXAA_QUALITY_P6 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 25)\n\t\t\t\t#define FXAA_QUALITY_PS 8\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 4.0\n\t\t\t\t#define FXAA_QUALITY_P7 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 26)\n\t\t\t\t#define FXAA_QUALITY_PS 9\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 4.0\n\t\t\t\t#define FXAA_QUALITY_P8 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 27)\n\t\t\t\t#define FXAA_QUALITY_PS 10\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 4.0\n\t\t\t\t#define FXAA_QUALITY_P9 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 28)\n\t\t\t\t#define FXAA_QUALITY_PS 11\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 4.0\n\t\t\t\t#define FXAA_QUALITY_P10 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 29)\n\t\t\t\t#define FXAA_QUALITY_PS 12\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 2.0\n\t\t\t\t#define FXAA_QUALITY_P10 4.0\n\t\t\t\t#define FXAA_QUALITY_P11 8.0\n\t\t#endif\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - EXTREME QUALITY\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 39)\n\t\t\t\t#define FXAA_QUALITY_PS 12\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.0\n\t\t\t\t#define FXAA_QUALITY_P2 1.0\n\t\t\t\t#define FXAA_QUALITY_P3 1.0\n\t\t\t\t#define FXAA_QUALITY_P4 1.0\n\t\t\t\t#define FXAA_QUALITY_P5 1.5\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 2.0\n\t\t\t\t#define FXAA_QUALITY_P10 4.0\n\t\t\t\t#define FXAA_QUALITY_P11 8.0\n\t\t#endif\n\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAPI PORTING\n\n\t\t============================================================================*/\n\t\t#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\n\t\t\t\t#define FxaaBool bool\n\t\t\t\t#define FxaaDiscard discard\n\t\t\t\t#define FxaaFloat float\n\t\t\t\t#define FxaaFloat2 vec2\n\t\t\t\t#define FxaaFloat3 vec3\n\t\t\t\t#define FxaaFloat4 vec4\n\t\t\t\t#define FxaaHalf float\n\t\t\t\t#define FxaaHalf2 vec2\n\t\t\t\t#define FxaaHalf3 vec3\n\t\t\t\t#define FxaaHalf4 vec4\n\t\t\t\t#define FxaaInt2 ivec2\n\t\t\t\t#define FxaaSat(x) clamp(x, 0.0, 1.0)\n\t\t\t\t#define FxaaTex sampler2D\n\t\t#else\n\t\t\t\t#define FxaaBool bool\n\t\t\t\t#define FxaaDiscard clip(-1)\n\t\t\t\t#define FxaaFloat float\n\t\t\t\t#define FxaaFloat2 float2\n\t\t\t\t#define FxaaFloat3 float3\n\t\t\t\t#define FxaaFloat4 float4\n\t\t\t\t#define FxaaHalf half\n\t\t\t\t#define FxaaHalf2 half2\n\t\t\t\t#define FxaaHalf3 half3\n\t\t\t\t#define FxaaHalf4 half4\n\t\t\t\t#define FxaaSat(x) saturate(x)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t#define FxaaTexTop(t, p) texture2D(t, p, 0.0)\n\t\t\t#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_120 == 1)\n\t\t\t\t// Requires,\n\t\t\t\t//\t#version 120\n\t\t\t\t// And at least,\n\t\t\t\t//\t#extension GL_EXT_gpu_shader4 : enable\n\t\t\t\t//\t(or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)\n\t\t\t\t#define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\n\t\t\t\t#if (FXAA_FAST_PIXEL_OFFSET == 1)\n\t\t\t\t\t\t#define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)\n\t\t\t\t#else\n\t\t\t\t\t\t#define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\n\t\t\t\t#endif\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t// use #extension GL_ARB_gpu_shader5 : enable\n\t\t\t\t\t\t#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n\t\t\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n\t\t\t\t\t\t#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n\t\t\t\t\t\t#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_130 == 1)\n\t\t\t\t// Requires "#version 130" or better\n\t\t\t\t#define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t// use #extension GL_ARB_gpu_shader5 : enable\n\t\t\t\t\t\t#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n\t\t\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n\t\t\t\t\t\t#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n\t\t\t\t\t\t#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_3 == 1)\n\t\t\t\t#define FxaaInt2 float2\n\t\t\t\t#define FxaaTex sampler2D\n\t\t\t\t#define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))\n\t\t\t\t#define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_4 == 1)\n\t\t\t\t#define FxaaInt2 int2\n\t\t\t\tstruct FxaaTex { SamplerState smpl; Texture2D tex; };\n\t\t\t\t#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_5 == 1)\n\t\t\t\t#define FxaaInt2 int2\n\t\t\t\tstruct FxaaTex { SamplerState smpl; Texture2D tex; };\n\t\t\t\t#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n\t\t\t\t#define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)\n\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)\n\t\t\t\t#define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)\n\t\t\t\t#define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)\n\t\t#endif\n\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t GREEN AS LUMA OPTION SUPPORT FUNCTION\n\t\t============================================================================*/\n\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\tFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }\n\t\t#else\n\t\t\t\tFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n\t\t#endif\n\n\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t FXAA3 QUALITY - PC\n\n\t\t============================================================================*/\n\t\t#if (FXAA_PC == 1)\n\t\t/*--------------------------------------------------------------------------*/\n\t\tFxaaFloat4 FxaaPixelShader(\n\t\t\t\t//\n\t\t\t\t// Use noperspective interpolation here (turn off perspective interpolation).\n\t\t\t\t// {xy} = center of pixel\n\t\t\t\tFxaaFloat2 pos,\n\t\t\t\t//\n\t\t\t\t// Used only for FXAA Console, and not used on the 360 version.\n\t\t\t\t// Use noperspective interpolation here (turn off perspective interpolation).\n\t\t\t\t// {xy_} = upper left of pixel\n\t\t\t\t// {_zw} = lower right of pixel\n\t\t\t\tFxaaFloat4 fxaaConsolePosPos,\n\t\t\t\t//\n\t\t\t\t// Input color texture.\n\t\t\t\t// {rgb_} = color in linear or perceptual color space\n\t\t\t\t// if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t//\t\t {__a} = luma in perceptual color space (not linear)\n\t\t\t\tFxaaTex tex,\n\t\t\t\t//\n\t\t\t\t// Only used on the optimized 360 version of FXAA Console.\n\t\t\t\t// For everything but 360, just use the same input here as for "tex".\n\t\t\t\t// For 360, same texture, just alias with a 2nd sampler.\n\t\t\t\t// This sampler needs to have an exponent bias of -1.\n\t\t\t\tFxaaTex fxaaConsole360TexExpBiasNegOne,\n\t\t\t\t//\n\t\t\t\t// Only used on the optimized 360 version of FXAA Console.\n\t\t\t\t// For everything but 360, just use the same input here as for "tex".\n\t\t\t\t// For 360, same texture, just alias with a 3nd sampler.\n\t\t\t\t// This sampler needs to have an exponent bias of -2.\n\t\t\t\tFxaaTex fxaaConsole360TexExpBiasNegTwo,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x_} = 1.0/screenWidthInPixels\n\t\t\t\t// {_y} = 1.0/screenHeightInPixels\n\t\t\t\tFxaaFloat2 fxaaQualityRcpFrame,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// This effects sub-pixel AA quality and inversely sharpness.\n\t\t\t\t//\t Where N ranges between,\n\t\t\t\t//\t\t N = 0.50 (default)\n\t\t\t\t//\t\t N = 0.33 (sharper)\n\t\t\t\t// {x__} = -N/screenWidthInPixels\n\t\t\t\t// {_y_} = -N/screenHeightInPixels\n\t\t\t\t// {_z_} =\tN/screenWidthInPixels\n\t\t\t\t// {__w} =\tN/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsoleRcpFrameOpt,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// Not used on 360, but used on PS3 and PC.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x__} = -2.0/screenWidthInPixels\n\t\t\t\t// {_y_} = -2.0/screenHeightInPixels\n\t\t\t\t// {_z_} =\t2.0/screenWidthInPixels\n\t\t\t\t// {__w} =\t2.0/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsoleRcpFrameOpt2,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// Only used on 360 in place of fxaaConsoleRcpFrameOpt2.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x__} =\t8.0/screenWidthInPixels\n\t\t\t\t// {_y_} =\t8.0/screenHeightInPixels\n\t\t\t\t// {_z_} = -4.0/screenWidthInPixels\n\t\t\t\t// {__w} = -4.0/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsole360RcpFrameOpt2,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_SUBPIX define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Choose the amount of sub-pixel aliasing removal.\n\t\t\t\t// This can effect sharpness.\n\t\t\t\t//\t 1.00 - upper limit (softer)\n\t\t\t\t//\t 0.75 - default amount of filtering\n\t\t\t\t//\t 0.50 - lower limit (sharper, less sub-pixel aliasing removal)\n\t\t\t\t//\t 0.25 - almost off\n\t\t\t\t//\t 0.00 - completely off\n\t\t\t\tFxaaFloat fxaaQualitySubpix,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// The minimum amount of local contrast required to apply algorithm.\n\t\t\t\t//\t 0.333 - too little (faster)\n\t\t\t\t//\t 0.250 - low quality\n\t\t\t\t//\t 0.166 - default\n\t\t\t\t//\t 0.125 - high quality\n\t\t\t\t//\t 0.063 - overkill (slower)\n\t\t\t\tFxaaFloat fxaaQualityEdgeThreshold,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Trims the algorithm from processing darks.\n\t\t\t\t//\t 0.0833 - upper limit (default, the start of visible unfiltered edges)\n\t\t\t\t//\t 0.0625 - high quality (faster)\n\t\t\t\t//\t 0.0312 - visible limit (slower)\n\t\t\t\t// Special notes when using FXAA_GREEN_AS_LUMA,\n\t\t\t\t//\t Likely want to set this to zero.\n\t\t\t\t//\t As colors that are mostly not-green\n\t\t\t\t//\t will appear very dark in the green channel!\n\t\t\t\t//\t Tune by looking at mostly non-green content,\n\t\t\t\t//\t then start at zero and increase until aliasing is a problem.\n\t\t\t\tFxaaFloat fxaaQualityEdgeThresholdMin,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// This does not effect PS3, as this needs to be compiled in.\n\t\t\t\t//\t Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.\n\t\t\t\t//\t Due to the PS3 being ALU bound,\n\t\t\t\t//\t there are only three safe values here: 2 and 4 and 8.\n\t\t\t\t//\t These options use the shaders ability to a free *|/ by 2|4|8.\n\t\t\t\t// For all other platforms can be a non-power of two.\n\t\t\t\t//\t 8.0 is sharper (default!!!)\n\t\t\t\t//\t 4.0 is softer\n\t\t\t\t//\t 2.0 is really soft (good only for vector graphics inputs)\n\t\t\t\tFxaaFloat fxaaConsoleEdgeSharpness,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// This does not effect PS3, as this needs to be compiled in.\n\t\t\t\t//\t Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.\n\t\t\t\t//\t Due to the PS3 being ALU bound,\n\t\t\t\t//\t there are only two safe values here: 1/4 and 1/8.\n\t\t\t\t//\t These options use the shaders ability to a free *|/ by 2|4|8.\n\t\t\t\t// The console setting has a different mapping than the quality setting.\n\t\t\t\t// Other platforms can use other values.\n\t\t\t\t//\t 0.125 leaves less aliasing, but is softer (default!!!)\n\t\t\t\t//\t 0.25 leaves more aliasing, and is sharper\n\t\t\t\tFxaaFloat fxaaConsoleEdgeThreshold,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Trims the algorithm from processing darks.\n\t\t\t\t// The console setting has a different mapping than the quality setting.\n\t\t\t\t// This only applies when FXAA_EARLY_EXIT is 1.\n\t\t\t\t// This does not apply to PS3,\n\t\t\t\t// PS3 was simplified to avoid more shader instructions.\n\t\t\t\t//\t 0.06 - faster but more aliasing in darks\n\t\t\t\t//\t 0.05 - default\n\t\t\t\t//\t 0.04 - slower and less aliasing in darks\n\t\t\t\t// Special notes when using FXAA_GREEN_AS_LUMA,\n\t\t\t\t//\t Likely want to set this to zero.\n\t\t\t\t//\t As colors that are mostly not-green\n\t\t\t\t//\t will appear very dark in the green channel!\n\t\t\t\t//\t Tune by looking at mostly non-green content,\n\t\t\t\t//\t then start at zero and increase until aliasing is a problem.\n\t\t\t\tFxaaFloat fxaaConsoleEdgeThresholdMin,\n\t\t\t\t//\n\t\t\t\t// Extra constants for 360 FXAA Console only.\n\t\t\t\t// Use zeros or anything else for other platforms.\n\t\t\t\t// These must be in physical constant registers and NOT immediates.\n\t\t\t\t// Immediates will result in compiler un-optimizing.\n\t\t\t\t// {xyzw} = float4(1.0, -1.0, 0.25, -0.25)\n\t\t\t\tFxaaFloat4 fxaaConsole360ConstDir\n\t\t) {\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posM;\n\t\t\t\tposM.x = pos.x;\n\t\t\t\tposM.y = pos.y;\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t#if (FXAA_DISCARD == 0)\n\t\t\t\t\t\t\t\tFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n\t\t\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\t\t\t#define lumaM rgbyM.w\n\t\t\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t\t\t#define lumaM rgbyM.y\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\t\t\t#define lumaM luma4A.w\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#define lumaE luma4A.z\n\t\t\t\t\t\t#define lumaS luma4A.x\n\t\t\t\t\t\t#define lumaSE luma4A.y\n\t\t\t\t\t\t#define lumaNW luma4B.w\n\t\t\t\t\t\t#define lumaN luma4B.z\n\t\t\t\t\t\t#define lumaW luma4B.x\n\t\t\t\t#else\n\t\t\t\t\t\tFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\t#define lumaM rgbyM.w\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t#define lumaM rgbyM.y\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t\t\t\t\tFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#endif\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat maxSM = max(lumaS, lumaM);\n\t\t\t\tFxaaFloat minSM = min(lumaS, lumaM);\n\t\t\t\tFxaaFloat maxESM = max(lumaE, maxSM);\n\t\t\t\tFxaaFloat minESM = min(lumaE, minSM);\n\t\t\t\tFxaaFloat maxWN = max(lumaN, lumaW);\n\t\t\t\tFxaaFloat minWN = min(lumaN, lumaW);\n\t\t\t\tFxaaFloat rangeMax = max(maxWN, maxESM);\n\t\t\t\tFxaaFloat rangeMin = min(minWN, minESM);\n\t\t\t\tFxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n\t\t\t\tFxaaFloat range = rangeMax - rangeMin;\n\t\t\t\tFxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n\t\t\t\tFxaaBool earlyExit = range < rangeMaxClamped;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(earlyExit)\n\t\t\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\t\t\tFxaaDiscard;\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\treturn rgbyM;\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 0)\n\t\t\t\t\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t\t\t\t\tFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#endif\n\t\t\t\t#else\n\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNS = lumaN + lumaS;\n\t\t\t\tFxaaFloat lumaWE = lumaW + lumaE;\n\t\t\t\tFxaaFloat subpixRcpRange = 1.0/range;\n\t\t\t\tFxaaFloat subpixNSWE = lumaNS + lumaWE;\n\t\t\t\tFxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n\t\t\t\tFxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNESE = lumaNE + lumaSE;\n\t\t\t\tFxaaFloat lumaNWNE = lumaNW + lumaNE;\n\t\t\t\tFxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n\t\t\t\tFxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNWSW = lumaNW + lumaSW;\n\t\t\t\tFxaaFloat lumaSWSE = lumaSW + lumaSE;\n\t\t\t\tFxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n\t\t\t\tFxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n\t\t\t\tFxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n\t\t\t\tFxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n\t\t\t\tFxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n\t\t\t\tFxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n\t\t\t\tFxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n\t\t\t\tFxaaBool horzSpan = edgeHorz >= edgeVert;\n\t\t\t\tFxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(!horzSpan) lumaN = lumaW;\n\t\t\t\tif(!horzSpan) lumaS = lumaE;\n\t\t\t\tif(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n\t\t\t\tFxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat gradientN = lumaN - lumaM;\n\t\t\t\tFxaaFloat gradientS = lumaS - lumaM;\n\t\t\t\tFxaaFloat lumaNN = lumaN + lumaM;\n\t\t\t\tFxaaFloat lumaSS = lumaS + lumaM;\n\t\t\t\tFxaaBool pairN = abs(gradientN) >= abs(gradientS);\n\t\t\t\tFxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n\t\t\t\tif(pairN) lengthSign = -lengthSign;\n\t\t\t\tFxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posB;\n\t\t\t\tposB.x = posM.x;\n\t\t\t\tposB.y = posM.y;\n\t\t\t\tFxaaFloat2 offNP;\n\t\t\t\toffNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n\t\t\t\toffNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n\t\t\t\tif(!horzSpan) posB.x += lengthSign * 0.5;\n\t\t\t\tif( horzSpan) posB.y += lengthSign * 0.5;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posN;\n\t\t\t\tposN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\n\t\t\t\tposN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\n\t\t\t\tFxaaFloat2 posP;\n\t\t\t\tposP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\n\t\t\t\tposP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\n\t\t\t\tFxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\n\t\t\t\tFxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\n\t\t\t\tFxaaFloat subpixE = subpixC * subpixC;\n\t\t\t\tFxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(!pairN) lumaNN = lumaSS;\n\t\t\t\tFxaaFloat gradientScaled = gradient * 1.0/4.0;\n\t\t\t\tFxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n\t\t\t\tFxaaFloat subpixF = subpixD * subpixE;\n\t\t\t\tFxaaBool lumaMLTZero = lumaMM < 0.0;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tlumaEndN -= lumaNN * 0.5;\n\t\t\t\tlumaEndP -= lumaNN * 0.5;\n\t\t\t\tFxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\tFxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\n\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\n\t\t\t\tFxaaBool doneNP = (!doneN) || (!doneP);\n\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\n\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(doneNP) {\n\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\n\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\n\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\n\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 3)\n\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 4)\n\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 5)\n\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 6)\n\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 7)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t#if (FXAA_QUALITY_PS > 8)\n\t\t\t\tif(doneNP) {\n\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\n\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\n\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\n\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 9)\n\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 10)\n\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 11)\n\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 12)\n\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t}\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t}\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat dstN = posM.x - posN.x;\n\t\t\t\tFxaaFloat dstP = posP.x - posM.x;\n\t\t\t\tif(!horzSpan) dstN = posM.y - posN.y;\n\t\t\t\tif(!horzSpan) dstP = posP.y - posM.y;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n\t\t\t\tFxaaFloat spanLength = (dstP + dstN);\n\t\t\t\tFxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n\t\t\t\tFxaaFloat spanLengthRcp = 1.0/spanLength;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaBool directionN = dstN < dstP;\n\t\t\t\tFxaaFloat dst = min(dstN, dstP);\n\t\t\t\tFxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n\t\t\t\tFxaaFloat subpixG = subpixF * subpixF;\n\t\t\t\tFxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n\t\t\t\tFxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n\t\t\t\tFxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n\t\t\t\tif(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n\t\t\t\tif( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\treturn FxaaTexTop(tex, posM);\n\t\t\t\t#else\n\t\t\t\t\t\treturn FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n\t\t\t\t#endif\n\t\t}\n\t\t/*==========================================================================*/\n\t\t#endif\n\n\t\tvoid main() {\n\t\t\tgl_FragColor = FxaaPixelShader(\n\t\t\t\tvUv,\n\t\t\t\tvec4(0.0),\n\t\t\t\ttDiffuse,\n\t\t\t\ttDiffuse,\n\t\t\t\ttDiffuse,\n\t\t\t\tresolution,\n\t\t\t\tvec4(0.0),\n\t\t\t\tvec4(0.0),\n\t\t\t\tvec4(0.0),\n\t\t\t\t0.75,\n\t\t\t\t0.166,\n\t\t\t\t0.0833,\n\t\t\t\t0.0,\n\t\t\t\t0.0,\n\t\t\t\t0.0,\n\t\t\t\tvec4(0.0)\n\t\t\t);\n\n\t\t\t// TODO avoid querying texture twice for same texel\n\t\t\tgl_FragColor.a = texture2D(tDiffuse, vUv).a;\n\t\t}'},ES={uniforms:{tDiffuse:{value:null},bloomTexture:{value:null}},vertexShader:"\n\n        varying vec2 vUv;\n\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n        uniform sampler2D bloomTexture;\n        varying vec2 vUv;\n\n        void main() {\n            gl_FragColor = ( texture2D( tDiffuse, vUv ) + vec4( 1.0 ) * texture2D( bloomTexture, vUv ) );\n        }"};class QS extends e.Loader{load(t,i,s,n){const r=new e.FileLoader(this.manager);r.setPath(this.path),r.setResponseType("text"),r.load(t,(e=>{try{i(this.parse(e))}catch(e){n?n(e):console.error(e),this.manager.itemError(t)}}),s,n)}parse(t){t=t.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let i=null,s=null;const n=new e.Vector3(0,0,0),r=new e.Vector3(1,1,1),o=t.split(/[\n\r]+/g);let a=null,l=0;for(let t=0,e=o.length;t<e;t++){const e=o[t].trim(),h=e.split(/\s/g);switch(h[0]){case"TITLE":i=e.substring(7,e.length-1);break;case"LUT_3D_SIZE":const t=h[1];s=parseFloat(t),a=new Uint8Array(s*s*s*4);break;case"DOMAIN_MIN":n.x=parseFloat(h[1]),n.y=parseFloat(h[2]),n.z=parseFloat(h[3]);break;case"DOMAIN_MAX":r.x=parseFloat(h[1]),r.y=parseFloat(h[2]),r.z=parseFloat(h[3]);break;default:const o=parseFloat(h[0]),c=parseFloat(h[1]),u=parseFloat(h[2]);if(o>1||o<0||c>1||c<0||u>1||u<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");a[l+0]=255*o,a[l+1]=255*c,a[l+2]=255*u,a[l+3]=255,l+=4}}const h=new e.DataTexture;h.image.data=a,h.image.width=s,h.image.height=s*s,h.type=e.UnsignedByteType,h.magFilter=e.LinearFilter,h.minFilter=e.LinearFilter,h.wrapS=e.ClampToEdgeWrapping,h.wrapT=e.ClampToEdgeWrapping,h.generateMipmaps=!1,h.needsUpdate=!0;const c=new e.Data3DTexture;return c.image.data=a,c.image.width=s,c.image.height=s,c.image.depth=s,c.type=e.UnsignedByteType,c.magFilter=e.LinearFilter,c.minFilter=e.LinearFilter,c.wrapS=e.ClampToEdgeWrapping,c.wrapT=e.ClampToEdgeWrapping,c.wrapR=e.ClampToEdgeWrapping,c.generateMipmaps=!1,c.needsUpdate=!0,{title:i,size:s,domainMin:n,domainMax:r,texture:h,texture3D:c}}}class LS extends e.Loader{load(t,i,s,n){const r=new e.FileLoader(this.manager);r.setPath(this.path),r.setResponseType("text"),r.load(t,(e=>{try{i(this.parse(e))}catch(e){n?n(e):console.error(e),this.manager.itemError(t)}}),s,n)}parse(t){const i=(t=t.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim()).split(/[\n\r]+/g),s=i[0].trim().split(/\s+/g).map((t=>parseFloat(t))),n=s[1]-s[0],r=s.length;for(let t=1,e=s.length;t<e;t++)if(n!==s[t]-s[t-1])throw new Error("LUT3dlLoader: Inconsistent grid size not supported.");const o=new Array(r*r*r*4);let a=0,l=0;for(let t=1,e=i.length;t<e;t++){const e=i[t].trim().split(/\s/g),s=parseFloat(e[0]),n=parseFloat(e[1]),h=parseFloat(e[2]);l=Math.max(l,s,n,h);const c=a%r*r*r+Math.floor(a/r)%r*r+Math.floor(a/(r*r))%r;o[4*c+0]=s,o[4*c+1]=n,o[4*c+2]=h,o[4*c+3]=1,a+=1}const h=Math.ceil(Math.log2(l)),c=Math.pow(2,h);for(let t=0,e=o.length;t<e;t+=4){const e=o[t+0],i=o[t+1],s=o[t+2];o[t+0]=255*e/c,o[t+1]=255*i/c,o[t+2]=255*s/c}const u=new Uint8Array(o),d=new e.DataTexture;d.image.data=u,d.image.width=r,d.image.height=r*r,d.format=e.RGBAFormat,d.type=e.UnsignedByteType,d.magFilter=e.LinearFilter,d.minFilter=e.LinearFilter,d.wrapS=e.ClampToEdgeWrapping,d.wrapT=e.ClampToEdgeWrapping,d.generateMipmaps=!1,d.needsUpdate=!0;const p=new e.Data3DTexture;return p.image.data=u,p.image.width=r,p.image.height=r,p.image.depth=r,p.format=e.RGBAFormat,p.type=e.UnsignedByteType,p.magFilter=e.LinearFilter,p.minFilter=e.LinearFilter,p.wrapS=e.ClampToEdgeWrapping,p.wrapT=e.ClampToEdgeWrapping,p.wrapR=e.ClampToEdgeWrapping,p.generateMipmaps=!1,p.needsUpdate=!0,{size:r,texture:d,texture3D:p}}}const FS={uniforms:{tDiffuse:{value:null},strength:{value:0},height:{value:1},aspectRatio:{value:1},cylindricalRatio:{value:1}},vertexShader:"\n\n\t\tuniform float strength;          // s: 0 = perspective, 1 = stereographic\n        uniform float height;            // h: tan(verticalFOVInRadians / 2)\n        uniform float aspectRatio;       // a: screenWidth / screenHeight\n        uniform float cylindricalRatio;  // c: cylindrical distortion ratio. 1 = spherical\n\n        varying vec3 vUV;                // output to interpolate over screen\n        varying vec2 vUVDot;             // output to interpolate over screen\n\n        void main() {\n\n            gl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));\n\n            float scaledHeight = strength * height;\n            float cylAspectRatio = aspectRatio * cylindricalRatio;\n            float aspectDiagSq = aspectRatio * aspectRatio + 1.0;\n            float diagSq = scaledHeight * scaledHeight * aspectDiagSq;\n            vec2 signedUV = (2.0 * uv + vec2(-1.0, -1.0));\n\n            float z = 0.5 * sqrt(diagSq + 1.0) + 0.5;\n            float ny = (z - 1.0) / (cylAspectRatio * cylAspectRatio + 1.0);\n\n            vUVDot = sqrt(ny) * vec2(cylAspectRatio, 1.0) * signedUV;\n            vUV = vec3(0.5, 0.5, 1.0) * z + vec3(-0.5, -0.5, 0.0);\n            vUV.xy += uv;\n            \n        }",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;      // sampler of rendered scene?s render target\n        varying vec3 vUV;                // interpolated vertex output data\n        varying vec2 vUVDot;             // interpolated vertex output data\n\n        void main() {\n            vec3 uv = dot(vUVDot, vUVDot) * vec3(-0.5, -0.5, -1.0) + vUV;\n            gl_FragColor = texture2DProj(tDiffuse, uv);\n        }"},IS={uniforms:{tDiffuse:{value:null},resolution:{value:new e.Vector2},power:{value:.1},kernel:{value:[-1,-1,-1,-1,9,-1,-1,-1,-1]}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec2 resolution;\n\t\tuniform float power;\n\t\tvarying vec2 vUv;\n\t\tuniform float kernel[9];\n\n\t\tvoid main() {\n\n\t\t\tvec2 texel = vec2( 1.0 / resolution.x, 1.0 / resolution.y );\n\n\t\t\tvec2 offset[9];\n\t\t\toffset[0] = vec2(-texel.x, -texel.y);\n\t\t\toffset[1] = vec2(0.0, -texel.y);\n\t\t\toffset[2] = vec2(texel.x, -texel.y);\n\t\t\toffset[3] = vec2(-texel.x, 0.0);\n\t\t\toffset[4] = vec2(0.0, 0.0);\n\t\t\toffset[5] = vec2(texel.x, 0.0);\n\t\t\toffset[6] = vec2(-texel.x, texel.y);\n\t\t\toffset[7] = vec2(0.0, texel.y);\n\t\t\toffset[8] = vec2(texel.x, texel.y);\n\t\t   \tvec4 sum = vec4(0.0);\n\n\n\t\t   \tfor( int i=0; i<9; i++ ) sum.rgb += texture2D( tDiffuse, vUv + offset[i] ).rgb * kernel[i];\n\n\t\t   \tsum.a = 1.0;\n\n\t\t    vec4 texelColor = texture2D( tDiffuse, vUv );\n\n\t\t    gl_FragColor = mix( texelColor, sum, power );\n\n\t\t}"};class DS extends uS{constructor(t,i,s,n,r){let o=t.capabilities.isWebGL2,a=t.getPixelRatio();const l=new e.WebGLRenderTarget(r.w*a,r.h*a,{});l.samples,super(t,l),this.renderTarget=l,this.normalTarget=l.clone(),this.depthTarget=l.clone(),this.normalTarget.texture.minFilter=e.NearestFilter,this.normalTarget.texture.magFilter=e.NearestFilter,this.lutCubeLoader=null,this.lut3DLoader=null,this.v=new e.Vector3,this.torad=Math.PI/180,this.todeg=180/Math.PI,this.isGl2=o,this._pixelRatio=a,this.scene=i,this.camera=s,this.controls=n,this.size=r,this._width=r.w,this._height=r.h,this.enabled=!1,this.options={focus:2,aperture:2.5,maxblur:.01,threshold:.85,strength:1.5,bloomRadius:0,saoBias:.5,saoIntensity:.06,saoScale:40,saoKernelRadius:50,saoMinResolution:0,kernelRadius:.1,minDistance:1e-4,maxDistance:2,horizontal:100,distortion:.5,cylindrical:1,lutIntensity:1,power:.1},this.pass={},this.pass.render=new pS(i,s),this.addPass(this.pass.render),this.pass.sao=new _S(i,s,this.isGl2,!0),this.pass.sao.params={output:0,saoBias:this.options.saoBias,saoIntensity:this.options.saoIntensity,saoScale:this.options.saoScale,saoKernelRadius:this.options.saoKernelRadius,saoMinResolution:this.options.saoMinResolution,saoBlur:!0,saoBlurRadius:4,saoBlurStdDev:2,saoBlurDepthCutoff:.01},this.pass.sao.setNormalTarget(this.normalTarget),this.isGl2||this.pass.sao.setDepthTarget(this.depthTarget),this.pass.sao.enabled=!0,this.lutMap=null,this.pass.lut=new vS,this.loadLut("realism","3dl"),this.pass.lut.intensity=this.options.lutIntensity,this.pass.lut.enabled=!0,this.pass.sharpen=new lS(IS),this.pass.sharpen.setSize=function(t,e){this.uniforms.resolution.value.set(t,e)},this.pass.sharpen.enabled=!1,this.pass.focus=new bS(this.scene,this.camera,{focus:20,aperture:.2,maxblur:2,width:r.w,height:r.h}),this.addPass(this.pass.focus),this.pass.focus.enabled=!1,this.pass.distortion=new lS(FS),this.pass.distortion.enabled=!0,this.bloomPass=new mS(new e.Vector2(r.w,r.h),this.options.strength,this.options.bloomRadius,this.options.threshold,!0),this.bloomPass.enabled=!0,this.bloomComposer=new uS(t,l),this.bloomComposer.renderToScreen=!1,this.bloomComposer.addPass(this.pass.render),this.bloomComposer.addPass(this.bloomPass),this.pass.bloom=new lS(ES),this.pass.bloom.enabled=!0,this.pass.bloom.needsSwap=!0,this.pass.bloom.uniforms.bloomTexture.value=this.bloomComposer.renderTarget2.texture,this.addPass(this.pass.bloom),this.addPass(this.pass.sao),this.addPass(this.pass.distortion),this.addPass(this.pass.lut),this.addPass(this.pass.sharpen),this.addPass(this.pass.focus),this.isGl2||(this.pass.fxaa=new lS(RS),this.pass.fxaa.setSize=function(t,e){this.uniforms.resolution.value.set(1/t,1/e)},this.addPass(this.pass.fxaa)),this.update()}renderNormal(){Pi.up({renderMode:2}),Dl.setBackgroud(7829503),this.scene.helper.visible=!1,this.renderer.setRenderTarget(this.normalTarget),this.renderer.render(this.scene,this.camera)}renderDepth(){Pi.up({renderMode:1}),Dl.setBackgroud(0),this.scene.helper.visible=!1,this.renderer.setRenderTarget(this.depthTarget),this.renderer.render(this.scene,this.camera)}renderBeauty(){Pi.up({renderMode:0}),Dl.setBackgroud(),this.scene.helper.visible=!0,this.renderer.setRenderTarget(null)}update(){this.pass.focus&&(this.pass.focus.uniforms.focus.value=this.options.focus,this.pass.focus.uniforms.aperture.value=.001*this.options.aperture,this.pass.focus.uniforms.maxblur.value=this.options.maxblur),this.bloomPass&&(this.bloomPass.threshold=this.options.threshold,this.bloomPass.strength=this.options.strength,this.bloomPass.radius=this.options.bloomRadius,this.bloomPass.applyValue()),this.pass.sao&&(this.pass.sao.params.saoBias=this.options.saoBias,this.pass.sao.params.saoIntensity=this.options.saoIntensity,this.pass.sao.params.saoScale=this.options.saoScale,this.pass.sao.params.saoKernelRadius=this.options.saoKernelRadius,this.pass.sao.params.saoMinResolution=this.options.saoMinResolution,this.pass.sao.applyValue()),this.pass.sharpen&&(this.pass.sharpen.uniforms.power.value=this.options.power),this.setDistortion()}setDistortion(){if(!this.pass.distortion)return;const t=this.options;let e=t.horizontal,i=t.distortion,s=t.cylindrical,n=Math.tan(e*this.torad*.5)/this.camera.aspect;this.pass.distortion.uniforms.strength.value=i,this.pass.distortion.uniforms.height.value=n,this.pass.distortion.uniforms.aspectRatio.value=this.camera.aspect,this.pass.distortion.uniforms.cylindricalRatio.value=s}changeLut(t,e,i){switch(i=i.toLowerCase(),null!==this.lutMap&&(this.lutMap.texture&&this.lutMap.texture.dispose(),this.lutMap.texture3D&&this.lutMap.texture3D.dispose()),i){case"cube":null===this.lutCubeLoader&&(this.lutCubeLoader=new QS),this.lutMap=this.lutCubeLoader.parse(t);break;case"3dl":null===this.lut3DLoader&&(this.lut3DLoader=new LS),this.lutMap=this.lut3DLoader.parse(t)}this.setLut()}loadLut(t,e){switch(e){case"cube":null===this.lutCubeLoader&&(this.lutCubeLoader=new QS),this.lutCubeLoader.load("assets/luts/"+t+".cube",function(t){this.lutMap=t,this.setLut()}.bind(this));break;case"3dl":null===this.lut3DLoader&&(this.lut3DLoader=new LS),this.lut3DLoader.load("assets/luts/"+t+".3dl",function(t){this.lutMap=t,this.setLut()}.bind(this))}}setLut(){this.pass.lut.lut=this.isGl2?this.lutMap.texture:this.lutMap.texture3D}resize(t){this.enabled&&(this.size=t,this.setSize(this.size.w,this.size.h),this.bloomComposer.setSize(this.size.w,this.size.h))}dispose(){this.enabled=!1}render(t){this.pass.bloom.enabled?(this.bloomPass.enabled=!0,Dl.setBackgroud(0),this.scene.helper.visible=!1,this.scene.ground&&this.scene.ground.setBlack(!0),this.bloomComposer.render(t),this.scene.ground&&this.scene.ground.setBlack(!1),this.scene.helper.visible=!0,Dl.setBackgroud()):this.bloomPass.enabled=!1,(this.pass.sao.isDirectNormal||this.pass.sao.isDirectDepth)&&(this.renderNormal(),this.renderBeauty()),super.render(t)}}class US extends e.Mesh{constructor(t={}){super(),this.color=new e.Color,this.geometry=new e.PlaneGeometry(2,2,1,1),this.material=new e.ShaderMaterial({name:"HuvShader",uniforms:{color:{value:new e.Color(.01,.01,.01)},darkness:{value:1},offset:{value:1.05},ratio:{value:1},radius:{value:2},step:{value:new e.Vector4(.6,.7,1.25,1.5)}},vertexShader:"\n            varying vec2 vUv;\n            varying vec3 pos;\n\n            void main() {\n                vUv = uv;\n                //gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n                pos = position;\n                gl_Position = vec4(position, 1.);\n            }\n            ",fragmentShader:"\n\n            uniform vec3 color;\n            uniform float offset;\n            uniform float darkness;\n\n            uniform float ratio;\n            uniform float radius;\n            uniform vec4 step;\n            varying vec2 vUv;\n            varying vec3 pos;\n\n            void main() {\n                \n                /*vec2 c = vec2(0.5, 0.5);\n                vec2 pos = (vUv - 0.5) * vec2(ratio, 1) + 0.5;\n      \n                float dist = length( pos - c ) * radius;\n\n                vec4 cOne = vec4(0.0, 0.0, 0.0, 0.0);\n                vec4 cTwo = vec4(0.0, 0.0, 0.0, 0.0);\n                vec4 cTree = vec4(0.0, 0.0, 0.0, 0.25);\n                vec4 cFour = vec4(0.0, 0.0, 0.0, 0.95);\n\n                vec4 cc = mix( cOne, cTwo, smoothstep( step.x, step.y, dist ));\n                cc = mix( cc, cTree, smoothstep(step.y, step.z, dist ));\n                cc = mix( cc, cFour, smoothstep(step.z, step.w, dist ));\n\n                gl_FragColor = cc;\n                */\n\n                //vec4 texel = vec4(0.0);\n                vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\n                //gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n\n                float alpha =  smoothstep( 0.0, 1.0, dot( uv, uv ) )-(1.0 - darkness);\n\n                //gl_FragColor = vec4( color, dot( uv, uv )-(1.0 - darkness) );\n                gl_FragColor = vec4( color, alpha );\n\n            }\n            ",transparent:!0,depthWrite:!1,depthTest:!1,toneMapped:!1}),Object.defineProperties(this,{color:{enumerable:!0,get:()=>this.material.uniforms.color.value.getHex(),set:t=>{this.material.uniforms.color.value.setHex(t)}},offset:{enumerable:!0,get:()=>this.material.uniforms.offset.value,set:t=>{this.material.uniforms.offset.value=t}},darkness:{enumerable:!0,get:()=>this.material.uniforms.darkness.value,set:t=>{this.material.uniforms.darkness.value=t}}}),this.frustumCulled=!1,this.renderOrder=1/0,this.matrixAutoUpdate=!1}raycast(){}dispose(){this.parent.remove(this),this.geometry.dispose(),this.material.dispose()}}class zS extends e.Mesh{constructor(t={}){super(),this.geometry=new e.PlaneGeometry(1,1,1,1),this.settings={size:[30,30],gAlpha:!0,opacity:1},this.rotateX(-Math.PI/2),this.castShadow=!1,this.receiveShadow=!0,this.type="Reflector",this.isShow=!0;var i=this;t=t||{},this.map=t.map||null,this.color=t.color||8421504,this.reflect=void 0!==t.reflect?t.reflect:.4,this.isWater=void 0!==t.water&&t.water,this.uv=t.uv||1,this.normalScale=t.normalScale||1,this.textureSize=t.textureSize||512,this.renderTarget=null;const s=t.clipBias||0,n=new e.Plane,r=new e.Vector3,o=new e.Vector3,a=new e.Vector3,l=new e.Matrix4,h=new e.Vector3(0,0,-1),c=new e.Vector4,u=new e.Vector3,d=new e.Vector3,p=new e.Vector4,f=new e.Matrix4,m=new e.PerspectiveCamera;this.material=new e.MeshStandardMaterial({name:"Ground",color:this.color,roughness:.2,metalness:0,opacity:1,transparent:!0,depthWrite:!1,normalMap:null}),this.groundAlpha(),this.renderOrder=-1,this.material.userData={reflectif:{value:this.reflect},mirrorMap:{value:null},blackAll:{value:0}},Object.defineProperty(this.material,"reflectif",{get(){return this.userData.reflectif.value},set(t){this.userData.reflectif.value=t}}),this.textureRenderer=null,this.setTarget();const g=this;this.material.onBeforeCompile=function(t){var e=t.uniforms;e.mirrorMap=this.userData.mirrorMap,e.textureMatrix={value:f},e.reflectif=this.userData.reflectif,e.blackAll=this.userData.blackAll,t.uniforms=e;var i=t.vertexShader;i=(i=i.replace("#include <common>",["#include <common>","varying vec4 vUvR;","uniform mat4 textureMatrix;"].join("\n"))).replace("#include <uv_vertex>",["#include <uv_vertex>","vUvR = textureMatrix * vec4( position, 1.0 );"].join("\n")),t.vertexShader=i;var s=t.fragmentShader;s=(s=(s=(s=(s=s.replace("uniform vec3 diffuse;",["uniform vec3 diffuse;","varying vec4 vUvR;","uniform float reflectif;","uniform sampler2D mirrorMap;","uniform int blackAll;"].join("\n"))).replace("#include <map_fragment>",NS.map_fragment)).replace("#include <fog_fragment>",NS.fog_fragment)).replace("#include <aomap_fragment>","")).replace("#include <bumpmap_pars_fragment>",""),t.fragmentShader=s,Pi.modify(t)},Pi.setDefines(this.material),this.onBeforeRender=function(t,e,v){if(!this.isShow)return;if(0===g.reflect)return;g.isWater&&(g.material.normalMap.offset.x+=5e-4,g.material.normalMap.offset.y+=25e-5);let y=t.isWebGPURenderer||!1;if(o.setFromMatrixPosition(i.matrixWorld),a.setFromMatrixPosition(v.matrixWorld),l.extractRotation(i.matrixWorld),r.set(0,0,1),r.applyMatrix4(l),u.subVectors(o,a),u.dot(r)>0)return;u.reflect(r).negate(),u.add(o),l.extractRotation(v.matrixWorld),h.set(0,0,-1),h.applyMatrix4(l),h.add(a),d.subVectors(o,h),d.reflect(r).negate(),d.add(o),m.position.copy(u),m.up.set(0,1,0),m.up.applyMatrix4(l),m.up.reflect(r),m.lookAt(d),m.far=v.far,m.updateMatrixWorld(),m.projectionMatrix.copy(v.projectionMatrix),f.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),f.multiply(m.projectionMatrix),f.multiply(m.matrixWorldInverse),f.multiply(i.matrixWorld),n.setFromNormalAndCoplanarPoint(r,o),n.applyMatrix4(m.matrixWorldInverse),c.set(n.normal.x,n.normal.y,n.normal.z,n.constant);const b=m.projectionMatrix;p.x=(Math.sign(c.x)+b.elements[8])/b.elements[0],p.y=(Math.sign(c.y)+b.elements[9])/b.elements[5],p.z=-1,p.w=(1+b.elements[10])/b.elements[14],c.multiplyScalar(2/c.dot(p)),b.elements[2]=c.x,b.elements[6]=c.y,b.elements[10]=c.z+1-s,b.elements[14]=c.w,i.visible=!1;const x=e.fog,O=t.getRenderTarget();let w=t.xr.enabled,S=t.shadowMap.autoUpdate;e.fog=null,t.xr.enabled=!1,t.setRenderTarget(i.renderTarget),y||t.state.buffers.depth.setMask(!0),!1===t.autoClear&&t.clear(),t.render(e,m),t.xr.enabled=w,t.shadowMap.autoUpdate=S,e.fog=x,t.setRenderTarget(O);const k=v.viewport;void 0!==k&&t.state.viewport(k),i.visible=!0}}reset(){this.material.map&&this.material.map.dispose(),this.material.normalMap&&this.material.normalMap.dispose(),this.material.map=null,this.material.normalMap=null}dispose(){this.onBeforeRender=function(){},this.material.map&&this.material.map.dispose(),this.material.alphaMap&&this.material.alphaMap.dispose(),this.material.normalMap&&this.material.normalMap.dispose(),this.renderTarget&&this.renderTarget.dispose(),this.parent&&this.parent.remove(this),this.geometry.dispose(),this.material.dispose()}getRenderTarget(){return this.renderTarget}setTarget(){this.renderTarget&&this.renderTarget.dispose();var t={minFilter:e.LinearFilter,magFilter:e.LinearFilter,stencilBuffer:!1,generateMipmaps:!0};this.renderTarget=new e.WebGLRenderTarget(this.textureSize,this.textureSize,t),this.material.userData.mirrorMap.value=this.renderTarget.texture}setAlphaMap(t=!0){t!==this.settings.gAlpha&&(this.settings.gAlpha=t,this.material.alphaMap=t?this.alphaMap:null,t&&(this.material.alphaMap.needsUpdate=!0),this.material.needsUpdate=!0)}setSize(t=[200,200]){t!==this.settings.size&&(this.settings.size=t,this.scale.set(t[0],t[1],1))}setColor(t,e){this.color=void 0!==t?t:11039282,this.material.color.setHex(this.color)}setMapRepeat(t){this.map&&this.map.repeat.set(t,t)}setMap(t){this.map=t,this.material.map=this.map,this.material.needsUpdate=!0}setWater(t,i,s){if(void 0!==t&&(this.isWater=t),this.isWater){this.uv=30;var n=void 0!==i?i:this.uv,r=void 0!==s?s:this.normalScale;this.material.normalMap=Li.texture({url:"./assets/textures/terrain/water_n.jpg",flip:!1,repeat:[n,n]}),this.material.normalScale.set(r,r),this.material.roughness=0,this.material.metalness=0,this.material.opacity=.8,this.material.side=e.DoubleSide}else this.material.roughness=.8,this.material.metalness=.2,this.material.side=e.FrontSide}setOpacity(t=1){t!==this.settings.opacity&&(this.settings.opacity=t,this.material.opacity=this.settings.opacity)}setReflect(t){this.reflect=void 0!==t?t:.35,this.material.userData.reflectif.value=this.reflect}show(t){this.isShow=t,this.visible=t}groundAlpha(){let t=document.createElement("canvas");t.width=t.height=512;let i=t.getContext("2d"),s=i.createRadialGradient(256,256,128,256,256,256);s.addColorStop(0,"white"),s.addColorStop(.2,"white"),s.addColorStop(1,"black"),i.fillStyle=s,i.fillRect(0,0,512,512);var n=new Image(512,512);n.src=t.toDataURL("image/png"),this.alphaMap=new e.Texture(n),this.material.alphaMap=this.alphaMap,n.onload=function(){this.alphaMap.needsUpdate=!0}.bind(this)}setBlack(t){this.isShow=!t,this.material.userData.blackAll.value=t?1:0}}const NS={map_fragment:"\n\n\t\n\n\t#ifdef USE_MAP\n\t    \n\t    diffuseColor *= texture2D( map, vMapUv );\n\n\t#endif\n\n\tif( reflectif != 0.0 ){\n\t\tvec4 reflector = texture2DProj( mirrorMap, vUvR );\n\t    diffuseColor.rgb = mix( diffuseColor.rgb, diffuseColor.rgb + reflector.rgb, reflectif );\n\t}\n\t",fog_fragment:"\n\tif( blackAll == 1 ) gl_FragColor = vec4( vec3(0.0), diffuseColor.a );\n\t#ifdef USE_FOG\n\n\t\t#ifdef FOG_EXP2\n\n\t\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\n\t\t#else\n\n\t\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\n\t\t#endif\n\n\t\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n\t#endif\n\t",extra_Function:"\n\n\tfloat blendOverlay( float base, float blend ) {\n\n\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n\t}\n\n\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\n\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n\t}"};class VS extends e.Mesh{constructor(t={}){super(),t=null==t?{}:t,this.radius=void 0!==t.radius?t.radius:100,this.resolution=void 0!==t.resolution?t.resolution:10,this.data={level:t.level||[1,.25],frequency:t.frequency||[.1,.5],expo:t.expo||2,height:t.height||4},this.uvx=t.uv||[2,2];let i=["cliff","crater","desert","ice","plate","rock","rock2","mud","snow"];const s=i[mt.randInt(0,i.length-1)];this.m1=Li.texture({url:"./assets/textures/terrain/"+s+"_c.jpg",flip:!1,repeat:this.uvx,encoding:!0}),this.m2=Li.texture({url:"./assets/textures/terrain/"+s+"_n.jpg",flip:!1,repeat:this.uvx}),this.material=new e.MeshStandardMaterial({name:"planet",vertexColors:!0,map:this.m1,normalMap:this.m2,normalScale:new e.Vector2(1,1),roughness:.6,metalness:.5}),this.material.onBeforeCompile=function(t){Pi.modify(t)},this.makeGeometry(),this.name=t.name||"planet",this.castShadow=!0,this.receiveShadow=!0}makeGeometry(){this.geometry=new e.BoxGeometry(1,1,1,this.resolution,this.resolution,this.resolution),this.lng=this.geometry.attributes.position.count,this.colors=new Float32Array(3*this.lng),this.geometry.setAttribute("color",new e.BufferAttribute(this.colors,3));var t,i=this.lng,s=new e.Vector3;for(this.vertices=this.geometry.attributes.position.array,this.s=[];i--;)t=3*i,s.set(this.vertices[t],this.vertices[t+1],this.vertices[t+2]).normalize().multiplyScalar(this.radius),this.s.push(s.x,s.y,s.z);this.update()}update(){for(var t,i,s,n=this.lng,r=new e.Vector3;n--;)s=3*n,r.set(this.s[s],this.s[s+1],this.s[s+2]),t=mt.noise(r,this.data),t=(t=(t=Math.pow(t,this.data.expo))>1?1:t)<0?0:t,r.normalize().multiplyScalar(t*this.data.height),this.vertices[s]=this.s[s]+r.x,this.vertices[s+1]=this.s[s+1]+r.y,this.vertices[s+2]=this.s[s+2]+r.z,i=.75*t+.25,this.colors[s]=i,this.colors[s+1]=i,this.colors[s+2]=i;this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0,this.geometry.computeVertexNormals(),mt.resetPerlin()}dispose(){this.geometry.dispose(),this.material.dispose()}}class BS extends e.MeshStandardMaterial{constructor(t={},i={}){t.metalness=1,t.roughness=.2,t.side=e.DoubleSide,t.envMapIntensity=1,t.normalScale=new e.Vector2(2,2),super(t),this.onBeforeCompile=function(t){var s=t.uniforms;s.insideMap={value:i.insideMap||null},s.wallFreq={value:(new e.Vector3).fromArray(i.freq||[1,1,1])},s.wallsBias={value:i.bias||.01},s.time={value:i.time||1},s.lightning={value:1},s.isNoise={value:1},s.isNoSection={value:0},t.uniforms=s;var n=t.vertexShader;n=(n=n.replace("varying vec3 vViewPosition;",Pi.getGl2()?XS:$S+XS)).replace("#include <fog_vertex>",jS),t.vertexShader=n;var r=t.fragmentShader;r=(r=(r=(r=r.replace("void main() {",GS)).replace("#include <map_fragment>",ZS)).replace("#include <normal_fragment_maps>",WS)).replace("#include <emissivemap_fragment>",qS),t.fragmentShader=r,Pi.modify(t)}}}const $S="\n\nmat4 inverse(mat4 m) {\n\n    float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n    b00 = a00 * a11 - a01 * a10,\n    b01 = a00 * a12 - a02 * a10,\n    b02 = a00 * a13 - a03 * a10,\n    b03 = a01 * a12 - a02 * a11,\n    b04 = a01 * a13 - a03 * a11,\n    b05 = a02 * a13 - a03 * a12,\n    b06 = a20 * a31 - a21 * a30,\n    b07 = a20 * a32 - a22 * a30,\n    b08 = a20 * a33 - a23 * a30,\n    b09 = a21 * a32 - a22 * a31,\n    b10 = a21 * a33 - a23 * a31,\n    b11 = a22 * a33 - a23 * a32,\n\n  det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4( a11 * b11 - a12 * b10 + a13 * b09, a02 * b10 - a01 * b11 - a03 * b09, a31 * b05 - a32 * b04 + a33 * b03, a22 * b04 - a21 * b05 - a23 * b03, a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07, a32 * b02 - a30 * b05 - a33 * b01, a20 * b05 - a22 * b02 + a23 * b01, a10 * b10 - a11 * b08 + a13 * b06, a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00, a21 * b02 - a20 * b04 - a23 * b00, a11 * b07 - a10 * b09 - a12 * b06, a00 * b09 - a01 * b07 + a02 * b06, a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n",XS="\nvarying vec3 vViewPosition;\n\nvarying mat4 invMat;\nvarying mat4 modelMatrixOn;\n\nvarying vec3 oP; // surface position in object space\nvarying vec3 oE; // position of the eye in object space\nvarying vec3 oI; // incident ray direction in object space\nvarying vec3 oN; // surface normal\n\n",jS="\n#include <fog_vertex>\n\nmat4 modelViewMatrixInverse = inverse( modelViewMatrix );\n\n// surface position in object space\noP = position;\n\n// position of the eye in object space\noE = modelViewMatrixInverse[3].xyz;\n\n// incident ray direction in object space\noI = oP - oE;\n\n// surface normal\noN = normalize( vec3( normal ) );\n\n",GS="\n\nvarying vec3 oP; // surface position in object space\nvarying vec3 oE; // position of the eye in object space\nvarying vec3 oI; // incident ray direction in object space\nvarying vec3 oN; // surface normal\n\nuniform sampler2D insideMap;\nuniform vec3 wallFreq;\nuniform float wallsBias;\n\nuniform float time;\nuniform float lightning;\nuniform bool isNoise;\nuniform bool isNoSection;\n\nfloat randomized( vec2 co ){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec2 tileUV( vec2 uv, vec2 pos, vec2 ntile ){\n\n\tpos.y = ntile.y-pos.y-1.0;\n\tvec2 div = 1.0/ntile;\n\tvec2 v = vec2(uv*div)+(pos*div);\n\treturn v;\n\t\n}\n\nvoid main() {\n\n",ZS="\n\n#ifdef USE_MAP\n\n\t//vec4 texelColor = texture2D( map, vUv );\n\n\t//texelColor = mapTexelToLinear( texelColor );\n\t//diffuseColor *= texelColor;\n\n\nvec3 wallFrequencies = wallFreq - wallsBias;\n\n// calculate wall locations\nvec3 wallFrame = floor( oP * wallFrequencies);\nvec3 walls = ( wallFrame + step( vec3( 0.0 ), oI )) / wallFrequencies;\n\n// how much of the ray is needed to get from the oE to each of the walls\n\nvec3 rayFractions = ( walls - oE ) / oI;\n\n// texture-coordinates of intersections\nvec2 uvXY = fract((oE + rayFractions.z * oI).xy * wallFrequencies.xy);\nvec2 uvXZ = fract((oE + rayFractions.y * oI).xz * wallFrequencies.xz);\nvec2 uvZY = fract((oE + rayFractions.x * oI).zy * wallFrequencies.zy);\n\nvec2 nuv = vec2( 2.0, 4.0 );\n\n// floor / ceiling  \n\nvec4 tmp_color_1 = texture2D( insideMap, tileUV( uvXZ, vec2(1.0,0.0), nuv ) );// floor\nvec4 tmp_color_2 = texture2D( insideMap, tileUV( uvXZ, vec2(0.0,0.0), nuv ) );// ceilling\nvec4 verticalColour = mix( tmp_color_1, tmp_color_2, step(0.0, oI.y));\n\ntmp_color_1 = texture2D( insideMap, tileUV( uvXY, vec2(0.0,2.0), nuv ) ); // back\ntmp_color_2 = texture2D( insideMap, tileUV( uvXY, vec2(1.0,2.0), nuv ) ); // front\nvec4 wallXYColour = mix( tmp_color_1, tmp_color_2, step(oI.z, 0.0));\n\ntmp_color_1 = texture2D( insideMap, tileUV( uvZY, vec2(0.0,3.0), nuv ) ); // left\ntmp_color_2 = texture2D( insideMap, tileUV( uvZY, vec2(1.0,3.0), nuv ) ); // right\nvec4 wallZYColour = mix( tmp_color_1, tmp_color_2, step(oI.x, 0.0) );\n\n// add some noise\n\nvec4 noiseColor = vec4( 0.0 );\n\nif( isNoise ){\n\tfloat t = time*0.00000001;\n\tnoiseColor.xyz = vec3( vec3( randomized(wallFrame.xy+t) ) + vec3( randomized(wallFrame.zy) ) + vec3( randomized(wallFrame.xz+t)) ) / 3.0;\n\twallXYColour *= noiseColor;\n    wallZYColour *= noiseColor;\n    verticalColour *= noiseColor;\n}\n\n// intersect walls\n\nvec4 insideColor = vec4(0.0);\nif( isNoSection ){\n\t//insideColor = ( wallXYColour + wallZYColour + verticalColour ) / 3.0;\n\t///insideColor.a = alph;\n\n\tinsideColor = mix( wallXYColour, wallZYColour, step(wallXYColour.a, wallZYColour.a) );\n\tinsideColor = mix( insideColor, verticalColour, step(insideColor.a, verticalColour.a)  );\n\t//insideColor = verticalColour;\n\t//insideColor = mix( insideColor, verticalColour, insideColor.a );\n\n} else {\n\n    float xVSz = step( rayFractions.x, rayFractions.z );\n\tinsideColor = mix( wallXYColour, wallZYColour, xVSz );\n\n\tfloat rayFraction_xVSz = mix( rayFractions.z, rayFractions.x, xVSz );\n\tfloat xzVSy = step( rayFraction_xVSz, rayFractions.y );\n\tinsideColor = mix( verticalColour, insideColor, xzVSy );\n\n}\n\n\n\n// exterior\n\nvec2 nuvo = vec2( 2.0, 4.0 );// texture reapeat\n\nvec4 Ftop = texture2D( map, tileUV( fract( oP.xz * wallFrequencies.xz ) , vec2(1.0,2.0), nuv ) );\nvec4 Fleft = texture2D( map, tileUV( fract( oP.zy * wallFrequencies.zy ) , vec2(1.0,1.0), nuv ) );\nvec4 Ffront = texture2D( map, tileUV( fract( oP.xy * wallFrequencies.xy ) , vec2(0.0,0.0), nuv ) );\n\nfloat n = abs(oN.z) > abs(oN.x) ? 1.0 : 0.0;\nfloat ny = abs(oN.y) > ( abs(oN.x) + abs(oN.z) * 0.5 ) ? 1.0 : 0.0;\n\nvec4 outsideColor =  mix( Fleft, Ffront, n );\n//outsideColor =  mix( outsideColor, Ftop, ny );\n\n\n//vec4 building_color = mapTexelToLinear(vec4( mix( insideColor, outsideColor, outsideColor.a ).xyz, 1.0));\nvec4 building_color = mapTexelToLinear( mix( insideColor, outsideColor, outsideColor.a ));\n\n//if(building_color.a < 0.01) discard;\n\ndiffuseColor *= building_color;\n\n#endif\n\n\n",qS="\nvec4 emissiveColor = vec4( mix( insideColor, vec4(0.0, 0.0, 0.0, 1.0), outsideColor.a ).xyz, 1.0);\n//emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor.rgb );\ntotalEmissiveRadiance = emissiveColor.xyz*lightning*noiseColor.xyz;\n",WS="\n#ifdef USE_NORMALMAP\n\nvec3 nWallFrequencies = wallFreq - wallsBias;\nvec2 nuvn = vec2( 2.0, 4.0 );\nvec3 Ntop = texture2D( normalMap, tileUV( fract( oP.xz * nWallFrequencies.xz ) , vec2(1.0,2.0), nuvn ) ).rgb;\nvec3 Nleft = texture2D( normalMap, tileUV( fract( oP.zy * nWallFrequencies.zy ) , vec2(1.0,1.0), nuvn ) ).rgb;\nvec3 Nfront = texture2D( normalMap, tileUV( fract( oP.xy * nWallFrequencies.xy ) , vec2(0.0,0.0), nuvn ) ).rgb;\n\nfloat nn = abs(oN.z) > abs(oN.x) ? 1.0 : 0.0;\nfloat nny = abs(oN.y) > ( abs(oN.x) + abs(oN.z) * 0.5 ) ? 1.0 : 0.0;\n\nvec3 tmpNormal =  mix( Nleft, Nfront, nn );\n//tmpNormal =  mix( tmpNormal, Ntop, nny );\ntmpNormal = tmpNormal * 2.0 - 1.0;\n\n\nvec3 eye_pos = -vViewPosition;\nvec3 surf_norm = normal;\n\nvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\nvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\nvec2 st0 = dFdx( vUv.st );\nvec2 st1 = dFdy( vUv.st );\n\nfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\nvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\nvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\nvec3 N = normalize( surf_norm );\nmat3 tsn = mat3( S, T, N );\n\nvec3 mapN = tmpNormal;//texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\nmapN.xy *= normalScale;\nmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\nnormal = normalize( tsn * mapN );\n\n#endif\n",HS=new e.Triangle,YS=new e.Vector3;class KS{constructor(t){let e=t.geometry;if(!e.isBufferGeometry||3!==e.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");e.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),e=e.toNonIndexed()),this.geometry=e,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(t){return this.weightAttribute=t?this.geometry.getAttribute(t):null,this}build(){const t=this.positionAttribute,e=this.weightAttribute,i=new Float32Array(t.count/3);for(let s=0;s<t.count;s+=3){let n=1;e&&(n=e.getX(s)+e.getX(s+1)+e.getX(s+2)),HS.a.fromBufferAttribute(t,s),HS.b.fromBufferAttribute(t,s+1),HS.c.fromBufferAttribute(t,s+2),n*=HS.getArea(),i[s/3]=n}this.distribution=new Float32Array(t.count/3);let s=0;for(let t=0;t<i.length;t++)s+=i[t],this.distribution[t]=s;return this}setRandomGenerator(t){return this.randomFunction=t,this}sample(t,e,i){const s=this.distribution[this.distribution.length-1],n=this.binarySearch(this.randomFunction()*s);return this.sampleFace(n,t,e,i)}binarySearch(t){const e=this.distribution;let i=0,s=e.length-1,n=-1;for(;i<=s;){const r=Math.ceil((i+s)/2);if(0===r||e[r-1]<=t&&e[r]>t){n=r;break}t<e[r]?s=r-1:i=r+1}return n}sampleFace(t,e,i,s){let n=this.randomFunction(),r=this.randomFunction();return n+r>1&&(n=1-n,r=1-r),HS.a.fromBufferAttribute(this.positionAttribute,3*t),HS.b.fromBufferAttribute(this.positionAttribute,3*t+1),HS.c.fromBufferAttribute(this.positionAttribute,3*t+2),e.set(0,0,0).addScaledVector(HS.a,n).addScaledVector(HS.b,r).addScaledVector(HS.c,1-(n+r)),void 0!==i&&HS.getNormal(i),void 0!==s&&void 0!==this.colorAttribute&&(HS.a.fromBufferAttribute(this.colorAttribute,3*t),HS.b.fromBufferAttribute(this.colorAttribute,3*t+1),HS.c.fromBufferAttribute(this.colorAttribute,3*t+2),YS.set(0,0,0).addScaledVector(HS.a,n).addScaledVector(HS.b,r).addScaledVector(HS.c,1-(n+r)),s.r=YS.x,s.g=YS.y,s.b=YS.z),this}}class JS extends e.Points{constructor(t={}){super(),this.num=t.num||12,this.controler=t.controler||null,this.sampler=new KS(new e.Mesh((new e.BoxGeometry).toNonIndexed())),this.v=new e.Vector3,this.objectList=t.objectList,this.lng=this.objectList.length,this.numParticle=this.lng*this.num,this.range=t.range||[2,2,2],this.speed=t.speed||[.002,.001],this.disp=t.disp||[.5,.5,.5];let i=new e.Color;this.velocities=[],this.pos=[];let s=[],n=[],r=[],o=[],a=[];this.tt=[];let l,h,c,u=this.numParticle;for(;u--;)o.push(0,0,0),a.push(1,1,1),n.push(mt.rand(.2,1.5)),s.push(mt.rand(0,1)),r.push(0),this.tt.push(mt.randInt(-300,1));for(u=this.lng;u--;)for(this.setSamplerGeometry(this.objectList[u].children[0].geometry),c=this.objectList[u].children[0].material.color,l=this.num;l--;)h=3*(u*this.num+l),this.v.set(mt.rand(-5,5),mt.rand(-5,5),mt.rand(-5,5)),this.sampler.sample(this.v),this.v.toArray(this.pos,h),i.copy(c),a[h]=c.r,a[h+1]=c.g,a[h+2]=c.b;this.positions=new Float32Array(o),this.angles=new Float32Array(r),this.alphas=new Float32Array(s),this.sizes=new Float32Array(n),this.geometry.setAttribute("position",new e.BufferAttribute(this.positions,3)),this.geometry.setAttribute("color",new e.BufferAttribute(new Float32Array(a),3)),this.geometry.setAttribute("sizer",new e.BufferAttribute(this.sizes,1)),this.geometry.setAttribute("alphas",new e.BufferAttribute(this.alphas,1)),this.geometry.setAttribute("angles",new e.BufferAttribute(this.angles,1)),this.texture=this.makeTexture(),this.material=new e.PointsMaterial({name:"snow",size:1,color:16777215,vertexColors:!0,map:this.texture,blending:e.AdditiveBlending,transparent:!0,fog:!1,depthWrite:!1,premultipliedAlpha:!0,alphaToCoverage:!0}),this.material.onBeforeCompile=function(t){var e=t.vertexShader;e=(e=e.replace("#include <clipping_planes_pars_vertex>",tk)).replace("#include <fog_vertex>",ek),t.vertexShader=e;var i=t.fragmentShader;i=(i=(i=i.replace("#include <clipping_planes_pars_fragment>",ik)).replace("#include <output_fragment>","#include <output_fragment>"+sk)).replace("#include <map_particle_fragment>",nk),t.fragmentShader=i},this.mTime=0,this.castShadow=!1,this.receiveShadow=!1}setSamplerGeometry(t){this.sampler.geometry.dispose(),this.sampler.geometry=t.clone().toNonIndexed(),this.sampler.positionAttribute=this.sampler.geometry.getAttribute("position"),this.sampler.build()}makeTexture(){let t=document.createElement("canvas"),i=t.getContext("2d"),s=64;t.width=s,t.height=s;let n=32,r=i.createRadialGradient(n,n,0,n,n,n);r.addColorStop(0,"rgba(255,255,255,0.4)"),r.addColorStop(.5,"rgba(255,255,255,0.2)"),r.addColorStop(1,"rgba(255,255,255,0)"),i.fillStyle=r,i.fillRect(0,0,s,s),r=i.createRadialGradient(n,n,0,n,n,n),r.addColorStop(0,"rgba(255,255,255,1.0)"),r.addColorStop(.5,"rgba(255,255,255,0.5)"),r.addColorStop(1,"rgba(255,255,255,0)"),i.strokeStyle=r,i.beginPath(),i.moveTo(0,n),i.lineTo(s,n),i.lineWidth=2,i.stroke(),i.beginPath(),i.moveTo(n,0),i.lineTo(n,s),i.lineWidth=2,i.stroke(),r=i.createRadialGradient(n,n,0,n,n,n),r.addColorStop(0,"rgba(255,255,255,0.4)"),r.addColorStop(.5,"rgba(255,255,255,0.2)"),r.addColorStop(1,"rgba(255,255,255,0)"),i.strokeStyle=r,i.beginPath(),i.moveTo(0,0),i.lineTo(s,s),i.lineWidth=1,i.stroke(),i.beginPath(),i.moveTo(s,0),i.lineTo(0,s),i.lineWidth=1,i.stroke();var o=new e.Texture(t);return o.colorSpace=e.SRGBColorSpace,o.needsUpdate=!0,o}updateMatrixWorld(t){let e=.01666,i=this.v;this.mTime+=e;let s=0;this.controler&&(s=this.controler.getAzimuthalAngle());let n,r,o,a,l,h,c=this.lng;for(;c--;)for(r=this.objectList[c].position,a=this.objectList[c].quaternion,n=this.num;n--;)o=c*this.num+n,l=this.alphas[o],h=this.tt[o],0===h?(l+=.1*e,l>.5&&(h=1)):1===h?(l-=.1*e,l<0&&(h=mt.randInt(-300,0),this.sizes[o]=mt.rand(.2,1.5))):h++,this.alphas[o]=mt.clamp(l,0,1),this.tt[o]=h,this.angles[o]=-s,this.alphas[o]>1&&(this.alphas[o]=mt.rand(-5,0)),o*=3,i.fromArray(this.pos,o).applyQuaternion(a).add(r),i.toArray(this.positions,o);this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.alphas.needsUpdate=!0,this.geometry.attributes.angles.needsUpdate=!0,this.geometry.attributes.sizer.needsUpdate=!0}dispose(){this.parent.remove(this),this.geometry.dispose(),this.material.map.dispose(),this.material.dispose()}raycast(t,e){}}const tk="\n#include <clipping_planes_pars_vertex>\n\nattribute float sizer;\nattribute float alphas;\nattribute float angles;\n\nvarying float aaa;\nvarying float ang;\n",ek="\n#include <fog_vertex>\n\naaa = alphas;\nang = angles;\n\ngl_PointSize *= sizer;\n\n",ik="\n#include <clipping_planes_pars_fragment>\n\nvarying float aaa;\nvarying float ang;\n\nvec2 rotUV(vec2 uv, float angle){\n    float s = sin(angle);\n    float c = cos(angle);\n    mat2 r = mat2( c, -s, s, c);\n    r *= 0.5; r += 0.5; r = r * 2.0 - 1.0;\n    uv -= 0.5; uv = uv * r; uv += 0.5;\n    return uv;\n}\n",sk="\n\ngl_FragColor.a *= aaa;\n\n//gl_FragColor = vec4( outgoingLight, diffuseColor.a * aaa  );\n//gl_FragColor = vec4( outgoingLight, aaa );\n\n",nk="\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\n#endif\n\n#ifdef USE_MAP\n\n\tvec4 mapTexel = texture2D( map, rotUV( uv, ang ) );\n\tdiffuseColor *= mapTexel;\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n\n#endif\n";class rk extends e.MeshPhysicalMaterial{constructor(t={},i={}){t.metalness=0,t.roughness=0,t.clearcoat=1,t.iridescenceIOR=2.33,t.iridescence=1,t.reflectivity=1,t.envMapIntensity=1.3,super(t),this.normal=this.cubeNormal(i),this.onBeforeCompile=function(i){var s=i.uniforms;s.normalCube={value:this.normal.texture},s.bDebugBounces={value:0},s.mFresnelBias={value:.02},s.mFresnelScale={value:.1},s.mFresnelPower={value:1},s.aberration={value:.012},s.refraction={value:2.417},s.normalOffset={value:0},s.squashFactor={value:.98},s.distanceOffset={value:0},s.geometryFactor={value:.28},s.absorbption={value:new e.Color(0,0,0)},s.correction={value:new e.Color(t.color||16777215)},s.boost={value:new e.Color(.892,.892,.98595025)},s.radius={value:1.5},s.centreOffset={value:new e.Vector3(0,0,0)},i.uniforms=s;var n=i.vertexShader;n=(n=n.replace("varying vec3 vViewPosition;",Pi.getGl2()?ak:ok+ak)).replace("#include <fog_vertex>",lk),i.vertexShader=n;var r=i.fragmentShader;r=(r=r.replace("void main() {",ck)).replace("#include <opaque_fragment>","#include <opaque_fragment>"+hk),i.fragmentShader=r,Pi.modify(i)}}cubeNormal(t={}){let i=new e.WebGLCubeRenderTarget(1024,{format:e.RGBAFormat}),s=new e.CubeCamera(.01,10,i),n=new e.Scene;n.add(s);let r=new e.ShaderMaterial({vertexShader:["varying vec3 vNormalm;","void main() {","vNormalm = normal;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec3 vNormalm;","void main() {","vec3 color = normalize(vNormalm);","color = color * 0.5 + 0.5;","gl_FragColor = vec4( color.xyz, 1.0 );","}"].join("\n"),side:e.BackSide}),o=new e.Mesh(t.geometry,r);return o.scale.set(10,10,10),o.frustumCulled=!1,o.geometry.center(),n.add(o),s.update(Pi.renderer,n),n.remove(o),n.remove(s),o.material.dispose(),o.geometry.dispose(),i}dispose(){this.normal.dispose(),this.dispatchEvent({type:"dispose"})}}const ok="\n\nmat4 inverse(mat4 m) {\n\n    float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n    b00 = a00 * a11 - a01 * a10,\n    b01 = a00 * a12 - a02 * a10,\n    b02 = a00 * a13 - a03 * a10,\n    b03 = a01 * a12 - a02 * a11,\n    b04 = a01 * a13 - a03 * a11,\n    b05 = a02 * a13 - a03 * a12,\n    b06 = a20 * a31 - a21 * a30,\n    b07 = a20 * a32 - a22 * a30,\n    b08 = a20 * a33 - a23 * a30,\n    b09 = a21 * a32 - a22 * a31,\n    b10 = a21 * a33 - a23 * a31,\n    b11 = a22 * a33 - a23 * a32,\n\n  det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4( a11 * b11 - a12 * b10 + a13 * b09, a02 * b10 - a01 * b11 - a03 * b09, a31 * b05 - a32 * b04 + a33 * b03, a22 * b04 - a21 * b05 - a23 * b03, a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07, a32 * b02 - a30 * b05 - a33 * b01, a20 * b05 - a22 * b02 + a23 * b01, a10 * b10 - a11 * b08 + a13 * b06, a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00, a21 * b02 - a20 * b04 - a23 * b00, a11 * b07 - a10 * b09 - a12 * b06, a00 * b09 - a01 * b07 + a02 * b06, a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n",ak="\nvarying vec3 vViewPosition;\n\nvarying mat4 invMat;\nvarying mat4 modelMatrixOn;\n\nvarying vec3 worldNormal;\nvarying vec3 vecPos;\n//varying vec3 vEye;\nvarying vec3 vI;\n",lk="\n#include <fog_vertex>\n\nmodelMatrixOn = modelMatrix;\ninvMat = inverse( modelMatrix );\nvecPos = worldPosition.xyz;//(modelMatrix * vec4(position, 1.0 )).xyz;\n//worldNormal = (modelMatrix * vec4(normal,0.0)).xyz;\nworldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n//vEye = normalize(-cameraPosition);\nvI = normalize( worldPosition.xyz - cameraPosition );//vecPos - cameraPosition;\n\n",hk="\n#ifdef USE_ENVMAP\nfloat vReflectionFactor = mFresnelBias + mFresnelScale * pow( abs((1.0 + dot( normalize( vI ), vNormal ))), mFresnelPower );\n\nvec3 refractedColor = traceRayTest( vecPos, vI, normalize( worldNormal ) );\n\nvec3 finalColor = mix( refractedColor, refractedColor*outgoingLight, clamp( vReflectionFactor, 0.0, 1.0 ) );\n//vec3 finalColor = outgoingLight * refractedColor;\ngl_FragColor = vec4( finalColor, diffuseColor.a);\n//reflectedColor.rgb = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) ).rgb;\n#endif\n\n",ck="\n\n#define RAY_BOUNCES 5\n\nvarying mat4 invMat;\nvarying mat4 modelMatrixOn;\nvarying vec3 worldNormal;\nvarying vec3 vecPos;\n//varying vec3 vEye;\nvarying vec3 vI;\n\nuniform samplerCube normalCube;\nuniform bool bDebugBounces;\n\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\n\nuniform float refraction;\nuniform float aberration;\n\nuniform float normalOffset;\nuniform float squashFactor;\nuniform float distanceOffset;\nuniform float geometryFactor;\n\nuniform vec3 absorbption;\nuniform vec3 correction;\nuniform vec3 boost;\n\nuniform float radius;\nuniform vec3 centreOffset;\n\n#ifdef USE_ENVMAP\n\nvec3 BRDF_Specular_GGX_EnvironmentTest( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n    float dotNV = abs( dot( normal, viewDir ) );\n    const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n    const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n    vec4 r = roughness * c0 + c1; \n    float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n    vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n    return specularColor * AB.x + AB.y;\n}\n\nvec4 SampleSpecularReflectionTest( vec4 specularColor, vec3 direction ) {\n    direction.x *= -1.0;\n    direction.z *= -1.0;\n    vec4 sampleColorRGB = envMapIntensity * textureCubeUV( envMap, direction, 0.0 );\n    sampleColorRGB = clamp( sampleColorRGB, 0.0, 1.0);\n    return sampleColorRGB;\n}\n\nvec4 SampleSpecularContributionTest( vec4 specularColor, vec3 direction ) { \n    direction = normalize(direction);\n    direction.x *= -1.0; \n    direction.z *= -1.0;\n    vec4 sampleColorRGB = envMapIntensity * textureCubeUV( envMap, direction, 0.0 );\n\n    //sampleColorRGB.a = 1.0;\n\n    sampleColorRGB = clamp( sampleColorRGB, 0.0, 1.0);\n    return sampleColorRGB;\n}\n\nvec3 intersectSphereTest( vec3 origin, vec3 direction ) {\n    origin -= centreOffset;\n    direction.y /= squashFactor;\n    float A = dot(direction, direction);\n    float B = 2.0*dot(origin, direction);\n    float C = dot(origin, origin) - radius * radius;\n    float disc = B*B - 4.0 * A * C;\n    if(disc > 0.0){ \n        disc = sqrt(disc);\n        float t1 = (-B + disc)*geometryFactor/A;\n        float t2 = (-B - disc)*geometryFactor/A;\n        float t = (t1 > t2) ? t1 : t2;\n        direction.y *= squashFactor;\n        return vec3(origin + centreOffset + direction * t);\n     }\n     return vec3(0.0); \n}\n\nvec3 debugBounces( int count ) { \n    vec3 color = vec3(1.,1.,1.);\n    if(count == 1) color = vec3(0.0,1.0,0.0);\n    else if(count == 2) color = vec3(0.0,0.0,1.0);\n    else if(count == 3) color = vec3(1.0,1.0,0.0);\n    else if(count == 4) color = vec3(0.0,1.0,1.0);\n    else color = vec3(0.0,1.0,0.0); \n    if(count == 0) color = vec3(1.0,0.0,0.0);\n    return color;\n}\n\nvec3 traceRayTest( vec3 origin, vec3 direction, vec3 normal ) { \n\n    mat4 invModelMat = invMat;\n\n    vec3 outColor = vec3(0.0); \n    // Reflect/Refract ray entering the diamond \n    const float n1 = 1.0; \n    const float epsilon = 1e-8;\n    float f0 = (2.4- n1)/(2.4 + n1);\n    f0 *= f0;\n    vec3 attenuationFactor = vec3(1.0);\n    vec3 newDirection = refract( direction, normal, n1/refraction ); \n    vec3 reflectedDirection = reflect(direction, normal);\n    vec3 brdfReflected = BRDF_Specular_GGX_EnvironmentTest(reflectedDirection, normal, vec3(f0), 0.0);\n    vec3 brdfRefracted = BRDF_Specular_GGX_EnvironmentTest(newDirection, -normal, vec3(f0), 0.0);\n    attenuationFactor *= ( vec3(1.0) - brdfRefracted);\n    outColor += SampleSpecularReflectionTest(vec4(1.0), reflectedDirection ).rgb * brdfReflected;\n    int count = 0;\n\n    newDirection = (invModelMat * vec4(newDirection, 0.0)).xyz; \n    newDirection = normalize(newDirection);\n    origin = (invModelMat * vec4(origin, 1.0)).xyz;\n\n    // ray bounces \n    for( int i=0; i<RAY_BOUNCES; i++) { \n\n        vec3 intersectedPos = intersectSphereTest(origin + vec3(epsilon), newDirection);\n        vec3 dist = intersectedPos - origin;\n        vec3 d = normalize(intersectedPos - centreOffset);\n        vec3 mappedNormal = textureCube( normalCube, d ).xyz;\n\n        //vec3 mappedNormal = normalize( vNormal ) * -1.0;\n\n\n        mappedNormal = 2. * mappedNormal - 1.0;\n        //mappedNormal.y += normalOffset;\n        mappedNormal = normalize(mappedNormal);\n        dist = (modelMatrixOn * vec4(dist, 1.)).xyz;\n        float r = sqrt(dot(dist, dist));\n        attenuationFactor *= exp(-r*absorbption);\n        // refract the ray at first intersection \n        vec3 oldOrigin = origin;\n        origin = intersectedPos - normalize(intersectedPos - centreOffset) * distanceOffset;\n        vec3 oldDir = newDirection;\n        newDirection = refract(newDirection, mappedNormal, refraction/n1);\n         \n        if( dot(newDirection, newDirection) == 0.0) { // Total Internal Reflection. Continue inside the diamond\n            newDirection = reflect(oldDir, mappedNormal);\n             //If the ray got trapped even after max iterations, simply sample along the outgoing refraction!\n            if( i == RAY_BOUNCES-1 ) {\n                vec3 brdfReflected = BRDF_Specular_GGX_EnvironmentTest(-oldDir, mappedNormal, vec3(f0), 0.0);\n                vec3 d1 = (modelMatrixOn * vec4(oldDir, 0.0)).xyz;\n                outColor += SampleSpecularContributionTest( vec4(1.0), d1 ).rgb * correction * attenuationFactor  * boost * (vec3(1.0) - brdfReflected);\n                //outColor = vec3(1.,0.,0.);\n                //if(d1.y > 0.95) outColor += d1.y * vec3(1.,0.,0) * attenuationFactor * (vec3(1.0) - brdfReflected) * boost;\n            } \n        \n        } else { // Add the contribution from outgoing ray, and continue the reflected ray inside the diamond \n           vec3 brdfRefracted = BRDF_Specular_GGX_EnvironmentTest(newDirection, -mappedNormal, vec3(f0), 0.0);\n           // outgoing(refracted) ray's contribution\n           vec3 d1 = (modelMatrixOn * vec4(newDirection, 0.0)).xyz;\n           vec3 colorG = SampleSpecularContributionTest(vec4(1.0), d1 ).rgb * ( vec3(1.0) - brdfRefracted);\n           vec3 dir1 = refract(oldDir, mappedNormal, (refraction+aberration)/n1);\n           vec3 dir2 = refract(oldDir, mappedNormal, (refraction-aberration)/n1);\n           vec3 d2 = (modelMatrixOn * vec4(dir1, 0.0)).xyz;\n           vec3 d3 = (modelMatrixOn * vec4(dir2, 0.0)).xyz;\n           vec3 colorR = SampleSpecularContributionTest(vec4(1.0), d2 ).rgb * ( vec3(1.0) - brdfRefracted);\n           vec3 colorB = SampleSpecularContributionTest(vec4(1.0), d3 ).rgb * ( vec3(1.0) - brdfRefracted);\n           outColor += vec3(colorR.r, colorG.g, colorB.b) * correction * attenuationFactor * boost;\n           //outColor = oldDir;\n           //new reflected ray inside the diamond\n           newDirection = reflect(oldDir, mappedNormal);\n           vec3 brdfReflected = BRDF_Specular_GGX_EnvironmentTest(newDirection, mappedNormal, vec3(f0), 0.0);\n           attenuationFactor *= brdfReflected * boost;\n           count++;\n        } \n    }\n    if(bDebugBounces) outColor = debugBounces(count); \n    //outColor = (textureCube( tCubeMapNormals, direction )).rgb;\n    //outColor = texture2D( sphereMap, vUv ).rgb\n\n    return outColor;\n    \n}\n#endif\nvoid main() {\n\n";class uk extends e.MeshPhysicalMaterial{constructor(t={},i={}){t.metalness=.5,t.roughness=0,t.clearcoat=1,t.side=e.DoubleSide,t.envMapIntensity=1.2,t.reflectivity=1,t.transparent=!0,t.opacity=.7,t.alphaToCoverage=!0,t.sheenColor=16777215,t.sheen=.5,super(t),this.isModif=!1,this.modif(t)}modif(t){if(this.isModif)return;let i=this;t.fillAmount,this.onBeforeCompile=function(t){let s=t.uniforms;s.time={value:0},s.fillAmount={value:-.5},s.topColor={value:new e.Vector4(1,0,0,.7)},s.rimColor={value:new e.Vector4(0,1,0,.5)},s.foamColor={value:new e.Vector4(1,1,1,.9)},s.tint={value:new e.Vector4(1,1,0,.8)},s.rim={value:.1},s.rimPower={value:.5},s.Line={value:.01},s.LineSmooth={value:.1},t.uniforms=s;var n=t.vertexShader;n=(n=(n=dk+n).replace("#include <color_vertex>",pk)).replace("#include <worldpos_vertex>",fk),t.vertexShader=n;var r=t.fragmentShader;r=(r=mk+r).replace("#include <color_fragment>",gk),t.fragmentShader=r,i.userData.shader=t,Pi.modify(t)},this.isModif=!0}dispose(){this.dispatchEvent({type:"dispose"})}}const dk="\nuniform float time;\nuniform float fillAmount;\n\n#define PII 3.1415926538\n\nvarying vec3 fillPosition;\nvarying vec4 vvWorldPosition;\n\nvec4 RotateAroundYInDegrees(vec4 vertex, float degrees)\n{\n   float alpha = degrees * PII / 180.0;\n   float sina = sin(alpha);\n   float cosa = cos(alpha);\n   mat2 m = mat2(cosa, sina, -sina, cosa);\n   return vec4(vertex.yz , m * vertex.xz).xzyw ;                \n}\n\nvec3 RotateAround(vec3 In, vec3 Axis, float degrees )\n{\n    float alpha = degrees * PII / 180.0;\n    float s = sin(alpha);\n    float c = cos(alpha);\n    float one_minus_c = 1.0 - c;\n            \n    mat3 rot_mat = mat3(\n        one_minus_c * Axis.x * Axis.x + c, one_minus_c * Axis.x * Axis.y - Axis.z * s, one_minus_c * Axis.z * Axis.x + Axis.y * s,\n        one_minus_c * Axis.x * Axis.y + Axis.z * s, one_minus_c * Axis.y * Axis.y + c, one_minus_c * Axis.y * Axis.z - Axis.x * s,\n        one_minus_c * Axis.z * Axis.x - Axis.y * s, one_minus_c * Axis.y * Axis.z + Axis.x * s, one_minus_c * Axis.z * Axis.z + c\n    );\n\n    vec3 Out = In * rot_mat;\n    return Out;\n\n}\n",pk="\n#ifdef USE_COLOR\n    vColor = color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n    vColor.xyz = instanceColor.xyz;\n#endif\n",fk="\nvec4 worldPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n    worldPosition = instanceMatrix * worldPosition;\n#endif\nworldPosition = modelMatrix * worldPosition;\n\nvec3 filling = vec3(0.0,fillAmount,0.0);\nvec3 worldPosOffset = worldPosition.xyz - filling;\n// rotate it around XY\n//vec3 worldPosX = RotateAroundYInDegrees(vec4(transformed, 0.0), 360.0).xyz;\nvec3 worldPosX = RotateAround( worldPosOffset, vec3(0.0,0.0,1.0), 90.0 );\n// rotate around XZ\n//vec3 worldPosZ = vec3(worldPosX.y, worldPosX.z, worldPosX.x);\nvec3 worldPosZ = RotateAround( worldPosOffset, vec3(1.0,0.0,0.0), 90.0 );\n// combine rotations with worldPos, based on sine wave from script\n#ifdef USE_INSTANCING_COLOR\nvec3 worldPosAdjusted = worldPosition.xyz + (worldPosX * vColor.x) + (worldPosZ * vColor.z);\n// how high up the liquid is\nfillPosition = worldPosAdjusted - filling;\nfillPosition.y -= vColor.y;\n#endif\nvvWorldPosition = worldPosition;\n",mk="\nuniform vec4 topColor;\nuniform vec4 rimColor;\nuniform vec4 foamColor;\nuniform vec4 tint;\nuniform float rim;\nuniform float rimPower;\nuniform float Line;\nuniform float LineSmooth;\n\nvarying vec3 fillPosition;\nvarying vec4 vvWorldPosition;\n\n",gk="\n// -------- INIT LIQUID SHADER --------\nvec4 col = tint;\n//float dotProduct = 1.0 - pow(dot(worldNormal, viewDirection), rimPower);\n//vec4 RimResult = vec4(smoothstep(0.5, 1.0, dotProduct));\n//RimResult *= rimColor;\n//RimResult *= rimColor.w;\n\nfloat wobble = 0.0;//sin((i.fillPosition.x * _Freq) + (i.fillPosition.z * _Freq ) + ( _Time.y)) * (_Amplitude *wobbleIntensity);  \nfloat movingfillPosition = fillPosition.y + wobble;\n\n// foam edge\nfloat cutoffTop = step(movingfillPosition, 0.5);\nfloat foam = cutoffTop * smoothstep(0.5 - Line - LineSmooth, 0.5 - Line , movingfillPosition);\nvec4 foamColored = foam * foamColor;\n\n// rest of the liquid minus the foam\nfloat result = cutoffTop - foam;\nvec4 resultColored = result * col;\n\n\n// both together, with the texture\nvec4 finalResult = resultColored + foamColored;\nvec4 _topColor = topColor * (foam + result);\n//finalResult.rgb += RimResult.rgb;\n//finalResult *= _topColor;\n\ndiffuseColor.rgb *= finalResult.rgb;\n//diffuseColor *= gl_FrontFacing ? finalResult : _topColor;//_topColor;\n//diffuseColor = finalResult;\n",vk={getColor(t){let e=t.toString();e=e.substring(e.lastIndexOf(".")+1);let i,s=[255,255,255];switch(e){case"grass":s=[.223,.827,.325],i=[.741,.498,.258];break;case"dirt":s=[.741,.498,.258];break;case"leaves":s=[.152,.682,.376];break;case"sand":s=[.878,.819,.686];break;case"ice":s=[.65,.882,.96];break;case"stone":s=[.537,.64,.65];break;case"cobblestone":s=[.666,.647,.588];break;case"wood":s=[.603,.321,.152];break;case"snow":s=[.905,.976,1]}return i?[s[0],s[1],s[2],i[0],i[1],i[2]]:[s[0],s[1],s[2]]},fire:{type:"star",numParticles:20,position:[0,0,0],colors:[1,1,0,0,1,1,0,1,1,0,0,1,1,0,0,1,1,0,0,.5,0,0,0,0],lifeTime:2,timeRange:2,startSize:.3,endSize:.9,velocity:[0,.8,0],velocityRange:[.15,.15,.15],gravity:[0,-.2,0],spinSpeedRange:4},smoke:{position:[-2,-.2,0],colors:[0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0],numParticles:20,lifeTime:2,timeRange:2,startSize:.5,endSize:2,velocity:[0,1.6,0],velocityRange:[.2,0,.2],gravity:[0,-.25,0],spinSpeedRange:4,blending:"normal"},addBlock:{type:"cube",numParticles:30,lifeTime:1.5,endTime:1.5,startTime:0,startSize:.25,endSize:.5,sizeRange:.25,spinSpeedRange:2,radius:.25,velocity:[1,0,1],velocityRange:[.25,0,.25],acceleration:[1,0,1],accelerationRange:[.25,0,.25],gravity:[0,.05,0],tween:"outQuad",blending:"normal",alphaTest:.1},removeBlock:{type:"cube",lifeTime:1.5,endTime:1.5,startTime:0,startSize:.5,sizeRange:.25,endSize:.1,spinSpeedRange:2,accelerationRange:[.5,.5,.5],gravity:[0,-.1,0],tween:"outQuad",blending:"normal",alphaTest:.1},explosion:{colors:[1,0,0,0,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,.5,1,1,1,0],type:"cloud",radius:.5,radiusRange:.5,numParticles:400,positionRange:[2,1,2],lifeTime:3,endTime:4,lifeTimeRange:1,startTime:0,startSize:.1,endSize:2,sizeRange:1,accelerationRange:[1,.3,1],acceleration:[.8,.8,.8],gravity:[0,-.5,0],spinSpeedRange:2,luma:!1},playerMove:{trail:!0,colors:[1,1,1,1,.2,.2,.2,0],type:"round",blending:"normal",numParticles:4,maxParticles:1e3,positionRange:[.2,0,.2],lifeTime:1.5,startSize:.5,endSize:1,sizeRange:.25,velocityRange:[.6,0,.6],gravity:[0,.1,0]},vehicleMove:{trail:!0,colors:[.5,.5,.5,.25,.2,.2,.2,0],type:"round",blending:"normal",numParticles:4,maxParticles:2e3,positionRange:[.25,0,.25],lifeTime:1.5,startSize:.5,endSize:1,sizeRange:.25,velocityRange:[.6,0,.6],gravity:[0,.2,0]},vehicleTrack:{trail:!0,colors:[.2,.2,.2,.1,.2,.2,.2,0],type:"Round2",blending:"normal",startSize:.3,endSize:.3,numParticles:4,maxParticles:2e3,position:[0,-.1,0],lifeTime:6,oriented:!0},underWater:{trail:!0,colors:[1,1,1,1,.5,.5,1,0],type:"bubble",blending:"normal",numParticles:1,maxParticles:1e3,positionRange:[.25,0,.25],lifeTime:1.5,startSize:.1,endSize:.5,sizeRange:.05,velocity:[0,1,0],velocityRange:[1,0,1],acceleration:[.2,0,.2],gravity:[0,1,0]},bazookaFire:{trail:!0,colors:[1,0,0,1,1,1,0,.5,1,1,1,0],type:"round",numParticles:2,maxParticles:600,positionRange:[.1,.1,.1],lifeTime:1.5,startSize:.5,endSize:1,sizeRange:.1,velocityRange:[.6,.6,.6],gravity:[0,.1,0],luma:!1}};function yk(){this.parent=null,this.position=[0,0,0],this.rotation=[0,0,0],this.name="default",this.type="round",this.tween="linear",this.trail=!1,this.model="",this.numParticles=1,this.maxParticles=0,this.numFrames=1,this.frameDuration=1,this.frameStart=0,this.frameStartRange=0,this.timeRange=99999999,this.startTime=null,this.lifeTime=1,this.endTime=-1,this.lifeTimeRange=0,this.sizeRange=0,this.startSize=1,this.startSizeRange=0,this.endSize=1,this.endSizeRange=0,this.pposition=[0,0,0],this.positionRange=[0,0,0],this.velocity=[0,0,0],this.velocityRange=[0,0,0],this.acceleration=[0,0,0],this.accelerationRange=[0,0,0],this.spinStart=0,this.spinStartRange=0,this.spinSpeed=0,this.spinSpeedRange=0,this.colorMult=[1,1,1,1],this.colorMultRange=[0,0,0,0],this.worldVelocity=[0,0,0],this.gravity=[0,0,0],this.oriented=!1,this.orientation=[0,0,0,1],this.colors=[1,1,1,1],this.blending="additive",this.radius=0,this.radiusRange=0,this.tmpRotation=null,this.alphaTest=0,this.renderOrder=0,this.luma=!0,this.depthWrite=!1,this.transparent=!0}const bk={torad:Math.PI/180,todeg:180/Math.PI,random:()=>Math.random(),rand:(t,e)=>t+bk.random()*(e-t),randInt:(t,e)=>t+Math.floor(bk.random()*(e-t+1)),plusMinus:t=>(bk.random()-.5)*t*2,plusMinusVector:t=>{const e=[];let i=t.length;for(;i--;)e.push(bk.plusMinus(t[i]));return e},toTexture:t=>{let i=new e.Texture(t);return i.minFilter=e.LinearFilter,i.magFilter=e.LinearFilter,i.flipY=!1,i.needsUpdate=!0,i},createTextureFromFloats:(t,i,s,n)=>{let r=null;if(null==n){const n=new Uint8Array(s.length);let o;for(let t=0;t<s.length;t++)o=255*s[t],n[t]=o;return r=new e.DataTexture(n,t,i,e.RGBAFormat),r.minFilter=e.LinearFilter,r.magFilter=e.LinearFilter,r.needsUpdate=!0,r}return r=n,r}},xk=function(t){let e;switch(t){case"linear":e="float tween( float k ) { return k; }";break;case"inQuad":e="float tween( float k ) { return k * k; }";break;case"outQuad":e="float tween( float k ) { return k * ( 2.0 - k ); }";break;case"inOutQuad":e="float tween( float k ) { \n\t\t\tif ( ( k *= 2.0 ) < 1.0 ) return 0.5 * k * k;\n            return - 0.5 * ( --k * ( k - 2.0 ) - 1.0 ); \n        }";break;case"inCubic":e="float tween( float k ) { return k * k * k; }";break;case"outCubic":e="float tween( float k ) { return --k * k * k + 1.0; }";break;case"inOutCubic":e="float tween( float k ) { \n\t\t\tif ( ( k *= 2.0 ) < 1.0 ) return 0.5 * k * k * k;\n\t\t\treturn 0.5 * ( ( k -= 2.0 ) * k * k + 2.0 ); \n        }";break;case"inQuart":e="float tween( float k ) { return k * k * k * k; }";break;case"outQuart":e="float tween( float k ) { return 1.0 - ( --k * k * k * k ); }";break;case"inOutQuart":e="float tween( float k ) { \n\t\t\tif ( ( k *= 2.0 ) < 1.0) return 0.5 * k * k * k * k;\n\t\t\treturn - 0.5 * ( ( k -= 2.0 ) * k * k * k - 2.0 ); \n        }";break;case"inQuint":e="float tween( float k ) { return k * k * k * k * k; }";break;case"outQuint":e="float tween( float k ) { return --k * k * k * k * k + 1.0; }";break;case"inOutQuint":e="float tween( float k ) { \n\t\t\tif ( ( k *= 2.0 ) < 1.0 ) return 0.5 * k * k * k * k * k;\n\t\t\treturn 0.5 * ( ( k -= 2.0 ) * k * k * k * k + 2.0 );\n        }";break;case"inSine":e="#define PI_90 1.570796326794896\n        float tween( float k ) { float j = k * PI_90; return 1.0 - cos( j ); }";break;case"outSine":e="#define PI_90 1.570796326794896\n\t\tfloat tween( float k ) { float j = k * PI_90; return sin( j ); }";break;case"inOutSine":e="#define M_PI 3.14159265358979323846\n\t\tfloat tween( float k ) { \n\t\t\tfloat j = k * M_PI; return 0.5 * (1.0-cos(j));\n        }";break;case"inExpo":e="float tween( float k ) { return k == 0.0 ? 0.0 : pow( 1024.0, k - 1.0 ); }";break;case"outExpo":e="float tween( float k ) { return k == 1.0 ? 1.0 : 1.0 - pow( 2.0, - 10.0 * k ); }";break;case"inOutExpo":e="float tween( float k ) { \n\t\t\tif ( k == 0.0 ) return 0.0;\n\t\t    if ( k == 1.0 ) return 1.0;\n\t\t    if ( ( k *= 2.0 ) < 1.0 ) return 0.5 * pow( 1024.0, k - 1.0 );\n\t\t    return 0.5 * ( - pow( 2.0, - 10.0 * ( k - 1.0 ) ) + 2.0 );\n        }";break;case"inCirc":e="float tween( float k ) { return 1.0 - sqrt( 1.0 - k * k ); }";break;case"outCirc":e="float tween( float k ) { return sqrt( 1.0 - ( --k * k ) ); }";break;case"inOutCirc":e="float tween( float k ) { \n\t\t\tif ( ( k *= 2.0 ) < 1.0) return - 0.5 * ( sqrt( 1.0 - k * k ) - 1.0 );\n\t\t\treturn 0.5 * ( sqrt( 1.0 - ( k -= 2.0 ) * k ) + 1.0 ); \n        }";break;case"inElastic":e="#define TWO_PI 6.28318530717958647692\n        float tween(float k) {\n\t\t    float s;\n\t\t    float a = 0.1;\n\t\t    float p = 0.4;\n\t\t    if ( k == 0.0 ) return 0.0;\n\t\t    if ( k == 1.0 ) return 1.0;\n\t\t    if ( a < 1.0 ) { a = 1.0; s = p * 0.25; }\n\t\t    else s = p * asin( 1.0 / a ) / TWO_PI;\n\t\t    return - ( a * pow( 2.0, 10.0 * ( k -= 1.0 ) ) * sin( ( k - s ) * TWO_PI / p ) );\n\t\t}";break;case"outElastic":e="#define TWO_PI 6.28318530717958647692\n\t\tfloat tween(float k) {\n\t\t    float s;\n\t\t    float a = 0.1; \n\t\t    float p = 0.4;\n\t\t    if ( k == 0.0 ) return 0.0;\n\t\t    if ( k == 1.0 ) return 1.0;\n\t\t    if ( a < 1.0 ) { a = 1.0; s = p * 0.25; }\n\t\t    else s = p * asin( 1.0 / a ) / TWO_PI;\n\t\t    return ( a * pow( 2.0, - 10.0 * k) * sin( ( k - s ) * TWO_PI / p ) + 1.0 );\n\t\t}";break;case"inOutElastic":e="#define TWO_PI 6.28318530717958647692\n\t\tfloat tween(float k) {\n\t\t    float s;\n\t\t    float a = 0.1;\n\t\t    float p = 0.4;\n\t\t    if ( k == 0.0 ) return 0.0;\n\t\t    if ( k == 1.0 ) return 1.0;\n\t\t    if ( a < 1.0 ) { a = 1.0; s = p * 0.25; }\n\t\t    else s = p * asin( 1.0 / a ) / TWO_PI;\n\t\t    if ( ( k *= 2.0 ) < 1.0 ) return - 0.5 * ( a * pow( 2.0, 10.0 * ( k -= 1.0 ) ) * sin( ( k - s ) * TWO_PI / p ) );\n\t\t    return a * pow( 2.0, -10.0 * ( k -= 1.0 ) ) * sin( ( k - s ) * TWO_PI / p ) * 0.5 + 1.0;\n\t\t}";break;case"inBack":e="float tween(float k) {\n\t\t    float s = 1.70158;\n\t\t    return k * k * ( ( s + 1.0 ) * k - s );\n\t\t}";break;case"outBack":e="float tween(float k) {\n\t\t    float s = 1.70158;\n\t\t    return --k * k * ( ( s + 1.0 ) * k + s ) + 1.0;\n\t\t}";break;case"inOutBack":e="float tween(float k) {\n\t\t    float s = 1.70158 * 1.525;\n\t\t    if ( ( k *= 2.0 ) < 1.0 ) return 0.5 * ( k * k * ( ( s + 1.0 ) * k - s ) );\n\t\t    return 0.5 * ( ( k -= 2.0 ) * k * ( ( s + 1.0 ) * k + s ) + 2.0 );\n\t\t}";break;case"inBounce":e="float outBounce(float k) {\n\t\t    if ( k < ( 1.0 / 2.75 ) ) return 7.5625 * k * k;\n\t\t    else if ( k < ( 2.0 / 2.75 ) ) return 7.5625 * ( k -= ( 1.5 / 2.75 ) ) * k + 0.75;\n\t\t    else if ( k < ( 2.5 / 2.75 ) ) return 7.5625 * ( k -= ( 2.25 / 2.75 ) ) * k + 0.9375;\n\t\t    else return 7.5625 * ( k -= ( 2.625 / 2.75 ) ) * k + 0.984375;\n\t\t}\n\t\tfloat tween(float k) { return 1.0 - outBounce( 1.0 - k ); }";break;case"outBounce":e="float tween(float k) {\n\t\t    if ( k < ( 1.0 / 2.75 ) ) return 7.5625 * k * k;\n\t\t    else if ( k < ( 2.0 / 2.75 ) ) return 7.5625 * ( k -= ( 1.5 / 2.75 ) ) * k + 0.75;\n\t\t    else if ( k < ( 2.5 / 2.75 ) ) return 7.5625 * ( k -= ( 2.25 / 2.75 ) ) * k + 0.9375;\n\t\t    else return 7.5625 * ( k -= ( 2.625 / 2.75 ) ) * k + 0.984375;\n\t\t}";break;case"inOutBounce":e="float outBounce(float k) {\n\t\t    if ( k < ( 1.0 / 2.75 ) ) return 7.5625 * k * k;\n\t\t    else if ( k < ( 2.0 / 2.75 ) ) return 7.5625 * ( k -= ( 1.5 / 2.75 ) ) * k + 0.75;\n\t\t    else if ( k < ( 2.5 / 2.75 ) ) return 7.5625 * ( k -= ( 2.25 / 2.75 ) ) * k + 0.9375;\n\t\t    else return 7.5625 * ( k -= ( 2.625 / 2.75 ) ) * k + 0.984375;\n\t\t}\n\t\tfloat inBounce(float k) { return 1.0 - outBounce( 1.0 - k ); }\n\t\tfloat tween(float k) {\n\t\t    if ( k < 0.5 ) return inBounce( k * 2.0 ) * 0.5;\n\t\t    return outBounce( k * 2.0 - 1.0 ) * 0.5 + 0.5;\n\t\t}"}return e},Ok=[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]],wk=new Float32Array(28);class Sk extends e.Points{constructor(t,e){super(),this.pe=t,this.count=0,this.color=null,this.texture=null,this.localTime=0,this.time=0,this.endTime=-1,this.num=0,this.matrixAutoUpdate=!1,this.frustumCulled=!1,this.receiveShadow=!1,this.castShadow=!1,this.birthIndex=0,this.luma=!0,e&&this.setParameters(e)}setParameters(t){this.validateParameters(t),this.geometry&&this.geometry.dispose(),this.material&&this.material.dispose(),this.name=t.name,this.isTrail=t.trail||!1,this.parameters=t;const e=this.isTrail?t.maxParticles:t.numParticles;this.allocateParticles_(e,t),this.isTrail||this.createParticles_(0,e,t),t.parent?t.parent.add(this):this.pe.scene.add(this)}makeGeometry(t){this.geometry=t.oriented?new e.InstancedBufferGeometry:new e.BufferGeometry,this.isMesh=t.oriented}setColorRamp(t){const e=t.length/4;if(e%1!=0)throw"colorRamp must have multiple of 4 entries";this.color=bk.createTextureFromFloats(e,1,t)}validateParameters(t){var e=new yk;for(let i in t)if(void 0===e[i])throw'unknown particle parameter "'+i+'"';for(let i in e)void 0===t[i]&&(t[i]=e[i])}perParticle(t,e){}birthParticles(t,e){var i=this.parameters.numParticles;this.parameters.pposition=t,this.parameters.startTime=this.time,this.endTime=this.time+this.parameters.lifeTime,e&&this.setColorRamp(e),this.createParticles_(this.birthIndex,i,this.parameters),this.birthIndex+=i,this.birthIndex+i>=this.parameters.maxParticles&&(this.birthIndex=0)}createParticles_(t,i,s){const n=bk.plusMinus,r=bk.plusMinusVector,o=this.interleavedBuffer.array;let a,l=i;for(;l--;){this.perParticle(l,s);let h,c=s.lifeTime+n(s.lifeTimeRange),u=null===s.startTime?l*s.lifeTime/i:s.startTime,d=s.frameStart+n(s.frameStartRange),p=(new e.Vector3).addVectors((new e.Vector3).fromArray(s.pposition),(new e.Vector3).fromArray(r(s.positionRange))),f=(new e.Vector3).addVectors((new e.Vector3).fromArray(s.velocity),(new e.Vector3).fromArray(r(s.velocityRange))),m=(new e.Vector3).addVectors((new e.Vector3).fromArray(s.acceleration),(new e.Vector3).fromArray(r(s.accelerationRange))),g=(new e.Vector4).addVectors((new e.Vector4).fromArray(s.colorMult),(new e.Vector4).fromArray(r(s.colorMultRange))),v=s.spinStart+n(s.spinStartRange),y=s.spinSpeed+n(s.spinSpeedRange),b=s.startSize+n(s.sizeRange||s.startSizeRange),x=s.endSize+n(s.sizeRange||s.endSizeRange),O=(new e.Vector4).fromArray(s.orientation),w=s.positionRange[0]+s.positionRange[1]+s.positionRange[2]===0;if(s.radius){let t=bk.rand(0,2*Math.PI);s.tmpRotation=[90,-t*bk.todeg,90,"YXZ"];let i=s.radius+n(s.radiusRange),r=new e.Vector3(Math.cos(t),0,Math.sin(t)).multiplyScalar(i);w&&(p=r),p.length(),h=m.y,m.multiply(r),m.y=h,h=f.y,f.multiply(r)}s.tmpRotation&&(O=(new e.Quaternion).setFromEuler(new e.Euler(s.tmpRotation[0]*bk.torad,s.tmpRotation[1]*bk.torad,s.tmpRotation[2]*bk.torad,s.tmpRotation[3]))),a=0+28*l*4+28*t*4,o[0+a]=p.x,o[0+a+1]=p.y,o[0+a+2]=p.z,o[0+a+3]=u,o[4+a]=Ok[0][0],o[4+a+1]=Ok[0][1],o[4+a+2]=c,o[4+a+3]=d,o[8+a]=f.x,o[8+a+1]=f.y,o[8+a+2]=f.z,o[8+a+3]=b,o[12+a]=m.x,o[12+a+1]=m.y,o[12+a+2]=m.z,o[12+a+3]=x,o[16+a]=v,o[16+a+1]=y,o[16+a+2]=0,o[16+a+3]=0,o[20+a]=O.x,o[20+a+1]=O.y,o[20+a+2]=O.z,o[20+a+3]=O.w,o[24+a]=g.x,o[24+a+1]=g.y,o[24+a+2]=g.z,o[24+a+3]=g.w}this.interleavedBuffer.needsUpdate=!0,this.material.uniforms.worldVelocity.value.fromArray(s.worldVelocity),this.material.uniforms.gravity.value.fromArray(s.gravity),this.material.uniforms.timeRange.value=s.timeRange,this.material.uniforms.frameDuration.value=s.frameDuration,this.material.uniforms.numFrames.value=s.numFrames,this.material.uniforms.rampSampler.value=this.color,this.material.uniforms.colorSampler.value=this.texture,this.material.blending="normal"===s.blending?e.NormalBlending:e.AdditiveBlending,this.updateMatrix()}allocateParticles_(t,i){if(this.count!==t){if(i.oriented||(i.oriented=!1),i.position&&this.position.fromArray(i.position),i.rotation&&this.quaternion.setFromEuler(new e.Euler(i.rotation[0]*bk.torad,i.rotation[1]*bk.torad,i.rotation[2]*bk.torad)),this.setColorRamp(i.colors),this.texture=this.pe.textures.make(i.type),this.endTime=i.endTime||-1,this.luma=i.luma,this.makeGeometry(i),this.count=t,i.oriented){var s=new e.InterleavedBuffer(new Float32Array([0,0,0,0,-.5,-.5,0,0,0,0,0,0,.5,-.5,0,0,0,0,0,0,.5,.5,0,0,0,0,0,0,-.5,.5,0,0]),8);this.geometry.setAttribute("position",new e.InterleavedBufferAttribute(s,3,0)),this.geometry.setAttribute("uv",new e.InterleavedBufferAttribute(s,2,4)),this.geometry.setIndex(new e.BufferAttribute(new Uint16Array([0,1,2,0,2,3]),1)),this.interleavedBuffer=new e.InstancedInterleavedBuffer(new Float32Array(t*wk.byteLength),28,1).setUsage(e.DynamicDrawUsage)}else this.interleavedBuffer=new e.InterleavedBuffer(new Float32Array(t*wk.byteLength),28).setUsage(e.DynamicDrawUsage);this.geometry.setAttribute("position",new e.InterleavedBufferAttribute(this.interleavedBuffer,3,0)),this.geometry.setAttribute("startTime",new e.InterleavedBufferAttribute(this.interleavedBuffer,1,3)),this.geometry.setAttribute("uvLifeTimeFrameStart",new e.InterleavedBufferAttribute(this.interleavedBuffer,4,4)),this.geometry.setAttribute("velocityStartSize",new e.InterleavedBufferAttribute(this.interleavedBuffer,4,8)),this.geometry.setAttribute("accelerationEndSize",new e.InterleavedBufferAttribute(this.interleavedBuffer,4,12)),this.geometry.setAttribute("spinStartSpinSpeed",new e.InterleavedBufferAttribute(this.interleavedBuffer,4,16)),this.geometry.setAttribute("orientation",new e.InterleavedBufferAttribute(this.interleavedBuffer,4,20)),this.geometry.setAttribute("colorMult",new e.InterleavedBufferAttribute(this.interleavedBuffer,4,24)),this.geometry.boundingSphere=new e.Sphere,this.geometry.boundingSphere.radius=3;let r=e.AdditiveBlending;switch(i.blending){case"sub":case"subtractive":r=e.SubtractiveBlending;break;case"multi":case"multiply":r=e.MultiplyBlending;break;case"normal":r=e.NormalBlending;break;default:r=e.AdditiveBlending}var n={worldVelocity:{value:new e.Vector3},gravity:{value:new e.Vector3},timeRange:{value:0},time:{value:0},timeOffset:{value:0},frameDuration:{value:0},numFrames:{value:0},rampSampler:{value:null},colorSampler:{value:null},scale:{value:.5*window.innerHeight},luma:{value:this.luma?this.pe.luminosity:1},alphaTest:{value:i.alphaTest}};this.material=new e.ShaderMaterial({defines:{USE_ORIENTATION:i.oriented},uniforms:n,vertexShader:(this.pe.isGl2?"":"\nmat4 inverse(mat4 m) {\n\n    float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n    b00 = a00 * a11 - a01 * a10,\n    b01 = a00 * a12 - a02 * a10,\n    b02 = a00 * a13 - a03 * a10,\n    b03 = a01 * a12 - a02 * a11,\n    b04 = a01 * a13 - a03 * a11,\n    b05 = a02 * a13 - a03 * a12,\n    b06 = a20 * a31 - a21 * a30,\n    b07 = a20 * a32 - a22 * a30,\n    b08 = a20 * a33 - a23 * a30,\n    b09 = a21 * a32 - a22 * a31,\n    b10 = a21 * a33 - a23 * a31,\n    b11 = a22 * a33 - a23 * a32,\n\n  det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4( a11 * b11 - a12 * b10 + a13 * b09, a02 * b10 - a01 * b11 - a03 * b09, a31 * b05 - a32 * b04 + a33 * b03, a22 * b04 - a21 * b05 - a23 * b03, a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07, a32 * b02 - a30 * b05 - a33 * b01, a20 * b05 - a22 * b02 + a23 * b01, a10 * b10 - a11 * b08 + a13 * b06, a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00, a21 * b02 - a20 * b04 - a23 * b00, a11 * b07 - a10 * b09 - a12 * b06, a00 * b09 - a01 * b07 + a02 * b06, a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n")+xk(i.tween||"linear")+"\nprecision mediump float;\nprecision mediump int;\n\n#ifdef USE_ORIENTATION\n\t//uniform mat4 worldViewProjection;\n\t//uniform mat4 world;\n\tattribute vec3 offset;\n\tattribute vec4 orientation;\n#else\n    uniform float scale;\n#endif\n\nuniform vec3 worldVelocity;\nuniform vec3 gravity;\nuniform float timeRange;\nuniform float time;\nuniform float timeOffset;\nuniform float frameDuration;\nuniform float numFrames;\n\nattribute vec4 uvLifeTimeFrameStart;\nattribute float startTime;\nattribute vec4 velocityStartSize;\nattribute vec4 accelerationEndSize;\nattribute vec4 spinStartSpinSpeed;\nattribute vec4 colorMult;\n\nvarying vec2 outputTexcoord;\nvarying float outputPercentLife;\nvarying vec4 outputColorMult;\nvarying mat2 rotationMtx;\n\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n//#include <clipping_planes_pars_vertex>\n\nvec3 lerp( vec3 a, vec3 b, float p ){ return a + (b - a) * p; }\n\nvoid main() \n{\n    float lifeTime = uvLifeTimeFrameStart.z;\n    float frameStart = uvLifeTimeFrameStart.w;\n    float startSize = velocityStartSize.w;\n\n    //vec3 velocity = (modelMatrix * vec4(velocityStartSize.xyz, 0.0)).xyz + worldVelocity;\n\t//vec3 acceleration = (modelMatrix * vec4(accelerationEndSize.xyz, 0.0)).xyz + gravity;\n\n    //vec3 velocity = velocityStartSize.xyz + worldVelocity;\n\t//vec3 acceleration = accelerationEndSize.xyz + gravity;\n\n\tvec3 velocity = velocityStartSize.xyz + (inverse(modelMatrix) * vec4(worldVelocity, 0.0)).xyz;\n\tvec3 acceleration = accelerationEndSize.xyz + (inverse(modelMatrix) * vec4(gravity, 0.0)).xyz;\n\n    float endSize = accelerationEndSize.w;\n    float spinStart = spinStartSpinSpeed.x;\n    float spinSpeed = spinStartSpinSpeed.y;\n\n    float localTime = mod((time - timeOffset - startTime), timeRange);\n    //localTime = tween( localTime );\n    float percentLife = localTime / lifeTime;\n    percentLife = tween( percentLife );\n\n    vec3 posEnd = velocity * lifeTime + acceleration * lifeTime * lifeTime;\n\n    float frame = mod(floor(localTime / frameDuration + frameStart), numFrames);\n    float uOffset = frame / numFrames;\n    float u = uOffset + (uv.x + 0.5) * (1. / numFrames);\n\n    outputTexcoord = vec2(u, uv.y + 0.5);\n    outputColorMult = colorMult;\n\n    float size = mix(startSize, endSize, percentLife);\n\tsize = (percentLife < 0. || percentLife > 1.0) ? 0.0 : size;\n\n\tfloat s = sin(spinStart + spinSpeed * localTime);\n\tfloat c = cos(spinStart + spinSpeed * localTime);\n\n    #ifdef USE_ORIENTATION\n\t\t\n\t\tvec4 rotatedPoint = vec4((uv.x * c + uv.y * s) * size, 0., (uv.x * s - uv.y * c) * size, 1.);\n\t\t//vec3 center = velocity * localTime + acceleration * localTime * localTime + position + offset;\n\t\tvec3 center = (posEnd * percentLife) + position + offset;\n\n\t\tvec4 q2 = orientation + orientation;\n\t\tvec4 qx = orientation.xxxw * q2.xyzx;\n\t\tvec4 qy = orientation.xyyw * q2.xyzy;\n\t\tvec4 qz = orientation.xxzw * q2.xxzz;\n\n\t\tmat4 localMatrix = mat4(\n\t\t    (1.0 - qy.y) - qz.z,  qx.y + qz.w,  qx.z - qy.w, 0,\n\t\t    qx.y - qz.w, (1.0 - qx.x) - qz.z, qy.z + qx.w, 0,\n\t\t    qx.z + qy.w, qy.z - qx.w, (1.0 - qx.x) - qy.y, 0,\n\t\t    center.x, center.y, center.z, 1\n\t\t);\n\t\trotatedPoint = localMatrix * rotatedPoint;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * rotatedPoint;\n\n\t#else\n\n\t    //vec3 pos = position + velocity * localTime + acceleration * localTime * localTime;\n\n\t    vec3 pos = (posEnd * percentLife) + position;\n\t    \n\t    vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );\n        //gl_PointSize = size * 1.5 * ( scale / length( mvPosition.xyz ) );\n        gl_PointSize = size * 1.5 * ( scale / - mvPosition.z );\n\n        mat2 r = mat2( c, -s, s, c);\n        r *= 0.5; r += 0.5;  r = r * 2.0 - 1.0;\n        rotationMtx = r;\n\n        gl_Position = projectionMatrix * mvPosition;\n\n\t#endif\n\n\toutputPercentLife = percentLife;\n\n\t#include <logdepthbuf_vertex>\n\t//#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\n\nuniform sampler2D rampSampler;\nuniform sampler2D colorSampler;\nuniform float luma;\nuniform float alphaTest;\n\nvarying vec2 outputTexcoord;\nvarying float outputPercentLife;\nvarying vec4 outputColorMult;\nvarying mat2 rotationMtx;\n\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n//#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t//#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\n\tvec4 diffuseColor = texture2D( rampSampler, vec2(outputPercentLife, 0.5) ) * outputColorMult;\n\n    vec2 uv = vec2(0.0);\n    #ifdef USE_ORIENTATION\n        uv = outputTexcoord;\n\t#else\n\t    uv = gl_PointCoord;\n\t    uv -= 0.5; uv = uv * rotationMtx; uv += 0.5;\n\t#endif\n\n\t// texture\n\tdiffuseColor *= texture2D( colorSampler, uv );\n\n\tif ( diffuseColor.a < alphaTest ) discard;\n\n\tdiffuseColor.rgb *= luma;\n\n\tgl_FragColor = diffuseColor; \n\t#include <fog_fragment>\n\n}\n",side:i.oriented?e.DoubleSide:e.FrontSide,blending:r,depthTest:!0,depthWrite:i.depthWrite,transparent:i.transparent}),this.renderOrder=i.renderOrder||0}}draw(t=0){if(!this.material.uniforms)return;const e=this.material.uniforms;this.time+=this.pe.delta,e.time.value=this.time,e.timeOffset.value=t,e.scale.value=this.pe.hscale,e.luma.value=this.luma?this.pe.luminosity:1,-1!==this.endTime&&this.time>=this.endTime&&this.pe.remove(this.name)}dispose(){this.parent.remove(this),this.geometry.dispose(),this.material.dispose(),this.color.dispose()}raycast(){}clone(t){return void 0===t&&(t=this.pe.createEmitter(this.texture)),t.time=0,t.endTime=this.endTime,t.geometry=this.geometry,t.material=this.material.clone(),t.material.uniforms.rampSampler.value=this.color,t.material.uniforms.colorSampler.value=this.texture,super.copy(t),this.num++,t.name=this.name+this.num,t}}class kk extends Map{constructor(){super()}dispose(){this.forEach((t=>{t.dispose()})),this.clear()}make(t){if(!this.has(t)){let e=this["make"+t[0].toUpperCase()+t.substring(1)]();this.set(t,e)}return this.get(t)}makePixel(){const t=[];for(let e=0;e<2;++e)for(let e=0;e<2;++e)t.push(1,1,1,1);return bk.createTextureFromFloats(2,2,t)}makeBasic(){const t=[0,.2,.7,1,.7,.2,0,0],e=[];for(let i=0;i<8;++i)for(let s=0;s<8;++s){let n=t[s]*t[i];e.push(n,n,n,1)}return bk.createTextureFromFloats(8,8,e)}makeCube(){let t=document.createElement("canvas");t.width=t.height=8;const e=t.getContext("2d");return e.fillStyle="rgba(255,255,255,1.0)",e.fillRect(2,2,4,4),bk.toTexture(t)}makeCloud(){let t=16,e=document.createElement("canvas");e.width=e.height=t;const i=e.getContext("2d");let s="rgba(255,255,255,1)",n="rgba(255,255,255,0)",r=i.createRadialGradient(8,6.4,0,8,6.4,6.4);return r.addColorStop(.3,s),r.addColorStop(1,n),i.fillStyle=r,i.fillRect(0,0,t,t),r=i.createRadialGradient(6.4,9.92,0,6.4,9.92,5.6),r.addColorStop(.3,s),r.addColorStop(1,n),i.fillStyle=r,i.fillRect(0,0,t,t),r=i.createRadialGradient(4.32,6.4,0,4.32,6.4,4.16),r.addColorStop(.2,s),r.addColorStop(1,n),i.fillStyle=r,i.fillRect(0,0,t,t),r=i.createRadialGradient(12.16,9.6,0,12.16,9.6,3.68),r.addColorStop(.2,s),r.addColorStop(1,n),i.fillStyle=r,i.fillRect(0,0,t,t),bk.toTexture(e)}makeRound(){let t=document.createElement("canvas");t.width=t.height=16;const e=t.getContext("2d"),i=e.createRadialGradient(8,8,0,8,8,8);return i.addColorStop(0,"rgba(255,255,255,1)"),i.addColorStop(.3,"rgba(255,255,255,0.1)"),i.addColorStop(.9,"rgba(255,255,255,0)"),i.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=i,e.fillRect(0,0,16,16),bk.toTexture(t)}makeRound2(){let t=document.createElement("canvas");t.width=t.height=16;const e=t.getContext("2d"),i=e.createRadialGradient(8,8,0,8,8,8);return i.addColorStop(0,"rgba(255,255,255,1)"),i.addColorStop(.9,"rgba(255,255,255,1)"),i.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=i,e.fillRect(0,0,16,16),bk.toTexture(t)}makeDonut(){let t=document.createElement("canvas");t.width=t.height=32;const e=t.getContext("2d"),i=e.createRadialGradient(16,16,0,16,16,16);return i.addColorStop(0,"rgba(255,255,255,1)"),i.addColorStop(.9,"rgba(255,255,255,0.1)"),i.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=i,e.beginPath(),e.arc(16,16,16,0,2*Math.PI,!1),e.arc(16,16,8,0,2*Math.PI,!0),e.fill(),bk.toTexture(t)}makeBubble(){let t=document.createElement("canvas");t.width=t.height=64;let e="rgba(0,255,255,0)";const i=t.getContext("2d"),s=i.createRadialGradient(25.6,25.6,0,32,32,32);return s.addColorStop(.4,e),s.addColorStop(.9,"rgba(0,255,255,0.6)"),s.addColorStop(.99,"rgba(0,255,255,1)"),s.addColorStop(1,e),i.fillStyle=s,i.fillRect(0,0,64,64),i.fillStyle="rgba(255,255,255,1)",i.beginPath(),i.arc(44.8,25.6,8.96,0,2*Math.PI,!1),i.fill(),i.beginPath(),i.arc(12.8,41.6,3.2,0,2*Math.PI,!1),i.fill(),bk.toTexture(t)}makeSmoke(){let t=document.createElement("canvas");t.width=t.height=64;const e=t.getContext("2d");let i=new Image;i.src=Ak;let s=bk.toTexture(t);return i.onload=function(){e.drawImage(i,0,0),s.needsUpdate=!0},s}makeCircle(){let t=document.createElement("canvas");t.width=t.height=64;const e=t.getContext("2d");return e.strokeStyle="white",e.lineWidth=4,e.beginPath(),e.arc(32,32,30,0,2*Math.PI),e.stroke(),bk.toTexture(t)}makeField(){let t=document.createElement("canvas");t.width=t.height=64;const e=t.getContext("2d"),i=e.createLinearGradient(0,0,0,64);return i.addColorStop(0,"rgba(255,255,255,0)"),i.addColorStop(.8,"rgba(255,255,255,0.4)"),i.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=i,e.fillRect(24,0,16,64),bk.toTexture(t)}makeStar(){let t=document.createElement("canvas");t.width=t.height=64;const e=t.getContext("2d"),i=e.createRadialGradient(32,32,0,32,32,32);return i.addColorStop(0,"rgba(255,255,255,0.5)"),i.addColorStop(.5,"rgba(255,255,255,0.1)"),i.addColorStop(.9,"rgba(255,255,255,0)"),e.fillStyle=i,this.star(e,32,6.4,32,32,3),this.star(e,32,25.6,32,32,3),bk.toTexture(t)}makeOcto(){let t=document.createElement("canvas");t.width=t.height=64;const e=t.getContext("2d"),i=e.createRadialGradient(32,32,0,32,32,32);return i.addColorStop(.4,"rgba(255,255,255,0.2)"),i.addColorStop(1,"rgba(255,255,255,0.4)"),e.fillStyle=i,this.star(e,25.6,22.4,32,32,6),e.strokeStyle="rgba(255,255,255,0.1)",e.lineWidth=6,e.stroke(),bk.toTexture(t)}star(t,e,i,s,n,r){let o,a,l;t.beginPath(),t.moveTo(s+e,n);for(var h=1;h<=2*r;h++)h%2==0?(l=h*(2*Math.PI)/(2*r),o=s+e*Math.cos(l),a=n+e*Math.sin(l)):(l=h*(2*Math.PI)/(2*r),o=s+i*Math.cos(l),a=n+i*Math.sin(l)),t.lineTo(o,a);t.closePath(),t.fill()}}const Ak="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAPOklEQVR42rWb224dRRaGq\n7r30Tu2Y5MhmYsZRZqbeahBiCvgPnCBOCeAEEjcI/E2vAfiYqJJgIHE2/Y+Vk2tzf9Ji2XZDsmkpeXu3V1dXf9f61Sr2316wa3Wmj/++GO\nTrkkvSTo3aDKUdB999JHJoMlEYud72tk13ce53kmmX5PWNr///vvpgw8+yPfv30+llPzee+917Xd68ODBM4+/f1HwbYd04XhgouNqx3re0\nF3rc85DtUntmK6zk7G11XHh0fZns9nk1WqVjYR23J2ennZtn7788sv6UgkA/Hq97mzwbevbbwMzEMBJGPj290HnDrC2qe3IzrV7N2oXSR2\nZ2PN4dNbW972JjSOfnJx0o9EoDwaD+sUXX7w8Ah4+fJgbw7nWCphRztnkDzMr0Wwx8ISWVNvTXrNv14xI7u+4LmLpE82xbcd+A50nk0kdj\n8fJCHnzzTfTN998U18KAW+88UY+OjoypjsNdtTGMLQJYXYBDUjTjqC+nYD1XtVbu7Ht23lIsfPW936TiZ0HOP3YRLTNNKG2LW2aVp6dnqZ\n/vfZa/fbbb//vBJiDMcbtgTv71aDs2IMvkl4AbKDJ9tZW94w0k0nmcsOO7bp+j0TErO1nOgeRmIqZQ3UkNlOYp58eP0qL5bJ+99139YUJ+\nP77702l8ttvv51ff/31bjab5f39/a7h3wFv7GP7nfMPqC8qW5htAd8ToKTr+9pXAZ+atH72pCkFMtVmg48Ag55Rt9tt3pRSbx4epPv3H+T\nPP/+8mrP89NNPn48AA95sKw+Hw7xcLvPh4WG3t7eXmhb0+AER4L3/UOKdYFbbPQOs6xknh1MUMfQ71bkiDaO/KvFRZrsD1Hf1xmy2PTy8m\nc0pWli07cMPP4SEP0fAu+++m9ssAz5Pp1MzAXuone+c+mcAAEr9V+0xh5ns3druOe0ZVbv++zERoUdbpOreufZ6Bu1LbVsjoLTxFXtuKaV\nmF1v/NAE//PCDObtk4J8+fZru3LnTNfXPTc0MuBExMBNgxph5+YbeacN0Z+8pT2qqaIYBu6H7JtYmy/tLcJY7LfBaBpkci6zN76aSa3DC6\nbkJuHfvns18Oj8/z/P5PN29e7c3AizWNsmEJ0DrgcwMmnBDx5yHgJGAkzNwL2qfaEN/zvvzLHwBJlDYk1hJc5KN+Zl9wOPHj/Nbb72VF4t\nFMqfSJN26das7Pj7uBDzLAe5mzhwbaqvBzQAmQBBVNPO3mhziH3R96tp2uncm4N6nmPbZPWvA4hjdcRZwSLDUOX3yySfPRsBXX31l6tKSi\n3GaTmfN9g924Jsz9NmeATcbTnr4K03+0eS2AwEJaEMS+L/p2mmTousHTY5s77z/EBIEHFNgNrdEADcBbBXnye9nIoDts88+a1502Lz/yLx\n+3zIt4rl1aLO/51TxZpN/Nvm7wJ+LfYvtM9vL8++3xsf2WwNeYCYCuqd8YExYM6J1viOlJqSi8oRT38Y0BALIqdCCawkwtd85+G4X5bu+R\nX2lqR2q6LzrRMDvaqbO9PChG3wvMzlq+4NUKzNETnCg/ZA0mO51Du1Z2vBEAODxA7TBNOgju8VWtRUlJFxKQGtkM52hAG+q2TQQE2K+4vq\nrTf5CMqP9mFlxWeG+zW7F4THrzjG6sBjziixwC5PWbi3wtIWMVZOiBZT1h6ZU7a8mwICLva4dDGgjsH9tcstASI2P5KTMBI6lytPWybQaM\nFskaXZqO6e21nfVnri+lmrPlBsAyGSsxVYncGcysRVpsPcBkmrgyTad06xXEQD4rIXHrB0NmzCbNpA7Lvk4tt8Cf2gDx4sbcFP1LIIEaso\nCiDiv2L0SiIna9HZeA06ocq311EzA5RhbgTtX25Eky/aL4WlixxtpzPZSAnTB1H/MzMrmqmb9WECxa0LdDQjQAAa0IaZr1WbgR5yzKZKNk\nvtjCpgb8R1Vt/b4lTFaAilyxGM0Aa2wRZj8BqZxrQbsCViV0Pmr2ncCfSwSpiQ72DGgdT+eewx4BxBCmHnsH8FubdYP3RpiWWs9MVDSwCM\nIwDnqEUVttiKhxHDYB/CEExzPvpzbEbMPYInXhJ4Bh7oAMvAAQ2aIWbB1FD1Ybvt1hsBh0zM3tuzMp9CuyVIkFJMLBAC+2kSlDAl7YvUVN\n8PTkOWh5iP6Ql19Dc9XiaKHD+cK99LepcUrSYdPCmk096+UYJ0T1Ru+FVHjAgEsFSlJ5STV1AMkexJ+Q8bEgc8BTGJgYZZzJILjIPSJhi7\nl+akTohFDgV4TCgV+ASHyE7oeCCilsKQdNfDYsLdjzmGnFD1nzM4ldT7AebBe2OL5DgE7lR9MwfVXQypcHQlryZmZAATJB3Bf2tXbvXfFk\nzuwPmxBCFrRexAcR3XHriPweG/Yxy0z44B3oFJIhM4VwRYco/4mfyCg5ceoPwMO+zBoPDkq6BxbsN84o33s6wrANYIPYwF8hQyBXDkS5k1\nOjASIwkmTDnsC6DiWtHyUsGMywL1QAq9h9qNtR9WOYCIZRJN4Lap4If/HSZIuC/wTaQAEEA53aYiREDVggODdA7CZZXgu6ekYBGEngI4zG\nDeARo2IfiX5NNcdF8BpjwN8auC1xxkWHwW8BpD7Q0DvvHzPAJWCjmuq45zyGPWP6oq6M2gGGK6zlUsIyvE8M49msAc4CRAE1Fqf5Jznvk5\nwqQ/ggVRecTaAQTt8FMiJWj0DdKrvPLPi8JaiZvDg0TzYIhGAAwzgVxYeqf6wWML+2/kzTxraEwnABdgegIPg8SeszRvwvSb7So6IGBlwJ\ngK9Id3lAdFEop+4wkQAsXZkFmxeE7cR+FMtnObtvHOA9HExDCZMAEAhvFGYzJSuAE97rwXMmDAPfJv4yuwa71/DbBdWeZw3Mpg5A0rI08J\nnIQJ8kkQekDwBdnN0gjGx6STEf9oQCuNM9aFymzwBPO8a8EiJ4RIwqikMCH0ihcRpHULjBkyEQQiICYm30S4scGKGiCNMHrykwjj9egn91\n0tUv9qmWS/BZIonR9qw1OJnFRKgKnJKLIr0qgF4Aipg48tIVn+sA3CWGsAaH8IAQRM0KZKcaQRoSKgURoPTJLp4AjTjC6W+Oz8gItZMhpb\nHjgCpobSADVUfQgDnRcC+r+UxKzg8SQ5ZYQxxSNyKN4EMQHfORwQJx+da+xdMgCTIRw9INudv0sMGzpAECNaoBKtcFatBgMtBa6JfAVy0/\nwg67itLdaq6zt6XIc9Y6Fqv945FYZC2tKd/+7iiMhBIGJHrMzAqv8w8xRDqf0HVAZwlHPs4nJ2UeC2S4AlWZCHZWVzTZ5YJzBUeF/5ZBn4\n34FgOJw9A3GupiSovN0XGOFaBorML4FNMlIJEP1QFIprLhvhOe2npxNoqAXqiPs0kfm3X5+3KihenmL1JJCChyiEhwr4PAR8iBGSi/hFIu\nSZFjibC7EftoJK8dZ4dM4QYy/9/bccmv7XrLIm3XrtUbquxKlwbCdF2s3/1Hew8xvUcB891hOtIyPUJo7H/qBXYvG0DJT0PDbgRq7XATyy\nHCYUCbR0U8EJA1AJf0CgskTnHbwZ+hbevkflos5yL/dA+fB5nUlj+4tQE/D/SgCxCfpPtky1Gjaq75XD44tNXbgEQzSIukhJZWIjTyautB\nx8JiWbCfQKdEPry1R/z9E2eKuxx75oQKNL88hlJEADLvQMY1Tb7zC/k6RsHehVUGm3iOM58zBTZs3kNKgrLBXtX9Zd8vwJOoTApDK5jvRB\nt8olQVD1fDI3LYcBWsXzC93p6TcXD1hKWwcEfsOFf4nlAx3UGROeleXa3Cly68hd+jklZ+fsBHwngZFT5HgEYbXR8oj2VJexzKYJKzBdi3\nVHiNSQ60Q0AciYRspw/VcX5X/S8gZ4/17qAfs/1bsC/GYoEsF0sZjIb0aGFslTiCzBXmKiE05jxcR67DoAhwKktYZM3PQkT+K9kqDCdjBA\n5wY1ejvpMMPsPJXwqnAP4dEkeTgaI7fGd0MS9UCnGOKRAABJtPPgTzKtwLhCNZhnAx9qva7U6RZ3hH3SPOce5osJWDlFZoNOAK7Qggu/8C\nlBveW8oC6vKyLZ8RNUEMr3jZPMLGsBCRqWqJEDVacpCBc9fZX4qe9WO+3DoAv4katgFEwgLouioiMdJlTMADUO1J5KWib2Q6olgJgHgica\nBatY8YWu1/012fyo175y/8vn/mUUCCiWMg3+8cHlAICFUZtbrddJXoYWZ452/V2m7jr36d3GQo2tLvvKgYhPMASe6DuaysEovs45NKzWfE\nqIF/t9NfpYjJOwl7XdcXFgMeVOIBJydnSX77lY328CQWAcE4EbHzCzhaIEAIBQsmf1YzFyR4wsgaj4LobrIPB5ZUcSFQsBnbwYNF4uhK7T\nAenv0KLUvRJWKJr684CMEPl4sOL743Q7FCcJjfI3Fbw8Y4VU3ak07/JEnEfWXFLROmkl9IZVS7DtI+xTw0q/EsoGFiB9//DG1DyVT3/fVv\nSgZmWgg5Og4RpPs1G/DQH3CErw64NAA2s0hA63w4ZE+Q4EEKe5bwYrqG/jgBC9qgTeH27dvJ3VQmtqU4XDYt474jLWYkHqhjuTvfBjFmgF\nNCCqPFgAe/xBJAnwN959KqGgV/c5kmTjya78TjERgEsbccrWqv/z8c9o/OBjq32SSr7pCArNuh/xGRRXa8DPk9ZjAGWCYccwgRIu42oTA5\nN8UY4oQR0SxRMjVBNmuJ8Js5uuvv+7MFHwMj6s5acWaNl6FfbE01PgXCm9zpyVr7B+zCNEBcMUVY88k29A+VqbytRpwlXmEjxJZb7Px1ma\ntGUaVS9Zmx4EcoodpyRqtQGhLP8Gn4PBYB5yiBY6guNXnIgCTkJOsLv4jqOaaj5NM9LuSHOWUlyEk4jCLTMXab3B8OFIvgPR+QhKrwHGro\nSr8fFoAGd4HsF7Hthk49opG4OVjfZ/j0rZt2+y4DbSgVSEZox/fnzO9izMPcDAEAp6LDDSBZMMGvml+gvjrFzokS+uUk2lHVOfdrJO2bjY\n6NFEmJxIgwAvA/TMrYL2wQcALb1ETmDGfpDDzDPaSLLAivMtbrVZpcX6+y0G6JlnpbAAaS14cAzhsgYCXQAL7uK4v7C8T8gpy9fl8npeNh\nJZ71L7ryUYhwUsKx+T7L5WASAJSEUjBWfK7bQCOIGi/S1lLazadTtPBwUF955179r+A9g9QXq13MV2qXtvxM4Fn+x+D0fC1BkndygAAAAB\nJRU5ErkJggg==";class Tk{constructor(t,e){this.scene=t,this.isGl2=e.capabilities.isWebGL2,this.emitters=new Map,this.textures=new kk,this.now=0,this.last=0,this.delta=0,this.num=0,this.hscale=.5*window.innerHeight,this.luminosity=1}get(t){return this.emitters.has(t)?this.emitters.get(t):null}add(t,e){t.name||(t.name="PP"+this.num++),this.remove(t.name),t.model&&vk[t.model]&&(t={...vk[t.model],...t});let i=new Sk(this,t);return this.emitters.set(t.name,i),i}remove(t){this.emitters.has(t)&&(this.emitters.get(t).dispose(),this.emitters.delete(t))}onresize(t){this.hscale=.5*t}update(t){this.now=void 0!==t?t:Date.now(),this.delta=.001*(this.now-this.last),this.last=this.now,this.emitters.forEach((t=>{t.draw()}))}dispose(){this.emitters.forEach((t=>{t.dispose()})),this.emitters.clear(),this.textures.dispose(),this.num=0}addBlock(t,e){let i=t[1]<=4?-2:0,s=vk.getColor(e),n=s[0],r=s[1],o=s[2];s.length>3&&(n=s[3],r=s[4],o=s[5]),t[0]+=.5,t[2]+=.5,this.add({position:t,colors:[n,r,o,1,n,r,o,0],renderOrder:i,...vk.addBlock})}delBlock(t,e){let i=t[1]<=4?-2:0,s=vk.getColor(e),n=s[0],r=s[1],o=s[2];t[0]+=.5,t[2]+=.5,t[1]+=.5;let a=30;s.length>3&&(a=20,this.add({position:[t[0],t[1]+.375,t[2]],positionRange:[.5,.25,.5],colors:[n,r,o,.5,n,r,o,0],numParticles:10,renderOrder:i,...vk.removeBlock}),n=s[3],r=s[4],o=s[5]),this.add({position:t,positionRange:[.5,.5,.5],colors:[n,r,o,.5,n,r,o,0],numParticles:a,renderOrder:i,...vk.removeBlock})}removePlayerTrail(t){this.remove("PlayerTrail_"+t)}onPlayerWalk(t,e,i){let s=this.get("PlayerTrail_"+e);null===s&&(s=this.addTrail({name:"PlayerTrail_"+e,...vk.playerMove}));let n=t.toArray();n[1]+=.2;let r=vk.getColor(i),o=[r[0],r[1],r[2],.75,r[0],r[1],r[2],0];r.length>3&&(o=[r[0],r[1],r[2],.75,r[3],r[4],r[5],0]),s.birthParticles(n,o)}onVehicleDrive(t,e){let i=this.get("VehicleTrail_"+e);null===i&&(i=this.addTrail({name:"VehicleTrail_"+e,...vk.vehicleMove})),i.birthParticles(t.toArray())}onBazookaFire(t,e){let i=this.get("BazookaTrail_"+e);null===i&&(i=this.addTrail({name:"BazookaTrail_"+e,...vk.bazookaFire})),i.birthParticles(t.toArray())}onExplosion(t){this.add({position:t.toArray(),...vk.explosion})}}
/**
   * @license
   * Copyright 2010-2021 Uil.js Authors
   * SPDX-License-Identifier: MIT
   */const Mk={ui:[],dom:null,ID:null,lock:!1,wlock:!1,current:-1,needReZone:!0,needResize:!1,forceZone:!1,isEventsInit:!1,isLeave:!1,downTime:0,prevTime:0,prevDefault:["contextmenu"],pointerEvent:["pointerdown","pointermove","pointerup"],eventOut:["pointercancel","pointerout","pointerleave"],xmlserializer:null,tmpTime:null,tmpImage:null,oldCursor:"auto",input:null,parent:null,firstImput:!0,hiddenImput:null,hiddenSizer:null,hasFocus:!1,startInput:!1,inputRange:[0,0],cursorId:0,str:"",pos:0,startX:-1,moveX:-1,debugInput:!1,isLoop:!1,listens:[],e:{type:null,clientX:0,clientY:0,keyCode:NaN,key:null,delta:0},isMobile:!1,now:null,getTime:function(){return self.performance&&self.performance.now?self.performance.now.bind(performance):Date.now},add:function(t){Mk.ui.push(t),Mk.getZone(t),Mk.isEventsInit||Mk.initEvents()},testMobile:function(){let t=navigator.userAgent;return!!(t.match(/Android/i)||t.match(/webOS/i)||t.match(/iPhone/i)||t.match(/iPad/i)||t.match(/iPod/i)||t.match(/BlackBerry/i)||t.match(/Windows Phone/i))},remove:function(t){let e=Mk.ui.indexOf(t);-1!==e&&(Mk.removeListen(t),Mk.ui.splice(e,1)),0===Mk.ui.length&&Mk.removeEvents()},initEvents:function(){if(Mk.isEventsInit)return;let t=document.body;Mk.isMobile=Mk.testMobile(),Mk.now=Mk.getTime(),Mk.isMobile?t.style.touchAction="none":t.addEventListener("wheel",Mk,{passive:!1}),t.addEventListener("pointercancel",Mk),t.addEventListener("pointerleave",Mk),t.addEventListener("pointermove",Mk),t.addEventListener("pointerdown",Mk),t.addEventListener("pointerup",Mk),t.addEventListener("keydown",Mk,!1),t.addEventListener("keyup",Mk,!1),window.addEventListener("resize",Mk.resize,!1),Mk.isEventsInit=!0,Mk.dom=t},removeEvents:function(){if(!Mk.isEventsInit)return;let t=document.body;Mk.isMobile||t.removeEventListener("wheel",Mk),t.removeEventListener("pointercancel",Mk),t.removeEventListener("pointerleave",Mk),t.removeEventListener("pointermove",Mk),t.removeEventListener("pointerdown",Mk),t.removeEventListener("pointerup",Mk),t.removeEventListener("keydown",Mk),t.removeEventListener("keyup",Mk),window.removeEventListener("resize",Mk.resize),Mk.isEventsInit=!1},resize:function(){let t,e=Mk.ui.length;for(;e--;)t=Mk.ui[e],t.isGui&&!t.isCanvasOnly&&t.autoResize&&t.calc();Mk.needReZone=!0,Mk.needResize=!1},out:function(){console.log("im am out"),Mk.clearOldID()},in:function(){console.log("im am in")},fakeUp:function(){this.handleEvent({type:"pointerup"})},handleEvent:function(t){-1!==Mk.prevDefault.indexOf(t.type)&&t.preventDefault(),Mk.needResize&&Mk.resize(),Mk.findZone(Mk.forceZone);let e=Mk.e,i=!1;"keydown"===t.type&&Mk.keydown(t),"keyup"===t.type&&Mk.keyup(t),"wheel"===t.type?e.delta=t.deltaY>0?1:-1:e.delta=0;let s=t.pointerType;if(e.clientX=("touch"===s?t.pageX:t.clientX)||0,e.clientY=("touch"===s?t.pageY:t.clientY)||0,e.type=t.type,-1!==Mk.eventOut.indexOf(t.type)&&(i=!0,e.type="mouseup"),"pointerleave"===t.type&&(Mk.isLeave=!0),"pointerdown"===t.type&&(e.type="mousedown"),"pointerup"===t.type&&(e.type="mouseup"),"pointermove"===t.type&&(Mk.isLeave&&(Mk.isLeave=!1,Mk.resize()),e.type="mousemove"),"mousedown"===e.type){if(Mk.downTime=Mk.now(),Mk.downTime-Mk.prevTime<200)return Mk.selectAll(),!1;Mk.prevTime=Mk.downTime,Mk.forceZone=!1}"mousedown"===e.type&&Mk.clearInput(),"mousedown"===e.type&&(Mk.lock=!0),"mouseup"===e.type&&(Mk.lock=!1),Mk.isMobile&&"mousedown"===e.type&&Mk.findID(e),"mousemove"!==e.type||Mk.lock||Mk.findID(e),null!==Mk.ID&&(Mk.ID.isCanvasOnly&&(e.clientX=Mk.ID.mouse.x,e.clientY=Mk.ID.mouse.y),Mk.ID.handleEvent(e)),Mk.isMobile&&"mouseup"===e.type&&Mk.clearOldID(),i&&Mk.clearOldID()},findID:function(t){let e,i,s,n=Mk.ui.length,r=-1;for(;n--;)if(e=Mk.ui[n],e.isCanvasOnly?(i=e.mouse.x,s=e.mouse.y):(i=t.clientX,s=t.clientY),Mk.onZone(e,i,s)){r=n,r!==Mk.current&&(Mk.clearOldID(),Mk.current=r,Mk.ID=e);break}-1===r&&Mk.clearOldID()},clearOldID:function(){Mk.ID&&(Mk.current=-1,Mk.ID.reset(),Mk.ID=null,Mk.cursor())},calcUis:(t,e,i,s=!1)=>{let n,r,o,a=t.length,l=0,h=0,c=0;for(;a--;)n=t[h],h++,!s&&n.isGroup&&n.calcUis(),o=n.margin,n.zone.w=n.w,n.zone.h=n.h+o,n.autoWidth?(l=0,n.zone.x=e.x+n.dx,n.zone.y=i,i+=n.h+o,c+=n.h+o):(0===l&&(c+=n.h+o),n.zone.x=e.x+l,n.zone.y=i,r=Mk.getWidth(n),r?n.zone.w=n.w=r:n.fw&&(n.zone.w=n.w=n.fw),l+=n.zone.w,l>=e.w&&(i+=n.h+o,l=0));return c},findTarget:function(t,e){let i=t.length;for(;i--;)if(Mk.onZone(t[i],e.clientX,e.clientY))return i;return-1},findZone:function(t){if(Mk.needReZone||t){for(var e,i=Mk.ui.length;i--;)e=Mk.ui[i],Mk.getZone(e),e.isGui&&e.calcUis();Mk.needReZone=!1}},onZone:function(t,e,i){if(void 0===e||void 0===i)return!1;let s=t.zone,n=e-s.x,r=i-s.y,o=n>=0&&r>=0&&n<=s.w&&r<=s.h;return o?t.local.set(n,r):t.local.neg(),o},getWidth:function(t){return t.getDom().clientWidth},getZone:function(t){if(t.isCanvasOnly)return;let e=t.getDom().getBoundingClientRect();t.zone={x:e.left,y:e.top,w:e.width,h:e.height}},cursor:function(t){(t=t||"auto")!==Mk.oldCursor&&(document.body.style.cursor=t,Mk.oldCursor=t)},toCanvas:function(t,e,i,s){if(Mk.xmlserializer||(Mk.xmlserializer=new XMLSerializer),s&&null!==Mk.tmpTime&&(clearTimeout(Mk.tmpTime),Mk.tmpTime=null),null!==Mk.tmpTime)return;Mk.lock&&(Mk.tmpTime=setTimeout((function(){Mk.tmpTime=null}),10));let n=!1;e===t.canvas.width&&i===t.canvas.height||(n=!0),null===Mk.tmpImage&&(Mk.tmpImage=new Image);let r=Mk.tmpImage,o=Mk.xmlserializer.serializeToString(t.content),a='<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+i+'"><foreignObject style="pointer-events: none; left:0;" width="100%" height="100%">'+o+"</foreignObject></svg>";r.onload=function(){let s=t.canvas.getContext("2d");n?(t.canvas.width=e,t.canvas.height=i):s.clearRect(0,0,e,i),s.drawImage(this,0,0),t.onDraw()},r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a),r.crossOrigin=""},setHidden:function(){null===Mk.hiddenImput&&(Mk.hiddenImput=document.createElement("input"),Mk.hiddenImput.type="text",Mk.hiddenSizer=document.createElement("div"),document.body.appendChild(Mk.hiddenImput),document.body.appendChild(Mk.hiddenSizer));let t=Mk.debugInput?"":"opacity:0; zIndex:0;",e=Mk.parent.css.txtselect+"padding:0; width:auto; height:auto; left:10px; top:auto; color:#FFF; background:#000;"+t;Mk.hiddenImput.style.cssText=e+"bottom:10px;"+(Mk.debugInput?"":"transform:scale(0);"),Mk.hiddenSizer.style.cssText=e+"bottom:40px;",Mk.hiddenImput.style.width=Mk.input.clientWidth+"px",Mk.hiddenImput.value=Mk.str,Mk.hiddenSizer.innerHTML=Mk.str,Mk.hasFocus=!0},clearHidden:function(t){null!==Mk.hiddenImput&&(Mk.hasFocus=!1)},clickPos:function(t){let e=Mk.str.length,i=0,s=0;for(;e--&&(i+=Mk.textWidth(Mk.str[s]),!(i>=t));)s++;return s},upInput:function(t,e){if(null===Mk.parent)return!1;let i=!1;if(e){let e=Mk.clickPos(t);Mk.moveX=e,-1===Mk.startX?(Mk.startX=e,Mk.cursorId=e,Mk.inputRange=[Mk.startX,Mk.startX]):Mk.moveX!==Mk.startX&&(Mk.startX>Mk.moveX?Mk.inputRange=[Mk.moveX,Mk.startX]:Mk.inputRange=[Mk.startX,Mk.moveX]),i=!0}else-1!==Mk.startX&&(Mk.hasFocus=!0,Mk.hiddenImput.focus(),Mk.hiddenImput.selectionStart=Mk.inputRange[0],Mk.hiddenImput.selectionEnd=Mk.inputRange[1],Mk.startX=-1,i=!0);return i&&Mk.selectParent(),i},selectAll:function(){Mk.parent&&(Mk.str=Mk.input.textContent,Mk.inputRange=[0,Mk.str.length],Mk.hasFocus=!0,Mk.hiddenImput.focus(),Mk.hiddenImput.selectionStart=Mk.inputRange[0],Mk.hiddenImput.selectionEnd=Mk.inputRange[1],Mk.cursorId=Mk.inputRange[1],Mk.selectParent())},selectParent:function(){var t=Mk.textWidth(Mk.str.substring(0,Mk.cursorId)),e=Mk.textWidth(Mk.str.substring(0,Mk.inputRange[0])),i=Mk.textWidth(Mk.str.substring(Mk.inputRange[0],Mk.inputRange[1]));Mk.parent.select(t,e,i,Mk.hiddenSizer.innerHTML)},textWidth:function(t){return null===Mk.hiddenSizer?0:(t=t.replace(/ /g,"&nbsp;"),Mk.hiddenSizer.innerHTML=t,Mk.hiddenSizer.clientWidth)},clearInput:function(){null!==Mk.parent&&(Mk.firstImput||Mk.parent.validate(!0),Mk.clearHidden(),Mk.parent.unselect(),Mk.input.style.background=Mk.parent.colors.back,Mk.input.style.borderColor=Mk.parent.colors.border,Mk.parent.isEdit=!1,Mk.input=null,Mk.parent=null,Mk.str="",Mk.firstImput=!0)},setInput:function(t,e){Mk.clearInput(),Mk.input=t,Mk.parent=e,Mk.input.style.background=Mk.parent.colors.backoff,Mk.input.style.borderColor=Mk.parent.colors.select,Mk.str=Mk.input.textContent,Mk.setHidden()},keydown:function(t){if(null===Mk.parent)return;let e=t.which;t.shiftKey,Mk.firstImput=!1,Mk.hasFocus&&(window.focus(),Mk.hiddenImput.focus()),Mk.parent.isEdit=!0,13===e?Mk.clearInput():Mk.input.isNum?t.keyCode>47&&t.keyCode<58||t.keyCode>95&&t.keyCode<106||190===t.keyCode||110===t.keyCode||8===t.keyCode||109===t.keyCode?Mk.hiddenImput.readOnly=!1:Mk.hiddenImput.readOnly=!0:Mk.hiddenImput.readOnly=!1},keyup:function(t){null!==Mk.parent&&(Mk.str=Mk.hiddenImput.value,Mk.parent.allEqual?Mk.parent.sameStr(Mk.str):Mk.input.textContent=Mk.str,Mk.cursorId=Mk.hiddenImput.selectionStart,Mk.inputRange=[Mk.hiddenImput.selectionStart,Mk.hiddenImput.selectionEnd],Mk.selectParent(),Mk.parent.validate())},loop:function(){Mk.isLoop&&requestAnimationFrame(Mk.loop),Mk.update()},update:function(){let t=Mk.listens.length;for(;t--;)Mk.listens[t].listening()},removeListen:function(t){let e=Mk.listens.indexOf(t);-1!==e&&Mk.listens.splice(e,1),0===Mk.listens.length&&(Mk.isLoop=!1)},addListen:function(t){return-1===Mk.listens.indexOf(t)&&(Mk.listens.push(t),Mk.isLoop||(Mk.isLoop=!0,Mk.loop()),!0)}},Pk=Mk,Ck={transition:.2,frag:document.createDocumentFragment(),colorRing:null,joystick_0:null,joystick_1:null,circular:null,knob:null,pad2d:null,svgns:"http://www.w3.org/2000/svg",links:"http://www.w3.org/1999/xlink",htmls:"http://www.w3.org/1999/xhtml",DOM_SIZE:["height","width","top","left","bottom","right","margin-left","margin-right","margin-top","margin-bottom"],SVG_TYPE_D:["pattern","defs","transform","stop","animate","radialGradient","linearGradient","animateMotion","use","filter","feColorMatrix"],SVG_TYPE_G:["svg","rect","circle","path","polygon","text","g","line","foreignObject"],PI:Math.PI,TwoPI:2*Math.PI,pi90:.5*Math.PI,pi60:Math.PI/3,torad:Math.PI/180,todeg:180/Math.PI,clamp:(t,e,i)=>(t=t<e?e:t)>i?i:t,isDivid:t=>.5*t===Math.floor(.5*t),size:{w:240,h:20,p:30,s:8},defineColor:(t,e=Ck.colors)=>{let i={...e},s=["fontFamily","fontWeight","fontShadow","fontSize"],n=!1;t.font&&(t.fontFamily=t.font),t.shadow&&(t.fontShadow=t.shadow),t.weight&&(t.fontWeight=t.weight),t.fontColor&&(t.text=t.fontColor),t.color&&(t.text=t.color),t.text&&(i.text=t.text,t.fontColor||t.color||(i.title=Ck.ColorLuma(t.text,-.25),i.titleoff=Ck.ColorLuma(t.text,-.5)),i.textOver=Ck.ColorLuma(t.text,.25),i.textSelect=Ck.ColorLuma(t.text,.5)),t.button&&(i.button=t.button,i.border=Ck.ColorLuma(t.button,.1),i.overoff=Ck.ColorLuma(t.button,.2)),t.select&&(i.select=t.select,i.over=Ck.ColorLuma(t.select,-.1)),t.itemBg&&(t.back=t.itemBg),t.back&&(i.back=t.back,i.backoff=Ck.ColorLuma(t.back,-.1)),t.fontSelect&&(i.textSelect=t.fontSelect),t.groupBorder&&(i.gborder=t.groupBorder),t.bgOver&&(i.backgroundOver=t.bgOver);for(let e in i)void 0!==t[e]&&(i[e]=t[e]);for(let e in t)-1!==s.indexOf(e)&&(n=!0);return n&&Ck.defineText(i),i},colors:{sx:4,sy:2,radius:2,showOver:1,content:"none",background:"rgba(50,50,50,0.15)",backgroundOver:"rgba(50,50,50,0.3)",title:"#CCC",titleoff:"#BBB",text:"#DDD",textOver:"#EEE",textSelect:"#FFF",back:"rgba(0,0,0,0.2)",backoff:"rgba(0,0,0,0.3)",border:"#4c4c4c",borderSize:1,gborder:"none",groups:"none",button:"#3c3c3c",overoff:"#5c5c5c",over:"#024699",select:"#308AFF",action:"#FF3300",fontFamily:"Consolas, monospace",fontWeight:"normal",fontShadow:"none",fontSize:12,joyOver:"rgba(48,138,255,0.25)",joyOut:"rgba(100,100,100,0.5)",joySelect:"#308AFF",hide:"rgba(0,0,0,0)"},css:{basic:"position:absolute; pointer-events:none; box-sizing:border-box; margin:0; padding:0; overflow:hidden; -o-user-select:none; -ms-user-select:none; -khtml-user-select:none; -webkit-user-select:none; -moz-user-select:none;",button:"display:flex; align-items:center; justify-content:center; text-align:center;",middle:"display:flex; align-items:center; justify-content:left; text-align:left; flex-direction: row-reverse;"},svgs:{g1:"M 6 4 L 0 4 0 6 6 6 6 4 M 6 0 L 0 0 0 2 6 2 6 0 Z",g2:"M 6 0 L 4 0 4 6 6 6 6 0 M 2 0 L 0 0 0 6 2 6 2 0 Z",group:"M 7 7 L 7 8 8 8 8 7 7 7 M 5 7 L 5 8 6 8 6 7 5 7 M 3 7 L 3 8 4 8 4 7 3 7 M 7 5 L 7 6 8 6 8 5 7 5 M 6 6 L 6 5 5 5 5 6 6 6 M 7 3 L 7 4 8 4 8 3 7 3 M 6 4 L 6 3 5 3 5 4 6 4 M 3 5 L 3 6 4 6 4 5 3 5 M 3 3 L 3 4 4 4 4 3 3 3 Z",arrow:"M 3 8 L 8 5 3 2 3 8 Z",arrowDown:"M 5 8 L 8 3 2 3 5 8 Z",arrowUp:"M 5 2 L 2 7 8 7 5 2 Z",solid:"M 13 10 L 13 1 4 1 1 4 1 13 10 13 13 10 M 11 3 L 11 9 9 11 3 11 3 5 5 3 11 3 Z",body:"M 13 10 L 13 1 4 1 1 4 1 13 10 13 13 10 M 11 3 L 11 9 9 11 3 11 3 5 5 3 11 3 M 5 4 L 4 5 4 10 9 10 10 9 10 4 5 4 Z",vehicle:"M 13 6 L 11 1 3 1 1 6 1 13 3 13 3 11 11 11 11 13 13 13 13 6 M 2.4 6 L 4 2 10 2 11.6 6 2.4 6 M 12 8 L 12 10 10 10 10 8 12 8 M 4 8 L 4 10 2 10 2 8 4 8 Z",articulation:"M 13 9 L 12 9 9 2 9 1 5 1 5 2 2 9 1 9 1 13 5 13 5 9 4 9 6 5 8 5 10 9 9 9 9 13 13 13 13 9 Z",character:"M 13 4 L 12 3 9 4 5 4 2 3 1 4 5 6 5 8 4 13 6 13 7 9 8 13 10 13 9 8 9 6 13 4 M 6 1 L 6 3 8 3 8 1 6 1 Z",terrain:"M 13 8 L 12 7 Q 9.06 -3.67 5.95 4.85 4.04 3.27 2 7 L 1 8 7 13 13 8 M 3 8 Q 3.78 5.420 5.4 6.6 5.20 7.25 5 8 L 7 8 Q 8.39 -0.16 11 8 L 7 11 3 8 Z",joint:"M 7.7 7.7 Q 8 7.45 8 7 8 6.6 7.7 6.3 7.45 6 7 6 6.6 6 6.3 6.3 6 6.6 6 7 6 7.45 6.3 7.7 6.6 8 7 8 7.45 8 7.7 7.7 M 3.35 8.65 L 1 11 3 13 5.35 10.65 Q 6.1 11 7 11 8.28 11 9.25 10.25 L 7.8 8.8 Q 7.45 9 7 9 6.15 9 5.55 8.4 5 7.85 5 7 5 6.54 5.15 6.15 L 3.7 4.7 Q 3 5.712 3 7 3 7.9 3.35 8.65 M 10.25 9.25 Q 11 8.28 11 7 11 6.1 10.65 5.35 L 13 3 11 1 8.65 3.35 Q 7.9 3 7 3 5.7 3 4.7 3.7 L 6.15 5.15 Q 6.54 5 7 5 7.85 5 8.4 5.55 9 6.15 9 7 9 7.45 8.8 7.8 L 10.25 9.25 Z",ray:"M 9 11 L 5 11 5 12 9 12 9 11 M 12 5 L 11 5 11 9 12 9 12 5 M 11.5 10 Q 10.9 10 10.45 10.45 10 10.9 10 11.5 10 12.2 10.45 12.55 10.9 13 11.5 13 12.2 13 12.55 12.55 13 12.2 13 11.5 13 10.9 12.55 10.45 12.2 10 11.5 10 M 9 10 L 10 9 2 1 1 2 9 10 Z",collision:"M 11 12 L 13 10 10 7 13 4 11 2 7.5 5.5 9 7 7.5 8.5 11 12 M 3 2 L 1 4 4 7 1 10 3 12 8 7 3 2 Z",map:"M 13 1 L 1 1 1 13 13 13 13 1 M 12 2 L 12 7 7 7 7 12 2 12 2 7 7 7 7 2 12 2 Z",material:"M 13 1 L 1 1 1 13 13 13 13 1 M 12 2 L 12 7 7 7 7 12 2 12 2 7 7 7 7 2 12 2 Z",texture:"M 13 4 L 13 1 1 1 1 4 5 4 5 13 9 13 9 4 13 4 Z",object:"M 10 1 L 7 4 4 1 1 1 1 13 4 13 4 5 7 8 10 5 10 13 13 13 13 1 10 1 Z",none:"M 9 5 L 5 5 5 9 9 9 9 5 Z",cursor:"M 4 7 L 1 10 1 12 2 13 4 13 7 10 9 14 14 0 0 5 4 7 Z",load:"M 13 8 L 11.5 6.5 9 9 9 3 5 3 5 9 2.5 6.5 1 8 7 14 13 8 M 9 2 L 9 0 5 0 5 2 9 2 Z",save:"M 9 12 L 5 12 5 14 9 14 9 12 M 11.5 7.5 L 13 6 7 0 1 6 2.5 7.5 5 5 5 11 9 11 9 5 11.5 7.5 Z",extern:"M 14 14 L 14 0 0 0 0 14 14 14 M 12 6 L 12 12 2 12 2 6 12 6 M 12 2 L 12 4 2 4 2 2 12 2 Z"},rezone(){Pk.needReZone=!0},getImput:function(){return!!Pk.input},setStyle:function(t){for(var e in t)Ck.colors[e]&&(Ck.colors[e]=t[e]);Ck.setText()},defineText:function(t){Ck.setText(t.fontSize,t.text,t.fontFamily,t.fontShadow,t.fontWeight)},setText:function(t,e,i,s,n){let r=Ck.colors;void 0===i&&(i=r.fontFamily),void 0===t&&(t=r.fontSize),void 0===s&&(s=r.fontShadow),void 0===n&&(n=r.fontWeight),isNaN(t)?-1===t.search("em")&&(t+="px"):t+="px",Ck.css.txt=Ck.css.basic+Ck.css.middle+" font-family:"+i+"; font-weight:"+n+"; font-size:"+t+"; color:"+r.text+"; padding:0px 8px; left:0; top:2px; height:16px; width:100px; overflow:hidden; white-space: nowrap; letter-spacing: normal;","none"!==s&&(Ck.css.txt+=" text-shadow: 1px 1px 1px "+s+";"),Ck.css.txtselect=Ck.css.txt+"padding:0px 4px; border:1px dashed "+r.border+";",Ck.css.item=Ck.css.txt+"padding:0px 4px; position:relative; margin-bottom:1px; "},cloneCss:function(){return{...Ck.css}},clone:function(t){return t.cloneNode(!0)},setSvg:function(t,e,i,s,n){-1===s?t.setAttributeNS(null,e,i):void 0!==n?t.childNodes[s||0].childNodes[n||0].setAttributeNS(null,e,i):t.childNodes[s||0].setAttributeNS(null,e,i)},setCss:function(t,e){for(let i in e)-1!==Ck.DOM_SIZE.indexOf(i)?t.style[i]=e[i]+"px":t.style[i]=e[i]},set:function(t,e){for(let i in e)"txt"===i&&(t.textContent=e[i]),"link"===i?t.setAttributeNS(Ck.links,"xlink:href",e[i]):t.setAttributeNS(null,i,e[i])},get:function(t,e){if(void 0===e)return t;if(!isNaN(e))return t.childNodes[e];if(e instanceof Array){if(2===e.length)return t.childNodes[e[0]].childNodes[e[1]];if(3===e.length)return t.childNodes[e[0]].childNodes[e[1]].childNodes[e[2]]}},dom:function(t,e,i,s,n){return t=t||"div",-1!==Ck.SVG_TYPE_D.indexOf(t)||-1!==Ck.SVG_TYPE_G.indexOf(t)?"svg"===t?(s=document.createElementNS(Ck.svgns,"svg"),Ck.set(s,i)):(void 0===s&&(s=document.createElementNS(Ck.svgns,"svg")),Ck.addAttributes(s,t,i,n)):s=void 0===s?document.createElementNS(Ck.htmls,t):s.appendChild(document.createElementNS(Ck.htmls,t)),e&&(s.style.cssText=e),void 0===n?s:s.childNodes[n||0]},addAttributes:function(t,e,i,s){let n=document.createElementNS(Ck.svgns,e);return Ck.set(n,i),Ck.get(t,s).appendChild(n),-1!==Ck.SVG_TYPE_G.indexOf(e)&&(n.style.pointerEvents="none"),n},clear:function(t){for(Ck.purge(t);t.firstChild;)t.firstChild.firstChild&&Ck.clear(t.firstChild),t.removeChild(t.firstChild)},purge:function(t){let e,i,s=t.attributes;if(s)for(e=s.length;e--;)i=s[e].name,"function"==typeof t[i]&&(t[i]=null);if(s=t.childNodes,s)for(e=s.length;e--;)Ck.purge(t.childNodes[e])},addSVGGlowEffect:function(){if(null!==document.getElementById("UILGlow"))return;let t=Ck.initUILEffects(),e=Ck.addAttributes(t,"filter",{id:"UILGlow",x:"-20%",y:"-20%",width:"140%",height:"140%"});Ck.addAttributes(e,"feGaussianBlur",{in:"SourceGraphic",stdDeviation:"3",result:"uilBlur"});let i=Ck.addAttributes(e,"feMerge",{});for(let t=0;t<=3;t++)Ck.addAttributes(i,"feMergeNode",{in:"uilBlur"});Ck.addAttributes(i,"feMergeNode",{in:"SourceGraphic"})},initUILEffects:function(){let t=document.getElementById("UILSVGEffects");return null===t&&(t=Ck.dom("svg",void 0,{id:"UILSVGEffects",width:"0",height:"0"}),document.body.appendChild(t)),t},ColorLuma:function(t,e){"n"===t&&(t="#000"),(t=String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;let i,s,n="#";for(s=0;s<3;s++)i=parseInt(t.substr(2*s,2),16),i=Math.round(Math.min(Math.max(0,i+i*e),255)).toString(16),n+=("00"+i).substr(i.length);return n},findDeepInver:function(t){return.3*t[0]+.59*t[1]+.11*t[2]<=.6},lerpColor:function(t,e,i){let s={};for(let n=0;n<3;n++)s[n]=t[n]+(e[n]-t[n])*i;return s},hexToHtml:function(t){return"#"+("000000"+(t=void 0===t?0:t).toString(16)).substr(-6)},htmlToHex:function(t){return t.toUpperCase().replace("#","0x")},u255:function(t,e){return parseInt(t.substring(e,e+2),16)/255},u16:function(t,e){return parseInt(t.substring(e,e+1),16)/15},unpack:function(t){return 7==t.length?[Ck.u255(t,1),Ck.u255(t,3),Ck.u255(t,5)]:4==t.length?[Ck.u16(t,1),Ck.u16(t,2),Ck.u16(t,3)]:void 0},p255:function(t){let e=Math.round(255*t).toString(16);return e.length<2&&(e="0"+e),e},pack:function(t){return"#"+Ck.p255(t[0])+Ck.p255(t[1])+Ck.p255(t[2])},htmlRgba:function(t,e){return t=Ck.unpack(t),"rgba("+Math.round(255*t[0])+","+Math.round(255*t[1])+","+Math.round(255*t[2])+","+e+")"},htmlRgb:function(t,e){return"rgb("+Math.round(255*t[0])+","+Math.round(255*t[1])+","+Math.round(255*t[2])+")"},pad:function(t){return 1==t.length&&(t="0"+t),t},rgbToHex:function(t){let e=Math.round(255*t[0]).toString(16),i=Math.round(255*t[1]).toString(16),s=Math.round(255*t[2]).toString(16);return"#"+Ck.pad(e)+Ck.pad(i)+Ck.pad(s)},hueToRgb:function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t},rgbToHsl:function(t){let e=t[0],i=t[1],s=t[2],n=Math.min(e,i,s),r=Math.max(e,i,s),o=r-n,a=0,l=0,h=(n+r)/2;return h>0&&h<1&&(l=o/(h<.5?2*h:2-2*h)),o>0&&(r==e&&r!=i&&(a+=(i-s)/o),r==i&&r!=s&&(a+=2+(s-e)/o),r==s&&r!=e&&(a+=4+(e-i)/o),a/=6),[a,l,h]},hslToRgb:function(t){let e,i,s=t[0],n=t[1],r=t[2];return 0===n?[r,r,r]:(i=r<=.5?r*(n+1):r+n-r*n,e=2*r-i,[Ck.hueToRgb(e,i,s+.33333),Ck.hueToRgb(e,i,s),Ck.hueToRgb(e,i,s-.33333)])},makeGradiant:function(t,e,i,s){Ck.dom(t,null,e,i,0);let n,r=i.childNodes[0].childNodes.length-1;for(let t=0;t<s.length;t++)n=s[t],Ck.dom("stop",null,{offset:n[0]+"%","stop-color":n[1],"stop-opacity":n[2]},i,[0,r])},makePad:function(t){let e=Ck.dom("svg",Ck.css.basic+"position:relative;",{viewBox:"0 0 256 256",width:256,height:256,preserveAspectRatio:"none"});_k.dom("rect","",{x:28,y:28,width:200,height:200,fill:Ck.colors.back},e),_k.dom("rect","",{x:38,y:38,width:180,height:180,fill:Ck.colors.button},e),_k.dom("line","",{x1:38,y1:128,x2:218,y2:128,stroke:Ck.colors.back,"stroke-width":2},e),_k.dom("line","",{x1:128,x2:128,y1:38,y2:218,stroke:Ck.colors.back,"stroke-width":2},e),_k.dom("circle","",{cx:128,cy:128,r:5,stroke:Ck.colors.text,"stroke-width":5,fill:"none"},e),Ck.pad2d=e},makeKnob:function(t){let e=Ck.dom("svg",Ck.css.basic+"position:relative;",{viewBox:"0 0 128 128",width:128,height:128,preserveAspectRatio:"none"});Ck.dom("circle","",{cx:64,cy:64,r:34,fill:Ck.colors.button,stroke:"rgba(0,0,0,0.3)","stroke-width":8},e),Ck.dom("path","",{d:"",stroke:Ck.colors.text,"stroke-width":4,fill:"none","stroke-linecap":"round"},e),Ck.dom("circle","",{cx:64,cy:64,r:41,stroke:"rgba(0,0,0,0.1)","stroke-width":7,fill:"none"},e),Ck.dom("path","",{d:"",stroke:"rgba(255,255,255,0.3)","stroke-width":2,fill:"none","stroke-linecap":"round","stroke-opacity":.5},e),Ck.knob=e},makeCircular:function(t){let e=Ck.dom("svg",Ck.css.basic+"position:relative;",{viewBox:"0 0 128 128",width:128,height:128,preserveAspectRatio:"none"});Ck.dom("circle","",{cx:64,cy:64,r:40,stroke:"rgba(0,0,0,0.1)","stroke-width":10,fill:"none"},e),Ck.dom("path","",{d:"",stroke:Ck.colors.text,"stroke-width":7,fill:"none","stroke-linecap":"butt"},e),Ck.circular=e},makeJoystick:function(t){let e,i=Math.floor(49),s=Math.floor(.6*i),n=Ck.dom("svg",Ck.css.basic+"position:relative;",{viewBox:"0 0 128 128",width:128,height:128,preserveAspectRatio:"none"});if(Ck.dom("defs",null,{},n),Ck.dom("g",null,{},n),0===t){e=[[40,"rgb(0,0,0)",.3],[80,"rgb(0,0,0)",0],[90,"rgb(50,50,50)",.4],[100,"rgb(50,50,50)",0]],Ck.makeGradiant("radialGradient",{id:"grad",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},n,e),e=[[60,"rgb(0,0,0)",.5],[100,"rgb(0,0,0)",0]],Ck.makeGradiant("radialGradient",{id:"gradS",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},n,e);let t=["rgb(40,40,40)","rgb(48,48,48)","rgb(30,30,30)"],r=["rgb(1,90,197)","rgb(3,95,207)","rgb(0,65,167)"];e=[[30,t[0],1],[60,t[1],1],[80,t[1],1],[100,t[2],1]],Ck.makeGradiant("radialGradient",{id:"gradIn",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},n,e),e=[[30,r[0],1],[60,r[1],1],[80,r[1],1],[100,r[2],1]],Ck.makeGradiant("radialGradient",{id:"gradIn2",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},n,e),Ck.dom("circle","",{cx:64,cy:64,r:i,fill:"url(#grad)"},n),Ck.dom("circle","",{cx:69,cy:74,r:s+10,fill:"url(#gradS)"},n),Ck.dom("circle","",{cx:64,cy:64,r:s,fill:"url(#gradIn)"},n),Ck.joystick_0=n}else e=[[69,"rgb(0,0,0)",0],[70,"rgb(0,0,0)",.3],[100,"rgb(0,0,0)",0]],Ck.makeGradiant("radialGradient",{id:"gradX",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},n,e),Ck.dom("circle","",{cx:64,cy:64,r:i,fill:"none",stroke:"rgba(100,100,100,0.25)","stroke-width":"4"},n),Ck.dom("circle","",{cx:64,cy:64,r:s+14,fill:"url(#gradX)"},n),Ck.dom("circle","",{cx:64,cy:64,r:s,fill:"none",stroke:"rgb(100,100,100)","stroke-width":"4"},n),Ck.joystick_1=n},makeColorRing:function(){let t=Ck.dom("svg",Ck.css.basic+"position:relative;",{viewBox:"0 0 256 256",width:256,height:256,preserveAspectRatio:"none"});Ck.dom("defs",null,{},t),Ck.dom("g",null,{},t);let e,i,s,n,r,o,a,l,h,c=8/113/24*Math.PI,u=0,d=[];for(o=0;o<=24;++o){if(s=o/24,n=s*Ck.TwoPI,e=.5*(u+n),i=1/Math.cos(.5*(n-u)),r=[Math.sin(u),-Math.cos(u),Math.sin(e)*i,-Math.cos(e)*i,Math.sin(n),-Math.cos(n)],d[1]=Ck.rgbToHex(Ck.hslToRgb([s,1,.5])),o>0){for(a=6;a--;)r[a]=(113*r[a]+128).toFixed(2);l=" M"+r[0]+" "+r[1]+" Q"+r[2]+" "+r[3]+" "+r[4]+" "+r[5],h=[[0,d[0],1],[100,d[1],1]],Ck.makeGradiant("linearGradient",{id:"G"+o,x1:r[0],y1:r[1],x2:r[4],y2:r[5],gradientUnits:"userSpaceOnUse"},t,h),Ck.dom("path","",{d:l,"stroke-width":30,stroke:"url(#G"+o+")","stroke-linecap":"butt"},t,1)}u=n-c,d[0]=d[1]}h=[[0,"#FFFFFF",1],[50,"#FFFFFF",0],[50,"#000000",0],[100,"#000000",1]],Ck.makeGradiant("linearGradient",{id:"GL0",x1:0,y1:128-84.9,x2:0,y2:212.9,gradientUnits:"userSpaceOnUse"},t,h),h=[[0,"#7f7f7f",1],[50,"#7f7f7f",.5],[100,"#7f7f7f",0]],Ck.makeGradiant("linearGradient",{id:"GL1",x1:78.95,y1:0,x2:226,y2:0,gradientUnits:"userSpaceOnUse"},t,h),Ck.dom("g",null,{"transform-origin":"128px 128px",transform:"rotate(0)"},t),Ck.dom("polygon","",{points:"78.95 43.1 78.95 212.85 226 128",fill:"red"},t,2),Ck.dom("polygon","",{points:"78.95 43.1 78.95 212.85 226 128",fill:"url(#GL1)","stroke-width":1,stroke:"url(#GL1)"},t,2),Ck.dom("polygon","",{points:"78.95 43.1 78.95 212.85 226 128",fill:"url(#GL0)","stroke-width":1,stroke:"url(#GL0)"},t,2),Ck.dom("path","",{d:"M 255.75 136.5 Q 256 132.3 256 128 256 123.7 255.75 119.5 L 241 128 255.75 136.5 Z",fill:"none","stroke-width":2,stroke:"#000"},t,2),Ck.dom("circle","",{cx:128,cy:128,r:6,"stroke-width":2,stroke:"#000",fill:"none"},t),Ck.colorRing=t},icon:function(t,e,i){i=i||40;let s=["<svg xmlns='"+Ck.svgns+"' version='1.1' xmlns:xlink='"+Ck.htmls+"' style='pointer-events:none;' preserveAspectRatio='xMinYMax meet' x='0px' y='0px' width='"+i+"px' height='"+i+"px' viewBox='0 0 256 256'><g>"];switch(t){case"logo":s[1]="<path id='logoin' fill='"+e+"' stroke='none' d='"+Ck.logoFill_d+"'/>";break;case"donate":s[1]="<path id='logoin' fill='"+e+"' stroke='none' d='"+Ck.logo_donate+"'/>";break;case"neo":s[1]="<path id='logoin' fill='"+e+"' stroke='none' d='"+Ck.logo_neo+"'/>";break;case"phy":s[1]="<path id='logoin' stroke='"+e+"' stroke-width='49' stroke-linejoin='round' stroke-linecap='butt' fill='none' d='"+Ck.logo_phy+"'/>";break;case"config":s[1]="<path id='logoin' stroke='"+e+"' stroke-width='49' stroke-linejoin='round' stroke-linecap='butt' fill='none' d='"+Ck.logo_config+"'/>";break;case"github":s[1]="<path id='logoin' fill='"+e+"' stroke='none' d='"+Ck.logo_github+"'/>";break;case"save":s[1]="<path stroke='"+e+"' stroke-width='4' stroke-linejoin='round' stroke-linecap='round' fill='none' d='M 26.125 17 L 20 22.95 14.05 17 M 20 9.95 L 20 22.95'/><path stroke='"+e,s[1]+="' stroke-width='2.5' stroke-linejoin='round' stroke-linecap='round' fill='none' d='M 32.6 23 L 32.6 25.5 Q 32.6 28.5 29.6 28.5 L 10.6 28.5 Q 7.6 28.5 7.6 25.5 L 7.6 23'/>"}return s[2]="</g></svg>",s.join("\n")},logoFill_d:"\n    M 171 150.75 L 171 33.25 155.5 33.25 155.5 150.75 Q 155.5 162.2 147.45 170.2 139.45 178.25 128 178.25 116.6 178.25 108.55 170.2 100.5 162.2 100.5 150.75 \n    L 100.5 33.25 85 33.25 85 150.75 Q 85 168.65 97.55 181.15 110.15 193.75 128 193.75 145.9 193.75 158.4 181.15 171 168.65 171 150.75 \n    M 200 33.25 L 184 33.25 184 150.8 Q 184 174.1 167.6 190.4 151.3 206.8 128 206.8 104.75 206.8 88.3 190.4 72 174.1 72 150.8 L 72 33.25 56 33.25 56 150.75 \n    Q 56 180.55 77.05 201.6 98.2 222.75 128 222.75 157.8 222.75 178.9 201.6 200 180.55 200 150.75 L 200 33.25 Z\n    ",logo_github:"\n    M 180.5 70 Q 186.3 82.4 181.55 96.55 196.5 111.5 189.7 140.65 183.65 168.35 146 172.7 152.5 178.7 152.55 185.9 L 152.55 218.15 Q 152.84 224.56 159.15 223.3 \n    159.21 223.3 159.25 223.3 181.14 216.25 198.7 198.7 228 169.4 228 128 228 86.6 198.7 57.3 169.4 28 128 28 86.6 28 57.3 57.3 28 86.6 28 128 28 169.4 57.3 198.7 74.85 \n    216.25 96.75 223.3 96.78 223.3 96.8 223.3 103.16 224.54 103.45 218.15 L 103.45 200 Q 82.97 203.1 75.1 196.35 69.85 191.65 68.4 185.45 64.27 177.055 59.4 174.15 49.20 \n    166.87 60.8 167.8 69.85 169.61 75.7 180 81.13 188.09 90 188.55 98.18 188.86 103.45 185.9 103.49 178.67 110 172.7 72.33 168.33 66.3 140.65 59.48 111.49 74.45 96.55 69.7 \n    82.41 75.5 70 84.87 68.74 103.15 80 115.125 76.635 128 76.85 140.85 76.65 152.85 80 171.1 68.75 180.5 70 Z\n    ",logo_neo:"\n    M 219 52 L 206 52 206 166 Q 206 183.4 193.75 195.65 181.4 208 164 208 146.6 208 134.35 195.65 122 183.4 122 166 L 122 90 Q 122 77.6 113.15 68.85 104.4 60 92 60 79.55 \n    60 70.75 68.85 62 77.6 62 90 L 62 204 75 204 75 90 Q 75 83 79.95 78 84.95 73 92 73 99 73 104 78 109 83 109 90 L 109 166 Q 109 188.8 125.15 204.85 141.2 221 164 221 \n    186.75 221 202.95 204.85 219 188.8 219 166 L 219 52 M 194 52 L 181 52 181 166 Q 181 173 176.05 178 171.05 183 164 183 157 183 152 178 147 173 147 166 L 147 90 Q 147 \n    67.2 130.85 51.15 114.8 35 92 35 69.25 35 53.05 51.15 37 67.2 37 90 L 37 204 50 204 50 90 Q 50 72.6 62.25 60.35 74.6 48 92 48 109.4 48 121.65 60.35 134 72.6 134 90 L \n    134 166 Q 134 178.4 142.85 187.15 151.6 196 164 196 176.45 196 185.25 187.15 194 178.4 194 166 L 194 52 Z\n    ",logo_phy:"\n    M 103.55 37.95 L 127.95 37.95 Q 162.35 37.95 186.5 55 210.9 72.35 210.9 96.5 210.9 120.65 186.5 137.7 162.35 155 127.95 155 L 127.95 237.95 M 127.95 155 \n    Q 93.55 155 69.15 137.7 45 120.65 45 96.5 45 72.35 69.15 55 70.9 53.8 72.85 52.85 M 127.95 155 L 127.95 37.95\n    ",logo_config:"\n    M 204.35 51.65 L 173.25 82.75 Q 192 101.5 192 128 L 236 128 M 192 128 Q 192 154.55 173.25 173.25 L 204.4 204.4 M 51.65 51.65 L 82.75 82.75 Q 101.5 64 128 64 \n    L 128 20 M 51.6 204.4 L 82.75 173.25 Q 64 154.55 64 128 L 20 128 M 128 236 L 128 192 Q 101.5 192 82.75 173.25 M 64 128 Q 64 101.5 82.75 82.75 M 173.25 173.25 \n    Q 154.55 192 128 192 M 128 64 Q 154.55 64 173.25 82.75\n    ",logo_donate:"\n    M 171.3 80.3 Q 179.5 62.15 171.3 45.8 164.1 32.5 141.35 30.1 L 94.35 30.1 Q 89.35 30.4 88.3 35.15 L 70.5 148.05 Q 70.2 152.5 73.7 152.6 L 100.95 152.6 107 111.6 Q 108.75 \n    106.55 112.6 106.45 130.45 108.05 145.3 103.9 163.35 98.75 171.3 80.3 M 179.8 71.5 Q 178.6 79.75 174.9 87.85 168.45 102.9 151.9 109.15 140.65 113.95 117.55 113 113.15 \n    112.75 111 117.45 L 102.7 169.95 Q 102.45 173.8 105.5 173.85 L 128.95 173.85 Q 132.2 174.2 133.35 169.65 L 138.3 139.95 Q 139.75 135.6 143.1 135.5 146.6 135.75 150.6 135.65 \n    154.55 135.5 157.35 135.1 160.15 134.7 166.75 132.35 181.35 127.4 187.9 111.2 194.25 95.75 189.5 81.95 186.75 74.85 179.8 71.5 M 103.5 209.9 Q 103.5 202.85 99.7 198.85 95.95 \n    194.75 89.4 194.75 82.8 194.75 79.05 198.85 75.3 202.9 75.3 209.9 75.3 216.85 79.05 220.95 82.8 225.05 89.4 225.05 95.95 225.05 99.7 221 103.5 216.95 103.5 209.9 M 95.45 205.5 \n    Q 95.95 207.3 95.95 209.9 95.95 212.65 95.45 214.35 94.95 216 94 217.3 93.1 218.45 91.9 219 90.7 219.55 89.4 219.55 88.15 219.55 86.95 219.05 85.75 218.55 84.8 217.3 83.9 216.15 \n    83.4 214.35 82.85 212.6 82.85 209.9 82.85 207.3 83.4 205.45 83.95 203.55 84.85 202.45 85.9 201.2 86.95 200.75 88.05 200.25 89.4 200.25 90.7 200.25 91.85 200.8 93.05 201.3 94 202.5 \n    94.9 203.65 95.45 205.5 M 153.3 195.35 L 145.3 195.35 135.5 224.45 142.8 224.45 144.6 218.5 153.75 218.5 155.6 224.45 163.1 224.45 153.3 195.35 M 152.15 213.25 L 146.25 213.25 \n    149.2 203.65 152.15 213.25 M 116.75 195.35 L 107.8 195.35 107.8 224.45 114.5 224.45 114.5 204.2 125.7 224.45 132.75 224.45 132.75 195.35 126.05 195.35 126.05 212.05 116.75 195.35 M \n    66.5 197.65 Q 64.15 196.15 61.45 195.75 58.8 195.35 55.75 195.35 L 46.7 195.35 46.7 224.45 55.8 224.45 Q 58.8 224.45 61.5 224.05 64.15 223.6 66.4 222.15 69.15 220.45 70.9 217.2 \n    72.7 214 72.7 209.95 72.7 205.7 71 202.6 69.35 199.5 66.5 197.65 M 64.2 205 Q 65.2 207 65.2 209.9 65.2 212.75 64.25 214.75 63.3 216.75 61.5 217.85 60 218.85 58.3 218.9 56.6 219 \n    54.15 219 L 54 219 54 200.8 54.15 200.8 Q 56.4 200.8 58.05 200.9 59.7 200.95 61.15 201.75 63.2 202.95 64.2 205 M 210.2 195.35 L 190.5 195.35 190.5 224.45 210.2 224.45 210.2 218.9 \n    197.75 218.9 197.75 211.55 209.2 211.55 209.2 206 197.75 206 197.75 200.9 210.2 200.9 210.2 195.35 M 187.5 195.35 L 163 195.35 163 200.9 171.6 200.9 171.6 224.45 178.9 224.45 178.9 \n    200.9 187.5 200.9 187.5 195.35 Z\n    "};Ck.setText();const _k=Ck;(function(t,e){"undefined"!=typeof CSS?CSS.supports(t,"#F00"):"undefined"!=typeof document&&(function(t){(t=t.split("-").filter((function(t){return!!t})).map((function(t){return t[0].toUpperCase()+t.substr(1)})).join(""))[0].toLowerCase(),t.substr(1)}(t),document.body.style)})("caret-color");var Rk=function(t){var e=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,i=0,s={},n={manual:t.Prism&&t.Prism.manual,disableWorkerMessageHandler:t.Prism&&t.Prism.disableWorkerMessageHandler,util:{encode:function t(e){return e instanceof r?new r(e.type,t(e.content),e.alias):Array.isArray(e)?e.map(t):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(t){return Object.prototype.toString.call(t).slice(8,-1)},objId:function(t){return t.__id||Object.defineProperty(t,"__id",{value:++i}),t.__id},clone:function t(e,i){var s,r;switch(i=i||{},n.util.type(e)){case"Object":if(r=n.util.objId(e),i[r])return i[r];for(var o in s={},i[r]=s,e)e.hasOwnProperty(o)&&(s[o]=t(e[o],i));return s;case"Array":return r=n.util.objId(e),i[r]?i[r]:(s=[],i[r]=s,e.forEach((function(e,n){s[n]=t(e,i)})),s);default:return e}},getLanguage:function(t){for(;t;){var i=e.exec(t.className);if(i)return i[1].toLowerCase();t=t.parentElement}return"none"},setLanguage:function(t,i){t.className=t.className.replace(RegExp(e,"gi"),""),t.classList.add("language-"+i)},currentScript:function(){if("undefined"==typeof document)return null;if("currentScript"in document)return document.currentScript;try{throw new Error}catch(s){var t=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(s.stack)||[])[1];if(t){var e=document.getElementsByTagName("script");for(var i in e)if(e[i].src==t)return e[i]}return null}},isActive:function(t,e,i){for(var s="no-"+e;t;){var n=t.classList;if(n.contains(e))return!0;if(n.contains(s))return!1;t=t.parentElement}return!!i}},languages:{plain:s,plaintext:s,text:s,txt:s,extend:function(t,e){var i=n.util.clone(n.languages[t]);for(var s in e)i[s]=e[s];return i},insertBefore:function(t,e,i,s){var r=(s=s||n.languages)[t],o={};for(var a in r)if(r.hasOwnProperty(a)){if(a==e)for(var l in i)i.hasOwnProperty(l)&&(o[l]=i[l]);i.hasOwnProperty(a)||(o[a]=r[a])}var h=s[t];return s[t]=o,n.languages.DFS(n.languages,(function(e,i){i===h&&e!=t&&(this[e]=o)})),o},DFS:function t(e,i,s,r){r=r||{};var o=n.util.objId;for(var a in e)if(e.hasOwnProperty(a)){i.call(e,a,e[a],s||a);var l=e[a],h=n.util.type(l);"Object"!==h||r[o(l)]?"Array"!==h||r[o(l)]||(r[o(l)]=!0,t(l,i,a,r)):(r[o(l)]=!0,t(l,i,null,r))}}},plugins:{},highlightAll:function(t,e){n.highlightAllUnder(document,t,e)},highlightAllUnder:function(t,e,i){var s={callback:i,container:t,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};n.hooks.run("before-highlightall",s),s.elements=Array.prototype.slice.apply(s.container.querySelectorAll(s.selector)),n.hooks.run("before-all-elements-highlight",s);for(var r,o=0;r=s.elements[o++];)n.highlightElement(r,!0===e,s.callback)},highlightElement:function(e,i,s){var r=n.util.getLanguage(e),o=n.languages[r];n.util.setLanguage(e,r);var a=e.parentElement;a&&"pre"===a.nodeName.toLowerCase()&&n.util.setLanguage(a,r);var l={element:e,language:r,grammar:o,code:e.textContent};function h(t){l.highlightedCode=t,n.hooks.run("before-insert",l),l.element.innerHTML=l.highlightedCode,n.hooks.run("after-highlight",l),n.hooks.run("complete",l),s&&s.call(l.element)}if(n.hooks.run("before-sanity-check",l),(a=l.element.parentElement)&&"pre"===a.nodeName.toLowerCase()&&!a.hasAttribute("tabindex")&&a.setAttribute("tabindex","0"),!l.code)return n.hooks.run("complete",l),void(s&&s.call(l.element));if(n.hooks.run("before-highlight",l),l.grammar)if(i&&t.Worker){var c=new Worker(n.filename);c.onmessage=function(t){h(t.data)},c.postMessage(JSON.stringify({language:l.language,code:l.code,immediateClose:!0}))}else h(n.highlight(l.code,l.grammar,l.language));else h(n.util.encode(l.code))},highlight:function(t,e,i){var s={code:t,grammar:e,language:i};if(n.hooks.run("before-tokenize",s),!s.grammar)throw new Error('The language "'+s.language+'" has no grammar.');return s.tokens=n.tokenize(s.code,s.grammar),n.hooks.run("after-tokenize",s),r.stringify(n.util.encode(s.tokens),s.language)},tokenize:function(t,e){var i=e.rest;if(i){for(var s in i)e[s]=i[s];delete e.rest}var h=new function(){var t={value:null,prev:null,next:null},e={value:null,prev:t,next:null};t.next=e,this.head=t,this.tail=e,this.length=0};return a(h,h.head,t),function t(e,i,s,h,c,u){for(var d in s)if(s.hasOwnProperty(d)&&s[d]){var p=s[d];p=Array.isArray(p)?p:[p];for(var f=0;f<p.length;++f){if(u&&u.cause==d+","+f)return;var m=p[f],g=m.inside,v=!!m.lookbehind,y=!!m.greedy,b=m.alias;if(y&&!m.pattern.global){var x=m.pattern.toString().match(/[imsuy]*$/)[0];m.pattern=RegExp(m.pattern.source,x+"g")}for(var O=m.pattern||m,w=h.next,S=c;w!==i.tail&&!(u&&S>=u.reach);S+=w.value.length,w=w.next){var k=w.value;if(i.length>e.length)return;if(!(k instanceof r)){var A,T=1;if(y){if(!(A=o(O,S,e,v))||A.index>=e.length)break;var M=A.index,P=A.index+A[0].length,C=S;for(C+=w.value.length;M>=C;)C+=(w=w.next).value.length;if(S=C-=w.value.length,w.value instanceof r)continue;for(var _=w;_!==i.tail&&(C<P||"string"==typeof _.value);_=_.next)T++,C+=_.value.length;T--,k=e.slice(S,C),A.index-=S}else if(!(A=o(O,0,k,v)))continue;M=A.index;var R=A[0],E=k.slice(0,M),Q=k.slice(M+R.length),L=S+k.length;u&&L>u.reach&&(u.reach=L);var F=w.prev;if(E&&(F=a(i,F,E),S+=E.length),l(i,F,T),w=a(i,F,new r(d,g?n.tokenize(R,g):R,b,R)),Q&&a(i,w,Q),T>1){var I={cause:d+","+f,reach:L};t(e,i,s,w.prev,S,I),u&&I.reach>u.reach&&(u.reach=I.reach)}}}}}}(t,h,e,h.head,0),function(t){for(var e=[],i=t.head.next;i!==t.tail;)e.push(i.value),i=i.next;return e}(h)},hooks:{all:{},add:function(t,e){var i=n.hooks.all;i[t]=i[t]||[],i[t].push(e)},run:function(t,e){var i=n.hooks.all[t];if(i&&i.length)for(var s,r=0;s=i[r++];)s(e)}},Token:r};function r(t,e,i,s){this.type=t,this.content=e,this.alias=i,this.length=0|(s||"").length}function o(t,e,i,s){t.lastIndex=e;var n=t.exec(i);if(n&&s&&n[1]){var r=n[1].length;n.index+=r,n[0]=n[0].slice(r)}return n}function a(t,e,i){var s=e.next,n={value:i,prev:e,next:s};return e.next=n,s.prev=n,t.length++,n}function l(t,e,i){for(var s=e.next,n=0;n<i&&s!==t.tail;n++)s=s.next;e.next=s,s.prev=e,t.length-=n}if(t.Prism=n,r.stringify=function t(e,i){if("string"==typeof e)return e;if(Array.isArray(e)){var s="";return e.forEach((function(e){s+=t(e,i)})),s}var r={type:e.type,content:t(e.content,i),tag:"span",classes:["token",e.type],attributes:{},language:i},o=e.alias;o&&(Array.isArray(o)?Array.prototype.push.apply(r.classes,o):r.classes.push(o)),n.hooks.run("wrap",r);var a="";for(var l in r.attributes)a+=" "+l+'="'+(r.attributes[l]||"").replace(/"/g,"&quot;")+'"';return"<"+r.tag+' class="'+r.classes.join(" ")+'"'+a+">"+r.content+"</"+r.tag+">"},!t.document)return t.addEventListener?(n.disableWorkerMessageHandler||t.addEventListener("message",(function(e){var i=JSON.parse(e.data),s=i.language,r=i.code,o=i.immediateClose;t.postMessage(n.highlight(r,n.languages[s],s)),o&&t.close()}),!1),n):n;var h=n.util.currentScript();function c(){n.manual||n.highlightAll()}if(h&&(n.filename=h.src,h.hasAttribute("data-manual")&&(n.manual=!0)),!n.manual){var u=document.readyState;"loading"===u||"interactive"===u&&h&&h.defer?document.addEventListener("DOMContentLoaded",c):window.requestAnimationFrame?window.requestAnimationFrame(c):window.setTimeout(c,16)}return n}("undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{});"undefined"!=typeof module&&module.exports&&(module.exports=Rk),"undefined"!=typeof global&&(global.Prism=Rk),Rk.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},Rk.languages.markup.tag.inside["attr-value"].inside.entity=Rk.languages.markup.entity,Rk.languages.markup.doctype.inside["internal-subset"].inside=Rk.languages.markup,Rk.hooks.add("wrap",(function(t){"entity"===t.type&&(t.attributes.title=t.content.replace(/&amp;/,"&"))})),Object.defineProperty(Rk.languages.markup.tag,"addInlined",{value:function(t,e){var i={};i["language-"+e]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:Rk.languages[e]},i.cdata=/^<!\[CDATA\[|\]\]>$/i;var s={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:i}};s["language-"+e]={pattern:/[\s\S]+/,inside:Rk.languages[e]};var n={};n[t]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,(function(){return t})),"i"),lookbehind:!0,greedy:!0,inside:s},Rk.languages.insertBefore("markup","cdata",n)}}),Object.defineProperty(Rk.languages.markup.tag,"addAttribute",{value:function(t,e){Rk.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+t+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[e,"language-"+e],inside:Rk.languages[e]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),Rk.languages.html=Rk.languages.markup,Rk.languages.mathml=Rk.languages.markup,Rk.languages.svg=Rk.languages.markup,Rk.languages.xml=Rk.languages.extend("markup",{}),Rk.languages.ssml=Rk.languages.xml,Rk.languages.atom=Rk.languages.xml,Rk.languages.rss=Rk.languages.xml,function(t){var e=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;t.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+e.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+e.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+e.source+"$"),alias:"url"}}},selector:{pattern:RegExp("(^|[{}\\s])[^{}\\s](?:[^{};\"'\\s]|\\s+(?![\\s{])|"+e.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:e,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},t.languages.css.atrule.inside.rest=t.languages.css;var i=t.languages.markup;i&&(i.tag.addInlined("style","css"),i.tag.addAttribute("style","css"))}(Rk),Rk.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},Rk.languages.javascript=Rk.languages.extend("clike",{"class-name":[Rk.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|window|document|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|of|package|private|protected|public|return|static|super|switch|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+/NaN|Infinity|null/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?/}),Rk.languages.javascript["class-name"][0].pattern=/(\b(?:class|interface|extends|implements|instanceof|new|)\s+)[\w.\\]+/,Rk.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:Rk.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},"function-extra":{pattern:/(?:constructor)/,alias:"keyword"},"keyword-variable":{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|continue|debugger|default|delete|do|else|enum|export|default|extends|for|from|(?:get|set)(?=\s*[\[$\w\xA0-\uFFFF])|if|implements|import|in|instanceof|interface|new|of|package|private|protected|public|return|static|super|switch|throw|try|typeof|undefined|void|while|with|yield)\b/,alias:"keyword"},"parameter-variable":{pattern:/this/,alias:"keyword"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:Rk.languages.javascript},{pattern:/(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,inside:Rk.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:Rk.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:Rk.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),Rk.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:Rk.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),Rk.languages.markup&&(Rk.languages.markup.tag.addInlined("script","javascript"),Rk.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),Rk.languages.js=Rk.languages.javascript,Rk.languages.c=Rk.languages.extend("clike",{comment:{pattern:/\/\/(?:[^\r\n\\]|\\(?:\r\n?|\n|(?![\r\n])))*|\/\*[\s\S]*?(?:\*\/|$)/,greedy:!0},string:{pattern:/"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"/,greedy:!0},"class-name":{pattern:/(\b(?:enum|struct)\s+(?:__attribute__\s*\(\([\s\S]*?\)\)\s*)?)\w+|\b[a-z]\w*_t\b/,lookbehind:!0},keyword:/\b(?:_Alignas|_Alignof|_Atomic|_Bool|_Complex|_Generic|_Imaginary|_Noreturn|_Static_assert|_Thread_local|__attribute__|asm|auto|break|case|char|const|continue|default|do|double|else|enum|extern|float|for|goto|if|inline|int|long|register|return|short|signed|sizeof|static|struct|switch|typedef|typeof|union|unsigned|void|volatile|while)\b/,function:/\b[a-z_]\w*(?=\s*\()/i,number:/(?:\b0x(?:[\da-f]+(?:\.[\da-f]*)?|\.[\da-f]+)(?:p[+-]?\d+)?|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?)[ful]{0,4}/i,operator:/>>=?|<<=?|->|([-+&|:])\1|[?:~]|[-+*/%&|^!=<>]=?/}),Rk.languages.insertBefore("c","string",{char:{pattern:/'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n]){0,32}'/,greedy:!0}}),Rk.languages.insertBefore("c","string",{macro:{pattern:/(^[\t ]*)#\s*[a-z](?:[^\r\n\\/]|\/(?!\*)|\/\*(?:[^*]|\*(?!\/))*\*\/|\\(?:\r\n|[\s\S]))*/im,lookbehind:!0,greedy:!0,alias:"property",inside:{string:[{pattern:/^(#\s*include\s*)<[^>]+>/,lookbehind:!0},Rk.languages.c.string],char:Rk.languages.c.char,comment:Rk.languages.c.comment,"macro-name":[{pattern:/(^#\s*define\s+)\w+\b(?!\()/i,lookbehind:!0},{pattern:/(^#\s*define\s+)\w+\b(?=\()/i,lookbehind:!0,alias:"function"}],directive:{pattern:/^(#\s*)[a-z]+/,lookbehind:!0,alias:"keyword"},"directive-hash":/^#/,punctuation:/##|\\(?=[\r\n])/,expression:{pattern:/\S[\s\S]*/,inside:Rk.languages.c}}}}),Rk.languages.insertBefore("c","function",{constant:/\b(?:EOF|NULL|SEEK_CUR|SEEK_END|SEEK_SET|__DATE__|__FILE__|__LINE__|__TIMESTAMP__|__TIME__|__func__|stderr|stdin|stdout)\b/}),delete Rk.languages.c.boolean,Rk.languages.glsl=Rk.languages.extend("c",{keyword:/\b(?:active|asm|atomic_uint|attribute|[ibdu]?vec[234]|bool|break|buffer|case|cast|centroid|class|coherent|common|const|continue|d?mat[234](?:x[234])?|default|discard|do|double|else|enum|extern|external|false|filter|fixed|flat|float|for|fvec[234]|goto|half|highp|hvec[234]|[iu]?sampler2DMS(?:Array)?|[iu]?sampler2DRect|[iu]?samplerBuffer|[iu]?samplerCube|[iu]?samplerCubeArray|[iu]?sampler[123]D|[iu]?sampler[12]DArray|[iu]?image2DMS(?:Array)?|[iu]?image2DRect|[iu]?imageBuffer|[iu]?imageCube|[iu]?imageCubeArray|[iu]?image[123]D|[iu]?image[12]DArray|if|in|inline|inout|input|int|interface|invariant|layout|long|lowp|mediump|namespace|noinline|noperspective|out|output|partition|patch|precise|precision|public|readonly|resource|restrict|return|sample|sampler[12]DArrayShadow|sampler[12]DShadow|sampler2DRectShadow|sampler3DRect|samplerCubeArrayShadow|samplerCubeShadow|shared|short|sizeof|smooth|static|struct|subroutine|superp|switch|template|this|true|typedef|uint|uniform|union|unsigned|using|varying|void|volatile|while|writeonly)\b/}),void 0===window.GPUShaderStage&&(window.GPUShaderStage={VERTEX:1,FRAGMENT:2,COMPUTE:4});class Ek{static isAvailable(){return void 0!==navigator.gpu}static getErrorMessage(){const t=document.createElement("div");return t.id="webgpumessage",t.style.fontFamily="monospace",t.style.fontSize="13px",t.style.fontWeight="normal",t.style.textAlign="center",t.style.background="#fff",t.style.color="#000",t.style.padding="1.5em",t.style.width="400px",t.style.margin="5em auto 0",t.innerHTML='Your browser does not support <a href="https://gpuweb.github.io/gpuweb/" style="color:blue">WebGPU</a>',t}}let Qk,Lk,Fk,Ik=!1,Dk=!1,Uk=!1,zk=0,Nk=null,Vk=!1,Bk=null,$k=null,Xk=60,jk=8421504,Gk=!0;const Zk={theta:0,phi:12,distance:12,fov:50,x:0,y:2,z:0,time:0},qk={envmap:"clear",groundSize:[60,60],groundPos:[0,0,0],groundAlpha:!0,groundOpacity:1,groundReflect:.1,ground:!0,water:!1,fog:!1,vignette:!0,shadow:.75},Wk={key:!1,mode:"HIGH",quality:2,demo:"start",envmap:"null",substep:1,fps:60,gravity:[0,-9.81,0],tone:"ACESFilmic",exposure:1,envPower:1,envBlur:0,legacy:!1,light_1:2.5,light_2:1,show_light:!1,show_stat:!1,shadow:.5,shadowType:"PCSS",shadowGamma:1,shadowLuma:.5,shadowContrast:2,reflect:.1,renderMode:0,fogMode:1,lightSizeUV:1.3,nearPlane:9.5,rings:4,nSample:16,composer:!1};let Hk,Yk,Kk,Jk,tA,eA,iA,sA=null,nA=!1,rA=null,oA=null,aA=null,lA="",hA=null,cA=null,uA=!0,dA=!0;const pA={w:0,h:0,r:0,left:0},fA={now:0,delta:0,then:0,inter:1e3/60,tmp:0,n:0,dt:0,fps:0},mA={None:r.NoToneMapping,Linear:r.LinearToneMapping,Reinhard:r.ReinhardToneMapping,Cineon:r.CineonToneMapping,ACESFilmic:r.ACESFilmicToneMapping,Uncharted2:r.CustomToneMapping},gA={PCSS:r.BasicShadowMap,PCF:r.PCFShadowMap,PCFSoft:r.PCFSoftShadowMap,VSM:r.VSMShadowMap},vA={Oimo:"1.2.2",Ammo:"3.0",Physx:"5.01.03",Rapier:"0.10.0",Havok:"0.10.0"},yA={Hub:la,engineType:"",currentDemmo:"",isWorker:!0,devMode:!1,engineList:["OIMO","AMMO","PHYSX","HAVOK","RAPIER"],demoList:[],demoLink:[],envList:[],isMobile:!1,isEditor:!1,motor:wo,start:async(t={})=>{la.setMain(yA),Nl.setMain(yA),Nl.setTextureConstrutor(r.Texture),Ik=t.webGPU||!1;const e=await K();switch(yA.isMobile=e.isMobile,(yA.isMobile||e.fps<60)&&(Wk.mode="LOW",Wk.quality=1),e.tier){case 1:Wk.fps=15;break;case 2:Wk.fps=30;break;case 3:Wk.fps=60}yA.engineType=t.type||"PHYSX",yA.isWorker=!yA.isMobile;let i=new URLSearchParams(window.location.search);if(i.has("E")){let t=i.get("E");yA.isWorker=-1!==t.search("w_"),yA.devMode=-1!==t.search("dev_"),yA.engineType=t.substring(t.lastIndexOf("_")+1).toUpperCase()}let s=yA.engineType.toLowerCase();Qk=s.charAt(0).toUpperCase()+s.slice(1),Lk=vA[Qk],t.type=yA.engineType,t.devMode=yA.devMode,t.worker=yA.isWorker,t.callback=bA,Fk=(yA.isWorker?"WORKER ":"DIRECT ")+yA.engineType+" "+Lk,Wk.show_stat=yA.devMode,window.engine=yA.engineType,wo.init(t)},setComposer:t=>{qA()},showDebugLight:t=>{TA(t)},showStatistic:t=>{GA(t)},setShadow:t=>{MA(t)},upShader:()=>{DA()},getCamera:()=>Kk.info,setCamera:t=>{NA(t)},getCode:()=>lA,getScene:()=>Jk,getRenderer:()=>tA,getControler:()=>Kk,getCodeName:()=>Wk.demo,getGround:()=>aA,getHub3d:()=>sA,getDemos:()=>{let t=wo.get("demos","json");yA.demoLink=[...t.Basic,...t.Advanced,...t[yA.engineType]],yA.devMode&&(yA.demoLink=[...yA.demoLink,...t.Dev]);let e,i=yA.demoLink.length;for(;i--;)e=yA.demoLink[i],yA.demoList[i]=e.substring(e.lastIndexOf("/")+1);yA.envList=[...t.Envmap]},lightIntensity:()=>{kA()},envmapIntensity:()=>{jA()},setReflect:t=>{UA(t)},getOption:()=>Wk,getSetting:()=>qk,getComposer:()=>oA,getToneMappingOptions:()=>mA,setLeft:t=>{pA.left=t,LA()},setCode:t=>{},getMouseDown:()=>mouseDown,externEditor:()=>{BA()},injectCode:t=>{_A(t)},addParticle:t=>HA(t),getParticle:t=>YA(t),initParticle:()=>WA(),loadDemo:t=>{CA(t)},extraCode:(t,e)=>{hA.loadExtra(t,e)},showEditor:t=>{hA.show(t)},changeMode:t=>{let e="LOW"===Wk.mode;MA(e?0:.5),UA(e?0:.8)},showGui:()=>{Nl.showHide()},resetGui:()=>{Nl.reset()},setEnv:(t,e)=>{VA(t)},setBlur:t=>{Dl.setBlur(Wk.envBlur)},setColors:t=>{sA&&(sA.color=Nl.tool.htmlToHex(t.darkVibrant)),jk=Nl.tool.htmlToHex(t.ground),aA&&Gk&&aA.setColor(jk),Nl.tool.htmlRgba(t.darkMuted,.4),la.setTopColor(Nl.tool.htmlRgba(t.darkMuted,.4))}};wo.log=la.log,wo.initParticle=yA.initParticle,wo.addParticle=yA.addParticle,wo.getParticle=yA.getParticle,wo.getGround=yA.getGround,wo.extraCode=yA.extraCode,window.phy=wo,window.math=wo.math,window.Main=yA,window.THREE=r,window.hub=la,window.Planet=VS,window.Building=BS,window.Sparkle=JS,window.Diamond=rk,window.Fluid=uk;const bA=()=>{Dk=!!Ik&&Ek.isAvailable(),Dk&&console.log("use webgpu !!");let t=window.devicePixelRatio,e=!(t>1);t>2&&(t=2),wo.getScene(),pA.w=window.innerWidth,pA.h=window.innerHeight,pA.r=pA.w/pA.h,tA=Dk?new o.default({antialias:!1,alpha:!1,premultipliedAlpha:!1}):new r.WebGLRenderer({antialias:e,powerPreference:"default",alpha:!1}),tA.setPixelRatio(t),tA.setSize(pA.w,pA.h),tA.setClearColor(0,1),tA.toneMapping=mA[Wk.tone],tA.toneMappingExposure=Wk.exposure,"LOW"!==Wk.mode&&wo.setMaxAnisotropy(tA.capabilities.getMaxAnisotropy()),document.body.appendChild(tA.domElement),Hk=tA.domElement,Hk.style.position="absolute",Pi.renderer=tA,Dk||(Pi.setGl2(!Dk&&tA.capabilities.isWebGL2),Pi.init(Wk)),Jk=new r.Scene,tA.setClearColor(new r.Color(8421504)),eA=new r.Group,eA.name="followGroup",Jk.add(eA),iA=new r.Group,iA.name="helperGroup",Jk.add(iA),Jk.helper=iA,AA(),Yk=new r.PerspectiveCamera(50,pA.r,.1,1e3),Jk.add(Yk),Kk=new vt(Yk,tA.domElement,eA),Kk.minDistance=.1,Kk.maxDistance=100,Kk.enableDamping=!0,Kk.dampingFactor=.25,Kk.screenSpacePanning=!0,Kk.zoomToCursor=!0,document.addEventListener("visibilitychange",QA),window.addEventListener("resize",LA),document.body.addEventListener("dragover",(function(t){t.preventDefault()}),!1),document.body.addEventListener("dragend",(function(t){t.preventDefault()}),!1),document.body.addEventListener("dragleave",(function(t){t.preventDefault()}),!1),document.body.addEventListener("drop",xA,!1),la.init(Yk,pA,Fk),hA=new iS,Dl.init(tA,Jk),Dl.setMain(yA),wA(),wo.load("demos.json",OA)},xA=t=>{t.preventDefault();const e=t.dataTransfer.files[0],i=new FileReader,s=e.name,n=s.substring(s.lastIndexOf(".")+1,s.length),r=s.substring(s.lastIndexOf("/")+1,s.lastIndexOf("."));switch(n){case"js":i.readAsText(e);break;case"fbx":case"glb":i.readAsArrayBuffer(e);break;case"hdr":case"exr":Wk.envmap=r,Dl.load((window.URL||window.webkitURL).createObjectURL(e),null,n)}i.onload=function(t){if("js"===n)PA(r,t.target.result)}},OA=()=>{yA.getDemos(),wo.setContent(Jk),wo.setControl(Kk),wo.setExtendShader(Pi.add),wo.setAddControl(SA),wo.activeMouse(Kk);let t=location.hash.substr(1);""!==t&&(Wk.demo=t),la.endLoading(),CA(Wk.demo)},wA=()=>{nA||(null===rA&&FA(0),nA=!0)},SA=()=>{yA.isMobile&&la.addJoystick()},kA=(t,e)=>{t&&(Wk.light_1=t),e&&(Wk.light_2=e),Ja.update({sunIntensity:Wk.light_1,hemiIntensity:Wk.light_2})},AA=()=>{Ja.add({type:"direct",name:"sun",intensity:.7*Wk.light_1,distance:6,parent:eA,shadow:{range:4,near:1,far:20,bias:-5e-4,radius:4,quality:1024*Wk.quality}}),Ja.add({type:"direct",name:"sun2",intensity:.3*Wk.light_1,distance:20,parent:eA,shadow:{range:40,near:5,far:40,bias:Dk?.005:-.005,radius:4,quality:1024*Wk.quality}}),"LOW"===Wk.mode&&(Wk.shadow=0,Wk.reflect=0),Dk||(Ja.castShadow(0!==Wk.shadow),tA.shadowMap.enabled=0!==Wk.shadow,tA.shadowMap.type=gA[Wk.shadowType])},TA=t=>{let e=Ja.addHelper(t,iA);Dl.preview(e)},MA=t=>{Dk||(Wk.shadow=t,0===Wk.shadow?(Ja.castShadow(!1),Dk||(tA.shadowMap.enabled=!1)):tA.shadowMap.enabled||(Ja.castShadow(!0),Dk||(tA.shadowMap.enabled=!0)),yA.upShader())},PA=(t,e)=>{yA.currentDemo=t,Wk.demo=t,location.hash=t,la.upMenu(),_A(e,!0)},CA=t=>{let e=yA.demoList.indexOf(t);-1===e&&(t="start",e=0),yA.currentDemo=t,Wk.demo=t,location.hash=t,la.upMenu(),wo.load("./demos/"+yA.demoLink[e]+".js",_A)},_A=(t,e=!1)=>{uA=!t,lA=uA?wo.getScript(Wk.demo):t,e&&(uA=!0),window.onReset&&(window.onReset(),window.onReset=null),la.reset(),Pi.reset(),hA.reset(),Bk&&Bk.dispose(),uA&&(Ja.update({sunPos:[.27,1,.5],sunColor:16777215,skyColor:16777215,groundColor:8421504}),wo.poolDispose()),phy.mouseMode("drag"),phy.reset(RA)},RA=()=>{null!==cA&&(cA.remove(),cA=null),cA=document.createElement("script"),cA.language="javascript",cA.type="text/javascript",cA.id="demo",cA.async=!1,cA.innerHTML="{"+lA+"}",document.body.appendChild(cA),uA&&EA();let t=lA.search("phy.view"),e=lA.search("//phy.view");-1!==t&&-1===e||zA(qk),-1===lA.search("phy.set")&&wo.set(),window.demo(),Nl.doReset()},EA=()=>{Vk?XA({type:"set",code:lA,name:Wk.demo}):hA.set(lA,Wk.demo)},QA=()=>{document.hidden?(Uk=wo.getPause(),wo.pause(!0)):wo.pause(Uk)},LA=()=>{pA.w=window.innerWidth-pA.left,pA.h=window.innerHeight,pA.r=pA.w/pA.h,dA=!0},FA=(t=0)=>{fA.now=t,fA.delta=fA.now-fA.then,fA.dt=.001*fA.delta,dA&&(Hk.style.left=pA.left+"px",Yk.aspect=pA.r,Yk.updateProjectionMatrix(),tA.setSize(pA.w,pA.h),oA&&oA.resize(pA),Bk&&Bk.onresize(pA.h),la.resize(pA),wo.resize(pA),dA=!1),wo.doStep(t),Bk&&Bk.update(t),Kk&&(Kk.enableDamping&&Kk.enable&&Kk.update(),Kk.follow&&Kk.follow(fA.dt)),oA&&oA.enabled?oA.render(fA.dt):tA.render(Jk,Yk),Nl.update(),IA(),rA=requestAnimationFrame(FA)},IA=()=>{fA.now-1e3>fA.tmp&&(fA.tmp=fA.now,fA.fps=fA.n,fA.n=0),fA.n++,fA.then=fA.now,fA.fps>Xk&&(Xk=fA.fps,wo.setMaxFps(Xk)),la.setFps(fA.fps+" ~ "+wo.getFps()),ZA()},DA=()=>{Pi.up(Wk)},UA=t=>{t&&(Wk.reflect=t),aA&&aA.setReflect(Wk.reflect)},zA=(t={})=>{t={...qk,...t},Gk=!t.groundColor,t.envmap&&(VA(t.envmap),Wk.envBlur=t.envblur||0,Dl.setBlur(Wk.envBlur)),MA(t.shadow),t.fog?(Jk.fog=new r.Fog(Dl.getFogColor().getHex(),1,50),Wk.fogMode=1):t.fogexp?(Jk.fog=new r.FogExp2(Dl.getFogColor().getHex(),t.fogexp||.01),Wk.fogMode=0):Jk.fog=null,t.ground?(t=>{t.groundReflect&&(Wk.reflect=t.groundReflect),null===aA?(aA=new zS({textureSize:1024*Wk.quality,clipBias:.003,encoding:!0,reflect:Wk.reflect,water:t.water,round:!0,normal:!0}),Jk.add(aA)):aA.reset(),aA.setSize(t.groundSize),aA.position.fromArray(t.groundPos),t.groundColor?aA.setColor(t.groundColor):aA.setColor(jk),aA.setAlphaMap(t.groundAlpha),aA.setOpacity(t.groundOpacity),aA.setReflect(t.groundReflect),aA.setWater(t.water),wo.addMaterial(aA.material,!0)})(t):null!==aA&&(aA.dispose(),aA=null),t.vignette?null!==sA||Dk||(sA=new US,Yk.add(sA)):null!==sA&&(sA.dispose(),sA=null),uA&&NA(t),Pi.up(Wk)};wo.view=zA;const NA=t=>{Kk.moveCam({...Zk,...t}),Kk.update()},VA=(t,e)=>{t!==Wk.envmap&&(isNaN(t)?Wk.envmap=t:Wk.envmap="null",Dl.set(t))},BA=()=>{if(!Nk){let t=location.hash;zk=pA.left||500,Vk=!0,Nk=window.open("editor.html"+t,"Editor","height="+pA.h+", width="+zk),window.addEventListener("message",$A,!1),Nk.onload=()=>{XA({type:"connect"}),hA.close(),pA.left=0,LA()}}},$A=t=>{switch(t.data.type){case"connect":console.log("connect");break;case"inject":_A(t.data.code);break;case"close":XA({type:"close"}),window.removeEventListener("message",$A,!1),Nk=null,Vk=!1,hA.open(),pA.left=zk}},XA=t=>{Nk&&Nk.postMessage(t,"*")},jA=t=>{wo.setEnvmapIntensity(Wk.envPower)},GA=t=>{Dk||(t&&!$k&&($k=new N(tA)),!t&&$k&&($k=null,la.setStats()))},ZA=()=>{$k&&la.setStats($k.get())},qA=t=>{Wk.composer?(null===oA&&(oA=new DS(tA,Jk,Yk,Kk,pA)),oA.enabled=!0):oA&&(oA.dispose(),oA=null),Nl.postprocessEdit()},WA=()=>{Bk||(Bk=new Tk(Jk,tA))},HA=(t={})=>(Bk||(Bk=new Tk(Jk,tA)),Bk.add(t)),YA=t=>(Bk||(Bk=new Tk(Jk,tA)),Bk.get(t));t.Main=yA,Object.defineProperty(t,"__esModule",{value:!0})}));
